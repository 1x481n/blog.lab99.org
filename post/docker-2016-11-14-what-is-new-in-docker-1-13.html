<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Docker 1.13 新增功能 · 大桥下的蜗牛</title><meta name="description" content="无善无恶心之体，有善有恶意之动，知善知恶是良知，为善去恶是格物。"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/blog.lab99.org/favicon.png"><link rel="stylesheet" href="/blog.lab99.org/css/jekyll.css"><link rel="stylesheet" href="https://cdn.bootcss.com/mermaid/7.0.0/mermaid.min.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/blog.lab99.org/" class="logo"><img src="/blog.lab99.org/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/blog.lab99.org/post/docker-2016-11-14-what-is-new-in-docker-1-13.html" class="post-title-link">Docker 1.13 新增功能</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/blog.lab99.org//blog.lab99.org/tags/docker/" class="post-tag-link">docker</a></li><li class="post-tag-item"><a href="/blog.lab99.org//blog.lab99.org/tags/blog/" class="post-tag-link">blog</a></li></ul><div class="post-time">2016年11月14日 星期一</div></div><div class="post-content"><link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc -->
<ul>
<li><a href="#qian-yan">&#x524D;&#x8A00;</a><ul>
<li><a href="#top-10-xin-zeng-gong-neng">Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#docker-jing-xiang-gou-jian">Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;</a><ul>
<li><a href="#cong-yi-you-jing-xiang-qu-de-huan-cun">&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;</a></li>
<li><a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan">&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;</a></li>
<li><a href="#gou-jian-jing-xiang-shi-zhi-chi-yong-network-zhi-ding-wang-luo">&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528; <code>--network</code> &#x6307;&#x5B9A;&#x7F51;&#x7EDC;</a></li>
<li><a href="#kai-shi-yun-xu-docker-build-zhong-ding-yi-dockerfile-wei-shi-yong-de-can-shu-arg">&#x5F00;&#x59CB;&#x5141;&#x8BB8; <code>docker build</code> &#x4E2D;&#x5B9A;&#x4E49; <code>Dockerfile</code> &#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09;</a></li>
</ul>
</li>
<li><a href="#an-zhuang">&#x5B89;&#x88C5;</a><ul>
<li><a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti">&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898;</a></li>
<li><a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi">&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;</a></li>
</ul>
</li>
<li><a href="#wang-luo">&#x7F51;&#x7EDC;</a><ul>
<li><a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo">&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC;</a></li>
<li><a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou">&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</a></li>
<li><a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;</a></li>
<li><a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-de-jie-dian">&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9;</a></li>
<li><a href="#yun-xu-service-vip-ke-yi-bei-ping">&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code></a></li>
</ul>
</li>
<li><a href="#cha-jian">&#x63D2;&#x4EF6;</a><ul>
<li><a href="#cha-jian-gong-neng-zheng-shi-qi-yong">&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;</a></li>
</ul>
</li>
<li><a href="#ming-ling-xing">&#x547D;&#x4EE4;&#x884C;</a><ul>
<li><a href="#checkpoint-gong-neng-shi-yan-gong-neng"><code>checkpoint</code> &#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;</a><ul>
<li><a href="#zhun-bei-gong-zuo">&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</a></li>
<li><a href="#chuang-jian-checkpoint-ji-hui-fu">&#x521B;&#x5EFA; Checkpoint &#x53CA;&#x6062;&#x590D;</a></li>
</ul>
</li>
<li><a href="#docker-stats-zhong-yu-ke-yi-xian-shi-rong-qi-ming-liao"><code>docker stats</code> &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86;</a></li>
<li><a href="#gei-docker-ps-zeng-jia-is-task-guo-lu-qi">&#x7ED9; <code>docker ps</code> &#x589E;&#x52A0; <code>is-task</code> &#x8FC7;&#x6EE4;&#x5668;</a></li>
<li><a href="#zai-ye-bu-hui-chu-xian-ke-hu-duan-he-fu-wu-duan-bu-tong-ban-ben-dao-zhi-de-cuo-wu-liao">&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86;</a></li>
<li><a href="#docker-inspect-jiang-ke-yi-cha-kan-ren-he-docker-dui-xiang"><code>docker inspect</code> &#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; docker &#x5BF9;&#x8C61;</a></li>
</ul>
</li>
<li><a href="#yun-xing-shi">&#x8FD0;&#x884C;&#x65F6;</a><ul>
<li><a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu">&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570;</a></li>
<li><a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e">&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;</a></li>
<li><a href="#zeng-jia-docker-system-ming-ling">&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</a></li>
<li><a href="#ti-sheng-overlay2-de-you-xian-ji">&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7;</a></li>
<li><a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
<li><a href="#windows-nei-zhi-de-yun-xing-windows-cheng-xu-de-docker-on-windows-de-gai-jin">Windows &#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x7684; Docker on Windows &#x7684;&#x6539;&#x8FDB;</a></li>
</ul>
</li>
<li><a href="#swarm-mode">Swarm Mode</a><ul>
<li><a href="#zheng-shi-zhi-chi-docker-stack">&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code></a></li>
<li><a href="#tian-jia-secret-guan-li">&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406;</a></li>
<li><a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi">&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;</a></li>
<li><a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng">&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</a></li>
<li><a href="#bu-chong-liao-yi-xie-docker-service-create-suo-que-shi-de-can-shu">&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B; <code>docker service create</code> &#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570;</a></li>
<li><a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi-shi-yan-gong-neng">&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;</a></li>
<li><a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force">&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></a></li>
</ul>
</li>
<li><a href="#fei-qi">&#x5E9F;&#x5F03;</a></li>
</ul>
<!-- tocstop -->
<h1 id="qian-yan"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00; <a href="#qian-yan" class="header-anchor">#</a></h1><p><em>2017&#x5E74;1&#x6708;19&#x65E5;&#x66F4;&#x65B0;</em></p>
<p><code>Docker 1.13</code> &#x5728; 2017 &#x5E74; 1 &#x6708; 18 &#x65E5;&#x53D1;&#x5E03;&#x4E86;&#x3002;&#x4ECE; 2016 &#x5E74; 7 &#x6708; 29 &#x65E5;&#x53D1;&#x5E03; <code>1.12</code> &#x53D1;&#x5E03;&#x4EE5;&#x6765;&#xFF0C;&#x5DF2;&#x7ECF;&#x8FC7;&#x53BB; 5 &#x4E2A;&#x591A;&#x6708;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D3B;&#x8DC3;&#x7684; Docker &#x793E;&#x533A;&#x6765;&#x8BF4;&#xFF0C;&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x90FD; <code>1.13</code> &#x90FD;&#x65B0;&#x589E;&#x4E86;&#x4EC0;&#x4E48;&#x5185;&#x5BB9;&#x5427;&#x3002;</p>
<p><code>1.13</code> &#x6709;<a href="https://github.com/docker/docker/milestone/56" target="_blank" rel="noopener">&#x4E00;&#x5343;&#x56DB;&#x767E;&#x591A;&#x4E2A; issue/pull request</a>&#xFF0C;&#x4E94;&#x5343;&#x591A;&#x4E2A; commits&#xFF0C;&#x662F; Docker &#x5386;&#x53F2;&#x4E0A;&#x6700;&#x9AD8;&#x7684;&#x53D1;&#x5E03;&#x7248;&#x672C;&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5C0F;&#x7248;&#x672C;&#x53D8;&#x5316;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x5927;&#x91CF;&#x7684;&#x66F4;&#x65B0;&#x3002;</p>
<p>&#x5728;&#x53D1;&#x5E03;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7248;&#x672C;&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Ubuntu / CentOS &#x7CFB;&#x7EDF;&#x4E2D;&#x76F4;&#x63A5;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com/ | sh -s -- --mirror AzureChinaCloud</span><br></pre></td></tr></table></figure>
<h2 id="top-10-xin-zeng-gong-neng"><a href="#Top-10-&#x65B0;&#x589E;&#x529F;&#x80FD;" class="headerlink" title="Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;"></a>Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD; <a href="#top-10-xin-zeng-gong-neng" class="header-anchor">#</a></h2><ul>
<li>1&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x670D;&#x52A1;&#x6808; <code>docker stack</code></li>
<li>2&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x63D2;&#x4EF6;&#xFF1A;<code>docker plugin</code></li>
<li>3&#x3001;&#x6DFB;&#x52A0;&#x5728; Swarm &#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7BA1;&#x7406;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF1A;<code>docker secret</code></li>
<li>4&#x3001;&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</li>
<li>5&#x3001;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x8FDB;&#x884C;&#x670D;&#x52A1;&#x90E8;&#x7F72;</li>
<li>6&#x3001;&#x6DFB;&#x52A0; <code>docker service</code> &#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</li>
<li>7&#x3001;&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></li>
<li>8&#x3001;&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</li>
<li>9&#x3001;&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;</li>
<li>10&#x3001;&#x89E3;&#x51B3;&#x4E2D;&#x56FD; <code>GFW</code> &#x5899;&#x6389; <code>docker-engine</code> <code>apt</code>/<code>yum</code> &#x6E90;&#x7684;&#x95EE;&#x9898;</li>
</ul>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x8BE6;&#x7EC6;&#x89E3;&#x8BFB;&#x4E00;&#x4E0B; <a href="https://github.com/docker/docker/releases/tag/v1.13.0" target="_blank" rel="noopener"><code>1.13.0</code> &#x65B0;&#x589E;&#x529F;&#x80FD;</a> &#x5427;&#x3002;</p>
<h1 id="docker-jing-xiang-gou-jian"><a href="#Docker-&#x955C;&#x50CF;&#x6784;&#x5EFA;" class="headerlink" title="Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;"></a>Docker &#x955C;&#x50CF;&#x6784;&#x5EFA; <a href="#docker-jing-xiang-gou-jian" class="header-anchor">#</a></h1><h2 id="cong-yi-you-jing-xiang-qu-de-huan-cun"><a href="#&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;" class="headerlink" title="&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;"></a>&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58; <a href="#cong-yi-you-jing-xiang-qu-de-huan-cun" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26839" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26839</a></p>
<p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5145;&#x5206;&#x5229;&#x7528;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#x7279;&#x6027;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x907F;&#x514D;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#x662F;&#x66FE;&#x7ECF;&#x5728;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x8FC7;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x5728; CI &#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x6784;&#x5EFA;&#x65F6;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x800C;&#x8BE5;&#x673A;&#x5668;&#x6CA1;&#x6709;&#x6784;&#x5EFA;&#x8FC7;&#x8BE5;&#x955C;&#x50CF;&#xFF0C;&#x56E0;&#x6B64;&#x7F13;&#x5B58;&#x603B;&#x662F;&#x7528;&#x4E0D;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#x6D6A;&#x8D39;&#x5728;&#x4E86;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#x4E0A;&#x4E86;&#x3002;</p>
<p>&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x4E3A; <code>docker build</code> &#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x53C2;&#x6570; <code>--cache-from</code>&#xFF0C;&#x5229;&#x7528;&#x955C;&#x50CF;&#x4E2D;&#x7684; History &#x6765;&#x5224;&#x65AD;&#x8BE5;&#x5C42;&#x662F;&#x5426;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#x4E00;&#x81F4;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x5148;&#x4E0B;&#x8F7D;&#x83B7;&#x53D6;&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x7684;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull mongo:3.2</span><br><span class="line">3.2: Pulling from library/mongo</span><br><span class="line">386a066cd84a: Pull complete</span><br><span class="line">524267bc200a: Pull complete</span><br><span class="line">476d61c7c43a: Pull complete</span><br><span class="line">0750d0e28b90: Pull complete</span><br><span class="line">4bedd83d0855: Pull complete</span><br><span class="line">b3b5d21a0eda: Pull complete</span><br><span class="line">7354b6c26240: Pull complete</span><br><span class="line">db792d386b51: Pull complete</span><br><span class="line">a867bd77950c: Pull complete</span><br><span class="line">Digest: sha256:532a19da83ee0e4e2a2ec6bc4212fc4af26357c040675d5c2629a4e4c4563cef</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mongo:3.2</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x540E;&#x7684; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x4E0A; <code>--cache-from mongo:3.2</code> &#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5982;&#x679C;&#x662F;&#x5DF2;&#x7ECF;&#x5728; <code>mongo:3.2</code> &#x4E2D;&#x5B58;&#x5728;&#x5E76;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x7684;&#x5C42;&#xFF0C;&#x5C31;&#x4F1A;&#x7528; <code>mongo:3.2</code> &#x4E2D;&#x7684;&#x8BE5;&#x5C42;&#x505A;&#x7F13;&#x5B58;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --cache-from mongo:3.2 -t mongo:3.2.1 .</span><br><span class="line">Sending build context to Docker daemon 4.608 kB</span><br><span class="line">Step 1/18 : FROM debian:jessie</span><br><span class="line"> ---&gt; 73e72bf822ca</span><br><span class="line">Step 2/18 : RUN groupadd -r mongodb &amp;&amp; useradd -r -g mongodb mongodb</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 0f6297900a5e</span><br><span class="line">Step 3/18 : RUN apt-get update 	&amp;&amp; apt-get install -y --no-install-recommends 		numactl 	&amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a465f2e906fc</span><br><span class="line">Step 4/18 : ENV GOSU_VERSION 1.7</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; d448ddca2126</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="ya-bian-squash-jing-xiang-shi-yan-jie-duan"><a href="#&#x538B;&#x6241;-squash-&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;" class="headerlink" title="&#x538B;&#x6241;(squash)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;"></a>&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09; <a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/22641" target="_blank" rel="noopener">https://github.com/docker/docker/pull/22641</a></p>
<p>&#x5BF9;&#x4E8E;&#x603B;&#x662F;&#x628A; <code>Dockerfile</code> &#x5F53;&#x505A; <code>bash</code> &#x6587;&#x4EF6;&#x6765;&#x7528;&#x7684;&#x4EBA;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5F88;&#x5FEB;&#x7531;&#x4E8E;&#x592A;&#x591A;&#x7684; <code>RUN</code> &#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x6709;&#x7279;&#x522B;&#x591A;&#x7684;&#x5C42;&#xFF0C;&#x955C;&#x50CF;&#x8D85;&#x7EA7;&#x81C3;&#x80BF;&#xFF0C;&#x800C;&#x4E14;&#x751A;&#x81F3;&#x4F1A;&#x78B0;&#x5230;&#x8D85;&#x51FA;&#x6700;&#x5927;&#x5C42;&#x6570;&#x9650;&#x5236;&#x7684;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E9B;&#x4EBA;&#x5F80;&#x5F80;&#x4E0D;&#x4ECE;&#x81EA;&#x8EAB;&#x627E;&#x95EE;&#x9898;&#xFF0C;&#x53CD;&#x800C;&#x53BB;&#x5BFB;&#x627E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#xFF0C;&#x6BD4;&#x5982;&#x5BFC;&#x51FA;&#x955C;&#x50CF;&#x505A;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5BFC;&#x5165;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x5F88;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x5BFC;&#x81F4;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x5931;&#x8D25;&#x5916;&#xFF0C;&#x8FD8;&#x5BFC;&#x81F4; <code>docker history</code> &#x4E22;&#x5931;&#xFF0C;&#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x53D8;&#x4E3A;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x3002;&#x5176;&#x5B9E;&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x9075;&#x5FAA; <code>Dockerfile</code> &#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x591A;&#x4E2A;&#x547D;&#x4EE4;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A; <code>RUN</code>&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A; <code>RUN</code> &#x8981;&#x7CBE;&#x5FC3;&#x8BBE;&#x8BA1;&#xFF0C;&#x786E;&#x4FDD;&#x5B89;&#x88C5;&#x6784;&#x5EFA;&#x6700;&#x540E;&#x8FDB;&#x884C;&#x6E05;&#x7406;&#x3002;&#x8FD9;&#x6837;&#x624D;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x955C;&#x50CF;&#x4F53;&#x79EF;&#xFF0C;&#x4EE5;&#x53CA;&#x6700;&#x5927;&#x5316;&#x7684;&#x5229;&#x7528;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x3002;</p>
<p>&#x5728; Docker 1.13 &#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x8FD9;&#x7FA4;&#x7528;&#x6237;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; <code>--squash</code> &#x53C2;&#x6570;&#x7ED9; <code>docker build</code>&#xFF0C;&#x5176;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;&#x5C06; <code>Dockerfile</code> &#x4E2D;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x538B;&#x7F29;&#x4E3A;&#x4E00;&#x5C42;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x4E0E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x4FDD;&#x7559;&#x4E86; <code>docker history</code>&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5982;&#x4E0B;&#x7684; <code>Dockerfile</code>&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> hello &gt; /hello</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> world &gt;&gt; /hello</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> touch remove_me /remove_me</span></span><br><span class="line"><span class="keyword">ENV</span> HELLO world</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> rm /remove_me</span></span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6B63;&#x5E38;&#x7684;&#x6784;&#x5EFA;&#x7684;&#x8BDD;&#xFF0C;&#x6BD4;&#x5982; <code>docker build -t my-not-squash .</code>&#xFF0C;&#x5176; <code>history</code> &#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">history</span> my-not-squash</span><br><span class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</span><br><span class="line">305297a526e2        About a minute ago   /bin/sh -c rm /remove_me                        0 B</span><br><span class="line">60b8e896d443        About a minute ago   /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></span><br><span class="line">a21f3c75b6b0        About a minute ago   /bin/sh -c touch remove_me /remove_me           0 B</span><br><span class="line">038bca5b58cb        About a minute ago   /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 12 B</span><br><span class="line">f81b1006f556        About a minute ago   /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  6 B</span><br><span class="line">e02e811dd08f        5 weeks ago          /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></span><br><span class="line">&lt;missing&gt;           5 weeks ago          /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></span><br></pre></td></tr></table></figure>
<p>&#x800C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7528; <code>--squash</code> &#x6784;&#x5EFA;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mysquash --squash .</span><br></pre></td></tr></table></figure>
<p>&#x5176; <code>history</code> &#x5219;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">history</span> mysquash</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">a557e397ff56        15 seconds ago                                                      12 B                merge sha256:305297a526e218e77f1b4b273442f8ac6283e2907e6513ff36e9048aa130dea6 to sha256:e02e811dd08fd49e7f6032625495118e63f597eb150403d02e3238af1df240ba</span><br><span class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c rm /remove_me                        0 B</span><br><span class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></span><br><span class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c touch remove_me /remove_me           0 B</span><br><span class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 0 B</span><br><span class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  0 B</span><br><span class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></span><br><span class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x5C42;&#x7684;&#x5C42;ID&#x90FD; <code>&lt;missing&gt;</code> &#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x591A;&#x4E86;&#x4E00;&#x5C42; <code>merge</code>&#x3002;</p>
<p><strong>&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x89E3;&#x51B3;&#x61D2;&#x60F0;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x64B0;&#x5199; Dockerfile &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F9D;&#x65E7;&#x9700;&#x8981;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4E0D;&#x8981;&#x8BD5;&#x56FE;&#x7528;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x53BB;&#x538B;&#x7F29;&#x955C;&#x50CF;&#x3002;</strong></p>
<h2 id="gou-jian-jing-xiang-shi-zhi-chi-yong-network-zhi-ding-wang-luo"><a href="#&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528;-network-&#x6307;&#x5B9A;&#x7F51;&#x7EDC;" class="headerlink" title="&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528; --network &#x6307;&#x5B9A;&#x7F51;&#x7EDC;"></a>&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528; <code>--network</code> &#x6307;&#x5B9A;&#x7F51;&#x7EDC; <a href="#gou-jian-jing-xiang-shi-zhi-chi-yong-network-zhi-ding-wang-luo" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27702" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27702</a><br><a href="https://github.com/docker/docker/issues/10324" target="_blank" rel="noopener">https://github.com/docker/docker/issues/10324</a></p>
<p>&#x5728;&#x4E00;&#x4E9B;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5B9A;&#x5236; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x6765;&#x63D0;&#x4F9B;&#x7279;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x548C; IP &#x5730;&#x5740;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5E94;&#x5BF9; GFW&#xFF0C;&#x8FD8;&#x662F;&#x516C;&#x53F8;&#x5185;&#x90E8; Git &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x6709;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6784;&#x5EFA;&#x65F6;&#x4FEE;&#x6539; <code>/etc/hosts</code> &#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x4F7F;&#x7528;&#x5185;&#x90E8; DNS &#x867D;&#x7136;&#x662F;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x5C06;&#x662F;&#x5168;&#x5F15;&#x64CE;&#x8303;&#x56F4;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x975E;&#x6240;&#x6709;&#x73AF;&#x5883;&#x90FD;&#x4F1A;&#x6709;&#x5185;&#x90E8; DNS&#x3002;&#x66F4;&#x597D;&#x5730;&#x505A;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6216;&#x8BB8;&#x8FD9;&#x4E2A;&#x6784;&#x5EFA;&#x6240;&#x9700; Git &#x670D;&#x52A1;&#x5668;&#x4F4D;&#x4E8E;&#x5BB9;&#x5668;&#x5185;&#x7F51;&#x7EDC;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x67D0;&#x4E2A; <code>overlay</code> &#x7F51;&#x7EDC;&#x6765;&#x7ED9;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x6240;&#x9700;&#x3002;</p>
<p>&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x4E3A; <code>docker build</code> &#x63D0;&#x4F9B;&#x4E86; <code>--network</code> &#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6784;&#x5EFA;&#x65F6;&#x7684;&#x7F51;&#x7EDC;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A; <code>Dockerfile</code> &#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> cat /etc/hosts</span></span><br></pre></td></tr></table></figure>
<p>&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x770B;&#x770B;&#x6784;&#x5EFA;&#x65F6;&#x7684; <code>/etc/hosts</code> &#x7684;&#x5185;&#x5BB9;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5BBF;&#x4E3B;&#x7684; <code>/etc/hosts</code> &#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x6761; <code>1.2.3.4</code> &#x5230; <code>example.com</code> &#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.2.3.4  example.com</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5982;&#x540C;&#x4EE5;&#x5F80;&#xFF0C;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7F51;&#x7EDC;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x90A3;&#x4E48;&#x7ED3;&#x679C;&#x4F1A;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --no-cache -t build-network .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1/2 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2/2 : RUN cat /etc/hosts</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 42f0c014500f</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.2	2866979c4d77</span><br><span class="line"> ---&gt; 5f0b3dd56a32</span><br><span class="line">Removing intermediate container 42f0c014500f</span><br><span class="line">Successfully built 5f0b3dd56a32</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x8FD9;&#x6B21;&#x6784;&#x5EFA;&#x6240;&#x770B;&#x5230;&#x7684;&#x662F;&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x7F51;&#x7EDC;&#x7684; <code>/etc/hosts</code>&#xFF0C;&#x5176;&#x5185;&#x6CA1;&#x6709;&#x5BBF;&#x4E3B;&#x4E0A;&#x6DFB;&#x52A0;&#x7684;&#x6761;&#x76EE; <code>1.2.3.4  example.com</code>&#x3002;</p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528; <code>docker build --network=host</code> &#x6765;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x6784;&#x5EFA;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --no-cache -t build-network --network=host .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1/2 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2/2 : RUN cat /etc/hosts</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> b990c4e55424</span><br><span class="line"><span class="comment"># Your system has configured &apos;manage_etc_hosts&apos; as True.</span></span><br><span class="line"><span class="comment"># As a result, if you wish for changes to this file to persist</span></span><br><span class="line"><span class="comment"># then you will need to either</span></span><br><span class="line"><span class="comment"># a.) make changes to the master file in /etc/cloud/templates/hosts.tmpl</span></span><br><span class="line"><span class="comment"># b.) change or remove the value of &apos;manage_etc_hosts&apos; in</span></span><br><span class="line"><span class="comment">#     /etc/cloud/cloud.cfg or cloud-config from user-data</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">127.0.1.1 d1.localdomain d1</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># The following lines are desirable for IPv6 capable hosts</span></span><br><span class="line">::1 ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">ff02::3 ip6-allhosts</span><br><span class="line"></span><br><span class="line">1.2.3.4  example.com</span><br><span class="line"></span><br><span class="line"> ---&gt; 63ef6cb93316</span><br><span class="line">Removing intermediate container b990c4e55424</span><br><span class="line">Successfully built 63ef6cb93316</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6B21;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x4E86; <code>--network=host</code> &#x53C2;&#x6570;&#xFF0C;&#x4E8E;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x56E0;&#x6B64; <code>/etc/hosts</code> &#x4E5F;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x770B;&#x5230; <code>1.2.3.4  example.com</code> &#x6761;&#x76EE;&#x3002;</p>
<h2 id="kai-shi-yun-xu-docker-build-zhong-ding-yi-dockerfile-wei-shi-yong-de-can-shu-arg"><a href="#&#x5F00;&#x59CB;&#x5141;&#x8BB8;-docker-build-&#x4E2D;&#x5B9A;&#x4E49;-Dockerfile-&#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09;" class="headerlink" title="&#x5F00;&#x59CB;&#x5141;&#x8BB8; docker build &#x4E2D;&#x5B9A;&#x4E49; Dockerfile &#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09;"></a>&#x5F00;&#x59CB;&#x5141;&#x8BB8; <code>docker build</code> &#x4E2D;&#x5B9A;&#x4E49; <code>Dockerfile</code> &#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09; <a href="#kai-shi-yun-xu-docker-build-zhong-ding-yi-dockerfile-wei-shi-yong-de-can-shu-arg" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27412" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27412</a></p>
<p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x65F6;&#x53EF;&#x4EE5;&#x7528; <code>--build-arg</code> &#x6765;&#x5B9A;&#x4E49;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x6837; <code>Dockerfile</code> &#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x503C;&#x6765;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E; CI/CD &#x7CFB;&#x7EDF;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x5957; <code>Dockerfile</code> &#x6765;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x6761;&#x4EF6;&#x4E0B;&#x7684;&#x955C;&#x50CF;&#x3002;</p>
<p>&#x4F46;&#x5728; <code>1.13</code> &#x4EE5;&#x524D;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5728; CI &#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x65F6;&#x5E0C;&#x671B;&#x7528;&#x4E00;&#x5957;&#x6784;&#x5EFA;&#x547D;&#x4EE4;&#x3001;&#x811A;&#x672C;&#xFF0C;&#x901A;&#x8FC7;&#x7ED9;&#x5165;&#x4E0D;&#x540C;&#x7684; <code>Dockerfile</code> &#x6765;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x800C; <code>--build-arg</code> &#x7684;&#x76EE;&#x7684;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x7528;&#x5230;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6709;&#x7684; <code>Dockerfile</code> &#x4E2D;&#x6CA1;&#x7528;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x90A3;&#x4E48;&#x6784;&#x5EFA;&#x5C31;&#x4F1A;&#x5931;&#x8D25;&#x3002;<a href="https://github.com/docker/docker/issues/26249" target="_blank" rel="noopener">#26249</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat Dockerfile</span><br><span class="line">FROM ubuntu</span><br><span class="line">RUN env</span><br><span class="line">$ docker build -t myapp --build-arg VERSION=1.2.3 --no-cache .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2 : RUN env</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 81f4ba452a49</span><br><span class="line">HOSTNAME=2866979c4d77</span><br><span class="line">HOME=/root</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">PWD=/</span><br><span class="line"> ---&gt; f78b4696a1ca</span><br><span class="line">Removing intermediate container 81f4ba452a49</span><br><span class="line">One or more build-args [VERSION] were not consumed, failing build.</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x80CC;&#x540E;&#x7684;&#x601D;&#x60F3;&#x662F;&#xFF0C;&#x5982;&#x679C; <code>--build-arg</code> &#x6307;&#x5B9A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A;&#x62FC;&#x5199;&#x9519;&#x8BEF;&#x3001;&#x6216;&#x8005;&#x5FD8;&#x8BB0;&#x4E86;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x800C;&#x51FA;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6700;&#x521D; <code>docker build</code> &#x5BF9;&#x4E8E;&#x8FD9;&#x7C7B;&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x6784;&#x5EFA;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x5728;&#x4E0A;&#x9762;&#x7684; CI &#x7684;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;<code>--build-arg</code> &#x53EA;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;<strong>&#x53EF;&#x80FD;</strong>&#x7528;&#x5230;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x5E76;&#x4E0D;&#x5F3A;&#x5236;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x56E0;&#x4E3A; <code>Dockerfile</code> &#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x53EF;&#x80FD;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5C31;&#x62A5;&#x9519;&#x5C31;&#x6709;&#x4E9B;&#x8FC7;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x5C06;&#x5176;<strong>&#x964D;&#x4E3A;&#x8B66;&#x544A;</strong>&#xFF0C;&#x5E76;&#x4E0D;&#x7EC8;&#x6B62;&#x6784;&#x5EFA;&#xFF0C;&#x53EA;&#x662F;&#x63D0;&#x9192;&#x7528;&#x6237;&#x6709;&#x4E9B;&#x53D8;&#x91CF;&#x672A;&#x4F7F;&#x7528;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --no-cache -t myapp --build-arg VERSION=1.2.3 .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1/2 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2/2 : RUN env</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> bb5e605cb4d0</span><br><span class="line">HOSTNAME=2866979c4d77</span><br><span class="line">HOME=/root</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">PWD=/</span><br><span class="line"> ---&gt; 97207d784048</span><br><span class="line">Removing intermediate container bb5e605cb4d0</span><br><span class="line">[Warning] One or more build-args [VERSION] were not consumed</span><br><span class="line">Successfully built 97207d784048</span><br></pre></td></tr></table></figure>
<h1 id="an-zhuang"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5; <a href="#an-zhuang" class="header-anchor">#</a></h1><h2 id="jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti"><a href="#&#x89E3;&#x51B3;-GFW-&#x5F71;&#x54CD;-Docker-&#x5B89;&#x88C5;&#x95EE;&#x9898;" class="headerlink" title="&#x89E3;&#x51B3; GFW &#x5F71;&#x54CD; Docker &#x5B89;&#x88C5;&#x95EE;&#x9898;"></a>&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898; <a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27005" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27005</a></p>
<p>&#x5B98;&#x65B9;&#x7684; <code>apt</code>/<code>yum</code> &#x6E90;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>AWS</code> &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x5B89;&#x5168;&#x4F7F;&#x7528;&#x4E86; <code>HTTPS</code>&#xFF0C;&#x56E0;&#x6B64;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x5F88;&#x4E50;&#x4E8E;&#x5E72;&#x6270;&#x5927;&#x5BB6;&#x4F7F;&#x7528;&#x3002;&#x6CA1;&#x529E;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5404;&#x4E2A;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7EB7;&#x7EB7;&#x5EFA;&#x7ACB;&#x81EA;&#x5DF1;&#x5B98;&#x65B9;&#x6E90;&#x955C;&#x50CF;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x3001;DaoCloud&#x3001;Azura &#x7B49;&#x7B49;&#xFF0C;&#x5E76;&#x4E14;&#x81EA;&#x5DF1;&#x505A;&#x4E86;&#x4E2A;&#x4FEE;&#x8BA2;&#x7248;&#x7684; <code>https://get.docker.com</code> &#x7684;&#x811A;&#x672C;&#x6765;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x5B98;&#x65B9;&#x7684; <code>https://get.docker.com</code> &#x5C06;&#x652F;&#x6301; <code>--mirror</code> &#x53C2;&#x6570;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x6E90;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x6301;&#x5FAE;&#x8F6F;&#x7684; Azure &#x4E91;&#xFF0C;&#xFF08;<a href="https://github.com/docker/docker/pull/28858" target="_blank" rel="noopener">&#x6216;&#x963F;&#x91CC;&#x4E91;&#xFF1F;&#xFF08;&#x66F4;&#x65B0;&#xFF1A;&#x7531;&#x4E8E;&#x963F;&#x91CC;&#x4E91;&#x955C;&#x50CF;&#x6E90;&#x4E0D;&#x652F;&#x6301; HTTPS&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x652F;&#x6301;&#x963F;&#x91CC;&#x4E91;&#xFF09;</a>&#xFF09;&#x3002;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure>
<p>&#x66FF;&#x6362;&#x4E3A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh -s -- --mirror AzureChinaCloud</span><br></pre></td></tr></table></figure>
<h2 id="zeng-jia-geng-duo-de-xi-tong-zhi-chi"><a href="#&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;" class="headerlink" title="&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;"></a>&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301; <a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi" class="header-anchor">#</a></h2><p>&#x5728;&#x8FD9;&#x6B21;&#x53D1;&#x5E03;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <a href="https://github.com/docker/docker/pull/27993" target="_blank" rel="noopener"><code>Ubuntu 16.10</code> &#x7684;&#x5B89;&#x88C5;&#x5305;</a>&#xFF0C;&#x800C;&#x4E14;&#x5BF9; <code>Ubuntu</code> &#x7CFB;&#x7EDF;&#x589E;&#x52A0;&#x4E86; <a href="https://github.com/docker/docker/pull/23438" target="_blank" rel="noopener"><code>PPC64LE</code></a> &#x548C; <a href="https://github.com/docker/docker/pull/26104" target="_blank" rel="noopener"><code>s390x</code></a> &#x6784;&#x67B6;&#x7684;&#x5B89;&#x88C5;&#x5305;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x4E86; <a href="https://github.com/docker/docker/pull/24116" target="_blank" rel="noopener"><code>VMWare Photon OS</code> &#x7CFB;&#x7EDF;</a>&#x7684; <code>RPM</code> &#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x4EE5;&#x53CA;&#x5728; <code>https://get.docker.com</code> &#x7684;&#x652F;&#x6301;&#x3002;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x4E86; <a href="https://github.com/docker/docker/pull/28222" target="_blank" rel="noopener"><code>Fedora 25</code></a>&#xFF0C;&#x751A;&#x81F3;&#x5F00;&#x59CB;&#x652F;&#x6301; <a href="https://github.com/docker/docker/pull/27625" target="_blank" rel="noopener"><code>arm64</code></a>&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x7ED3;&#x675F;&#xFF0C;&#x800C;&#x88AB;&#x79FB;&#x9664;&#x652F;&#x6301;&#xFF0C;&#x6BD4;&#x5982; <code>Ubuntu 15.10</code>&#x3001;<code>Fedora 22</code> &#x90FD;&#x4E0D;&#x5728;&#x652F;&#x6301;&#x4E86;&#x3002;</p>
<h1 id="wang-luo"><a href="#&#x7F51;&#x7EDC;" class="headerlink" title="&#x7F51;&#x7EDC;"></a>&#x7F51;&#x7EDC; <a href="#wang-luo" class="header-anchor">#</a></h1><h2 id="yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo"><a href="#&#x5141;&#x8BB8;-docker-run-&#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684;-swarm-mode-&#x7684;&#x7F51;&#x7EDC;" class="headerlink" title="&#x5141;&#x8BB8; docker run &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684;&#x7F51;&#x7EDC;"></a>&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC; <a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/25962" target="_blank" rel="noopener">https://github.com/docker/docker/pull/25962</a></p>
<p>&#x5728; Docker 1.12 &#x53D1;&#x5E03;&#x65B0;&#x7684; Swarm Mode &#x4E4B;&#x540E;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x95EE;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x5165; Swarm Mode &#x670D;&#x52A1;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E2D;&#x53BB;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#xFF0C;&#x56E0;&#x4E3A; <code>swarm</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x662F;&#x4E3A;&#x4E86; <code>swarm mode service</code> &#x51C6;&#x5907;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x66F4;&#x5065;&#x58EE;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker run</code>&#xFF0C;&#x4F1A;&#x7834;&#x574F;&#x4E86;&#x8FD9;&#x91CC;&#x9762;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5927;&#x5BB6;&#x9700;&#x6C42;&#x5F88;&#x591A;&#xFF0C;&#x4E8E;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x6298;&#x8877;&#x7684;&#x529E;&#x6CD5;&#x3002;1.13 &#x5141;&#x8BB8;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BBE;&#x5B9A;&#x8BE5;&#x7F51;&#x7EDC;&#x4E3A; <code>attachable</code>&#xFF0C;&#x5141;&#x8BB8;&#x4E4B;&#x540E;&#x7684; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x5230;&#x8BE5;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x3001;&#x4E0D;&#x5141;&#x8BB8;&#x4E4B;&#x540E; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay mynet1</span><br><span class="line">xmgoco2vfrtp0ggc5r0p5z4mg</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5141;&#x8BB8; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x4F7F;&#x7528; 1.13 &#x65B0;&#x52A0;&#x5165;&#x7684; <code>--attachable</code> &#x53C2;&#x6570;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay --attachable mynet2</span><br><span class="line">yvcyhoc6ni0436jux9azc4cjt</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x4E00;&#x4E2A; <code>web</code> &#x670D;&#x52A1;&#xFF0C;&#x8FDE;&#x5165;&#x8FD9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create \</span><br><span class="line">    --name web \</span><br><span class="line">    --network mynet1 \</span><br><span class="line">    --network mynet2 \</span><br><span class="line">    nginx</span><br><span class="line">vv91wd7166y80lbl833rugl2z</span><br></pre></td></tr></table></figure>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528; <code>docker run</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --network mynet1 busybox</span><br><span class="line">docker: Error response from daemon: Could not attach to network mynet1: rpc error: code = 7 desc = network mynet1 not manually attachable.</span><br></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E; <code>mynet1</code> &#x4E0D;&#x5141;&#x8BB8;&#x624B;&#x52A8; <code>attach</code> &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x62A5;&#x9519;&#x4E86;&#x3002;</p>
<p>&#x5728; 1.12 &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F1A;&#x62A5;&#x544A;&#x8BE5;&#x7F51;&#x7EDC;&#x65E0;&#x6CD5;&#x7ED9; <code>docker run</code> &#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: swarm-scoped network (mynet1) is not compatible with `docker create` or `docker run`. This network can only be used by a docker service.</span><br><span class="line">See <span class="string">&apos;docker run --help&apos;</span>.</span><br></pre></td></tr></table></figure>
<p><strong>&#x4E0D;&#x8FC7;&#xFF0C;<code>--attachable</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;&#x7F51;&#x7EDC;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x6253;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x7F3A;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;&#x7528;&#x6237;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#x3002;</strong></p>
<h2 id="yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou"><a href="#&#x5141;&#x8BB8;-docker-service-create-&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;" class="headerlink" title="&#x5141;&#x8BB8; docker service create &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;"></a>&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3; <a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27917" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27917</a><br><a href="https://github.com/docker/docker/pull/28943" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28943</a></p>
<p><code>docker service create</code> &#x4E2D;&#x7684; <code>--publish</code> &#x683C;&#x5F0F;&#x6709;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x53D8;&#x5316;&#x3002;&#xFF08;&#x5728; 1.13 &#x7684; RC &#x671F;&#x95F4;&#xFF0C;&#x66FE;&#x7ECF;&#x53BB;&#x6389; <code>--publish</code>&#xFF0C;&#x6539;&#x4E3A; <code>--port</code>&#xFF0C;&#x7ECF;&#x8FC7;&#x8BA8;&#x8BBA;&#x540E;&#xFF0C;&#x51B3;&#x5B9A;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; <code>--publish</code>&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;&#x65B0;&#x7684; <code>--port</code> &#x9009;&#x9879;&#x3002;&#xFF09;</p>
<p>&#x5728; 1.12 &#x4E2D;&#xFF0C;<code>docker service create</code> &#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x53C2;&#x6570; <code>--publish 80:80</code> &#x8FD9;&#x7C7B;&#x5F62;&#x5F0F;&#x6620;&#x5C04;<strong>&#x8FB9;&#x754C;(ingress)&#x7F51;&#x7EDC;</strong>&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6620;&#x5C04;&#x4F1A;&#x4EAB;&#x53D7;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4EE5;&#x53CA; routing mesh&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x53E6;&#x4E00;&#x79CD;&#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF0C;&#x88AB;&#x79F0;&#x4E3A; <code>host</code> &#x6A21;&#x5F0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7528;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x6620;&#x5C04;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x53EA;&#x4F1A;&#x6620;&#x5C04;&#x4E8E;&#x5BB9;&#x5668;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x3002;&#x8FD9;&#x5C31;&#x548C;&#x4E00;&#x4EE3; Swarm &#x4E2D;&#x4E00;&#x6837;&#x4E86;&#x3002;&#x867D;&#x7136;&#x5931;&#x53BB;&#x4E86;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9A;&#x4E86;&#x6620;&#x5C04;&#x70B9;&#xFF0C;&#x5728;&#x6709;&#x7684;&#x65F6;&#x5019;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;&#x9700;&#x8981;&#x7684;&#x3002;</p>
<p>&#x73B0;&#x5728; <code>--publish</code> &#x7684;&#x65B0;&#x7684;&#x53C2;&#x6570;&#x5F62;&#x5F0F;&#x548C; <code>--mount</code> &#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x53C2;&#x6570;&#x503C;&#x4E3A; <code>,</code> &#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x952E;&#x503C;&#x95F4;&#x4EE5; <code>=</code> &#x7B49;&#x53F7;&#x5206;&#x9694;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301; 4 &#x9879;&#x5185;&#x5BB9;&#xFF1A;</p>
<ul>
<li><code>protocol</code>&#xFF1A; &#x652F;&#x6301; <code>tcp</code> &#x6216;&#x8005; <code>udp</code></li>
<li><code>mode</code>&#xFF1A; &#x652F;&#x6301; <code>ingress</code> &#x6216;&#x8005; <code>host</code></li>
<li><code>target</code>&#xFF1A; &#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
<li><code>published</code>&#xFF1A; &#x6620;&#x5C04;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
</ul>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E0E; <code>-p 8080:80</code> &#x7B49;&#x6548;&#x7684; <code>--publish</code> &#x65B0;&#x683C;&#x5F0F;&#x9009;&#x9879;&#x4E3A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--publish protocol=tcp,mode=ingress,published=8080,target=80</span><br></pre></td></tr></table></figure>
<p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; <code>-p 8080:80</code>&#xFF0C;&#x4F46;&#x662F;&#x65B0;&#x7684;&#x9009;&#x9879;&#x683C;&#x5F0F;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x80FD;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F7F;&#x7528; 1.13 &#x5F00;&#x59CB;&#x52A0;&#x5165;&#x7684; <code>host</code> &#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@d1:~$ docker service create --name web \</span><br><span class="line">    --publish mode=host,published=80,target=80 \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@d1:~$ docker node ls</span><br><span class="line">ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS</span><br><span class="line">ntjybj51u6zp44akeawuf3i05    d2        Ready   Active</span><br><span class="line">tp7icvjzvxla2n18j3nztgjz6    d3        Ready   Active</span><br><span class="line">vyf3mgcj3uonrnh5xxquasp38 *  d1        Ready   Active        Leader</span><br><span class="line">ubuntu@d1:~$ docker service ps web</span><br><span class="line">ID            NAME    IMAGE         NODE  DESIRED STATE  CURRENT STATE          ERROR  PORTS</span><br><span class="line">5tij5sjvfpsf  web.1   nginx:latest  d3    Running        Running 5 minutes ago         *:80-&gt;80/tcp</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x96C6;&#x7FA4;&#x6709;3&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x5C31;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x8DD1;&#x5230;&#x4E86; <code>d3</code> &#x4E0A;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x4EE5;&#x524D;&#x7684;&#x4F7F;&#x7528;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x7F51;&#x7EDC; <code>ingress</code> &#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#x90FD;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;<code>host</code> &#x6A21;&#x5F0F;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x53EA;&#x6620;&#x5C04;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC; <code>curl d1</code> &#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x4EC0;&#x4E48;&#x770B;&#x4E0D;&#x5230;&#x7F51;&#x9875;&#xFF0C;&#x800C; <code>curl d3</code> &#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@d1:~$ curl localhost</span><br><span class="line">curl: (7) Failed to connect to localhost port 80: Connection refused</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@d3:~$ curl localhost</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><a href="#iptables-&#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;" class="headerlink" title="iptables &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;"></a><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD; <a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28257" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28257</a></p>
<p>&#x4ECE;&#x9ED8;&#x8BA4; <code>FORWARD</code> &#x6539;&#x4E3A; <code>DROP</code>&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;<a href="https://github.com/docker/docker/issues/14041" target="_blank" rel="noopener">&#x5BB9;&#x5668;&#x5916;&#x9732;&#x7684;&#x5B89;&#x5168;&#x95EE;&#x9898;</a>&#x3002;</p>
<h2 id="zai-docker-network-inspect-li-xian-shi-lian-ru-de-jie-dian"><a href="#&#x5728;-docker-network-inspect-&#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9;" class="headerlink" title="&#x5728; docker network inspect &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9;"></a>&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9; <a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-de-jie-dian" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x77E5;&#x9053;&#xFF0C;&#x5728; <code>swarm mode</code> &#x4E2D;&#x521B;&#x5EFA;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E0B;&#x5B50;&#x5C31;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A; <code>docker network ls</code> &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x4F7F;&#x7528;&#x8BE5;&#x7F51;&#x7EDC;&#x7684;&#x5BB9;&#x5668;&#x8C03;&#x5EA6;&#x5230;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x540E;&#xFF0C;&#x624D;&#x4F1A;&#x5C06;&#x8BE5;&#x8282;&#x70B9;&#x8FDE;&#x5165;&#x6B64; <code>overlay</code> &#x7F51;&#x7EDC;&#x3002;&#x5728;&#x7F51;&#x7EDC;&#x6392;&#x969C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x6709;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x5F97;&#x77E5;&#x73B0;&#x5728;&#x8FDE;&#x5165;&#x8BE5; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x5230;&#x5E95;&#x6709;&#x54EA;&#x4E9B;&#xFF0C;&#x8FD9;&#x5728; <code>1.13</code> &#x4E4B;&#x524D;&#x4E0D;&#x5BB9;&#x6613;&#x505A;&#x5230;&#x3002;</p>
<p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;<code>docker network inspect</code> &#x5C06;&#x663E;&#x793A;&#x8FDE;&#x63A5;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#x8282;&#x70B9;&#xFF08;&#x5BBF;&#x4E3B;&#xFF09;&#x6709;&#x54EA;&#x4E9B;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">   {</span><br><span class="line">       <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;jjpnbdh8vu4onjojskntd2jhh&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2017-01-18T00:00:31.742146058Z&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;swarm&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay&quot;</span>,</span><br><span class="line">       <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;IPAM&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">           <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">               {</span><br><span class="line">                   <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;10.0.0.0/24&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;10.0.0.1&quot;</span></span><br><span class="line">               }</span><br><span class="line">           ]</span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;Containers&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;3cafea27c53de34724e46d4fe83c9e60311b628b82e9be66d8d2e0812669d575&quot;</span>: {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;myapp.2.qz2hs1eqq3ikx59ydh0w7u1g4&quot;</span>,</span><br><span class="line">               <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;0e26b08254e851b7b238215cec07acdd8b0b68dc4671f55235e203a0c260522f&quot;</span>,</span><br><span class="line">               <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:0a:00:00:04&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;10.0.0.4/24&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">           }</span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Options&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;com.docker.network.driver.overlay.vxlanid_list&quot;</span>: <span class="string">&quot;4097&quot;</span></span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Labels&quot;</span>: {},</span><br><span class="line">       <span class="string">&quot;Peers&quot;</span>: [</span><br><span class="line">           {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;d1-23348b84b134&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;138.197.213.116&quot;</span></span><br><span class="line">           },</span><br><span class="line">           {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;d2-8964dea9e75c&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;138.197.221.47&quot;</span></span><br><span class="line">           }</span><br><span class="line">       ]</span><br><span class="line">   }</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x4E00;&#x5171;&#x6709;&#x4E24;&#x4E2A;&#x5BBF;&#x4E3B;&#x8FDE;&#x5165;&#x4E86;&#x8FD9;&#x4E2A; <code>mynet</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5206;&#x522B;&#x4E3A; <code>138.197.213.116</code> &#x548C; <code>138.197.221.47</code>&#x3002;</p>
<h2 id="yun-xu-service-vip-ke-yi-bei-ping"><a href="#&#x5141;&#x8BB8;-service-VIP-&#x53EF;&#x4EE5;&#x88AB;-ping" class="headerlink" title="&#x5141;&#x8BB8; service VIP &#x53EF;&#x4EE5;&#x88AB; ping"></a>&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code> <a href="#yun-xu-service-vip-ke-yi-bei-ping" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28019" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28019</a></p>
<p>&#x5728; 1.12 &#x7684;&#x4E8C;&#x4EE3; Swarm &#x6392;&#x969C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;<a href="https://github.com/docker/docker/issues/25497" target="_blank" rel="noopener">&#x8DE8;&#x8282;&#x70B9;&#x7684;&#x670D;&#x52A1; VIP &#x4E0D;&#x53EF;&#x4EE5; <code>ping</code></a>&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x641E;&#x4E0D;&#x61C2;&#x662F; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E0D;&#x901A;&#x5462;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x6CA1;&#x8D77;&#x6765;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6709;&#x95EE;&#x9898;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728; 1.13 &#x89E3;&#x51B3;&#x4E86;&#xFF0C;VIP &#x53EF;&#x4EE5;&#x968F;&#x4FBF; <code>ping</code>&#xFF0C;&#x8DE8;&#x5BBF;&#x4E3B;&#x4E5F;&#x6CA1;&#x5173;&#x7CFB;&#x3002;</p>
<h1 id="cha-jian"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6; <a href="#cha-jian" class="header-anchor">#</a></h1><h2 id="cha-jian-gong-neng-zheng-shi-qi-yong"><a href="#&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;" class="headerlink" title="&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;"></a>&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528; <a href="#cha-jian-gong-neng-zheng-shi-qi-yong" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28226" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28226</a></p>
<p>&#x5728; 1.12 &#x5F15;&#x5165;&#x4E86;&#x63D2;&#x4EF6;&#x6982;&#x5FF5;&#x540E;&#xFF0C;&#x4F5C;&#x4E3A;&#x8BD5;&#x9A8C;&#x7279;&#x6027;&#x5F97;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5173;&#x6CE8;&#x3002;&#x5305;&#x62EC; <a href="https://store.docker.com/" target="_blank" rel="noopener">Docker Store</a> &#x5F00;&#x59CB;&#x51C6;&#x5907;&#x4E0A;&#x7EBF;&#xFF0C;&#x4EE5;&#x53CA;&#x7B2C;&#x4E09;&#x65B9;&#x7684;&#x63D2;&#x4EF6;&#x7684;&#x5F00;&#x53D1;&#x3002;&#x73B0;&#x5728; 1.13 &#x63D2;&#x4EF6;&#x4F5C;&#x4E3A;&#x6B63;&#x5F0F;&#x529F;&#x80FD;&#x63D0;&#x4F9B;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ docker plugin</span><br><span class="line"></span><br><span class="line">Usage:	docker plugin COMMAND</span><br><span class="line"></span><br><span class="line">Manage plugins</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a plugin from a rootfs and config</span><br><span class="line">  <span class="built_in">disable</span>     Disable a plugin</span><br><span class="line">  <span class="built_in">enable</span>      Enable a plugin</span><br><span class="line">  inspect     Display detailed information on one or more plugins</span><br><span class="line">  install     Install a plugin</span><br><span class="line">  ls          List plugins</span><br><span class="line">  push        Push a plugin to a registry</span><br><span class="line">  rm          Remove one or more plugins</span><br><span class="line">  <span class="built_in">set</span>         Change settings <span class="keyword">for</span> a plugin</span><br><span class="line"></span><br><span class="line">Run <span class="string">&apos;docker plugin COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure>
<p>&#x76F8;&#x6BD4;&#x4E8E; 1.12 &#x7684;&#x8BD5;&#x9A8C;&#x7248;&#x672C;&#x800C;&#x8A00;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x589E;&#x52A0;&#x4E86; <code>docker plugin create</code> &#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6709; <code>config.json</code> &#x6587;&#x4EF6;&#x548C; <code>rootfs</code> &#x76EE;&#x5F55;&#x7684;&#x76EE;&#x5F55;&#x6765;&#x521B;&#x5EFA;&#x63D2;&#x4EF6;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ls -ls /home/pluginDir</span><br><span class="line"></span><br><span class="line">4 -rw-r--r--  1 root root 431 Nov  7 01:40 config.json</span><br><span class="line">0 drwxr-xr-x 19 root root 420 Nov  7 01:40 rootfs</span><br><span class="line"></span><br><span class="line">$ docker plugin create plugin /home/pluginDir</span><br><span class="line">plugin</span><br><span class="line"></span><br><span class="line">$ docker plugin ls</span><br><span class="line">ID                  NAME                TAG                 DESCRIPTION                  ENABLED</span><br><span class="line">672d8144ec02        plugin              latest              A sample plugin <span class="keyword">for</span> Docker   <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h1 id="ming-ling-xing"><a href="#&#x547D;&#x4EE4;&#x884C;" class="headerlink" title="&#x547D;&#x4EE4;&#x884C;"></a>&#x547D;&#x4EE4;&#x884C; <a href="#ming-ling-xing" class="header-anchor">#</a></h1><h2 id="checkpoint-gong-neng-shi-yan-gong-neng"><a href="#checkpoint-&#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;" class="headerlink" title="checkpoint &#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;"></a><code>checkpoint</code> &#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09; <a href="#checkpoint-gong-neng-shi-yan-gong-neng" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/22049" target="_blank" rel="noopener">https://github.com/docker/docker/pull/22049</a></p>
<p><code>checkpoint</code> &#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x5C06;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x72B6;&#x6001;&#x51BB;&#x7ED3;&#x5E76;&#x4FDD;&#x5B58;&#x4E3A;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;&#x5C06;&#x6765;&#x53EF;&#x4EE5;&#x4ECE;&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x6062;&#x590D;&#x6B64;&#x65F6;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>
<h3 id="zhun-bei-gong-zuo"><a href="#&#x51C6;&#x5907;&#x5DE5;&#x4F5C;" class="headerlink" title="&#x51C6;&#x5907;&#x5DE5;&#x4F5C;"></a>&#x51C6;&#x5907;&#x5DE5;&#x4F5C; <a href="#zhun-bei-gong-zuo" class="header-anchor">#</a></h3><p>&#x76EE;&#x524D;&#x5B83;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x662F; <code>criu</code> &#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x56E0;&#x6B64;&#x5728; Linux &#x4E0A;&#x9700;&#x8981;&#x5148;&#x5B89;&#x88C5;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#xFF08;&#x76EE;&#x524D;&#x5C1A;&#x65E0;&#x6CD5;&#x5728; Docker for Mac &#x4E2D;&#x4F7F;&#x7528; <a href="https://github.com/docker/for-mac/issues/1059" target="_blank" rel="noopener">docker/for-mac#1059</a>)</p>
<p>&#x5982;&#x679C;&#x672A;&#x5B89;&#x88C5; <code>criu</code> &#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x5982;&#x4E0B;&#x62A5;&#x9519;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: Cannot checkpoint container myapp1: rpc error: code = 2 desc = <span class="built_in">exit</span> status 1: <span class="string">&quot;Unable to execute CRIU command: criu\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>&#x5BF9;&#x4E8E; Ubuntu &#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5B89;&#x88C5; <code>criu</code>&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y criu</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x662F;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5728; <code>docker.service</code> &#x4E2D; <code>ExecStart=</code> &#x8FD9;&#x884C;&#x540E;&#x9762;&#x6DFB;&#x52A0; <code>--experimental</code> &#x9009;&#x9879;&#x3002;&#x5176;&#x5B83;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#x4E5F;&#x9700;&#x5982;&#x6B64;&#x914D;&#x7F6E;&#x3002;</p>
</blockquote>
<p>&#x7136;&#x540E;&#x4E0D;&#x8981;&#x5FD8;&#x4E86; <code>systemctl daemon-reload</code> &#x548C; <code>systemctl restart docker</code>&#x3002;</p>
<h3 id="chuang-jian-checkpoint-ji-hui-fu"><a href="#&#x521B;&#x5EFA;-Checkpoint-&#x53CA;&#x6062;&#x590D;" class="headerlink" title="&#x521B;&#x5EFA; Checkpoint &#x53CA;&#x6062;&#x590D;"></a>&#x521B;&#x5EFA; Checkpoint &#x53CA;&#x6062;&#x590D; <a href="#chuang-jian-checkpoint-ji-hui-fu" class="header-anchor">#</a></h3><p>&#x6267;&#x884C; <code>docker checkpoint create</code> &#x5C31;&#x53EF;&#x4EE5;&#x4E3A;&#x5BB9;&#x5668;&#x521B;&#x5EFA; <code>checkpoint</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker checkpoint create myapp1 checkpoint1</span><br><span class="line">checkpoint1</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x4E3A;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x591A;&#x4E2A; <code>checkpoint</code>&#xFF0C;&#x6BCF;&#x4E2A;&#x8D77;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x5B57;&#x5C31;&#x662F;&#x4E86;&#x3002;</p>
<p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7528; <code>docker checkpoint ls</code> &#x6765;&#x5217;&#x51FA;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684; <code>checkpoint</code>&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker checkpoint ls myapp1</span><br><span class="line">CHECKPOINT NAME</span><br><span class="line">checkpoint1</span><br></pre></td></tr></table></figure>
<p><em>&#x5982;&#x679C;&#x4E0D;&#x52A0; <code>--leave-running</code> &#x53C2;&#x6570;&#x7684;&#x8BDD;&#xFF0C;&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x5728;&#x521B;&#x5EFA;&#x5B8C; <code>checkpoint</code> &#x5C31;&#x4F1A;&#x88AB;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#x3002;</em></p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker start --checkpoint</code> &#x6765;&#x4ECE;&#x67D0;&#x4E2A; <code>checkpoint</code> &#x6062;&#x590D;&#x8FD0;&#x884C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start --checkpoint checkpoint1 myapp1</span><br></pre></td></tr></table></figure>
<p>&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x4ECE; <code>checkpoint1</code> &#x8FD9;&#x4E2A;&#x70B9;&#x6062;&#x590D;&#x5E76;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x5907;&#x4EFD;&#x65F6;&#x53EF;&#x4EE5;&#x7528; <code>--checkpoint-dir</code> &#x6307;&#x5B9A;&#x5177;&#x4F53;&#x7684;&#x4FDD;&#x5B58; <code>checkpoint</code> &#x7684;&#x76EE;&#x5F55;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker checkpoint create --checkpoint-dir <span class="variable">$PWD</span>/backup --leave-running myapp1 checkpoint1</span><br><span class="line">checkpoint1</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; <code>backup</code> &#x4E2D;&#x770B;&#x5230;&#x5B9E;&#x9645;&#x4FDD;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ tree backup/</span><br><span class="line">backup/</span><br><span class="line">&#x2514;&#x2500;&#x2500; checkpoint1</span><br><span class="line">   &#x251C;&#x2500;&#x2500; cgroup.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; config.json</span><br><span class="line">   &#x251C;&#x2500;&#x2500; core-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; core-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; criu.work</span><br><span class="line">   &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; dump.log</span><br><span class="line">   &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; stats-dump</span><br><span class="line">   &#x251C;&#x2500;&#x2500; descriptors.json</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fdinfo-2.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fdinfo-3.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fs-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fs-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ids-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ids-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; inventory.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ip6tables-9.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ipcns-var-10.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; iptables-9.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; mm-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; mm-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; mountpoints-12.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pagemap-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pagemap-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pages-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pages-2.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pipes-data.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pipes.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pstree.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; reg-files.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; seccomp.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; sigacts-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; sigacts-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; tmpfs-dev-46.tar.gz.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; tmpfs-dev-49.tar.gz.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; tmpfs-dev-50.tar.gz.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; unixsk.img</span><br><span class="line">   &#x2514;&#x2500;&#x2500; utsns-11.img</span><br></pre></td></tr></table></figure>
<h2 id="docker-stats-zhong-yu-ke-yi-xian-shi-rong-qi-ming-liao"><a href="#docker-stats-&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86;" class="headerlink" title="docker stats &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86;"></a><code>docker stats</code> &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86; <a href="#docker-stats-zhong-yu-ke-yi-xian-shi-rong-qi-ming-liao" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27797" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27797</a><br><a href="https://github.com/docker/docker/pull/24987" target="_blank" rel="noopener">https://github.com/docker/docker/pull/24987</a></p>
<p><code>docker stats</code> &#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x7684;&#x8D44;&#x6E90;&#x5360;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x7528;&#x6765;&#x5206;&#x6790;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x5F00;&#x9500;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x3002;&#x4E0D;&#x8FC7;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x6709;&#x4E2A;&#x5F88;&#x8BA8;&#x538C;&#x7684;&#x95EE;&#x9898;&#xFF0C;<code>docker stats</code> &#x4E0D;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats</span><br><span class="line">CONTAINER           CPU %               MEM USAGE / LIMIT       MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">e8cb2945b156        0.00%               1.434 MiB / 488.4 MiB   0.29%               1.3 kB / 648 B      12.3 kB / 0 B       2</span><br><span class="line">61aada055db8        0.00%               3.598 MiB / 488.4 MiB   0.74%               1.3 kB / 1.3 kB     2.29 MB / 0 B       2</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x8BA9;&#x4EBA;&#x6839;&#x672C;&#x6CA1;&#x529E;&#x6CD5;&#x77E5;&#x9053;&#x5230;&#x5E95;&#x8C01;&#x662F;&#x8C01;&#x3002;&#x4E8E;&#x662F;&#x6709;&#x5404;&#x79CD;<a href="https://github.com/docker/docker/issues/20973" target="_blank" rel="noopener">&#x53D8;&#x901A;&#x7684;&#x529E;&#x6CD5;</a>&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats $(docker ps --format={{.Names}})</span><br></pre></td></tr></table></figure>
<p>&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x5217;&#x8868;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x589E;&#x52A0;&#x3001;&#x5220;&#x9664;&#x90FD;&#x5F97;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x3002;</p>
<p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x867D;&#x7136;&#x4F9D;&#x65E7;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x4F46;&#x662F;&#x589E;&#x52A0;&#x4E86; <code>--format</code> &#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x8BBE;&#x8BA1;&#x8F93;&#x51FA;&#x683C;&#x5F0F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats --format <span class="string">&apos;table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}\t{{.NetIO}}\t{{.BlockIO}}\t{{.PIDs}}&apos;</span></span><br><span class="line">NAME                               CPU %               MEM USAGE / LIMIT       MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">app2.1.5tij5sjvfpsft2lctxh8m8trn   0.00%               1.434 MiB / 488.4 MiB   0.29%               1.3 kB / 648 B      12.3 kB / 0 B       2</span><br><span class="line">app1.1.mjmb8b0f0w5sy2v41jth3v9s4   0.00%               3.598 MiB / 488.4 MiB   0.74%               1.3 kB / 1.3 kB     2.29 MB / 0 B       2</span><br></pre></td></tr></table></figure>
<h2 id="gei-docker-ps-zeng-jia-is-task-guo-lu-qi"><a href="#&#x7ED9;-docker-ps-&#x589E;&#x52A0;-is-task-&#x8FC7;&#x6EE4;&#x5668;" class="headerlink" title="&#x7ED9; docker ps &#x589E;&#x52A0; is-task &#x8FC7;&#x6EE4;&#x5668;"></a>&#x7ED9; <code>docker ps</code> &#x589E;&#x52A0; <code>is-task</code> &#x8FC7;&#x6EE4;&#x5668; <a href="#gei-docker-ps-zeng-jia-is-task-guo-lu-qi" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/24411" target="_blank" rel="noopener">https://github.com/docker/docker/pull/24411</a></p>
<p>&#x5F00;&#x59CB;&#x4F7F;&#x7528; Swarm Mode &#x540E;&#xFF0C;&#x7ECF;&#x5E38;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#xFF0C;<code>docker ps</code> &#x6240;&#x770B;&#x5230;&#x7684;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x5230;&#x5E95;&#x54EA;&#x4E9B;&#x662F;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#xFF1F;&#x54EA;&#x4E9B;&#x662F; <code>docker run</code> &#x8DD1;&#x8D77;&#x6765;&#x7684;&#x5355;&#x72EC;&#x7684;&#x5BB9;&#x5668;&#xFF1F;</p>
<p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <code>is-task</code> &#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x4EE5;&#x533A;&#x5206;&#x666E;&#x901A;&#x5BB9;&#x5668;&#x548C; Swarm Mode &#x7684;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps -f <span class="string">&apos;is-task=true&apos;</span></span><br><span class="line">CONTAINER ID        IMAGE                                                                           COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">cdf0d35db1d3        nginx@sha256:33ff28a2763feccc1e1071a97960b7fef714d6e17e2d0ff573b74825d0049303   <span class="string">&quot;nginx -g &apos;daemon ...&quot;</span>   44 seconds ago      Up 44 seconds       80/tcp, 443/tcp     myservice.1.6rdwhkb84j6ioyqlvk6h6bql8</span><br></pre></td></tr></table></figure>
<h2 id="zai-ye-bu-hui-chu-xian-ke-hu-duan-he-fu-wu-duan-bu-tong-ban-ben-dao-zhi-de-cuo-wu-liao"><a href="#&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86;" class="headerlink" title="&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86;"></a>&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86; <a href="#zai-ye-bu-hui-chu-xian-ke-hu-duan-he-fu-wu-duan-bu-tong-ban-ben-dao-zhi-de-cuo-wu-liao" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27745" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27745</a></p>
<p>&#x5728;&#x4EE5;&#x524D;&#xFF0C;docker &#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x5FC5;&#x987B;&#x7248;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x4F1A;&#x62A5; <code>Client and server don&apos;t have the same version</code> &#x8FD9;&#x7C7B;&#x9519;&#x8BEF;&#x3002;&#x540E;&#x6765;&#x589E;&#x52A0;&#x4E86; <code>DOCKER_API_VERSION</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x9AD8;&#x4E8E;&#x670D;&#x52A1;&#x7AEF;&#x7248;&#x672C;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x7AEF; API &#x7248;&#x672C;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x8FD9;&#x7C7B;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x7248;&#x672C;&#x5224;&#x65AD;&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4ECE;&#x800C;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x7248;&#x672C;&#x4E0D;&#x4E00;&#x81F4;&#x800C;&#x62A5;&#x9519;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      1.13.0-dev</span><br><span class="line"> API version:  1.24 (downgraded from 1.25)</span><br><span class="line"> Go version:   go1.7.3</span><br><span class="line"> Git commit:   ec3a34b</span><br><span class="line"> Built:        Wed Oct 26 00:54:51 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      1.12.2</span><br><span class="line"> API version:  1.24</span><br><span class="line"> Go version:   go1.6.3</span><br><span class="line"> Git commit:   bb80604</span><br><span class="line"> Built:        Tue Oct 11 17:00:50 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"> Experimental: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="docker-inspect-jiang-ke-yi-cha-kan-ren-he-docker-dui-xiang"><a href="#docker-inspect-&#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55;-docker-&#x5BF9;&#x8C61;" class="headerlink" title="docker inspect &#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; docker &#x5BF9;&#x8C61;"></a><code>docker inspect</code> &#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; docker &#x5BF9;&#x8C61; <a href="#docker-inspect-jiang-ke-yi-cha-kan-ren-he-docker-dui-xiang" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/23614" target="_blank" rel="noopener">https://github.com/docker/docker/pull/23614</a></p>
<p>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5F88;&#x719F;&#x6089; <code>docker inspect</code>&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x7528;&#x5B83;&#x67E5;&#x770B;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3002;&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x8FD9;&#x5C06;&#x53D8;&#x7684;&#x66F4;&#x9AD8;&#x7EA7;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; Docker &#x5BF9;&#x8C61;&#x3002;&#x4ECE;&#x7F51;&#x7EDC;&#x3001;task&#x3001;service&#x3001;volume&#x5230;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x7528; <code>docker service ps</code> &#x5217;&#x51FA;&#x4E86;&#x670D;&#x52A1;&#x5BF9;&#x5E94;&#x7684; <code>task</code> &#x5217;&#x8868;&#xFF0C;&#x5F97;&#x5230; <code>task id</code> &#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker inspect</code> &#x8FD9;&#x4E2A; <code>task id</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps myservice</span><br><span class="line">ID            NAME         IMAGE         NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS</span><br><span class="line">6rdwhkb84j6i  myservice.1  nginx:latest  d1    Running        Running 13 minutes ago</span><br><span class="line">$ docker inspect 6rdwhkb84j6i</span><br><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        <span class="string">&quot;ID&quot;</span>: <span class="string">&quot;6rdwhkb84j6ioyqlvk6h6bql8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: {</span><br><span class="line">            <span class="string">&quot;Index&quot;</span>: 17</span><br><span class="line">        },</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2017-01-18T14:40:40.959516063Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;UpdatedAt&quot;</span>: <span class="string">&quot;2017-01-18T14:40:52.302378995Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Spec&quot;</span>: {</span><br><span class="line">            <span class="string">&quot;ContainerSpec&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;nginx:latest@sha256:33ff28a2763feccc1e1071a97960b7fef714d6e17e2d0ff573b74825d0049303&quot;</span>,</span><br><span class="line">                <span class="string">&quot;DNSConfig&quot;</span>: {}</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;Resources&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;Limits&quot;</span>: {},</span><br><span class="line">                <span class="string">&quot;Reservations&quot;</span>: {}</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;Condition&quot;</span>: <span class="string">&quot;any&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaxAttempts&quot;</span>: 0</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;Placement&quot;</span>: {},</span><br><span class="line">            <span class="string">&quot;ForceUpdate&quot;</span>: 0</span><br><span class="line">        },</span><br><span class="line">        <span class="string">&quot;ServiceID&quot;</span>: <span class="string">&quot;u7bidaojbndhrsgyj29unv4wg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Slot&quot;</span>: 1,</span><br><span class="line">        <span class="string">&quot;NodeID&quot;</span>: <span class="string">&quot;5s5nvnif1i4frentwidiu97mn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Status&quot;</span>: {</span><br><span class="line">            <span class="string">&quot;Timestamp&quot;</span>: <span class="string">&quot;2017-01-18T14:40:52.252715087Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;State&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Message&quot;</span>: <span class="string">&quot;started&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ContainerStatus&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;ContainerID&quot;</span>: <span class="string">&quot;cdf0d35db1d37266af56b59dd8c3cd54de46442987e25e6fd25d38da1da7e459&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PID&quot;</span>: 6563</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;PortStatus&quot;</span>: {}</span><br><span class="line">        },</span><br><span class="line">        <span class="string">&quot;DesiredState&quot;</span>: <span class="string">&quot;running&quot;</span></span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h1 id="yun-xing-shi"><a href="#&#x8FD0;&#x884C;&#x65F6;" class="headerlink" title="&#x8FD0;&#x884C;&#x65F6;"></a>&#x8FD0;&#x884C;&#x65F6; <a href="#yun-xing-shi" class="header-anchor">#</a></h1><h2 id="bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu"><a href="#&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;-experimental-&#x53C2;&#x6570;" class="headerlink" title="&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; --experimental &#x53C2;&#x6570;"></a>&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570; <a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27223" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27223</a></p>
<p>&#x4EE5;&#x524D;&#x6211;&#x4EEC;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x6D4B;&#x8BD5;&#x5F53;&#x524D;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x5FC5;&#x987B;&#x6DFB;&#x52A0;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x6E90;&#xFF0C;&#x91CD;&#x88C5; <code>docker</code>&#x3002;&#x8FD9;&#x7ED9;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x5E26;&#x6765;&#x4E86;&#x56F0;&#x96BE;&#x3002;&#x73B0;&#x5728;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x4E0D;&#x5728;&#x5206;&#x4E3A;&#x4E24;&#x7EC4;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6784;&#x5EFA;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x76F4;&#x63A5;&#x5728; <code>dockerd</code> &#x540E;&#x6DFB;&#x52A0; <code>--experimental</code> &#x5373;&#x53EF;&#x3002;</p>
<h2 id="zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e"><a href="#&#x5728;-overlay2-&#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E;-xfs-&#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;" class="headerlink" title="&#x5728; overlay2 &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; xfs &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;"></a>&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D; <a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/24771" target="_blank" rel="noopener">https://github.com/docker/docker/pull/24771</a></p>
<p>&#x5728; 1.13 &#x4E4B;&#x524D;&#xFF0C;&#x53EA;&#x6709;&#x5757;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9A71;&#x52A8;&#xFF08;&#x5982; <code>devicemapper</code>, <code>xfs</code>, <code>zfs</code>&#x7B49;&#xFF09;&#x652F;&#x6301;&#x78C1;&#x76D8;&#x914D;&#x989D;&#x80FD;&#x529B;&#xFF0C;&#x800C;&#x6240;&#x6709; <code>Union FS</code> &#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x914D;&#x989D;&#x3002;&#x73B0;&#x5728;&#x9488;&#x5BF9;&#x4F7F;&#x7528; <code>XFS</code> &#x4E3A;&#x540E;&#x7AEF;&#x7684; <code>overlay2</code> &#x9A71;&#x52A8;&#x652F;&#x6301;&#x4E86;&#x78C1;&#x76D8;&#x914D;&#x989D;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x5C06;&#x6765;&#x79FB;&#x690D;&#x5230; <code>AUFS</code>&#x3002;</p>
<h2 id="zeng-jia-docker-system-ming-ling"><a href="#&#x589E;&#x52A0;-docker-system-&#x547D;&#x4EE4;" class="headerlink" title="&#x589E;&#x52A0; docker system &#x547D;&#x4EE4;"></a>&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4; <a href="#zeng-jia-docker-system-ming-ling" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26108" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26108</a><br><a href="https://github.com/docker/docker/pull/27525" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27525</a></p>
<p>&#x5F88;&#x591A;&#x4EBA;&#x5728;&#x4EE5;&#x524D;&#x641E;&#x4E0D;&#x61C2;&#x81EA;&#x5DF1;&#x7684;&#x955C;&#x50CF;&#x5230;&#x5E95;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3001;&#x5BB9;&#x5668;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#xFF0C;&#x5377;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3002;&#x600E;&#x4E48;&#x5220;&#x9664;&#x4E0D;&#x7528;&#x7684;&#x4E1C;&#x897F;&#x4EE5;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>system</code> &#x547D;&#x4EE4;&#x6765;&#x5E2E;&#x52A9;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker system</span><br><span class="line"></span><br><span class="line">Usage:	docker system COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">     --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"> df          Show docker disk usage</span><br><span class="line"> events      Get real time events from the server</span><br><span class="line"> info        Display system-wide information</span><br><span class="line"> prune       Remove unused data</span><br><span class="line"></span><br><span class="line">Run <span class="string">&apos;docker system COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure>
<p><code>docker system df</code> &#x662F;&#x663E;&#x793A;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker system df</span><br><span class="line">TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE</span><br><span class="line">Images              3                   3                   700.3 MB            123 MB (17%)</span><br><span class="line">Containers          3                   3                   15 B                0 B (0%)</span><br><span class="line">Local Volumes       1                   1                   219.4 MB            0 B (0%)</span><br></pre></td></tr></table></figure>
<p>&#x663E;&#x793A;&#x7684;&#x5217;&#x8868;&#x4E2D;&#x5217;&#x51FA;&#x4E86;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x672C;&#x5730;&#x5377;&#x6240;&#x5360;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x80FD;&#x56DE;&#x6536;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x955C;&#x50CF;&#x6709; 123MB &#x7684;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x56DE;&#x6536;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;<code>docker</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>prune</code> &#x547D;&#x4EE4;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li><code>docker image prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;</li>
<li><code>docker container prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5BB9;&#x5668;</li>
<li><code>docker volume prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5377;</li>
<li><code>docker network prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x7F51;&#x7EDC;</li>
<li><code>docker system prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x5377;&#x3001;&#x7F51;&#x7EDC;</li>
</ul>
<p>&#x8FD8;&#x8BB0;&#x5F97;&#x4E4B;&#x524D;&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x6240;&#x7528;&#x7684; <code>docker rmi $(docker images -f dangling=true -aq)</code> &#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#x4E48;&#xFF1F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730; <code>docker image prune</code> &#x5373;&#x53EF;&#x5220;&#x9664;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x4ECE;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x547D;&#x4EE4;&#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x4E86;&#x3002;&#x4E4B;&#x524D;&#x9ED8;&#x8BA4;&#x7684; <code>docker info</code>&#xFF0C;<code>docker ps</code>&#xFF0C;<code>docker rm</code>&#xFF0C;<code>docker run</code> &#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5BF9;&#x5E94;&#x7684; <code>docker image</code>, <code>docker container</code>, <code>docker system</code> &#x4E0B;&#x4E86;&#x3002;&#x76EE;&#x524D;&#x4E4B;&#x524D;&#x7684;&#x547D;&#x4EE4;&#x4F9D;&#x65E7;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x4F1A;&#x7EE7;&#x7EED;&#x4FDD;&#x6301;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x662F;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x7684;&#x7248;&#x672C;&#x4E86;&#x3002;</p>
<h2 id="ti-sheng-overlay2-de-you-xian-ji"><a href="#&#x63D0;&#x5347;-overlay2-&#x7684;&#x4F18;&#x5148;&#x7EA7;" class="headerlink" title="&#x63D0;&#x5347; overlay2 &#x7684;&#x4F18;&#x5148;&#x7EA7;"></a>&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7; <a href="#ti-sheng-overlay2-de-you-xian-ji" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27932" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27932</a></p>
<p>&#x7531;&#x4E8E; <code>overlay2</code> &#x5728; 4.+ &#x5185;&#x6838;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;&#x8D8B;&#x4E8E;&#x7A33;&#x5B9A;&#xFF0C;&#x56E0;&#x6B64;&#x5C06;&#x5176;&#x4F18;&#x5148;&#x7EA7;&#x63D0;&#x5230; <code>devicemapper</code> &#x4E4B;&#x4E0A;&#xFF08;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#x7684;&#x4F9D;&#x65E7;&#x662F; <code>aufs</code>&#xFF09;</p>
<h2 id="docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><a href="#docker-exec-t-&#x81EA;&#x52A8;&#x6DFB;&#x52A0;-TERM-&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="headerlink" title="docker exec -t &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;"></a><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF; <a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26461" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26461</a></p>
<p>&#x5BF9;&#x4E8E;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528; <code>vi</code>&#x3001;<code>htop</code> &#x4E4B;&#x7C7B;&#x5DE5;&#x5177;&#x7684;&#x4EBA;&#x6765;&#x8BF4;&#x662F;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x7684;&#x3002;&#x4E4B;&#x524D;&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5B9A;&#x4E49; <code>TERM</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x9700;&#x8981;&#x7EC8;&#x7AEF;&#x9875;&#x9762;&#x5E03;&#x5C40;&#x7684;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x53EF;&#x80FD;&#x4F1A;&#x4E0D;&#x6B63;&#x5E38;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ htop</span><br><span class="line">Error opening terminal: unknown.</span><br></pre></td></tr></table></figure>
<p>&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x4E3A; <code>docker exec -t</code> &#x9009;&#x9879;&#x6DFB;&#x52A0;&#x4E86;&#x7EE7;&#x627F;&#x81EA;&#x5F53;&#x524D;&#x7684; <code>TERM</code> &#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;&#x7C7B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="windows-nei-zhi-de-yun-xing-windows-cheng-xu-de-docker-on-windows-de-gai-jin"><a href="#Windows-&#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C;-Windows-&#x7A0B;&#x5E8F;&#x7684;-Docker-on-Windows-&#x7684;&#x6539;&#x8FDB;" class="headerlink" title="Windows &#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x7684; Docker on Windows &#x7684;&#x6539;&#x8FDB;"></a>Windows &#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x7684; Docker on Windows &#x7684;&#x6539;&#x8FDB; <a href="#windows-nei-zhi-de-yun-xing-windows-cheng-xu-de-docker-on-windows-de-gai-jin" class="header-anchor">#</a></h2><ul>
<li><a href="https://github.com/docker/docker/pull/28415" target="_blank" rel="noopener">#28415</a>&#xFF1A;&#x652F;&#x6301; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>USER</code> &#x4E86;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/25736" target="_blank" rel="noopener">#25736</a>&#xFF1A;&#x652F;&#x6301; <code>syslog</code> &#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/28189" target="_blank" rel="noopener">#28189</a>&#xFF1A;&#x652F;&#x6301; <code>fluentd</code> &#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/28182" target="_blank" rel="noopener">#28182</a>&#xFF1A;&#x7EC8;&#x4E8E;&#x652F;&#x6301; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E86;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/22208" target="_blank" rel="noopener">#22208</a>&#xFF1A;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x6307;&#x5B9A;&#x9759;&#x6001;IP&#x4E86;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/23391" target="_blank" rel="noopener">#23391</a>&#xFF1A;&#x652F;&#x6301;&#x5B58;&#x50A8;&#x5C42;&#x9A71;&#x52A8;&#x7684;&#x78C1;&#x76D8;&#x914D;&#x989D;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/25737" target="_blank" rel="noopener">#25737</a>&#xFF1A;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528; <code>docker stats</code> &#x4E86;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/25891" target="_blank" rel="noopener">#25891</a>&#xFF1A;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528; <code>docker top</code> &#x4E86;&#xFF1B;</li>
<li><a href="https://github.com/docker/docker/pull/27838" target="_blank" rel="noopener">#27838</a>&#xFF1A;Windows &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528; Swarm Mode &#x8DD1;&#x96C6;&#x7FA4;&#x4E86;&#xFF1B;</li>
</ul>
<h1 id="swarm-mode"><a href="#Swarm-Mode" class="headerlink" title="Swarm Mode"></a>Swarm Mode <a href="#swarm-mode" class="header-anchor">#</a></h1><h2 id="zheng-shi-zhi-chi-docker-stack"><a href="#&#x6B63;&#x5F0F;&#x652F;&#x6301;-docker-stack" class="headerlink" title="&#x6B63;&#x5F0F;&#x652F;&#x6301; docker stack"></a>&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code> <a href="#zheng-shi-zhi-chi-docker-stack" class="header-anchor">#</a></h2><p>1.12 &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F; Swarm Mode&#x3002;&#x7531;&#x4E8E;&#x57FA;&#x7840;&#x7406;&#x5FF5;&#x53D8;&#x5316;&#x5F88;&#x5927;&#xFF0C;&#x56E0;&#x6B64;&#x5148;&#x884C;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x57FA;&#x672C;&#x7684;&#x670D;&#x52A1;(<code>service</code>)&#xFF0C;&#x4F46;&#x662F;&#x9488;&#x5BF9;&#x5E94;&#x7528;/&#x670D;&#x52A1;&#x6808;(<code>stack</code>)&#x6CA1;&#x6709;&#x6210;&#x719F;&#xFF0C;&#x53EA;&#x662F;&#x8BD5;&#x884C;&#x4F7F;&#x7528; <code>.DAB</code> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x3002;&#x4F46;&#x662F; <code>DAB</code> &#x662F; <code>JSON</code> &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x64B0;&#x5199;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#x3002;&#x76F8;&#x5BF9;&#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x7684; <code>docker-compose.yml</code> &#x5374;&#x65E0;&#x6CD5;&#x5728; <code>docker stack</code> &#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;&#x53EA;&#x53EF;&#x4EE5;&#x7528; <code>docker-compose bundle</code> &#x547D;&#x4EE4;&#x5C06; <code>docker-compose.yml</code> &#x8F6C;&#x6362;&#x4E3A; <code>.dab</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x62FF;&#x5230;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x7528;&#x4E0D;&#x4E86;&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#xFF08;<a href="https://github.com/docker/docker/pull/27998" target="_blank" rel="noopener">#27998</a>&#xFF09;&#xFF0C;&#x5927;&#x5927;&#x65B9;&#x4FBF;&#x4E86;&#x4E60;&#x60EF;&#x4E86; <code>docker compose</code> &#x7684;&#x7528;&#x6237;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x7406;&#x5FF5;&#x7684;&#x6F14;&#x5316;&#xFF0C;&#x539F;&#x6709;&#x7684; <code>docker-compose.yml</code> <code>v2</code> &#x683C;&#x5F0F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>v3</code> &#x683C;&#x5F0F;&#x3002;</p>
<p>&#x5E78;&#x8FD0;&#x7684;&#x662F; <code>v3</code> &#x548C; <code>v2</code> &#x683C;&#x5F0F;&#x5DEE;&#x8DDD;&#x4E0D;&#x5927;&#x3002;</p>
<ul>
<li>&#x5C06;&#x4E00;&#x4E9B;&#x8FC7;&#x65F6;&#x7684;&#x4E1C;&#x897F;&#x53BB;&#x6389;&#xFF0C;&#x5982; <code>volumes_from</code>&#xFF0C;&#x9700;&#x8981;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7528;&#x547D;&#x540D;&#x5377;&#xFF1B;</li>
<li>&#x53BB;&#x9664; <code>volume_driver</code>&#xFF0C;&#x8FD9;&#x79CD;&#x670D;&#x52A1;&#x5168;&#x5C40;&#x7684;&#x4E1C;&#x897F;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#xFF0C;&#x76F4;&#x63A5;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x5377;&#x4F7F;&#x7528; <code>volume</code> &#x952E;&#x4E0B;&#x7684; <code>driver</code> &#x5373;&#x53EF;&#xFF1B;</li>
<li>&#x5C06; <code>cpu_shares</code>, <code>cpu_quota</code>, <code>cpuset</code>, <code>mem_limit</code>, <code>memswap_limit</code> &#x79FB;&#x5230; <code>deploy</code> &#x4E0B;&#x7684; <code>resources</code> &#x4E0B;&#x8FDB;&#x884C;&#x7BA1;&#x63A7;&#xFF0C;&#x6BD5;&#x7ADF;&#x8FD9;&#x662F;&#x90E8;&#x7F72;&#x8D44;&#x6E90;&#x63A7;&#x5236;&#x7684;&#x90E8;&#x5206;&#x3002;</li>
</ul>
<p>&#x5177;&#x4F53;&#x5DEE;&#x5F02;&#x53EF;&#x4EE5;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#upgrading" target="_blank" rel="noopener">https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#upgrading</a></p>
<p>&#x7528;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">&#x6211;&#x7684; LNMP &#x7684;&#x793A;&#x4F8B;</a>&#x4E3A;&#x4F8B;&#x5B50;&#xFF0C;&#x663E;&#x7136;&#x7B2C;&#x4E00;&#x884C;&#x7684; <code>version: &apos;2&apos;</code> &#x9700;&#x8981;&#x6362;&#x6210; <code>version: &apos;3&apos;</code> &#x1F60F;&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x91CC;&#x7684; <code>build</code> &#x663E;&#x7136;&#x7528;&#x4E0D;&#x4E86;&#x4E86;&#x3002;&#x90A3;&#x4E48;&#x6539;&#x6210; <code>v3</code> &#x683C;&#x5F0F;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x662F;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&apos;3&apos;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">nginx:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&quot;twang2218/lnmp-nginx:v1.2&quot;</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">        <span class="attr">deploy:</span></span><br><span class="line">            <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">    <span class="attr">php:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&quot;twang2218/lnmp-php:v1.2&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">MYSQL_PASSWORD:</span> <span class="string">Passw0rd</span></span><br><span class="line">        <span class="attr">deploy:</span></span><br><span class="line">            <span class="attr">replicas:</span> <span class="number">4</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">mysql:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mysql-data:/var/lib/mysql</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">TZ:</span> <span class="string">&apos;Asia/Shanghai&apos;</span></span><br><span class="line">            <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">Passw0rd</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">[&apos;mysqld&apos;,</span> <span class="string">&apos;--character-set-server=utf8&apos;</span><span class="string">]</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">mysql-data:</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">backend:</span></span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x5728; <code>nginx</code> &#x548C; <code>php</code> &#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x7684; <code>deploy</code> &#x914D;&#x7F6E;&#xFF1A;</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">replicas:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F; <code>v3</code> &#x65B0;&#x589E;&#x7684;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x6307;&#x5B9A;&#x4E86;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x7684;&#x526F;&#x672C;&#x6570;&#x91CF;&#x3002;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#xFF0C;&#x5177;&#x4F53;&#x8BF7;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;:</p>
<p><a href="https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#deploy" target="_blank" rel="noopener">https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#deploy</a></p>
<p>&#x5982;&#x679C;&#x5728; swarm &#x73AF;&#x5883;&#x90E8;&#x7F72;&#x8BE5;&#x670D;&#x52A1;&#x6808;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker stack deploy --compose-file docker-compose.yml lnmp</span><br><span class="line">Creating network lnmp_frontend</span><br><span class="line">Creating network lnmp_backend</span><br><span class="line">Creating network lnmp_default</span><br><span class="line">Creating service lnmp_mysql</span><br><span class="line">Creating service lnmp_nginx</span><br><span class="line">Creating service lnmp_php</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7528; <code>docker stack ls</code> &#x6216; <code>docker stack ps</code> &#x6765;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x6808;&#x72B6;&#x6001;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ docker stack ls</span><br><span class="line">NAME  SERVICES</span><br><span class="line">lnmp  3</span><br><span class="line">$ docker stack ps lnmp -f <span class="string">&apos;desired-state=Running&apos;</span></span><br><span class="line">ID            NAME          IMAGE                      NODE  DESIRED STATE  CURRENT STATE               ERROR  PORTS</span><br><span class="line">1x6qiieam21p  lnmp_mysql.1  mysql:5.7                  d1    Running        Running 52 seconds ago</span><br><span class="line">7irrc6v9xnbo  lnmp_nginx.1  twang2218/lnmp-nginx:v1.2  d1    Running        Running about a minute ago</span><br><span class="line">2bq2kjm6xacn  lnmp_php.1    twang2218/lnmp-php:v1.2    d1    Running        Running about a minute ago</span><br><span class="line">edp0ed1k6u9w  lnmp_nginx.2  twang2218/lnmp-nginx:v1.2  d1    Running        Running 58 seconds ago</span><br><span class="line">1hlmkgtpf1pa  lnmp_php.2    twang2218/lnmp-php:v1.2    d2    Running        Running about a minute ago</span><br><span class="line">0xjjyu3tyewp  lnmp_php.3    twang2218/lnmp-php:v1.2    d2    Running        Running about a minute ago</span><br><span class="line">e9lgn25kyepx  lnmp_php.4    twang2218/lnmp-php:v1.2    d1    Running        Running about a minute ago</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x7531;&#x4E8E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684; <code>replicas</code> &#x9879;&#x76EE;&#xFF0C;&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x4E86; 2 &#x4E2A; <code>nginx</code> &#x670D;&#x52A1;&#x5BB9;&#x5668;&#x526F;&#x672C;&#xFF0C;&#x548C; 4 &#x4E2A; <code>php</code> &#x670D;&#x52A1;&#x5BB9;&#x5668;&#x526F;&#x672C;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F; <code>ingress</code> &#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x6620;&#x5C04;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6765;&#x67E5;&#x770B;&#x9875;&#x9762;&#xFF0C;&#x4EAB;&#x53D7;&#x4E8C;&#x4EE3; Swarm &#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x3002;</p>
<p>&#x5220;&#x6389; <code>stack</code>&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7B80;&#x5355;&#x5730; <code>docker stack rm lnmp</code> &#x5373;&#x53EF;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x547D;&#x540D;&#x5377;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664; (<a href="https://github.com/docker/docker/issues/29158" target="_blank" rel="noopener">#29158</a>)&#xFF0C;&#x5982;&#x9700;&#x5220;&#x9664;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7684;&#x53BB;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x8282;&#x70B9;&#x53BB; <code>docker volume rm</code> &#x5377;&#x3002;</p>
<h2 id="tian-jia-secret-guan-li"><a href="#&#x6DFB;&#x52A0;-secret-&#x7BA1;&#x7406;" class="headerlink" title="&#x6DFB;&#x52A0; secret &#x7BA1;&#x7406;"></a>&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406; <a href="#tian-jia-secret-guan-li" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27794" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27794</a></p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#x7BA1;&#x7406;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7B49;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker secret --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker secret COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker secrets</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">     --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"> create      Create a secret using stdin as content</span><br><span class="line"> inspect     Inspect a secret</span><br><span class="line"> ls          List secrets</span><br><span class="line"> rm          Remove a secret</span><br><span class="line"></span><br><span class="line">Run <span class="string">&apos;docker secret COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure>
<p><code>docker secret create</code> &#x4ECE;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x5165;&#x6307;&#x5B9A;&#x540D;&#x79F0;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;MySuperSecretPassword&quot;</span> | docker secret create mysql_password</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x5C06;&#x6765;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--secret</code> &#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x54EA;&#x4E9B; <code>secret</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  docker service create --name privateweb --secret mysql_password nginx</span><br></pre></td></tr></table></figure>
<p>&#x6240;&#x6307;&#x5B9A;&#x7684; <code>secret</code> &#x4F1A;&#x4EE5;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x4E8E; <code>/var/run/secrets/</code> &#x76EE;&#x5F55;&#x4E0B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@d5cec6381df8:/<span class="comment"># ls -al /var/run/secrets/</span></span><br><span class="line">total 8</span><br><span class="line">drwxrwxrwt 2 root root   60 Dec  6 03:16 .</span><br><span class="line">drwxr-xr-x 4 root root 4096 Dec  6 03:16 ..</span><br><span class="line">-r--r--r-- 1 root root   22 Dec  6 03:16 mysql_password</span><br></pre></td></tr></table></figure>
<p><code>secret</code> &#x7684;&#x6743;&#x9650;&#x662F; <code>444</code> &#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x975E; <code>root</code> &#x7528;&#x6237;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5176;&#x5185;&#x5BB9;&#xFF0C;&#x8BFB;&#x53D6;&#x6240;&#x9700;&#x7684;&#x5BC6;&#x7801;&#x6216;&#x8005;&#x5BC6;&#x94A5;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x975E; root &#x7528;&#x6237;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x5F88;&#x91CD;&#x8981;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@d5cec6381df8:/<span class="comment"># cat /var/run/secrets/mysql_password</span></span><br><span class="line">MySuperSecretPassword</span><br></pre></td></tr></table></figure>
<h2 id="tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi"><a href="#&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;"></a>&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301; <a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27279" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27279</a></p>
<p>Docker 1.10 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x7136;&#x540E;&#x5728; 1.11 &#x8FDB;&#x4E00;&#x6B65;&#x652F;&#x6301;&#x4E86; DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;1.12 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; VIP &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#x800C; 1.12 &#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86; <code>HEALTHCHECK</code> &#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x80FD;&#x529B;&#x3002;&#x4F46;&#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x8FD9;&#x4E24;&#x4E2A;&#x529F;&#x80FD;&#x5728; 1.12 &#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#xFF0C;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5C31;&#x5DF2;&#x7ECF;&#x5C06;&#x6D41;&#x91CF;&#x5F00;&#x59CB;&#x5BFC;&#x6D41;&#x7ED9;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x90E8;&#x5206;&#x670D;&#x52A1;&#x4F1A;&#x8BBF;&#x95EE;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x5728; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5229;&#x7528; <code>Dockerfile</code> &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x529F;&#x80FD;&#xFF0C;&#x6765;&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5C1A;&#x672A;&#x5904;&#x4E8E;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5C06;&#x4E0D;&#x4F1A;&#x628A;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x7ED9;&#x8FD9;&#x4E2A;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5230;&#x5BB9;&#x5668;&#x786E;&#x5B9E;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x518D;&#x66F4;&#x65B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>
<h2 id="tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng"><a href="#&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;" class="headerlink" title="&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;"></a>&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD; <a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26421" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26421</a></p>
<p>&#x5F53; Docker 1.12 &#x63D0;&#x4F9B;&#x4E86; Swarm Mode &#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x540E;&#xFF0C;&#x5927;&#x5BB6;&#x90FD;&#x5F88;&#x5174;&#x594B;&#xFF0C;&#x5185;&#x7F6E;&#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x8BA9;&#x6301;&#x7EED;&#x53D1;&#x5E03;&#x53D8;&#x5F97;&#x66F4;&#x4E3A;&#x8F7B;&#x677E;&#x3002;1.12 &#x63D0;&#x4F9B;&#x4E86;&#x5F53;&#x670D;&#x52A1;&#x5347;&#x7EA7;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x8D85;&#x8FC7;&#x91CD;&#x8BD5;&#x6B21;&#x6570;&#x5219;&#x505C;&#x6B62;&#x5347;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x65B9;&#x4FBF;&#xFF0C;&#x907F;&#x514D;&#x8BA9;&#x9519;&#x8BEF;&#x7684;&#x5E94;&#x7528;&#x66FF;&#x4EE3;&#x73B0;&#x6709;&#x6B63;&#x5E38;&#x670D;&#x52A1;&#x3002;&#x4F46;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x867D;&#x7136;&#x63D0;&#x51FA;&#xFF0C;&#x4F46;&#x5E76;&#x672A;&#x80FD;&#x5728; 1.12 &#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x662F;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x540E;&#xFF0C;&#x5982;&#x4F55;&#x8BA9;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1F;&#x96BE;&#x9053;&#x662F;&#x518D;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x66F4;&#x65B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x66F4;&#x65B0;&#x7684;&#x662F;&#x65E7;&#x7248;&#x672C;&#x4E48;&#xFF1F;&#x90A3;&#x4E48;&#x65E7;&#x7248;&#x672C;&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#xFF1F;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5728;&#x81EA;&#x52A8;&#x5316;&#x5904;&#x7406;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5728; 1.13 &#x91CC;&#xFF0C;&#x5F00;&#x59CB;&#x652F;&#x6301; <code>docker service update --rollback</code> &#x529F;&#x80FD;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7531;&#x7BA1;&#x7406;&#x5458;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x5C06;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker service update \</span><br><span class="line">  --rollback \</span><br><span class="line">  --update-delay 0s \</span><br><span class="line">  my_web</span><br></pre></td></tr></table></figure>
<h2 id="bu-chong-liao-yi-xie-docker-service-create-suo-que-shi-de-can-shu"><a href="#&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B;-docker-service-create-&#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570;" class="headerlink" title="&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B; docker service create &#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570;"></a>&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B; <code>docker service create</code> &#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570; <a href="#bu-chong-liao-yi-xie-docker-service-create-suo-que-shi-de-can-shu" class="header-anchor">#</a></h2><p>&#x4ECE; <code>Docker 1.12</code> &#x53D1;&#x5E03; <code>Swarm Mode</code> &#x5F00;&#x59CB;&#xFF0C;<code>docker service create</code> &#x5728;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x6210;&#x4E3A;&#x4E86;&#x65B0;&#x7684; <code>docker run</code>&#xFF0C;&#x4F46;&#x662F;&#x76F8;&#x5BF9;&#x4E8E; <code>docker run</code> &#x7684;&#x5B9A;&#x5236;&#x53C2;&#x6570;&#x800C;&#x8A00;&#xFF0C;<code>docker service create</code> &#x8981;&#x663E;&#x5F97;&#x5355;&#x8584;&#x7684;&#x591A;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x7531;&#x4E8E; <code>docker service create</code> &#x662F;&#x9762;&#x5411;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x53EF;&#x80FD;&#x628A; <code>docker run</code> &#x4E0A;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&#x90FD;&#x7167;&#x642C;&#x8FC7;&#x6765;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x4E00;&#x7504;&#x522B;&#xFF0C;&#x6709;&#x7684;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B9E;&#x73B0;&#xFF0C;&#x6709;&#x7684;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x3002;&#x5728; <code>Docker 1.13</code>&#xFF0C;&#x4F34;&#x968F;&#x7740;&#x65B0;&#x589E;&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x8FD8;&#x6709;&#x4E0D;&#x5C11;&#x8FD9;&#x7C7B;&#x53C2;&#x6570;&#x4E5F;&#x88AB;&#x6DFB;&#x52A0;&#x56DE;&#x6765;&#x4E86;&#x3002;</p>
<ul>
<li><a href="https://github.com/docker/docker/pull/24844" target="_blank" rel="noopener">#24844</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--env-file</code></li>
<li><a href="https://github.com/docker/docker/pull/25317" target="_blank" rel="noopener">#25317</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--group</code></li>
<li><a href="https://github.com/docker/docker/pull/27369" target="_blank" rel="noopener">#27369</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--no-health-check</code>, <code>--health-*</code></li>
<li><a href="https://github.com/docker/docker/pull/27567" target="_blank" rel="noopener">#27567</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--dns</code>, <code>--dns-opt</code>, <code>--dns-search</code></li>
<li><a href="https://github.com/docker/docker/pull/27857" target="_blank" rel="noopener">#27857</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--hostname</code></li>
<li><a href="https://github.com/docker/docker/pull/28031" target="_blank" rel="noopener">#28031</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--host</code></li>
<li><a href="https://github.com/docker/docker/pull/28076" target="_blank" rel="noopener">#28076</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--tty</code></li>
</ul>
<h2 id="tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi-shi-yan-gong-neng"><a href="#&#x6DFB;&#x52A0;&#x547D;&#x4EE4;-docker-service-logs-&#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;" class="headerlink" title="&#x6DFB;&#x52A0;&#x547D;&#x4EE4; docker service logs &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;"></a>&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09; <a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi-shi-yan-gong-neng" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28089" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28089</a></p>
<p>Swarm Mode &#x542F;&#x52A8;&#x670D;&#x52A1;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x5F88;&#x9EBB;&#x70E6;&#x3002;&#x5728; <code>docker-compose</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker-compose logs &lt;&#x670D;&#x52A1;&#x540D;&gt;</code> &#x5373;&#x53EF;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;&#x662F;&#x8DD1;&#x5728;&#x4E0D;&#x540C;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x3002;&#x4F46;&#x662F; <code>docker service</code> &#x4E0D;&#x652F;&#x6301; <code>logs</code> &#x547D;&#x4EE4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x73B0;&#x5728;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;&#x9700;&#x8981; <code>docker service ps</code> &#x67E5;&#x770B;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x5728;&#x54EA;&#x4E9B;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4E00;&#x4E2A;&#x4E2A;&#x8FDB;&#x53BB;&#x5148; <code>docker ps</code> &#x627E;&#x5230;&#x5BB9;&#x5668; ID&#xFF0C;&#x7136;&#x540E;&#x5728; <code>docker logs &lt;&#x5BB9;&#x5668;ID&gt;</code> &#x67E5;&#x770B;&#x5177;&#x4F53;&#x65E5;&#x5FD7;&#x3002;&#x975E;&#x5E38;&#x7E41;&#x7410;&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86; <code>docker service logs</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x4EE5;&#x8FBE;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x662F;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x5728;&#x542F;&#x7528;&#x8BD5;&#x9A8C;&#x6A21;&#x5F0F;&#x540E;(<code>dockerd --experimental</code>)&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force"><a href="#&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879;-docker-service-update-force" class="headerlink" title="&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; docker service update --force"></a>&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code> <a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27596" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27596</a></p>
<p>&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528; <code>docker swarm mode</code> &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x78B0;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;&#xFF0C;&#x4FEE;&#x590D;&#x91CD;&#x542F;&#x8BE5;&#x8282;&#x70B9;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x539F;&#x6765;&#x8BE5;&#x8282;&#x70B9;&#x8DD1;&#x7684;&#x670D;&#x52A1;&#x88AB;&#x8C03;&#x5EA6;&#x5230;&#x4E86;&#x522B;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;swarm manager &#x7684;&#x4ECB;&#x5165;&#x4FDD;&#x8BC1;&#x4E86;&#x670D;&#x52A1;&#x7684;&#x53EF;&#x7528;&#x6027;&#x3002;&#x53EF;&#x662F;&#x8282;&#x70B9;&#x6062;&#x590D;&#x540E;&#xFF0C;&#x9664;&#x975E;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x4E2A;&#x522B;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E2A;&#x65B0;&#x4FEE;&#x590D;&#x7684;&#x8282;&#x70B9;&#x5C31;&#x4E00;&#x76F4;&#x95F2;&#x7740;&#xFF0C;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x6570;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5; swarm manager &#x4E0D;&#x4F1A;&#x4ECB;&#x5165;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;&#x96C6;&#x7FA4;&#x6269;&#x5BB9;&#x540E;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x65B0;&#x6269;&#x5BB9;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x6700;&#x521D;&#x90FD;&#x662F;&#x7A7A;&#x95F2;&#x7684;&#x3002;&#x5728; 1.12 &#x552F;&#x4E00;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6539;&#x70B9;&#x513F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#x4ECE;&#x800C;&#x89E6;&#x53D1; swarm &#x7684;&#x5347;&#x7EA7;&#x884C;&#x4E3A;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x597D;&#x529E;&#x6CD5;&#x3002;</p>
<p>&#x5728; 1.13&#xFF0C;&#x5F15;&#x5165;&#x4E86; <code>docker service update --force</code> &#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x5F3A;&#x5236;&#x89E6;&#x53D1;&#x518D;&#x53D1;&#x5E03;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F3A;&#x5236;&#x91CD;&#x65B0; <code>pull</code> &#x8BE5;&#x955C;&#x50CF;&#x3001;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#xFF0C;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x7531;&#x4E8E;&#x5404;&#x79CD;&#x7EF4;&#x62A4;&#x5BFC;&#x81F4;&#x7684;&#x96C6;&#x7FA4;&#x8D1F;&#x8F7D;&#x4E0D;&#x5E73;&#x8861;&#x7684;&#x60C5;&#x51B5;&#x5F97;&#x5230;&#x7F13;&#x89E3;&#xFF0C;&#x518D;&#x6B21;&#x5E73;&#x8861;&#x96C6;&#x7FA4;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x662F; <code>docker service update</code> &#x547D;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x9075;&#x5FAA;&#x6240;&#x6307;&#x5B9A;&#x7684; <code>--update-parallelism</code> &#x548C; <code>--update-delay</code> &#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x3002;</p>
<h1 id="fei-qi"><a href="#&#x5E9F;&#x5F03;" class="headerlink" title="&#x5E9F;&#x5F03;"></a>&#x5E9F;&#x5F03; <a href="#fei-qi" class="header-anchor">#</a></h1><ul>
<li>&#x5E9F;&#x5F03; <code>docker daemon</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528; <code>dockerd</code> &#x53D6;&#x4EE3;&#x3002;&#x5176;&#x5B9E; 1.12 &#x5DF2;&#x7ECF;&#x6362;&#x4E86;</li>
<li>&#x79FB;&#x9664;&#x5BF9; Ubuntu 15.10&#x3001;Fedora 22 &#x7684;&#x652F;&#x6301;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x90FD; EOL &#x4E86;&#x3002;</li>
<li>&#x5E9F;&#x5F03; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>MAINTAINER</code> &#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x7528; <code>LABEL maintainer=&lt;...&gt;</code> &#x4EE3;&#x66FF;</li>
</ul>
</div></article><div class="pagination"><a href="/blog.lab99.org/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html" class="pagination-prev">PREV</a><a href="/blog.lab99.org/post/docker-2016-08-12-video-windows-server-and-docker.html" class="pagination-next">NEXT</a></div><div class="comments"><div id="disqus_thread"></div></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/blog.lab99.org/tags/Sonatype/">Sonatype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/blog.lab99.org/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/blog.lab99.org/tags/coreos/">coreos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/blog.lab99.org/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/blog.lab99.org/tags/docker-summit/">docker summit</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-27-video-how-to-correctly-use-package-context.html">视频笔记：如何正确使用 Context - Jack Lindamood</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-20-video-seven-ways-to-profile-go-apps.html">视频笔记：7种 Go 程序性能分析方法 - Dave Cheney</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-13-video-write-container-in-go-from-scratch.html">视频笔记：容器是什么？让我们用 Go 写一个吧！ - Liz Rice</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-09-video-the-new-era-of-go-package-management.html">视频笔记：Go 包管理的新时代 - Sam Boyer</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-05-video-guide-to-syscall.html">视频笔记：Go 和 syscall - Liz Rice</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html">视频笔记：理解 channels - Kavya Joshi</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-01-video-go-build-mode.html">视频笔记：Go 的构建模式 - David Crawshaw</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-09-23-video-go-for-crypto-developers.html">视频笔记：Go 密码学应用 - George Tankersley</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><p>© 2020 <a href="/">王涛</a></p></div><div class="power"><p><a href="https://pages.coding.net/">Hosted by Coding Pages</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/twang2218/hexo-theme-jekyll">Jekyll</a></p></div></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="//cdn.bootcss.com/mermaid/7.0.0/mermaid.min.js"></script><script>(function() {
    var d = document, s = d.createElement('script');
    s.src = '//twang2218-coding.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();</script></body></html>