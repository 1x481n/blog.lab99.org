<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 视频笔记：容器是什么？让我们用 Go 写一个吧！ - Liz Rice · 大桥下的蜗牛</title><meta name="description" content="无善无恶心之体，有善有恶意之动，知善知恶是良知，为善去恶是格物。"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/blog.lab99.org/favicon.png"><link rel="stylesheet" href="/blog.lab99.org/css/jekyll.css"><link rel="stylesheet" href="https://cdn.bootcss.com/mermaid/7.0.0/mermaid.min.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/blog.lab99.org/" class="logo"><img src="/blog.lab99.org/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/blog.lab99.org/post/golang-2017-10-13-video-write-container-in-go-from-scratch.html" class="post-title-link">视频笔记：容器是什么？让我们用 Go 写一个吧！ - Liz Rice</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/blog.lab99.org/tags/golang/" class="post-tag-link">golang</a></li><li class="post-tag-item"><a href="/blog.lab99.org/tags/youtube/" class="post-tag-link">youtube</a></li><li class="post-tag-item"><a href="/blog.lab99.org/tags/notes/" class="post-tag-link">notes</a></li><li class="post-tag-item"><a href="/blog.lab99.org/tags/golang-uk-2016/" class="post-tag-link">golang-uk-2016</a></li></ul><div class="post-time">2017年10月13日 星期五</div></div><div class="post-content"><link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#shi-me-shi-rong-qi">&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;</a></li>
<li><a href="#qi-dong-yi-ge-docker-rong-qi">&#x542F;&#x52A8;&#x4E00;&#x4E2A; docker &#x5BB9;&#x5668;</a></li>
<li><a href="#yong-go-shi-xian-yi-ge-rong-qi">&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</a><ul>
<li><a href="#qi-dong-yi-ge-linux-xi-tong">&#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF;</a></li>
<li><a href="#zui-jian-dan-de-yun-xing-ming-ling">&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;</a></li>
<li><a href="#ge-chi-chu-hostname-de-ming-ming-kong-jian">&#x9694;&#x79BB;&#x51FA; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li>
<li><a href="#ge-chi-pid-ming-ming-kong-jian">&#x9694;&#x79BB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li>
<li><a href="#pai-zhang-pid-ming-ming-kong-jian">&#x6392;&#x969C; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li>
<li><a href="#ge-chi-file-system-ming-ming-kong-jian">&#x9694;&#x79BB; File System &#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li>
</ul>
</li>
<li><a href="#zong-jie">&#x603B;&#x7ED3;</a><ul>
<li><a href="#ming-ming-kong-jian-namespace">&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09;</a></li>
<li><a href="#kong-zhi-zu-control-groups">&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control groups&#xFF09;</a></li>
<li><a href="#images-rootfs">Images &#xFF08;rootfs&#xFF09;</a></li>
<li><a href="#jin-yi-bu-yue-du">&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB;</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>What is a container, really? Let&#x2019;s write one in Go from scratch</strong><br>by Liz Rice<br>at Golang UK Conf. 2016</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/HPuvDm8IC-4" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>
<ul>
<li>&#x89C6;&#x9891;&#xFF1A;<a href="https://www.youtube.com/watch?v=HPuvDm8IC-4" target="_blank" rel="noopener">https://www.youtube.com/watch?v=HPuvDm8IC-4</a></li>
</ul>
<h1 id="shi-me-shi-rong-qi"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F; <a href="#shi-me-shi-rong-qi" class="header-anchor">#</a></h1><p>&#x5F88;&#x591A;&#x4EBA;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x641E;&#x4E0D;&#x6E05;&#x695A;&#x5BB9;&#x5668;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x6240;&#x4EE5;&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x6709;&#x4EBA;&#x95EE;&#xFF0C;&#x5BB9;&#x5668;&#x5230;&#x5E95;&#x662F;&#x5565;&#xFF1F;Docker &#x5230;&#x5E95;&#x662F;&#x5565;&#xFF1F;</p>
<ul>
<li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A;&#x201D;</li>
<li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F; Jail&#x201D;</li>
<li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x548C; chroot &#x4E00;&#x6837;&#x201D;</li>
<li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F; namespace&#x3001;cgroups&#x2026;&#x2026;&#x201D;</li>
<li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F;&#x9694;&#x79BB;&#x7684;&#x8FDB;&#x7A0B;&#x201D;</li>
</ul>
<p>&#x542C;&#x4E86;&#x8FD9;&#x4E9B;&#x89E3;&#x91CA;&#x540E;&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x6E05;&#x695A;&#x5230;&#x5E95;&#x5BB9;&#x5668;&#x662F;&#x5565;&#x3002;&#x76F4;&#x5230;&#x770B;&#x4E86; <a href="https://github.com/julz" target="_blank" rel="noopener">Julian Friedman</a> &#x5199;&#x7684;&#x535A;&#x6587;<a href="https://www.infoq.com/articles/build-a-container-golang" target="_blank" rel="noopener">&#x300A;&#x767E;&#x884C;&#x4EE5;&#x5185;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x300B;</a> &#x540E;&#xFF0C;&#x624D;&#x604D;&#x7136;&#x5927;&#x609F;&#xFF0C;&#x89C9;&#x5F97;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x5E94;&#x8BE5;&#x8BFB;&#x4E00;&#x8BFB;&#xFF0C;&#x5E0C;&#x671B;&#x628A;&#x8FD9;&#x91CC;&#x7684;&#x5185;&#x5BB9;&#x5206;&#x4EAB;&#x7ED9;&#x6240;&#x6709;&#x4EBA;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A; talk &#x5C31;&#x662F;&#x4E3B;&#x8981;&#x57FA;&#x4E8E; Julian &#x7684;&#x535A;&#x6587;&#x7684;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x6709;&#x4E9B;&#x6539;&#x53D8;&#x3002;</p>
<h1 id="qi-dong-yi-ge-docker-rong-qi"><a href="#&#x542F;&#x52A8;&#x4E00;&#x4E2A;-docker-&#x5BB9;&#x5668;" class="headerlink" title="&#x542F;&#x52A8;&#x4E00;&#x4E2A; docker &#x5BB9;&#x5668;"></a>&#x542F;&#x52A8;&#x4E00;&#x4E2A; docker &#x5BB9;&#x5668; <a href="#qi-dong-yi-ge-docker-rong-qi" class="header-anchor">#</a></h1><p>&#x6211;&#x4EEC;&#x5148;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; docker &#x5BB9;&#x5668;&#xFF0C;&#x6765;&#x5BF9;&#x5BB9;&#x5668;&#x6709;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;&#x8BA4;&#x8BC6;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x6267;&#x884C;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run alpine <span class="built_in">echo</span> <span class="string">&quot;Hello GopherCon&quot;</span></span><br><span class="line">Hello GopherCon</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x5F0F;&#x6A21;&#x5F0F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it alpine</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A; <code>alpine</code> &#x7684;&#x955C;&#x50CF;&#x3002;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5217;&#x76EE;&#x5F55;&#xFF0C;&#x770B;&#x5230;&#x548C;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ls</span></span><br><span class="line">bin    etc    lib    mnt    root   sbin   sys    usr</span><br><span class="line">dev    home   media  proc   run    srv    tmp    var</span><br><span class="line">/ <span class="comment"># ls -al</span></span><br><span class="line">total 60</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct 18 11:56 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct 18 11:56 ..</span><br><span class="line">-rwxr-xr-x    1 root     root             0 Oct 18 11:56 .dockerenv</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 bin</span><br><span class="line">drwxr-xr-x    5 root     root           360 Oct 18 11:56 dev</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct 18 11:56 etc</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 home</span><br><span class="line">drwxr-xr-x    5 root     root          4096 Jun 25 17:52 lib</span><br><span class="line">drwxr-xr-x    5 root     root          4096 Jun 25 17:52 media</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 mnt</span><br><span class="line">dr-xr-xr-x  130 root     root             0 Oct 18 11:56 proc</span><br><span class="line">drwx------    1 root     root          4096 Oct 18 11:56 root</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 run</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 sbin</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 srv</span><br><span class="line">dr-xr-xr-x   13 root     root             0 Oct 18 11:56 sys</span><br><span class="line">drwxrwxrwt    2 root     root          4096 Jun 25 17:52 tmp</span><br><span class="line">drwxr-xr-x    7 root     root          4096 Jun 25 17:52 usr</span><br><span class="line">drwxr-xr-x   12 root     root          4096 Jun 25 17:52 var</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5; <code>ps</code> &#x663E;&#x793A;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F46;&#x662F;&#x770B;&#x5230;&#x7684;&#x53EA;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ps</span></span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 /bin/sh</span><br><span class="line">    7 root       0:00 ps</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#xFF0C;&#x4E5F;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x540C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0</span><br><span class="line">3: gre0@NONE: &lt;NOARP&gt; mtu 1476 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/gre 0.0.0.0 brd 0.0.0.0</span><br><span class="line">4: gretap0@NONE: &lt;BROADCAST,MULTICAST&gt; mtu 1462 qdisc noop state DOWN qlen 1000</span><br><span class="line">    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: ip_vti0@NONE: &lt;NOARP&gt; mtu 1332 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0</span><br><span class="line">6: ip6_vti0@NONE: &lt;NOARP&gt; mtu 1500 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/tunnel6 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</span><br><span class="line">7: sit0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/sit 0.0.0.0 brd 0.0.0.0</span><br><span class="line">8: ip6tnl0@NONE: &lt;NOARP&gt; mtu 1452 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/tunnel6 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</span><br><span class="line">9: ip6gre0@NONE: &lt;NOARP&gt; mtu 1448 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/[823] 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</span><br><span class="line">32: eth0@if33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>hostname</code>&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x4E5F;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x540C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># hostname</span></span><br><span class="line">1faa496601e8</span><br></pre></td></tr></table></figure>
<h1 id="yong-go-shi-xian-yi-ge-rong-qi"><a href="#&#x7528;-Go-&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;" class="headerlink" title="&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;"></a>&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668; <a href="#yong-go-shi-xian-yi-ge-rong-qi" class="header-anchor">#</a></h1><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684; docker &#x4F7F;&#x7528;&#x770B;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x7684;&#x683C;&#x5F0F;&#x662F;&#xFF0C;<code>docker run &lt;&#x5BB9;&#x5668;&gt; &lt;&#x547D;&#x4EE4;&gt; &lt;&#x53C2;&#x6570;&gt;</code>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x6765;&#x6A21;&#x62DF;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x3002;</p>
<h2 id="qi-dong-yi-ge-linux-xi-tong"><a href="#&#x542F;&#x52A8;&#x4E00;&#x4E2A;-Linux-&#x7CFB;&#x7EDF;" class="headerlink" title="&#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF;"></a>&#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF; <a href="#qi-dong-yi-ge-linux-xi-tong" class="header-anchor">#</a></h2><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528; <a href="https://www.vagrantup.com/intro/index.html" target="_blank" rel="noopener">Vagrant</a> &#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF;&#xFF0C;&#x56E0;&#x4E3A;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;&#x4E00;&#x4E9B; Linux &#x5185;&#x6838;&#x76F8;&#x5173;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C06;&#x53EA;&#x5B58;&#x5728;&#x4E8E; Linux &#x4E2D;&#x3002;&#x4E0D;&#x719F;&#x6089; Vagrant &#x53EF;&#x4EE5;&#x5148;&#x53BB;&#x5B66;&#x4E60;<a href="https://www.vagrantup.com/intro/getting-started/index.html" target="_blank" rel="noopener">&#x5982;&#x4F55;&#x4F7F;&#x7528; Vagrant</a>&#x3002;&#x719F;&#x6089;&#x7684;&#x7EE7;&#x7EED;&#xFF0C;&#x6211;&#x4EEC;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A; <code>Vagrantfile</code>&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line">Vagrant.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">  config.vm.box = <span class="string">&quot;bento/ubuntu-16.04&quot;</span></span><br><span class="line">  config.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="symbol">inline:</span> &lt;&lt;-SHELL</span><br><span class="line">    curl -fsSL <span class="symbol">https:</span>/<span class="regexp">/get.docker.com/</span> <span class="params">| sh</span></span><br><span class="line"><span class="params">    usermod -aG docker vagrant</span></span><br><span class="line"><span class="params">    apt-get update</span></span><br><span class="line"><span class="params">    apt-get dist-upgrade -y</span></span><br><span class="line"><span class="params">    snap install --classic go</span></span><br><span class="line"><span class="params">    wget http://dl-cdn.alpinelinux.org/alpine/v3.6/releases/x86_64/alpine-minirootfs-3.6.2-x86_64.tar.gz</span></span><br><span class="line"><span class="params">    mkdir /var/lib/alpine</span></span><br><span class="line"><span class="params">    tar -xzvf alpine-minirootfs-3.6.2-x86_64.tar.gz -C /var/lib/alpine</span></span><br><span class="line"><span class="params">  SHELL</span></span><br><span class="line"><span class="params"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A; <a href="https://wiki.ubuntu.com/XenialXerus/ReleaseNotes?_ga=2.155044219.232627992.1508377352-890558848.1503503283#Ubuntu_Server" target="_blank" rel="noopener">Ubuntu Server 16.04 LTS</a> &#x7248;&#x672C;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5E76;&#x4E14;&#x5B89;&#x88C5;&#x4E86; <a href="https://www.docker-cn.com/" target="_blank" rel="noopener">Docker</a> &#x548C; <a href="https://golang.org/" target="_blank" rel="noopener">Go</a>&#xFF0C;&#x800C;&#x4E14;&#x51C6;&#x5907;&#x4E86;&#x4E00;&#x4E2A; <a href="https://alpinelinux.org/" target="_blank" rel="noopener">Alpine Linux</a> &#x7684; <code>rootfs</code> &#x4EE5;&#x5907;&#x540E;&#x7528;&#x3002;</p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x7528;  <code>vagrant up</code> &#x6765;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5E76;&#x4E14;&#x7528; <code>vagrant ssh</code> &#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant ssh</span><br><span class="line">Welcome to Ubuntu 16.04.3 LTS (GNU/Linux 4.4.0-92-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">0 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vagrant@vagrant:~$</span><br></pre></td></tr></table></figure>
<h2 id="zui-jian-dan-de-yun-xing-ming-ling"><a href="#&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;" class="headerlink" title="&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;"></a>&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4; <a href="#zui-jian-dan-de-yun-xing-ming-ling" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x6A21;&#x62DF;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8FBE;&#x5230;&#x7684;&#x6548;&#x679C;&#x662F; <code>go run docker.go run &lt;&#x547D;&#x4EE4;&gt; &lt;&#x53C2;&#x6570;&gt;</code> &#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#x7684;&#x6548;&#x679C;&#x3002;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">switch</span> os.Args[<span class="number">1</span>] {</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;run&quot;</span>:</span><br><span class="line">		run()</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;what?&quot;</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Running %v\n&quot;</span>, os.Args[<span class="number">2</span>:])</span><br><span class="line">	cmd := exec.Command(os.Args[<span class="number">2</span>], os.Args[<span class="number">3</span>:]...)</span><br><span class="line">	cmd.Stdin = os.Stdin</span><br><span class="line">	cmd.Stdout = os.Stdout</span><br><span class="line">	cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">	must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(err error)</span></span> {</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run docker.go run <span class="built_in">echo</span> <span class="string">&quot;Hello, our container&quot;</span></span><br><span class="line">Running [<span class="built_in">echo</span> Hello, our container]</span><br><span class="line">Hello, our container</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x548C;&#x4E4B;&#x524D;&#x7684; <code>docker run</code> &#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6536;&#x5230;&#x547D;&#x4EE4;&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line">sh-3.2$ ls</span><br><span class="line">Vagrantfile     docker.go</span><br><span class="line">sh-3.2$ ps</span><br><span class="line">  PID TTY           TIME CMD</span><br><span class="line">44316 ttys000    0:01.89 /bin/zsh -l</span><br><span class="line">45926 ttys000    0:00.01 vagrant up</span><br><span class="line">45927 ttys000    1:46.53 ruby /opt/vagrant/embedded/gems/gems/vagrant-2.0.0/bin/vagrant up</span><br><span class="line">45212 ttys002    0:01.48 /bin/zsh -l</span><br><span class="line">45372 ttys002    0:00.21 go run docker.go run /bin/sh</span><br><span class="line">45379 ttys002    0:00.01 /var/folders/wc/9tzsn1hd7c38tvc54kctn4100000gn/T/go-build882908294/<span class="built_in">command</span>-line-arguments/_obj/exe/docker r</span><br><span class="line">45380 ttys002    0:00.02 /bin/sh</span><br></pre></td></tr></table></figure>
<p>&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x4E0D;&#x8981;&#x9AD8;&#x5174;&#x592A;&#x65E9;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x800C;&#x5DF2;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x771F;&#x7684;&#x8FDB;&#x5165;&#x9694;&#x79BB;&#x7684;&#x5BB9;&#x5668;&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x4F9D;&#x65E7;&#x662F;&#x5904;&#x4E8E;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x4EE5;&#x53CA;&#x5BBF;&#x4E3B;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5BBF;&#x4E3B;&#x7684; hostname&#x3002;&#x55EF;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x662F;&#x5728;&#x5BBF;&#x4E3B;&#x7684; namespace &#xFF08;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF09;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x5DEE;&#x3002;</p>
<h2 id="ge-chi-chu-hostname-de-ming-ming-kong-jian"><a href="#&#x9694;&#x79BB;&#x51FA;-hostname-&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x9694;&#x79BB;&#x51FA; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x9694;&#x79BB;&#x51FA; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ge-chi-chu-hostname-de-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6211;&#x4EEC;&#x5199;&#x7684; <code>docker.go</code> &#x53EF;&#x4EE5;&#x771F;&#x7684;&#x5728;&#x72EC;&#x7ACB;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#x547D;&#x4EE4;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x539F;&#x6709;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x89E3;&#x51B3; hostname &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">	...</span><br><span class="line">	cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">	cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">		Cloneflags: syscall.CLONE_NEWUTS,</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	must(cmd.Run())</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x5728; <code>cmd.Run()</code> &#x4E4B;&#x524D;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E86; <code>SysProcAttr</code> &#x5C5E;&#x6027;&#xFF0C;&#x6307;&#x5B9A;&#x4E86; <code>CLONE_NEWUTS</code>&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5728;&#x8BF4;&#x542F;&#x52A8;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x521D;&#x59CB;&#x503C;&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x514B;&#x9686;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ hostname</span><br><span class="line">vagrant</span><br><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line"><span class="comment"># hostname</span></span><br><span class="line">vagrant</span><br><span class="line"><span class="comment"># hostname golang</span></span><br><span class="line"><span class="comment"># hostname</span></span><br><span class="line">golang</span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">vagrant@vagrant:/vagrant$ hostname</span><br><span class="line">vagrant</span><br></pre></td></tr></table></figure>
<p>&#x770B;&#x5230;&#x4E86;&#x5427;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x7684;&#x8FDB;&#x7A0B;&#x5728;&#x65B0;&#x7684; <code>hostname</code> &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#xFF08;&#x90E8;&#x5206;&#xFF09;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4FEE;&#x6539;&#x4E86; <code>hostname</code>&#xFF0C;&#x56DE;&#x5230;&#x5BBF;&#x4E3B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>hostname</code> &#x5E76;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x4E24;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#x3002;</p>
<h2 id="ge-chi-pid-ming-ming-kong-jian"><a href="#&#x9694;&#x79BB;-PID-&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x9694;&#x79BB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x9694;&#x79BB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ge-chi-pid-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x53EA;&#x662F;&#x9694;&#x79BB;&#x4E86; <code>hostname</code>&#xFF0C;&#x6CA1;&#x6709;&#x9694;&#x79BB;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x8FDB;&#x7A0B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 3173 pts/0    00:00:00 sudo</span><br><span class="line"> 3174 pts/0    00:00:00 go</span><br><span class="line"> 3199 pts/0    00:00:00 docker</span><br><span class="line"> 3203 pts/0    00:00:00 sh</span><br><span class="line"> 3205 pts/0    00:00:00 ps</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x548C; <code>docker run</code> &#x4E00;&#x6837;&#xFF0C;&#x8FDB;&#x7A0B;&#x4E5F;&#x662F;&#x9694;&#x79BB;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">	...</span><br><span class="line">	cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">		Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID,</span><br><span class="line">	}</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x770B;&#x6765;&#x548C;&#x4E0A;&#x9762;&#x4E00;&#x6837;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x518D;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D; <code>CLONE_NEWPID</code>&#xFF0C;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7ED9;&#x5373;&#x5C06;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#xFF1F;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x6267;&#x884C;&#x4E00;&#x4E0B;&#x770B;&#x770B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 3274 pts/0    00:00:00 sudo</span><br><span class="line"> 3275 pts/0    00:00:00 go</span><br><span class="line"> 3299 pts/0    00:00:00 docker</span><br><span class="line"> 3303 pts/0    00:00:00 sh</span><br><span class="line"> 3305 pts/0    00:00:00 ps</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>&#x5947;&#x602A;&#x4E86;&#xFF0C;&#x8FD9;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#x554A;&#x3002;</p>
<h2 id="pai-zhang-pid-ming-ming-kong-jian"><a href="#&#x6392;&#x969C;-PID-&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x6392;&#x969C; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x6392;&#x969C; PID &#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#pai-zhang-pid-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x547D;&#x540D;&#x5DF2;&#x7ECF;&#x662F;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48; <code>ps</code> &#x770B;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x8FDB;&#x7A0B;&#x5462;&#xFF1F;</p>
<p>&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x6392;&#x969C;&#xFF0C;&#x6211;&#x4EEC;&#x8F93;&#x51FA;&#x4E00;&#x4E0B;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#x7684; PID&#xFF0C;&#x770B;&#x770B;&#x5230;&#x5E95;&#x662F;&#x4E0D;&#x662F;&#x51FA;&#x4E8E;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E86;&#x3002;&#x4E3A;&#x4E86;&#x8F93;&#x51FA;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#x7684; PID&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#x7A0B;&#x5E8F;&#x7ED3;&#x6784;&#xFF0C;&#x589E;&#x52A0;&#x4E00;&#x5C42;&#xFF0C;&#x5E76;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;<code>child</code>&#x3002;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">	<span class="string">&quot;syscall&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">switch</span> os.Args[<span class="number">1</span>] {</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;run&quot;</span>:</span><br><span class="line">		run()</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;child&quot;</span>:</span><br><span class="line">		child()</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;what?&quot;</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;/proc/self/exe&quot;</span>, <span class="built_in">append</span>([]<span class="keyword">string</span>{<span class="string">&quot;child&quot;</span>}, os.Args[<span class="number">2</span>:]...)...)</span><br><span class="line">	cmd.Stdin = os.Stdin</span><br><span class="line">	cmd.Stdout = os.Stdout</span><br><span class="line">	cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">	cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">		Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID,</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">child</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Running %v as pid: %d\n&quot;</span>, os.Args[<span class="number">2</span>:], os.Getpid())</span><br><span class="line">	cmd := exec.Command(os.Args[<span class="number">2</span>], os.Args[<span class="number">3</span>:]...)</span><br><span class="line">	cmd.Stdin = os.Stdin</span><br><span class="line">	cmd.Stdout = os.Stdout</span><br><span class="line">	cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">	must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(err error)</span></span> {</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5F53;&#x6211;&#x4EEC;&#x7528; <code>run</code> &#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x81EA;&#x5DF1;(fork)&#xFF0C;&#x5E76;&#x52A0;&#x5165;&#x547D;&#x4EE4; <code>child</code>&#xFF0C;&#x7136;&#x540E; <code>child()</code> &#x51FD;&#x6570;&#x4F1A;&#x5B9E;&#x9645;&#x7684;&#x6267;&#x884C;&#x542F;&#x52A8;&#x7528;&#x6237;&#x9700;&#x6C42;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x6837;&#x6709;&#x4E86;&#x4E00;&#x5C42; <code>child()</code>&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x53D6;&#x5F97;&#x66F4;&#x591A;&#x7684;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run <span class="built_in">echo</span> hello</span><br><span class="line">Running [<span class="built_in">echo</span> hello] as pid: 1</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x5230;&#x4E86;&#x4E48;&#xFF0C;&#x8FD9;&#x91CC;&#x7684; <code>pid: 1</code>&#xFF0C;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x5EFA;&#x7ACB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6210;&#x529F;&#x4E86;&#x7684;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x786E;&#x4FE1;&#xFF0C;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x4E0A;&#x9762;&#x7684; <code>CLONE_NEWPID</code> &#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x518D;&#x6B21;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run <span class="built_in">echo</span> hello</span><br><span class="line">Running [<span class="built_in">echo</span> hello] as pid: 3528</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>&#x770B;&#x5230;&#x4E86;&#x5427;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; <code>CLONE_NEWPID</code> &#x5EFA;&#x7ACB;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C06;&#x5904;&#x4E8E;&#x5BBF;&#x4E3B;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B; ID &#x662F;&#x539F;&#x6765;&#x7684;&#x7A7A;&#x95F4;&#x7684; <code>3528</code>&#x3002;&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x542F;&#x7528;&#x4E86;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x6210;&#x4E3A;&#x8BE5;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64; PID &#x5C31;&#x4E3A; <code>1</code> &#x4E86;&#x3002;</p>
<p>&#x597D;&#x5427;&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x786E;&#x5B9E;&#x5DF2;&#x7ECF;&#x5728;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x91CC;&#x4E86;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48; <code>ps</code> &#x4E0D;&#x5BF9;&#x5462;&#xFF1F;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh] as pid: 1</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 3534 pts/0    00:00:00 sudo</span><br><span class="line"> 3535 pts/0    00:00:00 go</span><br><span class="line"> 3559 pts/0    00:00:00 docker</span><br><span class="line"> 3562 pts/0    00:00:00 exe</span><br><span class="line"> 3566 pts/0    00:00:00 sh</span><br><span class="line"> 3568 pts/0    00:00:00 ps</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x662F;&#x7531;&#x4E8E; <code>ps</code> &#x53EA;&#x662F;&#x7B80;&#x5355;&#x5730;&#x89C2;&#x5BDF; <code>/proc</code> &#x7684;&#x5185;&#x5BB9;&#x800C;&#x7ED9;&#x51FA;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x6B64;&#x65F6;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/proc</code> &#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x4F4D;&#x4E8E;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E86;&#xFF0C;&#x4F46;&#x662F; <code>ps</code> &#x8FD8;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh] as pid: 1</span><br><span class="line"><span class="comment"># ls /proc</span></span><br><span class="line">1     157    23     27805  3     376  48   59   80         consoles     ioports      meminfo       softirqs           vmallocinfo</span><br><span class="line">10    158    23167  27808  30    396  49   6    813        cpuinfo      irq          misc          <span class="built_in">stat</span>               vmstat</span><br><span class="line">1070  159    235    27809  31    404  490  60   814        crypto       kallsyms     modules       swaps              zoneinfo</span><br><span class="line">11    16     24     28     313   407  5    602  816        devices      kcore        mounts        sys</span><br><span class="line">1130  17     257    28057  314   416  50   66   850        diskstats    keys         mtrr          sysrq-trigger</span><br><span class="line">1146  18     261    2851   3207  431  51   7    9          dma          key-users    net           sysvipc</span><br><span class="line">1147  19     262    286    3569  434  52   776  907        driver       kmsg         pagetypeinfo  thread-self</span><br><span class="line">119   2      2650   2873   3570  435  53   779  acpi       execdomains  kpagecgroup  partitions    timer_list</span><br><span class="line">12    20     2683   2875   3594  439  54   780  asound     fb           kpagecount   sched_debug   timer_stats</span><br><span class="line">1213  21     271    2877   3597  442  55   79   buddyinfo  filesystems  kpageflags   schedstat     tty</span><br><span class="line">13    22     273    29     360   447  56   791  bus        fs           loadavg      scsi          uptime</span><br><span class="line">14    22497  27794  2910   3601  449  57   795  cgroups    interrupts   locks        self          version</span><br><span class="line">15    22504  27799  2911   3603  47   58   8    cmdline    iomem        mdstat       slabinfo      version_signature</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="ge-chi-file-system-ming-ming-kong-jian"><a href="#&#x9694;&#x79BB;-File-System-&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x9694;&#x79BB; File System &#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x9694;&#x79BB; File System &#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ge-chi-file-system-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x7ECF;&#x8FC7;&#x524D;&#x9762;&#x7684;&#x8BD5;&#x9A8C;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#x662F;&#x7531;&#x4E8E; <code>/proc</code> &#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684; <code>/proc</code>&#xFF0C;&#x6240;&#x4EE5; <code>ps</code> &#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x5C31;&#x662F;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/proc</code>&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x4E00;&#x76F4;&#x90FD;&#x5728;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x91CC;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x5957;&#x72EC;&#x7ACB;&#x7684; rootfs &#x7ED9;&#x5BB9;&#x5668;&#x3002;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">	<span class="string">&quot;syscall&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">switch</span> os.Args[<span class="number">1</span>] {</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;run&quot;</span>:</span><br><span class="line">		run()</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;child&quot;</span>:</span><br><span class="line">		child()</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;what?&quot;</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;/proc/self/exe&quot;</span>, <span class="built_in">append</span>([]<span class="keyword">string</span>{<span class="string">&quot;child&quot;</span>}, os.Args[<span class="number">2</span>:]...)...)</span><br><span class="line">	cmd.Stdin = os.Stdin</span><br><span class="line">	cmd.Stdout = os.Stdout</span><br><span class="line">	cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">	cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">		Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID | syscall.CLONE_NEWNS,</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">child</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Running %v as pid: %d\n&quot;</span>, os.Args[<span class="number">2</span>:], os.Getpid())</span><br><span class="line">	cmd := exec.Command(os.Args[<span class="number">2</span>], os.Args[<span class="number">3</span>:]...)</span><br><span class="line">	cmd.Stdin = os.Stdin</span><br><span class="line">	cmd.Stdout = os.Stdout</span><br><span class="line">	cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">	must(syscall.Chroot(<span class="string">&quot;/var/lib/alpine&quot;</span>))</span><br><span class="line">	must(os.Chdir(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">	must(syscall.Mount(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">	must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(err error)</span></span> {</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x505A;&#x4E86;&#x4E24;&#x4E2A;&#x6539;&#x52A8;&#x3002;</p>
<p>&#x5176;&#x4E00;&#xFF0C;&#x5728; <code>run()</code> &#x4E2D;&#x589E;&#x52A0; <code>CLONE_NEWNS</code> &#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x4EE5;&#x589E;&#x52A0;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A; mount &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x4E4B;&#x6240;&#x4EE5;&#x53EB; <code>NEWNS</code>&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x610F;&#x601D;&#x662F; <code>New Namespace</code>&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6700;&#x521D;&#x5B9E;&#x73B0; namespace &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x60F3;&#x5230;&#x4E86;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;so&#x2026;&#x2026;&#x1F613;</p>
<p>&#x5176;&#x4E8C;&#xFF0C;&#x5728; <code>child()</code> &#x4E2D;&#xFF0C;<code>chroot</code> &#x5230;&#x6211;&#x4EEC;&#x65B0;&#x7684; rootfs&#xFF1A;<code>/var/lib/alpine</code>&#xFF0C;&#x5E76;&#x4E14;&#x5207;&#x6362;&#x5230;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x6302;&#x8F7D; <code>/proc</code>&#x3002;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">child</span><span class="params">()</span></span> {</span><br><span class="line">	...</span><br><span class="line">	must(syscall.Chroot(<span class="string">&quot;/var/lib/alpine&quot;</span>))</span><br><span class="line">	must(os.Chdir(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">	must(syscall.Mount(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x8BA9;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x81EA;&#x5DF1;&#x7684;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh] as pid: 1</span><br><span class="line">/ <span class="comment"># ps</span></span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 /proc/self/exe child /bin/sh</span><br><span class="line">    4 root       0:00 /bin/sh</span><br><span class="line">    5 root       0:00 ps</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>Yeah! &#x1F4AA; &#x8FD9;&#x6B21;&#x7EC8;&#x4E8E;&#x770B;&#x5230; <code>ps</code> &#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#xFF0C;PID &#x4ECE; 1 &#x5F00;&#x59CB;&#x4E86;&#x3002;&#x1F638;</p>
<h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><p>&#x8FD9;&#x5F88;&#x795E;&#x5947;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x505A;&#x51FA;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6709;&#x4E86;&#x81EA;&#x5DF1;&#x7684; hostname&#x3001;PID&#x3001;mount &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x90FD;&#x548C; Docker &#x5BB9;&#x5668;&#x4E00;&#x6837;&#x3002;&#x7ECF;&#x8FC7;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6240;&#x8C13;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x7279;&#x6B8A;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x5C31;&#x662F;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x4E9B;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3001;&#x6302;&#x8F7D;&#x7B49;&#x3002;&#x4EC5;&#x6B64;&#x800C;&#x5DF2;&#x3002;<strong>&#x5BB9;&#x5668;&#xFF0C;&#x5C31;&#x662F;&#x8FDB;&#x7A0B;&#x3002;</strong></p>
<h2 id="ming-ming-kong-jian-namespace"><a href="#&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09;" class="headerlink" title="&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09;"></a>&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09; <a href="#ming-ming-kong-jian-namespace" class="header-anchor">#</a></h2><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x611F;&#x89C9;&#x5230;&#x4E86;&#x3002;<strong><code>namespace</code>&#x51B3;&#x5B9A;&#x4F60;&#x80FD;&#x770B;&#x5230;&#x4EC0;&#x4E48;</strong></p>
<ul>
<li>UNIX Timesharing System &#xFF08;&#x522B;&#x770B;&#x540D;&#x5B57;&#x5F88;&#x5FFD;&#x60A0;&#xFF0C;&#x5C31;&#x662F; hostname&#xFF09;</li>
<li>Process IDs</li>
<li>File system (&#x5C31;&#x662F; mount)</li>
<li>Users</li>
<li>IPC</li>
<li>Networking</li>
</ul>
<h2 id="kong-zhi-zu-control-groups"><a href="#&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control-groups&#xFF09;" class="headerlink" title="&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control groups&#xFF09;"></a>&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control groups&#xFF09; <a href="#kong-zhi-zu-control-groups" class="header-anchor">#</a></h2><p><strong><code>cgroups</code> &#x63A7;&#x5236;&#x4F60;&#x80FD;&#x7528;&#x4EC0;&#x4E48;</strong></p>
<ul>
<li>CPU</li>
<li>Memory</li>
<li>Disk I/O</li>
<li>Network</li>
<li>Device permissions (<code>/dev</code>)</li>
</ul>
<h2 id="images-rootfs"><a href="#Images-&#xFF08;rootfs&#xFF09;" class="headerlink" title="Images &#xFF08;rootfs&#xFF09;"></a>Images &#xFF08;rootfs&#xFF09; <a href="#images-rootfs" class="header-anchor">#</a></h2><p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x6240;&#x7528;&#x5230;&#x7684; <code>rootfs</code>&#xFF0C;<code>/var/lib/alpine</code> &#x662F;&#x6765;&#x81EA;&#x4E8E; alpine &#x7F51;&#x7AD9;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E; Docker &#x800C;&#x8A00;&#xFF0C;Docker Hub &#x7684;&#x90A3;&#x4E9B;&#x955C;&#x50CF;&#x5728;&#x4E0B;&#x8F7D;&#x4E0B;&#x6765;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x88AB;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7684; <code>rootfs</code> &#x6240;&#x4F7F;&#x7528;&#x3002;&#x5F53;&#x7136;&#x5B9E;&#x9645;&#x7684;&#x7EC6;&#x8282;&#x8981;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF0C;&#x6BD4;&#x5982;&#x5F15;&#x5165;&#x4E86;&#x5206;&#x5C42;&#x5B58;&#x50A8; Union FS &#x7684;&#x6982;&#x5FF5;&#x3001;&#x5143;&#x6570;&#x636E;&#x7B49;&#x7B49;&#x3002;</p>
<p>Liz Rice &#x7684;&#x56E2;&#x961F;&#x5236;&#x4F5C;&#x4E86; <a href="https://microbadger.com/" target="_blank" rel="noopener">https://microbadger.com/</a> &#x6765;&#x5E2E;&#x52A9;&#x67E5;&#x770B;&#x548C;&#x5206;&#x6790;&#x4F4D;&#x4E8E; Docker Hub &#x4E0A;&#x7684;&#x955C;&#x50CF;&#x3002;</p>
<h2 id="jin-yi-bu-yue-du"><a href="#&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB;" class="headerlink" title="&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB;"></a>&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB; <a href="#jin-yi-bu-yue-du" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B; Julien Friedman &#x7684; gist&#xFF1A;<a href="https://bit.ly/1nDqpDI" target="_blank" rel="noopener">https://bit.ly/1nDqpDI</a>&#x3002;&#x4ED6;&#x7684;&#x5B9E;&#x73B0;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x6BD4;&#x5982;&#x91CC;&#x9762;&#x6CA1;&#x6709;&#x4F7F;&#x7528; <code>chroot</code>&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>mount</code> &#x6302;&#x8F7D; <code>rootfs</code>&#x7B49;&#x3002;</p>
</div></article><div class="pagination"><a href="/blog.lab99.org/post/golang-2017-10-20-video-seven-ways-to-profile-go-apps.html" class="pagination-prev">PREV</a><a href="/blog.lab99.org/post/golang-2017-10-09-video-the-new-era-of-go-package-management.html" class="pagination-next">NEXT</a></div><div class="comments"><div id="disqus_thread"></div></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/tags/Sonatype/">Sonatype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/tags/coreos/">coreos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog.lab99.org/tags/docker-summit/">docker summit</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-27-video-how-to-correctly-use-package-context.html">视频笔记：如何正确使用 Context - Jack Lindamood</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-20-video-seven-ways-to-profile-go-apps.html">视频笔记：7种 Go 程序性能分析方法 - Dave Cheney</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-13-video-write-container-in-go-from-scratch.html">视频笔记：容器是什么？让我们用 Go 写一个吧！ - Liz Rice</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-09-video-the-new-era-of-go-package-management.html">视频笔记：Go 包管理的新时代 - Sam Boyer</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-05-video-guide-to-syscall.html">视频笔记：Go 和 syscall - Liz Rice</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html">视频笔记：理解 channels - Kavya Joshi</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-10-01-video-go-build-mode.html">视频笔记：Go 的构建模式 - David Crawshaw</a></li><li class="post-list-item"><a class="post-list-link" href="/blog.lab99.org/post/golang-2017-09-23-video-go-for-crypto-developers.html">视频笔记：Go 密码学应用 - George Tankersley</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><p>© 2020 <a href="/">王涛</a></p></div><div class="power"><p><a href="https://pages.coding.net/">Hosted by Coding Pages</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/twang2218/hexo-theme-jekyll">Jekyll</a></p></div></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="//cdn.bootcss.com/mermaid/7.0.0/mermaid.min.js"></script><script>(function() {
    var d = document, s = d.createElement('script');
    s.src = '//twang2218-coding.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();</script></body></html>