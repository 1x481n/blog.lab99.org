<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 视频笔记：Docker 在线 Meetup 41 - 深入 Docker 1.12 网络 - Madhu Venugopal · 【转载】大桥下的蜗牛</title><meta name="description" content="无善无恶心之体，有善有恶意之动，知善知恶是良知，为善去恶是格物。"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><link rel="stylesheet" href="https://cdn.bootcss.com/mermaid/7.0.0/mermaid.min.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="https://github.com/twang2218" target="_blank" class="nav-link">github</a></li><li class="nav-list-item"><a href="https://coding.net/u/twang2218" target="_blank" class="nav-link">coding</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/post/docker-2016-12-09-video-docker-online-meetup-41-deep-dive-into-docker-1-12-networking.html" class="post-title-link">视频笔记：Docker 在线 Meetup 41 - 深入 Docker 1.12 网络 - Madhu Venugopal</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/docker/" class="post-tag-link">docker</a></li><li class="post-tag-item"><a href="/tags/youtube/" class="post-tag-link">youtube</a></li><li class="post-tag-item"><a href="/tags/notes/" class="post-tag-link">notes</a></li><li class="post-tag-item"><a href="/tags/meetup/" class="post-tag-link">meetup</a></li></ul><div class="post-time">2016年12月9日 星期五</div></div><div class="post-content"><link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#shi-me-shi-libnetwork">&#x4EC0;&#x4E48;&#x662F; <code>libnetwork</code>&#xFF1F;</a></li>
<li><a href="#she-ji-si-xiang">&#x8BBE;&#x8BA1;&#x601D;&#x60F3;</a></li>
<li><a href="#docker-wang-luo-fa-zhan">Docker &#x7F51;&#x7EDC;&#x53D1;&#x5C55;</a></li>
<li><a href="#cnm-rong-qi-wang-luo-mo-xing"><code>CNM</code> &#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;</a></li>
<li><a href="#wang-luo-qu-dong">&#x7F51;&#x7EDC;&#x9A71;&#x52A8;</a><ul>
<li><a href="#case-1-mo-ren-qiao-jie-wang-luo-bridge0">Case 1: &#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC; (<code>bridge0</code>)</a></li>
<li><a href="#case-2-yong-hu-zi-ding-yi-qiao-jie-wang-luo">Case 2: &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC;</a></li>
<li><a href="#case-3-qiao-jie-wang-luo-lian-ru-xia-ceng-wang-luo-bing-shi-yong-ipam-mei-you-nat-duan-kou-ying-she">Case 3: &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;<code>IPAM</code> (&#x6CA1;&#x6709;NAT/&#x7AEF;&#x53E3;&#x6620;&#x5C04;)</a></li>
<li><a href="#case-4-overlay-networking">Case 4: Overlay Networking</a></li>
<li><a href="#case-5-macvlan-1-12-xin-zeng">Case 5: Macvlan (1.12&#x65B0;&#x589E;)</a></li>
</ul>
</li>
<li><a href="#1-12-xin-gong-neng">1.12 &#x65B0;&#x529F;&#x80FD;</a><ul>
<li><a href="#swarm-mode-zhong-de-xin-gong-neng">Swarm Mode &#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</a><ul>
<li><a href="#swarm-mode-zhong-de-duo-su-zhu-hu-lian">Swarm mode &#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;</a></li>
<li><a href="#an-quan-de-kong-zhi-ceng">&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42;</a></li>
<li><a href="#an-quan-de-shu-ju-ceng">&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42;</a></li>
<li><a href="#fu-wu-fa-xian">&#x670D;&#x52A1;&#x53D1;&#x73B0;</a></li>
<li><a href="#fu-zai-jun-heng">&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li>
<li><a href="#mesh-lu-you">Mesh &#x8DEF;&#x7531;</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup #41: Deep Dive into Docker 1.12 Networking<br>by Madhu Venugopal</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/nXaF2d97JnE" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=nXaF2d97JnE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=nXaF2d97JnE</a></p>
<h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>Madhu Venugopal &#x4EE5;&#x524D;&#x662F; DockerPlane &#x7684; CEO&#xFF0C;&#x540E;&#x6765;&#x88AB; Docker &#x6536;&#x8D2D;&#x4E86;&#x3002;</p>
<h1 id="shi-me-shi-libnetwork"><a href="#&#x4EC0;&#x4E48;&#x662F;-libnetwork&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; <code>libnetwork</code>&#xFF1F; <a href="#shi-me-shi-libnetwork" class="header-anchor">#</a></h1><p><code>libnetwork</code> &#x662F;&#x7F51;&#x7EDC;&#x90E8;&#x5206;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x9A71;&#x52A8;&#x63A5;&#x53E3;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x4E86;&#x6570;&#x636E;&#x5C42;&#x3001;&#x63A7;&#x5236;&#x5C42;&#x7B49;&#x7B49;&#x3002;</p>
<ul>
<li>Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE;</li>
<li>&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;</li>
<li>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;&#xFF08;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x4F7F;&#x7528;&#x5916;&#x90E8;&#x5730;&#x5740;&#x7BA1;&#x7406;&#xFF09;</li>
<li>&#x63D0;&#x4F9B;&#x539F;&#x751F;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8054;</li>
<li>&#x63D0;&#x4F9B;&#x539F;&#x751F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li>
<li>&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x6269;&#x5C55;&#xFF0C;&#x5F62;&#x6210;&#x751F;&#x6001;&#x73AF;&#x5883;</li>
</ul>
<h1 id="she-ji-si-xiang"><a href="#&#x8BBE;&#x8BA1;&#x601D;&#x60F3;" class="headerlink" title="&#x8BBE;&#x8BA1;&#x601D;&#x60F3;"></a>&#x8BBE;&#x8BA1;&#x601D;&#x60F3; <a href="#she-ji-si-xiang" class="header-anchor">#</a></h1><p>&#x7528;&#x6237;&#x662F;&#x7B2C;&#x4E00;&#x4F4D;&#x7684;</p>
<ul>
<li>&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x4EBA;&#x5458;</li>
<li>IT/&#x7F51;&#x7EDC;&#x8FD0;&#x7EF4;&#x4EBA;&#x5458;</li>
</ul>
<p>&#x63D2;&#x4EF6; API &#x8BBE;&#x8BA1;</p>
<ul>
<li>&#x601D;&#x60F3;&#x662F;&#xFF1A;<code>&#x5185;&#x7F6E;&#x7535;&#x6C60;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x66F4;&#x6362;</code></li>
</ul>
<h1 id="docker-wang-luo-fa-zhan"><a href="#Docker-&#x7F51;&#x7EDC;&#x53D1;&#x5C55;" class="headerlink" title="Docker &#x7F51;&#x7EDC;&#x53D1;&#x5C55;"></a>Docker &#x7F51;&#x7EDC;&#x53D1;&#x5C55; <a href="#docker-wang-luo-fa-zhan" class="header-anchor">#</a></h1><ul>
<li>Docker <code>1.7</code>:<ul>
<li>&#x72EC;&#x7ACB;&#x51FA; <code>libnetwork</code> &#x9879;&#x76EE;</li>
<li>&#x8BBE;&#x8BA1; <code>CNM</code> (&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;)</li>
<li>&#x8FC1;&#x79FB;&#x65E7;&#x7684; <code>bridge</code>, <code>host</code>, <code>none</code> &#x5230; <code>CNM</code> &#x4E0B;&#x3002;</li>
</ul>
</li>
<li>Docker <code>1.8</code>:<ul>
<li>&#x901A;&#x8FC7; <code>/etc/hosts</code> &#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x53D1;&#x73B0;</li>
</ul>
</li>
<li>Docker <code>1.9</code>:<ul>
<li>&#x5B9E;&#x73B0;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8054;</li>
<li>&#x7F51;&#x7EDC;&#x63D2;&#x4EF6;</li>
<li><code>IPAM</code> (IP &#x5730;&#x5740;&#x7BA1;&#x7406;) &#x63D2;&#x4EF6;</li>
<li>&#x7F51;&#x7EDC; <code>UX/API</code></li>
</ul>
</li>
<li>Docker <code>1.10</code>:<ul>
<li>&#x5185;&#x7F6E;&#x5206;&#x5E03;&#x5F0F; <code>DNS</code> &#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;</li>
</ul>
</li>
<li>Docker <code>1.11</code>:<ul>
<li>&#x6DFB;&#x52A0;&#x7F51;&#x7EDC;&#x522B;&#x540D; <code>alias</code></li>
<li>&#x5B9E;&#x73B0; DNS &#x8F6E;&#x8BE2;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li>
</ul>
</li>
<li>Docker <code>1.12</code>:<ul>
<li>&#x5B9E;&#x73B0;&#x57FA;&#x4E8E;<code>IPVS</code>&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li>
<li>&#x52A0;&#x5BC6;&#x63A7;&#x5236;&#x5C42;&#x548C;&#x6570;&#x636E;&#x5C42;</li>
<li>Mesh &#x8DEF;&#x7531;</li>
<li>&#x5185;&#x7F6E; Swarm Mode &#x96C6;&#x7FA4;&#x7F51;&#x7EDC;&#x4E92;&#x8054;</li>
</ul>
</li>
</ul>
<h1 id="cnm-rong-qi-wang-luo-mo-xing"><a href="#CNM-&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;" class="headerlink" title="CNM &#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;"></a><code>CNM</code> &#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B; <a href="#cnm-rong-qi-wang-luo-mo-xing" class="header-anchor">#</a></h1><p><a href="https://github.com/docker/libnetwork/blob/master/docs/design.md" target="_blank" rel="noopener">https://github.com/docker/libnetwork/blob/master/docs/design.md</a></p>
<ul>
<li><code>Endpoint</code></li>
<li><code>Network</code></li>
<li><code>Sandbox</code></li>
<li><code>Driver</code> &amp; <code>Plugins</code></li>
</ul>
<h1 id="wang-luo-qu-dong"><a href="#&#x7F51;&#x7EDC;&#x9A71;&#x52A8;" class="headerlink" title="&#x7F51;&#x7EDC;&#x9A71;&#x52A8;"></a>&#x7F51;&#x7EDC;&#x9A71;&#x52A8; <a href="#wang-luo-qu-dong" class="header-anchor">#</a></h1><h2 id="case-1-mo-ren-qiao-jie-wang-luo-bridge0"><a href="#Case-1-&#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC;-bridge0" class="headerlink" title="Case 1: &#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC; (bridge0)"></a>Case 1: &#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC; (<code>bridge0</code>) <a href="#case-1-mo-ren-qiao-jie-wang-luo-bridge0" class="header-anchor">#</a></h2><p>&#x5BB9;&#x5668;&#x5185;&#x7684; <code>eth0</code> &#x8FDE;&#x63A5;&#x5230;&#x6865;&#x63A5;&#x63A5;&#x53E3; <code>docker0</code>&#xFF0C;&#x7136;&#x540E;&#x5BBF;&#x4E3B;&#x7684; <code>iptables</code> &#x6765;&#x8D1F;&#x8D23; <code>NAT/port-mapping</code> &#x8FDB;&#x884C;&#x5BB9;&#x5668;&#x5185;&#x548C;&#x5BB9;&#x5668;&#x5916;&#x7684;&#x8F6C;&#x6362;&#x4E92;&#x8054;&#xFF0C;&#x6700;&#x540E;&#x6570;&#x636E;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B;&#x7684; <code>eth0</code> &#x8FDE;&#x63A5;&#x5230;&#x4EA4;&#x6362;&#x673A;&#x4E0A;&#x3002;&#x4EA4;&#x6362;&#x673A;&#x53EF;&#x4EE5;&#x662F;&#x666E;&#x901A;&#x7684; <code>ToR(Top-of-Rack) &#x4EA4;&#x6362;</code>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x865A;&#x62DF;&#x6846;&#x67B6;&#x7684; <code>Hypervisor &#x4EA4;&#x6362;</code>&#x3002;</p>
<h2 id="case-2-yong-hu-zi-ding-yi-qiao-jie-wang-luo"><a href="#Case-2-&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC;" class="headerlink" title="Case 2: &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC;"></a>Case 2: &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC; <a href="#case-2-yong-hu-zi-ding-yi-qiao-jie-wang-luo" class="header-anchor">#</a></h2><p>&#x5728;&#x6BCF;&#x4E2A;&#x5BBF;&#x4E3B;&#x4E0A;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">	-d bridge \</span><br><span class="line">	-o com.docker.network.bridge.name=brnet \</span><br><span class="line">	brnet</span><br><span class="line">$ docker run --net=brnet -it busybox ifconfig</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x79CD;&#x62D3;&#x6251;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x662F;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x63A5;&#x53E3;&#x8BBF;&#x95EE; <code>brnet</code> &#x63A5;&#x53E3;&#xFF0C;&#x800C; <code>brnet</code> &#x901A;&#x8FC7;&#x5BBF;&#x4E3B; <code>iptables</code> &#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x6620;&#x5C04;&#xFF0C;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B;&#x7684; <code>eth0</code> &#x8BBF;&#x95EE;&#x4EA4;&#x6362;&#x3002;</p>
<h2 id="case-3-qiao-jie-wang-luo-lian-ru-xia-ceng-wang-luo-bing-shi-yong-ipam-mei-you-nat-duan-kou-ying-she"><a href="#Case-3-&#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;IPAM-&#x6CA1;&#x6709;NAT-&#x7AEF;&#x53E3;&#x6620;&#x5C04;" class="headerlink" title="Case 3: &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;IPAM (&#x6CA1;&#x6709;NAT/&#x7AEF;&#x53E3;&#x6620;&#x5C04;)"></a>Case 3: &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;<code>IPAM</code> (&#x6CA1;&#x6709;NAT/&#x7AEF;&#x53E3;&#x6620;&#x5C04;) <a href="#case-3-qiao-jie-wang-luo-lian-ru-xia-ceng-wang-luo-bing-shi-yong-ipam-mei-you-nat-duan-kou-ying-she" class="header-anchor">#</a></h2><p>&#x5728;&#x6BCF;&#x4E2A;&#x5BBF;&#x4E3B;&#x6267;&#x884C;&#x4E0B;&#x5217;&#x6307;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">	-d bridge \</span><br><span class="line">	--subnet=192.168.57.0/24 \</span><br><span class="line">	--ip-range=192.168.57.32/28 \</span><br><span class="line">	--gateway=192.168.57.11 \</span><br><span class="line">	--aux-address DefaultGatewayIPv4=192.168.57.1 \</span><br><span class="line">	-o com.docker.network.bridge.name=brnet \</span><br><span class="line">	brnet</span><br><span class="line">$ brctl addif brnet eth2</span><br><span class="line">$ docker run --net=brnet -it busybox ifconfig</span><br></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x5176;&#x5B83;&#x4E3B;&#x673A;&#x7684; <code>--ip-range</code> &#x548C; <code>--gateway</code> &#x9700;&#x8981;&#x505A;&#x5BF9;&#x5E94;&#x8C03;&#x6574;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x62D3;&#x6251;&#x662F;&#xFF0C;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x8FDE;&#x63A5; <code>brnet</code> &#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x76F4;&#x63A5;&#x901A;&#x8FC7; <code>eth2</code> &#x8BBF;&#x95EE;&#x4EA4;&#x6362;&#x3002;</p>
<h2 id="case-4-overlay-networking"><a href="#Case-4-Overlay-Networking" class="headerlink" title="Case 4: Overlay Networking"></a>Case 4: Overlay Networking <a href="#case-4-overlay-networking" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x8FDE;&#x63A5; <code>ov-net1</code> &#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x901A;&#x8FC7;<code>VXVLAN-VNI 100</code> &#x8FDB;&#x884C;&#x5BBF;&#x4E3B;&#x95F4;&#x4E92;&#x8FDE;&#xFF0C;&#x5BBF;&#x4E3B;&#x95F4;&#x901A;&#x8FC7; <code>Gossip</code> &#x534F;&#x8BAE;&#x5F97;&#x77E5;&#x5404;&#x81EA;&#x7F51;&#x7EDC;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x540C;&#x65F6;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x8FD8;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5185; <code>eth1</code> &#x8FDE;&#x63A5; <code>docker_gwbridge</code> &#xFF0C;&#x518D;&#x901A;&#x8FC7; <code>iptables</code> &#x8FDB;&#x884C;NAT&#x4EE5;&#x53CA;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B; <code>eth0</code> &#x8FDE;&#x63A5;&#x4EA4;&#x6362;&#x3002;</p>
<h2 id="case-5-macvlan-1-12-xin-zeng"><a href="#Case-5-Macvlan-1-12&#x65B0;&#x589E;" class="headerlink" title="Case 5: Macvlan (1.12&#x65B0;&#x589E;)"></a>Case 5: Macvlan (1.12&#x65B0;&#x589E;) <a href="#case-5-macvlan-1-12-xin-zeng" class="header-anchor">#</a></h2><p>&#x5728; <code>VLAN 10</code> &#x4E0A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">	-d macvlan \</span><br><span class="line">	--subnet=10.1.10.0/24 \</span><br><span class="line">	--gateway=10.1.10.1 \</span><br><span class="line">	-o parent=eth0.10 \</span><br><span class="line">	mcvlan10</span><br><span class="line">$ docker run --net=mcvlan10 -it --rm alpine /bin/sh</span><br></pre></td></tr></table></figure>
<p>&#x5728; <code>VLAN 20</code> &#x4E0A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">	-d macvlan \</span><br><span class="line">	--subnet=10.1.20.0/24 \</span><br><span class="line">	--gateway=10.1.20.1 \</span><br><span class="line">	-o parent=eth0.20 \</span><br><span class="line">	mcvlan20</span><br><span class="line">$ docker run --net=mcvlan20 -it --rm alpine /bin/sh</span><br></pre></td></tr></table></figure>
<p>&#x5BB9;&#x5668;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x8BBF;&#x95EE;&#x5BBF;&#x4E3B; <code>eth0.10</code> &#x63A5;&#x53E3;&#x5E76;&#x9644;&#x4E0A; <code>VLAN 10</code> &#x6807;&#x7B7E;&#xFF0C;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B; <code>eth0</code> &#x8D70; <code>802.1Q Trunk</code> &#x51FA;&#x5BBF;&#x4E3B;&#x63A5;&#x5230;&#x4EA4;&#x6362;&#x673A;&#x4E0A;&#x53BB;&#x3002;</p>
<h1 id="1-12-xin-gong-neng"><a href="#1-12-&#x65B0;&#x529F;&#x80FD;" class="headerlink" title="1.12 &#x65B0;&#x529F;&#x80FD;"></a>1.12 &#x65B0;&#x529F;&#x80FD; <a href="#1-12-xin-gong-neng" class="header-anchor">#</a></h1><h2 id="swarm-mode-zhong-de-xin-gong-neng"><a href="#Swarm-Mode-&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;" class="headerlink" title="Swarm Mode &#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;"></a>Swarm Mode &#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD; <a href="#swarm-mode-zhong-de-xin-gong-neng" class="header-anchor">#</a></h2><ul>
<li>cluster aware</li>
<li>&#x5206;&#x5E03;&#x5F0F;&#x63A7;&#x5236;&#x5C42;</li>
<li>&#x9AD8;&#x6269;&#x5C55;&#x6027;</li>
</ul>
<h3 id="swarm-mode-zhong-de-duo-su-zhu-hu-lian"><a href="#Swarm-mode-&#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;" class="headerlink" title="Swarm mode &#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;"></a>Swarm mode &#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE; <a href="#swarm-mode-zhong-de-duo-su-zhu-hu-lian" class="header-anchor">#</a></h3><ul>
<li>&#x57FA;&#x4E8E; <code>VxLAN</code> &#x8FDB;&#x884C;&#x6570;&#x636E;&#x4E92;&#x8FDE;</li>
<li>&#x65E0;&#x9700;&#x5916;&#x7F6E;&#x952E;&#x503C;&#x5E93;</li>
<li>&#x96C6;&#x4E2D;&#x8D44;&#x6E90;&#x5206;&#x914D;</li>
<li>&#x6539;&#x8FDB;&#x6027;&#x80FD;</li>
<li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;</li>
</ul>
<h3 id="an-quan-de-kong-zhi-ceng"><a href="#&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42;" class="headerlink" title="&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42;"></a>&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42; <a href="#an-quan-de-kong-zhi-ceng" class="header-anchor">#</a></h3><ul>
<li>&#x57FA;&#x4E8E; <code>Gossip</code> &#x534F;&#x8BAE;&#xFF08;<em>&#x770B;&#x6765;&#x516B;&#x5366;&#x8FD8;&#x662F;&#x5F88;&#x5F3A;&#x5927;&#x7684;</em>&#xFF09;</li>
<li>&#x7F51;&#x7EDC;&#x8303;&#x7574;&#x7684; <code>Gossip</code></li>
<li>&#x5FEB;&#x901F;&#x6536;&#x655B;</li>
<li>&#x9ED8;&#x8BA4;&#x5B89;&#x5168;<ul>
<li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li>
<li>Swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li>
</ul>
</li>
<li><code>Gossip</code> &#x63A7;&#x5236;&#x6D88;&#x606F;<ul>
<li>&#x8DEF;&#x7531;&#x72B6;&#x6001;</li>
<li>&#x670D;&#x52A1;&#x53D1;&#x73B0;</li>
<li>&#x63D2;&#x4EF6;&#x6570;&#x636E;</li>
</ul>
</li>
<li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;&#x6027;</li>
</ul>
<h3 id="an-quan-de-shu-ju-ceng"><a href="#&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42;" class="headerlink" title="&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42;"></a>&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42; <a href="#an-quan-de-shu-ju-ceng" class="header-anchor">#</a></h3><ul>
<li>&#x5728; <code>overlay network</code> &#x521B;&#x5EFA;&#x65F6;&#x4F5C;&#x4E3A;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</li>
<li>&#x4F7F;&#x7528;&#x5185;&#x6838; <code>IPSec</code> &#x6A21;&#x5757;</li>
<li>&#x6309;&#x9700; Tunnel &#x8BBE;&#x7F6E;</li>
<li>Swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li>
<li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li>
</ul>
<h3 id="fu-wu-fa-xian"><a href="#&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#fu-wu-fa-xian" class="header-anchor">#</a></h3><ul>
<li>&#x7531;&#x5185;&#x7F6E; DNS &#x63D0;&#x4F9B;&#x652F;&#x6301;</li>
<li>&#x9AD8;&#x53EF;&#x7528;(HA)</li>
<li>&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x53D6;&#x5F97;&#x72B6;&#x6001;&#x4FE1;&#x606F;</li>
<li>&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x548C;Task</li>
</ul>
<h3 id="fu-zai-jun-heng"><a href="#&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#fu-zai-jun-heng" class="header-anchor">#</a></h3><ul>
<li>&#x5305;&#x62EC;&#x5185;&#x90E8;<code>internal</code>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x548C;&#x8FB9;&#x754C;<code>ingress</code>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li>
<li>&#x652F;&#x6301; <code>VIP</code> &#x548C; <code>DNS-RR</code></li>
<li>&#x9AD8;&#x53EF;&#x7528;</li>
<li>&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x83B7;&#x53D6;&#x72B6;&#x6001;&#x4FE1;&#x606F;</li>
<li>&#x6700;&#x5C0F;&#x6027;&#x80FD;&#x635F;&#x8017;</li>
</ul>
<h3 id="mesh-lu-you"><a href="#Mesh-&#x8DEF;&#x7531;" class="headerlink" title="Mesh &#x8DEF;&#x7531;"></a>Mesh &#x8DEF;&#x7531; <a href="#mesh-lu-you" class="header-anchor">#</a></h3><ul>
<li>&#x5728;&#x8FB9;&#x754C;&#x8DEF;&#x7531;&#x5185;&#x7F6E; routing mesh</li>
<li>&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E5F;&#x53C2;&#x52A0;&#x8FB9;&#x754C; routing mesh</li>
<li>&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x63A5;&#x53D7;&#x53D1;&#x9001;&#x7ED9; <code>PublishedPort</code> &#x7684;&#x8BF7;&#x6C42;</li>
<li>&#x7AEF;&#x53E3;&#x8F6C;&#x6362;&#x53D1;&#x751F;&#x5728;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x5185;&#x90E8;&#x548C;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x673A;&#x5236;</li>
</ul>
</div></article><div class="pagination"><a href="/post/docker-2016-12-10-video-docker-online-meetup-42-tips-and-tricks-for-using-docker.html" class="pagination-prev">PREV</a><a href="/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html" class="pagination-next">NEXT</a></div><div class="comments"><div id="disqus_thread"></div></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sonatype/">Sonatype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coreos/">coreos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-summit/">docker summit</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-27-video-how-to-correctly-use-package-context.html">视频笔记：如何正确使用 Context - Jack Lindamood</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-20-video-seven-ways-to-profile-go-apps.html">视频笔记：7种 Go 程序性能分析方法 - Dave Cheney</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-13-video-write-container-in-go-from-scratch.html">视频笔记：容器是什么？让我们用 Go 写一个吧！ - Liz Rice</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-09-video-the-new-era-of-go-package-management.html">视频笔记：Go 包管理的新时代 - Sam Boyer</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-05-video-guide-to-syscall.html">视频笔记：Go 和 syscall - Liz Rice</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-04-video-understanding-channels.html">视频笔记：理解 channels - Kavya Joshi</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-10-01-video-go-build-mode.html">视频笔记：Go 的构建模式 - David Crawshaw</a></li><li class="post-list-item"><a class="post-list-link" href="/post/golang-2017-09-23-video-go-for-crypto-developers.html">视频笔记：Go 密码学应用 - George Tankersley</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><p>© 2020 <a href="/">王涛</a></p></div><div class="power"><p><a href="https://pages.coding.net/">Hosted by Coding Pages</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/twang2218/hexo-theme-jekyll">Jekyll</a></p></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80785538-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?ee75cf08ad330aa99f8540efa2570970";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="//cdn.bootcss.com/mermaid/7.0.0/mermaid.min.js"></script><script>(function() {
    var d = document, s = d.createElement('script');
    s.src = '//twang2218-coding.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();</script></body></html>