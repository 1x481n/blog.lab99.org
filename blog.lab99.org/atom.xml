<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>大桥下的蜗牛</title>
  
  
  <link href="/blog.lab99.org//blog.lab99.org/atom.xml" rel="self"/>
  
  <link href="https://1x481n.github.io/blog.lab99.org/"/>
  <updated>2020-10-26T19:10:47.627Z</updated>
  <id>https://1x481n.github.io/blog.lab99.org/</id>
  
  <author>
    <name>王涛</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>视频笔记：如何正确使用 Context - Jack Lindamood</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-27-video-how-to-correctly-use-package-context.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-27-video-how-to-correctly-use-package-context.html</id>
    <published>2017-10-26T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.627Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#wei-shi-me-xu-yao-context">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981; <code>Context</code></a></li><li><a href="#context-shi-xian-xi-jie"><code>Context</code> &#x5B9E;&#x73B0;&#x7EC6;&#x8282;</a><ul><li><a href="#shi-li-context-lian">&#x793A;&#x4F8B; <code>Context</code> &#x94FE;</a></li><li><a href="#context-context-api"><code>context.Context</code> API</a></li><li><a href="#shi-me-shi-hou-ying-gai-shi-yong-context">&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>Context</code>&#xFF1F;</a></li><li><a href="#ru-he-chuang-jian-context">&#x5982;&#x4F55;&#x521B;&#x5EFA; <code>Context</code>&#xFF1F;</a></li><li><a href="#ru-he-ji-cheng-dao-api-li">&#x5982;&#x4F55;&#x96C6;&#x6210;&#x5230; API &#x91CC;&#xFF1F;</a></li><li><a href="#context-fang-na"><code>Context</code> &#x653E;&#x54EA;&#xFF1F;</a></li><li><a href="#context-bao-de-zhu-yi-shi-xiang"><code>Context</code> &#x5305;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li><li><a href="#zhong-zhi-qing-qiu-request-cancellation">&#x7EC8;&#x6B62;&#x8BF7;&#x6C42; (Request Cancellation)</a></li><li><a href="#context-value-request-fan-chou-de-zhi"><code>Context.Value</code> - Request &#x8303;&#x7574;&#x7684;&#x503C;</a><ul><li><a href="#context-value-api-de-wan-jin-you-duct-tape"><code>context.Value</code> API &#x7684;&#x4E07;&#x91D1;&#x6CB9;&#xFF08;duct tape)</a></li><li><a href="#yue-shu-key-de-kong-jian">&#x7EA6;&#x675F; key &#x7684;&#x7A7A;&#x95F4;</a></li><li><a href="#context-value-shi-immutable-de"><code>Context.Value</code> &#x662F; immutable &#x7684;</a></li><li><a href="#ying-gai-ba-shi-me-fang-dao-context-value-li">&#x5E94;&#x8BE5;&#x628A;&#x4EC0;&#x4E48;&#x653E;&#x5230; <code>Context.Value</code> &#x91CC;&#xFF1F;</a></li><li><a href="#na-me-yong-context-value-you-shi-me-wen-ti">&#x90A3;&#x4E48;&#x7528; <code>Context.Value</code> &#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</a></li><li><a href="#na-shi-me-ke-yi-fang-dao-context-value-li-qu">&#x90A3;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x653E;&#x5230; <code>Context.Value</code> &#x91CC;&#x53BB;&#xFF1F;</a></li><li><a href="#li-zi">&#x4F8B;&#x5B50;</a></li><li><a href="#ren-men-lan-yong-context-value-de-yuan-yin">&#x4EBA;&#x4EEC;&#x6EE5;&#x7528; <code>Context.Value</code> &#x7684;&#x539F;&#x56E0;</a></li></ul></li><li><a href="#zong-jie-context-value">&#x603B;&#x7ED3; <code>Context.Value</code></a></li></ul></li><li><a href="#zong-jie-context">&#x603B;&#x7ED3; <code>Context</code></a></li><li><a href="#q-a">Q&amp;A</a><ul><li><a href="#shu-ju-ku-de-fang-wen-ye-yong-context-me">&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BBF;&#x95EE;&#x4E5F;&#x7528; Context &#x4E48;&#xFF1F;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>How to correctly use package context</strong><br>by Jack Lindamood<br>at Golang UK Conf. 2017</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/-_B5uQ4UGi0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><ul><li>&#x89C6;&#x9891;&#xFF1A;<a href="https://www.youtube.com/watch?v=-_B5uQ4UGi0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=-_B5uQ4UGi0</a></li><li>&#x535A;&#x6587;&#xFF1A;<a href="https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39" target="_blank" rel="noopener">https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39</a></li></ul><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>Jack Lindamood <a href="https://github.com/cep21" target="_blank" rel="noopener">Github: @cep21</a>, <a href="https://medium.com/@cep21" target="_blank" rel="noopener">Medium: @cep21</a>&#xFF0C; email: cep221 at gmail.com</p><ul><li>&#x5DF2;&#x7ECF;&#x5199;&#x4E86; 4 &#x5E74; Go &#x4E86;</li><li>&#x76EE;&#x524D;&#x662F; Twitch &#x7684;&#x8F6F;&#x4EF6;&#x5DE5;&#x7A0B;&#x5E08;</li><li>Twitch &#x7684;&#x4E3B;&#x8981;&#x540E;&#x7AEF;&#x90FD;&#x662F;&#x7528; Go &#x5199;&#x7684;</li><li>&#x6709;&#x51E0;&#x767E;&#x4E2A;&#x9879;&#x76EE; repo</li></ul><h1 id="wei-shi-me-xu-yao-context"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;-Context" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981; Context"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981; <code>Context</code> <a href="#wei-shi-me-xu-yao-context" class="header-anchor">#</a></h1><ul><li>&#x6BCF;&#x4E00;&#x4E2A;<strong>&#x957F;&#x8BF7;&#x6C42;</strong>&#x90FD;&#x5E94;&#x8BE5;&#x6709;&#x4E2A;<em>&#x8D85;&#x65F6;&#x9650;&#x5236;</em></li><li>&#x9700;&#x8981;&#x5728;&#x8C03;&#x7528;&#x4E2D;&#x4F20;&#x9012;&#x8FD9;&#x4E2A;&#x8D85;&#x65F6;<ul><li>&#x6BD4;&#x5982;&#x5F00;&#x59CB;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x8BF4;&#x662F; 3 &#x79D2;&#x949F;&#x8D85;&#x65F6;</li><li>&#x90A3;&#x4E48;&#x5728;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x4E2D;&#x95F4;&#xFF0C;&#x8FD9;&#x4E2A;&#x8D85;&#x65F6;&#x8FD8;&#x5269;&#x591A;&#x5C11;&#x65F6;&#x95F4;&#x4E86;&#xFF1F;</li><li>&#x9700;&#x8981;&#x5728;&#x4EC0;&#x4E48;&#x5730;&#x65B9;&#x5B58;&#x50A8;&#x8FD9;&#x4E2A;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x6837;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x4E2D;&#x95F4;&#x53EF;&#x4EE5;&#x505C;&#x6B62;</li></ul></li></ul><p>&#x5982;&#x679C;&#x8FDB;&#x4E00;&#x6B65;&#x8003;&#x8651;&#x3002;</p><p><img src="../pics/golang/context/rpc-fails-1.svg" alt="rpc fails"></p><p>&#x5982;&#x4E0A;&#x56FE;&#x8FD9;&#x6837;&#x7684; RPC &#x8C03;&#x7528;&#xFF0C;&#x5F00;&#x59CB;&#x8C03;&#x7528; <code>RPC 1</code> &#x540E;&#xFF0C;&#x91CC;&#x9762;&#x5206;&#x522B;&#x8C03;&#x7528;&#x4E86; <code>RPC 2</code>, <code>RPC 3</code>, <code>RPC 4</code>&#xFF0C;&#x7B49;&#x6240;&#x6709; RPC &#x8C03;&#x7528;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;</p><p>&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C; <code>RPC 2</code> &#x8C03;&#x7528;&#x5931;&#x8D25;&#x4E86;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#xFF1F;</p><p><img src="../pics/golang/context/rpc-fails-2.svg" alt="rpc fails"></p><p><code>RPC 2</code> &#x5931;&#x8D25;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; Context &#x7684;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F9D;&#x65E7;&#x4F1A;&#x7B49;&#x6240;&#x6709;&#x7684; RPC &#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E; <code>RPC 2</code> &#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x5B9E;&#x5176;&#x5B83;&#x7684; RPC &#x7ED3;&#x679C;&#x610F;&#x4E49;&#x4E0D;&#x5927;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x4F9D;&#x65E7;&#x9700;&#x8981;&#x7ED9;&#x7528;&#x6237;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x767D;&#x767D;&#x7684;&#x6D6A;&#x8D39;&#x4E86; 10ms&#xFF0C;&#x5B8C;&#x5168;&#x6CA1;&#x5FC5;&#x8981;&#x53BB;&#x7B49;&#x5F85;&#x5176;&#x5B83; RPC &#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p><p>&#x90A3;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728; <code>RPC 2</code> &#x5931;&#x8D25;&#x540E;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x7ED9;&#x7528;&#x6237;&#x8FD4;&#x56DE;&#x5931;&#x8D25;&#x5462;&#xFF1F;</p><p><img src="../pics/golang/context/rpc-fails-3.svg" alt="rpc fails"></p><p>&#x7528;&#x6237;&#x662F;&#x5728; 30ms &#x7684;&#x4F4D;&#x7F6E;&#x6536;&#x5230;&#x4E86;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#xFF0C;&#x53EF;&#x662F; <code>RPC 3</code> &#x548C; <code>RPC 4</code> &#x4F9D;&#x7136;&#x5728;&#x6CA1;&#x610F;&#x4E49;&#x7684;&#x8FD0;&#x884C;&#xFF0C;&#x8FD8;&#x5728;&#x6D6A;&#x8D39;&#x8BA1;&#x7B97;&#x548C;IO&#x8D44;&#x6E90;&#x3002;</p><p><img src="../pics/golang/context/rpc-fails-4.svg" alt="rpc fails"></p><p>&#x6240;&#x4EE5;&#x7406;&#x60F3;&#x72B6;&#x6001;&#x5E94;&#x8BE5;&#x662F;&#x5982;&#x4E0A;&#x56FE;&#xFF0C;&#x5F53; <code>RPC 2</code> &#x51FA;&#x9519;&#x540E;&#xFF0C;&#x9664;&#x4E86;&#x8FD4;&#x56DE;&#x7528;&#x6237;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x5E94;&#x8BE5;&#x6709;&#x67D0;&#x79CD;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x901A;&#x77E5; <code>RPC 3</code> &#x548C; <code>RPC 4</code>&#xFF0C;&#x8BA9;&#x4ED6;&#x4EEC;&#x4E5F;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#xFF0C;&#x4E0D;&#x518D;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#x3002;</p><p>&#x6240;&#x4EE5;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x662F;&#xFF1A;</p><ul><li>&#x7528;&#x4FE1;&#x53F7;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x901A;&#x77E5;&#x8BF7;&#x6C42;&#x8BE5;&#x505C;&#x4E86;</li><li>&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x5173;&#x4E8E;&#x4EC0;&#x4E48;&#x65F6;&#x95F4;&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x4F1A;&#x7ED3;&#x675F;&#x7684;&#x63D0;&#x793A;&#xFF08;&#x8D85;&#x65F6;&#xFF09;</li><li>&#x7528; channel &#x6765;&#x901A;&#x77E5;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x4E86;</li></ul><p>&#x90A3;&#x5E72;&#x8106;&#x8BA9;&#x6211;&#x4EEC;&#x628A;&#x53D8;&#x91CF;&#x4E5F;&#x6254;&#x90A3;&#x5427;&#x3002;&#x1F608;</p><ul><li>&#x5728; Go &#x4E2D;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;/go routine &#x53D8;&#x91CF;<ul><li>&#x5176;&#x5B9E;&#x633A;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x5C31;&#x4F1A;&#x8BA9; goroutine &#x4E92;&#x76F8;&#x4EA7;&#x751F;&#x4F9D;&#x8D56;</li></ul></li><li><em>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x88AB;&#x6EE5;&#x7528;</em></li></ul><h1 id="context-shi-xian-xi-jie"><a href="#Context-&#x5B9E;&#x73B0;&#x7EC6;&#x8282;" class="headerlink" title="Context &#x5B9E;&#x73B0;&#x7EC6;&#x8282;"></a><code>Context</code> &#x5B9E;&#x73B0;&#x7EC6;&#x8282; <a href="#context-shi-xian-xi-jie" class="header-anchor">#</a></h1><p><code>context.Context</code>&#xFF1A;</p><ul><li>&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;(immutable)&#x6811;&#x8282;&#x70B9;</li><li>Cancel &#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4F1A;&#x8FDE;&#x5E26; Cancel &#x5176;&#x6240;&#x6709;&#x5B50;&#x8282;&#x70B9; &#xFF08;<em>&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;</em>&#xFF09;</li><li>Context values &#x662F;&#x4E00;&#x4E2A;&#x8282;&#x70B9;</li><li>Value &#x67E5;&#x627E;&#x662F;&#x56DE;&#x6EAF;&#x6811;&#x7684;&#x65B9;&#x5F0F; &#xFF08;<em>&#x4ECE;&#x4E0B;&#x5230;&#x4E0A;</em>&#xFF09;</li></ul><h2 id="shi-li-context-lian"><a href="#&#x793A;&#x4F8B;-Context-&#x94FE;" class="headerlink" title="&#x793A;&#x4F8B; Context &#x94FE;"></a>&#x793A;&#x4F8B; <code>Context</code> &#x94FE; <a href="#shi-li-context-lian" class="header-anchor">#</a></h2><p>&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#xFF1A;<a href="https://play.golang.org/p/ddpofBV1QS" target="_blank" rel="noopener">https://play.golang.org/p/ddpofBV1QS</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tree</span><span class="params">()</span></span> {</span><br><span class="line">  ctx1 := context.Background()</span><br><span class="line">  ctx2, _ := context.WithCancel(ctx1)</span><br><span class="line">  ctx3, _ := context.WithTimeout(ctx2, time.Second * <span class="number">5</span>)</span><br><span class="line">  ctx4, _ := context.WithTimeout(ctx3, time.Second * <span class="number">3</span>)</span><br><span class="line">  ctx5, _ := context.WithTimeout(ctx3, time.Second * <span class="number">6</span>)</span><br><span class="line">  ctx6 := context.WithValue(ctx5, <span class="string">&quot;userID&quot;</span>, <span class="number">12</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x8FD9;&#x6837;&#x6784;&#x6210;&#x7684; <code>Context</code> &#x94FE;&#xFF0C;&#x5176;&#x5F62;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p><p><img src="../pics/golang/context/context-chain-1.svg" alt="context chain"></p><p>&#x90A3;&#x4E48;&#x5F53; 3 &#x79D2;&#x8D85;&#x65F6;&#x5230;&#x4E86;&#x65F6;&#x5019;&#xFF1A;</p><p><img src="../pics/golang/context/context-chain-2.svg" alt="context chain"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>ctx4</code> &#x8D85;&#x65F6;&#x9000;&#x51FA;&#x4E86;&#x3002;</p><p>&#x5F53; 5&#x79D2;&#x949F; &#x8D85;&#x65F6;&#x5230;&#x8FBE;&#x65F6;&#xFF1A;</p><p><img src="../pics/golang/context/context-chain-3.svg" alt="context chain"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5; <code>ctx3</code> &#x9000;&#x51FA;&#x4E86;&#xFF0C;&#x5176;&#x6240;&#x6709;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x6BD4;&#x5982; <code>ctx5</code> &#x548C; <code>ctx6</code> &#x4E5F;&#x90FD;&#x9000;&#x51FA;&#x4E86;&#x3002;</p><h2 id="context-context-api"><a href="#context-Context-API" class="headerlink" title="context.Context API"></a><code>context.Context</code> API <a href="#context-context-api" class="header-anchor">#</a></h2><p>&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x4E24;&#x7C7B;&#x64CD;&#x4F5C;&#xFF1A;</p><ul><li>3&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x4E8E;<em>&#x9650;&#x5B9A;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F60;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x9000;&#x51FA;</em>&#xFF1B;</li><li>1&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x4E8E;<em>&#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x8303;&#x7574;&#x7684;&#x53D8;&#x91CF;</em></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> {</span><br><span class="line">  <span class="comment">//  &#x5565;&#x65F6;&#x5019;&#x9000;&#x51FA;</span></span><br><span class="line">  Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line">  Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>{}</span><br><span class="line">  Err() error</span><br><span class="line">  <span class="comment">//  &#x8BBE;&#x7F6E;&#x53D8;&#x91CF;</span></span><br><span class="line">  Value(key <span class="keyword">interface</span>{}) <span class="keyword">interface</span>{}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="shi-me-shi-hou-ying-gai-shi-yong-context"><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;-Context&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; Context&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>Context</code>&#xFF1F; <a href="#shi-me-shi-hou-ying-gai-shi-yong-context" class="header-anchor">#</a></h2><ul><li>&#x6BCF;&#x4E00;&#x4E2A; RPC &#x8C03;&#x7528;&#x90FD;&#x5E94;&#x8BE5;&#x6709;<em>&#x8D85;&#x65F6;&#x9000;&#x51FA;</em>&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x8FD9;&#x662F;&#x6BD4;&#x8F83;&#x5408;&#x7406;&#x7684; API &#x8BBE;&#x8BA1;</li><li><em>&#x4E0D;&#x4EC5;&#x4EC5;</em> &#x662F;&#x8D85;&#x65F6;&#xFF0C;&#x4F60;&#x8FD8;&#x9700;&#x8981;&#x6709;&#x80FD;&#x529B;&#x53BB;&#x7ED3;&#x675F;&#x90A3;&#x4E9B;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x884C;&#x4E3A;</li><li><code>context.Context</code> &#x662F; Go &#x6807;&#x51C6;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</li><li>&#x4EFB;&#x4F55;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x6216;&#x8005;&#x9700;&#x8981;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x6765;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x6709;&#x4E2A; <code>context.Context</code></li></ul><h2 id="ru-he-chuang-jian-context"><a href="#&#x5982;&#x4F55;&#x521B;&#x5EFA;-Context&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x521B;&#x5EFA; Context&#xFF1F;"></a>&#x5982;&#x4F55;&#x521B;&#x5EFA; <code>Context</code>&#xFF1F; <a href="#ru-he-chuang-jian-context" class="header-anchor">#</a></h2><ul><li>&#x5728; RPC &#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F7F;&#x7528; <code>context.Background()</code><ul><li>&#x6709;&#x4E9B;&#x4EBA;&#x628A;&#x5728; <code>main()</code> &#x91CC;&#x8BB0;&#x5F55;&#x4E00;&#x4E2A; <code>context.Background()</code>&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8FD9;&#x4E2A;&#x653E;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x67D0;&#x4E2A;&#x53D8;&#x91CF;&#x91CC;&#xFF0C;&#x7136;&#x540E;&#x8BF7;&#x6C42;&#x6765;&#x4E86;&#x540E;&#x4ECE;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x91CC;&#x7EE7;&#x627F; context&#x3002;&#x8FD9;&#x4E48;&#x505A;&#x662F;<strong>&#x4E0D;&#x5BF9;&#x7684;</strong>&#x3002;&#x76F4;&#x63A5;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x6E90;&#x81EA;&#x81EA;&#x5DF1;&#x7684; <code>context.Background()</code> &#x5373;&#x53EF;&#x3002;</li></ul></li><li>&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709; context&#xFF0C;&#x5374;&#x9700;&#x8981;&#x8C03;&#x7528;&#x4E00;&#x4E2A; context &#x7684;&#x51FD;&#x6570;&#x7684;&#x8BDD;&#xFF0C;&#x7528; <code>context.TODO()</code></li><li>&#x5982;&#x679C;&#x67D0;&#x6B65;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x7684;&#x8D85;&#x65F6;&#x8BBE;&#x7F6E;&#x7684;&#x8BDD;&#xFF0C;&#x7ED9;&#x5B83;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; sub-context&#xFF08;&#x5982;&#x524D;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF09;</li></ul><h2 id="ru-he-ji-cheng-dao-api-li"><a href="#&#x5982;&#x4F55;&#x96C6;&#x6210;&#x5230;-API-&#x91CC;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x96C6;&#x6210;&#x5230; API &#x91CC;&#xFF1F;"></a>&#x5982;&#x4F55;&#x96C6;&#x6210;&#x5230; API &#x91CC;&#xFF1F; <a href="#ru-he-ji-cheng-dao-api-li" class="header-anchor">#</a></h2><ul><li>&#x5982;&#x679C;&#x6709; Context&#xFF0C;<strong>&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;</strong>&#x3002;<ul><li>&#x5982; <code>func (d* Dialer) DialContext(ctx context.Context, network, address string) (Conn, error)</code></li><li>&#x6709;&#x4E9B;&#x4EBA;&#x628A; context &#x653E;&#x5230;&#x4E2D;&#x95F4;&#x7684;&#x67D0;&#x4E2A;&#x53D8;&#x91CF;&#x91CC;&#x53BB;&#xFF0C;&#x8FD9;&#x5F88;&#x4E0D;&#x5408;&#x4E60;&#x60EF;&#xFF0C;&#x4E0D;&#x8981;&#x90A3;&#x4E48;&#x505A;&#xFF0C;&#x653E;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x53BB;&#x3002;</li></ul></li><li>&#x5C06;&#x5176;&#x4F5C;&#x4E3A;<strong>&#x53EF;&#x9009;&#x7684;</strong>&#x65B9;&#x5F0F;&#xFF0C;&#x7528; <code>request</code> &#x7ED3;&#x6784;&#x4F53;&#x65B9;&#x5F0F;&#x3002;<ul><li>&#x5982;&#xFF1A;<code>func (r *Request) WithContext(ctx context.Context) *Request</code></li></ul></li><li>Context &#x7684;&#x53D8;&#x91CF;&#x540D;&#x8BF7;&#x7528; <code>ctx</code>&#xFF08;&#x4E0D;&#x8981;&#x8D77;&#x4E00;&#x4E9B;&#x8BE1;&#x5F02;&#x7684;&#x540D;&#x5B57;&#x1F613;&#xFF09;</li></ul><h2 id="context-fang-na"><a href="#Context-&#x653E;&#x54EA;&#xFF1F;" class="headerlink" title="Context &#x653E;&#x54EA;&#xFF1F;"></a><code>Context</code> &#x653E;&#x54EA;&#xFF1F; <a href="#context-fang-na" class="header-anchor">#</a></h2><ul><li>&#x628A; <code>Context</code> &#x60F3;&#x8C61;&#x4E3A;&#x4E00;&#x6761;&#x6CB3;&#x6D41;&#x6D41;&#x8FC7;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#xFF08;&#x53E6;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#x5C31;&#x662F;&#x8BF4;&#x4E0D;&#x8981;&#x559D;&#x6CB3;&#x91CC;&#x7684;&#x6C34;&#x2026;&#x2026;&#x1F64A;&#xFF09;</li><li>&#x7406;&#x60F3;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>Context</code> &#x5B58;&#x5728;&#x4E8E;&#x8C03;&#x7528;&#x6808;&#xFF08;Call Stack&#xFF09; &#x4E2D;</li><li>&#x4E0D;&#x8981;&#x628A; <code>Context</code> &#x5B58;&#x50A8;&#x5230;&#x4E00;&#x4E2A; <code>struct</code> &#x91CC;<ul><li>&#x9664;&#x975E;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x50CF; <code>http.Request</code> &#x4E2D;&#x7684; <code>request</code> &#x7ED3;&#x6784;&#x4F53;&#x7684;&#x65B9;&#x5F0F;</li></ul></li><li><code>request</code> &#x7ED3;&#x6784;&#x4F53;&#x5E94;&#x8BE5;&#x4EE5; Request &#x7ED3;&#x675F;&#x4E3A;&#x751F;&#x547D;&#x7EC8;&#x6B62;</li><li>&#x5F53; RPC &#x8BF7;&#x6C42;&#x5904;&#x7406;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x53BB;&#x6389;&#x5BF9; Context &#x53D8;&#x91CF;&#x7684;&#x5F15;&#x7528;&#xFF08;Unreference&#xFF09;</li><li>Request &#x7ED3;&#x675F;&#xFF0C;Context &#x5C31;&#x5E94;&#x8BE5;&#x7ED3;&#x675F;&#x3002;&#xFF08;&#x8FD9;&#x4FE9;&#x662F;&#x4E00;&#x5BF9;&#x513F;&#xFF0C;&#x4E0D;&#x6C42;&#x540C;&#x5E74;&#x540C;&#x6708;&#x540C;&#x65E5;&#x751F;&#xFF0C;&#x4F46;&#x6C42;&#x540C;&#x5E74;&#x540C;&#x6708;&#x540C;&#x65E5;&#x6B7B;&#x2026;&#x2026;&#x1F495;&#xFF09;</li></ul><h2 id="context-bao-de-zhu-yi-shi-xiang"><a href="#Context-&#x5305;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="Context &#x5305;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a><code>Context</code> &#x5305;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879; <a href="#context-bao-de-zhu-yi-shi-xiang" class="header-anchor">#</a></h2><ul><li>&#x8981;&#x517B;&#x6210;&#x5173;&#x95ED; Context &#x7684;&#x4E60;&#x60EF;<ul><li><em>&#x7279;&#x522B;&#x662F;</em> &#x8D85;&#x65F6;&#x7684; Contexts</li></ul></li><li>&#x5982;&#x679C;&#x4E00;&#x4E2A; context &#x88AB; GC &#x800C;&#x4E0D;&#x662F; cancel &#x4E86;&#xFF0C;&#x90A3;&#x4E00;&#x822C;&#x662F;&#x4F60;&#x505A;&#x9519;&#x4E86;</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx, cancel := context.WithTimeout(parentCtx, time.Second * <span class="number">2</span>)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br></pre></td></tr></table></figure><ul><li>&#x4F7F;&#x7528; Timeout &#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x90E8;&#x4F7F;&#x7528; <code>time.AfterFunc</code>&#xFF0C;&#x4ECE;&#x800C;&#x4F1A;&#x5BFC;&#x81F4; context &#x5728;&#x8BA1;&#x65F6;&#x5668;&#x5230;&#x65F6;&#x4E4B;&#x524D;&#x90FD;&#x4E0D;&#x4F1A;&#x88AB;&#x5783;&#x573E;&#x56DE;&#x6536;&#x3002;</li><li>&#x5728;&#x5EFA;&#x7ACB;&#x4E4B;&#x540E;&#xFF0C;&#x7ACB;&#x5373; <code>defer cancel()</code> &#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E60;&#x60EF;&#x3002;</li></ul><h2 id="zhong-zhi-qing-qiu-request-cancellation"><a href="#&#x7EC8;&#x6B62;&#x8BF7;&#x6C42;-Request-Cancellation" class="headerlink" title="&#x7EC8;&#x6B62;&#x8BF7;&#x6C42; (Request Cancellation)"></a>&#x7EC8;&#x6B62;&#x8BF7;&#x6C42; (Request Cancellation) <a href="#zhong-zhi-qing-qiu-request-cancellation" class="header-anchor">#</a></h2><p>&#x5F53;&#x4F60;&#x4E0D;&#x518D;&#x5173;&#x5FC3;&#x63A5;&#x4E0B;&#x6765;&#x83B7;&#x53D6;&#x7684;&#x7ED3;&#x679C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x4F1A; Cancel &#x4E00;&#x4E2A; Context&#xFF1F;</p><p>&#x4EE5; <code>golang.org/x/sync/errgroup</code> &#x4E3A;&#x4F8B;&#xFF0C;<code>errgroup</code> &#x4F7F;&#x7528; Context &#x6765;&#x63D0;&#x4F9B; RPC &#x7684;&#x7EC8;&#x6B62;&#x884C;&#x4E3A;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Group <span class="keyword">struct</span> {</span><br><span class="line">cancel  <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">wg      sync.WaitGroup</span><br><span class="line">errOnce sync.Once</span><br><span class="line">err     error</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>group</code> &#x548C; <code>context</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithContext</span><span class="params">(ctx context.Context)</span> <span class="params">(*Group, context.Context)</span></span> {</span><br><span class="line">  ctx, cancel := context.WithCancel(ctx)</span><br><span class="line">  <span class="keyword">return</span> &amp;Group{cancel: cancel}, ctx</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5C31;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x88AB;&#x63D0;&#x524D; cancel &#x7684; <code>group</code>&#x3002;</p><p>&#x800C;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528; <code>go func()</code>&#xFF0C;&#x800C;&#x662F;&#x8C03;&#x7528; <code>Go()</code>&#xFF0C;&#x5C06;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x8FDB;&#x53BB;&#xFF0C;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7684;&#x5F62;&#x5F0F;&#x6765;&#x8C03;&#x7528;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x624D;&#x662F; <code>go func()</code> &#x5F00;&#x542F; goroutine&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *Group)</span> <span class="title">Go</span><span class="params">(f <span class="keyword">func</span>()</span> <span class="title">error</span>)</span> {</span><br><span class="line">  g.wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> g.wg.Done()</span><br><span class="line">    <span class="keyword">if</span> err := f(); err != <span class="literal">nil</span> {</span><br><span class="line">      g.errOnce.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        g.err = err</span><br><span class="line">        <span class="keyword">if</span> g.cancel != <span class="literal">nil</span> {</span><br><span class="line">          g.cancel()</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }()</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5F53;&#x7ED9;&#x5165;&#x51FD;&#x6570; <code>f</code> &#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#xFF0C;&#x5219;&#x4F7F;&#x7528; <code>sync.Once</code> &#x6765; cancel <code>context</code>&#xFF0C;&#x800C;&#x9519;&#x8BEF;&#x88AB;&#x4FDD;&#x5B58;&#x4E8E; <code>g.err</code> &#x4E4B;&#x4E2D;&#xFF0C;&#x5728;&#x968F;&#x540E;&#x7684; <code>Wait()</code> &#x51FD;&#x6570;&#x4E2D;&#x8FD4;&#x56DE;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *Group)</span> <span class="title">Wait</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  g.wg.Wait()</span><br><span class="line">  <span class="keyword">if</span> g.cancel != <span class="literal">nil</span> {</span><br><span class="line">    g.cancel()</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> g.err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x5728; <code>Wait()</code> &#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x6B21; <code>cancel()</code>&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoTwoRequestsAtOnce</span><span class="params">(ctx context.Context)</span> <span class="title">error</span></span> {</span><br><span class="line">  eg, egCtx := errgroup.WithContext(ctx)</span><br><span class="line">  <span class="keyword">var</span> resp1, resp2 *http.Response</span><br><span class="line">  f := <span class="function"><span class="keyword">func</span><span class="params">(loc <span class="keyword">string</span>, respIn **http.Response)</span> <span class="title">func</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">      reqCtx, cancel := context.WithTimeout(egCtx, time.Second)</span><br><span class="line">      <span class="keyword">defer</span> cancel()</span><br><span class="line">      req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, loc, <span class="literal">nil</span>)</span><br><span class="line">      <span class="keyword">var</span> err error</span><br><span class="line">      *respIn, err = http.DefaultClient.Do(req.WithContext(reqCtx))</span><br><span class="line">      <span class="keyword">if</span> err == <span class="literal">nil</span> &amp;&amp; (*respIn).StatusCode &gt;= <span class="number">500</span> {</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;unexpected!&quot;</span>)</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  eg.Go(f(<span class="string">&quot;http://localhost:8080/fast_request&quot;</span>, &amp;resp1))</span><br><span class="line">  eg.Go(f(<span class="string">&quot;http://localhost:8080/slow_request&quot;</span>, &amp;resp2))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> eg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x53D1;&#x8D77;&#x4E86;&#x4E24;&#x4E2A; RPC &#x8C03;&#x7528;&#xFF0C;&#x5F53;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x51FA;&#x9519;&#x540E;&#xFF0C;&#x4F1A;&#x7EC8;&#x6B62;&#x53E6;&#x4E00;&#x4E2A; RPC &#x8C03;&#x7528;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5229;&#x7528;&#x524D;&#x9762;&#x8BB2;&#x5230;&#x7684; <code>errgroup</code> &#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5E94;&#x5BF9;&#x6709;&#x5F88;&#x591A;&#x5E76;&#x975E;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x9700;&#x8981;&#x96C6;&#x4E2D;&#x5904;&#x7406;&#x8D85;&#x65F6;&#x3001;&#x51FA;&#x9519;&#x7EC8;&#x6B62;&#x5176;&#x5B83;&#x5E76;&#x53D1;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E2A; pattern &#x4F7F;&#x7528;&#x8D77;&#x6765;&#x5F88;&#x65B9;&#x4FBF;&#x3002;</p><h2 id="context-value-request-fan-chou-de-zhi"><a href="#Context-Value-Request-&#x8303;&#x7574;&#x7684;&#x503C;" class="headerlink" title="Context.Value - Request &#x8303;&#x7574;&#x7684;&#x503C;"></a><code>Context.Value</code> - Request &#x8303;&#x7574;&#x7684;&#x503C; <a href="#context-value-request-fan-chou-de-zhi" class="header-anchor">#</a></h2><h3 id="context-value-api-de-wan-jin-you-duct-tape"><a href="#context-Value-API-&#x7684;&#x4E07;&#x91D1;&#x6CB9;&#xFF08;duct-tape" class="headerlink" title="context.Value API &#x7684;&#x4E07;&#x91D1;&#x6CB9;&#xFF08;duct tape)"></a><code>context.Value</code> API &#x7684;&#x4E07;&#x91D1;&#x6CB9;&#xFF08;duct tape) <a href="#context-value-api-de-wan-jin-you-duct-tape" class="header-anchor">#</a></h3><p>&#x80F6;&#x5E26;&#xFF08;duct tape) &#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x4FEE;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#xFF0C;&#x4ECE;&#x7834;&#x7BB1;&#x5B50;&#xFF0C;&#x5230;&#x4EBA;&#x7684;&#x4F24;&#x53E3;&#xFF0C;&#x5230;&#x6C7D;&#x8F66;&#x5F15;&#x64CE;&#xFF0C;&#x751A;&#x81F3;&#x5230;NASA&#x767B;&#x6708;&#x4EFB;&#x52A1;&#x4E2D;&#x7684;&#x963F;&#x6CE2;&#x7F57;13&#x53F7;&#x98DE;&#x8239;&#xFF08;Yeah! True Story)&#x3002;&#x6240;&#x4EE5;&#x5728;&#x897F;&#x65B9;&#x6587;&#x5316;&#x91CC;&#xFF0C;&#x80F6;&#x5E26;&#x662F;&#x4E2A;&#x201C;&#x4E07;&#x80FD;&#x201D;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x5728;&#x4E2D;&#x6587;&#x91CC;&#xFF0C;&#x6050;&#x6015;&#x4E07;&#x91D1;&#x6CB9;&#x662F;&#x66F4;&#x5408;&#x9002;&#x7684;&#x5BF9;&#x5E94;&#x8BCD;&#x6C47;&#xFF0C;&#x4ECE;&#x5934;&#x75BC;&#x3001;&#x8111;&#x70ED;&#xFF0C;&#x611F;&#x5192;&#x53D1;&#x70E7;&#xFF0C;&#x5230;&#x8DCC;&#x6253;&#x635F;&#x4F24;&#x51E0;&#x4E4E;&#x65E0;&#x6240;&#x4E0D;&#x6CBB;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;<em>&#x6CBB;&#x6807;&#x4E0D;&#x6CBB;&#x672C;</em>&#xFF0C;&#x8FD9;&#x70B9;&#x4E1C;&#x897F;&#x65B9;&#x6587;&#x5316;&#x4E2D;&#x7684;&#x6F5C;&#x53F0;&#x8BCD;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x63D0;&#x53CA;&#x7684; <code>context.Value</code> &#x5BF9;&#x4E8E; API &#x800C;&#x8A00;&#xFF0C;&#x5C31;&#x662F;&#x8FD9;&#x7C7B;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5565;&#x90FD;&#x53EF;&#x4EE5;&#x5E72;&#xFF0C;&#x4F46;&#x662F;&#x6CBB;&#x6807;&#x4E0D;&#x6CBB;&#x672C;&#x3002;</p><ul><li><code>value</code> &#x8282;&#x70B9;&#x662F; Context &#x94FE;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> context</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> valueCtx <span class="keyword">struct</span> {</span><br><span class="line">  Context</span><br><span class="line">  key, val <span class="keyword">interface</span>{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>{})</span> <span class="title">Context</span></span> {</span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line">  <span class="keyword">return</span> &amp;valueCtx{parent, key, val}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>{})</span> <span class="title">interface</span></span>{} {</span><br><span class="line">  <span class="keyword">if</span> c.key == key {</span><br><span class="line">    <span class="keyword">return</span> c.val</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> c.Context.Value(key)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;<code>WithValue()</code> &#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5728; Context &#x6811;&#x5F62;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7F62;&#x4E86;&#x3002;</p><p>Context &#x662F; immutable &#x7684;&#x3002;</p><h3 id="yue-shu-key-de-kong-jian"><a href="#&#x7EA6;&#x675F;-key-&#x7684;&#x7A7A;&#x95F4;" class="headerlink" title="&#x7EA6;&#x675F; key &#x7684;&#x7A7A;&#x95F4;"></a>&#x7EA6;&#x675F; key &#x7684;&#x7A7A;&#x95F4; <a href="#yue-shu-key-de-kong-jian" class="header-anchor">#</a></h3><p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x4E2D;&#x51FA;&#x73B0;&#x91CD;&#x590D;&#x7684;&#x952E;&#xFF0C;&#x5EFA;&#x8BAE;&#x7EA6;&#x675F;&#x952E;&#x7684;&#x7A7A;&#x95F4;&#x3002;&#x6BD4;&#x5982;&#x4F7F;&#x7528;&#x79C1;&#x6709;&#x7C7B;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x7528; <code>GetXxx()</code> &#x548C; <code>WithXxxx()</code> &#x6765;&#x64CD;&#x4F5C;&#x79C1;&#x6709;&#x5B9E;&#x4F53;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> privateCtxType <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  reqID = privateCtxType(<span class="string">&quot;req-id&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetRequestID</span><span class="params">(ctx context.Context)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">bool</span>)</span></span> {</span><br><span class="line">  id, exists := ctx.Value(reqID).(<span class="keyword">int</span>)</span><br><span class="line">  <span class="keyword">return</span> id, exists</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithRequestID</span><span class="params">(ctx context.Context, reqid <span class="keyword">int</span>)</span> <span class="title">context</span>.<span class="title">Context</span></span> {</span><br><span class="line">  <span class="keyword">return</span> context.WithValue(ctx, reqID, reqid)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528; <code>WithXxx</code> &#x800C;&#x4E0D;&#x662F; <code>SetXxx</code> &#x4E5F;&#x662F;&#x56E0;&#x4E3A; Context &#x5B9E;&#x9645;&#x4E0A;&#x662F; immutable &#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x662F;&#x4FEE;&#x6539; Context &#x91CC;&#x67D0;&#x4E2A;&#x503C;&#xFF0C;&#x800C;&#x662F;&#x4EA7;&#x751F;&#x65B0;&#x7684; Context <em>&#x5E26;&#x67D0;&#x4E2A;&#x503C;</em>&#x3002;</p><h3 id="context-value-shi-immutable-de"><a href="#Context-Value-&#x662F;-immutable-&#x7684;" class="headerlink" title="Context.Value &#x662F; immutable &#x7684;"></a><code>Context.Value</code> &#x662F; immutable &#x7684; <a href="#context-value-shi-immutable-de" class="header-anchor">#</a></h3><p>&#x518D;&#x591A;&#x6B21;&#x7684;&#x5F3A;&#x8C03; <code>Context.Value</code> &#x662F; <strong>immutable</strong> &#x7684;&#x4E5F;&#x4E0D;&#x8FC7;&#x5206;&#x3002;</p><ul><li><code>context.Context</code> &#x4ECE;&#x8BBE;&#x8BA1;&#x4E0A;&#x5C31;&#x662F;&#x6309;&#x7167; immutable &#xFF08;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF09;&#x6A21;&#x5F0F;&#x8BBE;&#x8BA1;&#x7684;</li><li>&#x540C;&#x6837;&#xFF0C;<code>Context.Value</code> &#x4E5F;&#x662F; immutable &#x7684;</li><li>&#x4E0D;&#x8981;&#x8BD5;&#x56FE;&#x5728; <code>Context.Value</code> &#x91CC;&#x5B58;&#x67D0;&#x4E2A;&#x53EF;&#x53D8;&#x66F4;&#x7684;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x6539;&#x53D8;&#xFF0C;&#x671F;&#x671B;&#x522B;&#x7684; Context &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x6539;&#x53D8;<ul><li>&#x66F4;&#x522B;&#x6307;&#x671B;&#x7740;&#x5728; <code>Context.Value</code> &#x91CC;&#x5B58;&#x53EF;&#x53D8;&#x7684;&#x503C;&#xFF0C;&#x6700;&#x540E;&#x591A;&#x4E2A; goroutine &#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x6CA1;&#x7ADE;&#x4E89;&#x5192;&#x9669;&#x5565;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x81EA;&#x59CB;&#x81F3;&#x7EC8;&#xFF0C;&#x5C31;&#x662F;&#x6309;&#x7167;&#x4E0D;&#x53EF;&#x53D8;&#x6765;&#x8BBE;&#x8BA1;&#x7684;</li><li>&#x6BD4;&#x5982;&#x8BBE;&#x7F6E;&#x4E86;&#x8D85;&#x65F6;&#xFF0C;&#x5C31;&#x522B;&#x4EE5;&#x4E3A;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x7684;&#x8D85;&#x65F6;&#x503C;</li></ul></li><li>&#x5728;&#x4F7F;&#x7528; <code>Context.Value</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x8BB0;&#x4F4F;&#x8FD9;&#x4E00;&#x70B9;</li></ul><h3 id="ying-gai-ba-shi-me-fang-dao-context-value-li"><a href="#&#x5E94;&#x8BE5;&#x628A;&#x4EC0;&#x4E48;&#x653E;&#x5230;-Context-Value-&#x91CC;&#xFF1F;" class="headerlink" title="&#x5E94;&#x8BE5;&#x628A;&#x4EC0;&#x4E48;&#x653E;&#x5230; Context.Value &#x91CC;&#xFF1F;"></a>&#x5E94;&#x8BE5;&#x628A;&#x4EC0;&#x4E48;&#x653E;&#x5230; <code>Context.Value</code> &#x91CC;&#xFF1F; <a href="#ying-gai-ba-shi-me-fang-dao-context-value-li" class="header-anchor">#</a></h3><ul><li>&#x5E94;&#x8BE5;&#x4FDD;&#x5B58; Request &#x8303;&#x7574;&#x7684;&#x503C;<ul><li>&#x4EFB;&#x4F55;&#x5173;&#x4E8E; Context &#x81EA;&#x8EAB;&#x7684;&#x90FD;&#x662F; Request &#x8303;&#x7574;&#x7684;&#xFF08;&#x8FD9;&#x4FE9;&#x540C;&#x751F;&#x5171;&#x6B7B;&#xFF09;</li><li>&#x4ECE; Request &#x6570;&#x636E;&#x884D;&#x751F;&#x51FA;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x968F;&#x7740; Request &#x7684;&#x7ED3;&#x675F;&#x800C;&#x7EC8;&#x7ED3;</li></ul></li></ul><h4 id="shi-me-dong-xi-bu-shu-yu-request-fan-chou"><a href="#&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x4E0D;&#x5C5E;&#x4E8E;-Request-&#x8303;&#x7574;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x4E0D;&#x5C5E;&#x4E8E; Request &#x8303;&#x7574;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x4E0D;&#x5C5E;&#x4E8E; Request &#x8303;&#x7574;&#xFF1F; <a href="#shi-me-dong-xi-bu-shu-yu-request-fan-chou" class="header-anchor">#</a></h4><ul><li>&#x5728; Request &#x4EE5;&#x5916;&#x5EFA;&#x7ACB;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x968F;&#x7740; Request &#x6539;&#x53D8;&#x800C;&#x53D8;&#x5316;<ul><li>&#x6BD4;&#x5982;&#x4F60; <code>func main()</code> &#x91CC;&#x5EFA;&#x7ACB;&#x7684;&#x4E1C;&#x897F;&#x663E;&#x7136;&#x4E0D;&#x5C5E;&#x4E8E; Request &#x8303;&#x7574;</li></ul></li><li>&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;<ul><li>&#x5982;&#x679C; <code>User ID</code> &#x5728;&#x8FDE;&#x63A5;&#x91CC;&#x5462;&#xFF1F;(&#x7A0D;&#x540E;&#x4F1A;&#x63D0;&#x53CA;)</li></ul></li><li>&#x5168;&#x5C40; <code>logger</code><ul><li>&#x5982;&#x679C; <code>logger</code> &#x91CC;&#x9700;&#x8981;&#x6709; <code>User ID</code> &#x5462;&#xFF1F;&#xFF08;&#x7A0D;&#x540E;&#x4F1A;&#x63D0;&#x53CA;&#xFF09;</li></ul></li></ul><h3 id="na-me-yong-context-value-you-shi-me-wen-ti"><a href="#&#x90A3;&#x4E48;&#x7528;-Context-Value-&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;" class="headerlink" title="&#x90A3;&#x4E48;&#x7528; Context.Value &#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;"></a>&#x90A3;&#x4E48;&#x7528; <code>Context.Value</code> &#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F; <a href="#na-me-yong-context-value-you-shi-me-wen-ti" class="header-anchor">#</a></h3><ul><li>&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x597D;&#x50CF;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x7531;&#x8BF7;&#x6C42;&#x884D;&#x751F;&#x51FA;&#x6765;&#x7684;</li><li>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x8981;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF1F;&#x7136;&#x540E;&#x5E72;&#x8106;&#x53EA;&#x6765;&#x4E00;&#x4E2A; Context &#x5C31;&#x5B8C;&#x4E86;&#xFF1F;</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(ctx context.Context)</span> <span class="title">int</span></span> {</span><br><span class="line">  <span class="keyword">return</span> ctx.Value(<span class="string">&quot;first&quot;</span>).(<span class="keyword">int</span>) + ctx.Value(<span class="string">&quot;second&quot;</span>).(<span class="keyword">int</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x66FE;&#x7ECF;&#x770B;&#x5230;&#x8FC7;&#x4E00;&#x4E2A; API&#xFF0C;&#x5C31;&#x662F;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsAdminUser</span><span class="params">(ctx context.Context)</span> <span class="title">bool</span></span> {</span><br><span class="line">  userID := GetUser(ctx)</span><br><span class="line">  <span class="keyword">return</span> authSingleton.IsAdmin(userID)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;API&#x5B9E;&#x73B0;&#x5185;&#x90E8;&#x4ECE; <code>context</code> &#x4E2D;&#x53D6;&#x5F97; <code>UserID</code>&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x6743;&#x9650;&#x5224;&#x65AD;&#x3002;&#x4F46;&#x662F;&#x4ECE;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x770B;&#xFF0C;&#x5219;&#x5B8C;&#x5168;&#x65E0;&#x6CD5;&#x7406;&#x89E3;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5177;&#x4F53;&#x9700;&#x8981;&#x4EC0;&#x4E48;&#x3001;&#x4EE5;&#x53CA;&#x505A;&#x4EC0;&#x4E48;&#x3002;</p><blockquote><p>&#x4EE3;&#x7801;&#x8981;&#x4EE5;&#x53EF;&#x8BFB;&#x6027;&#x4E3A;&#x4F18;&#x5148;&#x8BBE;&#x8BA1;&#x8003;&#x8651;&#x3002;</p></blockquote><p>&#x522B;&#x4EBA;&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x662F;&#x6389;&#x8FDB;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x91CC;&#x53BB;&#x4E00;&#x884C;&#x884C;&#x7684;&#x8BFB;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x5148;&#x6D4F;&#x89C8;&#x4E00;&#x4E0B;&#x51FD;&#x6570;&#x63A5;&#x53E3;&#x3002;&#x6240;&#x4EE5;&#x6E05;&#x6670;&#x7684;&#x51FD;&#x6570;&#x63A5;&#x53E3;&#x8BBE;&#x8BA1;&#xFF0C;&#x4F1A;&#x66F4;&#x52A0;&#x5229;&#x4E8E;&#x522B;&#x4EBA;&#xFF08;<em>&#x6216;&#x8005;&#x662F;&#x51E0;&#x4E2A;&#x6708;&#x540E;&#x7684;&#x4F60;&#x81EA;&#x5DF1;</em>&#xFF09;&#x7406;&#x89E3;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x3002;</p><p>&#x4E00;&#x4E2A;&#x826F;&#x597D;&#x7684; API &#x8BBE;&#x8BA1;&#xFF0C;&#x5E94;&#x8BE5;&#x4ECE;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x5C31;&#x6E05;&#x6670;&#x7684;&#x7406;&#x89E3;&#x51FD;&#x6570;&#x7684;&#x903B;&#x8F91;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x63A5;&#x53E3;&#x6539;&#x4E3A;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsAdminUser</span><span class="params">(ctx context.Context, userID <span class="keyword">string</span>, authenticator auth.Service)</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x4ECE;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x5C31;&#x53EF;&#x4EE5;&#x6E05;&#x695A;&#x7684;&#x77E5;&#x9053;&#xFF1A;</p><ul><li>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5F88;&#x53EF;&#x80FD;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x88AB; cancel</li><li>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x9700;&#x8981; <code>User ID</code></li><li>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x9700;&#x8981;&#x4E00;&#x4E2A;<code>authenticator</code>&#x6765;</li><li>&#x800C;&#x4E14;&#x7531;&#x4E8E; <code>authenticator</code> &#x662F;&#x4F20;&#x5165;&#x53C2;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x9690;&#x5F0F;&#x7684;&#x67D0;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x6A21;&#x62DF;&#x8BA4;&#x8BC1;&#x51FD;&#x6570;&#x6765;&#x505A;&#x6D4B;&#x8BD5;</li><li><code>userID</code> &#x662F;&#x4F20;&#x5165;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5B83;&#xFF0C;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x5F71;&#x54CD;&#x522B;&#x7684;&#x4E1C;&#x897F;</li></ul><p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x90FD;&#x662F;&#x4ECE;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x5F97;&#x5230;&#x7684;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x6253;&#x5F00;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x4E00;&#x884C;&#x884C;&#x53BB;&#x770B;&#x3002;</p><h3 id="na-shi-me-ke-yi-fang-dao-context-value-li-qu"><a href="#&#x90A3;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x653E;&#x5230;-Context-Value-&#x91CC;&#x53BB;&#xFF1F;" class="headerlink" title="&#x90A3;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x653E;&#x5230; Context.Value &#x91CC;&#x53BB;&#xFF1F;"></a>&#x90A3;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x653E;&#x5230; <code>Context.Value</code> &#x91CC;&#x53BB;&#xFF1F; <a href="#na-shi-me-ke-yi-fang-dao-context-value-li-qu" class="header-anchor">#</a></h3><p>&#x73B0;&#x5728;&#x77E5;&#x9053; <code>Context.Value</code> &#x4F1A;&#x8BA9;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x66F4;&#x52A0;&#x6A21;&#x7CCA;&#xFF0C;&#x4F3C;&#x4E4E;&#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x3002;&#x90A3;&#x4E48;&#x53C8;&#x56DE;&#x5230;&#x4E86;&#x539F;&#x6765;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5230;&#x5E95;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x653E;&#x5230; <code>Context.Value</code> &#x91CC;&#x53BB;&#xFF1F;&#x6362;&#x4E2A;&#x89D2;&#x5EA6;&#x53BB;&#x60F3;&#xFF0C;&#x4EC0;&#x4E48;&#x4E0D;&#x662F;&#x884D;&#x751F;&#x4E8E; Request&#xFF1F;</p><ul><li><code>Context.Value</code> &#x5E94;&#x8BE5;&#x662F;&#x544A;&#x77E5;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;</li><li>&#x5E94;&#x8BE5;&#x6C38;&#x8FDC;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x8FDB;&#x6587;&#x6863;&#x4F5C;&#x4E3A;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;</li><li>&#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x4F60;&#x7684;&#x51FD;&#x6570;&#x5728;&#x67D0;&#x4E9B; <code>Context.Value</code> &#x4E0B;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x5DE5;&#x4F5C;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A; <code>Context.Value</code> &#x91CC;&#x7684;&#x4FE1;&#x606F;&#x4E0D;&#x5E94;&#x8BE5;&#x653E;&#x5728;&#x91CC;&#x9762;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x653E;&#x5728;&#x63A5;&#x53E3;&#x4E0A;&#x3002;&#x56E0;&#x4E3A;&#x5DF2;&#x7ECF;&#x8BA9;&#x63A5;&#x53E3;&#x592A;&#x6A21;&#x7CCA;&#x4E86;&#x3002;</li></ul><h4 id="shi-me-dong-xi-bu-shi-kong-zhi-xing-zhi-de-dong-xi"><a href="#&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x4E0D;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x4E0D;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x4E0D;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF1F; <a href="#shi-me-dong-xi-bu-shi-kong-zhi-xing-zhi-de-dong-xi" class="header-anchor">#</a></h4><ul><li>Request ID<ul><li>&#x53EA;&#x662F;&#x7ED9;&#x6BCF;&#x4E2A; RPC &#x8C03;&#x7528;&#x4E00;&#x4E2A; ID&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x610F;&#x4E49;</li><li>&#x8FD9;&#x5C31;&#x662F;&#x4E2A;&#x6570;&#x5B57;/&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x53CD;&#x6B63;&#x4F60;&#x4E5F;&#x4E0D;&#x4F1A;&#x7528;&#x5176;&#x4F5C;&#x4E3A;&#x903B;&#x8F91;&#x5224;&#x65AD;</li><li>&#x4E00;&#x822C;&#x4E5F;&#x5C31;&#x662F;&#x65E5;&#x5FD7;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;<ul><li>&#x800C; <code>logger</code> &#x672C;&#x8EAB;&#x4E0D;&#x662F; Request &#x8303;&#x7574;&#xFF0C;&#x6240;&#x4EE5; <code>logger</code> &#x4E0D;&#x5E94;&#x8BE5;&#x5728; <code>Context</code> &#x91CC;</li><li>&#x975E; Request &#x8303;&#x7574;&#x7684; <code>logger</code> &#x5E94;&#x8BE5;&#x53EA;&#x662F;&#x5229;&#x7528; <code>Context</code> &#x4FE1;&#x606F;&#x6765;&#x4FEE;&#x9970;&#x65E5;&#x5FD7;</li></ul></li></ul></li><li>User ID &#xFF08;&#x5982;&#x679C;&#x4EC5;&#x4EC5;&#x662F;&#x4F5C;&#x4E3A;&#x65E5;&#x5FD7;&#x7528;&#xFF09;</li><li>Incoming Request ID</li></ul><h4 id="shi-me-xian-ran-shi-kong-zhi-xing-zhi-de-dong-xi"><a href="#&#x4EC0;&#x4E48;&#x663E;&#x7136;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x663E;&#x7136;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x663E;&#x7136;&#x662F;&#x63A7;&#x5236;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF1F; <a href="#shi-me-xian-ran-shi-kong-zhi-xing-zhi-de-dong-xi" class="header-anchor">#</a></h4><ul><li>&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;<ul><li>&#x663E;&#x7136;&#x4F1A;&#x975E;&#x5E38;&#x4E25;&#x91CD;&#x7684;&#x5F71;&#x54CD;&#x903B;&#x8F91;</li><li>&#x56E0;&#x6B64;&#x8FD9;&#x5E94;&#x8BE5;&#x5728;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x91CC;&#xFF0C;&#x660E;&#x786E;&#x8868;&#x793A;&#x51FA;&#x6765;</li></ul></li><li>&#x8BA4;&#x8BC1;&#x670D;&#x52A1;(Authentication)<ul><li>&#x663E;&#x7136;&#x4E0D;&#x540C;&#x7684;&#x8BA4;&#x8BC1;&#x670D;&#x52A1;&#x5BFC;&#x81F4;&#x7684;&#x903B;&#x8F91;&#x4E0D;&#x540C;</li><li>&#x4E5F;&#x5E94;&#x8BE5;&#x653E;&#x5230;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x91CC;&#xFF0C;&#x660E;&#x786E;&#x8868;&#x793A;&#x51FA;&#x6765;</li></ul></li></ul><h3 id="li-zi"><a href="#&#x4F8B;&#x5B50;" class="headerlink" title="&#x4F8B;&#x5B50;"></a>&#x4F8B;&#x5B50; <a href="#li-zi" class="header-anchor">#</a></h3><h4 id="diao-shi-xing-zhi-de-context-value-net-http-httptrace"><a href="#&#x8C03;&#x8BD5;&#x6027;&#x8D28;&#x7684;-Context-Value-net-http-httptrace" class="headerlink" title="&#x8C03;&#x8BD5;&#x6027;&#x8D28;&#x7684; Context.Value - net/http/httptrace"></a>&#x8C03;&#x8BD5;&#x6027;&#x8D28;&#x7684; <code>Context.Value</code> - <code>net/http/httptrace</code> <a href="#diao-shi-xing-zhi-de-context-value-net-http-httptrace" class="header-anchor">#</a></h4><ul><li><a href="https://medium.com/@cep21/go-1-7-httptrace-and-context-debug-patterns-608ae887224a" target="_blank" rel="noopener">https://medium.com/@cep21/go-1-7-httptrace-and-context-debug-patterns-608ae887224a</a></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trace</span><span class="params">(req *http.Request, c *http.Client)</span></span> {</span><br><span class="line">  trace := &amp;httptrace.ClientTrace{</span><br><span class="line">    GotConn: <span class="function"><span class="keyword">func</span><span class="params">(connInfo httptrace.GotConnInfo)</span></span> {</span><br><span class="line">      fmt.Println(<span class="string">&quot;Got Conn&quot;</span>)</span><br><span class="line">    },</span><br><span class="line">    ConnectStart: <span class="function"><span class="keyword">func</span><span class="params">(network, addr <span class="keyword">string</span>)</span></span> {</span><br><span class="line">      fmt.Println(<span class="string">&quot;Dial Start&quot;</span>)</span><br><span class="line">    },</span><br><span class="line">    ConnectDone: <span class="function"><span class="keyword">func</span><span class="params">(network, addr <span class="keyword">string</span>, err error)</span></span> {</span><br><span class="line">      fmt.Println(<span class="string">&quot;Dial done&quot;</span>)</span><br><span class="line">    },</span><br><span class="line">  }</span><br><span class="line">  req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))</span><br><span class="line">  c.Do(req)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h5 id="net-http-shi-zen-me-shi-yong-httptrace-de"><a href="#net-http-&#x662F;&#x600E;&#x4E48;&#x4F7F;&#x7528;-httptrace-&#x7684;&#xFF1F;" class="headerlink" title="net/http &#x662F;&#x600E;&#x4E48;&#x4F7F;&#x7528; httptrace &#x7684;&#xFF1F;"></a><code>net/http</code> &#x662F;&#x600E;&#x4E48;&#x4F7F;&#x7528; <code>httptrace</code> &#x7684;&#xFF1F; <a href="#net-http-shi-zen-me-shi-yong-httptrace-de" class="header-anchor">#</a></h5><ul><li>&#x5982;&#x679C;&#x6709; <code>trace</code> &#x5B58;&#x5728;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x6267;&#x884C; <code>trace</code> &#x56DE;&#x8C03;&#x51FD;&#x6570;</li><li>&#x8FD9;&#x53EA;&#x662F;<strong>&#x544A;&#x77E5;&#x6027;&#x8D28;</strong>&#xFF0C;&#x800C;&#x4E0D;&#x662F;<strong>&#x63A7;&#x5236;&#x6027;&#x8D28;</strong><ul><li><code>http</code> &#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x5B58;&#x5728; <code>trace</code> &#x4E0E;&#x5426;&#x5C31;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x6267;&#x884C;&#x903B;&#x8F91;</li><li>&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x544A;&#x77E5; API &#x7684;&#x7528;&#x6237;&#xFF0C;&#x5E2E;&#x52A9;&#x7528;&#x6237;&#x8BB0;&#x5F55;&#x65E5;&#x5FD7;&#x6216;&#x8005;&#x8C03;&#x8BD5;</li><li>&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x7684; <code>trace</code> &#x662F;&#x5B58;&#x5728;&#x4E8E; Context &#x91CC;&#x7684;</li></ul></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> http</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(req *Request)</span> <span class="title">write</span><span class="params">(w io.Writer, usingProxy <span class="keyword">bool</span>, extraHeaders Header, waitForContinue <span class="keyword">func</span>()</span> <span class="title">bool</span>) <span class="params">(err error)</span></span> {</span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line">  trace := httptrace.ContextClientTrace(req.Context())</span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line">  <span class="keyword">if</span> trace != <span class="literal">nil</span> &amp;&amp; trace.WroteHeaders != <span class="literal">nil</span> {</span><br><span class="line">    trace.WroteHeaders()</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="hui-bi-yi-lai-zhu-ru-github-com-golang-oauth2"><a href="#&#x56DE;&#x907F;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;-github-com-golang-oauth2" class="headerlink" title="&#x56DE;&#x907F;&#x4F9D;&#x8D56;&#x6CE8;&#x5165; - github.com/golang/oauth2"></a>&#x56DE;&#x907F;&#x4F9D;&#x8D56;&#x6CE8;&#x5165; - <code>github.com/golang/oauth2</code> <a href="#hui-bi-yi-lai-zhu-ru-github-com-golang-oauth2" class="header-anchor">#</a></h4><ul><li>&#x8FD9;&#x91CC;&#x6BD4;&#x8F83;&#x8BE1;&#x5F02;&#xFF0C;&#x4F7F;&#x7528; <code>ctx.Value</code> &#x6765;&#x5B9A;&#x4F4D;&#x4F9D;&#x8D56;</li><li><strong>&#x4E0D;&#x63A8;&#x8350;&#x8FD9;&#x6837;&#x505A;</strong><ul><li>&#x8FD9;&#x91CC;&#x8FD9;&#x6837;&#x505A;&#x57FA;&#x672C;&#x4E0A;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;</li></ul></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/golang/oauth2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">oauth</span><span class="params">()</span></span> {</span><br><span class="line">  c := &amp;http.Client{Transport: &amp;mockTransport{}}</span><br><span class="line">  ctx := context.WithValue(context.Background(), oauth2.HTTPClient, c)</span><br><span class="line">  conf := &amp;oauth2.Config{ <span class="comment">/* ... */</span> }</span><br><span class="line">  conf.Exchange(ctx, <span class="string">&quot;code&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="ren-men-lan-yong-context-value-de-yuan-yin"><a href="#&#x4EBA;&#x4EEC;&#x6EE5;&#x7528;-Context-Value-&#x7684;&#x539F;&#x56E0;" class="headerlink" title="&#x4EBA;&#x4EEC;&#x6EE5;&#x7528; Context.Value &#x7684;&#x539F;&#x56E0;"></a>&#x4EBA;&#x4EEC;&#x6EE5;&#x7528; <code>Context.Value</code> &#x7684;&#x539F;&#x56E0; <a href="#ren-men-lan-yong-context-value-de-yuan-yin" class="header-anchor">#</a></h3><ul><li>&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x62BD;&#x8C61;</li><li>&#x5F88;&#x6DF1;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;</li><li>&#x6DF7;&#x4E71;&#x7684;&#x8BBE;&#x8BA1;</li></ul><blockquote><p><code>context.Value</code> &#x5E76;&#x6CA1;&#x6709;&#x8BA9;&#x4F60;&#x7684; API &#x66F4;&#x7B80;&#x6D01;&#xFF0C;&#x90A3;&#x662F;&#x5047;&#x8C61;&#xFF0C;&#x76F8;&#x53CD;&#xFF0C;&#x5B83;&#x8BA9;&#x4F60;&#x7684; API &#x5B9A;&#x4E49;&#x66F4;&#x52A0;&#x6A21;&#x7CCA;&#x3002;</p></blockquote><h2 id="zong-jie-context-value"><a href="#&#x603B;&#x7ED3;-Context-Value" class="headerlink" title="&#x603B;&#x7ED3; Context.Value"></a>&#x603B;&#x7ED3; <code>Context.Value</code> <a href="#zong-jie-context-value" class="header-anchor">#</a></h2><ul><li>&#x5BF9;&#x4E8E;&#x8C03;&#x8BD5;&#x975E;&#x5E38;&#x65B9;&#x4FBF;</li><li>&#x5C06;&#x5FC5;&#x987B;&#x7684;&#x4FE1;&#x606F;&#x653E;&#x5165; <code>Context.Value</code> &#x4E2D;&#xFF0C;&#x4F1A;&#x8BA9;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x66F4;&#x52A0;&#x4E0D;&#x900F;&#x660E;</li><li>&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x5C3D;&#x91CF;&#x660E;&#x786E;&#x5B9A;&#x4E49;&#x5728;&#x63A5;&#x53E3;</li><li>&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x7528; <code>Context.Value</code></li></ul><h1 id="zong-jie-context"><a href="#&#x603B;&#x7ED3;-Context" class="headerlink" title="&#x603B;&#x7ED3; Context"></a>&#x603B;&#x7ED3; <code>Context</code> <a href="#zong-jie-context" class="header-anchor">#</a></h1><ul><li>&#x6240;&#x6709;&#x7684;&#x957F;&#x7684;&#x3001;&#x963B;&#x585E;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x9700;&#x8981; <code>Context</code></li><li><code>errgroup</code> &#x662F;&#x6784;&#x67B6;&#x4E8E; <code>Context</code> &#x4E4B;&#x4E0A;&#x5F88;&#x597D;&#x7684;&#x62BD;&#x8C61;</li><li>&#x5F53; Request &#x7684;&#x7ED3;&#x675F;&#x7684;&#x65F6;&#x5019;&#xFF0C;Cancel <code>Context</code></li><li><code>Context.Value</code> &#x5E94;&#x8BE5;&#x88AB;&#x7528;&#x4E8E;<strong>&#x544A;&#x77E5;&#x6027;&#x8D28;</strong>&#x7684;&#x4E8B;&#x7269;&#xFF0C;&#x800C;&#x4E0D;&#x662F;<strong>&#x63A7;&#x5236;&#x6027;&#x8D28;</strong>&#x7684;&#x4E8B;&#x7269;</li><li>&#x7EA6;&#x675F; <code>Context.Value</code> &#x7684;&#x952E;&#x7A7A;&#x95F4;</li><li><code>Context</code> &#x4EE5;&#x53CA; <code>Context.Value</code> &#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF08;immutable&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x5E94;&#x8BE5;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</li><li><code>Context</code> &#x5E94;&#x8BE5;&#x968F; <code>Request</code> &#x6D88;&#x4EA1;&#x800C;&#x6D88;&#x4EA1;</li></ul><h1 id="q-a"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A <a href="#q-a" class="header-anchor">#</a></h1><h2 id="shu-ju-ku-de-fang-wen-ye-yong-context-me"><a href="#&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BBF;&#x95EE;&#x4E5F;&#x7528;-Context-&#x4E48;&#xFF1F;" class="headerlink" title="&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BBF;&#x95EE;&#x4E5F;&#x7528; Context &#x4E48;&#xFF1F;"></a>&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BBF;&#x95EE;&#x4E5F;&#x7528; Context &#x4E48;&#xFF1F; <a href="#shu-ju-ku-de-fang-wen-ye-yong-context-me" class="header-anchor">#</a></h2><p>&#x4E4B;&#x524D;&#x8BF4;&#x8FC7;&#x957F;&#x65F6;&#x95F4;&#x3001;&#x53EF;&#x963B;&#x585E;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x7528; Context&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;&#x4E0D;&#x8FC7;&#x5BF9;&#x4E8E;&#x8D85;&#x65F6; Cancel &#x64CD;&#x4F5C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x5BF9;&#x5199;&#x64CD;&#x4F5C;&#x8FDB;&#x884C; cancel&#xFF1B;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x6709; Cancel &#x64CD;&#x4F5C;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="golang-uk-2017" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang-uk-2017/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：7种 Go 程序性能分析方法 - Dave Cheney</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-20-video-seven-ways-to-profile-go-apps.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-20-video-seven-ways-to-profile-go-apps.html</id>
    <published>2017-10-19T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.626Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#fang-fa-yi-time">&#x65B9;&#x6CD5;&#x4E00;&#xFF1A;<code>time</code></a><ul><li><a href="#shell-nei-zhi-de-time">shell &#x5185;&#x7F6E;&#x7684; <code>time</code></a></li><li><a href="#gnu-shi-xian-de-time">GNU &#x5B9E;&#x73B0;&#x7684; <code>time</code></a></li><li><a href="#bsd-macos-de-time">*BSD&#x3001;macOS &#x7684; <code>time</code></a></li><li><a href="#go-tool-zhong-de-toolexec-can-shu">go tool &#x4E2D;&#x7684; <code>-toolexec</code> &#x53C2;&#x6570;</a></li></ul></li><li><a href="#fang-fa-er-godebug">&#x65B9;&#x6CD5;&#x4E8C;&#xFF1A;<code>GODEBUG</code></a></li><li><a href="#cha-qu-yi-profiler-shi-ru-he-gong-zuo-de">&#x63D2;&#x66F2;&#x4E00;&#xFF1A;Profiler &#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;</a><ul><li><a href="#xing-neng-fen-xi-zhu-yi-shi-xiang">&#x6027;&#x80FD;&#x5206;&#x6790;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li></ul></li><li><a href="#fang-fa-san-pprof">&#x65B9;&#x6CD5;&#x4E09;&#xFF1A;<code>pprof</code></a><ul><li><a href="#cpu-xing-neng-fen-xi">CPU &#x6027;&#x80FD;&#x5206;&#x6790;</a></li><li><a href="#nei-cun-xing-neng-fen-xi">&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;</a></li><li><a href="#zu-sai-xing-neng-fen-xi">&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;</a></li><li><a href="#yi-ci-zhi-fen-xi-yi-ge-dong-xi">&#x4E00;&#x6B21;&#x53EA;&#x5206;&#x6790;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;</a></li><li><a href="#dui-han-shu-fen-xi">&#x5BF9;&#x51FD;&#x6570;&#x5206;&#x6790;</a></li><li><a href="#dui-zheng-ge-ying-yong-fen-xi">&#x5BF9;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x5206;&#x6790;</a></li></ul></li><li><a href="#fang-fa-si-debug-pprof">&#x65B9;&#x6CD5;&#x56DB;&#xFF1A;<code>/debug/pprof</code></a><ul><li><a href="#shi-yong-pprof">&#x4F7F;&#x7528; <code>pprof</code></a><ul><li><a href="#nei-cun-xing-neng-fen-xi">&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#xFF1A;</a></li><li><a href="#zu-sai-xing-neng-fen-xi-1">&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;</a></li></ul></li></ul></li><li><a href="#cha-qu-er-frame-pointer">&#x63D2;&#x66F2;&#x4E8C;&#xFF1A;Frame Pointer</a></li><li><a href="#fang-fa-wu-perf">&#x65B9;&#x6CD5;&#x4E94;&#xFF1A;<code>perf</code></a></li><li><a href="#fang-fa-liu-huo-yan-tu-flame-graph">&#x65B9;&#x6CD5;&#x516D;&#xFF1A;&#x706B;&#x7130;&#x56FE; (Flame Graph)</a></li><li><a href="#fang-fa-qi-go-tool-trace">&#x65B9;&#x6CD5;&#x4E03;&#xFF1A;<code>go tool trace</code></a></li><li><a href="#zong-jie">&#x603B;&#x7ED3;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Seven ways to Profile Go Applications</strong><br>by Dave Cheney<br>at Golang UK Conf. 2016</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/2h_NFBFrciI" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><ul><li>&#x89C6;&#x9891;&#xFF1A;<a href="https://www.youtube.com/watch?v=2h_NFBFrciI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=2h_NFBFrciI</a></li><li>&#x5E7B;&#x706F;&#xFF1A;<a href="http://talks.godoc.org/github.com/davecheney/presentations/seven.slide#1" target="_blank" rel="noopener">http://talks.godoc.org/github.com/davecheney/presentations/seven.slide#1</a></li></ul><h1 id="fang-fa-yi-time"><a href="#&#x65B9;&#x6CD5;&#x4E00;&#xFF1A;time" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E00;&#xFF1A;time"></a>&#x65B9;&#x6CD5;&#x4E00;&#xFF1A;<code>time</code> <a href="#fang-fa-yi-time" class="header-anchor">#</a></h1><h2 id="shell-nei-zhi-de-time"><a href="#shell-&#x5185;&#x7F6E;&#x7684;-time" class="headerlink" title="shell &#x5185;&#x7F6E;&#x7684; time"></a>shell &#x5185;&#x7F6E;&#x7684; <code>time</code> <a href="#shell-nei-zhi-de-time" class="header-anchor">#</a></h2><p>&#x6700;&#x7B80;&#x5355;&#x7684;&#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x5DE5;&#x5177;&#x5C31;&#x662F; shell &#x4E2D;&#x5185;&#x7F6E;&#x7684; <code>time</code> &#x547D;&#x4EE4;&#xFF0C;&#x8FD9;&#x662F;&#x7531; POSIX.2 (IEEE Std 1003.2-1992) &#x6807;&#x51C6;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709; Unix/Linux &#x90FD;&#x6709;&#x8FD9;&#x4E2A;&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ time go fmt github.com/docker/machine</span><br><span class="line"></span><br><span class="line">real    0m0.110s</span><br><span class="line">user    0m0.056s</span><br><span class="line">sys     0m0.040s</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x4F7F;&#x7528;shell<strong>&#x5185;&#x7F6E;&#x7684; <code>time</code></strong>&#x6765;&#x5BF9; <code>go fmt github.com/docker/machine</code> &#x7684;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x6027;&#x80FD;&#x5206;&#x6790;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x4E00;&#x5171;&#x6709;3&#x9879;&#x6307;&#x6807;&#xFF1A;</p><ul><li><code>real</code>&#xFF1A;&#x4ECE;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x5230;&#x7ED3;&#x675F;&#xFF0C;&#x5B9E;&#x9645;&#x5EA6;&#x8FC7;&#x7684;&#x65F6;&#x95F4;&#xFF1B;</li><li><code>user</code>&#xFF1A;&#x7A0B;&#x5E8F;&#x5728;<strong>&#x7528;&#x6237;&#x6001;</strong>&#x5EA6;&#x8FC7;&#x7684;&#x65F6;&#x95F4;&#xFF1B;</li><li><code>sys</code>&#xFF1A;&#x7A0B;&#x5E8F;&#x5728;<strong>&#x5185;&#x6838;&#x6001;</strong>&#x5EA6;&#x8FC7;&#x7684;&#x65F6;&#x95F4;&#x3002;</li></ul><p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B; <code>real</code> <strong>&gt;=</strong> <code>user</code> + <code>sys</code>&#xFF0C;&#x56E0;&#x4E3A;&#x7CFB;&#x7EDF;&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x8FDB;&#x7A0B;&#x3002;</p><h2 id="gnu-shi-xian-de-time"><a href="#GNU-&#x5B9E;&#x73B0;&#x7684;-time" class="headerlink" title="GNU &#x5B9E;&#x73B0;&#x7684; time"></a>GNU &#x5B9E;&#x73B0;&#x7684; <code>time</code> <a href="#gnu-shi-xian-de-time" class="header-anchor">#</a></h2><p>&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;&#x5BF9;&#x4E8E; Linux &#x7CFB;&#x7EDF;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x5957; GNU &#x7684; <code>time</code>&#xFF0C;&#x4F4D;&#x4E8E; <code>/usr/bin/time</code>&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5B8C;&#x6574;&#x8DEF;&#x5F84;&#x53BB;&#x8C03;&#x7528;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x5C31;&#x66F4;&#x5F3A;&#x5927;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:~$ /usr/bin/time -v go fmt github.com/docker/machine</span><br><span class="line">        Command being timed: <span class="string">&quot;go fmt github.com/docker/machine&quot;</span></span><br><span class="line">        User time (seconds): 0.02</span><br><span class="line">        System time (seconds): 0.06</span><br><span class="line">        Percent of CPU this job got: 85%</span><br><span class="line">        Elapsed (wall clock) time (h:mm:ss or m:ss): 0:00.09</span><br><span class="line">        Average shared text size (kbytes): 0</span><br><span class="line">        Average unshared data size (kbytes): 0</span><br><span class="line">        Average stack size (kbytes): 0</span><br><span class="line">        Average total size (kbytes): 0</span><br><span class="line">        Maximum resident <span class="built_in">set</span> size (kbytes): 18556</span><br><span class="line">        Average resident <span class="built_in">set</span> size (kbytes): 0</span><br><span class="line">        Major (requiring I/O) page faults: 0</span><br><span class="line">        Minor (reclaiming a frame) page faults: 9925</span><br><span class="line">        Voluntary context switches: 430</span><br><span class="line">        Involuntary context switches: 121</span><br><span class="line">        Swaps: 0</span><br><span class="line">        File system inputs: 0</span><br><span class="line">        File system outputs: 32</span><br><span class="line">        Socket messages sent: 0</span><br><span class="line">        Socket messages received: 0</span><br><span class="line">        Signals delivered: 0</span><br><span class="line">        Page size (bytes): 4096</span><br><span class="line">        Exit status: 0</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x7684;&#x529F;&#x80FD;&#x8981;&#x5F3A;&#x5927;&#x591A;&#x4E86;&#xFF0C;&#x9664;&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x4FE1;&#x606F;&#x5916;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x4E86;&#xFF1A;</p><ul><li>CPU&#x5360;&#x7528;&#x7387;&#xFF1B;</li><li>&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1B;</li><li>Page Fault &#x60C5;&#x51B5;&#xFF1B;</li><li>&#x8FDB;&#x7A0B;&#x5207;&#x6362;&#x60C5;&#x51B5;&#xFF1B;</li><li>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;IO&#xFF1B;</li><li>Socket &#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1B;</li><li>&#x2026;&#x2026;</li></ul><h2 id="bsd-macos-de-time"><a href="#BSD&#x3001;macOS-&#x7684;-time" class="headerlink" title="*BSD&#x3001;macOS &#x7684; time"></a>*BSD&#x3001;macOS &#x7684; <code>time</code> <a href="#bsd-macos-de-time" class="header-anchor">#</a></h2><p>*BSD &#x4E5F;&#x6709;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684; time&#xFF0C;&#x529F;&#x80FD;&#x7A0D;&#x900A;&#xFF0C;&#x4F46;&#x4E5F;&#x6BD4; Shell &#x91CC;&#x7684; <code>time</code> &#x5F3A;&#x5927;&#x3002;&#x6BD4;&#x5982; macOS &#x4E2D;&#x7EE7;&#x627F;&#x81EA; FreeBSD &#x7684; <code>time</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time -l go fmt github.com/docker/machine</span><br><span class="line">        0.70 real         0.05 user         0.40 sys</span><br><span class="line">  11710464  maximum resident <span class="built_in">set</span> size</span><br><span class="line">         0  average shared memory size</span><br><span class="line">         0  average unshared data size</span><br><span class="line">         0  average unshared stack size</span><br><span class="line">      8579  page reclaims</span><br><span class="line">      2571  page faults</span><br><span class="line">         0  swaps</span><br><span class="line">         0  block input operations</span><br><span class="line">         0  block output operations</span><br><span class="line">         0  messages sent</span><br><span class="line">         0  messages received</span><br><span class="line">         3  signals received</span><br><span class="line">      1118  voluntary context switches</span><br><span class="line">      1702  involuntary context switches</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6709;&#xFF1A;</p><ul><li>&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</li><li>Page Fault &#x60C5;&#x51B5;</li><li>IO &#x60C5;&#x51B5;</li><li>&#x8FDB;&#x7A0B;&#x5207;&#x6362;&#x60C5;&#x51B5;</li><li>Signal &#x60C5;&#x51B5;</li><li>&#x2026;&#x2026;</li></ul><h2 id="go-tool-zhong-de-toolexec-can-shu"><a href="#go-tool-&#x4E2D;&#x7684;-toolexec-&#x53C2;&#x6570;" class="headerlink" title="go tool &#x4E2D;&#x7684; -toolexec &#x53C2;&#x6570;"></a>go tool &#x4E2D;&#x7684; <code>-toolexec</code> &#x53C2;&#x6570; <a href="#go-tool-zhong-de-toolexec-can-shu" class="header-anchor">#</a></h2><p>&#x5F53;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x5F88;&#x6162;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x4F55;&#x624D;&#x80FD;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x6162;&#x5462;&#xFF1F;go &#x5DE5;&#x5177;&#x94FE;&#x4E2D;&#x652F;&#x6301; <code>-x</code> &#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5177;&#x4F53;&#x6267;&#x884C;&#x7684;&#x6BCF;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5230;&#x5E95;&#x6267;&#x884C;&#x5230;&#x54EA;&#x91CC;&#x7684;&#x65F6;&#x5019;&#x6162;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ go build -x fmt</span><br><span class="line">WORK=/var/folders/wc/9tzsn1hd7c38tvc54kctn4100000gn/T/go-build846067626</span><br><span class="line">mkdir -p <span class="variable">$WORK</span>/runtime/internal/sys/_obj/</span><br><span class="line">mkdir -p <span class="variable">$WORK</span>/runtime/internal/</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/internal/sys</span><br><span class="line">/usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/pkg/tool/darwin_amd64/compile -o <span class="variable">$WORK</span>/runtime/internal/sys.a -trimpath <span class="variable">$WORK</span> -goversion go1.9.1 -p runtime/internal/sys -std -+ -complete -buildid 2749cc50ea3a4ebcf</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x6784;&#x5EFA;&#x65F6;&#x95F4;&#x5F88;&#x957F;&#xFF0C;&#x6216;&#x8005;&#x662F;&#x8BA1;&#x5212;&#x5728; CI &#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x53EF;&#x80FD;&#x4E00;&#x76F4;&#x76EF;&#x7740;&#x4E86;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x65F6;&#x5019;&#x4ECE;&#x8F93;&#x51FA;&#x4E2D;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x5230;&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x524D;&#x7F00;&#x4E0A; <code>time</code>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x6BCF;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x592A;&#x7E41;&#x7410;&#x4E86;&#x3002;</p><p>go tool &#x5DE5;&#x5177;&#x94FE;&#x4E2D;&#xFF0C;&#x8FD8;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>-toolexec</code> &#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x5C06;&#x4F5C;&#x4E3A;&#x5DE5;&#x5177;&#x94FE;&#x6BCF;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x524D;&#x7F00;&#x6765;&#x6267;&#x884C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go build -toolexec=... github.com/pkg/profile</span><br><span class="line">go <span class="built_in">test</span> -toolexec=... net/http</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5982;&#x679C; <code>-toolexec=time</code>&#xFF0C;&#x90A3;&#x4E48;&#x5047;&#x5982;&#x6709;&#x4E00;&#x4E2A; <code>go build xxx.go</code> &#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x4F1A;&#x53D8;&#x4E3A; <code>time go build xxx.go</code> &#x6765;&#x6267;&#x884C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ go build -toolexec=<span class="string">&quot;/usr/bin/time&quot;</span> cmd/compile/internal/gc</span><br><span class="line"><span class="comment"># runtime/internal/sys</span></span><br><span class="line">        0.09 real         0.01 user         0.02 sys</span><br><span class="line"><span class="comment"># runtime/internal/atomic</span></span><br><span class="line">        0.01 real         0.00 user         0.00 sys</span><br><span class="line"><span class="comment"># runtime/internal/atomic</span></span><br><span class="line">        0.02 real         0.00 user         0.00 sys</span><br><span class="line"><span class="comment"># runtime</span></span><br><span class="line">        1.60 real         1.90 user         0.12 sys</span><br><span class="line"><span class="comment"># runtime</span></span><br><span class="line">        0.00 real         0.00 user         0.00 sys</span><br><span class="line"><span class="comment"># runtime</span></span><br><span class="line">        0.02 real         0.01 user         0.00 sys</span><br><span class="line"><span class="comment"># runtime</span></span><br><span class="line">        0.01 real         0.00 user         0.00 sys</span><br><span class="line"><span class="comment"># runtime</span></span><br><span class="line">        0.00 real         0.00 user         0.00 sys</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x7528;&#x597D;&#x4E86;&#xFF0C;&#x8FD9;&#x5C31;&#x53EF;&#x4EE5;&#x53D8;&#x5F97;&#x5F88;&#x5F3A;&#x5927;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x8BA1;&#x65F6;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC; <code>go build</code> &#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; Mac &#x6216;&#x8005; Linux &#x4E0A;&#x8FDB;&#x884C;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#xFF0C;&#x4F46;&#x662F; <code>go test</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5219;&#x5728;&#x624B;&#x673A;&#x8BBE;&#x5907;&#x4E0A;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x6821;&#x9A8C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x7684;&#x4E00;&#x81F4;&#x6027; &#xFF08;<code>toolstash</code>&#xFF09;</p><h1 id="fang-fa-er-godebug"><a href="#&#x65B9;&#x6CD5;&#x4E8C;&#xFF1A;GODEBUG" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E8C;&#xFF1A;GODEBUG"></a>&#x65B9;&#x6CD5;&#x4E8C;&#xFF1A;<code>GODEBUG</code> <a href="#fang-fa-er-godebug" class="header-anchor">#</a></h1><p><code>/usr/bin/time</code> &#x662F;&#x5916;&#x90E8;&#x5DE5;&#x5177;&#xFF0C;&#x9664;&#x6B64;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Go &#x5185;&#x7F6E;&#x7684;&#x529F;&#x80FD;&#x3002;Go &#x7684; runtime &#x53EF;&#x4EE5;&#x6536;&#x96C6;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x5468;&#x671F;&#x5185;&#x7684;&#x5F88;&#x591A;&#x6570;&#x636E;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E9B;&#x6536;&#x96C6;&#x9ED8;&#x8BA4;&#x90FD;&#x662F;&#x4E0D;&#x542F;&#x7528;&#x7684;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x542F;&#x7528;&#x7279;&#x5B9A;&#x4FE1;&#x606F;&#x7684;&#x6536;&#x96C6;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5173;&#x5FC3;&#x5783;&#x573E;&#x6536;&#x96C6;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x542F;&#x7528; <code>gctrace=1</code> &#x6807;&#x5FD7;&#x3002;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ env GODEBUG=gctrace=1 godoc -http=:8080</span><br><span class="line">gc 1 @18446741350.644s 0%: 0.026+2.0+0.075 ms clock, 0.052+2.6/2.0/0+0.15 ms cpu, 4-&gt;4-&gt;0 MB, 5 MB goal, 4 P</span><br><span class="line">gc 2 @18446741350.664s 0%: 0.12+1.5+0.049 ms clock, 0.25+0.50/1.2/0+0.098 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 4 P</span><br><span class="line">gc 3 @18446741350.695s 0%: 0.024+1.1+0.059 ms clock, 0.072+1.3/0.96/0+0.17 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 4P</span><br><span class="line">gc 4 @18446741350.714s 0%: 0.036+1.8+0.092 ms clock, 0.11+1.4/1.7/0+0.27 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 4 P</span><br><span class="line">gc 5 @18446741350.746s 0%: 0.021+2.2+0.055 ms clock, 0.087+2.5/2.1/0+0.22 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 4 P</span><br><span class="line">gc 6 @18446741350.770s 0%: 0.013+4.5+0.12 ms clock, 0.053+1.3/3.9/0+0.50 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 4 P</span><br><span class="line">gc 7 @18446741350.800s 0%: 0.020+2.5+0.056 ms clock, 0.083+2.4/2.5/0+0.22 ms cpu, 4-&gt;4-&gt;2 MB, 5 MB goal, 4 P</span><br><span class="line">gc 8 @18446741350.817s 0%: 0.030+3.2+0.053 ms clock, 0.12+2.8/3.0/0+0.21 ms cpu, 4-&gt;4-&gt;2 MB, 5 MB goal, 4 P</span><br><span class="line">gc 9 @18446741350.845s 0%: 0.041+4.7+0.10 ms clock, 0.16+1.6/4.3/0+0.40 ms cpu, 4-&gt;4-&gt;2 MB, 5 MB goal, 4 P</span><br><span class="line">gc 10 @18446741350.881s 0%: 0.018+3.7+0.070 ms clock, 0.072+2.5/3.6/0+0.28 ms cpu, 4-&gt;4-&gt;2 MB, 5 MB goal, 4</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5783;&#x573E;&#x6536;&#x96C6;&#x7684;&#x4FE1;&#x606F;&#x90FD;&#x4F1A;&#x88AB;&#x8F93;&#x51FA;&#x51FA;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9; GC &#x6392;&#x969C;&#x3002;&#x5982;&#x679C;&#x53D1;&#x73B0; GC &#x4E00;&#x76F4;&#x90FD;&#x5728;&#x5F88;&#x5FD9;&#x788C;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x90A3;&#x6050;&#x6015;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x4E0A;&#x6709;&#x53EF;&#x4EE5;&#x6539;&#x8FDB;&#x7684;&#x5730;&#x65B9;&#x3002;</p><h1 id="cha-qu-yi-profiler-shi-ru-he-gong-zuo-de"><a href="#&#x63D2;&#x66F2;&#x4E00;&#xFF1A;Profiler-&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;" class="headerlink" title="&#x63D2;&#x66F2;&#x4E00;&#xFF1A;Profiler &#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;"></a>&#x63D2;&#x66F2;&#x4E00;&#xFF1A;Profiler &#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F; <a href="#cha-qu-yi-profiler-shi-ru-he-gong-zuo-de" class="header-anchor">#</a></h1><p>Profiler &#x4F1A;&#x542F;&#x52A8;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x6765;&#x5B9A;&#x671F;&#x4E2D;&#x65AD;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x91C7;&#x6837;&#x3002;&#x6BD4;&#x5982;&#x53D1;&#x9001; <code>SIGPROF</code> &#x4FE1;&#x53F7;&#x7ED9;&#x88AB;&#x5206;&#x6790;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FD9;&#x6837;&#x8FDB;&#x7A0B;&#x5C31;&#x4F1A;&#x88AB;&#x6682;&#x505C;&#xFF0C;&#x7136;&#x540E;&#x5207;&#x6362;&#x5230; Profiler &#x4E2D;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;Profiler &#x5219;&#x53D6;&#x5F97;&#x88AB;&#x5206;&#x6790;&#x7684;&#x7A0B;&#x5E8F;&#x7684;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x7B49;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#xFF0C;&#x7136;&#x540E;&#x6062;&#x590D;&#x7A0B;&#x5E8F;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;</p><h2 id="xing-neng-fen-xi-zhu-yi-shi-xiang"><a href="#&#x6027;&#x80FD;&#x5206;&#x6790;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x6027;&#x80FD;&#x5206;&#x6790;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x6027;&#x80FD;&#x5206;&#x6790;&#x6CE8;&#x610F;&#x4E8B;&#x9879; <a href="#xing-neng-fen-xi-zhu-yi-shi-xiang" class="header-anchor">#</a></h2><ul><li>&#x6027;&#x80FD;&#x5206;&#x6790;&#x5FC5;&#x987B;&#x5728;&#x4E00;&#x4E2A;<strong>&#x53EF;&#x91CD;&#x590D;&#x7684;&#x3001;&#x7A33;&#x5B9A;&#x7684;&#x73AF;&#x5883;</strong>&#x4E2D;&#x6765;&#x8FDB;&#x884C;&#x3002;<ul><li>&#x673A;&#x5668;<strong>&#x5FC5;&#x987B;&#x95F2;&#x7F6E;</strong>&#x3002;<ul><li>&#x4E0D;&#x8981;&#x5728;&#x5171;&#x4EAB;&#x786C;&#x4EF6;&#x4E0A;&#x8FDB;&#x884C;&#x6027;&#x80FD;&#x5206;&#x6790;;</li><li>&#x4E0D;&#x8981;&#x5728;&#x6027;&#x80FD;&#x5206;&#x6790;&#x671F;&#x95F4;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x53BB;&#x6D4F;&#x89C8;&#x7F51;&#x9875;&#xFF01;&#xFF01;&#x1F613;&#xFF1B;</li></ul></li><li>&#x6CE8;&#x610F;&#x7701;&#x7535;&#x6A21;&#x5F0F;&#x548C;&#x8FC7;&#x70ED;&#x4FDD;&#x62A4;&#xFF0C;&#x5982;&#x679C;&#x7A81;&#x7136;&#x8FDB;&#x5165;&#x8FD9;&#x4E9B;&#x6A21;&#x5F0F;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x5206;&#x6790;&#x6570;&#x636E;&#x4E25;&#x91CD;&#x4E0D;&#x51C6;&#x786E;</li><li><strong>&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;&#x3001;&#x5171;&#x4EAB;&#x7684;&#x4E91;&#x4E3B;&#x673A;</strong>&#xFF0C;&#x592A;&#x591A;&#x5E72;&#x6270;&#x56E0;&#x7D20;&#xFF0C;&#x5206;&#x6790;&#x6570;&#x636E;&#x4F1A;&#x5F88;&#x4E0D;&#x4E00;&#x81F4;&#xFF1B;</li><li>&#x4E0D;&#x8981;&#x5728; macOS 10.11 &#x53CA;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x8FD0;&#x884C;&#x6027;&#x80FD;&#x5206;&#x6790;&#xFF0C;&#x6709; bug&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#x4FEE;&#x590D;&#x4E86;&#x3002;</li></ul></li></ul><p>&#x5982;&#x679C;&#x627F;&#x53D7;&#x5F97;&#x8D77;&#xFF0C;&#x8D2D;&#x4E70;&#x4E13;&#x7528;&#x7684;&#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x5206;&#x6790;&#x7684;&#x786C;&#x4EF6;&#x8BBE;&#x5907;&#xFF0C;&#x4E0A;&#x67B6;&#x3002;</p><ul><li>&#x5173;&#x95ED;&#x7535;&#x6E90;&#x7BA1;&#x7406;&#x3001;&#x8FC7;&#x70ED;&#x7BA1;&#x7406;;</li><li>&#x7EDD;&#x4E0D;&#x8981;&#x5347;&#x7EA7;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x6D4B;&#x8BD5;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4EE5;&#x53CA;&#x5177;&#x6709;&#x53EF;&#x6BD4;&#x6027;&#x3002;</li></ul><p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x90A3;&#x5C31;&#x4E00;&#x5B9A;&#x8981;&#x5728;&#x591A;&#x4E2A;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x6267;&#x884C;&#x591A;&#x6B21;&#xFF0C;&#x4EE5;&#x53D6;&#x5F97;&#x53EF;&#x53C2;&#x8003;&#x7684;&#x3001;&#x5177;&#x6709;&#x76F8;&#x5BF9;&#x4E00;&#x81F4;&#x6027;&#x7684;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x3002;</p><h1 id="fang-fa-san-pprof"><a href="#&#x65B9;&#x6CD5;&#x4E09;&#xFF1A;pprof" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E09;&#xFF1A;pprof"></a>&#x65B9;&#x6CD5;&#x4E09;&#xFF1A;<code>pprof</code> <a href="#fang-fa-san-pprof" class="header-anchor">#</a></h1><p><a href="https://github.com/google/pprof" target="_blank" rel="noopener"><code>pprof</code></a> &#x6E90;&#x81EA; <a href="https://github.com/gperftools/gperftools/wiki" target="_blank" rel="noopener">Google Performance Tools</a> &#x5DE5;&#x5177;&#x96C6;&#x3002;Go runtime &#x4E2D;&#x5185;&#x7F6E;&#x4E86; <code>pprof</code> &#x7684;&#x6027;&#x80FD;&#x5206;&#x6790;&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x5305;&#x542B;&#x4E86;&#x4E24;&#x90E8;&#x5206;&#xFF1A;</p><ul><li>&#x6BCF;&#x4E2A; Go &#x7A0B;&#x5E8F;&#x4E2D;&#x5185;&#x7F6E; <a href="https://golang.org/pkg/runtime/pprof/" target="_blank" rel="noopener"><code>runtime/pprof</code></a> &#x5305;</li><li>&#x7136;&#x540E;&#x7528; <a href="https://blog.golang.org/profiling-go-programs" target="_blank" rel="noopener"><code>go tool pprof</code></a> &#x6765;&#x5206;&#x6790;&#x6027;&#x80FD;&#x6570;&#x636E;&#x6587;&#x4EF6;</li></ul><h2 id="cpu-xing-neng-fen-xi"><a href="#CPU-&#x6027;&#x80FD;&#x5206;&#x6790;" class="headerlink" title="CPU &#x6027;&#x80FD;&#x5206;&#x6790;"></a>CPU &#x6027;&#x80FD;&#x5206;&#x6790; <a href="#cpu-xing-neng-fen-xi" class="header-anchor">#</a></h2><p>&#x6700;&#x5E38;&#x7528;&#x7684;&#x5C31;&#x662F; CPU &#x6027;&#x80FD;&#x5206;&#x6790;&#xFF0C;&#x5F53; CPU &#x6027;&#x80FD;&#x5206;&#x6790;&#x542F;&#x7528;&#x540E;&#xFF0C;Go runtime &#x4F1A;&#x6BCF; <code>10ms</code> &#x5C31;&#x6682;&#x505C;&#x4E00;&#x4E0B;&#xFF0C;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x8FD0;&#x884C;&#x7684; Go routine &#x7684;&#x8C03;&#x7528;&#x5806;&#x6808;&#x53CA;&#x76F8;&#x5173;&#x6570;&#x636E;&#x3002;&#x5F53;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5230;&#x786C;&#x76D8;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x70ED;&#x70B9;&#x4E86;&#x3002;</p><p>&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x5728;&#x6570;&#x636E;&#x4E2D;&#x7684;&#x6B21;&#x6570;&#x8D8A;&#x591A;&#xFF0C;&#x5C31;&#x8D8A;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;&#x5360;&#x7528;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;</p><h2 id="nei-cun-xing-neng-fen-xi"><a href="#&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;" class="headerlink" title="&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;"></a>&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790; <a href="#nei-cun-xing-neng-fen-xi" class="header-anchor">#</a></h2><p>&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5219;&#x662F;&#x5728;<strong>&#x5806;(Heap)&#x5206;&#x914D;</strong>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x8C03;&#x7528;&#x5806;&#x6808;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x662F;&#x6BCF; <code>1000</code> &#x6B21;&#x5206;&#x914D;&#xFF0C;&#x53D6;&#x6837;&#x4E00;&#x6B21;&#xFF0C;&#x8FD9;&#x4E2A;&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x3002;</p><p><strong>&#x6808;(Stack)&#x5206;&#x914D;</strong> &#x7531;&#x4E8E;&#x4F1A;&#x968F;&#x65F6;&#x91CA;&#x653E;&#xFF0C;&#x56E0;&#x6B64;<strong>&#x4E0D;&#x4F1A;</strong>&#x88AB;&#x5185;&#x5B58;&#x5206;&#x6790;&#x6240;&#x8BB0;&#x5F55;&#x3002;</p><p>&#x7531;&#x4E8E;&#x5185;&#x5B58;&#x5206;&#x6790;&#x662F;<strong>&#x53D6;&#x6837;</strong>&#x65B9;&#x5F0F;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x56E0;&#x4E3A;&#x5176;&#x8BB0;&#x5F55;&#x7684;<strong>&#x662F;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x5185;&#x5B58;</strong>&#x3002;&#x56E0;&#x6B64;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x6765;&#x51C6;&#x786E;&#x5224;&#x65AD;&#x7A0B;&#x5E8F;&#x5177;&#x4F53;&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x662F;&#x6BD4;&#x8F83;&#x56F0;&#x96BE;&#x7684;&#x3002;</p><h2 id="zu-sai-xing-neng-fen-xi"><a href="#&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;" class="headerlink" title="&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;"></a>&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790; <a href="#zu-sai-xing-neng-fen-xi" class="header-anchor">#</a></h2><p>&#x963B;&#x585E;&#x5206;&#x6790;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x72EC;&#x7279;&#x7684;&#x5206;&#x6790;&#x3002;&#x5B83;&#x6709;&#x70B9;&#x513F;&#x7C7B;&#x4F3C;&#x4E8E; CPU &#x6027;&#x80FD;&#x5206;&#x6790;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x6240;&#x8BB0;&#x5F55;&#x7684;&#x662F; goroutine &#x7B49;&#x5F85;&#x8D44;&#x6E90;&#x6240;&#x82B1;&#x7684;&#x65F6;&#x95F4;&#x3002;</p><p>&#x963B;&#x585E;&#x5206;&#x6790;&#x5BF9;&#x5206;&#x6790;&#x7A0B;&#x5E8F;<strong>&#x5E76;&#x53D1;&#x74F6;&#x9888;</strong>&#x975E;&#x5E38;&#x6709;&#x5E2E;&#x52A9;&#x3002;&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x51FA;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x51FA;&#x73B0;&#x4E86;&#x5927;&#x6279;&#x7684; goroutine &#x88AB;&#x963B;&#x585E;&#x4E86;&#x3002;&#x963B;&#x585E;&#x5305;&#x62EC;&#xFF1A;</p><ul><li>&#x53D1;&#x9001;&#x3001;&#x63A5;&#x53D7;&#x65E0;&#x7F13;&#x51B2;&#x7684; channel&#xFF1B;</li><li>&#x53D1;&#x9001;&#x7ED9;&#x4E00;&#x4E2A;&#x6EE1;&#x7F13;&#x51B2;&#x7684; channel&#xFF0C;&#x6216;&#x8005;&#x4ECE;&#x4E00;&#x4E2A;&#x7A7A;&#x7F13;&#x51B2;&#x7684; channel &#x63A5;&#x6536;&#xFF1B;</li><li>&#x8BD5;&#x56FE;&#x83B7;&#x53D6;&#x5DF2;&#x88AB;&#x53E6;&#x4E00;&#x4E2A; go routine &#x9501;&#x5B9A;&#x7684; <code>sync.Mutex</code> &#x7684;&#x9501;&#xFF1B;</li></ul><p>&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x662F;&#x7279;&#x6B8A;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;&#x5728;&#x6392;&#x9664; CPU &#x548C;&#x5185;&#x5B58;&#x74F6;&#x9888;&#x524D;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x7528;&#x5B83;&#x6765;&#x5206;&#x6790;&#x3002;</p><h2 id="yi-ci-zhi-fen-xi-yi-ge-dong-xi"><a href="#&#x4E00;&#x6B21;&#x53EA;&#x5206;&#x6790;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;" class="headerlink" title="&#x4E00;&#x6B21;&#x53EA;&#x5206;&#x6790;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;"></a>&#x4E00;&#x6B21;&#x53EA;&#x5206;&#x6790;&#x4E00;&#x4E2A;&#x4E1C;&#x897F; <a href="#yi-ci-zhi-fen-xi-yi-ge-dong-xi" class="header-anchor">#</a></h2><p><strong>&#x6027;&#x80FD;&#x5206;&#x6790;&#x4E0D;&#x662F;&#x6CA1;&#x6709;&#x5F00;&#x9500;&#x7684;</strong>&#x3002;&#x867D;&#x7136;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x5F71;&#x54CD;&#x5E76;&#x4E0D;&#x4E25;&#x91CD;&#xFF0C;&#x4F46;&#x662F;&#x6BD5;&#x7ADF;&#x6709;&#x5F71;&#x54CD;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5185;&#x5B58;&#x5206;&#x6790;&#x7684;&#x65F6;&#x5019;&#x589E;&#x52A0;&#x91C7;&#x6837;&#x7387;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5927;&#x591A;&#x6570;&#x5DE5;&#x5177;&#x751A;&#x81F3;&#x76F4;&#x63A5;&#x5C31;&#x4E0D;&#x5141;&#x8BB8;&#x4F60;&#x540C;&#x65F6;&#x5F00;&#x542F;&#x591A;&#x4E2A;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x3002;&#x5982;&#x679C;&#x4F60;&#x540C;&#x65F6;&#x5F00;&#x542F;&#x4E86;&#x591A;&#x4E2A;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;&#x90A3;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x4ED6;&#x4EEC;&#x4E92;&#x76F8;&#x89C2;&#x5BDF;&#x5BF9;&#x65B9;&#x7684;&#x5F00;&#x9500;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x4F60;&#x7684;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x5F7B;&#x5E95;&#x5931;&#x53BB;&#x610F;&#x4E49;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;<strong>&#x4E00;&#x6B21;&#x53EA;&#x5206;&#x6790;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;</strong>&#x3002;</p><h2 id="dui-han-shu-fen-xi"><a href="#&#x5BF9;&#x51FD;&#x6570;&#x5206;&#x6790;" class="headerlink" title="&#x5BF9;&#x51FD;&#x6570;&#x5206;&#x6790;"></a>&#x5BF9;&#x51FD;&#x6570;&#x5206;&#x6790; <a href="#dui-han-shu-fen-xi" class="header-anchor">#</a></h2><p>&#x6700;&#x7B80;&#x5355;&#x7684;&#x5BF9;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x6027;&#x80FD;&#x5206;&#x6790;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x4F7F;&#x7528; <code>testing</code> &#x5305;&#x3002;<code>testing</code> &#x5305;&#x5185;&#x7F6E;&#x652F;&#x6301;&#x751F;&#x6210; CPU&#x3001;&#x5185;&#x5B58;&#x3001;&#x963B;&#x585E;&#x7684;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x3002;</p><ul><li><code>-cpuprofile=xxxx</code>&#xFF1A; &#x751F;&#x6210; <strong>CPU</strong> &#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5199;&#x5165;&#x6587;&#x4EF6; <code>xxxx</code>&#xFF1B;</li><li><code>-memprofile=xxxx</code>&#xFF1A; &#x751F;&#x6210; <strong>&#x5185;&#x5B58;</strong> &#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5199;&#x5165;&#x6587;&#x4EF6; <code>xxxx</code>&#xFF1B;<ul><li><code>-memprofilerate=N</code>&#xFF1A;&#x8C03;&#x6574;&#x91C7;&#x6837;&#x7387;&#x4E3A; <code>1/N</code>&#xFF1B;</li></ul></li><li><code>-blockprofile=xxxx</code>&#xFF1A; &#x751F;&#x6210; <strong>&#x963B;&#x585E;</strong> &#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5199;&#x5165;&#x6587;&#x4EF6; <code>xxxx</code>&#xFF1B;</li></ul><p>&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> -run=XXX -bench=IndexByte -cpuprofile=/tmp/c.p bytes</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: bytes</span><br><span class="line">BenchmarkIndexByte/10-4         200000000                6.44 ns/op     1553.83 MB/s</span><br><span class="line">BenchmarkIndexByte/32-4         200000000                7.41 ns/op     4318.84 MB/s</span><br><span class="line">BenchmarkIndexByte/4K-4         10000000               210 ns/op        19455.95 MB/s</span><br><span class="line">BenchmarkIndexByte/4M-4             5000            321910 ns/op        13029.39 MB/s</span><br><span class="line">BenchmarkIndexByte/64M-4             300           5406798 ns/op        12411.94 MB/s</span><br><span class="line">BenchmarkIndexBytePortable/10-4                 100000000               13.8 ns/op       722.79 MB/s</span><br><span class="line">BenchmarkIndexBytePortable/32-4                 30000000                44.9 ns/op       712.86 MB/s</span><br><span class="line">BenchmarkIndexBytePortable/4K-4                   500000              2910 ns/op        1407.32 MB/s</span><br><span class="line">BenchmarkIndexBytePortable/4M-4                      500           2979323 ns/op        1407.80 MB/s</span><br><span class="line">BenchmarkIndexBytePortable/64M-4                      30          47259940 ns/op        1419.99 MB/s</span><br><span class="line">PASS</span><br><span class="line">ok      bytes   18.689s</span><br></pre></td></tr></table></figure><blockquote><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>-run=XXX</code> &#x662F;&#x8BF4;&#x53EA;&#x8FD0;&#x884C; Benchmarks&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x8FD0;&#x884C;&#x4EFB;&#x4F55; Tests&#x3002;</p></blockquote><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x7528; <code>go tool pprof</code> &#x6765;&#x5206;&#x6790;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go tool pprof bytes.test /tmp/c.p</span><br></pre></td></tr></table></figure><h2 id="dui-zheng-ge-ying-yong-fen-xi"><a href="#&#x5BF9;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x5206;&#x6790;" class="headerlink" title="&#x5BF9;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x5206;&#x6790;"></a>&#x5BF9;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x5206;&#x6790; <a href="#dui-zheng-ge-ying-yong-fen-xi" class="header-anchor">#</a></h2><p><code>testing</code> &#x9002;&#x7528;&#x4E8E;&#x5206;&#x6790;&#x5177;&#x4F53;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x60F3;&#x5206;&#x6790;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>runtime/pprof</code> &#x5305;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x6BD4;&#x8F83;&#x5E95;&#x5C42;&#xFF0C;Dave Cheney &#x5728;&#x51E0;&#x5E74;&#x524D;&#x8FD8;&#x5199;&#x4E86;&#x4E2A;&#x5305; <a href="https://github.com/pkg/profile" target="_blank" rel="noopener"><code>github.com/pkg/profile</code></a>&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x4F7F;&#x7528;&#x3002;</p><p>&#x53EA;&#x9700;&#x8981;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x52A0;&#x5165; <code>defer profile.Start().Stop()</code> &#x5373;&#x53EF;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/pkg/profile&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">defer</span> profile.Start().Stop()</span><br><span class="line">        ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h1 id="fang-fa-si-debug-pprof"><a href="#&#x65B9;&#x6CD5;&#x56DB;&#xFF1A;-debug-pprof" class="headerlink" title="&#x65B9;&#x6CD5;&#x56DB;&#xFF1A;/debug/pprof"></a>&#x65B9;&#x6CD5;&#x56DB;&#xFF1A;<code>/debug/pprof</code> <a href="#fang-fa-si-debug-pprof" class="header-anchor">#</a></h1><p><code>pprof</code> &#x9002;&#x5408;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x4ECE;&#x8FD0;&#x884C;&#x5230;&#x7ED3;&#x675F;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x5E94;&#x7528;&#x5DF2;&#x7ECF;&#x5728;&#x6570;&#x636E;&#x4E2D;&#x5FC3;&#x8FD0;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8FDC;&#x7A0B;&#x542F;&#x7528;&#x8C03;&#x8BD5;&#x8FDB;&#x884C;&#x5728;&#x7EBF;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>http</code> &#x8FDC;&#x7A0B;&#x8C03;&#x8BD5;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">        log.Println(http.ListenAndServe(<span class="string">&quot;localhost:3999&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">        ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x4F7F;&#x7528; <code>pprof</code> &#x5DE5;&#x5177;&#x6765;&#x67E5;&#x770B;&#x4E00;&#x6BB5; <code>30&#x79D2;</code> &#x7684;&#xFF1A;</p><ul><li>CPU &#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF1A;</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:3999/debug/pprof/profile</span><br></pre></td></tr></table></figure><ul><li>&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF1A;</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:3999/debug/pprof/heap</span><br></pre></td></tr></table></figure><blockquote><p>&#x5728; <code>/debug/pprof/heap</code> &#x9875;&#x9762;&#x7684;&#x6700;&#x4E0B;&#x65B9;&#xFF0C;&#x662F; <code>runtime.MemStats</code>&#xFF0C;&#x8FD9;&#x662F;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x771F;&#x5B9E;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5206;&#x914D;&#xFF09;&#x3002;&#x5176;&#x4E2D;&#x7684; <code>HeapSys</code> &#x662F;&#x5E94;&#x7528;&#x4ECE;&#x7CFB;&#x7EDF;&#x7533;&#x8BF7;&#x5230;&#x7684;&#x9875;&#x9762;&#x6570;&#x91CF;&#x3002;</p></blockquote><ul><li>&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF1A;</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:3999/debug/pprof/block</span><br></pre></td></tr></table></figure><h2 id="shi-yong-pprof"><a href="#&#x4F7F;&#x7528;-pprof" class="headerlink" title="&#x4F7F;&#x7528; pprof"></a>&#x4F7F;&#x7528; <code>pprof</code> <a href="#shi-yong-pprof" class="header-anchor">#</a></h2><p><code>pprof</code> &#x59CB;&#x7EC8;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof /path/to/your/binary /path/to/your/profile</span><br></pre></td></tr></table></figure><ul><li><code>binary</code> &#x5FC5;&#x987B;&#x6307;&#x5411;&#x751F;&#x6210;&#x8FD9;&#x4E2A;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x7684;&#x90A3;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF1B;</li><li><code>profile</code> &#x5FC5;&#x987B;&#x662F;&#x8BE5;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6240;&#x751F;&#x6210;&#x7684;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;</li></ul><p>&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;<strong><code>binary</code> &#x548C; <code>profile</code> &#x5FC5;&#x987B;&#x4E25;&#x683C;&#x5339;&#x914D;</strong>&#x3002;</p><p>&#x7531;&#x4E8E; <code>pprof</code> &#x6709;&#x5728;&#x7EBF;&#x6A21;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x4EBA;&#x8BEF;&#x89E3;&#x4E86;&#x53EF;&#x4EE5;&#x53EA;&#x6709; profile&#x3002;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4EBA;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof /tmp/c.p</span><br></pre></td></tr></table></figure><p><strong>&#x4E0D;&#x662F;&#x8FD9;&#x6837;&#x7684;</strong>&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x53D1;&#x73B0;&#x663E;&#x793A; profile &#x91CC;&#x9762;&#x662F;&#x7A7A;&#x7684;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x91CC;&#x5206;&#x6790;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ go tool pprof bytes.test /tmp/c.p</span><br><span class="line">File: bytes.test</span><br><span class="line">Type: cpu</span><br><span class="line">Time: Oct 22, 2017 at 8:41pm (AEDT)</span><br><span class="line">Duration: 18.60s, Total samples = 16.38s (88.06%)</span><br><span class="line">Entering interactive mode (<span class="built_in">type</span> <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> options)</span><br><span class="line">(pprof) top</span><br><span class="line">Showing nodes accounting <span class="keyword">for</span> 16300ms, 99.51% of 16380ms total</span><br><span class="line">Dropped 30 nodes (cum &lt;= 81.90ms)</span><br><span class="line">Showing top 10 nodes out of 12</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">    7560ms 46.15% 46.15%     7560ms 46.15%  runtime.indexbytebody /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/asm_amd64.s</span><br><span class="line">    5950ms 36.32% 82.48%     5950ms 36.32%  bytes.indexBytePortable /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/bytes/bytes.go</span><br><span class="line">    2180ms 13.31% 95.79%    15880ms 96.95%  bytes_test.bmIndexByte.func1 /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/bytes/bytes_test.go</span><br><span class="line">     420ms  2.56% 98.35%      420ms  2.56%  runtime.usleep /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/sys_darwin_amd64.s</span><br><span class="line">     190ms  1.16% 99.51%      190ms  1.16%  bytes.IndexByte /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/asm_amd64.s</span><br><span class="line">         0     0% 99.51%    15880ms 96.95%  bytes_test.benchBytes.func1 /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/bytes/bytes_test.go</span><br><span class="line">         0     0% 99.51%      410ms  2.50%  runtime.mstart /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/proc.go</span><br><span class="line">         0     0% 99.51%      410ms  2.50%  runtime.mstart1 /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/proc.go</span><br><span class="line">         0     0% 99.51%      410ms  2.50%  runtime.sysmon /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/runtime/proc.go</span><br><span class="line">         0     0% 99.51%    15810ms 96.52%  testing.(*B).launch /usr/<span class="built_in">local</span>/Cellar/go/1.9.1/libexec/src/testing/benchmark.go</span><br><span class="line">(pprof)</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x663E;&#x7136;&#x5F88;&#x4E0D;&#x76F4;&#x89C2;&#xFF0C;&#x6027;&#x80FD;&#x5206;&#x6790;&#x66F4;&#x597D;&#x7684;&#x662F;&#x4F7F;&#x7528;&#x53EF;&#x89C6;&#x5316;&#x5206;&#x6790;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x4E0B;&#x6267;&#x884C; <code>web</code> &#x547D;&#x4EE4;&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A; <code>svg</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x6216;&#x8005;&#x5176;&#x5B83;&#x5DE5;&#x5177;&#x6253;&#x5F00;&#x3002;</p><p><img src="../pics/golang/profile/pprof.svg" alt="profile svg"></p><p>&#x8FD9;&#x4E2A;&#x56FE;&#x662F; CPU &#x6027;&#x80FD;&#x5206;&#x6790;&#x7684;&#x56FE;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x76F4;&#x89C2;&#x7684;&#x770B;&#x51FA;&#x54EA;&#x4E2A;&#x5730;&#x65B9;&#x6700;&#x6D88;&#x8017; CPU&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x95F4;&#x8D8A;&#x591A;&#x7684;&#xFF0C;&#x65B9;&#x5757;&#x9762;&#x79EF;&#x5C31;&#x8D8A;&#x5927;&#x3002;&#x800C;&#x4E14;&#x7531;&#x4E8E;&#x5176;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x6E05;&#x6670;&#x53EF;&#x89C1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x6E05;&#x695A;&#x7684;&#x770B;&#x5230;&#x4E3A;&#x4EC0;&#x4E48;&#x5B83;&#x4F1A;&#x6D88;&#x8017;&#x5F88;&#x591A; CPU&#x3002;</p><p>&#x8FD9;&#x91CC;&#x9ED8;&#x8BA4;&#x662F; <code>-svg</code>&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A; <code>-pdf</code> &#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x7528; <code>go tool pprof -help</code> &#x6765;&#x67E5;&#x770B;&#x8BE6;&#x7EC6;&#x914D;&#x7F6E;&#x3002;</p><p>&#x63A8;&#x8350;&#x9605;&#x8BFB;&#xFF1A;</p><ul><li><a href="http://blog.golang.org/profiling-go-programs" target="_blank" rel="noopener">Profiling Go programs</a></li><li><a href="https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs" target="_blank" rel="noopener">Debugging performance issues in Go programs</a></li></ul><p>&#x9664;&#x4E86;&#x53EF;&#x89C6;&#x5316; CPU &#x6027;&#x80FD;&#x5206;&#x6790;&#x5916;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x5206;&#x6790;&#x5185;&#x5B58;&#x548C;&#x963B;&#x585E;&#x3002;</p><h3 id="nei-cun-xing-neng-fen-xi"><a href="#&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#xFF1A;" class="headerlink" title="&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#xFF1A;"></a>&#x5185;&#x5B58;&#x6027;&#x80FD;&#x5206;&#x6790;&#xFF1A; <a href="#nei-cun-xing-neng-fen-xi" class="header-anchor">#</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go build -gcflags=<span class="string">&apos;-memprofile=/tmp/m.p&apos;</span></span><br><span class="line">$ go tool pprof --alloc_objects -svg $(go tool -n compile) /tmp/m.p &gt; alloc_objects.svg</span><br><span class="line">$ go tool pprof --inuse_objects -svg $(go tool -n compile) /tmp/m.p &gt; inuse_objects.svg</span><br></pre></td></tr></table></figure><ul><li>alloc_objects</li></ul><p><img src="../pics/golang/profile/alloc_objects.svg" alt="alloc_objects"></p><ul><li>inuse_objects</li></ul><p><img src="../pics/golang/profile/inuse_objects.svg" alt="inuse_objects"></p><h3 id="zu-sai-xing-neng-fen-xi"><a href="#&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;-1" class="headerlink" title="&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790;"></a>&#x963B;&#x585E;&#x6027;&#x80FD;&#x5206;&#x6790; <a href="#zu-sai-xing-neng-fen-xi" class="header-anchor">#</a></h3><p>&#x8FD9;&#x91CC;&#x5206;&#x6790;&#x7684;&#x662F; <code>net/http</code> &#x5305;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> -run=XXX -bench=ClientServer -blockprofile=/tmp/b.p net/http</span><br><span class="line">$ go tool pprof -svg http.test /tmp/b.p &gt; block.svg</span><br></pre></td></tr></table></figure><p><img src="../pics/golang/profile/block.svg" alt="inuse_objects"></p><h1 id="cha-qu-er-frame-pointer"><a href="#&#x63D2;&#x66F2;&#x4E8C;&#xFF1A;Frame-Pointer" class="headerlink" title="&#x63D2;&#x66F2;&#x4E8C;&#xFF1A;Frame Pointer"></a>&#x63D2;&#x66F2;&#x4E8C;&#xFF1A;Frame Pointer <a href="#cha-qu-er-frame-pointer" class="header-anchor">#</a></h1><p><a href="https://en.wikipedia.org/wiki/Call_stack#Stack_and_frame_pointers" target="_blank" rel="noopener">Frame pointer</a> &#x662F;&#x6574;&#x4E2A; Unix/Linux &#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#x94FE;&#x7684;&#x6838;&#x5FC3;&#x7684;&#x4E1C;&#x897F;&#x3002;Frame Pointer &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x8C03;&#x7528;&#x6808;&#x9876;&#x7AEF;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x3002;</p><p>Go &#x4ECE; <code>1.7</code> &#x5F00;&#x59CB;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x9ED8;&#x8BA4;&#x542F;&#x7528; Frame pointers &#x4E86;&#x3002;&#x6240;&#x4EE5;&#x50CF; <a href="https://sourceware.org/gdb/current/onlinedocs/gdb/" target="_blank" rel="noopener">gdb</a>&#x3001;<a href="https://perf.wiki.kernel.org/index.php/Tutorial" target="_blank" rel="noopener">perf</a> &#x547D;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x7406;&#x89E3; Go &#x7684;&#x8C03;&#x7528;&#x6808;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#x5206;&#x6790;&#x3002;</p><h1 id="fang-fa-wu-perf"><a href="#&#x65B9;&#x6CD5;&#x4E94;&#xFF1A;perf" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E94;&#xFF1A;perf"></a>&#x65B9;&#x6CD5;&#x4E94;&#xFF1A;<code>perf</code> <a href="#fang-fa-wu-perf" class="header-anchor">#</a></h1><p>&#x5BF9;&#x4E8E; Linux &#x7528;&#x6237;&#x6765;&#x8BF4;&#xFF0C;<a href="http://www.brendangregg.com/perf.html" target="_blank" rel="noopener"><code>perf</code></a> &#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x7531;&#x4E8E;&#x73B0;&#x5728; Go &#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x4E86; Frame Pointer&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x548C; <code>-toolexec=</code> &#x914D;&#x5408;&#x6765;&#x5BF9; Go &#x5E94;&#x7528;&#x8FDB;&#x884C;&#x6027;&#x80FD;&#x5206;&#x6790;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go build -toolexec=<span class="string">&quot;perf stat&quot;</span> cmd/compile/internal/gc</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7528; <code>perf record</code> &#x6765;&#x8BB0;&#x5F55;&#x4E00;&#x6BB5;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go build -toolexec=<span class="string">&quot;perf record -g -o /tmp/p&quot;</span> cmd/compile/internal/gc</span><br><span class="line">$ perf report -i /tmp/p</span><br></pre></td></tr></table></figure><p><img src="https://github.com/davecheney/presentations/raw/master/seven/perf.png" alt="perf"></p><h1 id="fang-fa-liu-huo-yan-tu-flame-graph"><a href="#&#x65B9;&#x6CD5;&#x516D;&#xFF1A;&#x706B;&#x7130;&#x56FE;-Flame-Graph" class="headerlink" title="&#x65B9;&#x6CD5;&#x516D;&#xFF1A;&#x706B;&#x7130;&#x56FE; (Flame Graph)"></a>&#x65B9;&#x6CD5;&#x516D;&#xFF1A;&#x706B;&#x7130;&#x56FE; (Flame Graph) <a href="#fang-fa-liu-huo-yan-tu-flame-graph" class="header-anchor">#</a></h1><p><a href="http://www.brendangregg.com/flamegraphs.html" target="_blank" rel="noopener">&#x706B;&#x7130;&#x56FE;(Flame Graph)</a> &#x4E5F;&#x662F;&#x6027;&#x80FD;&#x5206;&#x6790;&#x7684;&#x5229;&#x5668;&#x3002;&#x6700;&#x521D;&#x662F;&#x7531; Netflix &#x7684; <a href="https://github.com/brendangregg" target="_blank" rel="noopener">Brendan Gregg</a> &#x53D1;&#x660E;&#x5E76;&#x63A8;&#x5E7F;&#x7684;&#x3002;</p><p><strong>X &#x8F74;</strong>&#x663E;&#x793A;&#x7684;&#x662F;&#x5728;&#x8BE5;&#x6027;&#x80FD;&#x6307;&#x6807;&#x5206;&#x6790;&#x4E2D;&#x6240;<strong>&#x5360;&#x7528;&#x7684;&#x8D44;&#x6E90;&#x91CF;</strong>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6A2A;&#x5411;&#x8D8A;&#x5BBD;&#xFF0C;&#x5219;&#x610F;&#x5473;&#x7740;&#x5728;&#x8BE5;&#x6307;&#x6807;&#x4E2D;&#x5360;&#x7528;&#x7684;&#x8D44;&#x6E90;&#x8D8A;&#x591A;&#xFF0C;<strong>Y &#x8F74;</strong>&#x5219;&#x662F;<strong>&#x8C03;&#x7528;&#x6808;&#x7684;&#x6DF1;&#x5EA6;</strong>&#x3002;</p><p>&#x6709;&#x51E0;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p><ul><li><strong>&#x5DE6;&#x53F3;&#x987A;&#x5E8F;&#x4E0D;&#x91CD;&#x8981;</strong>&#xFF0C;X &#x8F74;&#x4E0D;&#x662F;&#x6309;&#x65F6;&#x95F4;&#x987A;&#x5E8F;&#x53D1;&#x751F;&#x7684;&#xFF0C;&#x800C;&#x662F;<strong>&#x6309;&#x5B57;&#x6BCD;&#x987A;&#x5E8F;&#x6392;&#x5E8F;&#x7684;</strong></li><li>&#x867D;&#x7136;&#x5F88;&#x597D;&#x770B;&#xFF0C;&#x4F46;&#x662F;<strong>&#x989C;&#x8272;&#x6DF1;&#x6D45;&#x6CA1;&#x5173;&#x7CFB;</strong>&#xFF0C;&#x8FD9;&#x662F;&#x968F;&#x673A;&#x9009;&#x53D6;&#x7684;&#x3002;</li></ul><p>&#x706B;&#x7130;&#x56FE;&#x53EF;&#x4EE5;&#x6765;&#x81EA;&#x4E8E;&#x5F88;&#x591A;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x5305;&#x62EC; <code>pprof</code> &#x548C; <code>perf</code>&#x3002;</p><p>&#x611F;&#x8C22; Uber &#x63D0;&#x4F9B;&#x4E86;&#x706B;&#x7130;&#x56FE;&#x7684; Go &#x7684;&#x5DE5;&#x5177;&#xFF0C;<a href="https://github.com/uber/go-torch" target="_blank" rel="noopener">go-torch</a>&#xFF0C;&#x5728;&#x4F60;&#x63D0;&#x4F9B;&#x4E86; <code>/debug/pprof</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x5904;&#x7406;&#x751F;&#x6210;&#x706B;&#x7130;&#x56FE;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go build -gcflags=-cpuprofile=/tmp/c.p .</span><br><span class="line">$ go-torch $(go tool -n compile) /tmp/c.p</span><br></pre></td></tr></table></figure><p><img src="https://github.com/davecheney/presentations/raw/master/seven/torch.svg?sanitize=true" alt="torch"></p><h1 id="fang-fa-qi-go-tool-trace"><a href="#&#x65B9;&#x6CD5;&#x4E03;&#xFF1A;go-tool-trace" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E03;&#xFF1A;go tool trace"></a>&#x65B9;&#x6CD5;&#x4E03;&#xFF1A;<code>go tool trace</code> <a href="#fang-fa-qi-go-tool-trace" class="header-anchor">#</a></h1><p>&#x5728; Go 1.5 &#x7684;&#x65F6;&#x5019;&#xFF0C;<a href="https://github.com/dvyukov" target="_blank" rel="noopener">Dmitry Vyukov</a> &#x5728; runtime &#x91CC;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;<a href="https://golang.org/doc/go1.5#trace_command" target="_blank" rel="noopener">execution tracer profile</a>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> -trace=trace.out path/to/package</span><br><span class="line">$ go tool trace [flags] pkg.test trace.out</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5206;&#x6790;&#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x6267;&#x884C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5E76;&#x4E14;&#x5206;&#x6790;&#x7684;&#x7CBE;&#x5EA6;&#x8FBE;&#x5230;&#x7EB3;&#x79D2;&#x7EA7;&#x522B;&#xFF1A;</p><ul><li>goroutine &#x521B;&#x5EFA;&#x3001;&#x542F;&#x52A8;&#x3001;&#x7ED3;&#x675F;</li><li>gorouting &#x963B;&#x585E;&#x3001;&#x6062;&#x590D;</li><li>&#x7F51;&#x7EDC;&#x963B;&#x585E;</li><li>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF08;syscall&#xFF09;</li><li>GC &#x4E8B;&#x4EF6;</li></ul><p>&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x76EE;&#x524D;&#x4ECB;&#x7ECD;&#x7684;&#x6587;&#x6863;&#x4E0D;&#x591A;&#xFF0C;<a href="https://golang.org/pkg/runtime/trace/" target="_blank" rel="noopener">https://golang.org/pkg/runtime/trace/</a>&#x3002;&#x53EA;&#x6709;&#x5F88;&#x5C11;&#x91CF;&#x7684;&#x6587;&#x6863;&#xFF0C;&#x6216;&#x8BB8;&#x5E94;&#x8BE5;&#x6709;&#x4E00;&#x4E9B;&#x6587;&#x6863;&#x3001;&#x535A;&#x5BA2;&#x5565;&#x7684;&#x63CF;&#x8FF0;&#x4E00;&#x4E0B;&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x51E0;&#x4E2A;&#x6587;&#x6863;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#xFF1A;</p><ul><li><a href="https://docs.google.com/document/u/1/d/1FP5apqzBgr7ahCCgFO-yoVhk4YZrNIDNf9RybngBc14/pub" target="_blank" rel="noopener">https://docs.google.com/document/u/1/d/1FP5apqzBgr7ahCCgFO-yoVhk4YZrNIDNf9RybngBc14/pub</a></li><li><a href="https://www.dotconferences.com/2016/10/rhys-hiltner-go-execution-tracer" target="_blank" rel="noopener">https://www.dotconferences.com/2016/10/rhys-hiltner-go-execution-tracer</a></li></ul><p>&#x901A;&#x8FC7; <code>-traceprofile=</code> &#x6765;&#x6807;&#x5FD7;&#x751F;&#x6210;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6587;&#x4EF6;&#x3002;</p><p>&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x5305; <code>cmd/compile/internal/gc</code>&#xFF0C;&#x5E76;&#x751F;&#x6210;&#x6784;&#x5EFA;&#x7684;&#x6027;&#x80FD;&#x5206;&#x6790;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ go build -gcflags=-traceprofile=/tmp/t.p cmd/compile/internal/gc</span><br><span class="line">$ go tool trace /tmp/t.p</span><br><span class="line">2017/10/23 20:59:09 Parsing trace...</span><br><span class="line">2017/10/23 20:59:10 Serializing trace...</span><br><span class="line">2017/10/23 20:59:10 Splitting trace...</span><br><span class="line">2017/10/23 20:59:11 Opening browser</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4F1A;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x663E;&#x793A;&#xFF1A;</p><ul><li>View trace</li><li>Goroutine analysis</li><li>Network blocking profile</li><li>Synchronization blocking profile</li><li>Syscall blocking profile</li><li>Scheduler latency profile</li></ul><p>&#x70B9;&#x8FDB;&#x53BB;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5404;&#x79CD;&#x5206;&#x6790;&#x3002;</p><p><img src="../pics/golang/profile/trace.jpg" alt="trace"></p><p>&#x53E6;&#x5916;&#xFF0C;Dave Cheney &#x505A;&#x7684; <code>pkg/profile</code> &#x4E5F;&#x652F;&#x6301;&#x751F;&#x6210; trace profile &#x4E86;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/pkg/profile&quot;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">defer</span> profile.Start(profile.TraceProfile).Stop()</span><br><span class="line">        ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><p>&#x4E0D;&#x540C;&#x7684;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x4ECE;&#x4E0D;&#x540C;&#x7684;&#x89D2;&#x5EA6;&#x5BF9;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;&#x4E00;&#x822C;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x975E;&#x5F97;&#x628A;&#x4E0A;&#x9762;&#x63D0;&#x53CA;&#x7684;&#x6BCF;&#x4E2A;&#x5DE5;&#x5177;&#x90FD;&#x7528;&#x4E00;&#x904D;&#xFF0C;&#x4F46;&#x662F;&#x5EFA;&#x8BAE;&#x5927;&#x5BB6;&#x719F;&#x6089;&#x4E00;&#x4E0B;&#x4E0A;&#x9762;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5148;&#x4ECE;&#x5C0F;&#x7684;&#x4E1C;&#x897F;&#x5F00;&#x59CB;&#xFF0C;&#x5F53;&#x719F;&#x6089;&#x4E4B;&#x540E;&#xFF0C;&#x5728;&#x771F;&#x6B63;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x7684;&#x9009;&#x62E9;&#x81EA;&#x5DF1;&#x6240;&#x9700;&#x7684;&#x5DE5;&#x5177;&#x6765;&#x8BCA;&#x65AD;&#x95EE;&#x9898;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="golang-uk-2016" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang-uk-2016/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：容器是什么？让我们用 Go 写一个吧！ - Liz Rice</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-13-video-write-container-in-go-from-scratch.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-13-video-write-container-in-go-from-scratch.html</id>
    <published>2017-10-12T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.626Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#shi-me-shi-rong-qi">&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;</a></li><li><a href="#qi-dong-yi-ge-docker-rong-qi">&#x542F;&#x52A8;&#x4E00;&#x4E2A; docker &#x5BB9;&#x5668;</a></li><li><a href="#yong-go-shi-xian-yi-ge-rong-qi">&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</a><ul><li><a href="#qi-dong-yi-ge-linux-xi-tong">&#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF;</a></li><li><a href="#zui-jian-dan-de-yun-xing-ming-ling">&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;</a></li><li><a href="#ge-chi-chu-hostname-de-ming-ming-kong-jian">&#x9694;&#x79BB;&#x51FA; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li><li><a href="#ge-chi-pid-ming-ming-kong-jian">&#x9694;&#x79BB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li><li><a href="#pai-zhang-pid-ming-ming-kong-jian">&#x6392;&#x969C; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li><li><a href="#ge-chi-file-system-ming-ming-kong-jian">&#x9694;&#x79BB; File System &#x547D;&#x540D;&#x7A7A;&#x95F4;</a></li></ul></li><li><a href="#zong-jie">&#x603B;&#x7ED3;</a><ul><li><a href="#ming-ming-kong-jian-namespace">&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09;</a></li><li><a href="#kong-zhi-zu-control-groups">&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control groups&#xFF09;</a></li><li><a href="#images-rootfs">Images &#xFF08;rootfs&#xFF09;</a></li><li><a href="#jin-yi-bu-yue-du">&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>What is a container, really? Let&#x2019;s write one in Go from scratch</strong><br>by Liz Rice<br>at Golang UK Conf. 2016</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/HPuvDm8IC-4" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><ul><li>&#x89C6;&#x9891;&#xFF1A;<a href="https://www.youtube.com/watch?v=HPuvDm8IC-4" target="_blank" rel="noopener">https://www.youtube.com/watch?v=HPuvDm8IC-4</a></li></ul><h1 id="shi-me-shi-rong-qi"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F; <a href="#shi-me-shi-rong-qi" class="header-anchor">#</a></h1><p>&#x5F88;&#x591A;&#x4EBA;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x641E;&#x4E0D;&#x6E05;&#x695A;&#x5BB9;&#x5668;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x6240;&#x4EE5;&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x6709;&#x4EBA;&#x95EE;&#xFF0C;&#x5BB9;&#x5668;&#x5230;&#x5E95;&#x662F;&#x5565;&#xFF1F;Docker &#x5230;&#x5E95;&#x662F;&#x5565;&#xFF1F;</p><ul><li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A;&#x201D;</li><li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F; Jail&#x201D;</li><li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x548C; chroot &#x4E00;&#x6837;&#x201D;</li><li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F; namespace&#x3001;cgroups&#x2026;&#x2026;&#x201D;</li><li>&#x201C;&#x5BB9;&#x5668;&#x5C31;&#x662F;&#x9694;&#x79BB;&#x7684;&#x8FDB;&#x7A0B;&#x201D;</li></ul><p>&#x542C;&#x4E86;&#x8FD9;&#x4E9B;&#x89E3;&#x91CA;&#x540E;&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x6E05;&#x695A;&#x5230;&#x5E95;&#x5BB9;&#x5668;&#x662F;&#x5565;&#x3002;&#x76F4;&#x5230;&#x770B;&#x4E86; <a href="https://github.com/julz" target="_blank" rel="noopener">Julian Friedman</a> &#x5199;&#x7684;&#x535A;&#x6587;<a href="https://www.infoq.com/articles/build-a-container-golang" target="_blank" rel="noopener">&#x300A;&#x767E;&#x884C;&#x4EE5;&#x5185;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x300B;</a> &#x540E;&#xFF0C;&#x624D;&#x604D;&#x7136;&#x5927;&#x609F;&#xFF0C;&#x89C9;&#x5F97;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x5E94;&#x8BE5;&#x8BFB;&#x4E00;&#x8BFB;&#xFF0C;&#x5E0C;&#x671B;&#x628A;&#x8FD9;&#x91CC;&#x7684;&#x5185;&#x5BB9;&#x5206;&#x4EAB;&#x7ED9;&#x6240;&#x6709;&#x4EBA;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A; talk &#x5C31;&#x662F;&#x4E3B;&#x8981;&#x57FA;&#x4E8E; Julian &#x7684;&#x535A;&#x6587;&#x7684;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x6709;&#x4E9B;&#x6539;&#x53D8;&#x3002;</p><h1 id="qi-dong-yi-ge-docker-rong-qi"><a href="#&#x542F;&#x52A8;&#x4E00;&#x4E2A;-docker-&#x5BB9;&#x5668;" class="headerlink" title="&#x542F;&#x52A8;&#x4E00;&#x4E2A; docker &#x5BB9;&#x5668;"></a>&#x542F;&#x52A8;&#x4E00;&#x4E2A; docker &#x5BB9;&#x5668; <a href="#qi-dong-yi-ge-docker-rong-qi" class="header-anchor">#</a></h1><p>&#x6211;&#x4EEC;&#x5148;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; docker &#x5BB9;&#x5668;&#xFF0C;&#x6765;&#x5BF9;&#x5BB9;&#x5668;&#x6709;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;&#x8BA4;&#x8BC6;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x6267;&#x884C;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run alpine <span class="built_in">echo</span> <span class="string">&quot;Hello GopherCon&quot;</span></span><br><span class="line">Hello GopherCon</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x5F0F;&#x6A21;&#x5F0F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it alpine</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A; <code>alpine</code> &#x7684;&#x955C;&#x50CF;&#x3002;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5217;&#x76EE;&#x5F55;&#xFF0C;&#x770B;&#x5230;&#x548C;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ls</span></span><br><span class="line">bin    etc    lib    mnt    root   sbin   sys    usr</span><br><span class="line">dev    home   media  proc   run    srv    tmp    var</span><br><span class="line">/ <span class="comment"># ls -al</span></span><br><span class="line">total 60</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct 18 11:56 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct 18 11:56 ..</span><br><span class="line">-rwxr-xr-x    1 root     root             0 Oct 18 11:56 .dockerenv</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 bin</span><br><span class="line">drwxr-xr-x    5 root     root           360 Oct 18 11:56 dev</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct 18 11:56 etc</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 home</span><br><span class="line">drwxr-xr-x    5 root     root          4096 Jun 25 17:52 lib</span><br><span class="line">drwxr-xr-x    5 root     root          4096 Jun 25 17:52 media</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 mnt</span><br><span class="line">dr-xr-xr-x  130 root     root             0 Oct 18 11:56 proc</span><br><span class="line">drwx------    1 root     root          4096 Oct 18 11:56 root</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 run</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 sbin</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jun 25 17:52 srv</span><br><span class="line">dr-xr-xr-x   13 root     root             0 Oct 18 11:56 sys</span><br><span class="line">drwxrwxrwt    2 root     root          4096 Jun 25 17:52 tmp</span><br><span class="line">drwxr-xr-x    7 root     root          4096 Jun 25 17:52 usr</span><br><span class="line">drwxr-xr-x   12 root     root          4096 Jun 25 17:52 var</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5; <code>ps</code> &#x663E;&#x793A;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F46;&#x662F;&#x770B;&#x5230;&#x7684;&#x53EA;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ps</span></span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 /bin/sh</span><br><span class="line">    7 root       0:00 ps</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#xFF0C;&#x4E5F;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x540C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0</span><br><span class="line">3: gre0@NONE: &lt;NOARP&gt; mtu 1476 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/gre 0.0.0.0 brd 0.0.0.0</span><br><span class="line">4: gretap0@NONE: &lt;BROADCAST,MULTICAST&gt; mtu 1462 qdisc noop state DOWN qlen 1000</span><br><span class="line">    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: ip_vti0@NONE: &lt;NOARP&gt; mtu 1332 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0</span><br><span class="line">6: ip6_vti0@NONE: &lt;NOARP&gt; mtu 1500 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/tunnel6 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</span><br><span class="line">7: sit0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/sit 0.0.0.0 brd 0.0.0.0</span><br><span class="line">8: ip6tnl0@NONE: &lt;NOARP&gt; mtu 1452 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/tunnel6 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</span><br><span class="line">9: ip6gre0@NONE: &lt;NOARP&gt; mtu 1448 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/[823] 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</span><br><span class="line">32: eth0@if33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>&#x6211;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>hostname</code>&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x4E5F;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x540C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># hostname</span></span><br><span class="line">1faa496601e8</span><br></pre></td></tr></table></figure><h1 id="yong-go-shi-xian-yi-ge-rong-qi"><a href="#&#x7528;-Go-&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;" class="headerlink" title="&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;"></a>&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668; <a href="#yong-go-shi-xian-yi-ge-rong-qi" class="header-anchor">#</a></h1><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684; docker &#x4F7F;&#x7528;&#x770B;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x7684;&#x683C;&#x5F0F;&#x662F;&#xFF0C;<code>docker run &lt;&#x5BB9;&#x5668;&gt; &lt;&#x547D;&#x4EE4;&gt; &lt;&#x53C2;&#x6570;&gt;</code>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x6765;&#x6A21;&#x62DF;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x3002;</p><h2 id="qi-dong-yi-ge-linux-xi-tong"><a href="#&#x542F;&#x52A8;&#x4E00;&#x4E2A;-Linux-&#x7CFB;&#x7EDF;" class="headerlink" title="&#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF;"></a>&#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF; <a href="#qi-dong-yi-ge-linux-xi-tong" class="header-anchor">#</a></h2><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528; <a href="https://www.vagrantup.com/intro/index.html" target="_blank" rel="noopener">Vagrant</a> &#x542F;&#x52A8;&#x4E00;&#x4E2A; Linux &#x7CFB;&#x7EDF;&#xFF0C;&#x56E0;&#x4E3A;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;&#x4E00;&#x4E9B; Linux &#x5185;&#x6838;&#x76F8;&#x5173;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C06;&#x53EA;&#x5B58;&#x5728;&#x4E8E; Linux &#x4E2D;&#x3002;&#x4E0D;&#x719F;&#x6089; Vagrant &#x53EF;&#x4EE5;&#x5148;&#x53BB;&#x5B66;&#x4E60;<a href="https://www.vagrantup.com/intro/getting-started/index.html" target="_blank" rel="noopener">&#x5982;&#x4F55;&#x4F7F;&#x7528; Vagrant</a>&#x3002;&#x719F;&#x6089;&#x7684;&#x7EE7;&#x7EED;&#xFF0C;&#x6211;&#x4EEC;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A; <code>Vagrantfile</code>&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line">Vagrant.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">  config.vm.box = <span class="string">&quot;bento/ubuntu-16.04&quot;</span></span><br><span class="line">  config.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="symbol">inline:</span> &lt;&lt;-SHELL</span><br><span class="line">    curl -fsSL <span class="symbol">https:</span>/<span class="regexp">/get.docker.com/</span> <span class="params">| sh</span></span><br><span class="line"><span class="params">    usermod -aG docker vagrant</span></span><br><span class="line"><span class="params">    apt-get update</span></span><br><span class="line"><span class="params">    apt-get dist-upgrade -y</span></span><br><span class="line"><span class="params">    snap install --classic go</span></span><br><span class="line"><span class="params">    wget http://dl-cdn.alpinelinux.org/alpine/v3.6/releases/x86_64/alpine-minirootfs-3.6.2-x86_64.tar.gz</span></span><br><span class="line"><span class="params">    mkdir /var/lib/alpine</span></span><br><span class="line"><span class="params">    tar -xzvf alpine-minirootfs-3.6.2-x86_64.tar.gz -C /var/lib/alpine</span></span><br><span class="line"><span class="params">  SHELL</span></span><br><span class="line"><span class="params"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A; <a href="https://wiki.ubuntu.com/XenialXerus/ReleaseNotes?_ga=2.155044219.232627992.1508377352-890558848.1503503283#Ubuntu_Server" target="_blank" rel="noopener">Ubuntu Server 16.04 LTS</a> &#x7248;&#x672C;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5E76;&#x4E14;&#x5B89;&#x88C5;&#x4E86; <a href="https://www.docker-cn.com/" target="_blank" rel="noopener">Docker</a> &#x548C; <a href="https://golang.org/" target="_blank" rel="noopener">Go</a>&#xFF0C;&#x800C;&#x4E14;&#x51C6;&#x5907;&#x4E86;&#x4E00;&#x4E2A; <a href="https://alpinelinux.org/" target="_blank" rel="noopener">Alpine Linux</a> &#x7684; <code>rootfs</code> &#x4EE5;&#x5907;&#x540E;&#x7528;&#x3002;</p><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x7528;  <code>vagrant up</code> &#x6765;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5E76;&#x4E14;&#x7528; <code>vagrant ssh</code> &#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant ssh</span><br><span class="line">Welcome to Ubuntu 16.04.3 LTS (GNU/Linux 4.4.0-92-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">0 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vagrant@vagrant:~$</span><br></pre></td></tr></table></figure><h2 id="zui-jian-dan-de-yun-xing-ming-ling"><a href="#&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;" class="headerlink" title="&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;"></a>&#x6700;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4; <a href="#zui-jian-dan-de-yun-xing-ming-ling" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x6A21;&#x62DF;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8FBE;&#x5230;&#x7684;&#x6548;&#x679C;&#x662F; <code>go run docker.go run &lt;&#x547D;&#x4EE4;&gt; &lt;&#x53C2;&#x6570;&gt;</code> &#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#x7684;&#x6548;&#x679C;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"><span class="keyword">switch</span> os.Args[<span class="number">1</span>] {</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;run&quot;</span>:</span><br><span class="line">run()</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;what?&quot;</span>)</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;Running %v\n&quot;</span>, os.Args[<span class="number">2</span>:])</span><br><span class="line">cmd := exec.Command(os.Args[<span class="number">2</span>], os.Args[<span class="number">3</span>:]...)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(err error)</span></span> {</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run docker.go run <span class="built_in">echo</span> <span class="string">&quot;Hello, our container&quot;</span></span><br><span class="line">Running [<span class="built_in">echo</span> Hello, our container]</span><br><span class="line">Hello, our container</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x548C;&#x4E4B;&#x524D;&#x7684; <code>docker run</code> &#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6536;&#x5230;&#x547D;&#x4EE4;&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C;&#x3002;</p><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x4F7F;&#x7528;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line">sh-3.2$ ls</span><br><span class="line">Vagrantfile     docker.go</span><br><span class="line">sh-3.2$ ps</span><br><span class="line">  PID TTY           TIME CMD</span><br><span class="line">44316 ttys000    0:01.89 /bin/zsh -l</span><br><span class="line">45926 ttys000    0:00.01 vagrant up</span><br><span class="line">45927 ttys000    1:46.53 ruby /opt/vagrant/embedded/gems/gems/vagrant-2.0.0/bin/vagrant up</span><br><span class="line">45212 ttys002    0:01.48 /bin/zsh -l</span><br><span class="line">45372 ttys002    0:00.21 go run docker.go run /bin/sh</span><br><span class="line">45379 ttys002    0:00.01 /var/folders/wc/9tzsn1hd7c38tvc54kctn4100000gn/T/go-build882908294/<span class="built_in">command</span>-line-arguments/_obj/exe/docker r</span><br><span class="line">45380 ttys002    0:00.02 /bin/sh</span><br></pre></td></tr></table></figure><p>&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x4E0D;&#x8981;&#x9AD8;&#x5174;&#x592A;&#x65E9;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x800C;&#x5DF2;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x771F;&#x7684;&#x8FDB;&#x5165;&#x9694;&#x79BB;&#x7684;&#x5BB9;&#x5668;&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x4F9D;&#x65E7;&#x662F;&#x5904;&#x4E8E;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x4EE5;&#x53CA;&#x5BBF;&#x4E3B;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5BBF;&#x4E3B;&#x7684; hostname&#x3002;&#x55EF;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x662F;&#x5728;&#x5BBF;&#x4E3B;&#x7684; namespace &#xFF08;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF09;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x5DEE;&#x3002;</p><h2 id="ge-chi-chu-hostname-de-ming-ming-kong-jian"><a href="#&#x9694;&#x79BB;&#x51FA;-hostname-&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x9694;&#x79BB;&#x51FA; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x9694;&#x79BB;&#x51FA; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ge-chi-chu-hostname-de-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6211;&#x4EEC;&#x5199;&#x7684; <code>docker.go</code> &#x53EF;&#x4EE5;&#x771F;&#x7684;&#x5728;&#x72EC;&#x7ACB;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#x547D;&#x4EE4;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x539F;&#x6709;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x89E3;&#x51B3; hostname &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">...</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">Cloneflags: syscall.CLONE_NEWUTS,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">must(cmd.Run())</span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x5728; <code>cmd.Run()</code> &#x4E4B;&#x524D;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E86; <code>SysProcAttr</code> &#x5C5E;&#x6027;&#xFF0C;&#x6307;&#x5B9A;&#x4E86; <code>CLONE_NEWUTS</code>&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5728;&#x8BF4;&#x542F;&#x52A8;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684; hostname &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x521D;&#x59CB;&#x503C;&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x514B;&#x9686;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ hostname</span><br><span class="line">vagrant</span><br><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line"><span class="comment"># hostname</span></span><br><span class="line">vagrant</span><br><span class="line"><span class="comment"># hostname golang</span></span><br><span class="line"><span class="comment"># hostname</span></span><br><span class="line">golang</span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">vagrant@vagrant:/vagrant$ hostname</span><br><span class="line">vagrant</span><br></pre></td></tr></table></figure><p>&#x770B;&#x5230;&#x4E86;&#x5427;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x7684;&#x8FDB;&#x7A0B;&#x5728;&#x65B0;&#x7684; <code>hostname</code> &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#xFF08;&#x90E8;&#x5206;&#xFF09;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4FEE;&#x6539;&#x4E86; <code>hostname</code>&#xFF0C;&#x56DE;&#x5230;&#x5BBF;&#x4E3B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>hostname</code> &#x5E76;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x4E24;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#x3002;</p><h2 id="ge-chi-pid-ming-ming-kong-jian"><a href="#&#x9694;&#x79BB;-PID-&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x9694;&#x79BB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x9694;&#x79BB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ge-chi-pid-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x53EA;&#x662F;&#x9694;&#x79BB;&#x4E86; <code>hostname</code>&#xFF0C;&#x6CA1;&#x6709;&#x9694;&#x79BB;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x8FDB;&#x7A0B;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 3173 pts/0    00:00:00 sudo</span><br><span class="line"> 3174 pts/0    00:00:00 go</span><br><span class="line"> 3199 pts/0    00:00:00 docker</span><br><span class="line"> 3203 pts/0    00:00:00 sh</span><br><span class="line"> 3205 pts/0    00:00:00 ps</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x548C; <code>docker run</code> &#x4E00;&#x6837;&#xFF0C;&#x8FDB;&#x7A0B;&#x4E5F;&#x662F;&#x9694;&#x79BB;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">...</span><br><span class="line">cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID,</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x90A3;&#x770B;&#x6765;&#x548C;&#x4E0A;&#x9762;&#x4E00;&#x6837;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x518D;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D; <code>CLONE_NEWPID</code>&#xFF0C;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7ED9;&#x5373;&#x5C06;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#xFF1F;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x6267;&#x884C;&#x4E00;&#x4E0B;&#x770B;&#x770B;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh]</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 3274 pts/0    00:00:00 sudo</span><br><span class="line"> 3275 pts/0    00:00:00 go</span><br><span class="line"> 3299 pts/0    00:00:00 docker</span><br><span class="line"> 3303 pts/0    00:00:00 sh</span><br><span class="line"> 3305 pts/0    00:00:00 ps</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>&#x5947;&#x602A;&#x4E86;&#xFF0C;&#x8FD9;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#x554A;&#x3002;</p><h2 id="pai-zhang-pid-ming-ming-kong-jian"><a href="#&#x6392;&#x969C;-PID-&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x6392;&#x969C; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x6392;&#x969C; PID &#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#pai-zhang-pid-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x547D;&#x540D;&#x5DF2;&#x7ECF;&#x662F;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48; <code>ps</code> &#x770B;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x8FDB;&#x7A0B;&#x5462;&#xFF1F;</p><p>&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x6392;&#x969C;&#xFF0C;&#x6211;&#x4EEC;&#x8F93;&#x51FA;&#x4E00;&#x4E0B;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#x7684; PID&#xFF0C;&#x770B;&#x770B;&#x5230;&#x5E95;&#x662F;&#x4E0D;&#x662F;&#x51FA;&#x4E8E;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E86;&#x3002;&#x4E3A;&#x4E86;&#x8F93;&#x51FA;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#x7684; PID&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#x7A0B;&#x5E8F;&#x7ED3;&#x6784;&#xFF0C;&#x589E;&#x52A0;&#x4E00;&#x5C42;&#xFF0C;&#x5E76;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;<code>child</code>&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line"><span class="string">&quot;syscall&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"><span class="keyword">switch</span> os.Args[<span class="number">1</span>] {</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;run&quot;</span>:</span><br><span class="line">run()</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;child&quot;</span>:</span><br><span class="line">child()</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;what?&quot;</span>)</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/proc/self/exe&quot;</span>, <span class="built_in">append</span>([]<span class="keyword">string</span>{<span class="string">&quot;child&quot;</span>}, os.Args[<span class="number">2</span>:]...)...)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">child</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;Running %v as pid: %d\n&quot;</span>, os.Args[<span class="number">2</span>:], os.Getpid())</span><br><span class="line">cmd := exec.Command(os.Args[<span class="number">2</span>], os.Args[<span class="number">3</span>:]...)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(err error)</span></span> {</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5F53;&#x6211;&#x4EEC;&#x7528; <code>run</code> &#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x81EA;&#x5DF1;(fork)&#xFF0C;&#x5E76;&#x52A0;&#x5165;&#x547D;&#x4EE4; <code>child</code>&#xFF0C;&#x7136;&#x540E; <code>child()</code> &#x51FD;&#x6570;&#x4F1A;&#x5B9E;&#x9645;&#x7684;&#x6267;&#x884C;&#x542F;&#x52A8;&#x7528;&#x6237;&#x9700;&#x6C42;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x6837;&#x6709;&#x4E86;&#x4E00;&#x5C42; <code>child()</code>&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x53D6;&#x5F97;&#x66F4;&#x591A;&#x7684;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run <span class="built_in">echo</span> hello</span><br><span class="line">Running [<span class="built_in">echo</span> hello] as pid: 1</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x5230;&#x4E86;&#x4E48;&#xFF0C;&#x8FD9;&#x91CC;&#x7684; <code>pid: 1</code>&#xFF0C;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x5EFA;&#x7ACB; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6210;&#x529F;&#x4E86;&#x7684;&#x3002;</p><p>&#x4E3A;&#x4E86;&#x786E;&#x4FE1;&#xFF0C;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x4E0A;&#x9762;&#x7684; <code>CLONE_NEWPID</code> &#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x518D;&#x6B21;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run <span class="built_in">echo</span> hello</span><br><span class="line">Running [<span class="built_in">echo</span> hello] as pid: 3528</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>&#x770B;&#x5230;&#x4E86;&#x5427;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; <code>CLONE_NEWPID</code> &#x5EFA;&#x7ACB;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C06;&#x5904;&#x4E8E;&#x5BBF;&#x4E3B;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B; ID &#x662F;&#x539F;&#x6765;&#x7684;&#x7A7A;&#x95F4;&#x7684; <code>3528</code>&#x3002;&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x542F;&#x7528;&#x4E86;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x6210;&#x4E3A;&#x8BE5;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64; PID &#x5C31;&#x4E3A; <code>1</code> &#x4E86;&#x3002;</p><p>&#x597D;&#x5427;&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x786E;&#x5B9E;&#x5DF2;&#x7ECF;&#x5728;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x91CC;&#x4E86;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48; <code>ps</code> &#x4E0D;&#x5BF9;&#x5462;&#xFF1F;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh] as pid: 1</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 3534 pts/0    00:00:00 sudo</span><br><span class="line"> 3535 pts/0    00:00:00 go</span><br><span class="line"> 3559 pts/0    00:00:00 docker</span><br><span class="line"> 3562 pts/0    00:00:00 exe</span><br><span class="line"> 3566 pts/0    00:00:00 sh</span><br><span class="line"> 3568 pts/0    00:00:00 ps</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x662F;&#x7531;&#x4E8E; <code>ps</code> &#x53EA;&#x662F;&#x7B80;&#x5355;&#x5730;&#x89C2;&#x5BDF; <code>/proc</code> &#x7684;&#x5185;&#x5BB9;&#x800C;&#x7ED9;&#x51FA;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x6B64;&#x65F6;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/proc</code> &#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x4F4D;&#x4E8E;&#x65B0;&#x7684; PID &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E86;&#xFF0C;&#x4F46;&#x662F; <code>ps</code> &#x8FD8;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh] as pid: 1</span><br><span class="line"><span class="comment"># ls /proc</span></span><br><span class="line">1     157    23     27805  3     376  48   59   80         consoles     ioports      meminfo       softirqs           vmallocinfo</span><br><span class="line">10    158    23167  27808  30    396  49   6    813        cpuinfo      irq          misc          <span class="built_in">stat</span>               vmstat</span><br><span class="line">1070  159    235    27809  31    404  490  60   814        crypto       kallsyms     modules       swaps              zoneinfo</span><br><span class="line">11    16     24     28     313   407  5    602  816        devices      kcore        mounts        sys</span><br><span class="line">1130  17     257    28057  314   416  50   66   850        diskstats    keys         mtrr          sysrq-trigger</span><br><span class="line">1146  18     261    2851   3207  431  51   7    9          dma          key-users    net           sysvipc</span><br><span class="line">1147  19     262    286    3569  434  52   776  907        driver       kmsg         pagetypeinfo  thread-self</span><br><span class="line">119   2      2650   2873   3570  435  53   779  acpi       execdomains  kpagecgroup  partitions    timer_list</span><br><span class="line">12    20     2683   2875   3594  439  54   780  asound     fb           kpagecount   sched_debug   timer_stats</span><br><span class="line">1213  21     271    2877   3597  442  55   79   buddyinfo  filesystems  kpageflags   schedstat     tty</span><br><span class="line">13    22     273    29     360   447  56   791  bus        fs           loadavg      scsi          uptime</span><br><span class="line">14    22497  27794  2910   3601  449  57   795  cgroups    interrupts   locks        self          version</span><br><span class="line">15    22504  27799  2911   3603  47   58   8    cmdline    iomem        mdstat       slabinfo      version_signature</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="ge-chi-file-system-ming-ming-kong-jian"><a href="#&#x9694;&#x79BB;-File-System-&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x9694;&#x79BB; File System &#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x9694;&#x79BB; File System &#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ge-chi-file-system-ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x7ECF;&#x8FC7;&#x524D;&#x9762;&#x7684;&#x8BD5;&#x9A8C;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#x662F;&#x7531;&#x4E8E; <code>/proc</code> &#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684; <code>/proc</code>&#xFF0C;&#x6240;&#x4EE5; <code>ps</code> &#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x5C31;&#x662F;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/proc</code>&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x4E00;&#x76F4;&#x90FD;&#x5728;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x91CC;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x5957;&#x72EC;&#x7ACB;&#x7684; rootfs &#x7ED9;&#x5BB9;&#x5668;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line"><span class="string">&quot;syscall&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"><span class="keyword">switch</span> os.Args[<span class="number">1</span>] {</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;run&quot;</span>:</span><br><span class="line">run()</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;child&quot;</span>:</span><br><span class="line">child()</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;what?&quot;</span>)</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/proc/self/exe&quot;</span>, <span class="built_in">append</span>([]<span class="keyword">string</span>{<span class="string">&quot;child&quot;</span>}, os.Args[<span class="number">2</span>:]...)...)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID | syscall.CLONE_NEWNS,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">child</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;Running %v as pid: %d\n&quot;</span>, os.Args[<span class="number">2</span>:], os.Getpid())</span><br><span class="line">cmd := exec.Command(os.Args[<span class="number">2</span>], os.Args[<span class="number">3</span>:]...)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line"></span><br><span class="line">must(syscall.Chroot(<span class="string">&quot;/var/lib/alpine&quot;</span>))</span><br><span class="line">must(os.Chdir(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">must(syscall.Mount(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">must(cmd.Run())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(err error)</span></span> {</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x505A;&#x4E86;&#x4E24;&#x4E2A;&#x6539;&#x52A8;&#x3002;</p><p>&#x5176;&#x4E00;&#xFF0C;&#x5728; <code>run()</code> &#x4E2D;&#x589E;&#x52A0; <code>CLONE_NEWNS</code> &#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x4EE5;&#x589E;&#x52A0;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A; mount &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x4E4B;&#x6240;&#x4EE5;&#x53EB; <code>NEWNS</code>&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x610F;&#x601D;&#x662F; <code>New Namespace</code>&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6700;&#x521D;&#x5B9E;&#x73B0; namespace &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x60F3;&#x5230;&#x4E86;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;so&#x2026;&#x2026;&#x1F613;</p><p>&#x5176;&#x4E8C;&#xFF0C;&#x5728; <code>child()</code> &#x4E2D;&#xFF0C;<code>chroot</code> &#x5230;&#x6211;&#x4EEC;&#x65B0;&#x7684; rootfs&#xFF1A;<code>/var/lib/alpine</code>&#xFF0C;&#x5E76;&#x4E14;&#x5207;&#x6362;&#x5230;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x6302;&#x8F7D; <code>/proc</code>&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">child</span><span class="params">()</span></span> {</span><br><span class="line">...</span><br><span class="line">must(syscall.Chroot(<span class="string">&quot;/var/lib/alpine&quot;</span>))</span><br><span class="line">must(os.Chdir(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">must(syscall.Mount(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x8BA9;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x81EA;&#x5DF1;&#x7684;&#x5BB9;&#x5668;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant:/vagrant$ sudo go run docker.go run /bin/sh</span><br><span class="line">Running [/bin/sh] as pid: 1</span><br><span class="line">/ <span class="comment"># ps</span></span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 /proc/self/exe child /bin/sh</span><br><span class="line">    4 root       0:00 /bin/sh</span><br><span class="line">    5 root       0:00 ps</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>Yeah! &#x1F4AA; &#x8FD9;&#x6B21;&#x7EC8;&#x4E8E;&#x770B;&#x5230; <code>ps</code> &#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#xFF0C;PID &#x4ECE; 1 &#x5F00;&#x59CB;&#x4E86;&#x3002;&#x1F638;</p><h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><p>&#x8FD9;&#x5F88;&#x795E;&#x5947;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x505A;&#x51FA;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6709;&#x4E86;&#x81EA;&#x5DF1;&#x7684; hostname&#x3001;PID&#x3001;mount &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x90FD;&#x548C; Docker &#x5BB9;&#x5668;&#x4E00;&#x6837;&#x3002;&#x7ECF;&#x8FC7;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6240;&#x8C13;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x7279;&#x6B8A;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x5C31;&#x662F;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x4E9B;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3001;&#x6302;&#x8F7D;&#x7B49;&#x3002;&#x4EC5;&#x6B64;&#x800C;&#x5DF2;&#x3002;<strong>&#x5BB9;&#x5668;&#xFF0C;&#x5C31;&#x662F;&#x8FDB;&#x7A0B;&#x3002;</strong></p><h2 id="ming-ming-kong-jian-namespace"><a href="#&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09;" class="headerlink" title="&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09;"></a>&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF08;Namespace&#xFF09; <a href="#ming-ming-kong-jian-namespace" class="header-anchor">#</a></h2><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x611F;&#x89C9;&#x5230;&#x4E86;&#x3002;<strong><code>namespace</code>&#x51B3;&#x5B9A;&#x4F60;&#x80FD;&#x770B;&#x5230;&#x4EC0;&#x4E48;</strong></p><ul><li>UNIX Timesharing System &#xFF08;&#x522B;&#x770B;&#x540D;&#x5B57;&#x5F88;&#x5FFD;&#x60A0;&#xFF0C;&#x5C31;&#x662F; hostname&#xFF09;</li><li>Process IDs</li><li>File system (&#x5C31;&#x662F; mount)</li><li>Users</li><li>IPC</li><li>Networking</li></ul><h2 id="kong-zhi-zu-control-groups"><a href="#&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control-groups&#xFF09;" class="headerlink" title="&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control groups&#xFF09;"></a>&#x63A7;&#x5236;&#x7EC4;&#xFF08;Control groups&#xFF09; <a href="#kong-zhi-zu-control-groups" class="header-anchor">#</a></h2><p><strong><code>cgroups</code> &#x63A7;&#x5236;&#x4F60;&#x80FD;&#x7528;&#x4EC0;&#x4E48;</strong></p><ul><li>CPU</li><li>Memory</li><li>Disk I/O</li><li>Network</li><li>Device permissions (<code>/dev</code>)</li></ul><h2 id="images-rootfs"><a href="#Images-&#xFF08;rootfs&#xFF09;" class="headerlink" title="Images &#xFF08;rootfs&#xFF09;"></a>Images &#xFF08;rootfs&#xFF09; <a href="#images-rootfs" class="header-anchor">#</a></h2><p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x6240;&#x7528;&#x5230;&#x7684; <code>rootfs</code>&#xFF0C;<code>/var/lib/alpine</code> &#x662F;&#x6765;&#x81EA;&#x4E8E; alpine &#x7F51;&#x7AD9;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E; Docker &#x800C;&#x8A00;&#xFF0C;Docker Hub &#x7684;&#x90A3;&#x4E9B;&#x955C;&#x50CF;&#x5728;&#x4E0B;&#x8F7D;&#x4E0B;&#x6765;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x88AB;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7684; <code>rootfs</code> &#x6240;&#x4F7F;&#x7528;&#x3002;&#x5F53;&#x7136;&#x5B9E;&#x9645;&#x7684;&#x7EC6;&#x8282;&#x8981;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF0C;&#x6BD4;&#x5982;&#x5F15;&#x5165;&#x4E86;&#x5206;&#x5C42;&#x5B58;&#x50A8; Union FS &#x7684;&#x6982;&#x5FF5;&#x3001;&#x5143;&#x6570;&#x636E;&#x7B49;&#x7B49;&#x3002;</p><p>Liz Rice &#x7684;&#x56E2;&#x961F;&#x5236;&#x4F5C;&#x4E86; <a href="https://microbadger.com/" target="_blank" rel="noopener">https://microbadger.com/</a> &#x6765;&#x5E2E;&#x52A9;&#x67E5;&#x770B;&#x548C;&#x5206;&#x6790;&#x4F4D;&#x4E8E; Docker Hub &#x4E0A;&#x7684;&#x955C;&#x50CF;&#x3002;</p><h2 id="jin-yi-bu-yue-du"><a href="#&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB;" class="headerlink" title="&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB;"></a>&#x8FDB;&#x4E00;&#x6B65;&#x9605;&#x8BFB; <a href="#jin-yi-bu-yue-du" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B; Julien Friedman &#x7684; gist&#xFF1A;<a href="https://bit.ly/1nDqpDI" target="_blank" rel="noopener">https://bit.ly/1nDqpDI</a>&#x3002;&#x4ED6;&#x7684;&#x5B9E;&#x73B0;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x6BD4;&#x5982;&#x91CC;&#x9762;&#x6CA1;&#x6709;&#x4F7F;&#x7528; <code>chroot</code>&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>mount</code> &#x6302;&#x8F7D; <code>rootfs</code>&#x7B49;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="golang-uk-2016" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang-uk-2016/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Go 包管理的新时代 - Sam Boyer</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-09-video-the-new-era-of-go-package-management.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-09-video-the-new-era-of-go-package-management.html</id>
    <published>2017-10-08T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.626Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#shi-me-bao-yi-lai-guan-li">&#x4EC0;&#x4E48;&#x5305;&#xFF08;&#x4F9D;&#x8D56;&#xFF09;&#x7BA1;&#x7406;&#xFF1F;</a></li><li><a href="#pidgin-yu-yan">pidgin &#x8BED;&#x8A00;</a></li><li><a href="#bao-guan-li-de-li-shi">&#x5305;&#x7BA1;&#x7406;&#x7684;&#x5386;&#x53F2;</a><ul><li><a href="#gong-ju-de-jue-qi">&#x5DE5;&#x5177;&#x7684;&#x5D1B;&#x8D77;</a></li><li><a href="#vendor-mu-lu">vendor/ &#x76EE;&#x5F55;</a></li></ul></li><li><a href="#go-dep">go dep</a><ul><li><a href="#dep-ji-chu"><code>dep</code> &#x57FA;&#x7840;</a></li><li><a href="#san-ge-zhu-yao-ming-ling">&#x4E09;&#x4E2A;&#x4E3B;&#x8981;&#x547D;&#x4EE4;</a></li><li><a href="#dep-ensure"><code>dep ensure</code></a></li><li><a href="#jin-ru-gong-ju-lian">&#x8FDB;&#x5165;&#x5DE5;&#x5177;&#x94FE;</a></li><li><a href="#todos">TODOs</a></li><li><a href="#todos-for-developers">TODOs for Developers</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>The New Era of Go Package Management</strong><br>by Sam Boyer<br>at GopherCon 2017</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/5LtMb090AZI" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><ul><li>&#x89C6;&#x9891;&#xFF1A;<a href="https://www.youtube.com/watch?v=5LtMb090AZI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=5LtMb090AZI</a></li><li>&#x5E7B;&#x706F;&#xFF1A;<a href="https://speakerdeck.com/sdboyer/the-new-era-of-go-package-management" target="_blank" rel="noopener">https://speakerdeck.com/sdboyer/the-new-era-of-go-package-management</a></li><li>&#x535A;&#x6587;&#xFF1A;<a href="https://about.sourcegraph.com/go/the-new-era-of-go-package-management/" target="_blank" rel="noopener">https://about.sourcegraph.com/go/the-new-era-of-go-package-management/</a></li><li>&#x6750;&#x6599;&#xFF1A;<a href="https://github.com/gophercon/2017-talks/tree/master/samboyer-TheNewEraOfGoPackageManagement" target="_blank" rel="noopener">https://github.com/gophercon/2017-talks/tree/master/samboyer-TheNewEraOfGoPackageManagement</a></li></ul><h1 id="shi-me-bao-yi-lai-guan-li"><a href="#&#x4EC0;&#x4E48;&#x5305;&#xFF08;&#x4F9D;&#x8D56;&#xFF09;&#x7BA1;&#x7406;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x5305;&#xFF08;&#x4F9D;&#x8D56;&#xFF09;&#x7BA1;&#x7406;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x5305;&#xFF08;&#x4F9D;&#x8D56;&#xFF09;&#x7BA1;&#x7406;&#xFF1F; <a href="#shi-me-bao-yi-lai-guan-li" class="header-anchor">#</a></h1><ol><li>&#x6211;&#x4EEC;&#x5199;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;</li><li>&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x4EBA;&#x7684;&#x4EE3;&#x7801;</li><li>&#x7136;&#x540E;&#x5C31;&#x662F;&#x75DB;&#x82E6;&#x7684;&#x5F00;&#x7AEF;&#x4E86;&#x2026;&#x2026;&#x1F639;<ul><li>&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x5230;&#x4E86;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5C31;&#x51FA;&#x9519;</li><li>&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#x4F9D;&#x8D56;&#x662F;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x7B49;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0A;&#x6E38;&#x5347;&#x7EA7;&#x4E86;&#xFF0C;&#x5C31;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x4E86;</li><li>&#x6709;&#x7684;&#x65F6;&#x5019;&#x5F88;&#x7C97;&#x66B4;&#x7684;&#x6302;&#x4E86;&#xFF08;&#x8FD9;&#x662F;&#x597D;&#x4E8B;&#x513F;&#xFF09;</li><li>&#x800C;&#x6709;&#x7684;&#x65F6;&#x5019;&#x6682;&#x65F6;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x5F88;&#x4E45;&#x4E4B;&#x540E;&#x624D;&#x53D1;&#x73B0;&#x662F;&#x8FD9;&#x6B21;&#x5347;&#x7EA7;&#x5BFC;&#x81F4;&#x7684;bug&#x3002;&#xFF08;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x6392;&#x969C;&#x5C31;&#x5F88;&#x75DB;&#x82E6;&#xFF09;</li></ul></li></ol><p>&#x8FD9;&#x5C31;&#x662F;&#x9700;&#x8981;&#x5305;&#x7BA1;&#x7406;&#xFF0C;&#x6216;&#x8005;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#xFF08;&#x867D;&#x7136;&#x8FD9;&#x662F;&#x4E24;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x57FA;&#x672C;&#x4F1A;&#x6362;&#x7740;&#x7528;&#x6765;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#xFF09;</p><h1 id="pidgin-yu-yan"><a href="#pidgin-&#x8BED;&#x8A00;" class="headerlink" title="pidgin &#x8BED;&#x8A00;"></a>pidgin &#x8BED;&#x8A00; <a href="#pidgin-yu-yan" class="header-anchor">#</a></h1><p><strong>pidgin&#x8BED;&#x8A00;</strong> &#x662F;&#x6307;&#x6DF7;&#x6742;&#x8BED;&#x8A00;&#xFF0C;&#x5176;&#x8BCD;&#x6C47;&#x6E90;&#x5934;&#x662F;&#x6765;&#x81EA;&#x4E8E;<a href="https://zh.wikipedia.org/wiki/%E6%B4%8B%E6%B3%BE%E6%B5%9C%E8%8B%B1%E8%AF%AD" target="_blank" rel="noopener">&#x6D0B;&#x6CFE;&#x6D5C;&#x82F1;&#x8BED;</a>&#xFF0C;&#x5C31;&#x662F;&#x65E9;&#x5E74;&#x7684;&#x79DF;&#x754C;&#x533A;&#x4E4B;&#x7C7B;&#x7684;&#x4E2D;&#x5F0F;&#x82F1;&#x8BED;&#xFF0C;&#x5F88;&#x591A;&#x8BF4;&#x6CD5;&#x90FD;&#x7B80;&#x5316;&#x4E86;&#x3002;&#x6BD4;&#x5982; <code>pidgin</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6765;&#x81EA;&#x4E8E; <code>business</code> &#x8FD9;&#x4E2A;&#x8BCD;&#xFF0C;&#x5728;&#x65E9;&#x5E74;&#x7684;&#x4E2D;&#x56FD;&#x4EBA;&#x4E2D;&#xFF0C;&#x7B80;&#x5316;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E8E; <code>&#x76AE;&#x94A6;</code> &#x8FD9;&#x79CD;&#x53D1;&#x97F3;&#x3002;&#x6709;&#x4E9B;&#x82F1;&#x8BED;&#x7684;&#x4EBA;&#xFF0C;&#x8BEF;&#x4EE5;&#x4E3A;&#x662F;&#x8BF4; <code>pigeon</code>&#x3002;&#x6240;&#x4EE5;&#x4E5F;&#x6709;&#x79F0; <code>pidgin</code> &#x8BED;&#x8A00;&#x4E3A; <code>pigeon</code> &#x8BED;&#x8A00;&#x7684;&#x3002;</p><p>&#x540E;&#x6765;&#x5C31;&#x7528; <code>pidgin&#x8BED;&#x8A00;</code> &#x6765;&#x63CF;&#x8FF0;&#x53CC;&#x65B9;&#x90FD;&#x4E0D;&#x61C2;&#x5BF9;&#x65B9;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x65E0;&#x6CD5;&#x4EA4;&#x6D41;&#x3002;&#x4E8E;&#x662F;&#x53CC;&#x65B9;&#x4F1A;&#x60F3;&#x529E;&#x6CD5;&#x521B;&#x5EFA;&#x6216;&#x4F7F;&#x7528;&#x4E00;&#x79CD;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#xFF0C;&#x6765;&#x8FDB;&#x884C;&#x4EA4;&#x6D41;&#x3002;&#x8FD9;&#x79CD;&#x8BED;&#x8A00;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x7B80;&#x5316;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x4E14;&#x7ECF;&#x5E38;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x8BEF;&#x89E3;&#x3002;&#x800C;&#x4E14;&#xFF0C;<code>pidgin&#x8BED;&#x8A00;</code> &#x4E00;&#x822C;&#x90FD;&#x662F;&#x8FC7;&#x6E21;&#x671F;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x968F;&#x7740;&#x6587;&#x660E;&#x4EA4;&#x6D41;&#x7684;&#x6DF1;&#x5165;&#xFF0C;&#x8FD9;&#x7C7B;&#x8BED;&#x8A00;&#x5C31;&#x4F1A;&#x88AB;&#x5E9F;&#x5F03;&#x3002;</p><p>&#x867D;&#x7136;&#x8BE5;&#x8BCD;&#x51FA;&#x73B0;&#x5728;&#x73B0;&#x4EE3;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x7C7B;&#x7684;&#x65B9;&#x5F0F;&#x51FA;&#x73B0;&#x5728;&#x5F88;&#x4E45;&#x4EE5;&#x524D;&#x3002;&#x6BD4;&#x5982;&#x81EA;&#x53E4;&#x4EE5;&#x6765;&#x7684;&#x4E1D;&#x7EF8;&#x4E4B;&#x8DEF;&#xFF0C;&#x4E2D;&#x95F4;&#x7ECF;&#x8FC7;&#x7684;&#x56FD;&#x5BB6;&#x548C;&#x6587;&#x660E;&#x6709;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x5404;&#x81EA;&#x90FD;&#x53EA;&#x8BF4;&#x81EA;&#x5DF1;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x4E8E;&#x662F;&#x5546;&#x4EBA;&#x5728;&#x8FD9;&#x6761;&#x8DEF;&#x4E0A;&#x8D70;&#x52A8;&#xFF0C;&#x8981;&#x4F7F;&#x7528;&#x5F88;&#x591A;&#x4E2A;&#x5E94;&#x5BF9;&#x4E0D;&#x540C;&#x4EA4;&#x6D41;&#x7684; <code>pidgin&#x8BED;&#x8A00;</code>&#x3002;</p><p>Go &#x7684;&#x793E;&#x533A;&#x91CC;&#xFF0C;&#x7F3A;&#x4E4F;&#x4E00;&#x79CD;&#x5171;&#x540C;&#x7684;&#x53EF;&#x4EE5;&#x4EA4;&#x6D41;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x7528;&#x4E8E;&#x5171;&#x4EAB;&#x4EE3;&#x7801;&#x3001;&#x5171;&#x4EAB;&#x9879;&#x76EE;&#x3002;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8BDE;&#x751F;&#x4E86;&#x5F88;&#x591A;&#x7528;&#x4E8E;&#x5171;&#x4EAB;&#x4EE3;&#x7801;&#x7684; &#x201C;pidgin &#x8BED;&#x8A00;&#x201D;&#x3002;&#x800C;&#x73B0;&#x5728;&#xFF0C;Go &#x7EC8;&#x4E8E;&#x8981;&#x5B98;&#x65B9;&#x652F;&#x6301;&#x5171;&#x4EAB;&#x4EE3;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x4E86;&#xFF0C;&#x5C06;&#x6765;&#x8FD9;&#x4E9B; &#x201C;pidgin &#x8BED;&#x8A00;&#x201D; &#x5C31;&#x4F1A;&#x50CF;&#x5176;&#x5B83; &#x201D;pidgin &#x8BED;&#x8A00;&#x201D; &#x4E00;&#x6837;&#x88AB;&#x5E9F;&#x5F03;&#x6389;&#x3002;</p><h1 id="bao-guan-li-de-li-shi"><a href="#&#x5305;&#x7BA1;&#x7406;&#x7684;&#x5386;&#x53F2;" class="headerlink" title="&#x5305;&#x7BA1;&#x7406;&#x7684;&#x5386;&#x53F2;"></a>&#x5305;&#x7BA1;&#x7406;&#x7684;&#x5386;&#x53F2; <a href="#bao-guan-li-de-li-shi" class="header-anchor">#</a></h1><p><code>GOPATH</code> &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p><ul><li><code>GOPATH</code> &#x53EA;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x7248;&#x672C;</li><li>&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x91CD;&#x73B0;&#x3002;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x4EBA; <code>go get</code> &#x5F97;&#x5230;&#x7684;&#x90FD;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x90FD;&#x662F;&#x5F53;&#x524D;&#x6700;&#x65B0;&#x7684;&#x90A3;&#x4E2A;&#x7248;&#x672C;&#x3002;</li><li>&#x7531;&#x4E8E;&#x4F9D;&#x8D56;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#xFF0C;&#x53D1;&#x5E03;&#xFF0C;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x3002;</li><li>&#x66F4;&#x65B0;&#xFF0C;&#x66F4;&#x52A0;&#x968F;&#x673A;&#x6027;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;&#x5B8C;&#x5168;&#x53D6;&#x51B3;&#x4E8E;&#x66F4;&#x65B0;&#x662F;&#x51E0;&#x70B9;&#x949F;&#x7684;&#x90A3;&#x4E2A;&#x7248;&#x672C;</li></ul><p>&#x7531;&#x4E8E;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x4EA7;&#x751F;&#x4E86;&#x5F88;&#x591A;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x8981;&#x6C42;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F9D;&#x8D56;&#x4E0D;&#x5E94;&#x8BE5;&#x968F;&#x610F;&#x62FD;&#x8FDB;&#x6765;&#x6539;&#x53D8;&#xFF0C;&#x800C;&#x5FC5;&#x987B;&#x8981;&#x901A;&#x8FC7;&#x4E89;&#x53D6;&#x7684;&#x5F62;&#x5F0F;&#x4EA7;&#x751F;&#xFF1B;&#x4E0D;&#x8981;&#x8F7B;&#x6613;&#x7684; break API&#x3002;&#x8FD9;&#x7C7B;&#x539F;&#x5219;&#x5728;&#x65B0;&#x7684;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4E0B;<strong>&#x4F9D;&#x65E7;&#x9002;&#x7528;</strong>&#x3002;</p><h2 id="gong-ju-de-jue-qi"><a href="#&#x5DE5;&#x5177;&#x7684;&#x5D1B;&#x8D77;" class="headerlink" title="&#x5DE5;&#x5177;&#x7684;&#x5D1B;&#x8D77;"></a>&#x5DE5;&#x5177;&#x7684;&#x5D1B;&#x8D77; <a href="#gong-ju-de-jue-qi" class="header-anchor">#</a></h2><p>&#x5728;&#x8FD9;&#x4E9B;&#x5E74;&#x95F4;&#xFF0C;&#x4EA7;&#x751F;&#x4E86;&#x5F88;&#x591A;&#x7528;&#x4E8E;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x6709;&#x4E9B;&#x89E3;&#x51B3;&#x4E86;&#x90E8;&#x5206;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x4E9B;&#x662F;&#x522B;&#x7684;&#x5DE5;&#x5177;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x5DE5;&#x5177;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x573A;&#x666F;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x6743;&#x8861;&#x548C;&#x9009;&#x62E9;&#xFF0C;&#x800C;&#x4E14;&#x5728;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x73AF;&#x5883;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x4E5F;&#x6709;&#x5DEE;&#x5F02;&#x3002;</p><ul><li><strong>2013</strong><ul><li><a href="https://github.com/tools/godep" target="_blank" rel="noopener">Godep</a><ul><li><code>Godeps/Godeps.json</code> &#x2192; <code>vender/</code></li></ul></li><li><a href="https://github.com/mattn/gom" target="_blank" rel="noopener">gom</a>: Go Manager - bundle for go<ul><li>&#x4EE5; Ruby &#x7684; bundler &#x4E3A;&#x539F;&#x578B;</li><li><code>Gomfile</code> &#x2192; <code>_vendor/</code></li></ul></li></ul></li><li><strong>2014</strong><ul><li><a href="https://github.com/Masterminds/glide" target="_blank" rel="noopener">glide</a>&#xFF1A;Vendor Package Management for Golang<ul><li>&#x4EE5; node.js &#x7684; npm/yarn &#x4E3A;&#x539F;&#x578B;</li><li><code>glide.yaml</code>/<code>glide.lock</code> &#x2192; <code>vendor/</code></li></ul></li><li><a href="http://labix.org/gopkg.in" target="_blank" rel="noopener">gopkg.in</a>: Stable APIs for the Go language<ul><li><code>go get gopkg.in/yaml.v1</code></li></ul></li></ul></li><li><strong>2015</strong><ul><li><a href="https://getgb.io/" target="_blank" rel="noopener">gb</a>: A project based build tool for the Go programming language.<ul><li><code>$PROJECT/src/</code></li><li><code>$PROJECT/vendor/src/</code></li></ul></li><li><a href="https://github.com/kardianos/govendor" target="_blank" rel="noopener">govendor</a>: The Vendor Tool for Go<ul><li><code>vendor.json</code> &#x2192; <code>vendor/</code></li></ul></li></ul></li></ul><h2 id="vendor-mu-lu"><a href="#vendor-&#x76EE;&#x5F55;" class="headerlink" title="vendor/ &#x76EE;&#x5F55;"></a>vendor/ &#x76EE;&#x5F55; <a href="#vendor-mu-lu" class="header-anchor">#</a></h2><ul><li><code>Go 1.5</code>: &#x6DFB;&#x52A0;&#x4E86; <code>vendor/</code> &#x76EE;&#x5F55;&#x652F;&#x6301;&#xFF0C;&#x4F46;&#x662F;&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#xFF08;2015&#x5E74;8&#x6708;&#xFF09;<ul><li>&#x6240;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x540E;&#xFF0C;<code>Godep</code> &#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x518D; <code>-r</code> &#x91CD;&#x5199; <code>import</code> &#x4E86;&#x3002;</li></ul></li><li><code>Go 1.6</code>: <code>vendor/</code> &#x76EE;&#x5F55;&#x9ED8;&#x8BA4;&#x542F;&#x7528;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#xFF08;2016&#x5E74;2&#x6708;&#xFF09;</li><li><code>Go 1.7</code>: <code>vendor/</code> &#x76EE;&#x5F55;&#x6C38;&#x8FDC;&#x542F;&#x7528;&#xFF08;2016&#x5E74;8&#x6708;&#xFF09;</li></ul><p>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E5F;&#x8FDE;&#x5E26;&#x7684;&#x6709;&#x5D4C;&#x5957;&#x4F9D;&#x8D56;&#x3001;&#x591A;&#x91CD;&#x7248;&#x672C;&#x7684;&#x95EE;&#x9898;&#x3002;</p><h1 id="go-dep"><a href="#go-dep" class="headerlink" title="go dep"></a>go dep <a href="#go-dep" class="header-anchor">#</a></h1><p><img src="https://github.com/ashleymcnamara/gophers/raw/master/MovingGopher.png" alt="Moving Gopher"></p><p>2016&#x5E74;&#x5C06; <code>vendor/</code> &#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#x540E;&#xFF0C;&#x6709;&#x4E86;&#x5BF9;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x66F4;&#x6DF1;&#x5165;&#x7684;&#x8BA8;&#x8BBA;&#x3002;&#x5927;&#x5BB6;&#x90FD;&#x8BA4;&#x4E3A; Go &#x5B98;&#x65B9;&#x5E94;&#x8BE5;&#x505A;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x4F46;&#x662F;&#x540C;&#x65F6;&#x5E0C;&#x671B;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x201C;&#x53C8;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x201D;&#x7684;&#x60C5;&#x5F62;&#x3002;</p><p><img src="https://d33wubrfki0l68.cloudfront.net/c67e6c813d332cd436018855e78c5f8d458efd53/02a7a/blog-images/boyer-15.png" alt="Another Standard"></p><p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#xFF0C;Go &#x56E2;&#x961F;&#x7684; <a href="https://peter.bourgon.org/" target="_blank" rel="noopener">Peter Bourgon</a> &#x5728; 2016 &#x5E74; 5 &#x6708;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x59D4;&#x5458;&#x4F1A;&#xFF0C;&#x6709;&#x5F88;&#x591A;&#x5927;&#x725B;&#x53C2;&#x52A0;&#xFF0C;&#x6765;&#x5E7F;&#x6CDB;&#x8BA8;&#x8BBA;&#x5404;&#x65B9;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p><ul><li>&#x4E89;&#x53D6;&#x6DB5;&#x76D6;&#x73B0;&#x6709;&#x5DE5;&#x5177;&#x7684;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x573A;&#x666F;</li><li>&#x8BBE;&#x8BA1;&#x5047;&#x8C61;&#x5DE5;&#x4F5C;&#x6D41;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x8BBE;&#x8BA1;&#x5177;&#x6709;&#x53EF;&#x6269;&#x5C55;&#x6027;</li><li>&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x539F;&#x578B;&#xFF0C;&#x5438;&#x53D6;&#x793E;&#x533A;&#x7684;&#x53CD;&#x9988;</li><li>&#x5C3D;&#x91CF;&#x51CF;&#x5C11;&#x6240;&#x5FC5;&#x987B;&#x7684;&#x4F7F;&#x7528;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x66F4;&#x5E7F;&#x6CDB;&#x7684;&#x517C;&#x5BB9;&#x73B0;&#x6709;&#x5DE5;&#x5177;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x66F4;&#x65B9;&#x4FBF;&#x7684;&#x4ECE;&#x73B0;&#x6709;&#x5DE5;&#x5177;&#x79FB;&#x690D;</li></ul><p>&#x5728; 2017 &#x5E74; 1 &#x6708;&#x7684;&#x65F6;&#x5019;&#xFF0C;Go &#x56E2;&#x961F;&#x53D1;&#x5E03;&#x4E86; <code>https://github.com/golang/dep</code>&#xFF0C;&#x4F5C;&#x4E3A;<strong>&#x5B98;&#x65B9;&#x8BD5;&#x9A8C;</strong>&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x79BB;&#x4E0D;&#x5F00; Go &#x793E;&#x533A;&#x7684;&#x53C2;&#x4E0E;&#x548C;&#x652F;&#x6301;&#xFF0C;&#x5927;&#x91CF;&#x7684; Go &#x5F00;&#x53D1;&#x793E;&#x533A;&#x7684;&#x4EBA;&#x90FD;&#x53C2;&#x52A0;&#x8FDB;&#x6765;&#xFF0C;&#x8BA8;&#x8BBA;&#x3001;&#x5B9E;&#x73B0;&#x3001;&#x63D0;&#x4EA4;&#x4FEE;&#x6539;&#x6765;&#x5B8C;&#x5584; <code>dep</code>&#x3002;</p><h2 id="dep-ji-chu"><a href="#dep-&#x57FA;&#x7840;" class="headerlink" title="dep &#x57FA;&#x7840;"></a><code>dep</code> &#x57FA;&#x7840; <a href="#dep-ji-chu" class="header-anchor">#</a></h2><ul><li>&#x4ECE;&#x5176;&#x5B83;&#x5305;&#x7BA1;&#x7406;&#x4E2D;&#x501F;&#x9274;&#xFF0C;&#x4F46;&#x662F;&#x4E13;&#x95E8;&#x4E3A; Go &#x5B9A;&#x5236;&#xFF1B;</li><li><code>import</code> &#x662F;&#x8001;&#x5927;</li><li>&#x53CC;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1A;<code>Gopkg.toml</code> &#x548C; <code>Gopkg.log</code></li><li>&#x9762;&#x5411;&#x9879;&#x76EE;&#x7684;</li><li>&#x4F7F;&#x7528; <a href="http://semver.org/lang/zh-CN/" target="_blank" rel="noopener">SemVer</a> &#x6807;&#x7B7E;</li><li><code>vendor/</code> &#x4E3A;&#x4E2D;&#x5FC3;&#xFF0C;<em>&#x57FA;&#x672C;&#x4E0A;</em>&#x4E0D;&#x9700;&#x8981; <code>GOPATH</code></li></ul><h2 id="san-ge-zhu-yao-ming-ling"><a href="#&#x4E09;&#x4E2A;&#x4E3B;&#x8981;&#x547D;&#x4EE4;" class="headerlink" title="&#x4E09;&#x4E2A;&#x4E3B;&#x8981;&#x547D;&#x4EE4;"></a>&#x4E09;&#x4E2A;&#x4E3B;&#x8981;&#x547D;&#x4EE4; <a href="#san-ge-zhu-yao-ming-ling" class="header-anchor">#</a></h2><ul><li><code>dep status</code><ul><li>&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x4F9D;&#x8D56;&#x72B6;&#x6001;</li><li>&#x662F;&#x5426;&#x6709;&#x9700;&#x8981;&#x66F4;&#x65B0;&#x7684;&#x4F9D;&#x8D56;</li><li><code>vendor/</code> &#x76EE;&#x5F55;&#x4E0B;&#x662F;&#x4E0D;&#x662F;&#x7F3A;&#x4E1C;&#x897F;</li><li>&#x4E00;&#x4E9B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x7684;&#x68C0;&#x67E5;&#x7B49;&#x7B49;</li></ul></li><li><code>dep init</code><ul><li>&#x548C; <code>npm init</code> &#x4E00;&#x6837;&#xFF0C;&#x5EFA;&#x7ACB;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x7684;&#x73AF;&#x5883;</li><li>&#x5EFA;&#x7ACB; <code>Gopkg.toml</code>&#x3001;<code>Gopkg.lock</code> &#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA; <code>vendor/</code> &#x76EE;&#x5F55;</li><li>&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5176;&#x5B83;&#x4F9D;&#x8D56;&#x5DE5;&#x5177;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3001;<code>GOPATH</code> &#x5185;&#x5BB9;&#x6765;&#x731C;&#x6D4B;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x628A;&#x4FE1;&#x606F;&#x8BFB;&#x53D6;&#xFF0C;&#x8F6C;&#x6362;&#x4E3A; <code>dep</code> &#x7684;&#x65B9;&#x5F0F;&#x3002;<ul><li>&#x76EE;&#x524D;&#x652F;&#x6301;&#x8BFB;&#x53D6; <code>godep</code> &#x548C; <code>glide</code> &#x7684;&#x914D;&#x7F6E;</li><li><code>govendor</code> &#x6216;&#x8005; <code>gb</code> &#x7684;&#x652F;&#x6301;&#x5728;&#x8BA1;&#x5212;&#x4E2D;&#x4E86;&#xFF0C;&#x8FD8;&#x4F1A;&#x652F;&#x6301;&#x66F4;&#x591A;&#x7684;&#x5305;&#x7BA1;&#x7406;&#x5DE5;&#x5177;</li><li>&#x800C;&#x4E14;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x8D21;&#x732E;&#x4EE3;&#x7801;&#x652F;&#x6301;&#x5176;&#x5B83;&#x5DE5;&#x5177;&#xFF0C;&#x6709;&#x4E2A;&#x6846;&#x67B6;&#x53EF;&#x4EE5;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#xFF0C;&#x4E0D;&#x590D;&#x6742;</li></ul></li></ul></li><li><code>dep ensure</code><ul><li>&#x8FD9;&#x662F;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x547D;&#x4EE4;</li></ul></li></ul><h2 id="dep-ensure"><a href="#dep-ensure" class="headerlink" title="dep ensure"></a><code>dep ensure</code> <a href="#dep-ensure" class="header-anchor">#</a></h2><p><code>ensure</code> &#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x786E;&#x4FDD;&#x6574;&#x4E2A;&#x4F9D;&#x8D56;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3002;</p><p><a href="https://speakerdeck.com/sdboyer/the-new-era-of-go-package-management?slide=27" target="_blank" rel="noopener">https://speakerdeck.com/sdboyer/the-new-era-of-go-package-management?slide=27</a></p><div class="mermaid">  graph LR  subgraph &quot;&quot;    Project(&quot;&#x9879;&#x76EE;&#x4EE3;&#x7801; (imports)&quot;) ==&gt; Gopkg.lock    Gopkg.toml ==&gt; Gopkg.lock    Gopkg.lock ==&gt; Deps(&quot;&#x4F9D;&#x8D56; (vendor)&quot;)  end  classDef box fill:#e3f2fd,stroke:#333,stroke-width:2px;  class Project,Gopkg.lock,Gopkg.toml,Deps box;</div><p>&#x57FA;&#x672C;&#x903B;&#x8F91;&#x5C31;&#x662F;&#xFF1A;</p><ol><li>&#x9759;&#x6001;&#x5206;&#x6790;&#x9879;&#x76EE;&#x7684;&#x6587;&#x4EF6;&#x7684; <code>import</code> &#x8BED;&#x53E5;&#x5F97;&#x51FA;&#x6240;&#x6709;&#x4F9D;&#x8D56;</li><li>&#x6839;&#x636E; <code>Gopkg.toml</code> &#x7684;&#x5185;&#x5BB9;&#x52A0;&#x4E0A;&#x7EA6;&#x675F;</li><li>&#x786E;&#x4FDD;&#x7EA6;&#x675F;&#x548C; <code>Gopkg.lock</code> &#x7684;&#x9501;&#x5B9A;&#x7248;&#x672C;&#x4E00;&#x81F4;</li><li>&#x6700;&#x540E;&#x786E;&#x4FDD; <code>vendor/</code> &#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x5185;&#x5BB9;&#x548C; <code>Gopkg.lock</code> &#x7684;&#x8981;&#x6C42;&#x4E00;&#x81F4;&#xFF08;&#x6709;&#x4E14;&#x4EC5;&#x6709;&#xFF09;</li></ol><ul><li>&#x8FD9;&#x4E00;&#x6B65;&#x786E;&#x4FDD;&#x540C;&#x6B65; <code>Gopkg.lock</code> &#x548C; <code>vendor/</code> &#x8FD8;&#x4E0D;&#x592A;&#x5065;&#x5168;&#xFF0C;&#x4F46;&#x662F;&#x6B63;&#x5728;&#x52AA;&#x529B;&#x5B8C;&#x5584;</li><li>&#x4F46;&#x662F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x63D0;&#x793A;&#x8BF4; <code>Gopkg.lock</code> &#x548C; <code>vendor</code> &#x4E0D;&#x4E00;&#x81F4;</li><li>&#x8FD9;&#x79CD; <code>sync-based</code> &#x6A21;&#x578B; npm &#x73B0;&#x5728;&#x4E5F;&#x5F00;&#x59CB;&#x5728;&#x7528;&#x4E86;</li></ul><p>&#x4E3A;&#x4E86;&#x5E86;&#x795D;&#x8FD9;&#x4E2A; <code>dep</code> &#x9879;&#x76EE;&#xFF0C;&#x8FD8;&#x4E13;&#x95E8;&#x8BF7; <a href="http://www.ashleymcnamara.com/" target="_blank" rel="noopener">Ashley McNamara</a> &#x753B;&#x4E86;&#x4E00;&#x4E2A; Avatar&#xFF1A;</p><p><img src="https://github.com/ashleymcnamara/gophers/raw/master/NERDY.png" alt="Moving Gopher"></p><h2 id="jin-ru-gong-ju-lian"><a href="#&#x8FDB;&#x5165;&#x5DE5;&#x5177;&#x94FE;" class="headerlink" title="&#x8FDB;&#x5165;&#x5DE5;&#x5177;&#x94FE;"></a>&#x8FDB;&#x5165;&#x5DE5;&#x5177;&#x94FE; <a href="#jin-ru-gong-ju-lian" class="header-anchor">#</a></h2><p>&#x73B0;&#x5728; <code>dep</code> &#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x5DE5;&#x5177;&#xFF0C;&#x4F46;&#x662F;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x4E00;&#x76F4;&#x5982;&#x6B64;&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x76EE;&#x7684;&#x662F;&#x8981;&#x88AB;&#x96C6;&#x6210;&#x5230; <code>go</code> &#x7684;&#x5DE5;&#x5177;&#x4E2D;&#x53BB;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5C06;&#x73B0;&#x5728;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x79F0;&#x5176;&#x4E3A; <strong>&#x5B98;&#x65B9;&#x8BD5;&#x9A8C;</strong> &#x7684;&#x539F;&#x56E0;&#x3002;</p><p>&#x73B0;&#x5728;&#x7684;&#x9879;&#x76EE;&#x4E0D;&#x662F;&#x7EC8;&#x70B9;&#x3002;&#x5C06;&#x6765;&#x5728;&#x96C6;&#x6210;&#x5230; <code>go</code> &#x5DE5;&#x5177;&#x94FE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x7CBE;&#x5FC3;&#x7684;&#x5206;&#x6790;&#x548C;&#x8FC1;&#x79FB;&#x73B0;&#x6709;&#x7684; <code>dep</code> &#x5DE5;&#x5177;&#x7684;&#x7279;&#x6027;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;<code>dep</code> &#x548C;&#x6700;&#x7EC8;&#x96C6;&#x6210;&#x5230; <code>go</code> &#x5DE5;&#x5177;&#x94FE;&#x4E0A;&#x540E;&#x4E0D;&#x4E00;&#x5B9A;&#x4F1A;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#xFF0C;&#x53EF;&#x80FD;&#x5BF9;&#x5E94;&#x4E5F;&#x53EF;&#x80FD;&#x4E0D;&#x5BF9;&#x5E94;&#x3002;&#x6BD4;&#x5982; <code>dep ensure</code> &#x6216;&#x8BB8;&#x5C31;&#x4F1A;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x96C6;&#x6210;&#x5230;&#x5176;&#x5B83;&#x5DE5;&#x4F5C;&#x6D41;&#x4E2D;&#x4E86;&#xFF0C;&#x6BD4;&#x5982; <code>go list</code>&#x3001;<code>go run</code>&#x3001;<code>go build</code> &#x4E4B;&#x7C7B;&#x7684;&#x91CC;&#x9762;&#x53BB;&#x4E86;&#x3002;</p><p>&#x6240;&#x4EE5; <code>dep</code> &#x662F;&#x672A;&#x6765;&#x7684;&#x4E00;&#x5757;&#x57FA;&#x77F3;&#xFF0C;&#x5E0C;&#x671B;&#x5C06;&#x6765;&#x5728;&#x96C6;&#x6210;&#x5230; <code>go</code> &#x5DE5;&#x5177;&#x94FE;&#x540E;&#xFF0C;<code>dep</code> &#x5C31;&#x53EF;&#x4EE5;&#x6E10;&#x6E10;&#x9000;&#x51FA;&#x821E;&#x53F0;&#x4E86;&#x3002;</p><p>&#x4EC5;&#x4EC5;&#x662F; Go Team &#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#x5DF2;&#x7ECF;&#x6BD4;&#x8F83;&#x96BE;&#x4E86;&#xFF0C;&#x800C;&#x73B0;&#x5728;&#x66F4;&#x5927;&#x7684;&#x95EE;&#x9898;&#x662F;&#x5C06;&#x7B2C;&#x4E00;&#x6B21;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x63A5;&#x7EB3;&#x793E;&#x533A;&#x5927;&#x91CF;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x5165; Go &#x6838;&#x5FC3;&#x3002;</p><p>&#x5C06;&#x6765;&#x7684;&#x5DE5;&#x5177;&#x94FE;&#x4F9D;&#x65E7;&#x4F1A;&#x7EE7;&#x627F;&#x4ECA;&#x5929; <code>dep</code> &#x91CC;&#x9762;&#x7684;&#x7279;&#x6027;&#xFF1A;</p><ul><li>&#x53CC;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li><code>import</code> &#x4E3A;&#x738B;</li><li>&#x4F9D;&#x65E7;&#x662F;&#x57FA;&#x4E8E;&#x540C;&#x6B65;</li><li>SemVer &#x6807;&#x7B7E;</li><li><code>vendor/</code>&#xFF08;<em>&#x6216;&#x7C7B;&#x4F3C;&#x7684;</em>&#xFF09;<ul><li>&#x5C06;&#x6765; <code>vendor</code> &#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#xFF0C;&#x73B0;&#x5728;&#x8FD8;&#x5728;&#x8BA8;&#x8BBA;&#x4E2D;</li><li>&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x4E0D;&#x5728;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x91CC;</li><li>&#x4F46;&#x662F;&#x548C; <code>GOPATH</code> &#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x6B21;&#x6709;&#x7248;&#x672C;&#x4FE1;&#x606F;</li><li>&#x8FD9;&#x6837;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x9879;&#x76EE;&#x91CC;&#x5B58;&#x5728; <code>vendor/</code> &#x76EE;&#x5F55;&#xFF0C;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x4FE1;&#x606F;&#x4ECE;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x53BB;&#x7B2C;&#x4E09;&#x4E2A;&#x4F4D;&#x7F6E;&#x83B7;&#x53D6;&#x7279;&#x5B9A;&#x7248;&#x672C;&#x7684;&#x5305;&#xFF08;&#x8FD9;&#x70B9;&#x5C31;&#x66F4;&#x50CF; npm &#x7684; <code>node_modules</code> &#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x5C40;&#x9650;&#x4E8E;&#x67D0;&#x4E2A;&#x9879;&#x76EE;&#xFF09;</li></ul></li></ul><h2 id="todos"><a href="#TODOs" class="headerlink" title="TODOs"></a>TODOs <a href="#todos" class="header-anchor">#</a></h2><ul><li>&#x591A;&#x9879;&#x76EE;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;<ul><li>&#x7B2C;&#x4E09;&#x4E2A;&#x4F4D;&#x7F6E;&#x5B58;&#x653E;&#x4F9D;&#x8D56;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x90E8;&#x5206;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;</li></ul></li><li>SemVer &#x7684;&#x5EFA;&#x8BAE;&#x5DE5;&#x5177;<ul><li>&#x50CF; <code>elm-package</code> &#x90A3;&#x6837;</li></ul></li><li>&#x5305;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;(&#x50CF; npm &#x90A3;&#x79CD;&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x53EF;&#x9009;&#x7684;)</li><li>&#x7F16;&#x8F91;&#x5668;&#x96C6;&#x6210;&#x65B9;&#x5F0F;</li><li>&#x5B89;&#x5168;&#x6A21;&#x578B;</li><li>&#x6027;&#x80FD;&#xFF01;</li><li>&#x66F4;&#x597D;&#x7684;&#x9519;&#x8BEF;&#x53CD;&#x9988;</li><li>&#x79C1;&#x6709;&#x5E93;/&#x4F01;&#x4E1A;&#x73AF;&#x5883;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;</li></ul><h2 id="todos-for-developers"><a href="#TODOs-for-Developers" class="headerlink" title="TODOs for Developers"></a>TODOs for Developers <a href="#todos-for-developers" class="header-anchor">#</a></h2><ul><li><p>&#x8BF7;&#x52A1;&#x5FC5;&#x7528; SemVer tag &#x4F60;&#x7684;&#x9879;&#x76EE;</p><ul><li>&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x6839;&#x636E; API &#x53D8;&#x5316;&#x60C5;&#x51B5;&#x6765;&#x5EFA;&#x8BAE;&#x4E0B;&#x4E00;&#x4E2A; SemVer &#x7684;&#x7248;&#x672C;&#x662F;&#x4EC0;&#x4E48;&#x3002;</li><li>Dave Cheney &#x5199;&#x4E86;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x90FD;&#x4F7F;&#x7528; SemVer&#xFF1A;<a href="https://dave.cheney.net/2016/06/24/gophers-please-tag-your-releases" target="_blank" rel="noopener">https://dave.cheney.net/2016/06/24/gophers-please-tag-your-releases</a></li></ul></li><li><p>&#x8F6C;&#x6362;&#x9879;&#x76EE;&#x4F9D;&#x8D56;&#x5DE5;&#x5177;&#x5230; <code>dep</code>&#xFF08;&#x662F;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x7528;&#x4E86;&#xFF01;&#xFF09;</p><ul><li><code>Gopkg.toml</code> &#x548C; <code>Gopkg.lock</code> &#x683C;&#x5F0F;&#x5DF2;&#x7ECF;&#x7A33;&#x5B9A;&#xFF0C;2&#x4E2A;&#x6708;&#x524D;&#x5C31;&#x56FA;&#x5B9A;&#x4E0B;&#x6765;&#x4E86;</li><li>&#x4F46;&#x662F;&#x547D;&#x4EE4;&#x4EE5;&#x53CA;&#x53C2;&#x6570;&#x53EF;&#x80FD;&#x8FD8;&#x4F1A;&#x6539;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x5EFA;&#x8BAE;&#x6682;&#x65F6;&#x4E0D;&#x8981;&#x5199;&#x811A;&#x672C;&#x6765;&#x4F9D;&#x8D56;&#x547D;&#x4EE4;&#x683C;&#x5F0F;</li></ul></li><li>&#x6709;&#x65F6;&#x95F4;&#x6765; <code>dep</code> &#x8D21;&#x732E;&#x4F60;&#x7684;&#x529B;&#x91CF;&#xFF08;&#x6211;&#x4EEC;<strong>&#x8D85;&#x7EA7;&#x53CB;&#x5584;</strong>&#xFF01;&#xFF09;</li><li>&#x7B2C;&#x4E8C;&#x5929;&#x6709; Hackathon&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x6765;&#x3002;</li><li>&#x8DDF;&#x8E2A;&#x6700;&#x65B0;&#x8FDB;&#x5C55;&#xFF0C;&#x8BF7;&#x67E5;&#x770B; <a href="https://sdboyer.io/dep-status/" target="_blank" rel="noopener">https://sdboyer.io/dep-status/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2017" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2017/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Go 和 syscall - Liz Rice</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-05-video-guide-to-syscall.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-05-video-guide-to-syscall.html</id>
    <published>2017-10-04T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.625Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#shi-me-shi-syscall">&#x4EC0;&#x4E48;&#x662F; <code>syscall</code>&#xFF1F;</a><ul><li><a href="#ji-shi-shi-jian-dan-cheng-xu-ye-zai-shi-yong-syscall">&#x5373;&#x4F7F;&#x662F;&#x7B80;&#x5355;&#x7A0B;&#x5E8F;&#x4E5F;&#x5728;&#x4F7F;&#x7528; <code>syscall</code></a></li><li><a href="#ru-he-jin-xing-de-syscall">&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7684; <code>syscall</code></a></li><li><a href="#syscall-ke-yi-zuo-wei-yi-ge-jian-rong-ceng"><code>syscall</code> &#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x517C;&#x5BB9;&#x5C42;</a></li><li><a href="#guan-cha-cheng-xu-de-syscall-diao-yong-qing-kuang">&#x89C2;&#x5BDF;&#x7A0B;&#x5E8F;&#x7684; <code>syscall</code> &#x8C03;&#x7528;&#x60C5;&#x51B5;</a></li></ul></li><li><a href="#yong-go-xie-yi-ge-strace">&#x7528; Go &#x5199;&#x4E00;&#x4E2A; <code>strace</code></a><ul><li><a href="#diao-yong-ling-yi-ge-ming-ling">&#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;</a></li><li><a href="#tian-jia-ptrace-zhi-chi">&#x6DFB;&#x52A0; <code>ptrace</code> &#x652F;&#x6301;</a></li><li><a href="#da-yin-duan-dian-de-ji-cun-qi-bian-liang">&#x6253;&#x5370;&#x65AD;&#x70B9;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x91CF;</a></li><li><a href="#shu-chu-xi-tong-diao-yong-ming-cheng">&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x540D;&#x79F0;</a></li><li><a href="#shu-chu-suo-you-de-xi-tong-diao-yong">&#x8F93;&#x51FA;&#x6240;&#x6709;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</a></li><li><a href="#qi-shi-ptrace-hui-ting-liang-ci">&#x5176;&#x5B9E; <code>ptrace</code> &#x4F1A;&#x505C;&#x4E24;&#x6B21;&#x2026;&#x2026;</a></li><li><a href="#hui-zong-xi-tong-diao-yong">&#x6C47;&#x603B;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</a></li></ul></li><li><a href="#syscall-yu-xi-tong-an-quan">syscall &#x4E0E;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;</a><ul><li><a href="#cheng-xu-zhong-shi-yong-seccomp-pei-zhi">&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528; seccomp &#x914D;&#x7F6E;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>A Go programmer&#x2019;s guide to syscalls</strong><br>by Liz Rice<br>at GopherCon 2017</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/01w7viEZzXQ" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=01w7viEZzXQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=01w7viEZzXQ</a></p><ul><li>&#x5E7B;&#x706F;&#xFF1A;<a href="https://speakerdeck.com/lizrice/a-go-programmers-guide-to-syscalls" target="_blank" rel="noopener">https://speakerdeck.com/lizrice/a-go-programmers-guide-to-syscalls</a></li><li>&#x535A;&#x6587;&#xFF1A;<a href="https://about.sourcegraph.com/go/a-go-guide-to-syscalls" target="_blank" rel="noopener">https://about.sourcegraph.com/go/a-go-guide-to-syscalls</a></li><li>&#x4EE3;&#x7801;&#xFF1A;<a href="https://github.com/lizrice/strace-from-scratch" target="_blank" rel="noopener">https://github.com/lizrice/strace-from-scratch</a></li></ul><h1 id="shi-me-shi-syscall"><a href="#&#x4EC0;&#x4E48;&#x662F;-syscall&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; syscall&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; <code>syscall</code>&#xFF1F; <a href="#shi-me-shi-syscall" class="header-anchor">#</a></h1><blockquote><p>&#x201C;&#x5728;&#x7535;&#x8111;&#x4E2D;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF08;&#x82F1;&#x8BED;&#xFF1A;system call&#xFF09;&#xFF0C;&#x53C8;&#x79F0;&#x4E3A;&#x7CFB;&#x7EDF;&#x547C;&#x53EB;&#xFF0C;&#x6307;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x7A0B;&#x5E8F;&#x5411;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#x8BF7;&#x6C42;&#x9700;&#x8981;&#x66F4;&#x9AD8;&#x6743;&#x9650;&#x8FD0;&#x884C;&#x7684;&#x670D;&#x52A1;&#x3002;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x4E0E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E4B;&#x95F4;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x5927;&#x591A;&#x6570;&#x7CFB;&#x7EDF;&#x4EA4;&#x4E92;&#x5F0F;&#x64CD;&#x4F5C;&#x9700;&#x6C42;&#x5728;&#x5185;&#x6838;&#x6001;&#x6267;&#x884C;&#x3002;&#x5982;&#x8BBE;&#x5907;IO&#x64CD;&#x4F5C;&#x6216;&#x8005;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x3002;&#x201D; - <a href="https://zh.wikipedia.org/zh-cn/&#x7CFB;&#x7EDF;&#x8C03;&#x7528;" target="_blank" rel="noopener">&#x7EF4;&#x57FA;&#x767E;&#x79D1;</a></p></blockquote><p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4F60;&#x57FA;&#x672C;&#x4E0A;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x60C5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;</p><ul><li>&#x8BBF;&#x95EE;&#x6587;&#x4EF6;</li><li>&#x8BBF;&#x95EE;&#x8BBE;&#x5907;</li><li>&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;</li><li>&#x901A;&#x8BAF;</li><li>&#x65F6;&#x95F4;</li><li>&#x2026;</li></ul><h2 id="ji-shi-shi-jian-dan-cheng-xu-ye-zai-shi-yong-syscall"><a href="#&#x5373;&#x4F7F;&#x662F;&#x7B80;&#x5355;&#x7A0B;&#x5E8F;&#x4E5F;&#x5728;&#x4F7F;&#x7528;-syscall" class="headerlink" title="&#x5373;&#x4F7F;&#x662F;&#x7B80;&#x5355;&#x7A0B;&#x5E8F;&#x4E5F;&#x5728;&#x4F7F;&#x7528; syscall"></a>&#x5373;&#x4F7F;&#x662F;&#x7B80;&#x5355;&#x7A0B;&#x5E8F;&#x4E5F;&#x5728;&#x4F7F;&#x7528; <code>syscall</code> <a href="#ji-shi-shi-jian-dan-cheng-xu-ye-zai-shi-yong-syscall" class="header-anchor">#</a></h2><p>&#x65E0;&#x8BBA;&#x4F60;&#x662F;&#x5199; C &#x7A0B;&#x5E8F;&#x3001;&#x5199; Go &#x7A0B;&#x5E8F;&#xFF0C;&#x6216;&#x8005;&#x54EA;&#x6015;&#x662F;&#x5199; bash &#x811A;&#x672C;&#xFF0C;&#x4F60;&#x5B9E;&#x9645;&#x4E0A;&#x90FD;&#x4F1A;&#x7528;&#x5230; syscall&#x3002;&#x4E3E;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; Go &#x7684;&#x4F8B;&#x5B50;&#x3002;</p><p><strong>hello.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, GopherCon!&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728; Linux &#x4E0A;&#x6784;&#x5EFA;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528; <code>strace</code> &#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x53D1;&#x751F;&#x4E86;&#x591A;&#x5C11;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ go build hello.go</span><br><span class="line">$ strace ./hello</span><br><span class="line">execve(<span class="string">&quot;./hello&quot;</span>, [<span class="string">&quot;./hello&quot;</span>], [/* 23 vars */]) = 0</span><br><span class="line">arch_prctl(ARCH_SET_FS, 0x52c008)       = 0</span><br><span class="line">sched_getaffinity(0, 8192, [0])         = 8</span><br><span class="line">mmap(0xc000000000, 65536, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc000000000</span><br><span class="line">munmap(0xc000000000, 65536)             = 0</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">futex(0x52c0b0, FUTEX_WAIT, 0, NULL)    = 0</span><br><span class="line">mmap(NULL, 262144, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f1eef3ac000</span><br><span class="line">write(1, <span class="string">&quot;Hello, GopherCon!\n&quot;</span>, 18Hello, GopherCon!</span><br><span class="line">)     = 18</span><br><span class="line">futex(0x52ba58, FUTEX_WAKE, 1)          = 1</span><br><span class="line">futex(0x52b990, FUTEX_WAKE, 1)          = 1</span><br><span class="line">exit_group(0)                           = ?</span><br><span class="line">+++ exited with 0 +++</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;&#x6D77;&#x6D77;&#x7684; syscall&#xFF0C;&#x800C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x6700;&#x540E;&#x7684;&#x90A3;&#x4E2A; <code>write()</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write(<span class="number">1</span>, <span class="string">&quot;Hello, GopherCon!\n&quot;</span>, <span class="number">18</span>Hello, GopherCon!</span><br><span class="line">)     = <span class="number">18</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x6700;&#x540E;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x8F93;&#x51FA;&#x5230;&#x4E86;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#xFF0C;<code>1</code>&#x3002;</p><p>&#x90A3;&#x4E48;&#x4E2D;&#x95F4;&#x90FD;&#x7ECF;&#x8FC7;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x987A;&#x7740;&#x4EE3;&#x7801;&#x4E00;&#x6B65;&#x6B65;&#x8DDF;&#x8E2A;&#x8FDB;&#x53BB;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#xFF0C;<code>fmt.Println()</code> &#x7684;&#x5B9A;&#x4E49;&#x5728; <code>fmt/print.go</code> &#x4E2D;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Println</span><span class="params">(a ...<span class="keyword">interface</span>{})</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> {</span><br><span class="line"><span class="keyword">return</span> Fprintln(os.Stdout, a...)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>Fprintln()</code> &#x7684;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fprintln</span><span class="params">(w io.Writer, a ...<span class="keyword">interface</span>{})</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> {</span><br><span class="line">p := newPrinter()</span><br><span class="line">p.doPrintln(a)</span><br><span class="line">n, err = w.Write(p.buf)</span><br><span class="line">p.free()</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x5230;&#x8FD9;&#x91CC;&#x6700;&#x540E;&#x8C03;&#x7528;&#x7684;&#x662F; <code>w.Write()</code>&#xFF0C;&#x800C; <code>w</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x524D;&#x9762;&#x7684; <code>os.Stdout</code>&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x5728; <code>os/file.go</code> &#x4E2D;&#xFF0C;&#x4E3A;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stdout = NewFile(<span class="keyword">uintptr</span>(syscall.Stdout), <span class="string">&quot;/dev/stdout&quot;</span>)</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x7684; <code>NewFile()</code> &#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;os/file_unix.go&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newFile</span><span class="params">(fd <span class="keyword">uintptr</span>, name <span class="keyword">string</span>, pollable <span class="keyword">bool</span>)</span> *<span class="title">File</span></span> {</span><br><span class="line">fdi := <span class="keyword">int</span>(fd)</span><br><span class="line"><span class="keyword">if</span> fdi &lt; <span class="number">0</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line">f := &amp;File{&amp;file{</span><br><span class="line">pfd: poll.FD{</span><br><span class="line">Sysfd:         fdi,</span><br><span class="line">IsStream:      <span class="literal">true</span>,</span><br><span class="line">ZeroReadIsEOF: <span class="literal">true</span>,</span><br><span class="line">},</span><br><span class="line">name: name,</span><br><span class="line">}}</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> f</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x53BB;&#x770B;&#x8FD9;&#x4E2A; <code>file</code> &#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">write</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> {</span><br><span class="line">n, err = f.pfd.Write(b)</span><br><span class="line">runtime.KeepAlive(f)</span><br><span class="line"><span class="keyword">return</span> n, err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FDB;&#x4E00;&#x6B65;&#x53BB;&#x770B; <code>f.pfd.Write()</code> &#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(fd *FD)</span> <span class="title">Write</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line"><span class="keyword">if</span> err := fd.writeLock(); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="keyword">defer</span> fd.writeUnlock()</span><br><span class="line"><span class="keyword">if</span> err := fd.pd.prepareWrite(fd.isFile); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> nn <span class="keyword">int</span></span><br><span class="line"><span class="keyword">for</span> {</span><br><span class="line">max := <span class="built_in">len</span>(p)</span><br><span class="line"><span class="keyword">if</span> fd.IsStream &amp;&amp; max-nn &gt; maxRW {</span><br><span class="line">max = nn + maxRW</span><br><span class="line">}</span><br><span class="line">n, err := syscall.Write(fd.Sysfd, p[nn:max])</span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="number">0</span> {</span><br><span class="line">nn += n</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> nn == <span class="built_in">len</span>(p) {</span><br><span class="line"><span class="keyword">return</span> nn, err</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> err == syscall.EAGAIN &amp;&amp; fd.pd.pollable() {</span><br><span class="line"><span class="keyword">if</span> err = fd.pd.waitWrite(fd.isFile); err == <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> nn, err</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> n == <span class="number">0</span> {</span><br><span class="line"><span class="keyword">return</span> nn, io.ErrUnexpectedEOF</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C31;&#x770B;&#x5230;&#x4E86;&#x6700;&#x7EC8;&#x7684; <code>syscall</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n, err := syscall.Write(fd.Sysfd, p[nn:max])</span><br></pre></td></tr></table></figure><p>Go &#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4F7F;&#x7528;&#x4E86; <code>syscall</code> &#x8FD9;&#x4E2A;&#x6807;&#x51C6;&#x5E93;&#x7684;&#x5305;&#x3002;&#x5305;&#x91CC;&#x6709;&#x5F88;&#x591A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4EE5;&#x53CA;&#x7279;&#x5B9A;&#x6784;&#x67B6;&#x7684;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x3002;</p><ul><li>&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#xFF1A;<ul><li>&#x5982;&#xFF1A; <a href="https://golang.org/src/syscall/syscall_linux.go" target="_blank" rel="noopener">https://golang.org/src/syscall/syscall_linux.go</a></li></ul></li><li>&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#xFF1A;<ul><li>&#x5982;&#xFF1A;<a href="https://golang.org/src/syscall/zsyscall_linux_386.go" target="_blank" rel="noopener">https://golang.org/src/syscall/zsyscall_linux_386.go</a></li></ul></li></ul><p>&#x5BF9;&#x4E8E; Linux &#x800C;&#x8A00;&#xFF0C;&#x73B0;&#x5728;&#x5927;&#x7EA6;&#x6709; <code>330</code> &#x591A;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;</p><h2 id="ru-he-jin-xing-de-syscall"><a href="#&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7684;-syscall" class="headerlink" title="&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7684; syscall"></a>&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7684; <code>syscall</code> <a href="#ru-he-jin-xing-de-syscall" class="header-anchor">#</a></h2><p>&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF1F;&#x548C;&#x5F80;&#x5E38;&#x4E00;&#x6837;&#xFF0C;&#x5148;&#x67E5; <code>man</code>&#xFF1A;</p><blockquote><p><code>syscall()</code> saves CPU registers before making the system call, restores the registers upon return from the system call, and stores any error code returned by the system call in <code>errno(3)</code> if an error occurs.</p></blockquote><p>&#x5C31;&#x662F;&#x8BF4;&#x8C03;&#x7528; <code>syscall</code> &#x4E4B;&#x524D;&#x5148;&#x4FDD;&#x5B58;&#x73AF;&#x5883;&#xFF1B;<code>syscall</code> &#x8FD4;&#x56DE;&#x4E4B;&#x540E;&#xFF0C;&#x6062;&#x590D;&#x73AF;&#x5883;&#xFF1B;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#x5728; <code>errno</code> &#x4E2D;&#x3002;</p><p>&#x800C;&#x5B9E;&#x9645;&#x7684;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;<a href="http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/" target="_blank" rel="noopener">http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a></p><p>&#x4EE5; <code>sys_write</code> &#x8C03;&#x7528;&#x4E3A;&#x4F8B;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53F7;&#x653E;&#x5230;&#x4E86; <code>%rax</code> &#x4E4B;&#x4E2D;&#xFF0C;&#x6587;&#x4EF6;&#x7684; <code>fd</code> &#x653E;&#x5230;&#x4E86; <code>%rdi</code> &#x4E2D;&#xFF0C;&#x8981;&#x5199;&#x5165;&#x7684; <code>buf</code> &#x653E;&#x5230;&#x4E86; <code>%rsi</code> &#x4E2D;&#xFF0C;&#x5199;&#x5165;&#x957F;&#x5EA6;&#x653E;&#x5230;&#x4E86; <code>%rdx</code> &#x4E4B;&#x4E2D;&#x3002;</p><p>&#x5F53;&#x6267;&#x884C;&#x4E86; <code>syscall()</code> &#x540E;&#xFF0C;&#x5F00;&#x59CB;&#x8FDB;&#x5165; Trap&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x5165;&#x5185;&#x6838;&#x6001;&#xFF0C;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x800C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x4F1A;&#x653E;&#x5230;&#x4E86; <code>%rax</code> &#x4E4B;&#x4E2D;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x4EE5; <code>amd64</code> &#x67B6;&#x6784;&#x7684; Linux &#x7CFB;&#x7EDF;&#x4E3E;&#x4F8B;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x6307;&#x4EE4;&#x96C6;&#x3001;&#x8FD8;&#x662F;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#x90FD;&#x4F1A;&#x4E0D;&#x540C;&#x3002;</p><h2 id="syscall-ke-yi-zuo-wei-yi-ge-jian-rong-ceng"><a href="#syscall-&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x517C;&#x5BB9;&#x5C42;" class="headerlink" title="syscall &#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x517C;&#x5BB9;&#x5C42;"></a><code>syscall</code> &#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x517C;&#x5BB9;&#x5C42; <a href="#syscall-ke-yi-zuo-wei-yi-ge-jian-rong-ceng" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x628A; <code>syscall</code> &#x4F5C;&#x4E3A;&#x4E00;&#x5C42;&#x53EF;&#x79FB;&#x690D;&#x5C42;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x4E00;&#x7EC4; <code>syscall</code> &#x63A5;&#x53E3;&#xFF0C;&#x6765;&#x6A21;&#x62DF; Linux&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x4E0D;&#x65B0;&#x9C9C;&#xFF0C;&#x6BD4;&#x5982; <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux" target="_blank" rel="noopener">Windows Subsystem for Linux</a>&#x3001;&#x4EE5;&#x53CA; FreeBSD &#x7684; <a href="https://www.freebsd.org/doc/handbook/linuxemu-lbc-install.html" target="_blank" rel="noopener">Linux emulation layer</a>&#xFF0C;&#x8FD8;&#x6709; <a href="https://en.wikipedia.org/wiki/L4Linux" target="_blank" rel="noopener">L4Linux</a> &#x90FD;&#x662F;&#x8FD9;&#x4E48;&#x505A;&#x7684;&#x3002;</p><h2 id="guan-cha-cheng-xu-de-syscall-diao-yong-qing-kuang"><a href="#&#x89C2;&#x5BDF;&#x7A0B;&#x5E8F;&#x7684;-syscall-&#x8C03;&#x7528;&#x60C5;&#x51B5;" class="headerlink" title="&#x89C2;&#x5BDF;&#x7A0B;&#x5E8F;&#x7684; syscall &#x8C03;&#x7528;&#x60C5;&#x51B5;"></a>&#x89C2;&#x5BDF;&#x7A0B;&#x5E8F;&#x7684; <code>syscall</code> &#x8C03;&#x7528;&#x60C5;&#x51B5; <a href="#guan-cha-cheng-xu-de-syscall-diao-yong-qing-kuang" class="header-anchor">#</a></h2><ul><li>Linux &#x4E0B;&#x7684; <code>strace</code>&#xFF1A;<ul><li><code>strace -c</code> &#x6C47;&#x603B;&#x8F93;&#x51FA;&#x3002;</li></ul></li></ul><p>&#x6BD4;&#x5982;&#x521A;&#x624D;&#x7684;&#x90A3;&#x4E2A; <code>hello</code> &#x7A0B;&#x5E8F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ strace -c ./hello</span><br><span class="line">Hello, GopherCon!</span><br><span class="line">% time     seconds  usecs/call     calls    errors syscall</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line">  0.00    0.000000           0         1           write</span><br><span class="line">  0.00    0.000000           0         8           mmap</span><br><span class="line">  0.00    0.000000           0         1           munmap</span><br><span class="line">  0.00    0.000000           0       114           rt_sigaction</span><br><span class="line">  0.00    0.000000           0         6           rt_sigprocmask</span><br><span class="line">  0.00    0.000000           0         2           <span class="built_in">clone</span></span><br><span class="line">  0.00    0.000000           0         1           execve</span><br><span class="line">  0.00    0.000000           0         2           sigaltstack</span><br><span class="line">  0.00    0.000000           0         1           arch_prctl</span><br><span class="line">  0.00    0.000000           0         1           gettid</span><br><span class="line">  0.00    0.000000           0         3           futex</span><br><span class="line">  0.00    0.000000           0         1           sched_getaffinity</span><br><span class="line">  0.00    0.000000           0         1           readlinkat</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line">100.00    0.000000                   142           total</span><br></pre></td></tr></table></figure><p>&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x7684;&#x8BDD;&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x4E2A;&#x5185;&#x6838;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8FD9;<code>13</code>&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5C31;&#x591F;&#x4E86;&#x3002;&#x1F63C;</p><p>&#x4E0D;&#x8FC7; <code>strace</code> &#x662F;&#x600E;&#x4E48;&#x505A;&#x5230;&#x76D1;&#x542C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x5462;&#xFF1F;</p><p>&#x5B9E;&#x9645;&#x4E0A; <code>strace</code> &#x4F7F;&#x7528;&#x4E86; Linux &#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;<code>ptrace</code>&#x3002;<code>ptrace</code> &#x53EF;&#x4EE5;&#x8BA9;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x76D1;&#x542C;&#x3001;&#x63A7;&#x5236;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x6267;&#x884C;&#xFF0C;&#x68C0;&#x67E5;&#x3001;&#x6539;&#x53D8;&#x8BE5;&#x8FDB;&#x7A0B;&#x7684;&#x5185;&#x5B58;&#x3001;&#x5BC4;&#x5B58;&#x5668;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x7ECF;&#x5E38;&#x7528;&#x4E8E;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x3001;&#x548C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8DDF;&#x8E2A;&#x3002;&#x5F88;&#x66B4;&#x529B;&#x3001;&#x5F88;&#x5F3A;&#x5927;&#x2026;&#x2026;&#x1F4AA;</p><h1 id="yong-go-xie-yi-ge-strace"><a href="#&#x7528;-Go-&#x5199;&#x4E00;&#x4E2A;-strace" class="headerlink" title="&#x7528; Go &#x5199;&#x4E00;&#x4E2A; strace"></a>&#x7528; Go &#x5199;&#x4E00;&#x4E2A; <code>strace</code> <a href="#yong-go-xie-yi-ge-strace" class="header-anchor">#</a></h1><p>&#x65E2;&#x7136; <code>strace</code> &#x662F;&#x4F7F;&#x7528;&#x7684; <code>ptrace</code> &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x800C; Go &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5C01;&#x88C5;&#x4E86;&#x4E00;&#x4E9B; <code>ptrace</code> &#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x7528; Go &#x5B9E;&#x73B0;&#x4E00;&#x4E2A; <code>strace</code>&#x3002;</p><h2 id="diao-yong-ling-yi-ge-ming-ling"><a href="#&#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;" class="headerlink" title="&#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;"></a>&#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x547D;&#x4EE4; <a href="#diao-yong-ling-yi-ge-ming-ling" class="header-anchor">#</a></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;Run %v\n&quot;</span>, os.Args[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">cmd := exec.Command(os.Args[<span class="number">1</span>], os.Args[<span class="number">2</span>:]...)</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line"></span><br><span class="line">cmd.Start()</span><br><span class="line">err := cmd.Wait()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;wait() returned: %v\n&quot;</span>, err)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528; <code>exec.Command()</code> &#x6765;&#x5EFA;&#x7ACB;&#x8981;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5C06;&#x7CFB;&#x7EDF;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x3001;&#x8F93;&#x51FA;&#x3001;&#x9519;&#x8BEF;&#x5BF9;&#x63A5;&#x8FC7;&#x53BB;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x8FC7;&#x53BB;&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello abcd</span><br><span class="line">Run [../hello/hello abcd]</span><br><span class="line">Hello, GopherCon!</span><br></pre></td></tr></table></figure><h2 id="tian-jia-ptrace-zhi-chi"><a href="#&#x6DFB;&#x52A0;-ptrace-&#x652F;&#x6301;" class="headerlink" title="&#x6DFB;&#x52A0; ptrace &#x652F;&#x6301;"></a>&#x6DFB;&#x52A0; <code>ptrace</code> &#x652F;&#x6301; <a href="#tian-jia-ptrace-zhi-chi" class="header-anchor">#</a></h2><p>&#x6DFB;&#x52A0; <code>ptrace</code> &#x652F;&#x6301;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x8BBE;&#x7F6E; <code>cmd.SysProcAttr</code> &#x5373;&#x53EF;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  ...</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line">  <span class="comment">//  &#x8BBE;&#x7F6E; Ptrace &#x4E3A; true</span></span><br><span class="line">cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">Ptrace: <span class="literal">true</span>,</span><br><span class="line">}</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  &#x4E3A;&#x4E86;&#x66F4;&#x660E;&#x663E;&#x7684;&#x770B;&#x51FA;&#x6548;&#x679C;&#xFF0C;&#x5728;&#x9000;&#x51FA;&#x524D;&#x7B49;&#x5F85;&#x4E00;&#x4F1A;&#x513F;</span></span><br><span class="line">time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x518D;&#x6267;&#x884C;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x7A0B;&#x5E8F;&#x6682;&#x505C;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br><span class="line"><span class="built_in">wait</span>() returned: stop signal: trace/breakpoint <span class="built_in">trap</span></span><br><span class="line"><span class="comment"># &lt;- &#x8FD9;&#x91CC;&#x7B49;&#x5019;&#x4E86;2&#x79D2;</span></span><br><span class="line">$ Hello, GopherCon!</span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E;&#x542F;&#x7528;&#x4E86; <code>ptrace</code>&#xFF0C;&#x5F53; <code>hello</code> &#x88AB;&#x52A0;&#x8F7D;&#x540E;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x7ACB;&#x523B;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x662F;&#x63A7;&#x5236;&#x6743;&#x56DE;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF0C;&#x5C31;&#x50CF;&#x662F;&#x65AD;&#x70B9;&#x4E00;&#x6837;&#x3002;&#x6240;&#x4EE5; <code>hello</code> &#x6682;&#x505C;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x3002;&#x800C;&#x5F53; <code>time.Sleep()</code> &#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x7A0B;&#x5E8F;&#x9000;&#x51FA;&#xFF0C;&#x548C; <code>hello</code> &#x65AD;&#x5F00;&#x4E86;&#x8FD9;&#x4E2A;&#x63A7;&#x5236;&#x8054;&#x7CFB;&#xFF0C;&#x4E8E;&#x662F; <code>hello</code> &#x5C31;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x4E8E;&#x662F;&#x770B;&#x5230;&#x4E86;&#x540E;&#x9762;&#x7684; <code>Hello, GopherCon!</code> &#x4E86;&#x3002;</p><h2 id="da-yin-duan-dian-de-ji-cun-qi-bian-liang"><a href="#&#x6253;&#x5370;&#x65AD;&#x70B9;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x91CF;" class="headerlink" title="&#x6253;&#x5370;&#x65AD;&#x70B9;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x91CF;"></a>&#x6253;&#x5370;&#x65AD;&#x70B9;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x91CF; <a href="#da-yin-duan-dian-de-ji-cun-qi-bian-liang" class="header-anchor">#</a></h2><p>&#x65E2;&#x7136;&#x662F;&#x65AD;&#x70B9;&#xFF0C;&#x63A7;&#x5236;&#x6743;&#x56DE;&#x5230;&#x4E3B;&#x7A0B;&#x5E8F;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x88AB;&#x8C03;&#x8BD5;&#x7A0B;&#x5E8F;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x91CF;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pid := cmd.Process.Pid</span><br><span class="line"><span class="keyword">var</span> regs syscall.PtraceRegs</span><br><span class="line"><span class="keyword">if</span> err = syscall.PtraceGetRegs(pid, &amp;regs); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, regs)</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x518D;&#x6B21;&#x6267;&#x884C;&#x6211;&#x4EEC;&#x7684; strace&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BC4;&#x5B58;&#x5668;&#x4FE1;&#x606F;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br><span class="line"><span class="built_in">wait</span>() returned: stop signal: trace/breakpoint <span class="built_in">trap</span></span><br><span class="line">syscall.PtraceRegs{R15:0x0, R14:0x0, R13:0x0, R12:0x0, Rbp:0x0, Rbx:0x0, R11:0x0, R10:0x0, R9:0x0, R8:0x0, Rax:0x0, Rcx:0x0, Rdx:0x0, Rsi:0x0, Rdi:0x0, Orig_rax:0x3b, Rip:0x452060, Cs:0x33, Eflags:0x200, Rsp:0x7ffe862afdf0, Ss:0x2b, Fs_base:0x0, Gs_base:0x0, Ds:0x0, Es:0x0, Fs:0x0, Gs:0x0}</span><br><span class="line">$ Hello, GopherCon!</span><br></pre></td></tr></table></figure><p><code>hello</code> &#x6240;&#x6709;&#x65AD;&#x70B9;&#x4F4D;&#x7F6E;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x4FE1;&#x606F;&#x6211;&#x4EEC;&#x5C31;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E86;&#x3002;&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BF4;&#x8FC7;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x7528;&#x4E86;&#x54EA;&#x4E9B;&#x5BC4;&#x5B58;&#x5668;&#x4E48;&#xFF1F;<code>%rax</code> &#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x7684;&#x662F;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53F7;&#x7684;&#xFF0C;&#x800C;&#x8FD9;&#x91CC;&#x7684; <code>Rax:0x0</code>&#xFF0C;&#x7ECF;&#x8FC7;&#x4E86;&#x89E3;&#x540E;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x65AD;&#x70B9;&#x4F4D;&#x7F6E;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5B58;&#x5728;&#x4E8E; <code>Orig_rax:0x3b</code>&#x3002;<code>0x3b</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>59</code> &#x53F7;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x67E5;&#x8BE2;&#x4E4B;&#x524D;&#x7684;&#x8868;&#x683C;&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x5728; Linux &#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x662F; <code>sys_execve</code>&#x3002;</p><h2 id="shu-chu-xi-tong-diao-yong-ming-cheng"><a href="#&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x540D;&#x79F0;" class="headerlink" title="&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x540D;&#x79F0;"></a>&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x540D;&#x79F0; <a href="#shu-chu-xi-tong-diao-yong-ming-cheng" class="header-anchor">#</a></h2><p>&#x65E2;&#x7136;&#x77E5;&#x9053;&#x4E86;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53F7;&#xFF0C;&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6253;&#x5370;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x540D;&#x5B57;&#xFF1F;&#x5728; Go &#x4E2D;&#xFF0C;&#x8FD9;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x4F7F;&#x7528; <code>github.com/seccomp/libseccomp-golang</code> &#x5373;&#x53EF;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x4E00;&#x5C42;&#x5C01;&#x88C5;&#xFF0C;&#x5C01;&#x88C5;&#x4E3A; <code>syscallCounter</code>&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6211;&#x4EEC;&#x7684; <code>main.go</code> &#x4E2D;&#x8C03;&#x7528;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ss syscallCounter</span><br><span class="line">ss = ss.init()</span><br><span class="line"></span><br><span class="line">name := ss.getName(regs.Orig_rax)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, name)</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x8F93;&#x51FA;&#x7684;&#x540D;&#x5B57; <code>execve</code> &#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br><span class="line"><span class="built_in">wait</span>() returned: stop signal: trace/breakpoint <span class="built_in">trap</span></span><br><span class="line">execve</span><br><span class="line">$ Hello, GopherCon!</span><br></pre></td></tr></table></figure><h2 id="shu-chu-suo-you-de-xi-tong-diao-yong"><a href="#&#x8F93;&#x51FA;&#x6240;&#x6709;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;" class="headerlink" title="&#x8F93;&#x51FA;&#x6240;&#x6709;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"></a>&#x8F93;&#x51FA;&#x6240;&#x6709;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528; <a href="#shu-chu-suo-you-de-xi-tong-diao-yong" class="header-anchor">#</a></h2><p>&#x8FD9;&#x53EA;&#x662F;&#x78B0;&#x5230;&#x7684;&#x7B2C;&#x4E00;&#x4E2A; <code>syscall</code>&#xFF0C;&#x5982;&#x4F55;&#x624D;&#x80FD;&#x663E;&#x793A;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5462;&#xFF1F;</p><p><code>ptrace</code> &#x5141;&#x8BB8;&#x6307;&#x5B9A;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x6682;&#x505C;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981;&#x5728;&#x6253;&#x5370; <code>syscall</code> &#x540D;&#x5B57;&#x4E4B;&#x540E;&#xFF0C;&#x52A0;&#x5165;&#x8FD9;&#x90E8;&#x5206;&#x8BBE;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x6574;&#x4F53;&#x5FAA;&#x73AF;&#x5C31;&#x597D;&#x4E86;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> {</span><br><span class="line"><span class="comment">//&#x6253;&#x5370;&#x65AD;&#x70B9;&#x5BC4;&#x5B58;&#x5668;&#x503C;</span></span><br><span class="line"><span class="keyword">if</span> err = syscall.PtraceGetRegs(pid, &amp;regs); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// fmt.Printf(&quot;%#v\n&quot;, regs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x540D;&#x5B57;</span></span><br><span class="line"><span class="keyword">var</span> ss syscallCounter</span><br><span class="line">ss = ss.init()</span><br><span class="line">name := ss.getName(regs.Orig_rax)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8981;&#x6C42;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x6682;&#x505C;</span></span><br><span class="line"><span class="keyword">if</span> err := syscall.PtraceSyscall(pid, <span class="number">0</span>); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5F00;&#x59CB;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span></span><br><span class="line"><span class="keyword">if</span> _, err = syscall.Wait4(pid, <span class="literal">nil</span>, <span class="number">0</span>, <span class="literal">nil</span>); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x518D;&#x6267;&#x884C;&#x6211;&#x4EEC;&#x7684; strace&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x6253;&#x5370;&#x51FA;&#x6765;&#x4E86;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br><span class="line">wait() returned: stop signal: trace/breakpoint trap</span><br><span class="line">execve</span><br><span class="line">arch_prctl</span><br><span class="line">arch_prctl</span><br><span class="line">sched_getaffinity</span><br><span class="line">sched_getaffinity</span><br><span class="line">mmap</span><br><span class="line">mmap</span><br><span class="line">munmap</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">futex</span><br><span class="line">futex</span><br><span class="line">readlinkat</span><br><span class="line">readlinkat</span><br><span class="line">mmap</span><br><span class="line">mmap</span><br><span class="line">write</span><br><span class="line">Hello, GopherCon!</span><br><span class="line">write</span><br><span class="line">exit_group</span><br><span class="line"><span class="built_in">panic</span>: no such process</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">main.main()</span><br><span class="line">        /vagrant/syscall/strace/main.<span class="keyword">go</span>:<span class="number">36</span> +<span class="number">0x530</span></span><br></pre></td></tr></table></figure><p>&#x4E0D;&#x8FC7;&#x6CE8;&#x610F;&#x5230;&#x6700;&#x540E;&#x51FA;&#x73B0;&#x4E86; <code>panic: no such process</code> &#x4E86;&#x4E48;&#xFF1F;&#x8FD9;&#x662F;&#x56E0;&#x4E3A; <code>hello</code> &#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x9000;&#x51FA;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x7136;&#x6211;&#x4EEC;&#x7684; <code>main()</code> &#x7A0B;&#x5E8F;&#x65E0;&#x6CD5;&#x7EE7;&#x7EED;&#x53D6;&#x5F97;&#x5176;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#x4E86;&#x3002;</p><p>&#x600E;&#x4E48;&#x624D;&#x80FD;&#x4E0D; <code>panic</code> &#x5462;&#xFF1F;&#x5F88;&#x7B80;&#x5355;&#x561B;&#xFF0C;&#x6211;&#x4EEC;&#x5728;<code>36</code>&#x884C;&#x90A3;&#x91CC;&#xFF0C;&#x53BB;&#x6389; <code>panic()</code>&#xFF0C;&#x76F4;&#x63A5; <code>break</code> &#x51FA;&#x5FAA;&#x73AF;&#x5373;&#x53EF;&#x3002;&#x7136;&#x540E;&#x5C31;&#x6CA1;&#x6709; <code>panic</code> &#x5566;&#x3002;&#x1F638;</p><h2 id="qi-shi-ptrace-hui-ting-liang-ci"><a href="#&#x5176;&#x5B9E;-ptrace-&#x4F1A;&#x505C;&#x4E24;&#x6B21;&#x2026;&#x2026;" class="headerlink" title="&#x5176;&#x5B9E; ptrace &#x4F1A;&#x505C;&#x4E24;&#x6B21;&#x2026;&#x2026;"></a>&#x5176;&#x5B9E; <code>ptrace</code> &#x4F1A;&#x505C;&#x4E24;&#x6B21;&#x2026;&#x2026; <a href="#qi-shi-ptrace-hui-ting-liang-ci" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#x4E4B;&#x524D;&#x7684;&#x8F93;&#x51FA;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">readlinkat</span><br><span class="line">readlinkat</span><br><span class="line">mmap</span><br><span class="line">mmap</span><br><span class="line">futex</span><br><span class="line">futex</span><br><span class="line">futex</span><br><span class="line">futex</span><br><span class="line">write</span><br><span class="line">Hello, GopherCon!</span><br><span class="line">write</span><br><span class="line">exit_group</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x5230;&#x8C8C;&#x4F3C;&#x6BCF;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x6210;&#x5BF9;&#x51FA;&#x73B0;&#x4E48;&#xFF1F;&#x7279;&#x522B;&#x662F; <code>Hello, GopherCon!</code> &#x7684;&#x524D;&#x540E;&#x5404;&#x5939;&#x4E86;&#x4E00;&#x4E2A; <code>write</code>&#x3002;&#x771F;&#x7684;&#x8FD9;&#x4E48;&#x6574;&#x9F50;&#x7684;&#x90FD;&#x662F;&#x4E24;&#x6B21;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E48;&#xFF1F;&#x4E0D;&#x662F;&#x7684;&#x3002;&#x5176;&#x5B9E;<strong>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53EA;&#x53D1;&#x751F;&#x4E86;&#x4E00;&#x6B21;</strong>&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x5374;<strong>&#x505C;&#x4E86;&#x4E24;&#x6B21;</strong>&#x3002;</p><p>&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x770B; <code>ptrace</code> &#x7684; <a href="http://man7.org/linux/man-pages/man2/ptrace.2.html" target="_blank" rel="noopener">manpage</a> &#x7684;&#x8BDD;&#xFF0C;&#x7FFB;&#x5230;&#x540E;&#x9762;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x63D0;&#x5230;&#xFF0C;&#x5728;&#x88AB;&#x76D1;&#x542C;&#x7A0B;&#x5E8F;&#x8FDB;&#x5165; <code>syscall</code> &#x4E4B;&#x524D;&#xFF0C;&#x4F1A;&#x505C;&#x4E00;&#x4E0B;&#xFF0C;&#x53EB;&#x505A; <code>syscall-enter-stop</code>&#xFF0C;&#x800C;&#x5728;&#x4ECE; <code>syscall</code> &#x8FD4;&#x56DE;&#x540E;&#xFF0C;&#x8FD8;&#x4F1A;&#x505C;&#x4E00;&#x4E0B;&#xFF0C;&#x53EB;&#x505A; <code>syscall-exit-stop</code>&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x8F93;&#x51FA;&#x4E86;&#x4E24;&#x8FB9;&#x540D;&#x5B57;&#xFF0C;&#x800C;&#x4E14;&#x4E00;&#x6B21;&#x662F;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#x3001;&#x4E00;&#x6B21;&#x662F;&#x4E4B;&#x540E;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#x4E09;&#x660E;&#x6CBB;&#x5F62;&#x5F0F;&#x7684;&#x8F93;&#x51FA;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">write</span><br><span class="line">Hello, GopherCon!</span><br><span class="line">write</span><br></pre></td></tr></table></figure><p>&#x6BD4;&#x8F83;&#x90C1;&#x95F7;&#x7684;&#x662F;&#xFF0C;&#x4EC5;&#x4ECE;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x6765;&#x770B;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x533A;&#x5206;&#x54EA;&#x6B21;&#x662F; <code>syscall-enter-stop</code>&#xFF0C;&#x54EA;&#x6B21;&#x662F; <code>syscall-exit-stop</code>&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x5728;&#x5916;&#x9762;&#x505A;&#x4E00;&#x4E2A; tik-tok &#x7684;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x6765;&#x8868;&#x660E;&#x5230;&#x5E95;&#x662F;&#x5565;&#x3002;</p><p>&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x4FEE;&#x6539;&#x7A0B;&#x5E8F;&#xFF0C;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; <code>exit</code> &#x6807;&#x5FD7;&#x4F4D;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x662F;&#x5426;&#x662F; syscall-exit-stop &#x7684;&#x6807;&#x5FD7;&#x4F4D;</span></span><br><span class="line">exit := <span class="literal">true</span></span><br><span class="line"><span class="keyword">for</span> {</span><br><span class="line"><span class="comment">//&#x5982;&#x679C;&#x662F; syscall-exit-stop &#x5C31;&#x6253;&#x5370;</span></span><br><span class="line"><span class="keyword">if</span> exit {</span><br><span class="line"><span class="comment">//&#x6253;&#x5370;&#x65AD;&#x70B9;&#x5BC4;&#x5B58;&#x5668;&#x503C;</span></span><br><span class="line"><span class="keyword">if</span> err := syscall.PtraceGetRegs(pid, &amp;regs); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// fmt.Printf(&quot;%#v\n&quot;, regs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x540D;&#x5B57;</span></span><br><span class="line"><span class="keyword">var</span> ss syscallCounter</span><br><span class="line">ss = ss.init()</span><br><span class="line">name := ss.getName(regs.Orig_rax)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, name)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8981;&#x6C42;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x6682;&#x505C;</span></span><br><span class="line"><span class="keyword">if</span> err := syscall.PtraceSyscall(pid, <span class="number">0</span>); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5F00;&#x59CB;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span></span><br><span class="line"><span class="keyword">if</span> _, err := syscall.Wait4(pid, <span class="literal">nil</span>, <span class="number">0</span>, <span class="literal">nil</span>); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x6BCF;&#x6B21;&#x5FAA;&#x73AF;&#x7FFB;&#x8F6C;&#x4E00;&#x4E0B;&#xFF0C;&#x6765;&#x8868;&#x660E; enter, exit &#x8FD9;&#x4E00;&#x5BF9;&#x72B6;&#x6001;</span></span><br><span class="line">exit = !exit</span><br><span class="line">}</span><br></pre></td></tr></table></figure><blockquote><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC; <code>exit</code> &#x7684;&#x521D;&#x59CB;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x7B2C;&#x4E00;&#x6B21;&#x505C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F; <code>execve</code> &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x719F;&#x6089; Unix/Linux &#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x7684;&#x4EBA;&#x5E94;&#x8BE5;&#x4E00;&#x4E0B;&#x5C31;&#x53CD;&#x5E94;&#x8FC7;&#x6765;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x7236;&#x8FDB;&#x7A0B;&#x5EFA;&#x7ACB;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x51FD;&#x6570;/&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x5F53;&#x5B50;&#x8FDB;&#x7A0B;&#x7B2C;&#x4E00;&#x6B21;&#x8FDB;&#x5165;&#x7528;&#x6237;&#x6001;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5FC5;&#x7136;&#x662F;&#x4ECE;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A; <code>syscall</code> &#x662F;&#x7531;&#x7236;&#x8FDB;&#x7A0B;&#x53D1;&#x8D77;&#x7684;&#xFF0C;&#x5206;&#x522B;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x548C;&#x7236;&#x8FDB;&#x7A0B;&#x4E2D;&#x8FD4;&#x56DE;&#x3002;&#x56E0;&#x6B64;&#x5F53; <code>ptrace</code> &#x7B2C;&#x4E00;&#x6B21;&#x622A;&#x83B7;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E8B;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x5B9A;&#x662F;<strong>&#x9000;&#x51FA;</strong>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x72B6;&#x6001;&#x3002;</p></blockquote><p>&#x8FD9;&#x4E00;&#x6B21;&#x518D;&#x8F93;&#x51FA;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x6210;&#x5BF9;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53EA;&#x5269;&#x4E0B;&#x540E;&#x534A;&#x90E8;&#x5206;&#x4E86;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br><span class="line">wait() returned: stop signal: trace/breakpoint trap</span><br><span class="line">execve</span><br><span class="line">arch_prctl</span><br><span class="line">sched_getaffinity</span><br><span class="line">mmap</span><br><span class="line">munmap</span><br><span class="line">mmap</span><br><span class="line">mmap</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">clone</span><br><span class="line">rt_sigprocmask</span><br><span class="line">futex</span><br><span class="line">futex</span><br><span class="line">futex</span><br><span class="line">readlinkat</span><br><span class="line">mmap</span><br><span class="line">futex</span><br><span class="line">Hello, GopherCon!</span><br><span class="line">write</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x56DE;&#x5C31;&#x5BF9;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x5728;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x540E;&#xFF0C;&#x624D;&#x6253;&#x5370;&#x8BE5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x56E0;&#x6B64; <code>Hello, GopherCon!</code> &#x662F;&#x53D1;&#x751F;&#x5728;&#x6253;&#x5370; <code>write</code> &#x4E4B;&#x524D;&#x3002;</p><h2 id="hui-zong-xi-tong-diao-yong"><a href="#&#x6C47;&#x603B;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;" class="headerlink" title="&#x6C47;&#x603B;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"></a>&#x6C47;&#x603B;&#x7CFB;&#x7EDF;&#x8C03;&#x7528; <a href="#hui-zong-xi-tong-diao-yong" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x770B;&#x8FC7; <code>strace -c</code> &#x8FD9;&#x4E2A;&#x6C47;&#x603B;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x9519;&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5B9E;&#x73B0;&#x4E00;&#x4E0B;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x9488;&#x5BF9; <code>syscallCounter</code> &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x8BA1;&#x6570;&#x51FD;&#x6570; <code>ss.inc()</code> &#x548C;&#x4E00;&#x4E2A;&#x6C47;&#x603B;&#x8F93;&#x51FA;&#x51FD;&#x6570; <code>ss.print()</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  syscall_counter.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s syscallCounter)</span> <span class="title">inc</span><span class="params">(syscallID <span class="keyword">uint64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line"><span class="keyword">if</span> syscallID &gt; maxSyscalls {</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid syscall ID (%x)&quot;</span>, syscallID)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">s[syscallID]++</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s syscallCounter)</span> <span class="title">print</span><span class="params">()</span></span> {</span><br><span class="line">w := tabwriter.NewWriter(os.Stdout, <span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="string">&apos; &apos;</span>, tabwriter.AlignRight|tabwriter.Debug)</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> s {</span><br><span class="line"><span class="keyword">if</span> v &gt; <span class="number">0</span> {</span><br><span class="line">name, _ := sec.ScmpSyscall(k).GetName()</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;%d\t%s\n&quot;</span>, v, name)</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">w.Flush()</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5728;&#x6BCF;&#x6B21;&#x6253;&#x5370;&#x51FD;&#x6570;&#x540D;&#x7684;&#x5730;&#x65B9;&#x52A0;&#x5165; <code>ss.inc(regs.Orig_rax)</code> &#x5373;&#x53EF;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;Run %v\n&quot;</span>, os.Args[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x8C03;&#x7528;&#x7684;&#x547D;&#x4EE4;</span></span><br><span class="line">cmd := exec.Command(os.Args[<span class="number">1</span>], os.Args[<span class="number">2</span>:]...)</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stdout = os.Stdout</span><br><span class="line"><span class="comment">//&#x542F;&#x7528; ptrace</span></span><br><span class="line">cmd.SysProcAttr = &amp;syscall.SysProcAttr{</span><br><span class="line">Ptrace: <span class="literal">true</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x542F;&#x52A8;&#x7A0B;&#x5E8F;</span></span><br><span class="line">cmd.Start()</span><br><span class="line">err := cmd.Wait()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;wait() returned: %v\n&quot;</span>, err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">pid := cmd.Process.Pid</span><br><span class="line"><span class="keyword">var</span> regs syscall.PtraceRegs</span><br><span class="line"><span class="keyword">var</span> ss syscallCounter</span><br><span class="line">ss = ss.init()</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x662F;&#x5426;&#x662F; syscall-exit-stop &#x7684;&#x6807;&#x5FD7;&#x4F4D;</span></span><br><span class="line">exit := <span class="literal">true</span></span><br><span class="line"><span class="keyword">for</span> {</span><br><span class="line"><span class="comment">//&#x5982;&#x679C;&#x662F; syscall-exit-stop &#x5C31;&#x6253;&#x5370;</span></span><br><span class="line"><span class="keyword">if</span> exit {</span><br><span class="line"><span class="comment">//&#x6253;&#x5370;&#x65AD;&#x70B9;&#x5BC4;&#x5B58;&#x5668;&#x503C;</span></span><br><span class="line"><span class="keyword">if</span> err := syscall.PtraceGetRegs(pid, &amp;regs); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// fmt.Printf(&quot;%#v\n&quot;, regs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x540D;&#x5B57;</span></span><br><span class="line">name := ss.getName(regs.Orig_rax)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5BF9;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8BA1;&#x6570;</span></span><br><span class="line">ss.inc(regs.Orig_rax)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8981;&#x6C42;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x6682;&#x505C;</span></span><br><span class="line"><span class="keyword">if</span> err := syscall.PtraceSyscall(pid, <span class="number">0</span>); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5F00;&#x59CB;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span></span><br><span class="line"><span class="keyword">if</span> _, err := syscall.Wait4(pid, <span class="literal">nil</span>, <span class="number">0</span>, <span class="literal">nil</span>); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x6BCF;&#x6B21;&#x5FAA;&#x73AF;&#x7FFB;&#x8F6C;&#x4E00;&#x4E0B;&#xFF0C;&#x6765;&#x8868;&#x660E; enter, exit &#x8FD9;&#x4E00;&#x5BF9;&#x72B6;&#x6001;</span></span><br><span class="line">exit = !exit</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8F93;&#x51FA;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6C47;&#x603B;</span></span><br><span class="line">ss.<span class="built_in">print</span>()</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E00;&#x6B21;&#x518D;&#x6765;&#x8F93;&#x51FA;&#x770B;&#x770B;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br><span class="line">wait() returned: stop signal: trace/breakpoint trap</span><br><span class="line">execve</span><br><span class="line">arch_prctl</span><br><span class="line">sched_getaffinity</span><br><span class="line">mmap</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">readlinkat</span><br><span class="line">futex</span><br><span class="line">mmap</span><br><span class="line">Hello, GopherCon!</span><br><span class="line">write</span><br><span class="line">          <span class="number">1</span>|write</span><br><span class="line">          <span class="number">8</span>|mmap</span><br><span class="line">          <span class="number">1</span>|munmap</span><br><span class="line">        <span class="number">114</span>|rt_sigaction</span><br><span class="line">          <span class="number">8</span>|rt_sigprocmask</span><br><span class="line">          <span class="number">3</span>|clone</span><br><span class="line">          <span class="number">1</span>|execve</span><br><span class="line">          <span class="number">2</span>|sigaltstack</span><br><span class="line">          <span class="number">1</span>|arch_prctl</span><br><span class="line">          <span class="number">1</span>|gettid</span><br><span class="line">          <span class="number">3</span>|futex</span><br><span class="line">          <span class="number">1</span>|sched_getaffinity</span><br><span class="line">          <span class="number">1</span>|readlinkat</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6C47;&#x603B;&#x6570;&#x636E;&#x4E86;&#x3002;&#x1F601;</p><h1 id="syscall-yu-xi-tong-an-quan"><a href="#syscall-&#x4E0E;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;" class="headerlink" title="syscall &#x4E0E;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;"></a>syscall &#x4E0E;&#x7CFB;&#x7EDF;&#x5B89;&#x5168; <a href="#syscall-yu-xi-tong-an-quan" class="header-anchor">#</a></h1><ul><li>&#x5BF9;&#x4E8E;&#x5FAE;&#x670D;&#x52A1;&#x800C;&#x8A00;&#xFF0C;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x53EA;&#x4F1A;&#x6267;&#x884C;&#x5F88;&#x5C11;&#x4E00;&#x90E8;&#x5206;&#x529F;&#x80FD;</li><li>&#x5BF9;&#x4E8E;&#x5B89;&#x5168;&#x800C;&#x8A00;&#xFF0C;&#x5219;&#x8FFD;&#x6C42;&#x7684;&#x662F;<strong>&#x6700;&#x5C0F;&#x6743;&#x9650;</strong>&#x7684;&#x539F;&#x5219;</li></ul><p>&#x4ECE;&#x524D;&#x9762;&#x7684;&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A; <code>hello</code> &#x7A0B;&#x5E8F;&#x53EA;&#x9700;&#x8981;&#x5341;&#x51E0;&#x4E2A; <code>syscall</code>&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x62E5;&#x6709; <code>330</code> &#x591A;&#x4E2A; <code>syscall</code> &#x7684; Linux &#x5185;&#x6838;&#x800C;&#x8A00;&#xFF0C;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x3002;&#x66F4;&#x4F55;&#x51B5;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x5230; <code>ptrace</code> &#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x5141;&#x8BB8;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x7A0B;&#x5E8F;&#x6709;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x80FD;&#x529B;&#x3002;</p><p>&#x90A3;&#x4E48;&#x6216;&#x8BB8;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EA6;&#x675F;&#xFF0C;&#x9650;&#x5B9A;&#x8FD9;&#x4E2A; <code>hello</code> &#x53EA;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x5341;&#x51E0;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x4E0D;&#x5141;&#x8BB8;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;<strong>&#x7F29;&#x5C0F;&#x653B;&#x51FB;&#x9762;&#x79EF;</strong>&#xFF0C;&#x4EE5;&#x6EE1;&#x8DB3;<strong>&#x6700;&#x5C0F;&#x6743;&#x9650;</strong>&#x7684;&#x5B89;&#x5168;&#x9700;&#x6C42;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x4F20;&#x7EDF;&#x7684;&#x81C3;&#x80BF;&#x7684;&#x5E94;&#x7528;&#x800C;&#x8A00;&#xFF0C;&#x53EF;&#x80FD;&#x610F;&#x4E49;&#x4E0D;&#x5927;&#xFF0C;&#x56E0;&#x4E3A;&#x5E94;&#x7528;&#x53EF;&#x80FD;&#x4F1A;&#x4EC0;&#x4E48;&#x90FD;&#x5E72;&#xFF0C;&#x5BFC;&#x81F4;&#x7528;&#x4E86;&#x5F88;&#x591A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x5FAE;&#x670D;&#x52A1;&#x800C;&#x8A00;&#xFF0C;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x90FD;&#x5F88;&#x5C0F;&#xFF0C;&#x53EA;&#x505A;&#x7279;&#x5B9A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x4F7F;&#x7528;&#x5C31;&#x4F1A;&#x88AB;&#x9650;&#x5B9A;&#x5728;&#x4E00;&#x4E2A;&#x5F88;&#x5C0F;&#x7684;&#x8303;&#x56F4;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8FD9;&#x79CD;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x7EA6;&#x675F;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x7CFB;&#x7EDF;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p><p><a href="https://en.wikipedia.org/wiki/Seccomp" target="_blank" rel="noopener">seccomp</a> &#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x505A;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#xFF0C;&#x5728; docker &#x4E2D;&#x751A;&#x81F3;&#x76F4;&#x63A5;<a href="https://docs.docker.com/engine/security/seccomp/" target="_blank" rel="noopener">&#x96C6;&#x6210;&#x4E86; seccomp &#x7684;&#x5B89;&#x5168;&#x7EA6;&#x675F;</a>&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7ED3;&#x5408; Docker &#x6765;&#x7EA6;&#x675F;&#x5FAE;&#x670D;&#x52A1;&#x7684;&#x7EC6;&#x5316;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6743;&#x9650;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --security-opt seccomp=/path/sc_profile.json hello-world</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E1C;&#x897F;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x592A;&#x957F;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x7684;&#x6587;&#x4EF6;&#xFF1A;<a href="https://github.com/moby/moby/blob/master/profiles/seccomp/default.json" target="_blank" rel="noopener">https://github.com/moby/moby/blob/master/profiles/seccomp/default.json</a></p><p>&#x8FD8;&#x6709;&#x66F4;&#x957F;&#x7684;&#xFF0C;&#x6BD4;&#x5982; Jessie Frazelle(Docker Queen) &#x505A;&#x7684;&#x90A3;&#x4E2A;&#x5728; Docker &#x4E2D;&#x8FD0;&#x884C; Chrome &#x7684;&#x955C;&#x50CF;&#x6240;&#x9700;&#x8981;&#x7684; seccomp &#x914D;&#x7F6E;&#xFF1A;<a href="https://github.com/jessfraz/dotfiles/blob/master/etc/docker/seccomp/chrome.json" target="_blank" rel="noopener">https://github.com/jessfraz/dotfiles/blob/master/etc/docker/seccomp/chrome.json</a></p><p>&#x8FD9;&#x6CA1;&#x6709;&#x4E2A;&#x57FA;&#x7840;&#x8FD8;&#x771F;&#x5199;&#x4E0D;&#x4E86;&#xFF0C;&#x6216;&#x8BB8;&#x8FD9;&#x5C31;&#x662F;&#x5B89;&#x5168;&#x516C;&#x53F8;&#x5B58;&#x5728;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x5427;&#x2026;&#x2026;&#x1F60E;</p><h2 id="cheng-xu-zhong-shi-yong-seccomp-pei-zhi"><a href="#&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;-seccomp-&#x914D;&#x7F6E;" class="headerlink" title="&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528; seccomp &#x914D;&#x7F6E;"></a>&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528; seccomp &#x914D;&#x7F6E; <a href="#cheng-xu-zhong-shi-yong-seccomp-pei-zhi" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6307;&#x5B9A; <code>seccomp</code> &#x7684;&#x914D;&#x7F6E;&#x3002;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; <code>disallow()</code> &#x51FD;&#x6570;&#xFF0C;&#x6765;&#x7981;&#x6B62;&#x67D0;&#x4E2A; syscall&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">disallow</span><span class="params">(sc <span class="keyword">string</span>)</span></span> {</span><br><span class="line">id, err := sec.GetSyscallFromName(sc)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">filter, _ := sec.NewFilter(sec.ActAllow)</span><br><span class="line">filter.AddRule(id, sec.ActErrno.SetReturnCode(<span class="keyword">int16</span>(syscall.EPERM)))</span><br><span class="line">filter.Load()</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5728; <code>main()</code> &#x4E2D;&#x6267;&#x884C; <code>hello</code> &#x524D;&#xFF0C;&#x7981;&#x7528;&#x4E00;&#x4E2A; syscall&#xFF0C;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7981;&#x7528; <code>write</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Printf(<span class="string">&quot;Run %v\n&quot;</span>, os.Args[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x7981;&#x7528; write &#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span></span><br><span class="line">disallow(<span class="string">&quot;write&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x8C03;&#x7528;&#x7684;&#x547D;&#x4EE4;</span></span><br><span class="line">cmd := exec.Command(os.Args[<span class="number">1</span>], os.Args[<span class="number">2</span>:]...)</span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x518D;&#x6B21;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x4EC0;&#x4E48;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x6CA1;&#x8F93;&#x51FA;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace ../hello/hello</span><br><span class="line">Run [../hello/hello]</span><br></pre></td></tr></table></figure><p>&#x4E3A;&#x4EC0;&#x4E48;&#x8FDE;&#x9664;&#x4E86; <code>write</code> &#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x90FD;&#x6CA1;&#x6709;&#x8F93;&#x51FA;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x6253;&#x5370;&#x90A3;&#x4E9B;&#x5B57;&#x7B26;&#x4E32;&#x5230;&#x5C4F;&#x5E55;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528; <code>write</code> &#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x800C;&#x8FD9;&#x4E2A;&#x52A0;&#x8F7D;&#x7684; <code>seccomp</code> &#x7684;&#x5B89;&#x5168;&#x914D;&#x7F6E;&#xFF0C;&#x662F;&#x5BF9;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x6709;&#x6548;&#x7684;&#xFF08;&#x5F53;&#x7136;&#xFF0C;<code>hello</code> &#x6267;&#x884C;&#x540E;&#x4E5F;&#x4F1A;&#x96C6;&#x6210;&#x8BE5;&#x914D;&#x7F6E;&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x7236;&#x8FDB;&#x7A0B;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x80FD;&#x901A;&#x8FC7; <code>write</code> &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6253;&#x5370;&#x8F93;&#x51FA;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x8C8C;&#x4F3C;&#x628A;&#x81EA;&#x5DF1;&#x4E5F;&#x7ED9;&#x7981;&#x4E86;&#x2026;&#x2026;&#x1F605;</p><p>&#x597D;&#x5427;&#xFF0C;&#x8FD9;&#x6837;&#x5B50;&#x6211;&#x4EEC;&#x6839;&#x672C;&#x5565;&#x90FD;&#x770B;&#x4E0D;&#x89C1;&#xFF0C;&#x6765;&#x6362;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7981;&#x6B62;&#x4E00;&#x4E0B;&#x3002;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x6362;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;&#x4E0D;&#x7528; <code>hello</code> &#x4E86;&#xFF0C;&#x7528; <code>echo hello</code>&#x3002;&#x7136;&#x540E;&#x7528;&#x6211;&#x4EEC;&#x7684; strace &#x770B;&#x770B;&#x90FD;&#x6709;&#x5565;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1|<span class="built_in">read</span></span><br><span class="line">1|write</span><br><span class="line">3|open</span><br><span class="line">5|close</span><br><span class="line">4|fstat</span><br><span class="line">7|mmap</span><br><span class="line">4|mprotect</span><br><span class="line">1|munmap</span><br><span class="line">3|brk</span><br><span class="line">3|access</span><br><span class="line">1|execve</span><br><span class="line">1|arch_prctl</span><br></pre></td></tr></table></figure><p>&#x55EF;&#xFF0C;&#x8FD9;&#x91CC;&#x770B; <code>open</code> &#x4E0D;&#x987A;&#x773C;&#xFF0C;&#x5C31;&#x7981;&#x7528;&#x5B83;&#x4E86;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x7981;&#x7528; open &#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span></span><br><span class="line">disallow(<span class="string">&quot;open&quot;</span>)</span><br></pre></td></tr></table></figure><p>&#x6784;&#x5EFA;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ ./strace <span class="built_in">echo</span> hello</span><br><span class="line">Run [<span class="built_in">echo</span> hello]</span><br><span class="line"><span class="built_in">wait</span>() returned: stop signal: trace/breakpoint <span class="built_in">trap</span></span><br><span class="line">execve</span><br><span class="line">brk</span><br><span class="line">access</span><br><span class="line">mmap</span><br><span class="line">access</span><br><span class="line">open</span><br><span class="line">open</span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">open</span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">open</span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">open</span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line"><span class="built_in">echo</span>: error <span class="keyword">while</span> loading shared libraries: libc.so.6: cannot open shared object file: Operation not permitted</span><br><span class="line">writev</span><br><span class="line">        5|open</span><br><span class="line">        4|<span class="built_in">stat</span></span><br><span class="line">        1|mmap</span><br><span class="line">        1|brk</span><br><span class="line">        1|writev</span><br><span class="line">        2|access</span><br><span class="line">        1|execve</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86; <code>cannot open shared object file: Operation not permitted</code> &#x7684;&#x62A5;&#x9519;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x7981;&#x6B62;&#x4E86; <code>open</code> &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4; <code>echo hello</code> &#x8FDB;&#x884C;&#x8BE5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x51FA;&#x9519;&#x4E86;&#x3002;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;<code>echo hello</code> &#x7684;&#x5185;&#x90E8;&#x6709;&#x9519;&#x8BEF;&#x5904;&#x7406;&#xFF0C;&#x5C1D;&#x8BD5;&#x4E86;&#x597D;&#x51E0;&#x6B21;&#x624D;&#x6700;&#x540E;&#x62A5;&#x9519;&#x9000;&#x51FA;&#x7684;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2017" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2017/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：理解 channels - Kavya Joshi</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html</id>
    <published>2017-10-03T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.625Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#go-de-bing-fa-te-xing">Go &#x7684;&#x5E76;&#x53D1;&#x7279;&#x6027;</a><ul><li><a href="#yi-ge-jian-dan-de-shi-wu-chu-li-de-li-zi">&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x7684;&#x4F8B;&#x5B50;</a></li><li><a href="#channels-de-te-xing">channels &#x7684;&#x7279;&#x6027;</a></li></ul></li><li><a href="#jie-xi">&#x89E3;&#x6790;</a><ul><li><a href="#gou-zao-channel">&#x6784;&#x9020; channel</a></li><li><a href="#fa-song-jie-shou">&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;</a><ul><li><a href="#jian-dan-de-fa-song-jie-shou">&#x7B80;&#x5355;&#x7684;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;</a></li></ul></li><li><a href="#zu-sai-he-hui-fu">&#x963B;&#x585E;&#x548C;&#x6062;&#x590D;</a><ul><li><a href="#fa-song-fang-bei-zu-sai">&#x53D1;&#x9001;&#x65B9;&#x88AB;&#x963B;&#x585E;</a></li><li><a href="#goroutine-de-yun-xing-shi-diao-du">goroutine &#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;</a></li><li><a href="#goroutine-bei-zu-sai-de-ju-ti-guo-cheng">goroutine &#x88AB;&#x963B;&#x585E;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B;</a></li><li><a href="#goroutine-hui-fu-zhi-xing-de-ju-ti-guo-cheng">goroutine &#x6062;&#x590D;&#x6267;&#x884C;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B;</a></li><li><a href="#ru-guo-jie-shou-fang-xian-zu-sai-ni">&#x5982;&#x679C;&#x63A5;&#x6536;&#x65B9;&#x5148;&#x963B;&#x585E;&#x5462;&#xFF1F;</a></li></ul></li><li><a href="#zong-jie">&#x603B;&#x7ED3;</a></li></ul></li><li><a href="#qi-ta-channel-de-cao-zuo">&#x5176;&#x5B83; channel &#x7684;&#x64CD;&#x4F5C;</a><ul><li><a href="#wu-huan-chong-channel">&#x65E0;&#x7F13;&#x51B2; channel</a></li><li><a href="#select"><code>select</code></a></li></ul></li><li><a href="#wei-shi-me-go-hui-zhe-yang-she-ji">&#x4E3A;&#x4EC0;&#x4E48; Go &#x4F1A;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#xFF1F;</a><ul><li><a href="#simplicity">Simplicity</a></li><li><a href="#performance">Performance</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Understanding Channels</strong><br>by Kavya Joshi<br>at GopherCon 2017</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/KBZlN0izeiY" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=KBZlN0izeiY" target="_blank" rel="noopener">https://www.youtube.com/watch?v=KBZlN0izeiY</a></p><p>&#x5E7B;&#x706F;&#xFF1A;<a href="https://github.com/gophercon/2017-talks/blob/master/KavyaJoshi-UnderstandingChannels/Kavya%20Joshi%20-%20Understanding%20Channels.pdf" target="_blank" rel="noopener">https://github.com/gophercon/2017-talks/blob/master/KavyaJoshi-UnderstandingChannels/Kavya%20Joshi%20-%20Understanding%20Channels.pdf</a><br>&#x535A;&#x6587;&#xFF1A;<a href="https://about.sourcegraph.com/go/understanding-channels-kavya-joshi" target="_blank" rel="noopener">https://about.sourcegraph.com/go/understanding-channels-kavya-joshi</a></p><h1 id="go-de-bing-fa-te-xing"><a href="#Go-&#x7684;&#x5E76;&#x53D1;&#x7279;&#x6027;" class="headerlink" title="Go &#x7684;&#x5E76;&#x53D1;&#x7279;&#x6027;"></a>Go &#x7684;&#x5E76;&#x53D1;&#x7279;&#x6027; <a href="#go-de-bing-fa-te-xing" class="header-anchor">#</a></h1><ul><li><strong>goroutines</strong>: &#x72EC;&#x7ACB;&#x6267;&#x884C;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5E76;<em>&#x53EF;&#x80FD;&#x5E76;&#x884C;</em>&#x6267;&#x884C;</li><li><strong>channels</strong>: &#x7528;&#x4E8E; goroutines &#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#x3001;&#x540C;&#x6B65;</li></ul><h2 id="yi-ge-jian-dan-de-shi-wu-chu-li-de-li-zi"><a href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x7684;&#x4F8B;&#x5B50;"></a>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x7684;&#x4F8B;&#x5B50; <a href="#yi-ge-jian-dan-de-shi-wu-chu-li-de-li-zi" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x975E;&#x5E76;&#x53D1;&#x7684;&#x7A0B;&#x5E8F;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">  tasks := getTasks()</span><br><span class="line">  <span class="comment">// &#x5904;&#x7406;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;</span></span><br><span class="line">  <span class="keyword">for</span> _, task := <span class="keyword">range</span> tasks {</span><br><span class="line">    process(task)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A; Go &#x7684;&#x5E76;&#x53D1;&#x6A21;&#x5F0F;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x4F7F;&#x7528;&#x5178;&#x578B;&#x7684; Task Queue &#x7684;&#x6A21;&#x5F0F;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">  <span class="comment">//  &#x521B;&#x5EFA;&#x5E26;&#x7F13;&#x51B2;&#x7684; channel</span></span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> Task, <span class="number">3</span>)</span><br><span class="line">  <span class="comment">//  &#x8FD0;&#x884C;&#x56FA;&#x5B9A;&#x6570;&#x91CF;&#x7684; workers</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numWorkers; i++ {</span><br><span class="line">    <span class="keyword">go</span> worker(ch)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  &#x53D1;&#x9001;&#x4EFB;&#x52A1;&#x5230; workers</span></span><br><span class="line">  hellaTasks := getTasks()</span><br><span class="line">  <span class="keyword">for</span> _, task := <span class="keyword">range</span> hellaTasks {</span><br><span class="line">    ch &lt;- task</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(ch <span class="keyword">chan</span> Task)</span></span> {</span><br><span class="line">  <span class="keyword">for</span> {</span><br><span class="line">    <span class="comment">//  &#x63A5;&#x6536;&#x4EFB;&#x52A1;</span></span><br><span class="line">    task := &lt;-ch</span><br><span class="line">    process(task)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="channels-de-te-xing"><a href="#channels-&#x7684;&#x7279;&#x6027;" class="headerlink" title="channels &#x7684;&#x7279;&#x6027;"></a>channels &#x7684;&#x7279;&#x6027; <a href="#channels-de-te-xing" class="header-anchor">#</a></h2><ul><li>goroutine-safe&#xFF0C;&#x591A;&#x4E2A; goroutine &#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A; channel &#x800C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x7ADE;&#x4E89;&#x95EE;&#x9898;</li><li>&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5728; goroutine &#x4E4B;&#x95F4;<em>&#x5B58;&#x50A8;</em>&#x548C;<em>&#x4F20;&#x9012;</em>&#x503C;</li><li>&#x5176;&#x8BED;&#x4E49;&#x662F;<em>&#x5148;&#x5165;&#x5148;&#x51FA;&#xFF08;FIFO&#xFF09;</em></li><li>&#x53EF;&#x4EE5;&#x5BFC;&#x81F4; goroutine &#x7684; block &#x548C; unblock</li></ul><h1 id="jie-xi"><a href="#&#x89E3;&#x6790;" class="headerlink" title="&#x89E3;&#x6790;"></a>&#x89E3;&#x6790; <a href="#jie-xi" class="header-anchor">#</a></h1><h2 id="gou-zao-channel"><a href="#&#x6784;&#x9020;-channel" class="headerlink" title="&#x6784;&#x9020; channel"></a>&#x6784;&#x9020; channel <a href="#gou-zao-channel" class="header-anchor">#</a></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  &#x5E26;&#x7F13;&#x51B2;&#x7684; channel</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> Task, <span class="number">3</span>)</span><br><span class="line"><span class="comment">//  &#x65E0;&#x7F13;&#x51B2;&#x7684; channel</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> Tass)</span><br></pre></td></tr></table></figure><p>&#x56DE;&#x987E;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684; channel &#x7684;&#x7279;&#x6027;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x524D;&#x4E24;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x5FFD;&#x7565;&#x5185;&#x7F6E;&#x7684; channel&#xFF0C;&#x8BA9;&#x4F60;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x5177;&#x6709; goroutines-safe &#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x3001;&#x4F20;&#x9012;&#x503C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F60;&#x4F1A;&#x600E;&#x4E48;&#x505A;&#xFF1F;&#x5F88;&#x591A;&#x4EBA;&#x53EF;&#x80FD;&#x89C9;&#x5F97;&#x6216;&#x8BB8;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x5E26;&#x9501;&#x7684;&#x961F;&#x5217;&#x6765;&#x505A;&#x3002;&#x6CA1;&#x9519;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;channel &#x5185;&#x90E8;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5E26;&#x9501;&#x7684;&#x961F;&#x5217;&#x3002;</p><p><a href="https://golang.org/src/runtime/chan.go" target="_blank" rel="noopener">https://golang.org/src/runtime/chan.go</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> {</span><br><span class="line">  ...</span><br><span class="line">  buf      unsafe.Pointer <span class="comment">// &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x73AF;&#x5F62;&#x961F;&#x5217;</span></span><br><span class="line">  ...</span><br><span class="line">  sendx    <span class="keyword">uint</span>   <span class="comment">// &#x53D1;&#x9001; index</span></span><br><span class="line">  recvx    <span class="keyword">uint</span>   <span class="comment">// &#x63A5;&#x6536; index</span></span><br><span class="line">  ...</span><br><span class="line">  lock     mutex  <span class="comment">//  &#x4E92;&#x65A5;&#x91CF;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>buf</code> &#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x7684;&#x5B9E;&#x73B0;&#x3002;<code>sendx</code> &#x548C; <code>recvx</code> &#x5206;&#x522B;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x7136;&#x540E;&#x7528;&#x4E00;&#x4E2A; <code>lock</code> &#x4E92;&#x65A5;&#x9501;&#x6765;&#x786E;&#x4FDD;&#x65E0;&#x7ADE;&#x4E89;&#x5192;&#x9669;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A; <code>ch := make(chan Task, 3)</code> &#x8FD9;&#x7C7B;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x4F1A;&#x5728;<strong>&#x5806;</strong>&#x4E2D;&#xFF0C;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x7A7A;&#x95F4;&#xFF0C;&#x5EFA;&#x7ACB;&#x5E76;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A; <code>hchan</code> &#x7ED3;&#x6784;&#x53D8;&#x91CF;&#xFF0C;&#x800C; <code>ch</code> &#x5219;&#x662F;&#x6307;&#x5411;&#x8FD9;&#x4E2A; <code>hchan</code> &#x7ED3;&#x6784;&#x7684;<strong>&#x6307;&#x9488;</strong>&#x3002;</p><p>&#x56E0;&#x4E3A; <code>ch</code> &#x672C;&#x8EAB;&#x5C31;&#x662F;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x624D;&#x53EF;&#x4EE5;&#x5728; goroutine &#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x76F4;&#x63A5;&#x5C06; <code>ch</code> &#x4F20;&#x9012;&#x8FC7;&#x53BB;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x518D; <code>&amp;ch</code> &#x53D6;&#x6307;&#x9488;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6240;&#x6709;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A; <code>ch</code> &#x7684; goroutine &#x90FD;&#x6307;&#x5411;&#x4E86;&#x540C;&#x4E00;&#x4E2A;&#x5B9E;&#x9645;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;</p><h2 id="fa-song-jie-shou"><a href="#&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;" class="headerlink" title="&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;"></a>&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536; <a href="#fa-song-jie-shou" class="header-anchor">#</a></h2><p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x63CF;&#x8FF0;&#xFF0C;&#x6211;&#x4EEC;&#x7528; <code>G1</code> &#x8868;&#x793A; <code>main()</code> &#x51FD;&#x6570;&#x7684; goroutine&#xFF0C;&#x800C; <code>G2</code> &#x8868;&#x793A; worker &#x7684; goroutine&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// G1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">for</span> _, task := <span class="keyword">range</span> tasks {</span><br><span class="line">    ch &lt;- task</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// G2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(ch <span class="keyword">chan</span> Task)</span></span> {</span><br><span class="line">  <span class="keyword">for</span> {</span><br><span class="line">    task :=&lt;-ch</span><br><span class="line">    process(task)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="jian-dan-de-fa-song-jie-shou"><a href="#&#x7B80;&#x5355;&#x7684;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;" class="headerlink" title="&#x7B80;&#x5355;&#x7684;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;"></a>&#x7B80;&#x5355;&#x7684;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536; <a href="#jian-dan-de-fa-song-jie-shou" class="header-anchor">#</a></h3><p>&#x90A3;&#x4E48; <code>G1</code> &#x4E2D;&#x7684; <code>ch &lt;- task0</code> &#x5177;&#x4F53;&#x662F;&#x600E;&#x4E48;&#x505A;&#x7684;&#x5462;&#xFF1F;</p><ol><li>&#x83B7;&#x53D6;&#x9501;</li><li><code>enqueue(task0)</code>&#xFF08;&#x8FD9;&#x91CC;&#x662F;&#x5185;&#x5B58;&#x590D;&#x5236; task0&#xFF09;</li><li>&#x91CA;&#x653E;&#x9501;</li></ol><p>&#x8FD9;&#x4E00;&#x6B65;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x770B; <code>G2</code> &#x7684; <code>t := &lt;- ch</code> &#x662F;&#x5982;&#x4F55;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x7684;&#x3002;</p><ol><li>&#x83B7;&#x53D6;&#x9501;</li><li><code>t = dequeue()</code>&#xFF08;&#x540C;&#x6837;&#xFF0C;&#x8FD9;&#x91CC;&#x4E5F;&#x662F;&#x5185;&#x5B58;&#x590D;&#x5236;&#xFF09;</li><li>&#x91CA;&#x653E;&#x9501;</li></ol><p>&#x8FD9;&#x4E00;&#x6B65;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4ECE;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6240;&#x6709; goroutine &#x4E2D;&#x5171;&#x4EAB;&#x7684;&#x90E8;&#x5206;&#x53EA;&#x6709;&#x8FD9;&#x4E2A; <code>hchan</code> &#x7684;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x800C;&#x6240;&#x6709;&#x901A;&#x8BAF;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;<strong>&#x5185;&#x5B58;&#x590D;&#x5236;</strong>&#x3002;&#x8FD9;&#x9075;&#x5FAA;&#x4E86; Go &#x5E76;&#x53D1;&#x8BBE;&#x8BA1;&#x4E2D;&#x5F88;&#x6838;&#x5FC3;&#x7684;&#x4E00;&#x4E2A;&#x7406;&#x5FF5;&#xFF1A;</p><blockquote><p>&#x201C;Do not communicate by sharing memory;<br>instead, share memory by communicating.&#x201D;</p></blockquote><h2 id="zu-sai-he-hui-fu"><a href="#&#x963B;&#x585E;&#x548C;&#x6062;&#x590D;" class="headerlink" title="&#x963B;&#x585E;&#x548C;&#x6062;&#x590D;"></a>&#x963B;&#x585E;&#x548C;&#x6062;&#x590D; <a href="#zu-sai-he-hui-fu" class="header-anchor">#</a></h2><h3 id="fa-song-fang-bei-zu-sai"><a href="#&#x53D1;&#x9001;&#x65B9;&#x88AB;&#x963B;&#x585E;" class="headerlink" title="&#x53D1;&#x9001;&#x65B9;&#x88AB;&#x963B;&#x585E;"></a>&#x53D1;&#x9001;&#x65B9;&#x88AB;&#x963B;&#x585E; <a href="#fa-song-fang-bei-zu-sai" class="header-anchor">#</a></h3><p>&#x5047;&#x8BBE; <code>G2</code> &#x9700;&#x8981;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5728;&#x6B64;&#x671F;&#x95F4;&#xFF0C;<code>G1</code> &#x4E0D;&#x65AD;&#x7684;&#x53D1;&#x9001;&#x4EFB;&#x52A1;&#xFF1A;</p><ol><li><code>ch &lt;- task1</code></li><li><code>ch &lt;- task2</code></li><li><code>ch &lt;- task3</code></li></ol><p>&#x4F46;&#x662F;&#x5F53;&#x518D;&#x4E00;&#x6B21; <code>ch &lt;- task4</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7531;&#x4E8E; <code>ch</code> &#x7684;&#x7F13;&#x51B2;&#x53EA;&#x6709; <code>3</code> &#x4E2A;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x5730;&#x65B9;&#x653E;&#x4E86;&#xFF0C;&#x4E8E;&#x662F; <code>G1</code> &#x88AB; block &#x4E86;&#xFF0C;&#x5F53;&#x6709;&#x4EBA;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x8D70;&#x4E00;&#x4E2A; Task &#x7684;&#x65F6;&#x5019;&#xFF0C;<code>G1</code> &#x624D;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x5173;&#x5FC3;&#x7684;&#x4E0D;&#x662F;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#xFF0C;&#x800C;&#x662F;&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;</p><h3 id="goroutine-de-yun-xing-shi-diao-du"><a href="#goroutine-&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;" class="headerlink" title="goroutine &#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;"></a>goroutine &#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6; <a href="#goroutine-de-yun-xing-shi-diao-du" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#xFF0C;goroutine <strong>&#x4E0D;&#x662F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EBF;&#x7A0B;</strong>&#xFF0C;&#x800C;&#x662F;<strong>&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7EBF;&#x7A0B;</strong>&#x3002;&#x56E0;&#x6B64; goroutine &#x662F;&#x7531; Go runtime &#x6765;&#x521B;&#x5EFA;&#x5E76;&#x7BA1;&#x7406;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F; OS&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x6BD4;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EBF;&#x7A0B;&#x8F7B;&#x91CF;&#x7EA7;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;goroutine &#x6700;&#x7EC8;&#x8FD8;&#x662F;&#x8981;&#x8FD0;&#x884C;&#x4E8E;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#xFF0C;&#x63A7;&#x5236; goroutine &#x5982;&#x4F55;&#x8FD0;&#x884C;&#x4E8E;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x662F; Go runtime &#x4E2D;&#x7684; scheduler &#xFF08;&#x8C03;&#x5EA6;&#x5668;&#xFF09;&#x3002;</p><p>Go &#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;&#x5668;&#x662F; <code>M:N</code> &#x8C03;&#x5EA6;&#x6A21;&#x578B;&#xFF0C;&#x65E2; <code>N</code> &#x4E2A; goroutine&#xFF0C;&#x4F1A;&#x8FD0;&#x884C;&#x4E8E; <code>M</code> &#x4E2A; OS &#x7EBF;&#x7A0B;&#x4E2D;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A; OS &#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x8FD0;&#x884C;&#x591A;&#x4E2A; goroutine&#x3002;</p><p>Go &#x7684; <code>M:N</code> &#x8C03;&#x5EA6;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;3&#x4E2A;&#x7ED3;&#x6784;&#xFF1A;</p><ul><li><code>M</code>: OS &#x7EBF;&#x7A0B;</li><li><code>G</code>: goroutine</li><li><code>P</code>: &#x8C03;&#x5EA6;&#x4E0A;&#x4E0B;&#x6587;<ul><li><code>P</code> &#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x961F;&#x5217;&#xFF0C;&#x91CC;&#x9762;&#x662F;&#x6240;&#x6709;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x7684; goroutine &#x53CA;&#x5176;&#x4E0A;&#x4E0B;&#x6587;</li></ul></li></ul><p>&#x8981;&#x60F3;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; goroutine - <code>G</code>&#xFF0C;&#x90A3;&#x4E48;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B; <code>M</code>&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x6301;&#x6709;&#x4E00;&#x4E2A;&#x8BE5; goroutine &#x7684;&#x4E0A;&#x4E0B;&#x6587; <code>P</code>&#x3002;</p><h3 id="goroutine-bei-zu-sai-de-ju-ti-guo-cheng"><a href="#goroutine-&#x88AB;&#x963B;&#x585E;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B;" class="headerlink" title="goroutine &#x88AB;&#x963B;&#x585E;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B;"></a>goroutine &#x88AB;&#x963B;&#x585E;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B; <a href="#goroutine-bei-zu-sai-de-ju-ti-guo-cheng" class="header-anchor">#</a></h3><p>&#x90A3;&#x4E48;&#x5F53; <code>ch &lt;- task4</code> &#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;channel &#x4E2D;&#x5DF2;&#x7ECF;&#x6EE1;&#x4E86;&#xFF0C;&#x9700;&#x8981;<strong>pause</strong> <code>G1</code>&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#xFF1A;</p><ol><li><code>G1</code> &#x4F1A;&#x8C03;&#x7528;&#x8FD0;&#x884C;&#x65F6;&#x7684; <code>gopark</code>&#xFF0C;</li><li>&#x7136;&#x540E; Go &#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;&#x5668;&#x5C31;&#x4F1A;&#x63A5;&#x7BA1;</li><li>&#x5C06; <code>G1</code> &#x7684;&#x72B6;&#x6001;&#x8BBE;&#x7F6E;&#x4E3A; <code>waiting</code></li><li>&#x65AD;&#x5F00; <code>G1</code> &#x548C; <code>M</code> &#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF08;switch out)&#xFF0C;&#x56E0;&#x6B64; <code>G1</code> &#x8131;&#x79BB; <code>M</code>&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;<code>M</code> &#x7A7A;&#x95F2;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x5B89;&#x6392;&#x522B;&#x7684;&#x4EFB;&#x52A1;&#x4E86;&#x3002;</li><li>&#x4ECE; <code>P</code> &#x7684;&#x8FD0;&#x884C;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x53D6;&#x5F97;&#x4E00;&#x4E2A;&#x53EF;&#x8FD0;&#x884C;&#x7684; goroutine <code>G</code></li><li>&#x5EFA;&#x7ACB;&#x65B0;&#x7684; <code>G</code> &#x548C; <code>M</code> &#x7684;&#x5173;&#x7CFB;&#xFF08;Switch in)&#xFF0C;&#x56E0;&#x6B64; <code>G</code> &#x5C31;&#x51C6;&#x5907;&#x597D;&#x8FD0;&#x884C;&#x4E86;&#x3002;</li><li>&#x5F53;&#x8C03;&#x5EA6;&#x5668;&#x8FD4;&#x56DE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x65B0;&#x7684; <code>G</code> &#x5C31;&#x5F00;&#x59CB;&#x8FD0;&#x884C;&#x4E86;&#xFF0C;&#x800C; <code>G1</code> &#x5219;&#x4E0D;&#x4F1A;&#x8FD0;&#x884C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; block &#x4E86;&#x3002;</li></ol><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5BF9;&#x4E8E; goroutine &#x6765;&#x8BF4;&#xFF0C;<code>G1</code> &#x88AB;&#x963B;&#x585E;&#x4E86;&#xFF0C;&#x65B0;&#x7684; <code>G</code> &#x5F00;&#x59CB;&#x8FD0;&#x884C;&#x4E86;&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EBF;&#x7A0B; <code>M</code> &#x6765;&#x8BF4;&#xFF0C;&#x5219;&#x6839;&#x672C;&#x6CA1;&#x6709;&#x88AB;&#x963B;&#x585E;&#x3002;</p><p>&#x6211;&#x4EEC;&#x77E5;&#x9053; OS &#x7EBF;&#x7A0B;&#x8981;&#x6BD4; goroutine &#x8981;&#x6C89;&#x91CD;&#x7684;&#x591A;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x5C3D;&#x91CF;&#x907F;&#x514D; OS &#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;</p><h3 id="goroutine-hui-fu-zhi-xing-de-ju-ti-guo-cheng"><a href="#goroutine-&#x6062;&#x590D;&#x6267;&#x884C;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B;" class="headerlink" title="goroutine &#x6062;&#x590D;&#x6267;&#x884C;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B;"></a>goroutine &#x6062;&#x590D;&#x6267;&#x884C;&#x7684;&#x5177;&#x4F53;&#x8FC7;&#x7A0B; <a href="#goroutine-hui-fu-zhi-xing-de-ju-ti-guo-cheng" class="header-anchor">#</a></h3><p>&#x524D;&#x9762;&#x7406;&#x89E3;&#x4E86;&#x963B;&#x585E;&#xFF0C;&#x90A3;&#x4E48;&#x63A5;&#x4E0B;&#x6765;&#x7406;&#x89E3;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x6062;&#x590D;&#x8FD0;&#x884C;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x5728;&#x7EE7;&#x7EED;&#x4E86;&#x89E3;&#x5982;&#x4F55;&#x6062;&#x590D;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5148;&#x8FDB;&#x4E00;&#x6B65;&#x7406;&#x89E3; <code>hchan</code> &#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x3002;&#x56E0;&#x4E3A;&#xFF0C;&#x5F53; channel &#x4E0D;&#x5728;&#x6EE1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8C03;&#x5EA6;&#x5668;&#x662F;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x8BE5;&#x8BA9;&#x54EA;&#x4E2A; goroutine &#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x5462;&#xFF1F;&#x800C;&#x4E14; goroutine &#x53C8;&#x662F;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x8BE5;&#x4ECE;&#x54EA;&#x53D6;&#x6570;&#x636E;&#x5462;&#xFF1F;</p><p>&#x5728; <code>hchan</code> &#x4E2D;&#xFF0C;&#x9664;&#x4E86;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x5185;&#x5BB9;&#x5916;&#xFF0C;&#x8FD8;&#x5B9A;&#x4E49;&#x6709; <code>sendq</code> &#x548C; <code>recvq</code> &#x4E24;&#x4E2A;&#x961F;&#x5217;&#xFF0C;&#x5206;&#x522B;&#x8868;&#x793A;&#x7B49;&#x5F85;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;&#x7684; goroutine&#xFF0C;&#x53CA;&#x5176;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> {</span><br><span class="line">  ...</span><br><span class="line">  buf      unsafe.Pointer <span class="comment">// &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x73AF;&#x5F62;&#x961F;&#x5217;</span></span><br><span class="line">  ...</span><br><span class="line">  sendq    waitq  <span class="comment">// &#x7B49;&#x5F85;&#x53D1;&#x9001;&#x7684;&#x961F;&#x5217;</span></span><br><span class="line">  recvq    waitq  <span class="comment">// &#x7B49;&#x5F85;&#x63A5;&#x6536;&#x7684;&#x961F;&#x5217;</span></span><br><span class="line">  ...</span><br><span class="line">  lock     mutex  <span class="comment">//  &#x4E92;&#x65A5;&#x91CF;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D; <code>waitq</code> &#x662F;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x7ED3;&#x6784;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x4E00;&#x4E2A; <code>sudog</code> &#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x5927;&#x81F4;&#x4E3A;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> sudog <span class="keyword">struct</span> {</span><br><span class="line">  g          *g <span class="comment">//  &#x6B63;&#x5728;&#x7B49;&#x5019;&#x7684; goroutine</span></span><br><span class="line">  elem       unsafe.Pointer <span class="comment">// &#x6307;&#x5411;&#x9700;&#x8981;&#x63A5;&#x6536;&#x3001;&#x53D1;&#x9001;&#x7684;&#x5143;&#x7D20;</span></span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><a href="https://golang.org/src/runtime/runtime2.go?h=sudog#L270" target="_blank" rel="noopener">https://golang.org/src/runtime/runtime2.go?h=sudog#L270</a></p><p>&#x6240;&#x4EE5;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x963B;&#x585E; <code>G1</code> &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#xFF1A;</p><ol><li><code>G1</code> &#x4F1A;<em>&#x7ED9;&#x81EA;&#x5DF1;</em>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>sudog</code> &#x7684;&#x53D8;&#x91CF;</li><li>&#x7136;&#x540E;&#x8FFD;&#x52A0;&#x5230; <code>sendq</code> &#x7684;&#x7B49;&#x5019;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x65B9;&#x4FBF;&#x5C06;&#x6765;&#x7684; <strong>receiver</strong> &#x6765;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x6062;&#x590D; <code>G1</code>&#x3002;</li></ol><p>&#x8FD9;&#x4E9B;&#x90FD;&#x662F;<strong>&#x53D1;&#x751F;&#x5728;&#x8C03;&#x7528;&#x8C03;&#x5EA6;&#x5668;&#x4E4B;&#x524D;</strong>&#x3002;</p><p>&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x5F00;&#x59CB;&#x770B;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x6062;&#x590D;&#x3002;</p><p>&#x5F53; <code>G2</code> &#x8C03;&#x7528; <code>t := &lt;- ch</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;channel &#x7684;&#x72B6;&#x6001;&#x662F;&#xFF0C;&#x7F13;&#x51B2;&#x662F;&#x6EE1;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x6709;&#x4E00;&#x4E2A; <code>G1</code> &#x5728;&#x7B49;&#x5019;&#x53D1;&#x9001;&#x961F;&#x5217;&#x91CC;&#xFF0C;&#x7136;&#x540E; <code>G2</code> &#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;</p><ol><li><code>G2</code> &#x5148;&#x6267;&#x884C; <code>dequeue()</code> &#x4ECE;&#x7F13;&#x51B2;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x5F97; <code>task1</code> &#x7ED9; <code>t</code></li><li><code>G2</code> &#x4ECE; <code>sendq</code> &#x4E2D;&#x5F39;&#x51FA;&#x4E00;&#x4E2A;&#x7B49;&#x5019;&#x53D1;&#x9001;&#x7684; <code>sudog</code></li><li>&#x5C06;&#x5F39;&#x51FA;&#x7684; <code>sudog</code> &#x4E2D;&#x7684; <code>elem</code> &#x7684;&#x503C; <code>enqueue()</code> &#x5230; <code>buf</code> &#x4E2D;</li><li>&#x5C06;&#x5F39;&#x51FA;&#x7684; <code>sudog</code> &#x4E2D;&#x7684; goroutine&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>G1</code>&#xFF0C;&#x72B6;&#x6001;&#x4ECE; <code>waiting</code> &#x6539;&#x4E3A; <code>runnable</code><ol><li>&#x7136;&#x540E;&#xFF0C;<code>G2</code> &#x9700;&#x8981;&#x901A;&#x77E5;&#x8C03;&#x5EA6;&#x5668; <code>G1</code> &#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x4E86;&#xFF0C;&#x56E0;&#x6B64;&#x8C03;&#x7528; <code>goready(G1)</code>&#x3002;</li><li>&#x8C03;&#x5EA6;&#x5668;&#x5C06; <code>G1</code> &#x7684;&#x72B6;&#x6001;&#x6539;&#x4E3A; <code>runnable</code></li><li>&#x8C03;&#x5EA6;&#x5668;&#x5C06; <code>G1</code> &#x538B;&#x5165; <code>P</code> &#x7684;&#x8FD0;&#x884C;&#x961F;&#x5217;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5C06;&#x6765;&#x7684;&#x67D0;&#x4E2A;&#x65F6;&#x523B;&#x8C03;&#x5EA6;&#x7684;&#x65F6;&#x5019;&#xFF0C;<code>G1</code> &#x5C31;&#x4F1A;&#x5F00;&#x59CB;&#x6062;&#x590D;&#x8FD0;&#x884C;&#x3002;</li><li>&#x8FD4;&#x56DE;&#x5230; G2</li></ol></li></ol><blockquote><p>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x7531; <code>G2</code> &#x6765;&#x8D1F;&#x8D23;&#x5C06; <code>G1</code> &#x7684; <code>elem</code> &#x538B;&#x5165; <code>buf</code> &#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F18;&#x5316;&#x3002;&#x8FD9;&#x6837;&#x5C06;&#x6765; <code>G1</code> &#x6062;&#x590D;&#x8FD0;&#x884C;&#x540E;&#xFF0C;&#x5C31;&#x4E0D;&#x5FC5;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x9501;&#x3001;<code>enqueue()</code>&#x3001;&#x91CA;&#x653E;&#x9501;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x591A;&#x6B21;&#x9501;&#x7684;&#x5F00;&#x9500;&#x3002;</p></blockquote><h3 id="ru-guo-jie-shou-fang-xian-zu-sai-ni"><a href="#&#x5982;&#x679C;&#x63A5;&#x6536;&#x65B9;&#x5148;&#x963B;&#x585E;&#x5462;&#xFF1F;" class="headerlink" title="&#x5982;&#x679C;&#x63A5;&#x6536;&#x65B9;&#x5148;&#x963B;&#x585E;&#x5462;&#xFF1F;"></a>&#x5982;&#x679C;&#x63A5;&#x6536;&#x65B9;&#x5148;&#x963B;&#x585E;&#x5462;&#xFF1F; <a href="#ru-guo-jie-shou-fang-xian-zu-sai-ni" class="header-anchor">#</a></h3><p>&#x66F4;&#x9177;&#x7684;&#x5730;&#x65B9;&#x662F;&#x63A5;&#x6536;&#x65B9;&#x5148;&#x963B;&#x585E;&#x7684;&#x6D41;&#x7A0B;&#x3002;</p><p>&#x5982;&#x679C; <code>G2</code> &#x5148;&#x6267;&#x884C;&#x4E86; <code>t := &lt;- ch</code>&#xFF0C;&#x6B64;&#x65F6; <code>buf</code> &#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x56E0;&#x6B64; <code>G2</code> &#x4F1A;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x4ED6;&#x7684;&#x6D41;&#x7A0B;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p><ol><li><code>G2</code> &#x7ED9;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>sudog</code> &#x7ED3;&#x6784;&#x53D8;&#x91CF;&#x3002;&#x5176;&#x4E2D; <code>g</code> &#x662F;&#x81EA;&#x5DF1;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>G2</code>&#xFF0C;&#x800C; <code>elem</code> &#x5219;&#x6307;&#x5411; <code>t</code></li><li>&#x5C06;&#x8FD9;&#x4E2A; <code>sudog</code> &#x53D8;&#x91CF;&#x538B;&#x5165; <code>recvq</code> &#x7B49;&#x5019;&#x63A5;&#x6536;&#x961F;&#x5217;</li><li><code>G2</code> &#x9700;&#x8981;&#x544A;&#x8BC9; goroutine&#xFF0C;&#x81EA;&#x5DF1;&#x9700;&#x8981; pause &#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x8C03;&#x7528; <code>gopark(G2)</code><ol><li>&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#xFF0C;&#x8C03;&#x5EA6;&#x5668;&#x5C06;&#x5176; <code>G2</code> &#x7684;&#x72B6;&#x6001;&#x6539;&#x4E3A; <code>waiting</code></li><li>&#x65AD;&#x5F00; <code>G2</code> &#x548C; <code>M</code> &#x7684;&#x5173;&#x7CFB;</li><li>&#x4ECE; <code>P</code> &#x7684;&#x8FD0;&#x884C;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x4E00;&#x4E2A; goroutine</li><li>&#x5EFA;&#x7ACB;&#x65B0;&#x7684; goroutine &#x548C; <code>M</code> &#x7684;&#x5173;&#x7CFB;</li><li>&#x8FD4;&#x56DE;&#xFF0C;&#x5F00;&#x59CB;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x65B0;&#x7684; <code>goroutine</code></li></ol></li></ol><p>&#x8FD9;&#x4E9B;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x4E0D;&#x964C;&#x751F;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5F53; <code>G1</code> &#x5F00;&#x59CB;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6D41;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x7684;&#x5462;&#xFF1F;</p><p><code>G1</code> &#x53EF;&#x4EE5;&#x5C06; <code>enqueue(task)</code>&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; <code>goready(G2)</code>&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x806A;&#x660E;&#x4E00;&#x4E9B;&#x3002;</p><p>&#x6211;&#x4EEC;&#x6839;&#x636E; <code>hchan</code> &#x7ED3;&#x6784;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5DF2;&#x7ECF;&#x77E5;&#x9053; <code>task</code> &#x8FDB;&#x5165; <code>buf</code> &#x540E;&#xFF0C;<code>G2</code> &#x6062;&#x590D;&#x8FD0;&#x884C;&#x540E;&#xFF0C;&#x4F1A;&#x8BFB;&#x53D6;&#x5176;&#x503C;&#xFF0C;&#x590D;&#x5236;&#x5230; <code>t</code> &#x4E2D;&#x3002;&#x90A3;&#x4E48; <code>G1</code> &#x53EF;&#x4EE5;&#x6839;&#x672C;&#x4E0D;&#x8D70; <code>buf</code>&#xFF0C;<strong><code>G1</code> &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;&#x6570;&#x636E;&#x7ED9; <code>G2</code></strong>&#x3002;</p><p>Goroutine &#x901A;&#x5E38;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6808;&#xFF0C;&#x4E92;&#x76F8;&#x4E4B;&#x95F4;&#x4E0D;&#x4F1A;&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x7684;&#x6808;&#x5185;&#x6570;&#x636E;&#xFF0C;<strong>&#x9664;&#x4E86; channel</strong>&#x3002;&#x8FD9;&#x91CC;&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86; <code>t</code> &#x7684;&#x5730;&#x5740;&#xFF08;&#x901A;&#x8FC7; <code>elem</code>&#x6307;&#x9488;&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x7531;&#x4E8E; <code>G2</code> &#x4E0D;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5B89;&#x5168;&#x7684;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#x3002;&#x5F53; <code>G2</code> &#x6062;&#x590D;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x65E2;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5BF9; <code>buf</code> &#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x4ECE;&#x800C;&#x8282;&#x7EA6;&#x4E86;&#x5185;&#x5B58;&#x590D;&#x5236;&#x3001;&#x4EE5;&#x53CA;&#x9501;&#x64CD;&#x4F5C;&#x7684;&#x5F00;&#x9500;&#x3002;</p><h2 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h2><ul><li><p>goroutine-safe</p><ul><li><code>hchan</code> &#x4E2D;&#x7684; <code>lock mutex</code></li></ul></li><li><p>&#x5B58;&#x50A8;&#x3001;&#x4F20;&#x9012;&#x503C;&#xFF0C;FIFO</p><ul><li>&#x901A;&#x8FC7; <code>hchan</code> &#x4E2D;&#x7684;&#x73AF;&#x5F62;&#x7F13;&#x51B2;&#x533A;&#x6765;&#x5B9E;&#x73B0;</li></ul></li><li><p>&#x5BFC;&#x81F4; goroutine &#x7684;&#x963B;&#x585E;&#x548C;&#x6062;&#x590D;</p><ul><li><code>hchan</code> &#x4E2D;&#x7684; <code>sendq</code>&#x548C;<code>recvq</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>sudog</code> &#x7ED3;&#x6784;&#x7684;&#x94FE;&#x8868;&#x961F;&#x5217;</li><li>&#x8C03;&#x7528;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;&#x5668; (<code>gopark()</code>, <code>goready()</code>)</li></ul></li></ul><h1 id="qi-ta-channel-de-cao-zuo"><a href="#&#x5176;&#x5B83;-channel-&#x7684;&#x64CD;&#x4F5C;" class="headerlink" title="&#x5176;&#x5B83; channel &#x7684;&#x64CD;&#x4F5C;"></a>&#x5176;&#x5B83; channel &#x7684;&#x64CD;&#x4F5C; <a href="#qi-ta-channel-de-cao-zuo" class="header-anchor">#</a></h1><h2 id="wu-huan-chong-channel"><a href="#&#x65E0;&#x7F13;&#x51B2;-channel" class="headerlink" title="&#x65E0;&#x7F13;&#x51B2; channel"></a>&#x65E0;&#x7F13;&#x51B2; channel <a href="#wu-huan-chong-channel" class="header-anchor">#</a></h2><p>&#x65E0;&#x7F13;&#x51B2;&#x7684; channel &#x884C;&#x4E3A;&#x5C31;&#x548C;&#x524D;&#x9762;&#x8BF4;&#x7684;<strong>&#x76F4;&#x63A5;&#x53D1;&#x9001;</strong>&#x7684;&#x4F8B;&#x5B50;&#x4E00;&#x6837;&#xFF1A;</p><ul><li>&#x63A5;&#x6536;&#x65B9;&#x963B;&#x585E; &#x2192; &#x53D1;&#x9001;&#x65B9;<strong>&#x76F4;&#x63A5;&#x5199;&#x5165;&#x63A5;&#x6536;&#x65B9;&#x7684;&#x6808;</strong></li><li>&#x53D1;&#x9001;&#x65B9;&#x963B;&#x585E; &#x2192; &#x63A5;&#x53D7;&#x6CD5;<strong>&#x76F4;&#x63A5;&#x4ECE;&#x53D1;&#x9001;&#x65B9;&#x7684; <code>sudog</code> &#x4E2D;&#x8BFB;&#x53D6;</strong></li></ul><h2 id="select"><a href="#select" class="headerlink" title="select"></a><code>select</code> <a href="#select" class="header-anchor">#</a></h2><p><a href="https://golang.org/src/runtime/select.go" target="_blank" rel="noopener">https://golang.org/src/runtime/select.go</a></p><ol><li>&#x5148;&#x628A;&#x6240;&#x6709;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7684; channel &#x4E0A;&#x9501;</li><li>&#x7ED9;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>sudog</code>&#xFF0C;&#x7136;&#x540E;&#x6DFB;&#x52A0;&#x5230;&#x6240;&#x6709; channel &#x7684; <code>sendq</code>&#x6216;<code>recvq</code>&#xFF08;&#x53D6;&#x51B3;&#x4E8E;&#x662F;&#x53D1;&#x9001;&#x8FD8;&#x662F;&#x63A5;&#x6536;&#xFF09;</li><li>&#x628A;&#x6240;&#x6709;&#x7684; channel &#x89E3;&#x9501;&#xFF0C;&#x7136;&#x540E; pause &#x5F53;&#x524D;&#x8C03;&#x7528; <code>select</code> &#x7684; goroutine&#xFF08;<code>gopark()</code>&#xFF09;</li><li>&#x7136;&#x540E;&#x5F53;&#x6709;&#x4EFB;&#x610F;&#x4E00;&#x4E2A; channel &#x53EF;&#x7528;&#x65F6;&#xFF0C;<code>select</code> &#x7684;&#x8FD9;&#x4E2A; goroutine &#x5C31;&#x4F1A;&#x88AB;&#x8C03;&#x5EA6;&#x6267;&#x884C;&#x3002;</li><li>resuming mirrors the pause sequence</li></ol><h1 id="wei-shi-me-go-hui-zhe-yang-she-ji"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-Go-&#x4F1A;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; Go &#x4F1A;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; Go &#x4F1A;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#xFF1F; <a href="#wei-shi-me-go-hui-zhe-yang-she-ji" class="header-anchor">#</a></h1><h2 id="simplicity"><a href="#Simplicity" class="headerlink" title="Simplicity"></a>Simplicity <a href="#simplicity" class="header-anchor">#</a></h2><p>&#x66F4;&#x503E;&#x5411;&#x4E8E;&#x5E26;&#x9501;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x65E0;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p><blockquote><p>&#x201C;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x4E0D;&#x662F;&#x51ED;&#x7A7A;&#x800C;&#x6765;&#x7684;&#xFF0C;&#x662F;&#x968F;&#x7740;&#x590D;&#x6742;&#x5EA6;&#x589E;&#x52A0;&#x800C;&#x589E;&#x52A0;&#x7684;&#x3002;&#x201D; - dvyokov</p></blockquote><p>&#x540E;&#x8005;&#x867D;&#x7136;&#x6027;&#x80FD;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x4F18;&#x52BF;&#xFF0C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x80FD;&#x591F;&#x6218;&#x80DC;&#x968F;&#x4E4B;&#x800C;&#x6765;&#x7684;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x6240;&#x5E26;&#x6765;&#x7684;&#x52A3;&#x52BF;&#x3002;</p><h2 id="performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance <a href="#performance" class="header-anchor">#</a></h2><ul><li>&#x8C03;&#x7528; Go &#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x4FDD;&#x6301; OS &#x7EBF;&#x7A0B;&#x4E0D;&#x88AB;&#x963B;&#x585E;</li></ul><p>&#x8DE8; goroutine &#x7684;&#x6808;&#x8BFB;&#x3001;&#x5199;&#x3002;</p><ul><li>&#x53EF;&#x4EE5;&#x8BA9; goroutine &#x9192;&#x6765;&#x540E;&#x4E0D;&#x5FC5;&#x83B7;&#x53D6;&#x9501;</li><li>&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x4E00;&#x4E9B;&#x5185;&#x5B58;&#x590D;&#x5236;</li></ul><p>&#x5F53;&#x7136;&#xFF0C;<strong>&#x4EFB;&#x4F55;&#x4F18;&#x52BF;&#x90FD;&#x4F1A;&#x6709;&#x5176;&#x4EE3;&#x4EF7;</strong>&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x5B9E;&#x73B0;&#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6709;&#x66F4;&#x590D;&#x6742;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x3001;&#x5783;&#x573E;&#x56DE;&#x6536;&#x4EE5;&#x53CA;&#x6808;&#x6536;&#x7F29;&#x673A;&#x5236;&#x3002;</p><p>&#x5728;&#x8FD9;&#x91CC;&#x6027;&#x80FD;&#x7684;&#x63D0;&#x9AD8;&#x4F18;&#x52BF;&#xFF0C;&#x8981;&#x6BD4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x63D0;&#x9AD8;&#x5E26;&#x6765;&#x7684;&#x52A3;&#x52BF;&#x8981;&#x5927;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5728; channel &#x5B9E;&#x73B0;&#x7684;&#x5404;&#x79CD;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x89C1;&#x5230;&#x8FD9;&#x79CD; <strong>simplicity vs performance</strong> &#x7684;&#x6743;&#x8861;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2017" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2017/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Go 的构建模式 - David Crawshaw</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-01-video-go-build-mode.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-10-01-video-go-build-mode.html</id>
    <published>2017-09-30T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.625Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#shi-me-shi-build-mode">&#x4EC0;&#x4E48;&#x662F; Build Mode&#xFF1F;</a></li><li><a href="#go-de-ba-chong-build-mode">Go &#x7684;&#x516B;&#x79CD; Build Mode</a><ul><li><a href="#exe-jing-tai-bian-yi"><code>exe</code> &#xFF08;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#xFF09;</a></li><li><a href="#exe-yong-libc">exe (&#x7528; libc)</a></li><li><a href="#exe-dong-tai-lian-jie-libc-he-fei-go-dai-ma">exe (&#x52A8;&#x6001;&#x94FE;&#x63A5; <code>libc</code> &#x548C;&#x975E; Go &#x4EE3;&#x7801;)</a></li><li><a href="#pie-position-independent-executables"><code>pie</code> - Position Independent Executables</a></li><li><a href="#c-archive-c-de-jing-tai-lian-jie-ku"><code>c-archive</code> C &#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;</a></li><li><a href="#c-shared-c-de-dong-tai-lian-jie-ku"><code>c-shared</code> C &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;</a><ul><li><a href="#wei-shi-me-hui-xu-yao-dong-tai-lian-jie">&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF1F;</a></li></ul></li><li><a href="#shared-go-de-dong-tai-lian-jie-ku"><code>shared</code> Go &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;</a></li><li><a href="#plugin-go-de-cha-jian"><code>plugin</code> Go &#x7684;&#x63D2;&#x4EF6;</a></li></ul></li><li><a href="#you-que-dian">&#x4F18;&#x7F3A;&#x70B9;</a></li><li><a href="#wei-lai">&#x672A;&#x6765;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Go Build Modes</strong><br>by David Crawshaw, Google<br>at GopherCon 2017</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/x-LhC-J2Vbk" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=x-LhC-J2Vbk" target="_blank" rel="noopener">https://www.youtube.com/watch?v=x-LhC-J2Vbk</a></p><h1 id="shi-me-shi-build-mode"><a href="#&#x4EC0;&#x4E48;&#x662F;-Build-Mode&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Build Mode&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; Build Mode&#xFF1F; <a href="#shi-me-shi-build-mode" class="header-anchor">#</a></h1><p><strong>build mode</strong> &#x7528;&#x4E8E;&#x6307;&#x5BFC;&#x7F16;&#x8BD1;&#x5668;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x53EF;&#x6267;&#x884C;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x3002;&#x8D8A;&#x591A;&#x7684;&#x6267;&#x884C;&#x65B9;&#x5F0F;&#xFF0C;&#x5C31;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x8BA9; Go &#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x4E8E;&#x66F4;&#x591A;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p><h1 id="go-de-ba-chong-build-mode"><a href="#Go-&#x7684;&#x516B;&#x79CD;-Build-Mode" class="headerlink" title="Go &#x7684;&#x516B;&#x79CD; Build Mode"></a>Go &#x7684;&#x516B;&#x79CD; Build Mode <a href="#go-de-ba-chong-build-mode" class="header-anchor">#</a></h1><ul><li><code>exe</code> (&#x9759;&#x6001;&#x7F16;&#x8BD1;)</li><li><code>exe</code> (&#x52A8;&#x6001;&#x94FE;&#x63A5; <code>libc</code>)</li><li><code>exe</code> (&#x52A8;&#x6001;&#x94FE;&#x63A5; <code>libc</code> &#x548C;&#x975E; Go &#x4EE3;&#x7801;)</li><li><code>pie</code> &#x5730;&#x5740;&#x65E0;&#x5173;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF08;&#x5B89;&#x5168;&#x7279;&#x6027;&#xFF09;</li><li><code>c-archive</code> C &#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;</li><li><code>c-shared</code> C &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;</li><li><code>shared</code> Go &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;</li><li><code>plugin</code> Go &#x7684;&#x63D2;&#x4EF6;</li></ul><h2 id="exe-jing-tai-bian-yi"><a href="#exe-&#xFF08;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#xFF09;" class="headerlink" title="exe &#xFF08;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#xFF09;"></a><code>exe</code> &#xFF08;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#xFF09; <a href="#exe-jing-tai-bian-yi" class="header-anchor">#</a></h2><p>&#x8FD9;&#x4E2A;&#x662F;&#x5927;&#x5BB6;&#x6700;&#x559C;&#x6B22;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x6784;&#x5EFA;&#x5230;&#x4E00;&#x4E2A;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 go build hello.go</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x5927;&#x5BB6;&#x4F7F;&#x7528; Go &#x6700;&#x559C;&#x6B22;&#x7684;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;&#x3002;&#x6240;&#x6709;&#x7684;&#x4F9D;&#x8D56;&#x90FD;&#x6784;&#x5EFA;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5916;&#x90E8;&#x4F9D;&#x8D56;&#xFF0C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x76F4;&#x63A5;&#x8C03;&#x7528; <code>syscall</code> &#x548C;&#x5185;&#x6838;&#x901A;&#x8BAF;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528; <code>CGO_ENABLED=0</code> &#x6765;&#x7EA6;&#x675F;&#x4E0D;&#x4F7F;&#x7528;&#x4EFB;&#x4F55; <code>CGO</code> &#x7684;&#x90E8;&#x5206;&#xFF0C;&#x8FD9;&#x6837;&#x4E0D;&#x4F1A;&#x4F9D;&#x8D56; <code>libc</code> &#x8FD9;&#x7C7B;&#x5E93;&#x3002;</p><h2 id="exe-yong-libc"><a href="#exe-&#x7528;-libc" class="headerlink" title="exe (&#x7528; libc)"></a>exe (&#x7528; libc) <a href="#exe-yong-libc" class="header-anchor">#</a></h2><p>&#x8FD9;&#x6837;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x4E86; <code>libc</code> &#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x56E0;&#x6B64;&#x50CF;&#x4E00;&#x4E9B; net &#x5305;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982; DNS &#x67E5;&#x8BE2;&#x3001;<code>os/user</code> &#x7684;&#x7528;&#x6237;&#x540D;&#x67E5;&#x8BE2;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x4F1A;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684; <code>libc</code> &#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x3002;</p><p>&#x5176;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7CFB;&#x7EDF;&#x7279;&#x5B9A;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4FDD;&#x8BC1;&#x884C;&#x4E3A;&#x548C;&#x7CFB;&#x7EDF;&#x4E00;&#x81F4;&#x3002;</p><h2 id="exe-dong-tai-lian-jie-libc-he-fei-go-dai-ma"><a href="#exe-&#x52A8;&#x6001;&#x94FE;&#x63A5;-libc-&#x548C;&#x975E;-Go-&#x4EE3;&#x7801;" class="headerlink" title="exe (&#x52A8;&#x6001;&#x94FE;&#x63A5; libc &#x548C;&#x975E; Go &#x4EE3;&#x7801;)"></a>exe (&#x52A8;&#x6001;&#x94FE;&#x63A5; <code>libc</code> &#x548C;&#x975E; Go &#x4EE3;&#x7801;) <a href="#exe-dong-tai-lian-jie-libc-he-fei-go-dai-ma" class="header-anchor">#</a></h2><p>&#x5F53;&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6240;&#x6709; Go &#x4EE3;&#x7801;&#x81EA;&#x7136;&#x90FD;&#x88AB;&#x7F16;&#x8BD1;&#x4E3A; object &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x6240;&#x6709;&#x975E; Go &#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x88AB;&#x88AB;&#x5176;&#x7F16;&#x8BD1;&#x5668;&#xFF08;&#x5982; C, Fortran &#x7B49;&#xFF09;&#x7F16;&#x8BD1;&#x4E3A; object &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x975E; Go &#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x88AB; <code>cgo</code> &#x8C03;&#x7528;&#x3002;</p><p>&#x5F53;&#x7A0B;&#x5E8F;&#x88AB;&#x8FDE;&#x63A5;(link)&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E9B;&#x975E; Go &#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x88AB;&#x7F16;&#x8BD1;&#x8FDB;&#x6700;&#x7EC8;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF0C;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A0;&#x8F7D;&#x3002;</p><h2 id="pie-position-independent-executables"><a href="#pie-Position-Independent-Executables" class="headerlink" title="pie - Position Independent Executables"></a><code>pie</code> - Position Independent Executables <a href="#pie-position-independent-executables" class="header-anchor">#</a></h2><p>&#x8FD9;&#x662F;&#x6784;&#x5EFA;&#x8FD0;&#x884C;&#x5730;&#x5740;&#x65E0;&#x5173;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5B89;&#x5168;&#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x652F;&#x6301; PIE &#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x8BA9;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5728;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x6BCF;&#x6B21;&#x7684;&#x5730;&#x5740;&#x90FD;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x3002;&#x907F;&#x514D;&#x5DF2;&#x77E5;&#x5730;&#x5740;&#x7684;&#x8DF3;&#x8DC3;&#x5F0F;&#x7684;&#x653B;&#x51FB;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x548C; exe &#x57FA;&#x672C;&#x4E00;&#x6837;&#xFF0C;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x6210;&#x4E3A;&#x9ED8;&#x8BA4;&#x3002;</p><h2 id="c-archive-c-de-jing-tai-lian-jie-ku"><a href="#c-archive-C-&#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;" class="headerlink" title="c-archive C &#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;"></a><code>c-archive</code> C &#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93; <a href="#c-archive-c-de-jing-tai-lian-jie-ku" class="header-anchor">#</a></h2><p>&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#xFF0C;&#x548C;&#x524D;&#x9762;&#x6784;&#x5EFA;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E0D;&#x540C;&#x4E86;&#x3002;&#x8FD9;&#x91CC;&#x6784;&#x5EFA;&#x7684;&#x662F;&#x4F9B; C &#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x7684;&#x5E93;&#x3002;&#x66F4;&#x51C6;&#x786E;&#x4E00;&#x4E9B;&#x7684;&#x8BF4;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x628A; Go &#x7A0B;&#x5E8F;&#x6784;&#x5EFA;&#x4E3A; archive (<code>.a</code>) &#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837; C &#x7C7B;&#x7684;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x9759;&#x6001;&#x94FE;&#x63A5; <code>.a</code> &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8C03;&#x7528;&#x5176;&#x4E2D;&#x4EE3;&#x7801;&#x3002;</p><ul><li><code>hello.go</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {}</span><br><span class="line"></span><br><span class="line"><span class="comment">//export Hello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, world.&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><blockquote><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>//export Hello</code>&#xFF0C;&#x8FD9;&#x662F;&#x7EA6;&#x5B9A;&#xFF0C;&#x6240;&#x6709;&#x9700;&#x8981;&#x5BFC;&#x51FA;&#x7ED9; <code>C</code> &#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x6DFB;&#x52A0;&#x8FD9;&#x4E2A;&#x6784;&#x5EFA;&#x4FE1;&#x606F;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x4F1A;&#x6784;&#x5EFA;&#x751F;&#x6210; C &#x6240;&#x9700;&#x7684;&#x5934;&#x6587;&#x4EF6;&#x3002;</p></blockquote><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x8FD9;&#x4E2A; <code>hello.go</code> &#x6587;&#x4EF6;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -buildmode=c-archive hello.go</span><br></pre></td></tr></table></figure><p>&#x6784;&#x5EFA;&#x540E;&#xFF0C;&#x4F1A;&#x751F;&#x6210;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x9759;&#x6001;&#x5E93;&#x6587;&#x4EF6; <code>hello.a</code>&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x5219;&#x662F; C &#x7684;&#x5934;&#x6587;&#x4EF6; <code>hello.h</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello.a:  current ar archive random library</span><br><span class="line">hello.h:  c program text, ASCII text</span><br></pre></td></tr></table></figure><p>&#x5728;&#x6240;&#x751F;&#x6210;&#x7684; <code>hello.h</code> &#x7684;&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; Go &#x7684; <code>Hello()</code> &#x51FD;&#x6570;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; <code>hello.c</code> &#x4E2D;&#x5F15;&#x7528;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; Go &#x7F16;&#x8BD1;&#x7684;&#x9759;&#x6001;&#x5E93;&#xFF1A;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;hello.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>{</span><br><span class="line">  Hello();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#xFF0C;&#x6784;&#x5EFA; C &#x7A0B;&#x5E8F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc hello.a hello.c -o hello</span><br></pre></td></tr></table></figure><p>&#x6700;&#x540E;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./hello</span><br><span class="line">Hello, world.</span><br></pre></td></tr></table></figure><h2 id="c-shared-c-de-dong-tai-lian-jie-ku"><a href="#c-shared-C-&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;" class="headerlink" title="c-shared C &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;"></a><code>c-shared</code> C &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93; <a href="#c-shared-c-de-dong-tai-lian-jie-ku" class="header-anchor">#</a></h2><p>&#x548C;&#x524D;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;&#x662F;&#xFF0C;&#x8FD9;&#x5C06;&#x7528; Go &#x4EE3;&#x7801;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF08;Unix: <code>.so</code>/Windows <code>.dll</code>&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x7528; C &#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x8FD0;&#x884C;&#x3002;</p><p>Go &#x548C; C &#x8BED;&#x8A00;&#x7684;&#x4EE3;&#x7801;&#x548C;&#x4E0A;&#x9762;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E0D;&#x540C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -buildmode=c-shared -o hello.so hello.go</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86; <code>-buildmode=c-shared</code>&#xFF0C;&#x4EE5;&#x6784;&#x5EFA; C &#x6240;&#x652F;&#x6301;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x3002;</p><blockquote><p>&#x6CE8;&#xFF1A;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x660E;&#x786E;&#x6307;&#x5B9A;&#x4E86; <code>-o hello.so</code>&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x548C;&#x6F14;&#x8BB2;&#x8005;&#x4E0D;&#x540C;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x90A3;&#x4E48;&#x9ED8;&#x8BA4;&#x4F1A;&#x4F7F;&#x7528; <code>hello</code> &#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5BFC;&#x81F4;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;&#x627E;&#x4E0D;&#x5230; <code>hello.so</code> &#x6587;&#x4EF6;&#x3002;</p></blockquote><p>&#x8FD9;&#x6B21;&#x4E5F;&#x751F;&#x6210;&#x4E86;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x662F; <code>hello.so</code>&#xFF0C;&#x4E00;&#x4E2A;&#x662F; <code>hello.h</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello.h:  c program text, ASCII text</span><br><span class="line">hello.so: Mach-O 64-bit dynamically linked shared library x86_64</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#xFF0C;&#x7F16;&#x8BD1;&#x5BF9;&#x5E94;&#x7684; C &#x7A0B;&#x5E8F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc hello.c hello.so -o hello</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x5BF9;&#x6BD4; <code>c-archive</code> &#x4F8B;&#x5B50;&#x548C; <code>c-shared</code> &#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>hello</code> &#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0; <code>c-shared</code> &#x7684;&#x4F8B;&#x5B50;&#x7684; <code>hello</code> &#x8981;&#x5C0F;&#x5F88;&#x591A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># c-archive</span></span><br><span class="line">-rwxr-xr-x  1 taowang  staff   1.5M  3 Oct 17:51 hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># c-shared</span></span><br><span class="line">-rwxr-xr-x  1 taowang  staff   8.2K  3 Oct 19:17 hello</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x524D;&#x8005;&#xFF0C;&#x5C06; Go &#x7684;&#x4EE3;&#x7801;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#x8FDB;&#x4E86; C &#x7684;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF1B;&#x800C;&#x540E;&#x8005;&#xFF0C;&#x5219;&#x662F;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF0C;C &#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5185;&#x4E0D;&#x5305;&#x542B;&#x6211;&#x4EEC;&#x5199;&#x7684; Go &#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6240;&#x6709;&#x8FD9;&#x90E8;&#x5206;&#x51FD;&#x6570;&#x90FD;&#x5728;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93; <code>hello.so</code> &#x4E2D;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--  1 taowang  staff   2.2M  3 Oct 19:17 hello.so</span><br></pre></td></tr></table></figure><p>&#x56E0;&#x6B64;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x9664;&#x4E86;&#x9700;&#x8981; <code>hello</code> &#x8FD9;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981; <code>hello.so</code> &#x8FD9;&#x4E2A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x3002;&#x5982;&#x679C;&#x9ED8;&#x8BA4;&#x7684; <code>LD_LIBRARY_PATH</code> &#x5305;&#x542B;&#x4E86;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x4E14; <code>hello.so</code> &#x5C31;&#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./hello</span><br><span class="line">Hello, world.</span><br></pre></td></tr></table></figure><p>&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x63D0;&#x793A;&#x627E;&#x4E0D;&#x5230; <code>hello.so</code>&#xFF0C;&#x5982;&#xFF1A;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dyld: Library not loaded: hello.so</span><br></pre></td></tr></table></figure><p>&#x90A3;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x6307;&#x5B9A; <code>LD_LIBRARY_PATH</code> &#x53D8;&#x91CF;&#xFF0C;&#x544A;&#x8BC9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5230;&#x54EA;&#x91CC;&#x53BB;&#x5BFB;&#x627E;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On Linux</span></span><br><span class="line">$ LD_LIBRARY_PATH=. ./hello</span><br><span class="line">Hello, world.</span><br><span class="line"></span><br><span class="line"><span class="comment"># On macOS</span></span><br><span class="line">$ DYLD_LIBRARY_PATH=. ./hello</span><br><span class="line">Hello, world.</span><br></pre></td></tr></table></figure><h3 id="wei-shi-me-hui-xu-yao-dong-tai-lian-jie"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF1F; <a href="#wei-shi-me-hui-xu-yao-dong-tai-lian-jie" class="header-anchor">#</a></h3><p>&#x4ECE;&#x5F00;&#x59CB;&#x4F7F;&#x7528; Go &#x6211;&#x4EEC;&#x5C31;&#x53CD;&#x53CD;&#x590D;&#x590D;&#x7684;&#x542C;&#x5230;&#x4EBA;&#x8BF4; Go &#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5982;&#x4F55;&#x65B9;&#x4FBF;&#xFF0C;&#x65E2;&#x7136;&#x5982;&#x6B64;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF1F;</p><p>&#x56E0;&#x4E3A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7531;&#x7A0B;&#x5E8F;&#x51B3;&#x5B9A;&#x52A0;&#x8F7D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x5378;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x8282;&#x7EA6;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x3002;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>{</span><br><span class="line">  <span class="keyword">void</span>* lib = dlopen(<span class="string">&quot;hello&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">void</span> (*fn)() = dlsym(lib, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!fn) {</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;no fn: %s\n&quot;</span>, dlerror());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  Calls Hello();</span></span><br><span class="line">  fn();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528; <code>dlopen()</code> &#x6765;&#x52A0;&#x8F7D;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x7528; <code>dlsym()</code> &#x6765;&#x52A0;&#x8F7D;&#x7B26;&#x53F7;&#xFF08;&#x51FD;&#x6570;&#xFF09;&#x5230;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x6307;&#x9488; <code>fn()</code>&#x3002;</p><h2 id="shared-go-de-dong-tai-lian-jie-ku"><a href="#shared-Go-&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;" class="headerlink" title="shared Go &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;"></a><code>shared</code> Go &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93; <a href="#shared-go-de-dong-tai-lian-jie-ku" class="header-anchor">#</a></h2><p><code>shared</code> &#x6A21;&#x5F0F;&#x548C; <code>c-shared</code> &#x6709;&#x4E9B;&#x76F8;&#x4F3C;&#xFF0C;&#x90FD;&#x662F;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A0;&#x8F7D;&#x3002;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F; <code>shared</code> &#x5E76;&#x975E;&#x6784;&#x5EFA; C &#x8BED;&#x8A00;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x800C;&#x662F;&#x4E13;&#x95E8;&#x4E3A; Go &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6784;&#x5EFA;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x3002;</p><blockquote><p>macOS &#x4E0B;&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301; <code>shared</code> &#x6A21;&#x5F0F;&#x3002;</p></blockquote><p>&#x8FD9;&#x6B21;&#x8FD8;&#x662F; <code>hello.go</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x7A0D;&#x6709;&#x4E0D;&#x540C;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A; <code>main()</code>&#xFF0C;&#x6267;&#x884C;&#x540E;&#x6253;&#x5370; <code>Hello, World</code>&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x50CF;&#x4EE5;&#x524D;&#x4E00;&#x6837;&#x7528; <code>exe</code> &#x6A21;&#x5F0F;&#x6784;&#x5EFA;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x7528;&#x4E00;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x6784;&#x5EFA;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go install -buildmode=shared std</span><br><span class="line">go build -linkshared hello.go</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x628A; Go &#x6807;&#x51C6;&#x5E93; <code>std</code> &#x6784;&#x5EFA;&#x5E76;&#x5B89;&#x88C5;&#x5230; <code>$GOPATH/pkg</code> &#x4E0B;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528; <code>-linkshared</code> &#x6765;&#x6784;&#x5EFA; <code>hello.go</code>&#x3002;</p><p>&#x6267;&#x884C;&#x7ED3;&#x679C;&#x548C;&#x524D;&#x9762;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x548C;&#x524D;&#x9762;&#x5F88;&#x4E0D;&#x540C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l hello</span><br><span class="line">-rwxr-xr-x 1 root root 16032 Oct  3 13:27 hello</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A; Hello World &#x7A0B;&#x5E8F;&#x53EA;&#x6709;&#x5341;&#x51E0;KB&#x5927;&#x5C0F;&#x3002;&#x5BF9;&#x4E8E; C &#x7A0B;&#x5E8F;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x6CA1;&#x5565;&#x60CA;&#x8BB6;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5C31;&#x5E94;&#x8BE5;&#x8FD9;&#x4E48;&#x5927;&#x554A;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E; Go &#x7A0B;&#x5E8F;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x5F88;&#x5947;&#x602A;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x822C;&#x4E0D;&#x90FD;&#x5F97; 7~8MB &#x4E48;&#xFF1F;</p><p>&#x5176;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x6240;&#x6709;&#x6807;&#x51C6;&#x5E93;&#x90E8;&#x5206;&#xFF0C;&#x90FD;&#x7528;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x529E;&#x6CD5;&#x6765;&#x8C03;&#x7528;&#xFF0C;&#x6784;&#x5EFA;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#x53EA;&#x5305;&#x542B;&#x4E86;&#x7A0B;&#x5E8F;&#x90E8;&#x5206;&#x3002;C &#x7A0B;&#x5E8F;&#x6784;&#x5EFA;&#x7684; Hello World &#x4E4B;&#x6240;&#x4EE5;&#x5C0F;&#xFF0C;&#x4E5F;&#x662F;&#x56E0;&#x4E3A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x539F;&#x56E0;&#x3002;</p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x67E5;&#x9605;&#x7A0B;&#x5E8F;&#x6240;&#x8C03;&#x7528;&#x7684;&#x5E93;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ldd hello</span><br><span class="line">        linux-vdso.so.1 (0x00007ffed3d4e000)</span><br><span class="line">        libstd.so =&gt; /usr/<span class="built_in">local</span>/go/pkg/linux_amd64_dynlink/libstd.so (0x00007f608c409000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f608c06a000)</span><br><span class="line">        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f608be66000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f608bc49000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f608e866000)</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8FDB;&#x4E00;&#x6B65;&#x53BB;&#x67E5;&#x770B; <code>libstd.so</code>&#xFF0C;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x5DE8;&#x5927;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x8FD9;&#x5C31;&#x662F; Go &#x7684;&#x6807;&#x51C6;&#x5E93;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 root root 37M Oct  3 13:27 /usr/<span class="built_in">local</span>/go/pkg/linux_amd64_dynlink/libstd.so</span><br></pre></td></tr></table></figure><p>&#x5F53;&#x7136;&#xFF0C;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x9700;&#x8981;&#x5F88;&#x591A;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x90FD;&#x9700;&#x8981;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x7248;&#x672C;&#x90FD;&#x5FC5;&#x987B;&#x517C;&#x5BB9;&#x7B49;&#x7B49;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4E0D;&#x5E38;&#x7528;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x3002;</p><h2 id="plugin-go-de-cha-jian"><a href="#plugin-Go-&#x7684;&#x63D2;&#x4EF6;" class="headerlink" title="plugin Go &#x7684;&#x63D2;&#x4EF6;"></a><code>plugin</code> Go &#x7684;&#x63D2;&#x4EF6; <a href="#plugin-go-de-cha-jian" class="header-anchor">#</a></h2><p>&#x63D2;&#x4EF6;&#x5F62;&#x5F0F;&#x548C; <code>c-shared</code>&#x3001;<code>shared</code> &#x76F8;&#x4F3C;&#xFF0C;&#x90FD;&#x662F;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x548C; <code>shared</code> &#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x662F;&#x6784;&#x5EFA;&#x4E00;&#x4E2A; Go &#x4E13;&#x7528;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x800C;&#x548C; <code>shared</code> &#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x5E76;&#x975E;&#x5728;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#x65F6;&#x52A0;&#x8F7D;&#xFF0C;&#x800C;&#x662F;&#x7531;&#x7A0B;&#x5E8F;&#x5185;&#x51B3;&#x5B9A;&#x4F55;&#x65F6;&#x52A0;&#x8F7D;&#x548C;&#x91CA;&#x653E;&#x3002;</p><blockquote><p>&#x8FD9;&#x662F;&#x4E2A;&#x65B0;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x610F;&#x5473;&#x7740;&#x53EF;&#x80FD;&#x4E0D;&#x80FD;&#x7528;&#x1F613;&#x2026;&#x2026;&#xFF0C;&#x5F53;&#x7136;&#x5982;&#x679C;&#x7528;&#x7684;&#x5BF9;&#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x3002;</p></blockquote><p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; plugin&#xFF0C;<code>myplugin.go</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">()</span></span> {</span><br><span class="line">  fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8FD9;&#x548C;&#x6700;&#x521D;&#x90A3;&#x4E2A;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x7684;&#x6027;&#x8D28;&#x76F8;&#x4F3C;&#x3002;&#x4E0D;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x65E2;&#x6CA1;&#x6709; <code>import &quot;C&quot;</code>&#xFF0C;&#x4E5F;&#x6CA1;&#x6709; <code>//export Hello</code>&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x6CA1;&#x6709; <code>func main()</code>&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x6211;&#x4EEC;&#x662F; Go &#x8C03;&#x7528; Go &#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x90FD;&#x7701;&#x4E86;&#x3002;</p><p>&#x8C03;&#x7528;&#x4EE3;&#x7801;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;plugin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"><span class="comment">//&#x52A0;&#x8F7D; myplugin &#x5E93;</span></span><br><span class="line">p, err := plugin.Open(<span class="string">&quot;myplugin.so&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">log.Fatal(err)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x53D6;&#x5F97; Hello &#x51FD;&#x6570;</span></span><br><span class="line">fn, err := p.Lookup(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">log.Fatal(err)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x8C03;&#x7528;&#x51FD;&#x6570;</span></span><br><span class="line">fn.(<span class="function"><span class="keyword">func</span><span class="params">()</span>)<span class="params">()</span></span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8FD9;&#x4E2A;&#x903B;&#x8F91;&#x4E0A;&#xFF0C;&#x548C; <code>hello-dyn.c</code> &#x5F88;&#x76F8;&#x4F3C;&#x3002;<code>plugin.Open()</code> &#x6709;&#x70B9;&#x513F;&#x50CF; <code>dlopen()</code>&#xFF1B;&#x800C; <code>p.Lookup()</code> &#x6709;&#x70B9;&#x513F;&#x50CF; <code>dlsym()</code>&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x7684;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x3002;</p><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>fn.(func())()</code>&#xFF0C;<code>p.Lookup()</code> &#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A; <code>interface{}</code>&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x8F6C;&#x578B;&#x4E3A;&#x5177;&#x4F53;&#x51FD;&#x6570;&#x7C7B;&#x578B;&#x3002;</p><p>&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6784;&#x5EFA;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go build -buildmode=plugin myplugin.go</span><br><span class="line">go build runplugin.go</span><br></pre></td></tr></table></figure><p>&#x524D;&#x8005;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A; <code>myplugin.so</code>&#xFF0C;&#x540E;&#x8005;&#x4F1A;&#x751F;&#x6210;&#x8C03;&#x7528;&#x8005; <code>runplugin</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 root root 3.8M Oct  3 13:58 myplugin.so</span><br><span class="line">-rwxr-xr-x 1 root root 3.5M Oct  3 13:58 runplugin</span><br></pre></td></tr></table></figure><h1 id="you-que-dian"><a href="#&#x4F18;&#x7F3A;&#x70B9;" class="headerlink" title="&#x4F18;&#x7F3A;&#x70B9;"></a>&#x4F18;&#x7F3A;&#x70B9; <a href="#you-que-dian" class="header-anchor">#</a></h1><ul><li><code>exe</code> (&#x9759;&#x6001;&#x7F16;&#x8BD1;)<ul><li>Pros:<ul><li>&#x5168;&#x90E8;&#x96C6;&#x6210;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x4F9D;&#x8D56;</li><li>&#x975E;&#x5E38;&#x9002;&#x5408;&#x8D85;&#x5C0F;&#x578B;&#x7684;&#x5BB9;&#x5668;&#x73AF;&#x5883;</li><li>&#x5F88;&#x5BB9;&#x6613;&#x8DE8;&#x4E0D;&#x540C; Linux &#x53D1;&#x884C;&#x7248;</li></ul></li></ul></li><li><code>exe</code> (&#x52A8;&#x6001;&#x94FE;&#x63A5; <code>libc</code>)<ul><li>Pros:<ul><li>&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7CFB;&#x7EDF;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982; DNS &#x67E5;&#x8BE2;&#x3002;</li><li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>libc</code> &#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#x3002;</li></ul></li><li>Cons:<ul><li>&#x4F9D;&#x8D56;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x6267;&#x884C;&#x73AF;&#x5883;</li></ul></li></ul></li><li><code>exe</code> (&#x52A8;&#x6001;&#x94FE;&#x63A5; <code>libc</code> &#x548C;&#x975E; Go &#x4EE3;&#x7801;)<ul><li>Pros:<ul><li>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; Go &#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x975E; Go &#x7684;&#x4EE3;&#x7801;</li><li>&#x65B9;&#x4FBF;&#x548C;&#x8001;&#x7684;&#x7CFB;&#x7EDF;&#x96C6;&#x6210;</li></ul></li><li>Cons:<ul><li>&#x6784;&#x5EFA;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;</li><li>C &#x4E0D;&#x662F; Go</li><li>&#x66F4;&#x5BB9;&#x6613;&#x51FA;&#x95EE;&#x9898;&#x3002;<ul><li>&#x6240;&#x6709; Go &#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x5730;&#x65B9;</li><li>&#x6240;&#x6709; C &#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;</li><li>&#x6240;&#x6709; Go <-> C &#x4E4B;&#x95F4;&#x901A;&#x8BAF;&#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;</-></li></ul></li></ul></li></ul></li><li><code>pie</code> &#x5730;&#x5740;&#x65E0;&#x5173;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF08;&#x5B89;&#x5168;&#x7279;&#x6027;&#xFF09;<ul><li>Pros:<ul><li>&#x548C; <code>exe</code> &#x4E00;&#x6837;</li><li>&#x8BA9;&#x7CFB;&#x7EDF;&#x66F4;&#x96BE;&#x653B;&#x51FB;</li></ul></li><li>Cons:<ul><li>&#x4E8C;&#x8FDB;&#x5236;&#x4F1A;&#x66F4;&#x5927;&#x4E00;&#x4E9B;(bug, will be fixed)</li><li>&#x5927;&#x7EA6;&#x4F1A;&#x6709; <code>~1%</code> &#x7684;&#x6027;&#x80FD;&#x635F;&#x5931;</li></ul></li></ul></li><li><code>c-archive</code> C &#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;<ul><li>Pros:<ul><li>&#x53EF;&#x4EE5;&#x8BA9; Go &#x96C6;&#x6210;&#x5230;&#x73B0;&#x6709;&#x7684; C &#x7A0B;&#x5E8F;&#x4E2D;</li><li>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x8FD9;&#x5C31;&#x662F; Go &#x5728; iOS &#x4E0A;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;</li><li>&#x975E;&#x5E38;&#x9002;&#x7528;&#x4E8E;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x975E; Go &#x73AF;&#x5883;&#x7684;&#x6784;&#x5EFA;</li></ul></li><li>Cons:<ul><li>&#x8DE8;&#x8BED;&#x8A00;&#x8C03;&#x7528;&#x4F1A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;</li></ul></li></ul></li><li><code>c-shared</code> C &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;<ul><li>Pros:<ul><li>&#x6BD4;&#x8F83;&#x65B9;&#x4FBF; Go &#x96C6;&#x6210;&#x8FDB;&#x73B0;&#x6709;&#x7684; C &#x7A0B;&#x5E8F;&#x4E2D;</li><li>&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A0;&#x8F7D;</li><li>&#x8FD9;&#x662F;&#x76EE;&#x524D; Go &#x5728; Android &#x4E0B;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#xFF08;Java &#x7684; <code>System.load()</code>&#xFF09;</li></ul></li><li>Cons:<ul><li>&#x8DE8;&#x8BED;&#x8A00;&#x8C03;&#x7528;&#x4F1A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;</li><li>&#x60F3;&#x60F3; Android &#x7684;&#x73AF;&#x5883;&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x9762;&#x79EF;&#x66F4;&#x5927;&#x4E86;&#xFF1A;<ul><li>Go &#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;</li><li>C &#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;</li><li>Java &#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;</li><li>&#x6240;&#x6709;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x901A;&#x8BAF;&#x53EF;&#x80FD;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;&#x2026;&#x2026;&#x1F631;</li></ul></li></ul></li></ul></li><li><code>shared</code> Go &#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;<ul><li>Pros:<ul><li>&#x591A;&#x4E2A;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x603B;&#x7684;&#x4F53;&#x79EF;&#x3002;</li><li>&#x4E00;&#x822C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5382;&#x5546;&#x4F1A;&#x6BD4;&#x8F83;&#x9752;&#x7750;&#x4E8E;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x4F53;&#x79EF;&#x964D;&#x4F4E;&#x3002;<ul><li>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x8FD9;&#x5C31;&#x662F; <strong>Canonical(Ubuntu)</strong> &#x529B;&#x63A8;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x5F0F;</li></ul></li><li>&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x4F53;&#x79EF;&#xFF0C;&#x4E0D;&#x8FC7;&#x73B0;&#x5728;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x4E00;&#x822C;&#x4E0D;&#x662F;&#x95EE;&#x9898;</li><li>&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5171;&#x4EAB;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x4EE3;&#x7801;(&#x5982;&#x679C;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x7684; loader &#x8DB3;&#x591F;&#x806A;&#x660E;&#x7684;&#x8BDD;)</li></ul></li><li>Cons:<ul><li>&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x3001;&#x4EE5;&#x53CA;&#x53D1;&#x5E03;&#x662F;&#x975E;&#x5E38;&#x96BE;&#x5F97;<ul><li>&#x4E0D;&#x8FC7;&#x4E00;&#x822C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5382;&#x5546;&#x5DF2;&#x7ECF;&#x6709;&#x6210;&#x719F;&#x7684;&#x53D1;&#x5E03;&#x7CFB;&#x7EDF;&#x4E86;</li></ul></li></ul></li></ul></li><li><code>plugin</code> Go &#x7684;&#x63D2;&#x4EF6;<ul><li>Pros:<ul><li>&#x5728;&#x8FD0;&#x884C;&#x65F6; Go &#x7A0B;&#x5E8F;&#x52A0;&#x8F7D;&#x5176;&#x5B83; Go &#x7A0B;&#x5E8F;</li><li>&#x5BF9;&#x4E8E;&#x590D;&#x6742;&#x5E94;&#x7528;&#x6765;&#x8BF4;&#xFF0C;&#x5141;&#x8BB8;&#x4E0D;&#x540C;&#x90E8;&#x5206;&#x5728;&#x4E0D;&#x540C;&#x65F6;&#x95F4;&#x6784;&#x5EFA;</li></ul></li><li>Cons:<ul><li>&#x6784;&#x5EFA;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x90E8;&#x7F72;&#x4E5F;&#x4F1A;&#x5F88;&#x590D;&#x6742;</li><li>&#x5982;&#x679C;&#x95EE;&#x6F14;&#x8BB2;&#x8005;&#x662F;&#x5426;&#x8BE5;&#x7528; <code>plugin</code> &#x6A21;&#x5F0F;&#xFF0C;&#x7B54;&#x6848;&#x4E00;&#x822C;&#x662F; <strong>No</strong>&#x3002;</li></ul></li></ul></li></ul><h1 id="wei-lai"><a href="#&#x672A;&#x6765;" class="headerlink" title="&#x672A;&#x6765;"></a>&#x672A;&#x6765; <a href="#wei-lai" class="header-anchor">#</a></h1><p>&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x5730;&#x65B9;&#x9700;&#x8981;&#x6539;&#x8FDB;&#x3002;</p><ul><li><code>c-shared</code>&#xFF1A;&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301; Windows&#xFF08;&#x53EF;&#x80FD;&#xFF09;&#xFF0C;macOS&#xFF08;&#x90E8;&#x5206;&#x652F;&#x6301;&#xFF09;</li><li><code>shared</code>&#xFF1A;&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301; macOS</li><li><code>plugin</code>&#xFF1A;&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301; macOS&#x3001;Windows</li><li><code>plugin</code>&#xFF1A;&#x6216;&#x8BB8;&#x53EF;&#x4EE5;&#x5C06; <code>runtime</code> &#x4ECE;&#x63D2;&#x4EF6;&#x4E2D;&#x79FB;&#x9664;&#x4EE5;&#x83B7;&#x5F97;&#x66F4;&#x5C0F;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2017" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2017/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Go 密码学应用 - George Tankersley</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-23-video-go-for-crypto-developers.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-23-video-go-for-crypto-developers.html</id>
    <published>2017-09-22T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.624Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a><ul><li><a href="#don-t-write-your-own-crypto">Don&#x2019;t write your own crypto</a></li><li><a href="#jing-chang-ting-dao-zhe-yang-de-jian-yi">&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x5EFA;&#x8BAE;</a><ul><li><a href="#tls">TLS</a></li><li><a href="#gpg">GPG</a></li></ul></li><li><a href="#zhe-ge-talk-bu-jiang-tls-he-gpg">&#x8FD9;&#x4E2A; Talk &#x4E0D;&#x8BB2; TLS &#x548C; GPG</a></li><li><a href="#zai-go-de-crypto-bao-li-de-suan-fa-ke-bu-du-shi-hao-de-suan-fa">&#x5728; Go &#x7684; crypto &#x5305;&#x91CC;&#x7684;&#x7B97;&#x6CD5;&#x53EF;&#x4E0D;&#x90FD;&#x662F;&#x597D;&#x7684;&#x7B97;&#x6CD5;</a><ul><li><a href="#jia-mi">&#x52A0;&#x5BC6;</a></li><li><a href="#ha-xi-san-lie">&#x54C8;&#x5E0C;&#x6563;&#x5217;</a></li><li><a href="#hash-mi-ma">Hash &#x5BC6;&#x7801;</a></li><li><a href="#qian-ming">&#x7B7E;&#x540D;</a></li></ul></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Go for Crypto Developers</strong><br>by George Tankersley<br>at GopherCon 2016</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/2r_KMzXB74w" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=2r_KMzXB74w" target="_blank" rel="noopener">https://www.youtube.com/watch?v=2r_KMzXB74w</a></p><p>&#x5E7B;&#x706F;&#x5730;&#x5740;&#xFF1A;<a href="https://speakerdeck.com/gtank/crypto-for-go-developers" target="_blank" rel="noopener">https://speakerdeck.com/gtank/crypto-for-go-developers</a><br>&#x4EE3;&#x7801;&#xFF1A;<a href="https://github.com/gtank/cryptopasta" target="_blank" rel="noopener">https://github.com/gtank/cryptopasta</a></p><h2 id="don-t-write-your-own-crypto"><a href="#Don&#x2019;t-write-your-own-crypto" class="headerlink" title="Don&#x2019;t write your own crypto"></a>Don&#x2019;t write your own crypto <a href="#don-t-write-your-own-crypto" class="header-anchor">#</a></h2><p>&#x5F88;&#x591A;&#x4EBA;&#x628A;&#x8FD9;&#x53E5;&#x8BDD;<em>&#x8BEF;&#x89E3;&#x4E3A;</em>&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x52A0;&#x5BC6;&#x3001;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x5BC6;&#x7801;&#x5B66;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x4E0D;&#x591F;&#x806A;&#x660E;&#x3002;<strong>No&#x3002;&#x5B8C;&#x5168;&#x4E0D;&#x662F;&#x8FD9;&#x4E2A;&#x610F;&#x601D;</strong>&#x3002;</p><p>&#x8FD9;&#x53E5;&#x8BDD;&#x662F;&#x8BF4;<strong>&#x4E0D;&#x8981;&#x8BD5;&#x56FE;&#x53BB;&#x53D1;&#x660E;&#x521B;&#x9020;&#x90A3;&#x4E9B;&#x52A0;&#x5BC6;&#x7C7B;&#x7684;&#x7B97;&#x6CD5;</strong>&#x3002;&#x56E0;&#x4E3A;&#x4F60;&#x4E0D;&#x5927;&#x53EF;&#x80FD;&#x4F1A;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x8D85;&#x8FC7; AES &#x7684;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x3001;&#x4E5F;&#x4E0D;&#x5927;&#x53EF;&#x80FD;&#x4F1A;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x6BD4; SHA &#x66F4;&#x597D;&#x7684; hash &#x7B97;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x81EA;&#x5DF1;&#x95ED;&#x95E8;&#x9020;&#x7684;&#x7B97;&#x6CD5;&#x4E00;&#x822C;&#x610F;&#x5473;&#x7740;&#x5B89;&#x5168;&#x6027;&#x7684;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x3002;</p><p>&#x5168;&#x4E16;&#x754C;&#x80FD;&#x5E72;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#x7684;&#x4EBA;&#x4E0D;&#x8D85;&#x8FC7;5&#x4E2A;&#xFF0C;&#x800C;&#x4E14;&#x4ED6;&#x4EEC;&#x4ECA;&#x5929;&#x90FD;&#x4E0D;&#x5728;&#x8FD9;&#x91CC;&#x3002;&#x53E6;&#x5916;&#x4E00;&#x534A;&#x90FD;&#x662F; <a href="https://en.wikipedia.org/wiki/Daniel_J._Bernstein" target="_blank" rel="noopener">Daniel J. Bernstein</a> &#x5E72;&#x7684;&#xFF08;&#x5F00;&#x4E2A;&#x73A9;&#x7B11;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x4EBA;&#x5F88;&#x725B;&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x5728;&#x7528;&#x7684;&#x5F88;&#x591A;&#x52A0;&#x5BC6;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x4ED6;&#x8BBE;&#x8BA1;&#x3001;&#x5B9E;&#x73B0;&#x7684;&#xFF09;&#x3002;</p><p>&#x8868;&#x9762;&#x4E0A;&#x597D;&#x50CF;&#x8FD9;&#x662F;&#x4E2A;&#x9650;&#x5236;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x662F;&#x4E2A;&#x4F18;&#x52BF;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;<strong>&#x4E0D;&#x9700;&#x8981;</strong>&#x7F16;&#x5199;&#x81EA;&#x5DF1;&#x7684;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x4E00;&#x5207;&#x75DB;&#x82E6;&#x7684;&#x5DE5;&#x4F5C;&#x90FD;&#x5DF2;&#x7ECF;&#x7531;&#x522B;&#x4EBA;&#x505A;&#x597D;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x548C;&#x642D;&#x79EF;&#x6728;&#x4E00;&#x6837;&#x53BB;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x5BC6;&#x7801;&#x5B66;&#x5DE5;&#x5177;&#x5C31;&#x597D;&#x4E86;&#x3002;</p><h2 id="jing-chang-ting-dao-zhe-yang-de-jian-yi"><a href="#&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x5EFA;&#x8BAE;" class="headerlink" title="&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x5EFA;&#x8BAE;"></a>&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x5EFA;&#x8BAE; <a href="#jing-chang-ting-dao-zhe-yang-de-jian-yi" class="header-anchor">#</a></h2><ul><li>&#x5BF9;&#x4F20;&#x8F93;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7528; TLS</li><li>&#x5BF9;&#x9759;&#x6B62;&#x7684;&#x6570;&#x636E;&#x7528; GPG</li></ul><h3 id="tls"><a href="#TLS" class="headerlink" title="TLS"></a>TLS <a href="#tls" class="header-anchor">#</a></h3><p>Go &#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x4F7F;&#x7528; TLS&#xFF0C;&#x56E0;&#x4E3A;&#x5FC5;&#x987B;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5185;&#x7F6E;&#x4E86;&#xFF0C;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x3002;</p><p>&#x5BA2;&#x6237;&#x7AEF;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> minimalTLSConfig = &amp;tls.Config{</span><br><span class="line">MinVersion: tls.VersionTLS12,</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> tlsTransport = &amp;http.Transport{</span><br><span class="line">TLSClientConfig: minimalTLSConfig,</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> httpClient = &amp;http.Client{</span><br><span class="line">Transport: tlsTransport,</span><br><span class="line">Timeout:   <span class="number">10</span> * time.Second,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MakeRequest</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">resp, err := httpClient.Get(<span class="string">&quot;https://www.google.com&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">}</span><br><span class="line"><span class="comment">// have fun</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F; <code>tls.VersionTLS12</code>&#xFF0C;&#x56E0;&#x4E3A;&#x4F4E;&#x4E8E; <code>1.2</code> &#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4; Go &#x4F7F;&#x7528;&#x4E00;&#x4E9B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x4F4E;&#x7248;&#x672C;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x9650;&#x5B9A; <code>1.2</code> &#x6BD4;&#x8F83;&#x5B89;&#x5168;&#x3002;&#x800C;&#x4E14;&#x5927;&#x90E8;&#x5206;&#x7F51;&#x7AD9;&#x4E5F;&#x90FD;&#x652F;&#x6301;&#x3002;</p><p>&#x670D;&#x52A1;&#x7AEF;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> minimalTLSConfig = &amp;tls.Config{</span><br><span class="line">MinVersion:               tls.VersionTLS12,</span><br><span class="line">PreferServerCipherSuites: <span class="literal">true</span>,</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> srv = &amp;http.Server{</span><br><span class="line">Addr:      <span class="string">&quot;localhost:8080&quot;</span>,</span><br><span class="line">TLSConfig: minimalTLSConfig,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleReq</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;Hello, world&quot;</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, handleReq)</span><br><span class="line">err := srv.ListenAndServeTLS(<span class="string">&quot;cert.pem&quot;</span>, <span class="string">&quot;key.pem&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">log.Fatal(err)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x6837;&#xFF0C;&#x9650;&#x5B9A;&#x6700;&#x5C0F;&#x7248;&#x672C;&#x662F; <code>1.2</code>&#xFF0C;&#x5E76;&#x4E14;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8981;&#x6C42;&#x4EE5;&#x670D;&#x52A1;&#x5668;&#x7684; Cipher &#x4F18;&#x5148;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x6309;&#x7167;&#x5BA2;&#x6237;&#x7AEF;&#x7ED9;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x800C;&#x662F;&#x6309;&#x7167;Go&#x670D;&#x52A1;&#x7AEF;&#x7ED9;&#x7684;&#x9009;&#x62E9;&#x3002;&#x56E0;&#x4E3A; Go &#x7684; TLS &#x5305;&#x4E2D;&#x6709;&#x5927;&#x91CF;&#x9488;&#x5BF9;&#x5404;&#x79CD;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x56E0;&#x6B64;&#x9009;&#x62E9;&#x52A0;&#x5BC6;&#x5305;&#x7684;&#x8BDD;&#xFF0C;&#x9075;&#x5FAA; Go &#x5185;&#x90E8;&#x7684;&#x51B3;&#x5B9A;&#x662F;&#x6700;&#x597D;&#x7684;&#x3002;</p><h3 id="gpg"><a href="#GPG" class="headerlink" title="GPG"></a>GPG <a href="#gpg" class="header-anchor">#</a></h3><p>GPG &#x662F;&#x4E3A;&#x4E86;&#x4EBA;&#x548C;&#x4EBA;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x6D41;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x673A;&#x5668;&#x548C;&#x673A;&#x5668;&#x4E4B;&#x95F4;&#x4EA4;&#x6D41;&#x4FE1;&#x606F;&#x7684;&#x3002;</p><p>&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x5B89;&#x5168;&#x7684;&#x4F7F;&#x7528; GPG &#x5462;&#xFF1F;&#x7B54;&#x6848;&#x5C31;&#x662F;<strong>&#x4E0D;&#x7528;GPG</strong>&#x3002;&#x56E0;&#x4E3A;&#x4F5C;&#x8005;&#x89C9;&#x5F97; GPG &#x592A;&#x8FC7;&#x9634;&#x8C0B;&#x8BBA;&#x4E86;&#xFF0C;&#x9677;&#x5165;&#x4E86;&#x5F88;&#x591A;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x8FC7;&#x591A;&#x6CE8;&#x610F;&#x7684;&#x533A;&#x57DF;&#xFF0C;&#x5373;&#x4F7F;&#x90A3;&#x4E48;&#x505A;&#x4E86;&#xFF0C;&#x4E5F;&#x4E0D;&#x89C1;&#x5F97;&#x66F4;&#x5B89;&#x5168;&#x3002;</p><h2 id="zhe-ge-talk-bu-jiang-tls-he-gpg"><a href="#&#x8FD9;&#x4E2A;-Talk-&#x4E0D;&#x8BB2;-TLS-&#x548C;-GPG" class="headerlink" title="&#x8FD9;&#x4E2A; Talk &#x4E0D;&#x8BB2; TLS &#x548C; GPG"></a>&#x8FD9;&#x4E2A; Talk &#x4E0D;&#x8BB2; TLS &#x548C; GPG <a href="#zhe-ge-talk-bu-jiang-tls-he-gpg" class="header-anchor">#</a></h2><p>&#x56E0;&#x4E3A;&#x5F53;&#x4F60;&#x5B9E;&#x73B0;&#x5B89;&#x5168;&#x7684;&#x4FE1;&#x606F;&#x7CFB;&#x7EDF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x7528;&#x5230;&#x8FD9;&#x4E24;&#x4E2A;&#x4E1C;&#x897F;&#x3002;TLS &#x548C; GPG &#x6709;&#x4ED6;&#x4EEC;&#x5E94;&#x7528;&#x7684;&#x573A;&#x5408;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x6BCF;&#x5929;&#x7684;&#x5BC6;&#x7801;&#x5B66;&#x5DE5;&#x4F5C;&#x6765;&#x8BF4;&#xFF0C;&#x57FA;&#x672C;&#x90FD;&#x4E0D;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x5DE5;&#x5177;&#xFF1A;</p><ul><li>&#x5BF9;&#x6587;&#x4EF6;&#x8BA1;&#x7B97;&#x6563;&#x5217;</li><li>&#x751F;&#x6210;&#x968F;&#x673A; ID</li><li>API &#x9A8C;&#x8BC1;</li><li>&#x7F51;&#x7AD9;&#x5BC6;&#x7801;&#x5B58;&#x50A8;</li><li>&#x7B7E;&#x540D;&#x3001;&#x52A0;&#x5BC6; cookies</li><li>JWT</li><li>&#x7B7E;&#x540D;&#x66F4;&#x65B0;</li></ul><h2 id="zai-go-de-crypto-bao-li-de-suan-fa-ke-bu-du-shi-hao-de-suan-fa"><a href="#&#x5728;-Go-&#x7684;-crypto-&#x5305;&#x91CC;&#x7684;&#x7B97;&#x6CD5;&#x53EF;&#x4E0D;&#x90FD;&#x662F;&#x597D;&#x7684;&#x7B97;&#x6CD5;" class="headerlink" title="&#x5728; Go &#x7684; crypto &#x5305;&#x91CC;&#x7684;&#x7B97;&#x6CD5;&#x53EF;&#x4E0D;&#x90FD;&#x662F;&#x597D;&#x7684;&#x7B97;&#x6CD5;"></a>&#x5728; Go &#x7684; crypto &#x5305;&#x91CC;&#x7684;&#x7B97;&#x6CD5;&#x53EF;&#x4E0D;&#x90FD;&#x662F;&#x597D;&#x7684;&#x7B97;&#x6CD5; <a href="#zai-go-de-crypto-bao-li-de-suan-fa-ke-bu-du-shi-hao-de-suan-fa" class="header-anchor">#</a></h2><h3 id="jia-mi"><a href="#&#x52A0;&#x5BC6;" class="headerlink" title="&#x52A0;&#x5BC6;"></a>&#x52A0;&#x5BC6; <a href="#jia-mi" class="header-anchor">#</a></h3><p>&#x4E0B;&#x5217;&#x5212;&#x6389;&#x7684;&#x7B97;&#x6CD5;&#x90FD;&#x4E0D;&#x5E94;&#x8BE5;&#x518D;&#x4F7F;&#x7528;&#x4E86;&#xFF1A;</p><ul><li><del>DES</del></li><li><del>3DES</del></li><li><del>RC4</del></li><li><del>TEA</del></li><li><del>XTEA</del></li><li><del>Blowfish</del></li><li>&#x2714;&#xFE0F; Twofish</li><li><del>CAST5</del></li><li>&#x2714;&#xFE0F; Salsa20</li><li>&#x2714;&#xFE0F; AES</li></ul><p>&#x53EA;&#x6709; <code>Twofish</code>&#x3001;<code>Salsa20</code> &#x548C; <code>AES</code> &#x8FD8;&#x7B97;&#x662F;&#x5B89;&#x5168;&#x7684;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x4F46;&#x662F; <code>AES</code> &#x5728;&#x5927;&#x90E8;&#x5206;&#x7684;&#x8BA1;&#x7B97;&#x673A;&#x4E0A;&#x90FD;&#x6709;&#x786C;&#x4EF6;&#x52A0;&#x901F;&#x3002;&#x56E0;&#x6B64;&#x53EA;&#x5269;&#x4E0B;&#x4E00;&#x4E2A; <code>AES</code> &#x662F;&#x6700;&#x4F73;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x3002;</p><h4 id="zen-me-shi-yong-aes"><a href="#&#x600E;&#x4E48;&#x4F7F;&#x7528;-AES" class="headerlink" title="&#x600E;&#x4E48;&#x4F7F;&#x7528; AES"></a>&#x600E;&#x4E48;&#x4F7F;&#x7528; AES <a href="#zen-me-shi-yong-aes" class="header-anchor">#</a></h4><p>&#x8981;&#x6CE8;&#x610F;&#xFF0C;<code>aesCipher.Encrypt()</code> <strong>&#x53EA;&#x4F1A;&#x52A0;&#x5BC6;&#x524D;16&#x4E2A;&#x5B57;&#x8282;</strong>&#x3002;&#x4E0D;&#x5C11;&#x4EBA;&#x6389;&#x5230;&#x8FD9;&#x4E2A;&#x5751;&#x91CC;&#x4E86;&#xFF0C;&#x7ED3;&#x679C;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x5565;&#x5C31;&#x524D;&#x51E0;&#x4E2A;&#x5B57;&#x7B26;&#x662F;&#x5BC6;&#x6587;&#xFF0C;&#x540E;&#x9762;&#x5168;&#x90FD;&#x662F;&#x660E;&#x6587;&#x3002;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;<strong>&#x4E0D;&#x76F4;&#x63A5;&#x7528;AES</strong>&#xFF0C;&#x901A;&#x8FC7; Mode &#x6765;&#x4F7F;&#x7528;&#x3002;</p><p>Block cipher mode &#x4E00;&#x6837;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x9009;&#x62E9;&#xFF1A;</p><ul><li><del>CBC</del></li><li><del>CFB</del></li><li><del>CTR</del></li><li><del>OFB</del></li><li>&#x2714;&#xFE0F; GCM</li></ul><p>&#x8FD9;&#x91CC;&#x53EA;&#x6709; <code>GCM</code> &#x662F;<strong>&#x9A8C;&#x8BC1;&#x7684;</strong>&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x56E0;&#x6B64;&#x522B;&#x7684;&#x90FD;&#x53EF;&#x4EE5;&#x4E0D;&#x9009;&#x3002;</p><h4 id="jia-mi"><a href="#&#x52A0;&#x5BC6;-1" class="headerlink" title="&#x52A0;&#x5BC6;"></a>&#x52A0;&#x5BC6; <a href="#jia-mi" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/aes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/cipher&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Encrypt</span><span class="params">(data []<span class="keyword">byte</span>, key [32]<span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> {</span><br><span class="line"><span class="comment">//&#x521D;&#x59CB;&#x5316; block cipher</span></span><br><span class="line">block, err := aes.NewCipher(key[:])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x8BBE;&#x7F6E; block cipher mode</span></span><br><span class="line">gcm, err := cipher.NewGCM(block)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x751F;&#x6210;&#x968F;&#x673A; nonce</span></span><br><span class="line">nonce := <span class="built_in">make</span>([]<span class="keyword">byte</span>, gcm.NonceSize())</span><br><span class="line">_, err = rand.Read(nonce)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x5C01;&#x88C5;&#x3001;&#x8FD4;&#x56DE;</span></span><br><span class="line"><span class="keyword">return</span> gcm.Seal(nonce, nonce, data, <span class="literal">nil</span>), <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="jie-mi"><a href="#&#x89E3;&#x5BC6;" class="headerlink" title="&#x89E3;&#x5BC6;"></a>&#x89E3;&#x5BC6; <a href="#jie-mi" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/aes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/cipher&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decrypt</span><span class="params">(ciphertext []<span class="keyword">byte</span>, key [32]<span class="keyword">byte</span>)</span> <span class="params">(plaintext []<span class="keyword">byte</span>, err error)</span></span> {</span><br><span class="line"><span class="comment">//&#x521D;&#x59CB;&#x5316; block cipher</span></span><br><span class="line">block, err := aes.NewCipher(key[:])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x8BBE;&#x7F6E; block cipher mode</span></span><br><span class="line">gcm, err := cipher.NewGCM(block)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x8FD4;&#x56DE;&#x89E3;&#x5F00;&#x7684;&#x5305;&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; nonce &#x662F;&#x76F4;&#x63A5;&#x53D6;&#x7684;&#x3002;</span></span><br><span class="line"><span class="keyword">return</span> gcm.Open(<span class="literal">nil</span>,</span><br><span class="line">ciphertext[:gcm.NonceSize()],</span><br><span class="line">ciphertext[gcm.NonceSize():],</span><br><span class="line"><span class="literal">nil</span>,</span><br><span class="line">)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="ha-xi-san-lie"><a href="#&#x54C8;&#x5E0C;&#x6563;&#x5217;" class="headerlink" title="&#x54C8;&#x5E0C;&#x6563;&#x5217;"></a>&#x54C8;&#x5E0C;&#x6563;&#x5217; <a href="#ha-xi-san-lie" class="header-anchor">#</a></h3><p>&#x5C06;&#x4E00;&#x5927;&#x6BB5;&#x6570;&#x636E;&#x4F7F;&#x7528; Hash &#x7B97;&#x6CD5;&#xFF0C;&#x5E0C;&#x671B;&#x5F97;&#x5230;&#x4E00;&#x4E32;&#x6570;&#x503C;&#xFF0C;&#x8FD9;&#x4E32;&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x53CD;&#x6620;&#x4F60;&#x7684;&#x8FD9;&#x6BB5;&#x6570;&#x636E;&#xFF0C;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x4E32;&#x6570;&#x503C;&#x90FD;&#x4E0D;&#x540C;&#x3002;&#x800C;&#x4E14;&#x5E0C;&#x671B;&#x65E0;&#x6CD5;&#x4ECE;&#x8FD9;&#x4E32;&#x6570;&#x503C;&#x53CD;&#x63A8;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x5BC6;&#x7801;&#x5B66; Hash &#x51FD;&#x6570;&#x8981;&#x4FDD;&#x8BC1;&#x7684;&#x3002;&#xFF08;<strong>&#x6CE8;&#x610F;&#xFF1A;&#x54C8;&#x5E0C;&#x4E0D;&#x7B49;&#x4E8E;&#x52A0;&#x5BC6;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x8FD9;&#x70B9;&#x5BB9;&#x6613;&#x641E;&#x6DF7;</strong>&#xFF09;</p><p>&#x540C;&#x6837; Hash &#x51FD;&#x6570;&#x4E00;&#x6837;&#x6709;&#x5F88;&#x591A;&#x9009;&#x62E9;&#xFF0C;&#x4E00;&#x6837;&#x662F;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x4E0D;&#x7528;&#xFF1A;</p><ul><li><del>MD4</del></li><li><del>MD5</del></li><li><del>RIPEMD160</del></li><li><del>SHA1</del></li><li>&#x2714;&#xFE0F; SHA2</li><li>&#x2714;&#xFE0F; SHA3</li></ul><p>&#x9009;&#x62E9; <code>SHA3</code> &#x5E76;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6BD4; <code>SHA2</code> &#x66F4;&#x65B0;&#x66F4;&#x597D;&#xFF0C;&#x800C;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x540C;&#x4E8E; <code>SHA1</code> &#x548C; <code>SHA2</code>&#x3002;&#x51E0;&#x5E74;&#x524D;&#x5BC6;&#x7801;&#x5B66;&#x5BB6;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x62C5;&#x5FC3;&#xFF0C;&#x56E0;&#x4E3A;MD<em>&#x4EE5;&#x53CA;SHA</em>&#x7684;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#x672C;&#x8D28;&#x592A;&#x76F8;&#x4F3C;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x4E00;&#x65E6;&#x8FD9;&#x4E2A;&#x4F9D;&#x8D56;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x4E2A;&#x4F53;&#x7CFB;&#x7684;&#x4E0D;&#x518D;&#x5B89;&#x5168;&#x3002;&#x56E0;&#x6B64;&#x5F00;&#x59CB;&#x5BFB;&#x627E;&#x4E00;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x7B97;&#x6CD5;&#x3002;&#x7ECF;&#x8FC7;&#x7ADE;&#x8D5B;&#x3001;&#x6311;&#x9009;&#xFF0C;&#x6700;&#x7EC8; <code>SHA3</code> &#x8131;&#x9896;&#x800C;&#x51FA;&#x3002;&#x4ED6;&#x672C;&#x8EAB;&#x662F;&#x4E2A;&#x5F88;&#x51FA;&#x8272;&#x7684; Hash &#x7B97;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x5176;&#x8BBE;&#x8BA1;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x8FD9;&#x51E0;&#x4E2A;&#x7B97;&#x6CD5;&#x5B8C;&#x5168;&#x4E0D;&#x4E00;&#x6837;&#x3002;</p><p>&#x4F46;&#x662F;&#x7531;&#x4E8E; <code>SHA3</code> &#x5E76;&#x4E0D;&#x88AB;&#x5E7F;&#x6CDB;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x660E;&#x786E;&#x77E5;&#x9053;&#x4F60;&#x53EF;&#x4EE5;&#x7528; <code>SHA3</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x7528; <code>SHA3</code>&#x3002;&#x5176;&#x5B83;&#x60C5;&#x51B5;&#x7528; <code>SHA2</code>&#x3002;</p><p>&#x4F46;&#x662F;&#x548C;&#x52A0;&#x5BC6;&#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x4E0D;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; Hash &#x7B97;&#x6CD5;</strong>&#x3002;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x4F1A;&#x9762;&#x4E34;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x653B;&#x51FB;&#xFF1A;</p><ul><li>Length extension</li><li>Rainbow tables</li><li>Small number of possibilities (phone numbers)</li><li>Salt? Peper?</li></ul><blockquote><p>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>HMAC</code>&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x7528; Hash</p></blockquote><h4 id="shi-xian-hash"><a href="#&#x5B9E;&#x73B0;-Hash" class="headerlink" title="&#x5B9E;&#x73B0; Hash"></a>&#x5B9E;&#x73B0; Hash <a href="#shi-xian-hash" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/hmac&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha512&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hash</span><span class="params">(tag <span class="keyword">string</span>, data []<span class="keyword">byte</span>)</span> []<span class="title">byte</span></span> {</span><br><span class="line">h := hmac.New(sha512.New512_256, []<span class="keyword">byte</span>(tag))</span><br><span class="line">h.Write(data)</span><br><span class="line"><span class="keyword">return</span> h.Sum(<span class="literal">nil</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleHash</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">tag := <span class="string">&quot;hashing file for storage key&quot;</span></span><br><span class="line">contents, err := ioutil.ReadFile(<span class="string">&quot;testfile&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> error</span><br><span class="line">}</span><br><span class="line">digest := Hash(tag, contents)</span><br><span class="line">fmt.Println(hex.EncodeToString(digest))</span><br><span class="line">}</span><br><span class="line"><span class="comment">//Output:</span></span><br><span class="line"><span class="comment">//9f4c795d8ae5e207f19184ccebee6a606c1fdfe509c793614006d613580f03e1</span></span><br></pre></td></tr></table></figure><h3 id="hash-mi-ma"><a href="#Hash-&#x5BC6;&#x7801;" class="headerlink" title="Hash &#x5BC6;&#x7801;"></a>Hash &#x5BC6;&#x7801; <a href="#hash-mi-ma" class="header-anchor">#</a></h3><p>&#x4E00;&#x822C;&#x4E1C;&#x897F;&#x7684; Hash &#x7528;&#x521A;&#x624D;&#x7684;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x4F46;&#x662F;<strong>&#x9664;&#x4E86;&#x5BC6;&#x7801;Hash</strong>&#x3002;&#x5BC6;&#x7801; Hash &#x548C;&#x6570;&#x636E; Hash &#x7684;&#x7279;&#x5F81;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x3002;</p><ul><li><strong>&#x6570;&#x636E;</strong> Hash &#x5E0C;&#x671B;&#x7684;&#x662F; Hash &#x7B97;&#x6CD5;<strong>&#x8D8A;&#x5FEB;&#x8D8A;&#x597D;</strong></li><li>&#x800C;<strong>&#x5BC6;&#x7801;</strong> Hash &#x5219;&#x5E0C;&#x671B; Hash &#x7B97;&#x6CD5;<strong>&#x8D8A;&#x6162;&#x8D8A;&#x597D;</strong></li></ul><blockquote><p>&#x8FC7;&#x5FEB;&#x7684;&#x5BC6;&#x7801;&#x54C8;&#x5E0C;&#x4F1A;&#x5BFC;&#x81F4;&#x66B4;&#x529B;&#x7834;&#x89E3;&#x7684;&#x6210;&#x672C;&#x964D;&#x4F4E;&#x3002;&#x56E0;&#x6B64;&#x5BC6;&#x7801;&#x54C8;&#x5E0C;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x7B97;&#x6CD5;&#x3002;</p></blockquote><h4 id="shi-yong-bcrypt"><a href="#&#x4F7F;&#x7528;-bcrypt" class="headerlink" title="&#x4F7F;&#x7528; bcrypt"></a>&#x4F7F;&#x7528; bcrypt <a href="#shi-yong-bcrypt" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;golang.org/x/crypto/bcrypt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HashPassword</span><span class="params">(password []<span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> {</span><br><span class="line"><span class="keyword">return</span> bcrypt.GenerateFromPassword(password, <span class="number">14</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckPasswordHash</span><span class="params">(hash, password []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> {</span><br><span class="line"><span class="keyword">return</span> bcrypt.CompareHashAndPassword(hash, password)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Example</span><span class="params">()</span></span> {</span><br><span class="line">myPassword := []<span class="keyword">byte</span>(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">hashed, err := HashPassword(myPassword)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(hashed))</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>14</code> &#x662F;&#x8BA1;&#x7B97;&#x91CF;&#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;<code>14</code> &#x662F;&#x4E2A;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x89C9;&#x5F97;&#x6027;&#x80FD;&#x65E0;&#x6CD5;&#x63A5;&#x53D7;&#xFF0C;&#x53EF;&#x4EE5;&#x964D;&#x5230; <code>12</code>&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x8981;&#x518D;&#x4F4E;&#x4E86;&#x3002;</p><h3 id="qian-ming"><a href="#&#x7B7E;&#x540D;" class="headerlink" title="&#x7B7E;&#x540D;"></a>&#x7B7E;&#x540D; <a href="#qian-ming" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#x662F;&#x6709;&#x4E00;&#x5BF9;&#x5BC6;&#x94A5;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x516C;&#x94A5;&#x3001;&#x4E00;&#x4E2A;&#x662F;&#x79C1;&#x94A5;&#x3002;&#x4EFB;&#x4F55;&#x62E5;&#x6709;&#x79C1;&#x94A5;&#x7684;&#x4EBA;&#x53EF;&#x4EE5;&#x5BF9;&#x4E00;&#x6BB5;&#x4FE1;&#x606F;&#x7B7E;&#x540D;&#xFF0C;&#x800C;&#x6240;&#x6709;&#x62E5;&#x6709;&#x516C;&#x94A5;&#x7684;&#x4EBA;&#x90FD;&#x53EF;&#x4EE5;&#x6765;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E2A;&#x6D88;&#x606F;&#x786E;&#x5B9E;&#x662F;&#x7531;&#x90A3;&#x4E2A;&#x4EBA;&#x7B7E;&#x540D;&#x7684;&#x3002;</p><p>&#x901A;&#x8FC7;&#x7B7E;&#x540D;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;</p><ul><li>&#x6D88;&#x606F;&#x672A;&#x66FE;&#x88AB;&#x7BE1;&#x6539;</li><li>&#x662F;&#x8C01;&#x53D1;&#x51FA;&#x7684;&#x8FD9;&#x4E2A;&#x6D88;&#x606F;</li></ul><p>&#x548C;&#x524D;&#x9762;&#x4E00;&#x6837;&#xFF0C;Go &#x6709;&#x5F88;&#x591A;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#xFF1A;</p><ul><li>RSA<ul><li><del>PKCS1v15</del></li><li>PSS</li></ul></li><li>ECDSA<ul><li>&#x2714;&#xFE0F; P256</li><li><del>P385</del></li><li><del>P521</del></li></ul></li><li>Ed25519</li></ul><p>&#x8FD9;&#x6B21;&#x548C;&#x524D;&#x9762;&#x4E0D;&#x540C;&#xFF0C;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;&#x7684;&#x5B89;&#x5168;&#x66F4;&#x591A;&#x7684;<em>&#x4E0D;&#x662F;&#x53D6;&#x51B3;&#x4E8E;&#x7B97;&#x6CD5;&#x9009;&#x62E9;&#xFF0C;&#x800C;&#x662F;&#x53D6;&#x51B3;&#x4E8E;&#x4F60;&#x662F;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x7684;</em>&#x3002;</p><p>&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x6BD4;&#x8F83;&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>ECDSA/P256</code>&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5F53;&#x521D; PS3 &#x88AB;&#x9ED1;&#xFF0C;&#x88AB;&#x89E3;&#x51FA;&#x79C1;&#x94A5;&#x5C31;&#x662F;&#x7528;&#x7684;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#xFF0C;&#x5F53;&#x65F6;&#x662F;&#x7531;&#x4E8E;&#x90A3;&#x4E2A;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x662F;&#x975E;&#x5E38;&#x70C2;&#x7684;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F; Go &#x6CA1;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x76F8;&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#xFF0C;Go &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x6BD4;&#x8F83;&#x5B89;&#x5168;&#x7684;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;&#x3002;</p><h4 id="shi-xian"><a href="#&#x5B9E;&#x73B0;" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0; <a href="#shi-xian" class="header-anchor">#</a></h4><p>&#x751F;&#x6210;&#x5BC6;&#x94A5;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/ecdsa&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/elliptic&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSigningKey</span><span class="params">()</span> <span class="params">(*ecdsa.PrivateKey, error)</span></span> {</span><br><span class="line"><span class="keyword">return</span> ecdsa.GenerateKey(elliptic.P256(), rand.Reader)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7B7E;&#x540D;&#x6570;&#x636E;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sign</span><span class="params">(data []<span class="keyword">byte</span>, priv *ecdsa.PrivateKey)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> {</span><br><span class="line">digest := sha256.Sum256(data)</span><br><span class="line">r, s, err := ecdsa.Sign(rand.Reader, priv, digest[:])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="comment">//encode the signature {R, S}</span></span><br><span class="line">params := priv.Curve.Params()</span><br><span class="line">curveByteSize := params.P.BitLen() / <span class="number">8</span></span><br><span class="line">rBytes, sBytes := r.Bytes(), s.Bytes()</span><br><span class="line">signature := <span class="built_in">make</span>([]<span class="keyword">byte</span>, curveByteSize * <span class="number">2</span>)</span><br><span class="line"><span class="built_in">copy</span>(signature[curveByteSize - <span class="built_in">len</span>(rBytes):], rBytes)</span><br><span class="line"><span class="built_in">copy</span>(signature[curveByteSize*<span class="number">2</span> - <span class="built_in">len</span>(sBytes):], sBytes)</span><br><span class="line"><span class="keyword">return</span> signature, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x9A8C;&#x8BC1;&#x7B7E;&#x540D;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/ecdsa&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha256&quot;</span></span><br><span class="line"><span class="string">&quot;math/big&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x9A8C;&#x8BC1;&#x6210;&#x529F;&#x8FD4;&#x56DE; true&#xFF0C;&#x5426;&#x5219; false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Verify</span><span class="params">(data, sig []<span class="keyword">byte</span>, pub *ecdsa.PublicKey)</span> <span class="title">bool</span></span> {</span><br><span class="line">digest := sha256.Sum256(data)</span><br><span class="line">curveByteSize := pub.Curve.Params().P.BitLen() / <span class="number">8</span></span><br><span class="line">r, s := <span class="built_in">new</span>(big.Int), <span class="built_in">new</span>(big.Int)</span><br><span class="line">r.SetBytes(signature[:curveByteSize])</span><br><span class="line">s.SetBytes(signature[curveByteSize:])</span><br><span class="line"><span class="keyword">return</span> ecdsa.Verify(pub, digest[:], r, s)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2016" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2016/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Go 抓包、分析、注入 - John Leon</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-23-video-packet-capture-analysis-with-go.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-23-video-packet-capture-analysis-with-go.html</id>
    <published>2017-09-22T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.624Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a><ul><li><a href="#shi-me-shi-zhua-bao">&#x4EC0;&#x4E48;&#x662F;&#x6293;&#x5305;</a></li><li><a href="#ru-he-ying-yong">&#x5982;&#x4F55;&#x5E94;&#x7528;</a></li><li><a href="#yan-jiang-zhe-yan-jiu-zhua-bao-de-dong-ji">&#x6F14;&#x8BB2;&#x8005;&#x7814;&#x7A76;&#x6293;&#x5305;&#x7684;&#x52A8;&#x673A;</a></li><li><a href="#hua-ti-gai-kuang">&#x8BDD;&#x9898;&#x6982;&#x51B5;</a></li><li><a href="#chang-yong-gong-ju">&#x5E38;&#x7528;&#x5DE5;&#x5177;</a></li><li><a href="#ben-jiang-zuo-de-xu-qiu">&#x672C;&#x8BB2;&#x5EA7;&#x7684;&#x9700;&#x6C42;</a><ul><li><a href="#gopacket">gopacket</a></li></ul></li><li><a href="#dai-ma-yan-shi">&#x4EE3;&#x7801;&#x6F14;&#x793A;</a><ul><li><a href="#huo-qu-pcap-ban-ben-ji-wang-qia-lie-biao">&#x83B7;&#x53D6; pcap &#x7248;&#x672C;&#x53CA;&#x7F51;&#x5361;&#x5217;&#x8868;</a></li><li><a href="#da-kai-wang-luo-jie-kou">&#x6253;&#x5F00;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;</a></li><li><a href="#da-kai-bu-huo-de-wen-jian">&#x6253;&#x5F00;&#x6355;&#x83B7;&#x7684;&#x6587;&#x4EF6;</a></li><li><a href="#jian-li-packet-source">&#x5EFA;&#x7ACB; packet source</a></li><li><a href="#cong-packet-source-du-qu-zhua-de-bao">&#x4ECE; packet source &#x8BFB;&#x53D6;&#x6293;&#x7684;&#x5305;</a></li><li><a href="#guo-lu">&#x8FC7;&#x6EE4;</a></li><li><a href="#jiang-bu-huo-dao-de-bao-bao-cun-dao-wen-jian">&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6587;&#x4EF6;</a></li><li><a href="#jie-xi-bao">&#x89E3;&#x6790;&#x5305;</a></li><li><a href="#zi-ding-yi-bao-jie-gou">&#x81EA;&#x5B9A;&#x4E49;&#x5305;&#x7ED3;&#x6784;</a></li><li><a href="#gou-zao-bao">&#x6784;&#x9020;&#x5305;</a></li><li><a href="#fa-song-gou-zao-hao-de-bao">&#x53D1;&#x9001;&#x6784;&#x9020;&#x597D;&#x7684;&#x5305;</a></li><li><a href="#liu-he-endpoint">&#x6D41;&#x548C; Endpoint</a></li></ul></li><li><a href="#qian-zai-de-ying-yong">&#x6F5C;&#x5728;&#x7684;&#x5E94;&#x7528;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Packet Capture, Analysis, and Injection with Go</strong><br>by John Leon<br>at GopherCon 2016</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/APDnbmTKjgM" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=APDnbmTKjgM" target="_blank" rel="noopener">https://www.youtube.com/watch?v=APDnbmTKjgM</a></p><p>&#x4EE3;&#x7801;&#xFF1A;<a href="https://github.com/gophercon/2016-talks/tree/master/JohnLeon-PacketCapturingWithGo" target="_blank" rel="noopener">https://github.com/gophercon/2016-talks/tree/master/JohnLeon-PacketCapturingWithGo</a><br>&#x535A;&#x6587;&#xFF1A;<a href="http://www.devdungeon.com/content/packet-capture-injection-and-analysis-gopacket" target="_blank" rel="noopener">http://www.devdungeon.com/content/packet-capture-injection-and-analysis-gopacket</a></p><h2 id="shi-me-shi-zhua-bao"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x6293;&#x5305;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x6293;&#x5305;"></a>&#x4EC0;&#x4E48;&#x662F;&#x6293;&#x5305; <a href="#shi-me-shi-zhua-bao" class="header-anchor">#</a></h2><p>&#x6293;&#x5305;&#x662F;&#x5206;&#x6790;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x6D41;&#x91CF;&#x3002;</p><p>&#x6709;&#x7EBF;&#x7F51;&#x7EDC;&#x548C;&#x65E0;&#x7EBF;&#x7F51;&#x7EDC;&#x4E0D;&#x540C;</p><p>&#x6709;&#x7EBF;&#x7F51;&#x7EDC;&#x4F1A;&#x7531;&#x4EA4;&#x6362;&#x673A;&#x6839;&#x636E; MAC &#x5730;&#x5740;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x5C06;&#x5305;&#x8F6C;&#x53D1;&#x7ED9;&#x4F60;&#xFF0C;&#x548C;&#x4F60;&#x65E0;&#x5173;&#x7684;&#x5305;&#x662F;&#x4E0D;&#x4F1A;&#x8F6C;&#x53D1;&#x7ED9;&#x4F60;&#xFF0C;&#x9664;&#x975E;&#x7528;&#x7684;&#x4E0D;&#x662F;&#x4EA4;&#x6362;&#x673A;&#x800C;&#x662F;&#x53E4;&#x8463;&#x7684; Hub&#x3002;&#x800C;&#x65E0;&#x7EBF;&#x7F51;&#x7EDC;&#x5C31;&#x5F88;&#x5F00;&#x653E;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5305;&#x90FD;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x53D1;&#x7ED9;&#x8C01;&#xFF0C;&#x56E0;&#x6B64;&#x4F60;&#x662F;&#x53EF;&#x4EE5;&#x542C;&#x5230;&#x6240;&#x6709;&#x7684;&#x5305;&#x7684;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E3A;&#x6DF7;&#x6DC6;&#x6A21;&#x5F0F;&#xFF0C;&#x4E0D;&#x7136;&#x672C;&#x5730;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x4F1A;&#x8FC7;&#x6EE4;&#x6389;&#x4E0D;&#x662F;&#x7ED9;&#x81EA;&#x5DF1;&#x7684;&#x5305;&#x3002;</p><p>&#x6293;&#x5305;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5176;&#x5B83;&#x901A;&#x8BAF;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x88AB;&#x52A8;&#x76D1;&#x542C;&#xFF0C;&#x4E0D;&#x662F;&#x4E2D;&#x95F4;&#x4EBA;&#x7684;&#x5E72;&#x6270;&#x3002;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x6293;&#x5305;&#x6765;&#x505A;&#x4E00;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;&#x6BD4;&#x5982;&#x53BB;&#x5E74;&#x53C2;&#x52A0; <a href="https://www.defcon.org/html/defcon-23/dc-23-index.html" target="_blank" rel="noopener">DefCon</a> &#x7684;&#x65F6;&#x5019;&#xFF0C;John &#x8EAB;&#x8FB9;&#x7684;&#x51E0;&#x4E2A;&#x4FC4;&#x7F57;&#x65AF;&#x7684;&#x4E0E;&#x4F1A;&#x8005;&#xFF0C;&#x5C31;&#x5199;&#x4E86;&#x4E2A;&#x4E1C;&#x897F;&#x6293;&#x5305;&#x76D1;&#x542C;&#x3002;&#x51E1;&#x662F;&#x542C;&#x5230; HTTP &#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x62A2;&#x5148;&#x4E00;&#x6B65;&#x6A21;&#x62DF; HTTP &#x54CD;&#x5E94;&#xFF0C;&#x8BA9;&#x8BBF;&#x95EE;&#x8005;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x67D0;&#x4E2A;<a href="https://zh.wikipedia.org/wiki/NSFW" target="_blank" rel="noopener">NSFW(&#x8272;&#x60C5;&#x7F51;&#x7AD9;)</a>&#x4E0A;&#x53BB;&#x4E86;&#x3002;</p><h2 id="ru-he-ying-yong"><a href="#&#x5982;&#x4F55;&#x5E94;&#x7528;" class="headerlink" title="&#x5982;&#x4F55;&#x5E94;&#x7528;"></a>&#x5982;&#x4F55;&#x5E94;&#x7528; <a href="#ru-he-ying-yong" class="header-anchor">#</a></h2><ul><li>&#x5E94;&#x7528;&#x5F00;&#x53D1;&#xFF1A;&#x6D4B;&#x8BD5;&#x3001;&#x9A8C;&#x8BC1;&#x52A0;&#x5BC6;</li><li>&#x5BF9; API &#x8FDB;&#x884C;&#x9006;&#x5411;&#x5DE5;&#x7A0B;</li><li>&#x89C2;&#x5BDF;&#x80CC;&#x666F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x6D41;&#x91CF;</li><li>&#x5077;&#x53D6;&#x767B;&#x5F55;&#x4FE1;&#x606F;</li><li>&#x7F51;&#x7EDC;&#x7BA1;&#x7406;</li><li>&#x67E5;&#x770B;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x6076;&#x610F;&#x7684;&#x6D41;&#x91CF;&#xFF08;&#x6BD4;&#x5982;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x4EBA;&#x5728;&#x626B;&#x63CF;&#x4F60;&#x7684;&#x7AEF;&#x53E3;&#xFF09;</li><li>&#x5BF9;&#x72AF;&#x7F6A;&#x73B0;&#x573A;&#x8FDB;&#x884C;&#x8C03;&#x67E5;</li><li>DefCon &#x7684;&#x4E00;&#x4E2A; <a href="https://www.wallofsheep.com/pages/wall-of-sheep" target="_blank" rel="noopener">Wall of Sheep</a></li></ul><h2 id="yan-jiang-zhe-yan-jiu-zhua-bao-de-dong-ji"><a href="#&#x6F14;&#x8BB2;&#x8005;&#x7814;&#x7A76;&#x6293;&#x5305;&#x7684;&#x52A8;&#x673A;" class="headerlink" title="&#x6F14;&#x8BB2;&#x8005;&#x7814;&#x7A76;&#x6293;&#x5305;&#x7684;&#x52A8;&#x673A;"></a>&#x6F14;&#x8BB2;&#x8005;&#x7814;&#x7A76;&#x6293;&#x5305;&#x7684;&#x52A8;&#x673A; <a href="#yan-jiang-zhe-yan-jiu-zhua-bao-de-dong-ji" class="header-anchor">#</a></h2><ul><li>Hacker by nature&#xFF0C;&#x5C31;&#x50CF; Richard Stallman &#x8BF4;&#x7684;&#xFF0C;&#x4F60;&#x4E0D;&#x505A;&#x4E00;&#x904D;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x4F60;&#x5C31;&#x65E0;&#x6CD5;&#x7406;&#x89E3;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x3002;</li><li>&#x603B;&#x559C;&#x6B22;&#x77E5;&#x9053;&#x5B9E;&#x7269;&#x7684;&#x5185;&#x90E8;&#x662F;&#x600E;&#x4E48;&#x5DE5;&#x4F5C;&#x7684;</li><li>&#x9A8C;&#x8BC1;&#x5B9E;&#x9645;&#x7684;&#x8BA4;&#x8BC1;&#x673A;&#x5236;&#x662F;&#x5426;&#x771F;&#x7684;&#x52A0;&#x5BC6;&#x4E86;</li><li>&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6CA1;&#x6709;&#x6076;&#x610F;&#x6D41;&#x91CF;</li><li>&#x7406;&#x89E3;&#x5F00;&#x653E; WiFi &#x7684;&#x6D41;&#x91CF;&#x662F;&#x5426;&#x5B89;&#x5168;</li><li>&#x5077;&#x767B;&#x5F55;&#x4FE1;&#x606F;&#xFF08;&#x5F53;&#x7136;&#xFF0C;&#x5408;&#x6CD5;&#x7684;&#x5077;&#xFF0C;&#x6BD4;&#x5982;&#x5B89;&#x5168;&#x5BA1;&#x8BA1;&#xFF09;<ul><li>Facebook &#x5F88;&#x957F;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x90FD;&#x4E0D;&#x7528; SSL</li><li><a href="https://www.okcupid.com/" target="_blank" rel="noopener">OKCupid</a> &#x4E5F;&#x4E00;&#x6837;</li><li><a href="https://httpshaming.tumblr.com" target="_blank" rel="noopener">https://httpshaming.tumblr.com</a></li></ul></li></ul><h2 id="hua-ti-gai-kuang"><a href="#&#x8BDD;&#x9898;&#x6982;&#x51B5;" class="headerlink" title="&#x8BDD;&#x9898;&#x6982;&#x51B5;"></a>&#x8BDD;&#x9898;&#x6982;&#x51B5; <a href="#hua-ti-gai-kuang" class="header-anchor">#</a></h2><ul><li>&#x83B7;&#x5F97;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x5217;&#x8868;</li><li>&#x4ECE;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x6293;&#x5305;</li><li>&#x4FDD;&#x5B58;&#x83B7;&#x5F97;&#x7684;&#x5305;&#x5230;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;</li><li>&#x4ECE;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5305;</li><li>&#x5206;&#x5C42;&#x5206;&#x6790;&#x5305;&#x7ED3;&#x6784;</li><li>&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5C42;</li><li>&#x4F7F;&#x7528; BPF &#x8FC7;&#x6EE4;</li><li>&#x6CE8;&#x5165;&#x5305;&#xFF08;&#x53D1;&#x9001;&#x5305;&#xFF09;</li><li>&#x89C2;&#x5BDF;&#x6D41;</li></ul><h2 id="chang-yong-gong-ju"><a href="#&#x5E38;&#x7528;&#x5DE5;&#x5177;" class="headerlink" title="&#x5E38;&#x7528;&#x5DE5;&#x5177;"></a>&#x5E38;&#x7528;&#x5DE5;&#x5177; <a href="#chang-yong-gong-ju" class="header-anchor">#</a></h2><ul><li><a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a>/<a href="https://www.wireshark.org/docs/man-pages/tshark.html" target="_blank" rel="noopener">tshark</a>&#xFF1A;&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x5927;&#x5BB6;&#x90FD;&#x7528;&#x8FC7;&#x7684;</li><li><a href="https://en.wikipedia.org/wiki/Tcpdump" target="_blank" rel="noopener">tcpdump</a>: &#x4E00;&#x4E9B; Linux &#x4E0B;&#x547D;&#x4EE4;&#x884C;&#x64CD;&#x4F5C;&#x7684;&#x4EBA;&#x5E94;&#x8BE5;&#x7528;&#x8FC7;</li><li><a href="http://www.ex-parrot.com/~chris/driftnet/" target="_blank" rel="noopener">Driftnet</a>: &#x53EA;&#x5173;&#x5FC3;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x4E2D;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x4F1A;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x663E;&#x793A;&#x6240;&#x6709;&#x6D41;&#x91CF;&#x91CC;&#x7684;&#x56FE;&#x7247;&#x2026;&#x2026;&#x1F613;</li><li><a href="https://en.wikipedia.org/wiki/Firesheep" target="_blank" rel="noopener">Firesheep</a>: Firefox &#x63D2;&#x4EF6;&#x7528;&#x4E8E;&#x622A;&#x83B7;&#x3001;&#x5206;&#x6790;&#x3001;&#x63D2;&#x5165; http &#x6D41;&#x91CF;&#x6BD4;&#x5982; cookie &#x4E4B;&#x7C7B;&#x4E1C;&#x897F;&#x7684;&#x3002;</li></ul><h2 id="ben-jiang-zuo-de-xu-qiu"><a href="#&#x672C;&#x8BB2;&#x5EA7;&#x7684;&#x9700;&#x6C42;" class="headerlink" title="&#x672C;&#x8BB2;&#x5EA7;&#x7684;&#x9700;&#x6C42;"></a>&#x672C;&#x8BB2;&#x5EA7;&#x7684;&#x9700;&#x6C42; <a href="#ben-jiang-zuo-de-xu-qiu" class="header-anchor">#</a></h2><ul><li><a href="https://en.wikipedia.org/wiki/Pcap" target="_blank" rel="noopener">libpcap or WinPcap</a><ul><li><a href="http://www.tcpdump.org/manpages/pcap.3pcap.html" target="_blank" rel="noopener">libpcap</a> &#x662F;&#x4E00;&#x4E2A; C &#x5E93;&#xFF0C;&#x6E90;&#x81EA; tcpdump</li><li><a href="https://www.winpcap.org" target="_blank" rel="noopener">WinPcap</a> &#x76F8;&#x5F53;&#x4E8E;&#x662F; libpcap &#x79FB;&#x690D;&#x5230; WinPCap &#x7684;&#x7248;&#x672C;&#xFF0C;&#x5F53;&#x7136;&#x5E95;&#x5C42;&#x6293;&#x5305;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x4E0D;&#x540C;&#x3002;</li></ul></li><li>Go</li></ul><h3 id="gopacket"><a href="#gopacket" class="headerlink" title="gopacket"></a>gopacket <a href="#gopacket" class="header-anchor">#</a></h3><ul><li>&#x652F;&#x6301; libpcap&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x652F;&#x6301;&#x5176;&#x5B83;&#x7684;&#xFF0C;&#x5982; <a href="http://www.ntop.org/products/packet-capture/pf_ring/" target="_blank" rel="noopener">pfring</a> &#x548C; <a href="http://manual-snort-org.s3-website-us-east-1.amazonaws.com/node7.html#SECTION00253000000000000000" target="_blank" rel="noopener">afpacket</a></li><li><a href="https://github.com/google/gopacket" target="_blank" rel="noopener">https://github.com/google/gopacket</a></li><li><a href="http://www.devdungeon.com/content/packet-capture-injection-and-analysis-gopacket" target="_blank" rel="noopener">http://www.devdungeon.com/content/packet-capture-injection-and-analysis-gopacket</a></li></ul><p>&#x5B50;&#x5305;&#xFF1A;</p><ul><li><code>github.com/google/gopacket</code></li><li><code>github.com/google/gopacket/pcap</code></li><li><code>github.com/google/gopacket/layers</code> &#xFF1A;&#x89E3;&#x6790;&#x5305;&#x7528;&#x7684;&#x6700;&#x591A;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x5305;</li><li><code>github.com/google/gopacket/pcapgo</code></li></ul><p>&#x7C7B;&#x578B;&#xFF1A;</p><ul><li><code>Decoder</code></li><li><code>Flow</code></li><li><code>Layer</code></li><li><code>Packet</code></li><li><code>PacketSource</code></li><li><code>Payload</code></li></ul><h2 id="dai-ma-yan-shi"><a href="#&#x4EE3;&#x7801;&#x6F14;&#x793A;" class="headerlink" title="&#x4EE3;&#x7801;&#x6F14;&#x793A;"></a>&#x4EE3;&#x7801;&#x6F14;&#x793A; <a href="#dai-ma-yan-shi" class="header-anchor">#</a></h2><h3 id="huo-qu-pcap-ban-ben-ji-wang-qia-lie-biao"><a href="#&#x83B7;&#x53D6;-pcap-&#x7248;&#x672C;&#x53CA;&#x7F51;&#x5361;&#x5217;&#x8868;" class="headerlink" title="&#x83B7;&#x53D6; pcap &#x7248;&#x672C;&#x53CA;&#x7F51;&#x5361;&#x5217;&#x8868;"></a>&#x83B7;&#x53D6; pcap &#x7248;&#x672C;&#x53CA;&#x7F51;&#x5361;&#x5217;&#x8868; <a href="#huo-qu-pcap-ban-ben-ji-wang-qia-lie-biao" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/google/gopacket/pcap&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6; libpcap &#x7684;&#x7248;&#x672C;</span></span><br><span class="line">version := pcap.Version()</span><br><span class="line">fmt.Println(version)</span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x7F51;&#x5361;&#x5217;&#x8868;</span></span><br><span class="line"><span class="keyword">var</span> devices []pcap.Interface</span><br><span class="line">devices, _ := pcap.FindAllDevs()</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>pcap.Interface</code> &#x7684;&#x5B9A;&#x4E49;&#x662F;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">struct</span> {</span><br><span class="line">Name<span class="keyword">string</span></span><br><span class="line">Description <span class="keyword">string</span></span><br><span class="line">Address[]InterfaceAddress</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>InterfaceAddress</code> &#x7684;&#x5B9A;&#x4E49;&#x662F;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> InterfaceAddress <span class="keyword">struct</span> {</span><br><span class="line">IPnet.IP</span><br><span class="line">Netmasknet.IPMask</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="da-kai-wang-luo-jie-kou"><a href="#&#x6253;&#x5F00;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;" class="headerlink" title="&#x6253;&#x5F00;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;"></a>&#x6253;&#x5F00;&#x7F51;&#x7EDC;&#x63A5;&#x53E3; <a href="#da-kai-wang-luo-jie-kou" class="header-anchor">#</a></h3><p>&#x8FD9;&#x662F;&#x5728;&#x7EBF;&#x6355;&#x83B7;&#x5206;&#x6790;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">handle, _ := pcap.OpenLive(</span><br><span class="line"><span class="string">&quot;eth0&quot;</span>,<span class="comment">// device</span></span><br><span class="line"><span class="keyword">int32</span>(<span class="number">65535</span>),<span class="comment">//snapshot length</span></span><br><span class="line"><span class="literal">false</span>,<span class="comment">//promiscuous mode?</span></span><br><span class="line"><span class="number">-1</span> * time.Second,<span class="comment">// timeout &#x8D1F;&#x6570;&#x8868;&#x793A;&#x4E0D;&#x7F13;&#x5B58;&#xFF0C;&#x76F4;&#x63A5;&#x8F93;&#x51FA;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">defer</span> handle.Close()</span><br></pre></td></tr></table></figure><h3 id="da-kai-bu-huo-de-wen-jian"><a href="#&#x6253;&#x5F00;&#x6355;&#x83B7;&#x7684;&#x6587;&#x4EF6;" class="headerlink" title="&#x6253;&#x5F00;&#x6355;&#x83B7;&#x7684;&#x6587;&#x4EF6;"></a>&#x6253;&#x5F00;&#x6355;&#x83B7;&#x7684;&#x6587;&#x4EF6; <a href="#da-kai-bu-huo-de-wen-jian" class="header-anchor">#</a></h3><p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x6293;&#x5230;&#x7684;&#x5305;&#x8FDB;&#x884C;&#x79BB;&#x7EBF;&#x5206;&#x6790;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6587;&#x4EF6;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">handle, _ := pcap.OpenOffline(<span class="string">&quot;dump.pcap&quot;</span>)</span><br><span class="line"><span class="keyword">defer</span> handle.Close()</span><br></pre></td></tr></table></figure><h3 id="jian-li-packet-source"><a href="#&#x5EFA;&#x7ACB;-packet-source" class="headerlink" title="&#x5EFA;&#x7ACB; packet source"></a>&#x5EFA;&#x7ACB; packet source <a href="#jian-li-packet-source" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">packetSource := gopacket.NewPacketSource(</span><br><span class="line">handle,</span><br><span class="line">handle.LinkType()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="cong-packet-source-du-qu-zhua-de-bao"><a href="#&#x4ECE;-packet-source-&#x8BFB;&#x53D6;&#x6293;&#x7684;&#x5305;" class="headerlink" title="&#x4ECE; packet source &#x8BFB;&#x53D6;&#x6293;&#x7684;&#x5305;"></a>&#x4ECE; packet source &#x8BFB;&#x53D6;&#x6293;&#x7684;&#x5305; <a href="#cong-packet-source-du-qu-zhua-de-bao" class="header-anchor">#</a></h3><h4 id="yi-ge-bao"><a href="#&#x4E00;&#x4E2A;&#x5305;" class="headerlink" title="&#x4E00;&#x4E2A;&#x5305;"></a>&#x4E00;&#x4E2A;&#x5305; <a href="#yi-ge-bao" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">packet, _ := packetSource.NextPacket()</span><br><span class="line">fmt.Println(packet)</span><br></pre></td></tr></table></figure><h4 id="suo-you-bao"><a href="#&#x6240;&#x6709;&#x5305;" class="headerlink" title="&#x6240;&#x6709;&#x5305;"></a>&#x6240;&#x6709;&#x5305; <a href="#suo-you-bao" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> packet := <span class="keyword">range</span> packetSource.Packets() {</span><br><span class="line">fmt.Println(packet)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="guo-lu"><a href="#&#x8FC7;&#x6EE4;" class="headerlink" title="&#x8FC7;&#x6EE4;"></a>&#x8FC7;&#x6EE4; <a href="#guo-lu" class="header-anchor">#</a></h3><p>&#x9ED8;&#x8BA4;&#x662F;&#x5C06;&#x6240;&#x6709;&#x6355;&#x83B7;&#x7684;&#x5305;&#x8FD4;&#x56DE;&#x56DE;&#x6765;&#xFF0C;&#x800C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x5305;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x8FC7;&#x6EE4;&#x5668;&#x3002;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7528; <a href="https://biot.com/capstats/bpf.html" target="_blank" rel="noopener">Berkeley Packet Filter &#x7684;&#x8BED;&#x6CD5;</a>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handle.SetBPFFilter(<span class="string">&quot;tcp and port 80&quot;</span>)</span><br></pre></td></tr></table></figure><p>&#x5728; C &#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x72EC;&#x7ACB;&#x7684;&#x64B0;&#x5199; BPF&#xFF0C;&#x7F16;&#x8BD1;&#xFF0C;&#x7136;&#x540E;&#x518D; attach &#x8FDB;&#x6765;&#x3002;&#x800C; Go &#x8D85;&#x65B9;&#x4FBF;&#xFF0C;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x5C31;&#x597D;&#x4E86;&#x3002;</p><h4 id="li-zi"><a href="#&#x4F8B;&#x5B50;" class="headerlink" title="&#x4F8B;&#x5B50;"></a>&#x4F8B;&#x5B50; <a href="#li-zi" class="header-anchor">#</a></h4><ul><li>&#x8FC7;&#x6EE4;IP&#xFF1A; 10.1.1.3</li><li>&#x8FC7;&#x6EE4;CIDR&#xFF1A; 128.3/16</li><li>&#x8FC7;&#x6EE4;&#x7AEF;&#x53E3;&#xFF1A; port 53</li><li>&#x8FC7;&#x6EE4;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#xFF1A; host 8.8.8.8 and udp port 53</li><li>&#x8FC7;&#x6EE4;&#x7F51;&#x6BB5;&#x548C;&#x7AEF;&#x53E3;&#xFF1A; net 199.16.156.0/22 and port</li><li>&#x8FC7;&#x6EE4;&#x975E;&#x672C;&#x673A; Web &#x6D41;&#x91CF;&#xFF1A; (port 80 and port 443) and not host 192.168.0.1</li></ul><h3 id="jiang-bu-huo-dao-de-bao-bao-cun-dao-wen-jian"><a href="#&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6587;&#x4EF6;" class="headerlink" title="&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6587;&#x4EF6;"></a>&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6587;&#x4EF6; <a href="#jiang-bu-huo-dao-de-bao-bao-cun-dao-wen-jian" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dumpFile, _ := os.Create(<span class="string">&quot;dump.pcap&quot;</span>)</span><br><span class="line"><span class="keyword">defer</span> dumpFile.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x51C6;&#x5907;&#x597D;&#x5199;&#x5165;&#x7684; Writer</span></span><br><span class="line">packetWriter := pcapgo.NewWriter(dumpFile)</span><br><span class="line">packetWriter.WriteFileHeader(</span><br><span class="line"><span class="number">65535</span>,<span class="comment">//Snapshot length</span></span><br><span class="line">layers.LinkTypeEthernet,</span><br><span class="line">)</span><br><span class="line"><span class="comment">//&#x5199;&#x5165;&#x5305;</span></span><br><span class="line"><span class="keyword">for</span> packet := <span class="keyword">range</span> packetSource.Packets() {</span><br><span class="line">packetWriter.WritePacket(</span><br><span class="line">packet.Metadata().CaptureInfo,</span><br><span class="line">packet.Data(),</span><br><span class="line">)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="jie-xi-bao"><a href="#&#x89E3;&#x6790;&#x5305;" class="headerlink" title="&#x89E3;&#x6790;&#x5305;"></a>&#x89E3;&#x6790;&#x5305; <a href="#jie-xi-bao" class="header-anchor">#</a></h3><h4 id="lie-chu-bao-de-ceng"><a href="#&#x5217;&#x51FA;&#x5305;&#x7684;&#x5C42;" class="headerlink" title="&#x5217;&#x51FA;&#x5305;&#x7684;&#x5C42;"></a>&#x5217;&#x51FA;&#x5305;&#x7684;&#x5C42; <a href="#lie-chu-bao-de-ceng" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, layer := <span class="keyword">range</span> packet.Layers() {</span><br><span class="line">fmt.Println(layer.LayerType())</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5305;&#x7684;&#x5206;&#x5C42;&#x5C31;&#x50CF;&#x4FC4;&#x7F57;&#x65AF;&#x5957;&#x5A03;&#xFF0C;&#x4E0A;&#x4E00;&#x5C42;&#x7684; payload &#x662F;&#x4E0B;&#x4E00;&#x5C42;&#x5B8C;&#x6574;&#x7684;&#x5305;&#xFF0C;&#x4E0B;&#x4E00;&#x5C42;&#x89E3;&#x6790;&#x5B8C;&#x5F97;&#x51FA;&#x7684; payload&#xFF0C;&#x662F;&#x66F4;&#x4E0B;&#x4E00;&#x5C42;&#x7684;&#x5305;&#x3002;</p><h4 id="jie-xi-ip-ceng"><a href="#&#x89E3;&#x6790;-IP-&#x5C42;" class="headerlink" title="&#x89E3;&#x6790; IP &#x5C42;"></a>&#x89E3;&#x6790; IP &#x5C42; <a href="#jie-xi-ip-ceng" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ipLayer := packet.Layer(layers.LayerTypeIPv4)</span><br><span class="line"><span class="keyword">if</span> ipLayer != <span class="literal">nil</span> {</span><br><span class="line">ip, _ := ipLayer.(*layers.IPv4)</span><br><span class="line">fmt.Println(ip.SrcIP, ip.DstIP)</span><br><span class="line">fmt.Println(ip.Protocol)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="jie-xi-tcp-ceng"><a href="#&#x89E3;&#x6790;-TCP-&#x5C42;" class="headerlink" title="&#x89E3;&#x6790; TCP &#x5C42;"></a>&#x89E3;&#x6790; TCP &#x5C42; <a href="#jie-xi-tcp-ceng" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tcpLayer := packet.Layer(layers.LayerTypeTCP)</span><br><span class="line"><span class="keyword">if</span> tcpLayer != <span class="literal">nil</span> {</span><br><span class="line">tcp, _ := tcpLayer.(*layers.TCP)</span><br><span class="line">fmt.Println(tcp.SrcPort)</span><br><span class="line">fmt.Println(tcp.DstPort)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="zhi-jie-jie-xi-ge-ceng"><a href="#&#x76F4;&#x63A5;&#x89E3;&#x6790;&#x5404;&#x5C42;" class="headerlink" title="&#x76F4;&#x63A5;&#x89E3;&#x6790;&#x5404;&#x5C42;"></a>&#x76F4;&#x63A5;&#x89E3;&#x6790;&#x5404;&#x5C42; <a href="#zhi-jie-jie-xi-ge-ceng" class="header-anchor">#</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x89E3;&#x6790; ethernet &#x5C42;</span></span><br><span class="line">ethernetPacket := gopacket.NewPacket(</span><br><span class="line">packet, layers.LayerTypeEthernet, gopacket.Default)  <span class="comment">// &#x590D;&#x5236;&#x4E00;&#x4EFD;&#x5305;</span></span><br><span class="line"><span class="comment">//&#x89E3;&#x6790; IP &#x5C42;</span></span><br><span class="line">ipPacket := gopacket.NewPacket(</span><br><span class="line">packet, layers.LayerTypeIPv6, gopacket.NoCopy) <span class="comment">// &#x4E0D;&#x590D;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x4FEE;&#x6539;</span></span><br><span class="line"><span class="comment">//&#x89E3;&#x6790; TCP &#x5C42;</span></span><br><span class="line">tcpPacket := gopacket.NewPacket(</span><br><span class="line">packet, layers.LayerTypeTCP, gopacket.Lazy)  <span class="comment">// &#x7B49;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;&#x518D;&#x590D;&#x5236;&#xFF08;&#x4E0D;&#x662F;thread safe&#xFF09;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="geng-kuai-de-jie-xi"><a href="#&#x66F4;&#x5FEB;&#x7684;&#x89E3;&#x6790;" class="headerlink" title="&#x66F4;&#x5FEB;&#x7684;&#x89E3;&#x6790;"></a>&#x66F4;&#x5FEB;&#x7684;&#x89E3;&#x6790; <a href="#geng-kuai-de-jie-xi" class="header-anchor">#</a></h4><p>&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x90FD;&#x662F;&#x6BCF;&#x6B21;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5305;&#xFF0C;&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#xFF0C;&#x4EE5;&#x540E;&#x6BCF;&#x6B21;&#x590D;&#x7528;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x6240;&#x6709;&#x6240;&#x9700;&#x7684;&#x53D8;&#x91CF;</span></span><br><span class="line"><span class="keyword">var</span> eth layers.Ethernet</span><br><span class="line"><span class="keyword">var</span> ip4 layers.IPv4</span><br><span class="line"><span class="keyword">var</span> tcp layers.TCP</span><br><span class="line">parser := gopacket.NewDecodingLayerParser(</span><br><span class="line">layers.LayerTypeEthernet, &amp;eth, &amp;ip4, &amp;tcp)</span><br><span class="line">decodedLayers := []gopacket.LayerType{}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x89E3;&#x6790;</span></span><br><span class="line"><span class="keyword">for</span> packet := <span class="keyword">range</span> packetSource.Packets() {</span><br><span class="line">parser.DecodeLayers(packet, &amp;decodedLayers)</span><br><span class="line"><span class="keyword">for</span> _, layerType := <span class="keyword">range</span> decodedLayers {</span><br><span class="line">fmt.Println(layerType)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#xFF0C;&#x56E0;&#x4E3A;&#x590D;&#x7528;&#x4E86;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;&#x7F3A;&#x70B9;&#x662F;&#x53EA;&#x80FD;&#x68C0;&#x6D4B;&#x5B9A;&#x4E49;&#x7684;&#x5305;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x4E2A;&#x6743;&#x8861;&#x3002;</p><h4 id="qi-ta-suo-zhi-chi-de-ceng"><a href="#&#x5176;&#x5B83;&#x6240;&#x652F;&#x6301;&#x7684;&#x5C42;" class="headerlink" title="&#x5176;&#x5B83;&#x6240;&#x652F;&#x6301;&#x7684;&#x5C42;"></a>&#x5176;&#x5B83;&#x6240;&#x652F;&#x6301;&#x7684;&#x5C42; <a href="#qi-ta-suo-zhi-chi-de-ceng" class="header-anchor">#</a></h4><ul><li>ARP</li><li>CiscoDiscovery</li><li>DHCP</li><li>DNS</li><li>Dot11</li><li>ICMP</li><li>PPPoE</li><li>USB</li><li>&#x548C;&#x5176;&#x5B83;&#x5305;&#x91CC;&#x652F;&#x6301;&#x7684; 118 &#x79CD;&#x5C42;</li></ul><h4 id="chang-jian-de-bao-ceng"><a href="#&#x5E38;&#x89C1;&#x7684;&#x5305;&#x5C42;" class="headerlink" title="&#x5E38;&#x89C1;&#x7684;&#x5305;&#x5C42;"></a>&#x5E38;&#x89C1;&#x7684;&#x5305;&#x5C42; <a href="#chang-jian-de-bao-ceng" class="header-anchor">#</a></h4><ul><li><code>packet.LinkLayer()</code>    //    &#x4EE5;&#x592A;&#x7F51;</li><li><code>packet.NetworkLayer()</code>     //    &#x7F51;&#x7EDC;&#x5C42;&#xFF0C;&#x901A;&#x5E38;&#x4E5F;&#x5C31;&#x662F; IP &#x5C42;</li><li><code>packet.TransportLayer()</code>    //    &#x4F20;&#x8F93;&#x5C42;&#xFF0C;&#x6BD4;&#x5982; TCP/UDP</li><li><code>packet.ApplicationLayer()</code>    //    &#x5E94;&#x7528;&#x5C42;&#xFF0C;&#x6BD4;&#x5982; HTTP &#x5C42;&#x3002;</li><li><code>packet.ErrorLayer()</code>    //    &#x2026;&#x2026;&#x51FA;&#x9519;&#x4E86;</li></ul><h3 id="zi-ding-yi-bao-jie-gou"><a href="#&#x81EA;&#x5B9A;&#x4E49;&#x5305;&#x7ED3;&#x6784;" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49;&#x5305;&#x7ED3;&#x6784;"></a>&#x81EA;&#x5B9A;&#x4E49;&#x5305;&#x7ED3;&#x6784; <a href="#zi-ding-yi-bao-jie-gou" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x6709;&#x7279;&#x6B8A;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x672A;&#x516C;&#x5F00;&#x7684;&#x79C1;&#x6709;&#x534F;&#x8BAE;&#xFF0C;&#x8FD8;&#x662F;&#x5305;&#x91CC;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x5305;&#x7684;&#x7ED3;&#x6784;&#x4EE5;&#x53CA;&#x89E3;&#x6790;&#x65B9;&#x5F0F;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x6CE8;&#x518C;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5C42;</span></span><br><span class="line"><span class="keyword">var</span> MyLayerType = gopacket.RegisterLayerType(</span><br><span class="line"><span class="number">12345</span>,<span class="comment">//&#x552F;&#x4E00;&#x7684; ID</span></span><br><span class="line"><span class="string">&quot;MyLayerType&quot;</span>,<span class="comment">//&#x552F;&#x4E00;&#x7684;&#x540D;&#x5B57;</span></span><br><span class="line">gopacket.DecodeFunc(decodeMyLayer),<span class="comment">//&#x89E3;&#x6790;&#x51FD;&#x6570;&#xFF08;&#x7A0D;&#x540E;&#x5B9A;&#x4E49;&#xFF09;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5B9A;&#x4E49;&#x5C42;&#x7684;&#x5185;&#x5BB9;</span></span><br><span class="line"><span class="keyword">type</span> MyLayer <span class="keyword">struct</span> {</span><br><span class="line">Header []<span class="keyword">byte</span></span><br><span class="line">payload []<span class="keyword">byte</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5B9A;&#x4E49;&#x89E3;&#x6790;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeMyLayer</span><span class="params">(data []<span class="keyword">byte</span>, p gopacket.PacketBuilder)</span> <span class="title">error</span></span> {</span><br><span class="line">p.AddLayer(&amp;MyLayer{data[:<span class="number">4</span>], data[<span class="number">4</span>:]})</span><br><span class="line"><span class="keyword">return</span> p.NextDecoder(layers.LayerTypeEthernet)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x89E3;&#x6790;&#x5305;&#x6240;&#x9700;&#x7684;&#x63A5;&#x53E3;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m MyLayer)</span> <span class="title">LayerType</span><span class="params">()</span> <span class="title">LayerType</span></span> {</span><br><span class="line"><span class="keyword">return</span> MyLayerType</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m MyLayer)</span> <span class="title">LayerContents</span><span class="params">()</span> []<span class="title">byte</span></span> {</span><br><span class="line"><span class="keyword">return</span> m.Header</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m MyLayer)</span> <span class="title">LayerPayload</span><span class="params">()</span> []<span class="title">byte</span></span> {</span><br><span class="line"><span class="keyword">return</span> m.payload</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x50CF;&#x5176;&#x5B83;&#x5185;&#x7F6E;&#x5C42;&#x4E00;&#x6837;&#x89E3;&#x6790;&#x8FD9;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5305;&#x4E86;</span></span><br><span class="line">decodedPacket := gopacket.NewPacket(</span><br><span class="line">data,</span><br><span class="line">MyLayerType,</span><br><span class="line">gopacket.Default,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="gou-zao-bao"><a href="#&#x6784;&#x9020;&#x5305;" class="headerlink" title="&#x6784;&#x9020;&#x5305;"></a>&#x6784;&#x9020;&#x5305; <a href="#gou-zao-bao" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buffer = gopacket.NewSerializeBuffer()</span><br><span class="line">options := gopacket.SerializeOptions{}</span><br><span class="line">gopacket.SerializeLayers(buffer, options, </span><br><span class="line">&amp;layers.Ethernet{},</span><br><span class="line">&amp;layers.IPv4{},</span><br><span class="line">&amp;layers.TCP{},</span><br><span class="line">gopacket.Payload([]<span class="keyword">byte</span>{<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>}),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="fa-song-gou-zao-hao-de-bao"><a href="#&#x53D1;&#x9001;&#x6784;&#x9020;&#x597D;&#x7684;&#x5305;" class="headerlink" title="&#x53D1;&#x9001;&#x6784;&#x9020;&#x597D;&#x7684;&#x5305;"></a>&#x53D1;&#x9001;&#x6784;&#x9020;&#x597D;&#x7684;&#x5305; <a href="#fa-song-gou-zao-hao-de-bao" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handle.WritePacketData(buffer.Bytes())</span><br></pre></td></tr></table></figure><h3 id="liu-he-endpoint"><a href="#&#x6D41;&#x548C;-Endpoint" class="headerlink" title="&#x6D41;&#x548C; Endpoint"></a>&#x6D41;&#x548C; Endpoint <a href="#liu-he-endpoint" class="header-anchor">#</a></h3><p>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x6D41;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5F53;&#x53D1;&#x73B0;&#x540E;&#xFF0C;&#x4F1A;&#x901A;&#x77E5;&#x4F60;&#x627E;&#x5230;&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x6D41;&#xFF0C;&#x5F53;&#x7136;&#x5177;&#x4F53;&#x7684;&#x5305;&#x8FD8;&#x9700;&#x8981;&#x4F60;&#x53BB;&#x63D0;&#x53D6;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">someFlow := gopacket.NewFlow(</span><br><span class="line">layers.NewUDPPortEndpoint(<span class="number">1000</span>),</span><br><span class="line">layers.NewUDPPortEndpoint(<span class="number">500</span>))</span><br><span class="line"></span><br><span class="line">t := packet.NetworkLayer()<span class="comment">//Check nil</span></span><br><span class="line"><span class="keyword">if</span> t.TransportFlow() == someFlow {</span><br><span class="line">fmt.Println(<span class="string">&quot;UDP 1000 -&gt; 500 found.&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="qian-zai-de-ying-yong"><a href="#&#x6F5C;&#x5728;&#x7684;&#x5E94;&#x7528;" class="headerlink" title="&#x6F5C;&#x5728;&#x7684;&#x5E94;&#x7528;"></a>&#x6F5C;&#x5728;&#x7684;&#x5E94;&#x7528; <a href="#qian-zai-de-ying-yong" class="header-anchor">#</a></h2><ul><li>&#x68C0;&#x67E5;&#x5728;&#x9ED1;&#x540D;&#x5355;&#x7684; IP</li><li>&#x7ED9;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x6363;&#x4E71;&#x5565;&#x7684;&#xFF0C;&#x770B;&#x770B;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7834;&#x574F;</li><li>&#x76D1;&#x63A7;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;</li><li>&#x7AEF;&#x53E3;&#x626B;&#x63CF;</li><li>&#x9632;&#x706B;&#x5899;&#xFF08;&#x6709;&#x72B6;&#x6001;&#x548C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x9632;&#x706B;&#x5899;&#x5BF9;&#x4E8E;&#x8FDE;&#x63A5;&#x7684;&#x53CD;&#x5E94;&#x4E0D;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5206;&#x6790;&#x9632;&#x706B;&#x5899;&#x7684;&#x60C5;&#x51B5;&#xFF09;</li><li>IDS &#x5165;&#x4FB5;&#x68C0;&#x6D4B;</li><li>&#x79FB;&#x52A8;&#x624B;&#x673A;&#x5E94;&#x7528;API&#x7684;&#x9006;&#x5411;&#x5DE5;&#x7A0B;</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2016" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2016/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：gRPC 从学习到生产 - Alan Shreve</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-27-video-grpc-from-tutorial-to-production.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-27-video-grpc-from-tutorial-to-production.html</id>
    <published>2017-09-22T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.624Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a><ul><li><a href="#yan-jiang-zhe">&#x6F14;&#x8BB2;&#x8005;</a></li><li><a href="#wei-fu-wu-zhi-jian-ying-gai-ru-he-tong-xun">&#x5FAE;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x901A;&#x8BAF;&#xFF1F;</a></li><li><a href="#wei-shi-me-rest-api-bu-hao-yong">&#x4E3A;&#x4EC0;&#x4E48; REST API &#x4E0D;&#x597D;&#x7528;&#xFF1F;</a></li><li><a href="#shi-me-shi-grpc">&#x4EC0;&#x4E48;&#x662F; gRPC</a></li><li><a href="#jian-yi-ge-huan-cun-fu-wu">&#x5EFA;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x670D;&#x52A1;</a><ul><li><a href="#app-proto">app.proto</a></li><li><a href="#server-go">server.go</a></li><li><a href="#client-go">client.go</a></li><li><a href="#zhe-bu-jiu-shi-wsdl-me">&#x8FD9;&#x4E0D;&#x5C31;&#x662F; WSDL &#x4E48;&#xFF1F;</a></li><li><a href="#shi-xian-ju-ti-de-cacheservice">&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684; CacheService</a></li><li><a href="#cuo-wu-chu-li">&#x9519;&#x8BEF;&#x5904;&#x7406;</a></li><li><a href="#jia-mi-chuan-shu">&#x52A0;&#x5BC6;&#x4F20;&#x8F93;</a></li></ul></li><li><a href="#sheng-chan-huan-jing-ru-he-shi-yong-grpc">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5982;&#x4F55;&#x4F7F;&#x7528; gRPC</a><ul><li><a href="#grpc-de-shi-xian">gRPC &#x7684;&#x5B9E;&#x73B0;</a></li><li><a href="#grpc-cong-na-lai-de">gRPC &#x4ECE;&#x54EA;&#x6765;&#x7684;</a></li><li><a href="#sheng-chan-huan-jing-an-li-duo-zu-hu">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x79DF;&#x6237;</a></li><li><a href="#sheng-chan-huan-jing-an-li-xing-neng">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6027;&#x80FD;</a></li><li><a href="#sheng-chan-huan-jing-an-li-chao-shi">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x8D85;&#x65F6;</a></li><li><a href="#sheng-chan-huan-jing-an-li-shang-xia-wen-chuan-di">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x9012;</a></li><li><a href="#sheng-chan-huan-jing-an-li-grpc-metadata">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;GRPC Metadata</a></li><li><a href="#sheng-chan-huan-jing-an-li-retry">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Retry</a></li><li><a href="#sheng-chan-huan-jing-an-li-jie-gou-hua-cuo-wu">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x7ED3;&#x6784;&#x5316;&#x9519;&#x8BEF;</a></li><li><a href="#sheng-chan-huan-jing-an-li-dump">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Dump</a></li><li><a href="#sheng-chan-huan-jing-an-li-liu-liang-kong-zhi">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6D41;&#x91CF;&#x63A7;&#x5236;</a></li><li><a href="#sheng-chan-huan-jing-an-li-streaming">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Streaming</a></li><li><a href="#sheng-chan-huan-jing-an-li-heng-xiang-kuo-zhan-fu-zai-jun-heng">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x3001;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><li><a href="#sheng-chan-huan-jing-an-li-duo-yu-yan-xie-zuo">&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x8BED;&#x8A00;&#x534F;&#x4F5C;</a></li></ul></li><li><a href="#grpc-shang-bu-wan-mei-de-di-fang">gRPC &#x5C1A;&#x4E0D;&#x5B8C;&#x7F8E;&#x7684;&#x5730;&#x65B9;</a></li><li><a href="#grpc-zai-sheng-chan-huan-jing-zhong-de-yong-li">gRPC &#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x7528;&#x4F8B;</a></li><li><a href="#grpc-wei-lai-de-bian-hua">gRPC &#x672A;&#x6765;&#x7684;&#x53D8;&#x5316;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>grpc: From Tutorial to Production</strong><br>by Alan Shreve<br>at GopherCon 2017</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/7FZ6ZyzGex0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=7FZ6ZyzGex0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=7FZ6ZyzGex0</a></p><p>&#x535A;&#x6587;&#xFF1A;<a href="https://about.sourcegraph.com/go/grpc-in-production-alan-shreve/" target="_blank" rel="noopener">https://about.sourcegraph.com/go/grpc-in-production-alan-shreve/</a></p><h2 id="yan-jiang-zhe"><a href="#&#x6F14;&#x8BB2;&#x8005;" class="headerlink" title="&#x6F14;&#x8BB2;&#x8005;"></a>&#x6F14;&#x8BB2;&#x8005; <a href="#yan-jiang-zhe" class="header-anchor">#</a></h2><p>Alan Shreve, <a href="https://ngrok.com" target="_blank" rel="noopener">https://ngrok.com</a> &amp; <a href="https://equinox.io" target="_blank" rel="noopener">https://equinox.io</a><br>Github: <a href="https://github.com/inconshreveable" target="_blank" rel="noopener">@inconshreveable</a> &amp; Twitter: <a href="https://twitter.com/inconshreveable?lang=en" target="_blank" rel="noopener">@inconshreveable</a></p><h2 id="wei-fu-wu-zhi-jian-ying-gai-ru-he-tong-xun"><a href="#&#x5FAE;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x901A;&#x8BAF;&#xFF1F;" class="headerlink" title="&#x5FAE;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x901A;&#x8BAF;&#xFF1F;"></a>&#x5FAE;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x901A;&#x8BAF;&#xFF1F; <a href="#wei-fu-wu-zhi-jian-ying-gai-ru-he-tong-xun" class="header-anchor">#</a></h2><p>&#x7B54;&#x6848;&#x5C31;&#x662F;&#xFF1A;<strong><a href="https://en.wikipedia.org/wiki/SOAP" target="_blank" rel="noopener">SOAP</a></strong>&#x2026;&#x2026;&#x597D;&#x5427;&#xFF0C;&#x5F00;&#x4E2A;&#x73A9;&#x7B11;&#xFF0C;&#x5F53;&#x7136;&#x4E0D;&#x53EF;&#x80FD;&#x662F; SOAP &#x4E86;&#x3002;</p><p>&#x73B0;&#x5728;&#x6D41;&#x884C;&#x7684;&#x505A;&#x6CD5;&#x662F; <strong>HTTP + JSON (<a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener">REST API</a>)</strong></p><p>Alan &#x8BF4;&#x201C;&#x5982;&#x679C;&#x8FD9;&#x8F88;&#x5B50;&#x518D;&#x4E5F;&#x4E0D;&#x5199;&#x53E6;&#x4E00;&#x4E2A; REST &#x5BA2;&#x6237;&#x7AEF;&#x5E93;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x5E78;&#x798F;&#x7684;&#x6B7B;&#x53BB;&#x4E86;&#x2026;&#x2026;&#x1F602;&#x201D;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x6700;&#x65E0;&#x804A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x4E00;&#x904D;&#x4E00;&#x904D;&#x7684;&#x5728;&#x505A;&#x540C;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p><h2 id="wei-shi-me-rest-api-bu-hao-yong"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-REST-API-&#x4E0D;&#x597D;&#x7528;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; REST API &#x4E0D;&#x597D;&#x7528;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; REST API &#x4E0D;&#x597D;&#x7528;&#xFF1F; <a href="#wei-shi-me-rest-api-bu-hao-yong" class="header-anchor">#</a></h2><ul><li>&#x5B9E;&#x73B0; Stream &#x592A;&#x96BE;&#x4E86;</li><li>&#x800C;&#x53CC;&#x5411;&#x7684;&#x6D41;&#x5C31;&#x6839;&#x672C;&#x4E0D;&#x53EF;&#x80FD;</li><li>&#x5F88;&#x96BE;&#x5BF9;&#x64CD;&#x4F5C;&#x5EFA;&#x7ACB;&#x6A21;&#x578B;</li><li>&#x6548;&#x7387;&#x5F88;&#x5DEE;&#xFF0C;&#x6587;&#x672C;&#x8868;&#x793A;&#x5BF9;&#x4E8E;&#x7F51;&#x7EDC;&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x662F;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;</li><li>&#x800C;&#x4E14;&#xFF0C;&#x5176;&#x5B9E;&#x670D;&#x52A1;&#x5185;&#x90E8;&#x6839;&#x672C;&#x4E0D;&#x662F; RESTful &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x53EA;&#x662F; HTTP endpoint</li><li>&#x5F88;&#x96BE;&#x5728;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x53D6;&#x5F97;&#x591A;&#x4E2A;&#x8D44;&#x6E90;&#x6570;&#x636E; &#xFF08;&#x53CD;&#x4F8B;&#x770B; <a href="http://graphql.org/learn/" target="_blank" rel="noopener">GraphQL</a>&#xFF09;</li><li>&#x6CA1;&#x6709;<strong>&#x6B63;&#x5F0F;&#x7684;</strong>&#xFF08;&#x673A;&#x5668;&#x53EF;&#x8BFB;&#x7684;&#xFF09;API&#x7EA6;&#x675F;<ul><li>&#x56E0;&#x6B64;&#x5199;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4EBA;&#x7C7B;<ul><li>&#x800C;&#x4E14;&#x56E0;&#x4E3A;&#x1F477;&#x5F88;&#x8D35;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x559C;&#x6B22;&#x5199;&#x5BA2;&#x6237;&#x7AEF;</li></ul></li></ul></li></ul><h2 id="shi-me-shi-grpc"><a href="#&#x4EC0;&#x4E48;&#x662F;-gRPC" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; gRPC"></a>&#x4EC0;&#x4E48;&#x662F; gRPC <a href="#shi-me-shi-grpc" class="header-anchor">#</a></h2><blockquote><p><a href="https://grpc.io" target="_blank" rel="noopener">gPRC</a> &#x662F;&#x9AD8;&#x6027;&#x80FD;&#x3001;&#x5F00;&#x6E90;&#x3001;&#x901A;&#x7528;&#x7684; RPC &#x6846;&#x67B6;&#x3002;</p></blockquote><p>&#x4E0E;&#x5176;&#x8BB2;&#x89E3;&#x5B9A;&#x4E49;&#xFF0C;&#x4E0D;&#x5982;&#x6765;&#x5B9E;&#x9645;&#x505A;&#x4E2A;&#x4E1C;&#x897F;&#x66F4;&#x6E05;&#x695A;&#x3002;</p><h2 id="jian-yi-ge-huan-cun-fu-wu"><a href="#&#x5EFA;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x670D;&#x52A1;" class="headerlink" title="&#x5EFA;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x670D;&#x52A1;"></a>&#x5EFA;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x670D;&#x52A1; <a href="#jian-yi-ge-huan-cun-fu-wu" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528; gRPC &#x8FD9;&#x7C7B;&#x4E1C;&#x897F;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x975E;&#x5F00;&#x59CB;&#x4E8E;&#x5199; Go &#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x4ECE;&#x64B0;&#x5199; gRPC &#x7684; <a href="https://developers.google.com/protocol-buffers/docs/overview" target="_blank" rel="noopener">IDL</a> &#x5F00;&#x59CB;&#x7684;&#x3002;</p><h3 id="app-proto"><a href="#app-proto" class="headerlink" title="app.proto"></a>app.proto <a href="#app-proto" class="header-anchor">#</a></h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span></span><br><span class="line"><span class="keyword">package</span> <span class="function"><span class="keyword">rpc</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Cache</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> Store(StoreReq) <span class="keyword">returns</span> (StoreResp) {}</span></span><br><span class="line"><span class="function">  <span class="keyword">rpc</span> Get(GetReq) <span class="keyword">returns</span> (GetResp) {}</span></span><br><span class="line"><span class="function">}</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">message StoreReq {</span></span><br><span class="line"><span class="function">  string key = 1</span>;</span><br><span class="line">  <span class="built_in">bytes</span> val = <span class="number">2</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">StoreResp</span> </span>{</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">GetReq</span> </span>{</span><br><span class="line">  <span class="built_in">string</span> key = <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">GetResp</span> </span>{</span><br><span class="line">  <span class="built_in">bytes</span> val = <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5F53;&#x5199;&#x4E86;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7ACB;&#x523B;&#x62E5;&#x6709;&#x4E86;<strong>9</strong>&#x79CD;&#x8BED;&#x8A00;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5E93;&#x3002;</p><ul><li>C++</li><li>Java(and Android)</li><li>Python</li><li>Go</li><li>Ruby</li><li>C#</li><li>Javascript(node.js)</li><li>Objective-C (iOS!)</li><li>PHP</li></ul><p>&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x62E5;&#x6709;&#x4E86;<strong>7</strong>&#x79CD;&#x8BED;&#x8A00;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x7684; API Stub&#xFF1A;</p><ul><li>C++</li><li>Java</li><li>Python</li><li>Go</li><li>Ruby</li><li>C#</li><li>Javascript(node.js)</li></ul><h3 id="server-go"><a href="#server-go" class="headerlink" title="server.go"></a>server.go <a href="#server-go" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">serverMain</span><span class="params">()</span></span> {</span><br><span class="line">  <span class="keyword">if</span> err := runServer(); err != <span class="literal">nil</span> {</span><br><span class="line">    fmt.Fprintf(os.Stderr, <span class="string">&quot;Failed to run cache server: %s\n&quot;</span>, err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runServer</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  srv := grpc.NewServer()</span><br><span class="line">  rpc.RegisterCacheServer(srv, &amp;CacheService{})</span><br><span class="line">  l, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:5051&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  block</span></span><br><span class="line">  <span class="keyword">return</span> srv.Serve(l)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6682;&#x65F6;&#x5148;&#x4E0D;&#x5B9E;&#x73B0; <code>CacheService</code>&#xFF0C;&#x5148;&#x653E;&#x4E2A;&#x7A7A;&#x7684;&#xFF0C;&#x7A0D;&#x540E;&#x518D;&#x5B9E;&#x73B0;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheService <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Get</span><span class="params">(ctx context.Context, req *rpc.GetReq)</span> <span class="params">(*rpc.GetResp, error)</span></span> {</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;unimplemented&quot;</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;unimplemented&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="client-go"><a href="#client-go" class="headerlink" title="client.go"></a>client.go <a href="#client-go" class="header-anchor">#</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">clientMain</span><span class="params">()</span></span> {</span><br><span class="line">  <span class="keyword">if</span> err != runClient(); err != <span class="literal">nil</span> {</span><br><span class="line">    fmt.Fprintf(os.Stderr, <span class="string">&quot;failed: %v\n&quot;</span>, err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  <span class="comment">//  &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span></span><br><span class="line">  conn, err := grpc.Dial(<span class="string">&quot;localhost:5053&quot;</span>, grpc.WithInsecure())</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to dial server: %v&quot;</span>, err)</span><br><span class="line">  }</span><br><span class="line">  cache := rpc.NewCacheClient(conn)</span><br><span class="line">  <span class="comment">//  &#x8C03;&#x7528; grpc &#x7684; store() &#x65B9;&#x6CD5;&#x5B58;&#x50A8;&#x952E;&#x503C;&#x5BF9; { &quot;gopher&quot;: &quot;con&quot; }</span></span><br><span class="line">  _, err = cache.Store(context.Background(), &amp;rpc.StoreReq{Key: <span class="string">&quot;gopher&quot;</span>, Val: []<span class="keyword">byte</span>(<span class="string">&quot;con&quot;</span>)})</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to store: %v&quot;</span>, err)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  &#x8C03;&#x7528; grpc &#x7684; get() &#x65B9;&#x6CD5;&#x53D6;&#x56DE;&#x952E;&#x4E3A; `gopher` &#x7684;&#x503C;</span></span><br><span class="line">  resp, err := cache.Get(context.Background(), &amp;rpc.GetReq{Key: <span class="string">&quot;gopher&quot;</span>})</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get: %v&quot;</span>, err)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  &#x8F93;&#x51FA;</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;Got cached value %s\n&quot;</span>, resp.Val)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="zhe-bu-jiu-shi-wsdl-me"><a href="#&#x8FD9;&#x4E0D;&#x5C31;&#x662F;-WSDL-&#x4E48;&#xFF1F;" class="headerlink" title="&#x8FD9;&#x4E0D;&#x5C31;&#x662F; WSDL &#x4E48;&#xFF1F;"></a>&#x8FD9;&#x4E0D;&#x5C31;&#x662F; WSDL &#x4E48;&#xFF1F; <a href="#zhe-bu-jiu-shi-wsdl-me" class="header-anchor">#</a></h3><p>&#x6216;&#x8BB8;&#x6709;&#x4E9B;&#x4EBA;&#x4F1A;&#x8BA4;&#x4E3A;&#x8FD9;&#x548C; <a href="https://en.wikipedia.org/wiki/Web_Services_Description_Language" target="_blank" rel="noopener">WSDL</a> &#x4E5F;&#x592A;&#x50CF;&#x4E86;&#xFF0C;&#x8FD9;&#x4E48;&#x60F3;&#x6CA1;&#x6709;&#x9519;&#xFF0C;&#x56E0;&#x4E3A; gRPC &#x5728;&#x501F;&#x9274;&#x4E4B;&#x524D;&#x7684; SOAP/WSDL &#x7684;&#x9519;&#x8BEF;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x4E5F;&#x5438;&#x53D6;&#x4E86;&#x4ED6;&#x4EEC;&#x4F18;&#x79C0;&#x7684;&#x5730;&#x65B9;&#x3002;</p><ul><li>&#x548C; XML &#x5173;&#x7CFB;&#x6CA1;&#x90A3;&#x4E48;&#x7D27;(grpc &#x662F;&#x53EF;&#x63D2;&#x62D4;&#x5F0F;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x6362;&#x6210;&#x5404;&#x79CD;&#x5E95;&#x5C42;&#x8868;&#x8FF0;)</li><li>&#x5199;&#x8FC7; XML/XSD &#x7684;&#x4EBA;&#x90FD;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x5B9A;&#x4E49;&#x592A;&#x7E41;&#x91CD;&#x4E86;&#xFF0C;gRPC &#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;</li><li>WSDL&#x8FD9;&#x7C7B;&#x6709;&#x5B8C;&#x5168;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x3001;&#x548C;&#x57FA;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x529F;&#x80FD;&#xFF08;&#x4E24;&#x6B65; commit&#xFF09;</li><li>WSDL &#x4E0D;&#x7075;&#x6D3B;&#x3001;&#x800C;&#x4E14;&#x65E0;&#x6CD5;&#x524D;&#x5411;&#x517C;&#x5BB9;&#xFF08;&#x4E0D;&#x50CF; <a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener">protobuf</a>&#xFF09;</li><li>SOAP/WSDL &#x6027;&#x80FD;&#x592A;&#x5DEE;&#xFF0C;&#x4EE5;&#x53CA;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x6D41;</li><li>&#x4F46;&#x662F;WSDL&#x4E2D;&#x7684;&#x673A;&#x5668;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x7684;API&#x5B9A;&#x4E49;&#x786E;&#x5B9E;&#x662F;&#x4E2A;&#x597D;&#x4E1C;&#x897F;</li></ul><h3 id="shi-xian-ju-ti-de-cacheservice"><a href="#&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;-CacheService" class="headerlink" title="&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684; CacheService"></a>&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684; CacheService <a href="#shi-xian-ju-ti-de-cacheservice" class="header-anchor">#</a></h3><p><strong>server.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheService <span class="keyword">struct</span> {</span><br><span class="line">  store <span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">byte</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Get</span><span class="params">(ctx context.Context, req *rpc.GetReq)</span> <span class="params">(*rpc.GetResp, error)</span></span> {</span><br><span class="line">  val := s.store[req.Key]</span><br><span class="line">  <span class="keyword">return</span> &amp;rpc.GetResp{Val: val}, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  s.store[req.Key] = req.Val</span><br><span class="line">  <span class="keyword">return</span> &amp;rpc.StoreResp{}, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x9501;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x60F3;&#x60F3;&#x4ED6;&#x4EEC;&#x4E2D;&#x6709;&#xFF0C;&#x56E0;&#x4E3A;&#x5C06;&#x6765;&#x4ED6;&#x4EEC;&#x4F1A;&#x88AB;&#x5E76;&#x53D1;&#x7684;&#x8C03;&#x7528;&#x7684;&#x3002;</p><h3 id="cuo-wu-chu-li"><a href="#&#x9519;&#x8BEF;&#x5904;&#x7406;" class="headerlink" title="&#x9519;&#x8BEF;&#x5904;&#x7406;"></a>&#x9519;&#x8BEF;&#x5904;&#x7406; <a href="#cuo-wu-chu-li" class="header-anchor">#</a></h3><p>&#x5F53;&#x7136;&#xFF0C;gRPC &#x652F;&#x6301;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x3002;&#x5047;&#x8BBE;&#x6539;&#x5199;&#x4E0A;&#x9762;&#x7684; <code>Get()</code>&#xFF0C;&#x5BF9;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x952E;&#x8FDB;&#x884C;&#x62A5;&#x9519;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Get</span><span class="params">(ctx context.Context, req *rpc.GetReq)</span> <span class="params">(*rpc.GetResp, error)</span></span> {</span><br><span class="line">  val, ok := s.store[req.Key]</span><br><span class="line">  <span class="keyword">if</span> !ok {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, status.Errorf(code.NotFound, <span class="string">&quot;Key not found %s&quot;</span>, req.Key)</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> &amp;rpc.GetResp{Val: val}, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="jia-mi-chuan-shu"><a href="#&#x52A0;&#x5BC6;&#x4F20;&#x8F93;" class="headerlink" title="&#x52A0;&#x5BC6;&#x4F20;&#x8F93;"></a>&#x52A0;&#x5BC6;&#x4F20;&#x8F93; <a href="#jia-mi-chuan-shu" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x6253;&#x7B97;&#x53BB;&#x90E8;&#x7F72;&#x7684;&#x8BDD;&#xFF0C;&#x4E00;&#x5B9A;&#x4F1A;&#x88AB; <a href="https://en.wikipedia.org/wiki/Site_reliability_engineering" target="_blank" rel="noopener">SRE</a> &#x62E6;&#x622A;&#x4E0B;&#x6765;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x901A;&#x8BAF;&#x5FC5;&#x987B;&#x52A0;&#x5BC6;&#x4F20;&#x8F93;&#x3002;</p><p>&#x5728; gRPC &#x4E2D;&#x6DFB;&#x52A0; TLS &#x52A0;&#x5BC6;&#x4F20;&#x8F93;&#x5F88;&#x5BB9;&#x6613;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x4FEE;&#x6539; <code>runServer()</code> &#x6DFB;&#x52A0; TLS &#x52A0;&#x5BC6;&#x4F20;&#x8F93;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runServer</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  tlsCreds, err := credentials.NewServerTLSFromFile(<span class="string">&quot;tls.crt&quot;</span>, <span class="string">&quot;tls.key&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  }</span><br><span class="line">  srv := grpc.NewServer(grpc.Creds(tlsCreds))</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x540C;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4E00;&#x4E0B; <code>runClient()</code>&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  tlsCreds := credentials.NewTLS(&amp;tls.Config(InsecureSkipVerify: <span class="literal">true</span>))</span><br><span class="line">  conn, err := grpc.Dial(<span class="string">&quot;localhost:5051&quot;</span>, grpc.WithTransportCredentials(tlsCreds))</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="sheng-chan-huan-jing-ru-he-shi-yong-grpc"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5982;&#x4F55;&#x4F7F;&#x7528;-gRPC" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5982;&#x4F55;&#x4F7F;&#x7528; gRPC"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5982;&#x4F55;&#x4F7F;&#x7528; gRPC <a href="#sheng-chan-huan-jing-ru-he-shi-yong-grpc" class="header-anchor">#</a></h2><ul><li>HTTP/2</li><li>protobuf serialization (pluggable)</li><li>&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x548C; grpc &#x670D;&#x52A1;&#x5668;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x957F;&#x8FDE;&#x63A5;<ul><li>&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A; RPC &#x8C03;&#x7528;&#x90FD;&#x5C06;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x7684; HTTP/2 stream</li><li>&#x5141;&#x8BB8;&#x6A21;&#x62DF;&#x98DE;&#x884C;&#x6A21;&#x5F0F;&#x7684; RPC &#x8C03;&#x7528;</li></ul></li><li>&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;<em>&#x548C;</em>&#x670D;&#x52A1;&#x7AEF; Streaming</li></ul><h3 id="grpc-de-shi-xian"><a href="#gRPC-&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="gRPC &#x7684;&#x5B9E;&#x73B0;"></a>gRPC &#x7684;&#x5B9E;&#x73B0; <a href="#grpc-de-shi-xian" class="header-anchor">#</a></h3><p>&#x73B0;&#x5728;&#x6709;3&#x4E2A;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x3001;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x7684;&#x5B9E;&#x73B0;</p><ul><li>C<ul><li>Ruby, Python, Node.js, PHP, C#, Objective-C, C++ &#x90FD;&#x662F;&#x5BF9;&#x8FD9;&#x4E2A; C core &#x5B9E;&#x73B0;&#x7684;&#x7ED1;&#x5B9A;</li><li>PHP &#x5219;&#x662F;&#x901A;&#x8FC7; PECL &#x548C;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x7684;&#x7ED1;&#x5B9A;</li></ul></li><li>Java<ul><li>Netty + BoringSSL &#x901A;&#x8FC7; JNI</li></ul></li><li>Go<ul><li>&#x7EAF; Go &#x5B9E;&#x73B0;&#xFF0C;&#x4F7F;&#x7528;&#x4E86; Go &#x6807;&#x51C6;&#x5E93;&#x7684; <code>crypto/tls</code></li></ul></li></ul><h3 id="grpc-cong-na-lai-de"><a href="#gRPC-&#x4ECE;&#x54EA;&#x6765;&#x7684;" class="headerlink" title="gRPC &#x4ECE;&#x54EA;&#x6765;&#x7684;"></a>gRPC &#x4ECE;&#x54EA;&#x6765;&#x7684; <a href="#grpc-cong-na-lai-de" class="header-anchor">#</a></h3><ul><li>&#x6700;&#x521D;&#x662F; Google &#x7684;&#x4E00;&#x4E2A;&#x56E2;&#x961F;&#x521B;&#x5EFA;&#x7684;</li><li>&#x66F4;&#x65E9;&#x671F;&#x7684;&#x662F; Google &#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x9879;&#x76EE;&#x53EB;&#x505A; <code>stubby</code></li><li>&#x8FD9;&#x4E2A; gRPC &#x662F;&#x5176;&#x4E0B;&#x4E00;&#x4EE3;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x5E76;&#x4E14;&#x73B0;&#x5728;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F; Google &#x5728;&#x4F7F;&#x7528;&#xFF0C;&#x5F88;&#x591A;&#x516C;&#x53F8;&#x90FD;&#x5728;&#x8D21;&#x732E;&#x4EE3;&#x7801;<ul><li>&#x5F53;&#x7136;&#xFF0C;Google &#x8FD8;&#x662F;&#x4E3B;&#x8981;&#x4EE3;&#x7801;&#x8D21;&#x732E;&#x8005;</li></ul></li></ul><h3 id="sheng-chan-huan-jing-an-li-duo-zu-hu"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x79DF;&#x6237;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x79DF;&#x6237;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x79DF;&#x6237; <a href="#sheng-chan-huan-jing-an-li-duo-zu-hu" class="header-anchor">#</a></h3><p>&#x4E0A;&#x7EBF;&#x751F;&#x4EA7;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x6709;&#x4E00;&#x90E8;&#x5206;&#x5BA2;&#x6237;&#x4EA7;&#x751F;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x952E;&#x503C;&#xFF0C;&#x8BE2;&#x95EE;&#x5F97;&#x77E5;&#xFF0C;&#x6709;&#x7684;&#x5BA2;&#x6237;&#x5E0C;&#x671B;&#x5BF9;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x7F13;&#x5B58;&#xFF0C;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5F88;&#x597D;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x9650;&#x5236;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x5B9E;&#x73B0;&#xFF0C;&#x5BF9;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x53D1;&#x653E;&#x5BA2;&#x6237; token&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7EA6;&#x675F;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x591A;&#x5C11;&#x952E;&#x503C;&#xFF0C;&#x907F;&#x514D;&#x7CFB;&#x7EDF;&#x6EE5;&#x7528;&#x3002;&#x8FD9;&#x5C31;&#x6210;&#x4E3A;&#x4E86;&#x591A;&#x79DF;&#x6237;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x3002;</p><p>&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4ECE; IDL &#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x63A5;&#x53E3;&#xFF0C;&#x589E;&#x52A0; <code>account_token</code> &#x9879;&#x3002;</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">StoreReq</span> </span>{</span><br><span class="line">  <span class="built_in">string</span> key = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">bytes</span> val = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">string</span> account_token = <span class="number">3</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x540C;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6709;&#x72EC;&#x7ACB;&#x7684;&#x670D;&#x52A1;&#x9488;&#x5BF9;&#x8D26;&#x6237;&#x670D;&#x52A1;&#xFF0C;&#x6765;&#x83B7;&#x53D6;&#x8D26;&#x6237;&#x6240;&#x5141;&#x8BB8;&#x7684;&#x7F13;&#x5B58;&#x952E;&#x6570;&#xFF1A;</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Accounts</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetByToken(GetByTokenReq) return (GetByTokenResp) {}</span></span><br><span class="line"><span class="function">}</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">message GetByTokenReq {</span></span><br><span class="line"><span class="function">  string token = 1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">GetByTokenResp</span> </span>{</span><br><span class="line">  Account account = <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Account</span> </span>{</span><br><span class="line">  <span class="built_in">int64</span> max_cache_keys = <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684; <code>Accounts</code> &#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x4E00;&#x4E2A; <code>GetByToken()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x7ED9;&#x5165; <code>token</code>&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>Account</code> &#x7C7B;&#x578B;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x800C; <code>Account</code> &#x5185;&#x6709; <code>max_cache_keys</code> &#x952E;&#x5BF9;&#x5E94;&#x6700;&#x5927;&#x53EF;&#x7F13;&#x5B58;&#x7684;&#x952E;&#x503C;&#x6570;&#x3002;</p><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8FDB;&#x4E00;&#x6B65;&#x4FEE;&#x6539; <strong>client.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  cache := rpc.NewCacheClient(conn)</span><br><span class="line"></span><br><span class="line">  _, err = cache.Store(context.Background(), &amp;rpc.StoreReq{</span><br><span class="line">    AccountToken: <span class="string">&quot;inconshreveable&quot;</span>,</span><br><span class="line">    Key:          <span class="string">&quot;gopher&quot;</span>,</span><br><span class="line">    Val:          []<span class="keyword">byte</span>(<span class="string">&quot;con&quot;</span>),</span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to store: %v&quot;</span>, err)</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6539;&#x53D8;&#x8981;&#x7A0D;&#x5FAE;&#x5927;&#x4E00;&#x4E9B;&#xFF0C;&#x4F46;&#x4E0D;&#x8FC7;&#x5206;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheService <span class="keyword">struct</span> {</span><br><span class="line">  accounts      rpc.AccountsClient</span><br><span class="line">  store         <span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">byte</span></span><br><span class="line">  keysByAccount <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int64</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>accounts</code> &#x662F;&#x4E00;&#x4E2A; grpc &#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x53E6;&#x4E00;&#x4E2A; grpc &#x670D;&#x52A1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684; <code>Store()</code> &#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5148;&#x901A;&#x8FC7; <code>accounts</code> &#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53D6;&#x5F97;&#x8D26;&#x6237;&#x4FE1;&#x606F;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  <span class="comment">//  &#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53D6;&#x5F97;&#x8D26;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x5176;&#x952E;&#x503C;&#x9650;&#x5236;</span></span><br><span class="line">  resp, err := s.accounts.GetByToken(context.Background(), &amp;rpc.GetByTokenReq{</span><br><span class="line">    Token: req.AccountToken,</span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  &#x68C0;&#x67E5;&#x662F;&#x5426;&#x8D85;&#x91CF;&#x4F7F;&#x7528;</span></span><br><span class="line">  <span class="keyword">if</span> s.keysByAccount[req.AccountToken] &gt;= resp.Account.MaxCacheKeys {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, status.Errorf(codes.FailedPrecondition, <span class="string">&quot;Account %s exceeds max key limit %d&quot;</span>, req.AccountToken, resp.Account.MaxCacheKeys)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  &#x5982;&#x679C;&#x952E;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x9700;&#x8981;&#x65B0;&#x52A0;&#x952E;&#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x5BF9;&#x8BA1;&#x6570;&#x5668;&#x52A0;&#x4E00;</span></span><br><span class="line">  <span class="keyword">if</span> _, ok := s.store[req.Key]; !ok {</span><br><span class="line">    s.keysByAccount[req.AccountToken] += <span class="number">1</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  &#x4FDD;&#x5B58;&#x952E;&#x503C;</span></span><br><span class="line">  s.store[req.Key] = req.Val</span><br><span class="line">  <span class="keyword">return</span> &amp;rpc.StoreResp{}, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="sheng-chan-huan-jing-an-li-xing-neng"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6027;&#x80FD;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6027;&#x80FD;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6027;&#x80FD; <a href="#sheng-chan-huan-jing-an-li-xing-neng" class="header-anchor">#</a></h3><p>&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x670D;&#x52A1;&#x53C8;&#x6062;&#x590D;&#x4E86;&#x6B63;&#x5E38;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x7528;&#x6237;&#x5EFA;&#x7ACB;&#x8FC7;&#x591A;&#x7684;&#x952E;&#x503C;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x5F88;&#x5FEB;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53C8;&#x6536;&#x5230;&#x4E86;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x53D1;&#x6765;&#x7684;&#x65B0;&#x7684; issue&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x53CD;&#x5E94;&#x8BF4;&#x65B0;&#x7CFB;&#x7EDF;&#x53D8;&#x6162;&#x4E86;&#xFF0C;&#x6CA1;&#x6709;&#x8FBE;&#x5230; <a href="https://en.wikipedia.org/wiki/Service-level_agreement" target="_blank" rel="noopener">SLA</a> &#x7684;&#x8981;&#x6C42;&#x3002;</p><p>&#x53EF;&#x662F;&#x6211;&#x4EEC;&#x6839;&#x672C;&#x4E0D;&#x77E5;&#x9053;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#xFF0C;&#x4E8E;&#x662F;&#x610F;&#x8BC6;&#x5230;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x53EF;&#x89C2;&#x5BDF;&#x6027;&#xFF08;Observability&#xFF09;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8BA1;&#x91CF;&#x7CFB;&#x7EDF;&#x6765;&#x7EDF;&#x8BA1;&#x6027;&#x80FD;&#x76F8;&#x5173;&#x7684;&#x6570;&#x636E;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5148;&#x4ECE;&#x6700;&#x7B80;&#x5355;&#x7684;&#x505A;&#x8D77;&#xFF0C;&#x6DFB;&#x52A0;&#x65E5;&#x5FD7;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5148;&#x4ECE; <strong>client.go</strong> &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x6D4B;&#x91CF;&#x548C;&#x8BA1;&#x6570;&#x4EE5;&#x53CA;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">//  &#x5F00;&#x59CB;&#x8BA1;&#x65F6;</span></span><br><span class="line">start := time.Now()</span><br><span class="line"></span><br><span class="line">_, err = cache.Store(context.Background(), &amp;rpc.StoreReq{</span><br><span class="line">  AccountToken: <span class="string">&quot;inconshreveable&quot;</span>,</span><br><span class="line">  Key:          <span class="string">&quot;gopher&quot;</span>,</span><br><span class="line">  Val:          []<span class="keyword">byte</span>(<span class="string">&quot;con&quot;</span>),</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">//  &#x8BA1;&#x7B97; cache.Store() &#x8C03;&#x7528;&#x65F6;&#x95F4;</span></span><br><span class="line">log.Printf(<span class="string">&quot;cache.Store duration %s&quot;</span>, time.Since(start))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">  <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to store: %v&quot;</span>, err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//  &#x518D;&#x6B21;&#x5F00;&#x59CB;&#x8BA1;&#x65F6;</span></span><br><span class="line">start = time.Now()</span><br><span class="line"></span><br><span class="line"><span class="comment">//  &#x8C03;&#x7528; grpc &#x7684; get() &#x65B9;&#x6CD5;&#x53D6;&#x56DE;&#x952E;&#x4E3A; `gopher` &#x7684;&#x503C;</span></span><br><span class="line">resp, err := cache.Get(context.Background(), &amp;rpc.GetReq{Key: <span class="string">&quot;gopher&quot;</span>})</span><br><span class="line"></span><br><span class="line"><span class="comment">//  &#x8BA1;&#x7B97; cache.Get() &#x8C03;&#x7528;&#x65F6;&#x95F4;</span></span><br><span class="line">log.Printf(<span class="string">&quot;cache.Get duration %s&quot;</span>, time.Since(start))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">  <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get: %v&quot;</span>, err)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x540C;&#x6837;&#xFF0C;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x4E5F;&#x8FD9;&#x4E48;&#x5904;&#x7406;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  <span class="comment">//  &#x5F00;&#x59CB;&#x8BA1;&#x65F6;</span></span><br><span class="line">  start := time.Now()</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  &#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53D6;&#x5F97;&#x8D26;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x5176;&#x952E;&#x503C;&#x9650;&#x5236;</span></span><br><span class="line">  resp, err := s.accounts.GetByToken(context.Background(), &amp;rpc.GetByTokenReq{</span><br><span class="line">    Token: req.AccountToken,</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  &#x8F93;&#x51FA; account.GetByToken() &#x7684;&#x8C03;&#x7528;&#x65F6;&#x95F4;</span></span><br><span class="line">  log.Printf(<span class="string">&quot;accounts.GetByToken duration %s&quot;</span>, time.Since(start))</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7ECF;&#x8FC7;&#x8FD9;&#x4E9B;&#x4FEE;&#x6539;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x4E00;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#x5728;&#x53CD;&#x53CD;&#x590D;&#x590D;&#x7684;&#x505A;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x4EC0;&#x4E48;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8FD9;&#x79CD;&#x65E0;&#x804A;&#x7684;&#x505A;&#x6CD5;&#x4E48;&#xFF1F;&#x67E5;&#x9605; grpc &#x6587;&#x6863;&#x540E;&#xFF0C;&#x770B;&#x5230;&#x6709;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <strong>Client Interceptor</strong> &#x7684;&#x4E1C;&#x897F;&#x3002;</p><p>&#x8FD9;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C; rpc &#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x5148;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x53EF;&#x4EE5;&#x5BF9;&#x8C03;&#x7528;&#x8FDB;&#x884C;&#x4E00;&#x5C42;&#x5305;&#x88C5;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</p><p>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x53EB;&#x505A; <code>interceptor.go</code>&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithClientInterceptor</span><span class="params">()</span> <span class="title">grpc</span>.<span class="title">DialOption</span></span> {</span><br><span class="line">  <span class="keyword">return</span> grpc.WithUnaryInterceptor(clientInterceptor)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">clientInterceptor</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  ctx context.Context,</span></span></span><br><span class="line"><span class="function"><span class="params">  method <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  req <span class="keyword">interface</span>{},</span></span></span><br><span class="line"><span class="function"><span class="params">  reply <span class="keyword">interface</span>{},</span></span></span><br><span class="line"><span class="function"><span class="params">  cc *grpc.ClientConn,</span></span></span><br><span class="line"><span class="function"><span class="params">  invoker grpc.UnaryInvoker,</span></span></span><br><span class="line"><span class="function"><span class="params">  opts ...grpc.CallOption,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="title">error</span></span> {</span><br><span class="line">  start := time.Now()</span><br><span class="line">  err := invoker(ctx, method, req, reply, cc, opts...)</span><br><span class="line">  log.Printf(<span class="string">&quot;invoke remote method=%s duration=%s error=%v&quot;</span>, method, time.Since(start), err)</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x6709;&#x4E86;&#x8FD9;&#x4E2A; <code>WithClientInterceptor()</code> &#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; <code>grpc.Dial()</code> &#x7684;&#x65F6;&#x5019;&#x6CE8;&#x518C;&#x8FDB;&#x53BB;&#x3002;</p><p><strong>client.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  conn, err := grpc.Dial(<span class="string">&quot;localhost:5051&quot;</span>,</span><br><span class="line">    grpc.WithTransportCredentials(tlsCreds),</span><br><span class="line">    WithClientInterceptor())</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x518C;&#x4E4B;&#x540E;&#xFF0C;&#x6240;&#x6709;&#x7684; grpc &#x8C03;&#x7528;&#x90FD;&#x4F1A;&#x7ECF;&#x8FC7;&#x6211;&#x4EEC;&#x6CE8;&#x518C;&#x7684; <code>clientInterceptor()</code>&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x90FD;&#x6709;&#x7EDF;&#x8BA1;&#x4E86;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x5185;&#x90E8;&#x53CD;&#x53CD;&#x590D;&#x590D;&#x7684;&#x6DFB;&#x52A0;&#x65F6;&#x95F4;&#x3001;&#x8BA1;&#x91CF;&#x3001;&#x8F93;&#x51FA;&#x3002;</p><p>&#x6DFB;&#x52A0;&#x4E86;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FD9;&#x4E2A;&#x8BA1;&#x91CF;&#x540E;&#xFF0C;&#x81EA;&#x7136;&#x800C;&#x7136;&#x5C31;&#x8054;&#x60F3;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x662F;&#x4E0D;&#x662F;&#x4E5F;&#x53EF;&#x4EE5;&#x505A;&#x540C;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#xFF1F;&#x7ECF;&#x8FC7;&#x67E5;&#x770B;&#x6587;&#x6863;&#xFF0C;&#x53EF;&#x4EE5;&#xFF0C;&#x6709;&#x4E2A;&#x53EB;&#x505A; <strong>Server Interceptor</strong> &#x7684;&#x4E1C;&#x897F;&#x3002;</p><p>&#x540C;&#x6837;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x6DFB;&#x52A0; <code>interceptor.go</code>&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0; <code>ServerInterceptor()</code> &#x51FD;&#x6570;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServerInterceptor</span><span class="params">()</span> <span class="title">grpc</span>.<span class="title">ServerOption</span></span> {</span><br><span class="line">  <span class="keyword">return</span> grpc.UnaryInterceptor(serverInterceptor)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">serverInterceptor</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  ctx context.Context,</span></span></span><br><span class="line"><span class="function"><span class="params">  req <span class="keyword">interface</span>{},</span></span></span><br><span class="line"><span class="function"><span class="params">  info *grpc.UnaryServerInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">  handler grpc.UnaryHandler,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="params">(<span class="keyword">interface</span>{}, error)</span></span> {</span><br><span class="line">  start := time.Now()</span><br><span class="line">  resp, err := handler(ctx, req)</span><br><span class="line">  log.Printf(<span class="string">&quot;invoke server method=%s duration=%s error=%v&quot;</span>,</span><br><span class="line">    info.FullMethod,</span><br><span class="line">    time.Since(start),</span><br><span class="line">    err)</span><br><span class="line">  <span class="keyword">return</span> resp, err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x6837;&#xFF0C;&#x9700;&#x8981;&#x5728; <code>runServer()</code> &#x7684;&#x65F6;&#x5019;&#x6CE8;&#x518C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;&#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runServer</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  srv := grpc.NewServer(grpc.Creds(tlsCreds), ServerInterceptor())</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="sheng-chan-huan-jing-an-li-chao-shi"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x8D85;&#x65F6;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x8D85;&#x65F6;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x8D85;&#x65F6; <a href="#sheng-chan-huan-jing-an-li-chao-shi" class="header-anchor">#</a></h3><p>&#x6DFB;&#x52A0;&#x4E86;&#x65E5;&#x5FD7;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7EC8;&#x4E8E;&#x5728;&#x65E5;&#x5FD7;&#x4E2D;&#x53D1;&#x73B0;&#xFF0C;<code>/rpc.Accounts/GetByToken/</code> &#x82B1;&#x4E86;&#x597D;&#x957F;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#x3002;</p><p><strong>server.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  accountsCtx, _ := context.WithTimeout(context.Background(), <span class="number">2</span> * time.Second)</span><br><span class="line">  resp, err := s.accounts.GetByToken(accountsCtx, &amp;rpc.GetByTokenReq{</span><br><span class="line">    Token: req.AccountToken,</span><br><span class="line">  })</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x64CD;&#x4F5C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x5E93;&#x4E2D; <code>context.WithTimeout()</code> &#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p><h3 id="sheng-chan-huan-jing-an-li-shang-xia-wen-chuan-di"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x9012;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x9012;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x9012; <a href="#sheng-chan-huan-jing-an-li-shang-xia-wen-chuan-di" class="header-anchor">#</a></h3><p>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x4FEE;&#x6539;&#x540E;&#xFF0C;&#x5BA2;&#x6237;&#x4F9D;&#x65E7;&#x62B1;&#x6028;&#x8BF4;&#x6CA1;&#x6709;&#x6EE1;&#x8DB3; SLA&#xFF0C;&#x4ED4;&#x7EC6;&#x4E00;&#x60F3;&#x4E5F;&#x5BF9;&#x3002;&#x5C31;&#x7B97;&#x8FD9;&#x91CC;&#x7EA6;&#x675F;&#x4E86; 2 &#x79D2;&#x949F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x8FD8;&#x9700;&#x8981;&#x65F6;&#x95F4;&#xFF0C;&#x522B;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x4E2D;&#x95F4;&#x4E5F;&#x6709;&#x65F6;&#x95F4;&#x5F00;&#x9500;&#x3002;&#x800C;&#x4E14;&#x6709;&#x7684;&#x5BA2;&#x6237;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x9700;&#x8981;1&#x79D2;&#x949F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;2&#x79D2;&#x949F;&#x3002;</p><p>&#x597D;&#x5427;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x8BBE;&#x5B9A;&#x63A8;&#x5411;&#x8C03;&#x7528;&#x65B9;&#x3002;</p><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x6C42;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x65F6;&#x95F4;&#x7EA6;&#x675F;&#x7684;&#x8BBE;&#x5B9A;&#xFF1A;</p><p><strong>client.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  ctx, _ := context.WithTimeout(context.Background(), time.Second)</span><br><span class="line">  _, err = cache.Store(ctx, &amp;rpc.StoreReq{Key: <span class="string">&quot;gopher&quot;</span>, Val: []<span class="keyword">byte</span>(<span class="string">&quot;con&quot;</span>)})</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  ctx, _ = context.WithTimeout(context.Background(), <span class="number">50</span>*time.Millisecond)</span><br><span class="line">  resp, err := cache.Get(ctx, &amp;rpc.GetReq{Key: <span class="string">&quot;gopher&quot;</span>})</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x9012;&#x3002;&#x76F4;&#x63A5;&#x53D6;&#x8C03;&#x7528;&#x65B9;&#x7684; <code>ctx</code>&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  resp, err := s.accounts.GetByToken(ctx, &amp;rpc.GetByTokenReq{</span><br><span class="line">    Token: req.AccountToken,</span><br><span class="line">  })</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="sheng-chan-huan-jing-an-li-grpc-metadata"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;GRPC-Metadata" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;GRPC Metadata"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;GRPC Metadata <a href="#sheng-chan-huan-jing-an-li-grpc-metadata" class="header-anchor">#</a></h3><p>&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x90FD;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x677E;&#x4E00;&#x53E3;&#x6C14;&#x4E86;&#x3002;&#x53EF;&#x662F;&#x5BA2;&#x6237;&#x53C8;&#x63D0;&#x65B0;&#x7684;&#x9700;&#x6C42;&#x4E86;&#x2026;&#x2026;&#x1F605;&#xFF0C;&#x8BF4;&#x6211;&#x4EEC;&#x80FD;&#x4E0D;&#x80FD;&#x589E;&#x52A0;&#x4E00;&#x4E2A; <code>Dry Run</code> &#x7684;&#x6807;&#x5FD7;&#xFF0C;&#x5C31;&#x662F;&#x8BF4;&#x6211;&#x5E0C;&#x671B;&#x4F60;&#x505A;&#x6240;&#x6709;&#x9700;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x9664;&#x4E86;&#x771F;&#x7684;&#x4FEE;&#x6539;&#x952E;&#x503C;&#x5E93;&#x3002;</p><p>GRPC metadata&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A; GRPC &#x7684; Header&#x3002;&#x5C31;&#x50CF; HTTP &#x5934;&#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E9B; Metadata &#x4FE1;&#x606F;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x3002;&#x4F7F;&#x7528; metadata&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x7684; Dry Run &#x7684;&#x5B9E;&#x73B0;&#x53D8;&#x5F97;&#x66F4;&#x7B80;&#x6D01;&#xFF0C;&#x4E0D;&#x5FC5;&#x6BCF;&#x4E2A; RPC &#x65B9;&#x6CD5;&#x5185;&#x90FD;&#x5B9E;&#x73B0;&#x4E00;&#x904D;&#x68C0;&#x67E5; Dry Run &#x6807;&#x5FD7;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x51FA;&#x6765;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Store</span><span class="params">(ctx context.Context, req *rpc.StoreReq)</span> <span class="params">(*rpc.StoreResp, error)</span></span> {</span><br><span class="line">  resp, err := s.accounts.GetByToken(ctx, &amp;rpc.GetByTokenReq{</span><br><span class="line">    Token: req.AccountToken,</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> !dryRun(ctx) {</span><br><span class="line">    <span class="keyword">if</span> _, ok := s.store[req.Key]; !ok {</span><br><span class="line">      s.keysByAccount[req.AccountToke] += <span class="number">1</span></span><br><span class="line">    }</span><br><span class="line">    s.store[req.Key] = req.Val</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> &amp;rpc.StoreResp{}, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dryRun</span><span class="params">(ctx context.Context)</span> <span class="title">bool</span></span> {</span><br><span class="line">  md, ok := metadata.FromContext(ctx)</span><br><span class="line">  <span class="keyword">if</span> !ok {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">  val, ok := md[<span class="string">&quot;dry-run&quot;</span>]</span><br><span class="line">  <span class="keyword">if</span> !ok {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(val) &lt; <span class="number">1</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> val[<span class="number">0</span>] == <span class="string">&quot;1&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E48;&#x505A;&#x662F;&#x6709;&#x59A5;&#x534F;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x901A;&#x7528;&#x5316;&#x540E;&#x5C31;&#x5931;&#x53BB;&#x4E86;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x7684;&#x80FD;&#x529B;&#x3002;</p><p>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x6DFB;&#x52A0; <code>dry-run</code> &#x53C2;&#x6570;&#x7ED9; metadata&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  ctx, _ := context.WithTimeout(context.Background(), time.Second)</span><br><span class="line">  ctx = metadata.NewContext(ctx, metadata.Pairs(<span class="string">&quot;dry-run&quot;</span>, <span class="string">&quot;1&quot;</span>))</span><br><span class="line">  _, err = cache.Store(ctx, &amp;rpc.StoreReq{Key: <span class="string">&quot;gopher&quot;</span>, Val: []<span class="keyword">byte</span>(<span class="string">&quot;con&quot;</span>)})</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="sheng-chan-huan-jing-an-li-retry"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Retry" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Retry"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Retry <a href="#sheng-chan-huan-jing-an-li-retry" class="header-anchor">#</a></h3><p>&#x5B9E;&#x73B0;&#x4E86; Dry Run &#x4EE5;&#x4E3A;&#x53EF;&#x4EE5;&#x4F11;&#x606F;&#x4E86;&#xFF0C;&#x4E4B;&#x524D;&#x62B1;&#x6028;&#x6162;&#x7684;&#x5BA2;&#x6237;&#x53C8;&#x6765;&#x62B1;&#x6028;&#x4E86;&#xFF0C;&#x867D;&#x7136;&#x6709;&#x8D85;&#x65F6;&#x63A7;&#x5236;&#xFF0C;&#x6EE1;&#x8DB3; SLA&#xFF0C;&#x4F46;&#x662F;&#x670D;&#x52A1;&#x90A3;&#x8FB9;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x603B;&#x8D85;&#x65F6;&#x4E0D;&#x6210;&#x529F;&#x3002;&#x68C0;&#x67E5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x53D1;&#x73B0;&#x662F;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x53EF;&#x4EE5;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x5BA2;&#x6237;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x91CD;&#x8BD5;&#x7684;&#x673A;&#x5236;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A; gRPC &#x8C03;&#x7528;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; Retry &#x673A;&#x5236;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x50CF;&#x4E4B;&#x524D;&#x8BA1;&#x65F6;&#x7EDF;&#x8BA1;&#x90A3;&#x6837;&#xFF0C;&#x4F7F;&#x7528; Interceptor &#x5427;&#xFF1F;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">clientInterceptor</span><span class="params">(...)</span> <span class="title">error</span></span> {</span><br><span class="line">  <span class="keyword">var</span> (</span><br><span class="line">    start     = time.Now()</span><br><span class="line">    attempts  = <span class="number">0</span></span><br><span class="line">    err       error</span><br><span class="line">    backoff   retryBackOff</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> {</span><br><span class="line">    attempts += <span class="number">1</span></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">      err = status.Errorf(codes.DeadlineExceeded, <span class="string">&quot;timeout reached before next retry attempt&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> &lt;-backoff.Next():</span><br><span class="line">      startAttempt := time.Now()</span><br><span class="line">      err = invoker(ctx, method, req, reply, cc, opts...)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        log.Printf(...)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  }</span><br><span class="line">  log.Printf(...)</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x770B;&#x8D77;&#x6765;&#x8FD8;&#x4E0D;&#x9519;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x6253;&#x7B97;&#x53D1;&#x5E03;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x4E86;&#x3002;&#x7ED3;&#x679C;&#x63D0;&#x4EA4;&#x5BA1;&#x6838;&#x7684;&#x65F6;&#x5019;&#x88AB;&#x6253;&#x56DE;&#x6765;&#x4E86;&#xFF0C;&#x8BF4;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x662F;<strong>&#x975E;&#x5E42;&#x7B49;&#xFF08;non-idempotent&#xFF09;</strong> &#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x591A;&#x6B21;&#x6267;&#x884C;&#xFF0C;&#x6539;&#x53D8;&#x671F;&#x671B;&#x7ED3;&#x679C;&#x4E86;&#x3002;</p><p>&#x770B;&#x6765;&#x6211;&#x4EEC;&#x5F97;&#x9488;&#x5BF9;&#x5E42;&#x7B49;&#x548C;&#x975E;&#x5E42;&#x7B49;&#x64CD;&#x4F5C;&#x533A;&#x522B;&#x5BF9;&#x5F85;&#x4E86;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">silo.FireZeMissiles(NotIdempotent(ctx), req)</span><br></pre></td></tr></table></figure><p>&#x55EF;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x6CA1;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6765;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x6807;&#x8BB0;&#xFF0C;&#x901A;&#x8FC7; context&#xFF0C;&#x6765;&#x6807;&#x660E;&#x64CD;&#x4F5C;&#x662F;&#x5426;&#x5E42;&#x7B49;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NotIdempotent</span><span class="params">(ctx context.Context)</span> <span class="title">context</span>.<span class="title">Context</span></span> {</span><br><span class="line">  <span class="keyword">return</span> context.WithValue(ctx, <span class="string">&quot;idempotent&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isIdempotent</span><span class="params">(ctx context.Context)</span> <span class="title">bool</span></span> {</span><br><span class="line">  val, ok := ctx.Value(<span class="string">&quot;idempotent&quot;</span>).(<span class="keyword">bool</span>)</span><br><span class="line">  <span class="keyword">if</span> !ok {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5728;&#x6211;&#x4EEC;&#x7684; <code>clientInterceptor()</code> &#x5B9E;&#x73B0;&#x4E2D;&#x52A0;&#x5165; <code>isIdempotent()</code> &#x5224;&#x65AD;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">clientInterceptor</span><span class="params">(...)</span> <span class="title">error</span></span> {</span><br><span class="line">  <span class="keyword">var</span> (</span><br><span class="line">    start     = time.Now()</span><br><span class="line">    attempts  = <span class="number">0</span></span><br><span class="line">    err       error</span><br><span class="line">    backoff   retryBackOff</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> {</span><br><span class="line">    attempts += <span class="number">1</span></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">      err = status.Errorf(codes.DeadlineExceeded, <span class="string">&quot;timeout reached before next retry attempt&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> &lt;-backoff.Next():</span><br><span class="line">      startAttempt := time.Now()</span><br><span class="line">      err = invoker(ctx, method, req, reply, cc, opts...)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; isIdempotent(ctx) {</span><br><span class="line">        log.Printf(...)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  }</span><br><span class="line">  log.Printf(...)</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5F53;&#x8C03;&#x7528;&#x5931;&#x8D25;&#x540E;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x68C0;&#x67E5;&#x53D1;&#x73B0;&#x662F;&#x5E42;&#x7B49;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x624D;&#x91CD;&#x8BD5;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x91CD;&#x8BD5;&#x3002;&#x907F;&#x514D;&#x4E86;&#x975E;&#x5E42;&#x7B49;&#x64CD;&#x4F5C;&#x7684;&#x53CD;&#x590D;&#x64CD;&#x4F5C;&#x3002;</p><h3 id="sheng-chan-huan-jing-an-li-jie-gou-hua-cuo-wu"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x7ED3;&#x6784;&#x5316;&#x9519;&#x8BEF;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x7ED3;&#x6784;&#x5316;&#x9519;&#x8BEF;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x7ED3;&#x6784;&#x5316;&#x9519;&#x8BEF; <a href="#sheng-chan-huan-jing-an-li-jie-gou-hua-cuo-wu" class="header-anchor">#</a></h3><p>&#x611F;&#x89C9;&#x6CA1;&#x5565;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x90E8;&#x7F72;&#x4E0A;&#x7EBF;&#x4E86;&#x3002;&#x53EF;&#x662F;&#x8FD0;&#x884C;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x6709;&#x4E9B;&#x4E0D;&#x5BF9;&#x52B2;&#x3002;&#x6240;&#x6709;&#x6210;&#x529F;&#x7684;RPC&#x8C03;&#x7528;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x672C;&#x8EAB;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x90FD;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x8D85;&#x65F6;&#x91CD;&#x8BD5;&#x4E5F;&#x6B63;&#x5E38;&#x3002;&#x4F46;&#x662F;&#x6240;&#x6709;&#x5931;&#x8D25;&#x7684; RPC &#x8C03;&#x7528;&#x90FD;&#x4E0D;&#x5BF9;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x5931;&#x8D25;&#x7684; RPC &#x8C03;&#x7528;&#xFF0C;&#x90FD;&#x8FD4;&#x56DE;&#x8D85;&#x65F6;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9519;&#x8BEF;&#x672C;&#x8EAB;&#x3002;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x5931;&#x8D25;&#xFF0C;&#x4E0D;&#x662F;&#x8BF4;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#x8D85;&#x65F6;&#x5565;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x8BF4;&#x8BF7;&#x6C42;&#x672C;&#x8EAB;&#x7684;&#x5931;&#x8D25;&#xFF0C;&#x6BD4;&#x5982;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#xFF0C;<code>Get()</code> &#x4E0D;&#x5B58;&#x5728;&#x7684;&#x952E;&#xFF0C;&#x5E94;&#x8BE5;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#xFF1B;&#x6216;&#x8005; <code>Store()</code> &#x8D85;&#x8FC7;&#x4E86;&#x914D;&#x989D;&#xFF0C;&#x5E94;&#x8BE5;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#xFF0C;&#x8FD9;&#x7C7B;&#x9519;&#x8BEF;&#x5728;&#x65E5;&#x5FD7;&#x4E2D;&#x90FD;&#x6CA1;&#x770B;&#x5230;&#xFF0C;&#x53CD;&#x800C;&#x90FD;&#x5BF9;&#x5E94;&#x4E86;&#x8D85;&#x65F6;&#x3002;</p><p>&#x7ECF;&#x8FC7;&#x5206;&#x6790;&#x53D1;&#x73B0;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x8BE5;&#x62A5;&#x9519;&#x90FD;&#x62A5;&#x9519;&#xFF0C;&#x6CA1;&#x5565;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x5BF9;&#xFF0C;&#x672C;&#x5E94;&#x8BE5;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7ED9;&#x8C03;&#x7528;&#x65B9;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4EE3;&#x7801;&#x53CD;&#x800C;&#x53C8;&#x5F00;&#x59CB;&#x91CD;&#x8BD5;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x4E86;&#x3002;&#x770B;&#x6765;&#x4E4B;&#x524D;&#x91CD;&#x8BD5;&#x7684;&#x4EE3;&#x7801;&#x8FD8;&#x6709;&#x95EE;&#x9898;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">err = invoker(ctx, method, req, reply, cc, opts...)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; isIdempotent(ctx) {</span><br><span class="line">  log.Printf(...)</span><br><span class="line">  <span class="keyword">continue</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x65E0;&#x8BBA; <code>err</code> &#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x53EA;&#x8981;&#x975E; <code>nil</code>&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x91CD;&#x8BD5;&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x662F;&#x4E0D;&#x5BF9;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x6709;&#x9488;&#x5BF9;&#x67D0;&#x4E9B;&#x9519;&#x8BEF;&#x91CD;&#x8BD5;&#xFF0C;&#x6BD4;&#x5982;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x5E94;&#x8BE5;&#x5BF9;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8FD4;&#x56DE;&#x7ED9;&#x8C03;&#x7528;&#x65B9;&#x7684;&#x9519;&#x8BEF;&#x91CD;&#x8BD5;&#xFF0C;&#x90A3;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x3002;</p><p>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5C31;&#x53D8;&#x6210;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x5BF9; <code>err</code> &#x5224;&#x65AD;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x91CD;&#x8BD5;&#xFF1F;</p><ul><li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684; Error Code&#xFF0C;&#x7279;&#x5B9A;&#x7684; Code &#x9700;&#x8981; Retry&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x90A3;&#x5C31;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49; gRPC &#x9519;&#x8BEF;&#x7801;&#xFF1B;</li><li>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; <code>Error</code> &#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x67D0;&#x79CD;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x6765;&#x544A;&#x77E5;&#x662F;&#x5426;&#x503C;&#x5F97; retry</li><li>&#x6216;&#x8005;&#x5E72;&#x8106;&#x628A;&#x9519;&#x8BEF;&#x7801;&#x653E;&#x5230; Response &#x7684;&#x6D88;&#x606F;&#x91CC;&#xFF0C;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x6D88;&#x606F;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;&#x9519;&#x8BEF;&#x7801;&#xFF0C;&#x6765;&#x6807;&#x660E;&#x662F;&#x5426;&#x9700;&#x8981; retry&#x3002;</li></ul><p>&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x7ED3;&#x6784;&#x5316;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x4E00;&#x4E2A; Error Code &#x548C;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x6761;&#x8DEF;&#x4E0D;&#x597D;&#x8D70;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x505A;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#x4E86;&#xFF0C;&#x575A;&#x6301;&#x4E00;&#x4E0B;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x514B;&#x670D;&#x7684;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4ECE; IDL &#x5F00;&#x59CB;&#xFF1A;</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Error</span> </span>{</span><br><span class="line">  <span class="built_in">int64</span> code = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">string</span> messsage = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">bool</span> temporary = <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">int64</span> userErrorCode = <span class="number">4</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A; Error &#x7C7B;&#x578B;&#x3002;</p><p><strong>rpc/error.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Error)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">  <span class="keyword">return</span> e.Message</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Errorf</span><span class="params">(code codes.Code, temporary <span class="keyword">bool</span>, msg <span class="keyword">string</span>, args ..<span class="keyword">interface</span>{})</span> <span class="title">error</span></span> {</span><br><span class="line">  <span class="keyword">return</span> &amp;Error{</span><br><span class="line">    Code:      <span class="keyword">int64</span>(code),</span><br><span class="line">    Message:   fmt.Sprintf(msg, args...),</span><br><span class="line">    Temporary: temporary,</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6709;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x548C;&#x6784;&#x9020;&#x8FD9;&#x4E2A; <code>Error</code> &#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x8BE5;&#x600E;&#x4E48;&#x628A;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4F20;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x5462;&#xFF1F;&#x7136;&#x540E;&#x95EE;&#x9898;&#x5C31;&#x5F00;&#x59CB;&#x53D8;&#x7684;&#x7E41;&#x7410;&#x8D77;&#x6765;&#x4E86;&#xFF1A;</p><p><strong>rpc/error.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MarshalError</span> <span class="params">(err error, ctx context.Context)</span> <span class="title">error</span></span> {</span><br><span class="line">  rerr, ok := err.(*Error)</span><br><span class="line">  <span class="keyword">if</span> !ok {</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  }</span><br><span class="line">  pberr, marshalerr := pb.Marshal(rerr)</span><br><span class="line">  <span class="keyword">if</span> marshalerr == <span class="literal">nil</span> {</span><br><span class="line">    md := metadata.Pairs(<span class="string">&quot;rpc-error&quot;</span>, base64.StdEncoding.EncodeToString(pberr))</span><br><span class="line">    _ = grpc.SetTrailer(ctx, md)</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> status.Errorf(codes.Code(rerr.Code), rerr.Message)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UnmarshalError</span><span class="params">(err error, md metadata.MD)</span> *<span class="title">Error</span></span> {</span><br><span class="line">  vals, ok := md[<span class="string">&quot;rpc-error&quot;</span>]</span><br><span class="line">  <span class="keyword">if</span> !ok {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  }</span><br><span class="line">  buf, err := base64.StdEncoding.DecodeString(vals[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">var</span> rerr Error</span><br><span class="line">  <span class="keyword">if</span> err := pb.Unmarshal(buf, &amp;rerr); err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> &amp;rerr</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><strong>interceptor.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">serverInterceptor</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  ctx context.Context,</span></span></span><br><span class="line"><span class="function"><span class="params">  req <span class="keyword">interface</span>{},</span></span></span><br><span class="line"><span class="function"><span class="params">  info *grpc.UnaryServerInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">  handler grpc.UnaryHandler,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="params">(<span class="keyword">interface</span>{}, error)</span></span> {</span><br><span class="line">  start := time.Now()</span><br><span class="line">  resp, err := handler(ctx, req)</span><br><span class="line">  err = rpc.MarshalError(err, ctx)</span><br><span class="line">  log.Print(...)</span><br><span class="line">  <span class="keyword">return</span> resp, err</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>it&#x2019;s ugly&#xFF0C;but works.</p><p>&#x8FD9;&#x662F;&#x5728; gRPC &#x4E0D;&#x652F;&#x6301;&#x9AD8;&#x7EA7; <code>Error</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x600E;&#x4E48;&#x53BB; work around &#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5E76;&#x4E14;&#x51D1;&#x5408;&#x7528;&#x8D77;&#x6765;&#x3002;&#x73B0;&#x5728;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x9519;&#x8BEF;&#x5C31;&#x53EF;&#x4EE5;&#x8DE8;&#x4E3B;&#x673A;&#x8FB9;&#x754C;&#x4F20;&#x9012;&#x4E86;&#x3002;</p><h3 id="sheng-chan-huan-jing-an-li-dump"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Dump" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Dump"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Dump <a href="#sheng-chan-huan-jing-an-li-dump" class="header-anchor">#</a></h3><p>&#x53C8;&#x6709;&#x5BA2;&#x6237;&#x524D;&#x6765;&#x63D0;&#x9700;&#x6C42;&#x4E86;&#xFF0C;&#x6709;&#x7684;&#x5BA2;&#x6237;&#x8BF4;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B58;&#x3001;&#x4E5F;&#x53EF;&#x4EE5;&#x53D6;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x4F55;&#x624D;&#x80FD;&#x628A;&#x91CC;&#x9762;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x90FD;&#x83B7;&#x53D6;&#x4E0B;&#x6765;&#xFF1F;&#x4E8E;&#x662F;&#x6709;&#x4E86;&#x9700;&#x6C42;&#xFF0C;&#x5E0C;&#x671B;&#x5B9E;&#x73B0; <code>Dump()</code> &#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x4EE5;&#x53D6;&#x56DE;&#x6240;&#x6709;&#x6570;&#x636E;&#x3002;</p><p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x8F7B;&#x8F66;&#x719F;&#x8DEF;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6539; IDL&#xFF0C;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; <code>Dump()</code> &#x51FD;&#x6570;&#x3002;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">service Cache {</span><br><span class="line">  rpc Store(StoreReq) returns (StoreResp) {}</span><br><span class="line">  rpc Get(GetReq) returns (GetResp) {}</span><br><span class="line">  rpc Dump(DumpReq) returns (DumpResp) {}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">message DumpReq{</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">message DumpResp {</span><br><span class="line">  repeated DumpItem items = <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">message DumpItem {</span><br><span class="line">  <span class="keyword">string</span> key = <span class="number">1</span>;</span><br><span class="line">  bytes val = <span class="number">2</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC; <code>DumpResp</code> &#x91CC;&#x9762;&#x7528;&#x7684;&#x662F; <code>repeated</code>&#xFF0C;&#x56E0;&#x4E3A; protobuf &#x91CC;&#x9762;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x5565;&#x4E0D;&#x53EB; array&#x3002;</p><h3 id="sheng-chan-huan-jing-an-li-liu-liang-kong-zhi"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6D41;&#x91CF;&#x63A7;&#x5236;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6D41;&#x91CF;&#x63A7;&#x5236;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6D41;&#x91CF;&#x63A7;&#x5236; <a href="#sheng-chan-huan-jing-an-li-liu-liang-kong-zhi" class="header-anchor">#</a></h3><p>&#x65B0;&#x529F;&#x80FD; Dump &#x4E0A;&#x7EBF;&#x4E86;&#xFF0C;&#x7ED3;&#x679C;&#x53D1;&#x73B0;&#x5927;&#x5BB6;&#x90FD;&#x5F88;&#x559C;&#x6B22; Dump&#xFF0C;&#x6709;&#x5F88;&#x591A;&#x4EBA;&#x5728; Dump&#xFF0C;&#x7ED3;&#x679C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x5F00;&#x59CB;&#x4E0D;&#x591F;&#x4E86;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x9650;&#x5236;&#x624B;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x6D41;&#x91CF;&#x3002;</p><p>&#x67E5;&#x9605;&#x4E86;&#x6587;&#x6863;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x540C;&#x65F6;&#x6700;&#x5927;&#x6709;&#x591A;&#x5C11;&#x5E76;&#x53D1;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x591A;&#x9891;&#x7E41;&#x7684;&#x6765;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p><p><strong>server.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runServer</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  srv := grpc.NewServer(grpc.Creds(tlsCreds),</span><br><span class="line">    ServerInterceptor(),</span><br><span class="line">    grpc.MaxConcurrentStreams(<span class="number">64</span>),</span><br><span class="line">    grpc.InTapHandle(NewTap().Handler))</span><br><span class="line">  rpc.RegisterCacheServer(srv, NewCacheService(accounts))</span><br><span class="line">  l, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:5051&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  }</span><br><span class="line">  l = netutil.LimitListener(l, <span class="number">1024</span>)</span><br><span class="line">  <span class="keyword">return</span> srv.Serve(l)</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86; <code>netutil.LimitListener(l, 1024)</code> &#x63A7;&#x5236;&#x4E86;&#x603B;&#x5171;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x7528; <code>grpc.MaxConcurrentStreams(64)</code> &#x6307;&#x5B9A;&#x4E86;&#x6BCF;&#x4E2A; grpc &#x7684;&#x8FDE;&#x63A5;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x5E76;&#x53D1;&#x6D41;(stream)&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x57FA;&#x672C;&#x63A7;&#x5236;&#x4E86;&#x5E76;&#x53D1;&#x7684;&#x603B;&#x6570;&#x3002;</p><p>&#x4F46;&#x662F; gRPC &#x91CC;&#x6CA1;&#x6709;&#x5730;&#x65B9;&#x9650;&#x5B9A;&#x53EF;&#x4EE5;&#x591A;&#x9891;&#x7E41;&#x7684;&#x8BBF;&#x95EE;&#x3002;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x7528;&#x4E86; <code>grpc.InTapHandle(NewTap().Handler))</code> &#x6765;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#xFF0C;&#x8FD9;&#x662F;&#x5728;&#x66F4;&#x9760;&#x524D;&#x7684;&#x4F4D;&#x7F6E;&#x6267;&#x884C;&#x7684;&#x3002;</p><p><strong>tap.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Tap <span class="keyword">struct</span> {</span><br><span class="line">  lim *rate.Limiter</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTap</span><span class="params">()</span> *<span class="title">Tap</span></span> {</span><br><span class="line">  <span class="keyword">return</span> &amp;Tap(rate.NewLimiter(<span class="number">150</span>, <span class="number">5</span>))</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Tap)</span> <span class="title">Handler</span><span class="params">(ctx context.Context, info *tap.Info)</span> <span class="params">(context.Context, error)</span></span> {</span><br><span class="line">  <span class="keyword">if</span> !t.lim.Allow() {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, status.Errorf(codes.ResourceExhausted, <span class="string">&quot;service is over rate limit&quot;</span>)</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ctx, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="sheng-chan-huan-jing-an-li-streaming"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Streaming" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Streaming"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;Streaming <a href="#sheng-chan-huan-jing-an-li-streaming" class="header-anchor">#</a></h3><p>&#x4E4B;&#x524D;&#x7684;&#x65B9;&#x6848;&#x90E8;&#x7F72;&#x540E;&#xFF0C;&#x5185;&#x5B58;&#x7EC8;&#x4E8E;&#x964D;&#x4E0B;&#x6765;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x6CA1;&#x4F11;&#x606F;&#xFF0C;&#x5C31;&#x53D1;&#x73B0;&#x5927;&#x5BB6;&#x8D8A;&#x6765;&#x8D8A;&#x559C;&#x6B22;&#x7528;&#x8FD9;&#x4E2A;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#xFF0C;&#x5185;&#x5B58;&#x53C8;&#x4E0D;&#x591F;&#x7528;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x601D;&#x8003;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8C03;&#x6574;&#x4E00;&#x4E0B;&#x8BBE;&#x8BA1;&#xFF0C;&#x4E0D;&#x662F;&#x6BCF;&#x6B21; Dump &#x5C31;&#x7ACB;&#x5373;&#x5728;&#x5185;&#x5B58;&#x751F;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#xFF0C;&#x800C;&#x662F;&#x4EE5;&#x6D41;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x6309;&#x9700;&#x53D1;&#x56DE;&#x3002;</p><p><strong>app.proto</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"><span class="keyword">package</span> rpc;</span><br><span class="line"></span><br><span class="line">service Cache {</span><br><span class="line">  rpc Store(StoreReq) returns (StoreResp) {}</span><br><span class="line">  rpc Get(GetReq) returns (GetResp) {}</span><br><span class="line">  rpc Dump(DumpReq) returns (stream DumpItem) {}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">message DumpReq{</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">message DumpItem {</span><br><span class="line">  <span class="keyword">string</span> key = <span class="number">1</span>;</span><br><span class="line">  bytes val = <span class="number">2</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x6027;&#x8D28;&#x7684; <code>repeated</code>&#xFF0C;&#x800C;&#x662F;&#x7528; <code>stream</code>&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42; <code>Dump()</code> &#x540E;&#xFF0C;&#x5C06;&#x7ED3;&#x679C;&#x4EE5;&#x6D41;&#x7684;&#x5F62;&#x5F0F;&#x53D1;&#x56DE;&#x53BB;&#x3002;</p><p><strong>server.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CacheService)</span> <span class="title">Dump</span><span class="params">(req *rpc.DumpReq, stream rpc.Cache_DumpServer)</span> <span class="title">error</span></span> {</span><br><span class="line">  <span class="keyword">for</span> k, v := <span class="keyword">range</span> s.store {</span><br><span class="line">    stream.Send(&amp;rpc.DumpItem{</span><br><span class="line">      Key: k,</span><br><span class="line">      Val: v,</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x4FEE;&#x6539; <code>Dump()</code> &#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x8BB0;&#x5F55;&#xFF0C;&#x5229;&#x7528; <code>stream.Send()</code> &#x53D1;&#x9001;&#x5230;&#x6D41;&#x3002;</p><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6CA1;&#x6709; <code>context</code>&#xFF0C;&#x53EA;&#x6709;&#x4E2A; <code>stream</code>&#x3002;</p><p><strong>client.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runClient</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">  ...</span><br><span class="line">  stream, err := cache.Dump(context.Background(), &amp;rpc.DumpReq{})</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to dump: %v&quot;</span>, err)</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span> {</span><br><span class="line">    item, err := stream.Recv()</span><br><span class="line">    <span class="keyword">if</span> err == io.EOF {</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">      <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to stream item: %v&quot;</span>, err)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="sheng-chan-huan-jing-an-li-heng-xiang-kuo-zhan-fu-zai-jun-heng"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x3001;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x3001;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x3001;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#sheng-chan-huan-jing-an-li-heng-xiang-kuo-zhan-fu-zai-jun-heng" class="header-anchor">#</a></h3><p>&#x4F7F;&#x7528;&#x6D41;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x6027;&#x80FD;&#x63D0;&#x9AD8;&#x4E86;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x592A;&#x5438;&#x5F15;&#x4EBA;&#x4E86;&#xFF0C;&#x7528;&#x6237;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x7ED3;&#x679C;&#x53C8;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#x4E86;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5BA1;&#x67E5;&#x4EE3;&#x7801;&#xFF0C;&#x611F;&#x89C9;&#x80FD;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x90FD;&#x505A;&#x4E86;&#xFF0C;&#x6216;&#x8BB8;&#x662F;&#x65F6;&#x5019;&#x4ECE;&#x5355;&#x4E00;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6269;&#x5C55;&#x4E3A;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x4E4B;&#x95F4;&#x4F7F;&#x7528;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p><p>gRPC &#x662F;&#x957F;&#x8FDE;&#x63A5;&#x6027;&#x8D28;&#x7684;&#x901A;&#x8BAF;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x4E86;&#x4E00;&#x4E2A; gRPC Endpoint&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x5C31;&#x4F1A;&#x4E00;&#x76F4;&#x8FDE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x591A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x8BF4;&#x662F;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#xFF0C;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x5927;&#x91CF;&#x7684;&#x8BF7;&#x6C42;&#x800C;&#x5BFC;&#x81F4;&#x5206;&#x6563;&#x8BF7;&#x6C42;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x53BB;&#x3002;</p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x591A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x66F4;&#x667A;&#x80FD;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x610F;&#x8BC6;&#x5230;&#x670D;&#x52A1;&#x5668;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x56E0;&#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x5EFA;&#x7ACB;&#x591A;&#x6761;&#x8FDE;&#x63A5;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x8BA9;&#x5355;&#x4E00;&#x5BA2;&#x6237;&#x7AEF;&#x5229;&#x7528;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x80FD;&#x529B;&#x3002;</p><h3 id="sheng-chan-huan-jing-an-li-duo-yu-yan-xie-zuo"><a href="#&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x8BED;&#x8A00;&#x534F;&#x4F5C;" class="headerlink" title="&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x8BED;&#x8A00;&#x534F;&#x4F5C;"></a>&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6848;&#x4F8B;&#xFF1A;&#x591A;&#x8BED;&#x8A00;&#x534F;&#x4F5C; <a href="#sheng-chan-huan-jing-an-li-duo-yu-yan-xie-zuo" class="header-anchor">#</a></h3><p>&#x5728;&#x590D;&#x6742;&#x7684;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC; gRPC &#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x751A;&#x81F3;&#x670D;&#x52A1;&#x7AEF;&#xFF09;&#x53EF;&#x80FD;&#x662F;&#x4E0D;&#x540C;&#x8BED;&#x8A00;&#x5E73;&#x53F0;&#x7684;&#x3002;&#x8FD9;&#x5176;&#x5B9E;&#x662F; gRPC &#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x7684;&#x5B9E;&#x73B0;&#x8DE8;&#x8BED;&#x8A00;&#x5E73;&#x53F0;&#x7684;&#x901A;&#x8BAF;&#x3002;</p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x505A;&#x4E00;&#x4E2A; Python &#x5BA2;&#x6237;&#x7AEF;&#xFF1A;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> rpc_pb2 <span class="keyword">as</span> rpc</span><br><span class="line"></span><br><span class="line">channel = grpc.insecure_channel(<span class="string">&apos;localhost:5051&apos;</span>)</span><br><span class="line">cache_svc = rpc.CacheStub(channel)</span><br><span class="line"></span><br><span class="line">resp = cache_svc.Get(rpc.GetReq(</span><br><span class="line">  key=<span class="string">&quot;gopher&quot;</span>,</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> resp.val</span><br></pre></td></tr></table></figure><p>&#x4E00;&#x4E2A;&#x4E0D;&#x662F;&#x5F88;&#x723D;&#x7684;&#x5730;&#x65B9;&#x662F;&#x867D;&#x7136; gRPC &#x7684;&#x8DE8;&#x8BED;&#x8A00;&#x901A;&#x8BAF;&#x5F88;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x5404;&#x4E2A;&#x8BED;&#x8A00;&#x7684;&#x5B9E;&#x73B0;&#x90FD;&#x6BD4;&#x8F83;&#x968F;&#x610F;&#xFF0C;&#x6BD4;&#x5982; Go &#x4E2D;&#x53EB;&#x505A; <code>CacheClient()</code>&#xFF0C;&#x800C; Python &#x4E2D;&#x5219;&#x53EB;&#x505A; <code>CacheStub()</code>&#x3002;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7279;&#x522B;&#x7684;&#x539F;&#x56E0;&#x975E;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x5C31;&#x662F;&#x7531;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x4F5C;&#x8005;&#x5B9E;&#x73B0;&#x7684;&#x65F6;&#x5019;&#x6309;&#x7167;&#x81EA;&#x5DF1;&#x7684;&#x60F3;&#x6CD5;&#x547D;&#x540D;&#x7684;&#x3002;</p><h2 id="grpc-shang-bu-wan-mei-de-di-fang"><a href="#gRPC-&#x5C1A;&#x4E0D;&#x5B8C;&#x7F8E;&#x7684;&#x5730;&#x65B9;" class="headerlink" title="gRPC &#x5C1A;&#x4E0D;&#x5B8C;&#x7F8E;&#x7684;&#x5730;&#x65B9;"></a>gRPC &#x5C1A;&#x4E0D;&#x5B8C;&#x7F8E;&#x7684;&#x5730;&#x65B9; <a href="#grpc-shang-bu-wan-mei-de-di-fang" class="header-anchor">#</a></h2><ul><li>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li><li>&#x7ED3;&#x6784;&#x5316;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</li><li>&#x8FD8;&#x4E0D;&#x652F;&#x6301;&#x6D4F;&#x89C8;&#x5668;&#x7684; JS &#xFF08;&#x67D0;&#x79CD;&#x89D2;&#x5EA6;&#x4E0A;&#x8BB2;&#xFF0C;&#x8FD9;&#x662F;&#x6700;&#x5E38;&#x7528;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;</li><li>&#x8FD8;&#x7ECF;&#x5E38;&#x53D1;&#x751F; API &#x6539;&#x53D8;&#xFF08;&#x5373;&#x4F7F;&#x90FD;1.0&#x4E86;&#xFF09;</li><li>&#x67D0;&#x4E9B;&#x8BED;&#x8A00;&#x5B9E;&#x73B0;&#x7684;&#x6587;&#x6863;&#x975E;&#x5E38;&#x5DEE;</li><li>&#x6CA1;&#x6709;&#x8DE8;&#x8BED;&#x8A00;&#x7684;&#x6807;&#x51C6;&#x5316;&#x7684;&#x505A;&#x6CD5;</li></ul><h2 id="grpc-zai-sheng-chan-huan-jing-zhong-de-yong-li"><a href="#gRPC-&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x7528;&#x4F8B;" class="headerlink" title="gRPC &#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x7528;&#x4F8B;"></a>gRPC &#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x7528;&#x4F8B; <a href="#grpc-zai-sheng-chan-huan-jing-zhong-de-yong-li" class="header-anchor">#</a></h2><ul><li>ngrok&#xFF0C;&#x6240;&#x6709;&#x5185;&#x90E8;20&#x591A;&#x4E2A;&#x901A;&#x8BAF;&#x90FD;&#x8D70;&#x7684;&#x662F; gRPC</li><li>Square&#xFF0C;&#x5C06;&#x5185;&#x90E8;&#x7684;&#x901A;&#x8BAF;&#x90FD;&#x6362;&#x6210;&#x4E86; gRPC&#xFF0C;&#x662F;&#x6700;&#x65E9;&#x4F7F;&#x7528; gRPC &#x7684;&#x7528;&#x6237;&#x548C;&#x8D21;&#x732E;&#x8005;</li><li>CoreOS&#xFF0C;etcd v3 &#x5B8C;&#x5168;&#x8D70;&#x7684;&#x662F; gRPC</li><li>Google&#xFF0C;Google Cloud Service&#xFF08;PubSub, Speech Rec&#xFF09;&#x8D70;&#x7684;&#x662F; gRPC</li><li>Netflix, Yik Yak, VSCO, Cockroach, &#x2026;</li></ul><h2 id="grpc-wei-lai-de-bian-hua"><a href="#gRPC-&#x672A;&#x6765;&#x7684;&#x53D8;&#x5316;" class="headerlink" title="gRPC &#x672A;&#x6765;&#x7684;&#x53D8;&#x5316;"></a>gRPC &#x672A;&#x6765;&#x7684;&#x53D8;&#x5316; <a href="#grpc-wei-lai-de-bian-hua" class="header-anchor">#</a></h2><ul><li>&#x60F3;&#x4E86;&#x89E3;&#x672A;&#x6765;&#x7684;&#x53D8;&#x5316;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#xFF1A;<ul><li><a href="https://github.com/grpc/proposal" target="_blank" rel="noopener">grpc/proposal</a></li><li><a href="https://groups.google.com/forum/#!forum/grpc-io" target="_blank" rel="noopener">grpc-io &#x90AE;&#x4EF6;&#x5217;&#x8868;</a></li></ul></li><li>&#x65B0;&#x7684;&#x8BED;&#x8A00;&#x652F;&#x6301;&#xFF08;<a href="https://github.com/grpc/grpc-swift" target="_blank" rel="noopener">Swift</a> &#x548C; <a href="https://github.com/grpc/grpc-haskell" target="_blank" rel="noopener">Haskell</a>&#x6B63;&#x5728;&#x8BD5;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;</li><li>&#x7A33;&#x5B9A;&#x6027;&#x3001;&#x53EF;&#x9760;&#x6027;&#x3001;&#x6027;&#x80FD;&#x7684;&#x63D0;&#x9AD8;</li><li>&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7EC6;&#x5316;&#x7684; API &#x6765;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x884C;&#x4E3A;&#xFF08;&#x8FDE;&#x63A5;&#x7BA1;&#x7406;&#x3001;&#x9891;&#x9053;&#x8DDF;&#x8E2A;&#xFF09;</li><li>&#x6D4F;&#x89C8;&#x5668;&#x7684; JS</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2017" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2017/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Go 数据科学 - Daniel Whitenack</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-22-video-go-for-data-science.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-22-video-go-for-data-science.html</id>
    <published>2017-09-21T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.624Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a><ul><li><a href="#shi-me-shi-data-science">&#x4EC0;&#x4E48;&#x662F; Data Science</a></li><li><a href="#data-science-de-struggle">Data science &#x7684; struggle</a><ul><li><a href="#integrity">Integrity</a></li><li><a href="#bu-shu">&#x90E8;&#x7F72;</a></li></ul></li><li><a href="#zuo-yi-ci-data-science">&#x505A;&#x4E00;&#x6B21; Data Science</a></li><li><a href="#arithmetic-he-visualization">Arithmetic &#x548C; Visualization</a></li><li><a href="#prediction">Prediction</a></li><li><a href="#qi-ta-shu-ju-xiang-guan-de-xiang-mu">&#x5176;&#x5B83;&#x6570;&#x636E;&#x76F8;&#x5173;&#x7684;&#x9879;&#x76EE;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Go for Data Science</strong><br>by Daniel Whitenack<br>at GopherCon 2016</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/D5tDubyXLrQ" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=D5tDubyXLrQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=D5tDubyXLrQ</a></p><p>&#x5E7B;&#x706F;&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/dwhitena/slides/tree/master/gophercon2016" target="_blank" rel="noopener">https://github.com/dwhitena/slides/tree/master/gophercon2016</a></p><h2 id="shi-me-shi-data-science"><a href="#&#x4EC0;&#x4E48;&#x662F;-Data-Science" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Data Science"></a>&#x4EC0;&#x4E48;&#x662F; Data Science <a href="#shi-me-shi-data-science" class="header-anchor">#</a></h2><ul><li>ETL, Data Cleaning, Organization</li><li>Parsing, Extraction of Patterns</li><li>Arithmetic</li></ul><h2 id="data-science-de-struggle"><a href="#Data-science-&#x7684;-struggle" class="headerlink" title="Data science &#x7684; struggle"></a>Data science &#x7684; struggle <a href="#data-science-de-struggle" class="header-anchor">#</a></h2><h3 id="integrity"><a href="#Integrity" class="headerlink" title="Integrity"></a>Integrity <a href="#integrity" class="header-anchor">#</a></h3><p>&#x4F7F;&#x7528; python &#x7ECF;&#x5E38;&#x51FA;&#x73B0;&#x65E0;&#x6CD5;&#x9884;&#x671F;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><p>&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x5206;&#x522B;&#x4F7F;&#x7528; python &#x548C; golang &#x8BFB;&#x53D6; CSV &#x7684;&#x6570;&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x6C42;&#x7B2C;&#x4E00;&#x5217;&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;</p><p>Python &#x4EE3;&#x7801;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">cols = [</span><br><span class="line">  <span class="string">&apos;integercolumn&apos;</span>,</span><br><span class="line">  <span class="string">&apos;stringcolumn&apos;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&apos;example.csv&apos;</span>, names=cols)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> data[<span class="string">&apos;integercolumn&apos;</span>].max()</span><br></pre></td></tr></table></figure><p>Go &#x4EE3;&#x7801;&#xFF1A;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">f, err := os.Open(<span class="string">&quot;example.csv&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">  err = errors.Wrap(err, <span class="string">&quot;Could not open CSV&quot;</span>)</span><br><span class="line">  log.Fatal(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">r := csv.NewReader(bufio.NewReader(f))</span><br><span class="line">records, err := r.ReadAll()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">  err = errors.Wrap(err, <span class="string">&quot;Could not parse CSV&quot;</span>)</span><br><span class="line">  log.Fatal(err)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intMax <span class="keyword">int</span></span><br><span class="line"><span class="keyword">for</span> _, record := <span class="keyword">range</span> records {</span><br><span class="line">  intVal, err := strconv.Atoi(record[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    err = errors.Wrap(err, <span class="string">&quot;Parse failed&quot;</span>)</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> intVal &gt; intMax {</span><br><span class="line">    intMax = intVal</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">fmt.Println(intMax)</span><br></pre></td></tr></table></figure><p>&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E00;&#x4E9B;&#x90FD;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6570;&#x636E;&#x6709;&#x7F3A;&#x5931;&#xFF0C;&#x6BD4;&#x5982;&#x67D0;&#x4E9B;&#x5217;&#x503C;&#x7F3A;&#x5931;&#x3002;&#x5BF9;&#x4E8E; golang &#x800C;&#x8A00;&#xFF0C;&#x4F1A;&#x5F88;&#x4E25;&#x8C28;&#x7684;&#x62A5;&#x9519;&#xFF0C;&#x800C; python &#x7684;&#x4E0D;&#x62A5;&#x9519;&#xFF0C;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x65F6;&#x95F4;&#x4E00;&#x4E45;&#xFF0C;&#x6570;&#x636E;&#x91CF;&#x4E00;&#x5927;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x6CA1;&#x6CD5;&#x6392;&#x969C;&#xFF0C;&#x56E0;&#x4E3A;&#x6839;&#x672C;&#x4E0D;&#x77E5;&#x9053;&#x54EA;&#x91CC;&#x51FA;&#x8FC7;&#x9519;&#x8BEF;&#x3002;</p><p>&#x6BD4;&#x5982;&#x5F53;&#x4E09;&#x884C;&#x4E09;&#x5217;&#x8F93;&#x5165;&#x7ED9;&#x5165;&#xFF0C;&#x800C;&#x7B2C;&#x4E09;&#x884C;&#x7684;&#x7B2C;&#x4E00;&#x5217;&#x7F3A;&#x5931;&#x7684;&#x65F6;&#x5019;&#x3002;</p><p>Python &#x8FD4;&#x56DE;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python example2.py</span><br><span class="line">2.0</span><br></pre></td></tr></table></figure><p>&#x800C; golang &#x8FD4;&#x56DE;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> run example2.<span class="keyword">go</span></span><br><span class="line"><span class="number">2016</span>/<span class="number">05</span>/<span class="number">12</span> <span class="number">13</span>:<span class="number">23</span>:<span class="number">53</span> Parse failed: strconv.ParseInt: parsing <span class="string">&quot;&quot;</span>: invalid syntax</span><br><span class="line">exit status <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="bu-shu"><a href="#&#x90E8;&#x7F72;" class="headerlink" title="&#x90E8;&#x7F72;"></a>&#x90E8;&#x7F72; <a href="#bu-shu" class="header-anchor">#</a></h3><ul><li>GCE or AWS</li><li>SciKit</li><li>Numpy</li><li>Pandas</li></ul><p>&#x5373;&#x4F7F;&#x5199;&#x597D;&#x4E86;&#x89C9;&#x5F97;&#x5F88;&#x8D5E;&#x7684; Data Science &#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6BCF;&#x6B21;&#x90E8;&#x7F72;&#x7684;&#x90FD;&#x9700;&#x8981;&#x548C; Ops &#x5750;&#x4E0B;&#x6765;&#x8BE6;&#x7EC6;&#x7684;&#x8C08;&#x5E94;&#x8BE5;&#x7528;&#x4EC0;&#x4E48;&#x4E91;&#xFF0C;&#x91CC;&#x9762;&#x90FD;&#x88C5;&#x4EC0;&#x4E48;&#x5E93;&#xFF0C;&#x4EE5;&#x53CA;&#x90FD;&#x4EC0;&#x4E48;&#x7248;&#x672C;&#x7B49;&#x7B49;&#xFF0C;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4F1A;&#x53D8;&#x5F97;&#x76F8;&#x5F53;&#x7E41;&#x7410;&#x548C;&#x590D;&#x6742;&#x3002;&#x5373;&#x4F7F;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x8D85;&#x957F;&#x7684; Dockerfile &#x6765;&#x6784;&#x5EFA;&#x6240;&#x9700;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x4E4B;&#x540E;&#x81EA;&#x5DF1;&#x8FDB;&#x884C;&#x7EF4;&#x62A4;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x4E5F;&#x53D8;&#x5F97;&#x4E0D;&#x5927;&#x73B0;&#x5B9E;&#x3002;</p><p>&#x800C;&#x5728; golang &#x4E2D;&#x5219;&#x5B8C;&#x5168;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A; golang &#x662F;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x7F16;&#x8BD1;&#x597D;&#xFF0C;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x90FD;&#x5728;&#x91CC;&#x9762;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x4E00;&#x5207;&#x4E00;&#x4E0B;&#x5B50;&#x5C31;&#x53D8;&#x8F7B;&#x677E;&#x4E86;&#x3002;Dockerfile &#x53EF;&#x4EE5;&#x53D8;&#x5F97;&#x8D85;&#x7B80;&#x5355;&#xFF1A;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM scratch</span><br><span class="line">ADD myservice /myservice</span><br><span class="line">CMD [&quot;/myservice&quot;]</span><br></pre></td></tr></table></figure><h2 id="zuo-yi-ci-data-science"><a href="#&#x505A;&#x4E00;&#x6B21;-Data-Science" class="headerlink" title="&#x505A;&#x4E00;&#x6B21; Data Science"></a>&#x505A;&#x4E00;&#x6B21; Data Science <a href="#zuo-yi-ci-data-science" class="header-anchor">#</a></h2><ul><li>&#x4F7F;&#x7528; <code>github.com/google/go-github/github</code> &#x5305;&#x6765;&#x83B7;&#x53D6; Github &#x7684; go &#x9879;&#x76EE;&#x7684;&#x4FE1;&#x606F;&#x3002;</li><li>&#x4F7F;&#x7528; <code>pachyderm</code> &#x6765;&#x7EC4;&#x7EC7;&#x6570;&#x636E;&#xFF0C;pachyderm &#x4E5F;&#x662F;&#x7528; Go &#x5199;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x57FA;&#x4E8E; k8s&#x3002;&#x6709;&#x4E00;&#x4E2A; pfs &#x7684;&#x7C7B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;</li></ul><h2 id="arithmetic-he-visualization"><a href="#Arithmetic-&#x548C;-Visualization" class="headerlink" title="Arithmetic &#x548C; Visualization"></a>Arithmetic &#x548C; Visualization <a href="#arithmetic-he-visualization" class="header-anchor">#</a></h2><p>&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>gonum</code></p><ul><li>plot</li><li>graph</li><li>stat</li><li>integrate</li><li>lapack</li><li>unit</li><li>matrix</li><li>mathext</li><li>floats</li><li>blas</li><li>optimize</li></ul><p>&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x77E9;&#x9635;&#x8FD0;&#x7B97;(matrix)&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x753B;&#x56FE;(plot)&#x3002;</p><h2 id="prediction"><a href="#Prediction" class="headerlink" title="Prediction"></a>Prediction <a href="#prediction" class="header-anchor">#</a></h2><p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7EBF;&#x6027;&#x56DE;&#x5F52;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>github.com/sajari/regression</code> &#x8FD9;&#x4E2A;&#x5305;&#x3002;</p><p>&#x9884;&#x6D4B;&#xFF0C;2016&#x5E74;&#x8BB2;&#x5EA7;&#x8FD9;&#x5929;&#x4F1A;&#x6709;195&#x4E2A;&#x9879;&#x76EE;&#x5EFA;&#x7ACB;&#xFF0C;2017&#x5E74;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x4F1A;&#x6709; 240 &#x4E2A;&#x9879;&#x76EE;&#x5EFA;&#x7ACB;&#x3002;</p><h2 id="qi-ta-shu-ju-xiang-guan-de-xiang-mu"><a href="#&#x5176;&#x5B83;&#x6570;&#x636E;&#x76F8;&#x5173;&#x7684;&#x9879;&#x76EE;" class="headerlink" title="&#x5176;&#x5B83;&#x6570;&#x636E;&#x76F8;&#x5173;&#x7684;&#x9879;&#x76EE;"></a>&#x5176;&#x5B83;&#x6570;&#x636E;&#x76F8;&#x5173;&#x7684;&#x9879;&#x76EE; <a href="#qi-ta-shu-ju-xiang-guan-de-xiang-mu" class="header-anchor">#</a></h2><ul><li>gophernotes: &#x4EA4;&#x4E92;&#x5F0F;&#x7684; Go notebooks</li><li>GoLearn: &#x901A;&#x7528;&#x7684;&#x673A;&#x5668;&#x5B66;&#x4E60;</li><li>glow: &#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x7CFB;&#x7EDF;(map reduce)</li><li>GoBot: &#x4E13;&#x95E8;&#x4E3A;&#x4F20;&#x611F;&#x5668;&#x548C; IoT &#x51C6;&#x5907;&#x7684; Go&#x7684;&#x5E93;</li><li>golang &#x5C06;&#x5185;&#x90E8;&#x652F;&#x6301;&#x591A;&#x7EF4; slice</li><li>TensorFlow &#x63D0;&#x4F9B; Go API</li></ul><p>Gopher Slack &#x8FD8;&#x6709;&#x4E00;&#x4E2A; data science &#x9891;&#x9053;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2016" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2016/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：给 Go 库作者的建议 - Jack Lindamood</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-21-video-practice-advice-for-go-library-authors.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/golang-2017-09-21-video-practice-advice-for-go-library-authors.html</id>
    <published>2017-09-20T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.623Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a><ul><li><a href="#ming-ming">&#x547D;&#x540D;</a></li><li><a href="#object-creation">Object Creation</a></li><li><a href="#ri-zhi">&#x65E5;&#x5FD7;</a></li><li><a href="#interface-vs-struct"><code>interface</code> vs <code>struct</code></a></li><li><a href="#shi-me-shi-hou-panic">&#x4EC0;&#x4E48;&#x65F6;&#x5019; panic</a></li><li><a href="#jian-cha-error">&#x68C0;&#x67E5; error</a></li><li><a href="#yun-xu-qi-yong-ku-de-diao-shi-neng-li">&#x5141;&#x8BB8;&#x542F;&#x7528;&#x5E93;&#x7684;&#x8C03;&#x8BD5;&#x80FD;&#x529B;</a></li><li><a href="#wei-ce-shi-er-she-ji">&#x4E3A;&#x6D4B;&#x8BD5;&#x800C;&#x8BBE;&#x8BA1;</a></li><li><a href="#bing-fa">&#x5E76;&#x53D1;</a><ul><li><a href="#channels">channels</a></li><li><a href="#shi-me-shi-hou-fa-qi-goroutine">&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53D1;&#x8D77; <code>goroutine</code></a></li></ul></li><li><a href="#shi-me-shi-hou-shi-yong-context-context">&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F7F;&#x7528; context.Context</a></li><li><a href="#qi-ta-zhu-yi-shi-xiang">&#x5176;&#x5B83;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><strong>Practical Advice for Go Library Authors</strong><br>by Jack Lindamood<br>at GopherCon 2016</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/5v2fqm_8jYI" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=5v2fqm_8jYI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=5v2fqm_8jYI</a></p><p>&#x5E7B;&#x706F;&#x5730;&#x5740;&#xFF1A;<a href="http://go-talks.appspot.com/github.com/cep21/go-talks/practical-advice-for-go-library-authors.slide#1" target="_blank" rel="noopener">http://go-talks.appspot.com/github.com/cep21/go-talks/practical-advice-for-go-library-authors.slide#1</a></p><h2 id="ming-ming"><a href="#&#x547D;&#x540D;" class="headerlink" title="&#x547D;&#x540D;"></a>&#x547D;&#x540D; <a href="#ming-ming" class="header-anchor">#</a></h2><p>&#x5305;&#x540D;&#x662F;&#x5C06;&#x6765;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6240;&#x4EE5;&#x907F;&#x514D;&#x91CD;&#x590D;&#x5305;&#x540D;&#x548C;&#x7ED3;&#x6784;&#x4E0E;&#x51FD;&#x6570;&#x3002;&#x6BD4;&#x5982;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> h client.Client &#x2192; <span class="keyword">var</span> h http.Client</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.NewContext() =&gt; context.Background()</span><br></pre></td></tr></table></figure><h2 id="object-creation"><a href="#Object-Creation" class="headerlink" title="Object Creation"></a>Object Creation <a href="#object-creation" class="header-anchor">#</a></h2><p>golang &#x6CA1;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x79CD;&#x529E;&#x6CD5;</p><ul><li>&#x9ED8;&#x8BA4;&#x7684;<code>0</code>&#x503C;</li><li>&#x5355;&#x72EC;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;<code>NewSomething()</code></li></ul><p>&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4; <code>0</code> &#x503C;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;</p><p>&#x5728;&#x9ED8;&#x8BA4;<code>0</code>&#x503C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5404;&#x4E2A;&#x65B9;&#x6CD5;&#x8981;&#x5904;&#x7406;&#x597D;<code>0</code>&#x503C;&#xFF0C;&#x6BD4;&#x5982;&#x6709;&#x4E9B;&#x4E1C;&#x897F;&#x53D1;&#x73B0;&#x662F;<code>0</code>&#x503C;&#x540E;&#xFF0C;&#x7ED9;&#x5165;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p><p><code>New()</code> &#x6784;&#x9020;&#x51FD;&#x6570;&#x5F88;&#x7075;&#x6D3B;&#xFF0C;&#x53EF;&#x4EE5;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x60C5;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x4EE3;&#x7801;&#x9605;&#x8BFB;&#x4E0A;&#x4E0D;&#x5229;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x9690;&#x85CF;&#x4E86;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x3002;</p><p>&#x6709;&#x4E9B;&#x5E93;&#x4F7F;&#x7528;&#x79C1;&#x6709; struct&#xFF0C;&#x516C;&#x5F00;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;<code>authImpl struct</code> and <code>Auth interface</code>&#xFF0C;&#x8FD9;&#x662F;&#x53CD;&#x6A21;&#x5F0F;&#xFF0C;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;</p><p>&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528; <strong>Singleton</strong>&#xFF0C;&#x867D;&#x7136;&#x6807;&#x51C6;&#x5E93;&#x4E2D;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x4E86; <strong>Singleton</strong> &#x6A21;&#x5F0F;&#xFF0C;&#x4F46;&#x662F; Jack &#x4E2A;&#x4EBA;&#x4E0D;&#x559C;&#x6B22;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x3002;</p><p>&#x4F7F;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x9009;&#x9879;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x4E0D;&#x63A8;&#x8350;&#xFF1A;<code>NewSomething(WithThingA(), WithThingB())</code></p><h2 id="ri-zhi"><a href="#&#x65E5;&#x5FD7;" class="headerlink" title="&#x65E5;&#x5FD7;"></a>&#x65E5;&#x5FD7; <a href="#ri-zhi" class="header-anchor">#</a></h2><p>&#x4E00;&#x4E9B;&#x65E5;&#x5FD7;&#x662F;&#x76F4;&#x63A5;&#x6253;&#x5370;&#x5230;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53BB;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x597D;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x56E0;&#x4E3A;&#x7528;&#x6237;&#x5982;&#x679C;&#x60F3;&#x5173;&#x6839;&#x672C;&#x5173;&#x4E0D;&#x4E86;&#x3002;</p><p>&#x5EFA;&#x8BAE;</p><ul><li>&#x786E;&#x5B9A;&#x4E00;&#x4E0B;&#x4F5C;&#x4E3A;<strong>&#x5E93;</strong>&#x662F;&#x4E0D;&#x662F;&#x771F;&#x7684;&#x9700;&#x8981;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5E94;&#x8BE5;&#x628A;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x7684;&#x5DE5;&#x4F5C;&#x4EA4;&#x7ED9;&#x8C03;&#x7528;&#x65B9;&#x51B3;&#x5B9A;&#xFF1F;</li><li>&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x9700;&#x8981;&#x65E5;&#x5FD7;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x65B9;&#x5F0F;</li><li>&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x5230;&#x4E00;&#x4E2A; <code>interface</code></li><li>&#x4E0D;&#x8981;&#x5047;&#x5B9A;&#x4F20;&#x8FDB;&#x6765;&#x7684;&#x5C31;&#x662F;&#x6807;&#x51C6;&#x5E93;&#x7684; <code>log</code> &#xFF0C;&#x6709;&#x5F88;&#x591A;&#x9009;&#x62E9;&#x3002;</li><li>&#x5C0A;&#x91CD; <code>stdout</code> &#x548C; <code>stderr</code></li><li>&#x4E0D;&#x8981;&#x4F7F;&#x7528; <code>singleton</code></li></ul><h2 id="interface-vs-struct"><a href="#interface-vs-struct" class="headerlink" title="interface vs struct"></a><code>interface</code> vs <code>struct</code> <a href="#interface-vs-struct" class="header-anchor">#</a></h2><p>&#x63A5;&#x53D7; <code>interface</code> &#xFF0C;&#x4F46;&#x8FD4;&#x56DE;&#x7684;&#x662F; <code>struct</code></p><p>&#x8FD9;&#x70B9;&#x548C; Java &#x4E0D;&#x540C;&#xFF0C;Java &#x66F4;&#x503E;&#x5411;&#x4E8E;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x901A;&#x8FC7; <code>interface</code> &#x64CD;&#x4F5C;&#x3002;&#x800C; golang &#x4E0D;&#x9700;&#x8981;&#xFF0C;golang &#x4F7F;&#x7528;&#x7684;&#x662F;&#x9690;&#x6027;<code>interface</code>&#x3002;</p><h2 id="shi-me-shi-hou-panic"><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;-panic" class="headerlink" title="&#x4EC0;&#x4E48;&#x65F6;&#x5019; panic"></a>&#x4EC0;&#x4E48;&#x65F6;&#x5019; panic <a href="#shi-me-shi-hou-panic" class="header-anchor">#</a></h2><p>&#x6700;&#x597D;&#x90FD;&#x4E0D; <code>panic</code>&#x3002;&#x5982;&#x679C;&#x975E;&#x8981; <code>panic</code>&#xFF0C;&#x53EF;&#x80FD;&#x6700;&#x5408;&#x9002;&#x7684;&#x5730;&#x65B9;&#x662F; <code>init</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x56E0;&#x4E3A;&#x521A;&#x4E00;&#x8FD0;&#x884C;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x6302;&#x4E86;&#xFF0C;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x5904;&#x7406;&#x3002;&#x4F46;&#x5373;&#x4F7F;&#x5982;&#x6B64;&#xFF0C;&#x4E5F;&#x5C3D;&#x91CF;&#x4E0D;&#x8981; <code>panic</code>&#x3002;</p><h2 id="jian-cha-error"><a href="#&#x68C0;&#x67E5;-error" class="headerlink" title="&#x68C0;&#x67E5; error"></a>&#x68C0;&#x67E5; error <a href="#jian-cha-error" class="header-anchor">#</a></h2><p>&#x95EE;&#xFF1A;&#x6211;&#x4EEC;&#x662F;&#x9700;&#x8981;&#x68C0;&#x67E5;&#x6240;&#x6709;&#x7684; <code>error</code> &#x4E48;&#xFF1F;&#x6BD4;&#x5982;&#x6709;&#x4E9B;&#x4F3C;&#x4E4E;&#x4E0D;&#x5927;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;<br>&#x7B54;&#xFF1A;&#x9700;&#x8981;&#xFF0C;<strong>&#x7279;&#x522B;&#x662F;&#x4F60;&#x8BF4;&#x7684;&#x8FD9;&#x4E9B;&#x4E0D;&#x5927;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x7684;&#xFF01;&#xFF01;</strong></p><p>&#x6211;&#x4EEC;&#x7528; <code>error</code> &#x4EE3;&#x66FF;&#x4E86; <code>exception</code>&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x3002;</p><p>&#x5904;&#x7406;&#x7684;&#x529E;&#x6CD5;</p><ul><li>&#x6700;&#x597D;&#x7684;&#x529E;&#x6CD5;&#x662F; Bubble up&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4F20;&#x56DE;&#x8C03;&#x7528;&#x65B9;</li><li>&#x4F46;&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF08;&#x6BD4;&#x5982; <strong>go routine</strong>) &#x4E0D;&#x9002;&#x5408;&#xFF0C;&#x90A3;&#x5C31;&#xFF1A;<ul><li>&#x505A;&#x65E5;&#x5FD7;</li><li>&#x6216;&#x8005;&#x589E;&#x52A0;&#x67D0;&#x4E2A;&#x8BA1;&#x6570;&#x5668;</li></ul></li></ul><p>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x6BD4;&#x8F83;&#x5408;&#x9002;&#xFF1F;</p><ul><li>&#x5F53;&#x4E0D;&#x6EE1;&#x8DB3;&#x7EA6;&#x5B9A;</li><li>&#x5F53;&#x9700;&#x8981;&#x7684;&#x7B54;&#x6848;&#x65E0;&#x6CD5;&#x5F97;&#x5230;</li></ul><h2 id="yun-xu-qi-yong-ku-de-diao-shi-neng-li"><a href="#&#x5141;&#x8BB8;&#x542F;&#x7528;&#x5E93;&#x7684;&#x8C03;&#x8BD5;&#x80FD;&#x529B;" class="headerlink" title="&#x5141;&#x8BB8;&#x542F;&#x7528;&#x5E93;&#x7684;&#x8C03;&#x8BD5;&#x80FD;&#x529B;"></a>&#x5141;&#x8BB8;&#x542F;&#x7528;&#x5E93;&#x7684;&#x8C03;&#x8BD5;&#x80FD;&#x529B; <a href="#yun-xu-qi-yong-ku-de-diao-shi-neng-li" class="header-anchor">#</a></h2><h2 id="wei-ce-shi-er-she-ji"><a href="#&#x4E3A;&#x6D4B;&#x8BD5;&#x800C;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x4E3A;&#x6D4B;&#x8BD5;&#x800C;&#x8BBE;&#x8BA1;"></a>&#x4E3A;&#x6D4B;&#x8BD5;&#x800C;&#x8BBE;&#x8BA1; <a href="#wei-ce-shi-er-she-ji" class="header-anchor">#</a></h2><ul><li>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x81EA;&#x5DF1;&#x6D4B;&#x8BD5;</li><li>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x5E93;&#x7528;&#x6237;&#x6D4B;&#x8BD5;</li></ul><h2 id="bing-fa"><a href="#&#x5E76;&#x53D1;" class="headerlink" title="&#x5E76;&#x53D1;"></a>&#x5E76;&#x53D1; <a href="#bing-fa" class="header-anchor">#</a></h2><h3 id="channels"><a href="#channels" class="headerlink" title="channels"></a>channels <a href="#channels" class="header-anchor">#</a></h3><p>&#x867D;&#x7136; <strong>channel</strong> &#x662F; golang &#x4E00;&#x4E2A;&#x5904;&#x7406;&#x5E76;&#x53D1;&#x5F88;&#x597D;&#x5730;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x975E;&#x6240;&#x6709;&#x573A;&#x5408;&#x90FD;&#x9700;&#x8981;&#x3002;&#x6BD4;&#x5982;&#x6807;&#x51C6;&#x5E93;&#x4E2D;&#x5C31;&#x5F88;&#x5C11;&#x6709;&#x5728; API &#x4E2D;&#x4F7F;&#x7528; <code>channel</code> &#x7684;&#x3002;</p><ul><li>&#x5C06;&#x4F7F;&#x7528; <code>channel</code> &#x7684;&#x4F4D;&#x7F6E;&#x5411;&#x4E0A;&#x5C42;&#x79FB;&#x52A8;&#x3002;</li><li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</li><li>&#x4E0D;&#x8981;&#x6DF7;&#x5408;&#x4F7F;&#x7528; <code>mutex</code> &#x548C; <code>channel</code></li></ul><h3 id="shi-me-shi-hou-fa-qi-goroutine"><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53D1;&#x8D77;-goroutine" class="headerlink" title="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53D1;&#x8D77; goroutine"></a>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53D1;&#x8D77; <code>goroutine</code> <a href="#shi-me-shi-hou-fa-qi-goroutine" class="header-anchor">#</a></h3><ul><li>&#x6709;&#x4E00;&#x4E9B;&#x5E93;&#x7684; <code>New()</code> &#x4F1A;&#x53D1;&#x8D77;&#x4ED6;&#x4EEC;&#x7684; <code>goroutine</code>&#xFF0C;&#x8FD9;&#x662F;&#x4E0D;&#x597D;&#x7684;&#x3002;</li><li>&#x6807;&#x51C6;&#x5E93;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Serve()</code> &#x51FD;&#x6570;&#x3002;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684; <code>Close()</code> &#x51FD;&#x6570;</li><li>&#x5C06; <code>goroutine</code> &#x5411;&#x4E0A;&#x5C42;&#x63A8;</li></ul><h2 id="shi-me-shi-hou-shi-yong-context-context"><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F7F;&#x7528;-context-Context" class="headerlink" title="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F7F;&#x7528; context.Context"></a>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F7F;&#x7528; context.Context <a href="#shi-me-shi-hou-shi-yong-context-context" class="header-anchor">#</a></h2><ul><li>&#x6240;&#x6709;&#x7684;&#x963B;&#x585E;&#x3001;&#x957F;&#x65F6;&#x95F4;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x88AB; <code>cancel</code></li><li>&#x7531;&#x4E8E; <code>context.Context</code> &#x5F88;&#x5BB9;&#x6613;&#x5B58;&#x50A8;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x6EE5;&#x7528;&#x3002;&#x8981;&#x5C3D;&#x529B;&#x53BB;&#x907F;&#x514D;&#x4F7F;&#x7528; <code>Context</code></li><li><code>Singleton</code> &#x548C; <code>context.Value()</code> &#x662F;&#x540C;&#x6837;&#x6027;&#x8D28;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x50CF;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E00;&#x6837;&#xFF0C;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x6765;&#x8BF4;&#x662F;&#x4E2A;&#x9ED1;&#x7BB1;&#x3002;</li></ul><h2 id="qi-ta-zhu-yi-shi-xiang"><a href="#&#x5176;&#x5B83;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x5176;&#x5B83;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x5176;&#x5B83;&#x6CE8;&#x610F;&#x4E8B;&#x9879; <a href="#qi-ta-zhu-yi-shi-xiang" class="header-anchor">#</a></h2><ul><li>&#x5982;&#x679C;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x5F88;&#x96BE;&#x505A;&#xFF0C;&#x55EF;&#xFF0C;&#x90A3;&#x5C31;&#x8BA9;&#x522B;&#x4EBA;&#x53BB;&#x505A;&#x5427;</li><li>&#x4E3A;&#x4E86;&#x6548;&#x7387;&#x800C;&#x5347;&#x7EA7;<ul><li><strong>&#x4F46;&#x662F;</strong>&#xFF0C;&#x6B63;&#x786E;&#x6027;&#x8981;&#x6BD4;&#x6548;&#x7387;&#x91CD;&#x8981;&#xFF0C;&#x5728;&#x6B63;&#x786E;&#x6027;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x6CE8;&#x610F;&#x6548;&#x7387;</li></ul></li><li>&#x4E0D;&#x8981;&#x5728;&#x5E93;&#x4E2D;&#x4F7F;&#x7528; <code>/vendor</code> &#xFF08;&#x5728; <code>main</code> &#x5305;&#x4E2D;&#x53EF;&#x4EE5;&#xFF09;</li><li>&#x6CE8;&#x610F; <strong>build tag</strong></li><li>&#x4FDD;&#x6301;&#x5E72;&#x51C0;<ul><li>&#x5C3D;&#x91CF;&#x4F7F;&#x7528;<em>&#x6240;&#x6709;&#x7684;</em>&#x9759;&#x6001;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x6765;&#x68C0;&#x67E5;&#x4EE3;&#x7801;&#x3002;</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/categories/golang/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="golang" scheme="https://1x481n.github.io/blog.lab99.org/tags/golang/"/>
    
      <category term="gophercon2016" scheme="https://1x481n.github.io/blog.lab99.org/tags/gophercon2016/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：容器是如何炼成的？ - Jérôme Petazzoni</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2017-01-30-video-cgroups-namespaces-and-beyonds.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2017-01-30-video-cgroups-namespaces-and-beyonds.html</id>
    <published>2017-01-29T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.623Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#da-gang">&#x5927;&#x7EB2;</a></li><li><a href="#shi-me-shi-rong-qi">&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;</a><ul><li><a href="#cong-shang-ceng-shi-jiao-qu-kan-ta-shi-yi-ge-qing-liang-ji-xu-ni-ji">&#x4ECE;&#x4E0A;&#x5C42;&#x89C6;&#x89D2;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A;</a></li><li><a href="#dan-shi-cong-di-ceng-qu-kan-ta-shi-yi-ge-wan-hai-liao-de-chroot">&#x4F46;&#x662F;&#x4ECE;&#x5E95;&#x5C42;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x73A9;&#x55E8;&#x4E86;&#x7684; <code>chroot</code></a></li></ul></li><li><a href="#na-rong-qi-shi-zen-me-shi-xian-de">&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF1F;</a></li><li><a href="#rong-qi-ji-shi-1-control-groups">&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 1&#xFF1A;<code>Control Groups</code></a><ul><li><a href="#shi-me-shi-control-groups">&#x4EC0;&#x4E48;&#x662F; <code>Control Groups</code>&#xFF1F;</a></li><li><a href="#gai-lun">&#x6982;&#x8BBA;</a></li><li><a href="#nei-cun-cgroup-ji-zhang">&#x5185;&#x5B58; <code>cgroup</code>&#xFF1A;&#x8BB0;&#x8D26;</a></li><li><a href="#nei-cun-cgroup-xian-zhi">&#x5185;&#x5B58; <code>cgroup</code>&#xFF1A;&#x9650;&#x5236;</a></li><li><a href="#nei-cun-cgroup-yi-xie-xu-yao-zhu-yi-de-xi-jie">&#x5185;&#x5B58; <code>cgroup</code>&#xFF1A;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x7EC6;&#x8282;</a></li><li><a href="#hugetlb-cgroup"><code>HugeTLB cgroup</code></a></li><li><a href="#cpu-cgroup"><code>CPU cgroup</code></a></li><li><a href="#cpuset-cgroup"><code>cpuset cgroup</code></a></li><li><a href="#blkio-cgroup"><code>blkio cgroup</code></a></li><li><a href="#net-cls-he-net-prio-cgroup"><code>net_cls</code> &#x548C; <code>net_prio</code> <code>cgroup</code></a></li><li><a href="#she-bei-cgroup">&#x8BBE;&#x5907; <code>cgroup</code></a></li><li><a href="#freezer-cgroup"><code>freezer cgroup</code></a></li><li><a href="#yi-xie-zhu-yi-shi-xiang">&#x4E00;&#x4E9B;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li></ul></li><li><a href="#rong-qi-ji-shi-2-namespaces">&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 2&#xFF1A;<code>namespaces</code></a><ul><li><a href="#pid-namespace"><code>pid namespace</code></a></li><li><a href="#net-namespace"><code>net namespace</code></a><ul><li><a href="#li-lun-shang">&#x7406;&#x8BBA;&#x4E0A;</a></li><li><a href="#shi-ji-shang">&#x5B9E;&#x9645;&#x4E0A;</a></li></ul></li><li><a href="#mnt-namespace"><code>mnt namespace</code></a></li><li><a href="#uts-namespace"><code>uts namespace</code></a></li><li><a href="#ipc-namespace"><code>ipc namespace</code></a></li><li><a href="#user-namespace"><code>user namespace</code></a></li><li><a href="#namespace-cao-zuo"><code>namespace</code> &#x64CD;&#x4F5C;</a></li></ul></li><li><a href="#rong-qi-ji-shi-3-copy-on-write">&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 3&#xFF1A;<code>copy-on-write</code></a><ul><li><a href="#copy-on-write-cun-chu"><code>copy-on-write</code> &#x5B58;&#x50A8;</a></li></ul></li><li><a href="#qi-ta-xi-jie">&#x5176;&#x5B83;&#x7EC6;&#x8282;</a><ul><li><a href="#zheng-jiao-xing">&#x6B63;&#x4EA4;&#x6027;</a></li><li><a href="#capabilities">Capabilities</a></li><li><a href="#selinux-apparmor">SELinux / AppArmor</a></li></ul></li><li><a href="#shi-yong-cgroups-he-namespaces-de-rong-qi-yun-xing-shi">&#x4F7F;&#x7528; <code>cgroups</code> &#x548C; <code>namespaces</code> &#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;</a><ul><li><a href="#lxc">LXC</a></li><li><a href="#systemd-nspawn">systemd-nspawn</a></li><li><a href="#docker-engine">Docker Engine</a></li><li><a href="#rkt-runc">rkt, runC</a></li><li><a href="#na-yi-ge-zui-hao">&#x54EA;&#x4E00;&#x4E2A;&#x6700;&#x597D;&#xFF1F;</a></li></ul></li><li><a href="#shi-yong-qi-ta-ji-zhi-shi-xian-de-rong-qi-yun-xing-shi">&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;</a><ul><li><a href="#openvz">OpenVZ</a></li><li><a href="#jails-zones">Jails / Zones</a></li></ul></li><li><a href="#ru-he-shou-dong-jian-li-rong-qi">&#x5982;&#x4F55;&#x624B;&#x52A8;&#x5EFA;&#x7ACB;&#x5BB9;&#x5668;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Cgroups, namespaces and beyond: what are containers made from?<br>by J&#xE9;r&#xF4;me Petazzoni (@jpetazzo)<br>at DockerCon EU 2015</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/sK5i-N34im8" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=sK5i-N34im8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=sK5i-N34im8</a></p><p>&#x5E7B;&#x706F;&#x5730;&#x5740;&#xFF1A;<a href="http://www.slideshare.net/Docker/cgroups-namespaces-and-beyond-what-are-containers-made-from" target="_blank" rel="noopener">http://www.slideshare.net/Docker/cgroups-namespaces-and-beyond-what-are-containers-made-from</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>J&#xE9;r&#xF4;me Petazzoni (<a href="https://github.com/jpetazzo" target="_blank" rel="noopener">@jpetazzo</a>)&#xFF0C;&#x662F;&#x6CD5;&#x56FD;&#x8F6F;&#x4EF6;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x73B0;&#x5728;&#x4F4F;&#x5728;&#x52A0;&#x5DDE;&#x3002;&#x4ED6;&#x662F; <a href="https://en.wikipedia.org/wiki/DotCloud" target="_blank" rel="noopener">dotCloud</a> &#x7684;&#x8001;&#x5458;&#x5DE5;&#x4E86;&#xFF0C;&#x6784;&#x5EFA;&#x4E86;&#x5176; PaaS &#x5E73;&#x53F0;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x65E9;&#x5728; Docker &#x6210;&#x4E3A; Docker &#x4E4B;&#x524D;&#xFF0C;&#x4ED6;&#x5C31;&#x5DF2;&#x7ECF;&#x5728;&#x4E3A; Docker &#x5199;&#x4EE3;&#x7801;&#x4E86;&#x3002;&#x90FD;&#x5FEB; 5 &#x5E74;&#x4E86;&#x3002;</p><p>&#x975E;&#x5E38;&#x559C;&#x6B22;&#x5BA3;&#x8BB2;&#x5BB9;&#x5668;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x4F30;&#x8BA1;&#x662F; 2013 &#x5E74; 2 &#x6708;&#x5728;&#x6D1B;&#x6749;&#x77F6;&#x7684; SCALE &#x5927;&#x4F1A;&#x4E0A;&#x7684;&#x8BB2;&#x5EA7;&#x3002;</p><p>&#x975E;&#x5E38;&#x81EA;&#x8C6A;&#x81EA;&#x5DF1;&#x662F; Bash &#x5802;&#x7684;&#x6210;&#x5458;&#x3002;&#xFF08;&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;&#x89C9;&#x5F97;&#x592A;&#x70E6;&#x4E86;&#xFF0C;&#x5C31;&#x4F1A;&#x628A;&#x67D0;&#x4E9B;&#x4EE3;&#x7801;&#x6362;&#x6210;&#x4E00;&#x6BB5;&#x811A;&#x672C;&#x6765;&#x5B9E;&#x73B0;&#x2026;&#x2026;&#x1F639;&#xFF09;</p><h1 id="da-gang"><a href="#&#x5927;&#x7EB2;" class="headerlink" title="&#x5927;&#x7EB2;"></a>&#x5927;&#x7EB2; <a href="#da-gang" class="header-anchor">#</a></h1><p>&#x8FD9;&#x6B21;&#x8BB2;&#x5EA7;&#x662F;&#x6EE1;&#x6EE1;&#x7684;&#x5E72;&#x8D27;&#xFF1A;</p><ul><li>&#x4ECE;&#x4E0A;&#x5C42;&#x548C;&#x5E95;&#x5C42;&#x5206;&#x522B;&#x8BB2;&#x89E3;&#x5230;&#x5E95;&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#x3002;</li><li>&#x8BB2;&#x89E3;&#x5BB9;&#x5668;&#x7684;&#x57FA;&#x77F3;&#xFF1A;<code>namespaces</code>, <code>cgroups</code>, <code>copy-on-write storage</code></li><li>&#x5404;&#x79CD;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#xFF1A;<code>Docker</code>, <code>LXC</code>, <code>rkt</code>, <code>runC</code>, <code>systemd-nspawn</code>, <code>OpenVZ</code>, <code>Jails</code>, <code>Zones</code></li><li>&#x6700;&#x540E;&#x73B0;&#x573A;&#x7528;&#x7EAF;&#x624B;&#x5DE5;&#x6765;&#x5236;&#x4F5C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x1F44D;</li></ul><h1 id="shi-me-shi-rong-qi"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F;&#x5BB9;&#x5668;&#xFF1F; <a href="#shi-me-shi-rong-qi" class="header-anchor">#</a></h1><h2 id="cong-shang-ceng-shi-jiao-qu-kan-ta-shi-yi-ge-qing-liang-ji-xu-ni-ji"><a href="#&#x4ECE;&#x4E0A;&#x5C42;&#x89C6;&#x89D2;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x4ECE;&#x4E0A;&#x5C42;&#x89C6;&#x89D2;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A;"></a>&#x4ECE;&#x4E0A;&#x5C42;&#x89C6;&#x89D2;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A; <a href="#cong-shang-ceng-shi-jiao-qu-kan-ta-shi-yi-ge-qing-liang-ji-xu-ni-ji" class="header-anchor">#</a></h2><p>&#x6700;&#x521D;&#x4ECB;&#x7ECD;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x603B;&#x4F1A;&#x7528;&#x8FD9;&#x6837;&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x201D;&#x55EF;&#xFF0C;&#x5BB9;&#x5668;&#x561B;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x673A;&#x201D;&#xFF0C;&#x800C;&#x5B9E;&#x9645;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5374;&#x53C8;&#x7ECF;&#x5E38;&#x8BF4;&#x201D;Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x4E0D;&#x8981;&#x5728;&#x8FD9;&#x4E48;&#x7406;&#x89E3; Docker&#x201C;&#x3002;</p><p>&#x4E3A;&#x4EC0;&#x4E48;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x7528;&#x6237;&#x5565;&#x90FD;&#x4E0D;&#x61C2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x6237;&#x4ECE;&#x8868;&#x9762;&#x4E0A;&#x4F1A;&#x89C9;&#x5F97;&#x548C;&#x865A;&#x62DF;&#x673A;&#x63A5;&#x8FD1;&#xFF1A;</p><ul><li>&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x53D6;&#x5F97;&#x4E00;&#x4E2A; Shell&#xFF0C;&#x8F93;&#x5165;&#x547D;&#x4EE4;&#x548C;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li><li>&#x7528;&#x8D77;&#x6765;&#x611F;&#x89C9;&#x4E0A;<strong>&#x50CF;&#x662F;</strong>&#x865A;&#x62DF;&#x673A;<ul><li>&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;<ul><li>&#x8FD0;&#x884C; <code>ps</code> &#x7684;&#x65F6;&#x5019;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;</li></ul></li><li>&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;<ul><li><code>ip addr</code>, <code>ifconfig</code> &#x65F6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;</li></ul></li><li>&#x8FD8;&#x53EF;&#x4EE5;&#x4EE5; <code>root</code> &#x8EAB;&#x4EFD;&#x8FD0;&#x884C;&#x4E1C;&#x897F;</li><li>&#x751A;&#x81F3;&#x8FD8;&#x53EF;&#x4EE5;&#x7528; <code>apt</code>/<code>yum</code> &#x6765;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;</li><li>&#x8FD8;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x670D;&#x52A1;</li><li>&#x8FD8;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x7684;&#x9F13;&#x6363;&#x8DEF;&#x7531;&#x8868;&#x3001;<code>iptables</code>&#x2026;&#x2026;</li></ul></li></ul><h2 id="dan-shi-cong-di-ceng-qu-kan-ta-shi-yi-ge-wan-hai-liao-de-chroot"><a href="#&#x4F46;&#x662F;&#x4ECE;&#x5E95;&#x5C42;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x73A9;&#x55E8;&#x4E86;&#x7684;-chroot" class="headerlink" title="&#x4F46;&#x662F;&#x4ECE;&#x5E95;&#x5C42;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x73A9;&#x55E8;&#x4E86;&#x7684; chroot"></a>&#x4F46;&#x662F;&#x4ECE;&#x5E95;&#x5C42;&#x53BB;&#x770B;&#xFF1A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x73A9;&#x55E8;&#x4E86;&#x7684; <code>chroot</code> <a href="#dan-shi-cong-di-ceng-qu-kan-ta-shi-yi-ge-wan-hai-liao-de-chroot" class="header-anchor">#</a></h2><p>&#x5B83;&#x5E76;&#x4E0D;&#x50CF;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x56E0;&#x4E3A;&#xFF1A;</p><ul><li>&#x5B83;&#x7528;&#x7684;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x5185;&#x6838;</li><li>&#x5B83;&#x4E0D;&#x80FD;&#x542F;&#x52A8;&#x5230;&#x522B;&#x7684;&#x7CFB;&#x7EDF;&#xFF08;&#x6BD4;&#x5982;&#x5BB9;&#x5668;&#x91CC;&#x8DD1;&#x4E2A; FreeBSD)</li><li>&#x5B83;&#x4E0D;&#x80FD;&#x52A0;&#x8F7D;&#x81EA;&#x5DF1;&#x5185;&#x6838;&#x6A21;&#x5757;</li><li>&#x751A;&#x81F3;&#x4E0D;&#x9700;&#x8981;&#x4F5C;&#x4E3A; <code>PID</code> &#x4E3A; <code>1</code> &#x7684; <code>init</code></li><li>&#x800C;&#x4E14;&#x91CC;&#x9762;&#x6839;&#x672C;&#x4E0D;&#x8DD1; <code>syslogd</code>, <code>cron</code> &#x7B49;&#x7B49;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;</li></ul><p>&#x6240;&#x4EE5;&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x5BBF;&#x4E3B; <code>ps</code> &#x770B;&#x5230;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x70B9;&#x548C;&#x865A;&#x62DF;&#x673A;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x662F;&#x4E0D;&#x900F;&#x660E;&#x7684;&#x3002;</p><p>&#x800C;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;&#x53EA;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x7A7A;&#x95F4;&#x5185;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x800C;&#x770B;&#x4E0D;&#x5230;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x6216;&#x8005;&#x5BBF;&#x4E3B;&#x7A7A;&#x95F4;&#x5185;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x751F;&#x6D3B;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x4E16;&#x754C;&#x91CC;&#xFF0C;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF08;&#x5F53;&#x7136;&#x6307;Linux&#x4E0D;&#x540C;&#x7684;&#x53D1;&#x884C;&#x7248;&#x672C;&#xFF09;&#x3002;</p><h1 id="na-rong-qi-shi-zen-me-shi-xian-de"><a href="#&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF1F;" class="headerlink" title="&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF1F;"></a>&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF1F; <a href="#na-rong-qi-shi-zen-me-shi-xian-de" class="header-anchor">#</a></h1><p>5&#x5E74;&#x524D; J&#xE9;r&#xF4;me &#x52A0;&#x5165; dotCloud &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x60F3;&#x7406;&#x89E3;&#x4E00;&#x4E0B;&#x5565;&#x662F;&#x5BB9;&#x5668;&#xFF0C;&#x4E8E;&#x662F;&#x6765;&#x770B; Linux &#x5185;&#x6838;&#x6E90;&#x4EE3;&#x7801;&#x5427;&#xFF01;</p><p>&#x55EF;&#xFF0C;&#x8D76;&#x7D27;&#x8DD1;&#x5230; <a href="http://lxr.free-electrons.com/" target="_blank" rel="noopener">LXR</a> &#x53BB;&#x67E5;&#x9605; Linux &#x4EE3;&#x7801;</p><p>&#x7ED3;&#x679C;&#x53D1;&#x73B0;&#xFF0C;&#x641C;&#x7D22; <code>LXC</code>&#xFF0C;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x90FD;&#x6CA1;&#x6709; <strong>(&#x2299;&#xFE4F;&#x2299;)b</strong>&#xFF1B;&#x518D;&#x53BB;&#x641C;&#x7D22; <code>container</code>&#xFF0C;&#x55EF;&#xFF0C;&#x8FD9;&#x6B21;&#x5012;&#x662F;&#x6709;&#x4E86;&#x4E00;&#x5343;&#x591A;&#x6761;&#x7ED3;&#x679C;&#xFF0C;&#x4E0D;&#x8FC7;&#x4ED4;&#x7EC6;&#x4E00;&#x770B;&#xFF0C;&#x90FD;&#x662F;&#x4E00;&#x5E2E;&#x5B50;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x6BD4;&#x5982; <code>ACPI containers</code> &#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x1F47B;&#xFF1F;&#x5B8C;&#x5168;&#x8DDF;&#x6211;&#x4EEC;&#x8BF4;&#x7684;&#x5BB9;&#x5668;&#x6CA1;&#x5173;&#x7CFB;&#x561B;&#x3002;</p><p>&#x5012;&#x662F;&#x6709;&#x4E9B;&#x6587;&#x6863;&#x91CC;&#x6216;&#x9690;&#x6216;&#x73B0;&#x7684;&#x63D0;&#x5230;&#x4E86;&#x4E00;&#x4E9B;&#x5173;&#x4E8E;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4E0D;&#x8FC7;&#x90A3;&#x662F;&#x6587;&#x6863;&#xFF0C;&#x4E0D;&#x662F;&#x4EE3;&#x7801;&#x554A;&#x3002;</p><p>&#x597D;&#x5427;&#xFF0C;&#x90A3;&#x662F;&#x5FC3;&#x91CC;&#x4E0D;&#x5F97;&#x4E0D;&#x95EE;&#x4E00;&#x53E5;&#xFF0C;&#x5BB9;&#x5668;&#x8FD9;&#x9B3C;&#x96BE;&#x9053;&#x4E0D;&#x5728;&#x5185;&#x6838;&#x91CC;&#xFF1F;&#x4E4B;&#x524D;&#x542C;&#x5230;&#x5BB9;&#x5668;&#x7528;&#x7684;&#x662F;&#x5185;&#x6838;&#x6280;&#x672F;&#x90FD;&#x662F;&#x9A97;&#x4EBA;&#x7684;&#x4E0D;&#x6210;&#xFF1F;&#x751A;&#x81F3;&#x2026;&#x2026;<em>&#x5BB9;&#x5668;</em>&#x4E0D;&#x4F1A;&#x538B;&#x6839;&#x5C31;&#x4E0D;&#x5B58;&#x5728;&#x5427;&#xFF1F;</p><p>&#x7ECF;&#x8FC7;&#x4E00;&#x756A;&#x7814;&#x7A76;&#xFF0C;&#x641E;&#x660E;&#x767D;&#x4E86;<em>&#x5BB9;&#x5668;</em>&#x4E0D;&#x5728;&#x5185;&#x6838;&#x91CC;&#xFF0C;&#x5728;&#x5185;&#x6838;&#x91CC;&#x7684;&#x662F;&#x5B9E;&#x73B0;&#x5BB9;&#x5668;&#x7684;&#x3001;&#x8457;&#x540D;&#x7684; <code>cgroups</code> &#x548C; <code>namespaces</code>&#x3002;</p><h1 id="rong-qi-ji-shi-1-control-groups"><a href="#&#x5BB9;&#x5668;&#x57FA;&#x77F3;-1&#xFF1A;Control-Groups" class="headerlink" title="&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 1&#xFF1A;Control Groups"></a>&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 1&#xFF1A;<code>Control Groups</code> <a href="#rong-qi-ji-shi-1-control-groups" class="header-anchor">#</a></h1><h2 id="shi-me-shi-control-groups"><a href="#&#x4EC0;&#x4E48;&#x662F;-Control-Groups&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Control Groups&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; <code>Control Groups</code>&#xFF1F; <a href="#shi-me-shi-control-groups" class="header-anchor">#</a></h2><p><code>Control Groups</code>&#xFF0C;&#x53D7;&#x63A7;&#x7EC4;&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A; <code>cgroups</code>&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5C31;&#x662F;&#x63A7;&#x5236;&#x72C2;&#xFF0C;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x662F;&#x5BF9;&#x4E00;&#x5207;&#x8FDB;&#x884C;&#x9650;&#x5236;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p><ul><li>&#x5BF9;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x7684;&#x6D4B;&#x91CF;&#x548C;&#x9650;&#x5236;&#xFF0C;&#x5305;&#x62EC;&#x5185;&#x5B58;&#x3001;CPU&#x3001;&#x5757;&#x8BBE;&#x5907; I/O&#x3001;&#x7F51;&#x7EDC;&#x7B49;</li><li>&#x5BF9;&#x8BBE;&#x5907;&#xFF08;<code>/dev/*</code>&#xFF09;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</li><li>&#x62E5;&#x585E;&#x63A7;&#x5236;</li></ul><h2 id="gai-lun"><a href="#&#x6982;&#x8BBA;" class="headerlink" title="&#x6982;&#x8BBA;"></a>&#x6982;&#x8BBA; <a href="#gai-lun" class="header-anchor">#</a></h2><ul><li>&#x6BCF;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#xFF08;&#x5185;&#x5B58;&#x3001;CPU&#x7B49;&#xFF09;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;</li><li>&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x95F4;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#xFF0C;&#x4E92;&#x76F8;&#x4E0D;&#x5F71;&#x54CD;&#x3002;&#x56E0;&#x6B64;&#x5185;&#x5B58;&#x548C;CPU&#x53EF;&#x4EE5;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;</li><li>&#x6BCF;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x4E2D;&#x53EA;&#x53EF;&#x4EE5;&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A;&#x8282;&#x70B9;</li><li>&#x6BCF;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x90FD;&#x8D77;&#x59CB;&#x4E8E;&#x4E00;&#x4E2A;&#x8D77;&#x70B9;&#xFF08;<code>root</code>&#xFF09;</li><li>&#x6240;&#x6709;&#x7684;&#x8FDB;&#x7A0B;&#x6700;&#x521D;&#x90FD;&#x662F;&#x5C5E;&#x4E8E;&#x6BCF;&#x4E2A;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x7684;&#x6839;(<code>root</code>) &#x8282;&#x70B9;</li><li>&#x6BCF;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x91CC;&#x662F;&#x4E00;&#x7EC4;&#x8FDB;&#x7A0B;</li></ul><p>&#x56E0;&#x6B64;&#x5373;&#x4F7F;&#x4F60;&#x6CA1;&#x6709;&#x4F7F;&#x7528; Docker&#xFF0C;&#x4F60;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x4F9D;&#x65E7;&#x662F;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x90FD;&#x5C5E;&#x4E8E;&#x5404;&#x4E2A; cgroups &#x91CC;&#x7684;&#x6839;&#x8282;&#x70B9;&#x3002;&#x6574;&#x4E2A;&#x673A;&#x5668;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x8981;&#x662F;&#x89C9;&#x5F97;&#x4F60;&#x7684;&#x8FDB;&#x7A0B;&#x4E0D;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x5C31;&#x4F1A;&#x66F4;&#x5FEB;&#x4E9B;&#xFF0C;&#x8FD9;&#x662F;&#x7EDD;&#x5BF9;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#xFF0C;&#x65E0;&#x8BBA;&#x7528;&#x4E0D;&#x7528; docker&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x8FDB;&#x7A0B;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x90FD;&#x4E00;&#x6837;&#x7684;&#x4F4D;&#x4E8E;&#x5BB9;&#x5668;&#x5185;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x662F; CPU &#x7684;&#x6811;&#x5F62;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x6570;&#x5B57;&#x662F; <code>PID</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cpu</span><br><span class="line">&#x251C;&#x2500;&#x2500; batch</span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; bitcoins</span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; 52</span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; hadoop</span><br><span class="line">&#x2502;&#xA0;&#xA0;     &#x251C;&#x2500;&#x2500; 109</span><br><span class="line">&#x2502;&#xA0;&#xA0;     &#x2514;&#x2500;&#x2500; 88</span><br><span class="line">&#x2514;&#x2500;&#x2500; realtime</span><br><span class="line">    &#x251C;&#x2500;&#x2500; nginx</span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; 25</span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; 26</span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; 27</span><br><span class="line">    &#x251C;&#x2500;&#x2500; postgres</span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; 524</span><br><span class="line">    &#x2514;&#x2500;&#x2500; redis</span><br><span class="line">        &#x2514;&#x2500;&#x2500; 1008</span><br></pre></td></tr></table></figure><p>&#x800C;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5219;&#x662F;&#x5185;&#x5B58;&#x7684;&#x6811;&#x5F62;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD8;&#x662F;&#x8FD9;&#x4E00;&#x6279;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F46;&#x662F;&#x548C;CPU &#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">memory</span><br><span class="line">&#x251C;&#x2500;&#x2500; 109</span><br><span class="line">&#x251C;&#x2500;&#x2500; 25</span><br><span class="line">&#x251C;&#x2500;&#x2500; 26</span><br><span class="line">&#x251C;&#x2500;&#x2500; 27</span><br><span class="line">&#x251C;&#x2500;&#x2500; 52</span><br><span class="line">&#x251C;&#x2500;&#x2500; 88</span><br><span class="line">&#x2514;&#x2500;&#x2500; databases</span><br><span class="line">    &#x251C;&#x2500;&#x2500; 1008</span><br><span class="line">    &#x2514;&#x2500;&#x2500; 524</span><br></pre></td></tr></table></figure><h2 id="nei-cun-cgroup-ji-zhang"><a href="#&#x5185;&#x5B58;-cgroup&#xFF1A;&#x8BB0;&#x8D26;" class="headerlink" title="&#x5185;&#x5B58; cgroup&#xFF1A;&#x8BB0;&#x8D26;"></a>&#x5185;&#x5B58; <code>cgroup</code>&#xFF1A;&#x8BB0;&#x8D26; <a href="#nei-cun-cgroup-ji-zhang" class="header-anchor">#</a></h2><p>&#x8BB0;&#x5F55;&#x6BCF;&#x4E00;&#x7EC4;&#x8FDB;&#x7A0B;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x9875;&#xFF08;&#x63A7;&#x5236;&#x7684;&#x7EC6;&#x7C92;&#x5EA6;&#x662F;<em>&#x9875;</em>&#xFF09;&#xFF1A;</p><ul><li>&#x6587;&#x4EF6;&#xFF08;&#x4ECE;&#x5757;&#x8BBE;&#x5907;&#x7684;&#x8BFB;&#x3001;&#x5199;&#x3001;&#x6620;&#x5C04;&#xFF09;</li><li>&#x533F;&#x540D;&#xFF08;&#x6808;&#x3001;&#x5806;&#x3001;&#x533F;&#x540D;&#x6620;&#x5C04;&#xFF09;</li><li>&#x6D3B;&#x8DC3;&#xFF08;&#x6700;&#x8FD1;&#x8BBF;&#x95EE;&#x8FC7;&#x7684;&#xFF09;</li><li>&#x4E0D;&#x6D3B;&#x8DC3;&#xFF08;&#x5C06;&#x88AB;&#x6E05;&#x7406;&#x7684;&#xFF09;</li></ul><p>&#x6BCF;&#x4E00;&#x5185;&#x5B58;&#x9875;&#x90FD;&#x88AB;&#x8BB0;&#x5230;&#x4E00;&#x4E2A;<strong>&#x7EC4;</strong>&#x7684;&#x8D26;&#x4E0A;&#x3002;&#x5185;&#x5B58;&#x9875;&#x53EF;&#x4EE5;&#x8DE8;&#x591A;&#x7EC4;&#x5171;&#x4EAB;&#xFF0C;&#x6BD4;&#x5982;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x4ECE;&#x4E00;&#x7EC4;&#x76F8;&#x540C;&#x7684;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#x3002;&#x5F53;&#x9875;&#x88AB;&#x5171;&#x4EAB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EC4;&#x4F1A;&#x4E3A;&#x6B64;&#x4E70;&#x5355;&#x3002;</p><h2 id="nei-cun-cgroup-xian-zhi"><a href="#&#x5185;&#x5B58;-cgroup&#xFF1A;&#x9650;&#x5236;" class="headerlink" title="&#x5185;&#x5B58; cgroup&#xFF1A;&#x9650;&#x5236;"></a>&#x5185;&#x5B58; <code>cgroup</code>&#xFF1A;&#x9650;&#x5236; <a href="#nei-cun-cgroup-xian-zhi" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E00;&#x4E2A;&#x7EC4;&#x90FD;&#x53EF;&#x4EE5;&#x6709; <code>hard</code> &#x548C; <code>soft</code> &#x7684;&#x9650;&#x5236;&#x3002;</p><ul><li><code>soft</code> &#x9650;&#x5236;&#x5E76;&#x4E0D;&#x662F;&#x5F3A;&#x5236;&#x7684;&#xFF0C;&#x5B83;&#x5728;&#x5185;&#x5B58;&#x538B;&#x529B;&#x4E0B;&#x53EF;&#x4EE5;&#x5F71;&#x54CD;&#x56DE;&#x6536;&#x8D44;&#x6E90;&#x3002;</li><li><code>hard</code> &#x5219;&#x662F;&#x5F3A;&#x5236;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;&#x7EC4;&#x7684; <code>OOM killer</code></li></ul><p><code>OOM Killer</code> &#x53EF;&#x4EE5;&#x5B9A;&#x5236;&#x5176;&#x884C;&#x4E3A;&#x3002;</p><ul><li>&#x6BD4;&#x5982;&#xFF0C;&#x5F53; <code>hard limit</code> &#x8D85;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x51BB;&#x7ED3;&#x7EC4;&#x5185;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#xFF0C;&#x901A;&#x77E5;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF08;&#x800C;&#x4E0D;&#x662F; <code>rampage</code>&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x6740;&#x4E86;&#x8FDB;&#x7A0B;&#x3001;&#x63D0;&#x5347; <code>limit</code>&#x3001;&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5F53;&#x4E00;&#x5207;&#x90FD;&#x597D;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x89E3;&#x51BB;&#x8BE5;&#x7EC4;&#x3002;</li></ul><p>&#x9650;&#x5236;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E8E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x3001;&#x5185;&#x6838;&#x5185;&#x5B58;&#x6216;&#x603B;&#x5171;&#x5185;&#x5B58;&#x3002;</p><h2 id="nei-cun-cgroup-yi-xie-xu-yao-zhu-yi-de-xi-jie"><a href="#&#x5185;&#x5B58;-cgroup&#xFF1A;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x7EC6;&#x8282;" class="headerlink" title="&#x5185;&#x5B58; cgroup&#xFF1A;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x7EC6;&#x8282;"></a>&#x5185;&#x5B58; <code>cgroup</code>&#xFF1A;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x7EC6;&#x8282; <a href="#nei-cun-cgroup-yi-xie-xu-yao-zhu-yi-de-xi-jie" class="header-anchor">#</a></h2><p>&#x6BCF;&#x6B21;&#x5185;&#x6838;&#x7ED9;&#x8FDB;&#x7A0B;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x6216;&#x8005;&#x64A4;&#x8D70;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x5B83;&#x90FD;&#x4F1A;&#x66F4;&#x65B0;&#x8BA1;&#x6570;&#x5668;&#x3002;&#x8FD9;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x5F00;&#x9500;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x65E0;&#x6CD5;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x8FDB;&#x7A0B;&#x5173;&#x95ED;&#xFF0C;&#x53EA;&#x53EF;&#x4EE5;&#x5F15;&#x5BFC;&#x53C2;&#x6570;&#x4E0A;&#x8BBE;&#x7F6E;&#x3002;</p><p>&#x4E4B;&#x524D;&#x8BF4;&#x8FC7;&#xFF0C;&#x5982;&#x679C;&#x591A;&#x7EC4;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x9875;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EC4;&#x4F1A;&#x4E70;&#x5355;&#x3002;&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x7EC4;&#x505C;&#x6B62;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x9875;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8D26;&#x5355;&#x4F1A;&#x8DD1;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x7EC4;&#x4E0A;&#x3002;</p><h2 id="hugetlb-cgroup"><a href="#HugeTLB-cgroup" class="headerlink" title="HugeTLB cgroup"></a><code>HugeTLB cgroup</code> <a href="#hugetlb-cgroup" class="header-anchor">#</a></h2><p>&#x8FD9;&#x662F;&#x7528;&#x6765;&#x63A7;&#x5236;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684; <code>huge pages</code> &#x7684;&#x6570;&#x91CF;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x662F;&#x5565;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x8DF3;&#x8FC7;&#x53BB;&#xFF0C;&#x6CA1;&#x95EE;&#x9898;&#x3002;</p><h2 id="cpu-cgroup"><a href="#CPU-cgroup" class="headerlink" title="CPU cgroup"></a><code>CPU cgroup</code> <a href="#cpu-cgroup" class="header-anchor">#</a></h2><ul><li>&#x8BB0;&#x5F55;&#x7528;&#x6237;/&#x7CFB;&#x7EDF;&#x7684; CPU &#x65F6;&#x95F4;</li><li>&#x8BB0;&#x5F55;&#x6BCF; CPU &#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</li><li>&#x5141;&#x8BB8;&#x8BBE;&#x7F6E;&#x6743;&#x91CD;</li><li>&#x65E0;&#x6CD5;&#x8BBE;&#x7F6E; CPU &#x9650;&#x5236;</li></ul><h2 id="cpuset-cgroup"><a href="#cpuset-cgroup" class="headerlink" title="cpuset cgroup"></a><code>cpuset cgroup</code> <a href="#cpuset-cgroup" class="header-anchor">#</a></h2><ul><li>&#x53EF;&#x4EE5;&#x5C06;&#x7EC4;&#x56FA;&#x5B9A;&#x5728;&#x7279;&#x5B9A;&#x7684; CPU &#x4E0A;</li><li>&#x53EF;&#x4EE5;&#x4FDD;&#x7559; CPU &#x7ED9;&#x7279;&#x5B9A;&#x7684; app</li><li>&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8FDB;&#x7A0B;&#x6765;&#x56DE;&#x5728;&#x4E0D;&#x540C;&#x7684; CPU &#x4E0A;&#x8DF3;&#x6765;&#x8DF3;&#x53BB;</li><li>&#x8FD9;&#x4E5F;&#x548C; NUMA &#x7CFB;&#x7EDF;&#x76F8;&#x5173;</li><li>&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x8C03;&#x8282;&#x80FD;&#x529B;&#xFF08;&#x6BCF;&#x533A;&#x57DF;&#x5185;&#x5B58;&#x538B;&#x529B;&#x3001;&#x8FDB;&#x7A0B;&#x8FC1;&#x79FB;&#x5F00;&#x9500;&#x2026;&#x2026;&#xFF09;</li></ul><h2 id="blkio-cgroup"><a href="#blkio-cgroup" class="headerlink" title="blkio cgroup"></a><code>blkio cgroup</code> <a href="#blkio-cgroup" class="header-anchor">#</a></h2><ul><li><p>&#x8BB0;&#x5F55;&#x6BCF;&#x7EC4;&#x7684; I/O &#x6570;&#x76EE;</p><ul><li>&#x6BCF;&#x4E2A;&#x5757;&#x8BBE;&#x5907;</li><li>&#x8BFB;&#x3001;&#x5199;</li><li>&#x540C;&#x6B65;&#x3001;&#x5F02;&#x6B65;</li></ul></li><li><p>&#x5BF9;&#x6BCF;&#x4E2A;&#x7EC4;&#x8BBE;&#x7F6E;&#x541E;&#x5410;&#x91CF;&#x9650;&#x5236;</p><ul><li>&#x6BCF;&#x4E2A;&#x5757;&#x8BBE;&#x5907;</li><li>&#x8BFB;&#x3001;&#x5199;</li><li>ops &#x6216;&#x8005; bytes</li></ul></li><li><p>&#x5BF9;&#x6BCF;&#x4E2A;&#x7EC4;&#x8BBE;&#x7F6E;&#x76F8;&#x5BF9;&#x6743;&#x91CD;</p></li></ul><p><strong>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x5199;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5199;&#x5230;&#x7F13;&#x5B58;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x666E;&#x901A;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x6700;&#x521D;&#x4F1A;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x6CA1;&#x6709;&#x88AB;&#x9650;&#x5236;&#x541E;&#x5410;&#x91CF;&#x4E00;&#x6837;&#x3002;</strong></p><h2 id="net-cls-he-net-prio-cgroup"><a href="#net-cls-&#x548C;-net-prio-cgroup" class="headerlink" title="net_cls &#x548C; net_prio cgroup"></a><code>net_cls</code> &#x548C; <code>net_prio</code> <code>cgroup</code> <a href="#net-cls-he-net-prio-cgroup" class="header-anchor">#</a></h2><ul><li>&#x81EA;&#x52A8;&#x4E3A;&#x7EC4;&#x4E2D;&#x8FDB;&#x7A0B;&#x4EA7;&#x751F;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x8BBE;&#x7F6E;&#x5206;&#x7C7B;&#x548C;&#x4F18;&#x5148;&#x7EA7;&#xFF1B;</li><li>&#x53EA;&#x5BF9;&#x5916;&#x51FA;&#x6D41;&#x91CF;&#x6709;&#x6548;</li><li><code>net_cls</code> &#x5C06;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x6D41;&#x91CF;&#x4E00;&#x4E2A;&#x5206;&#x7C7B;<ul><li>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E2A;&#x5206;&#x7C7B;&#x9700;&#x8981;&#x5728; <code>tc</code>/<code>iptables</code> &#x6765;&#x5339;&#x914D;&#x4ECE;&#x800C;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x548C;&#x666E;&#x901A;&#x6D41;&#x91CF;&#x4E00;&#x6837;&#x3002;</li></ul></li><li><code>net_prio</code> &#x4F1A;&#x6307;&#x5B9A;&#x6D41;&#x91CF;&#x7684;&#x4F18;&#x5148;&#x7EA7;<ul><li>&#x961F;&#x5217;&#x673A;&#x5236;&#x5C06;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x4F18;&#x5148;&#x7EA7;&#x8FDB;&#x884C;&#x5904;&#x7406;</li></ul></li></ul><h2 id="she-bei-cgroup"><a href="#&#x8BBE;&#x5907;-cgroup" class="headerlink" title="&#x8BBE;&#x5907; cgroup"></a>&#x8BBE;&#x5907; <code>cgroup</code> <a href="#she-bei-cgroup" class="header-anchor">#</a></h2><p>&#x63A7;&#x5236;&#x4E00;&#x4E2A;&#x7EC4;&#x53EF;&#x4EE5;&#x5BF9;&#x4E00;&#x4E2A;&#x8BBE;&#x5907;&#x8282;&#x70B9;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x8BFB;&#x3001;&#x5199;&#x3001;<code>mknod</code> &#x7B49;</p><p>&#x5178;&#x578B;&#x7684;&#x7528;&#x6CD5;&#x6709;&#xFF1A;</p><ul><li>&#x5141;&#x8BB8; <code>/dev/{tty,zero,random,null}</code>&#x2026;</li><li>&#x62D2;&#x7EDD;&#x6240;&#x6709;&#x5176;&#x5B83;&#x7684;&#x3002;</li></ul><p>&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;&#xFF1A;</p><ul><li><code>/dev/net/tun</code>&#xFF1A; &#x7F51;&#x7EDC;&#x754C;&#x9762;&#x7EF4;&#x62A4;</li><li><code>/dev/fuse</code>&#xFF1A; &#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li><code>/dev/kvm</code>&#xFF1A;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF1F;&#xFF01;&#x1F602;OMG, &#x865A;&#x62DF;&#x5316;&#x7248;&#x76D7;&#x68A6;&#x7A7A;&#x95F4;&#xFF1F;</li><li><code>/dev/dri</code>&#xFF1A;GPU</li></ul><h2 id="freezer-cgroup"><a href="#freezer-cgroup" class="headerlink" title="freezer cgroup"></a><code>freezer cgroup</code> <a href="#freezer-cgroup" class="header-anchor">#</a></h2><p>&#x5141;&#x8BB8;&#x51BB;&#x7ED3;&#x548C;&#x5524;&#x9192;&#x4E00;&#x7EC4;&#x8FDB;&#x7A0B;&#x3002;&#x529F;&#x80FD;&#x4E0A;&#x76F8;&#x4F3C;&#x4E8E; <code>SIGSTOP/SIGCONT</code>&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x8FDB;&#x7A0B;&#x65E0;&#x6CD5;&#x611F;&#x77E5;&#x5230;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x53D8;&#x5316;&#xFF0C;&#x800C; <code>SIGSTOP/SIGCONT</code> &#x662F;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x7684;&#x4FE1;&#x53F7;&#x3002;&#x800C;&#x4E14;&#x5E76;&#x4E0D;&#x4F1A;&#x59A8;&#x788D; <code>ptrace</code> &#x8C03;&#x8BD5;&#x3002;</p><p>&#x7279;&#x6B8A;&#x7528;&#x6CD5;&#xFF1A;</p><ul><li>&#x96C6;&#x7FA4;&#x6210;&#x6279;&#x8C03;&#x5EA6;</li><li>&#x8FDB;&#x7A0B;&#x8FC1;&#x79FB;</li></ul><h2 id="yi-xie-zhu-yi-shi-xiang"><a href="#&#x4E00;&#x4E9B;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x4E00;&#x4E9B;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x4E00;&#x4E9B;&#x6CE8;&#x610F;&#x4E8B;&#x9879; <a href="#yi-xie-zhu-yi-shi-xiang" class="header-anchor">#</a></h2><ul><li>&#x6BCF;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#x7684;&#x6839;&#x8282;&#x70B9;&#x90FD;&#x662F; <code>PID 1</code> &#x7684;&#x8FDB;&#x7A0B;</li><li>&#x65B0;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x5C5E;&#x4E8E;&#x5B83;&#x4EEC;&#x7684;&#x7236;&#x8FDB;&#x7A0B;&#x6240;&#x5728;&#x7684;&#x7EC4;</li><li>&#x7EC4;&#x5C06;&#x5177;&#x5316;&#x4E3A;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x4F2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;<ul><li>&#x4E00;&#x822C;&#x4F4D;&#x4E8E; <code>/sys/fs/cgroup</code> &#x4E0B;</li></ul></li><li>&#x521B;&#x5EFA;&#x7EC4;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x5728;&#x90A3;&#x4E9B;&#x4F2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#x7528; <code>mkdir</code> &#x521B;&#x5EFA;&#x76EE;&#x5F55;</li><li>&#x8981;&#x79FB;&#x52A8;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5230;&#x4E00;&#x4E2A;&#x7EC4;&#x53EA;&#x9700;&#x8981;&#xFF1A;<ul><li><code>echo $PID &gt; /sys/fs/cgroup/.../tasks</code></li></ul></li><li><code>cgroup</code> &#x7684;&#x6218;&#x4E89;&#xFF1A;<code>systemd</code> vs <code>cgmanager</code> vs &#x2026;</li></ul><h1 id="rong-qi-ji-shi-2-namespaces"><a href="#&#x5BB9;&#x5668;&#x57FA;&#x77F3;-2&#xFF1A;namespaces" class="headerlink" title="&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 2&#xFF1A;namespaces"></a>&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 2&#xFF1A;<code>namespaces</code> <a href="#rong-qi-ji-shi-2-namespaces" class="header-anchor">#</a></h1><ul><li>&#x4E3A;&#x8FDB;&#x7A0B;&#x63D0;&#x4F9B;&#x81EA;&#x5DF1;&#x7684;&#x7CFB;&#x7EDF;&#x89C6;&#x89D2;</li><li><code>cgroups</code> &#x9650;&#x5236;&#x4F60;&#x7528;&#x591A;&#x5C11;&#xFF1B;<code>namespaces</code> &#x9650;&#x5236;&#x4F60;&#x80FD;&#x770B;&#x5230;&#x4EC0;&#x4E48;&#x3002;</li><li>&#x6709;&#x591A;&#x79CD; <code>namespaces</code>&#xFF1A;<ul><li><code>pid</code></li><li><code>net</code></li><li><code>mnt</code></li><li><code>uts</code></li><li><code>ipc</code></li><li><code>user</code></li></ul></li><li>&#x5BF9;&#x4E8E;&#x67D0;&#x7C7B; <code>namespace</code> &#x800C;&#x8A00;&#xFF0C;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A; <code>namespace</code>&#x3002;</li></ul><h2 id="pid-namespace"><a href="#pid-namespace" class="headerlink" title="pid namespace"></a><code>pid namespace</code> <a href="#pid-namespace" class="header-anchor">#</a></h2><ul><li>&#x4E00;&#x4E2A; <code>pid namespace</code> &#x7684;&#x8FDB;&#x7A0B;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x5728;&#x540C; <code>pid namespace</code> &#x7684;&#x5176;&#x5B83;&#x8FDB;&#x7A0B;</li><li>&#x6BCF;&#x4E2A; <code>pid namespace</code> &#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684; <code>pid</code> &#x7F16;&#x53F7;&#xFF0C;&#x4ECE; <code>1</code> &#x5F00;&#x59CB;</li><li>&#x5F53; <code>pid 1</code> &#x6302;&#x4E86;&#xFF0C;&#x6574;&#x4E2A; <code>namespace</code> &#x90FD;&#x4F1A;&#x88AB;&#x5E72;&#x6389;</li><li><code>namespace</code> &#x53EF;&#x4EE5;&#x5D4C;&#x5957;</li><li>&#x56E0;&#x6B64;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x591A;&#x4E2A; <code>PID</code>&#xFF0C;&#x6BCF;&#x4E2A; <code>namespace</code> &#x4E00;&#x4E2A; <code>pid</code></li></ul><h2 id="net-namespace"><a href="#net-namespace" class="headerlink" title="net namespace"></a><code>net namespace</code> <a href="#net-namespace" class="header-anchor">#</a></h2><h3 id="li-lun-shang"><a href="#&#x7406;&#x8BBA;&#x4E0A;" class="headerlink" title="&#x7406;&#x8BBA;&#x4E0A;"></a>&#x7406;&#x8BBA;&#x4E0A; <a href="#li-lun-shang" class="header-anchor">#</a></h3><p>&#x5728;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x4F1A;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x79C1;&#x6709;&#x7F51;&#x7EDC;&#x6808;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;</p><ul><li>&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF08;&#x5305;&#x62EC;&#x672C;&#x5730;&#x56DE;&#x73AF;&#xFF09;</li><li>&#x8DEF;&#x7531;&#x8868;</li><li>iptables &#x89C4;&#x5219;</li><li>sockets (ss, netstat)</li></ul><p>&#x4F60;&#x53EF;&#x4EE5;&#x4ECE;&#x4E00;&#x4E2A; <code>netns</code> &#x79FB;&#x52A8;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link <span class="built_in">set</span> dev eth0 netns PID</span><br></pre></td></tr></table></figure><h3 id="shi-ji-shang"><a href="#&#x5B9E;&#x9645;&#x4E0A;" class="headerlink" title="&#x5B9E;&#x9645;&#x4E0A;"></a>&#x5B9E;&#x9645;&#x4E0A; <a href="#shi-ji-shang" class="header-anchor">#</a></h3><p>&#x5178;&#x578B;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;</p><ul><li>&#x4F7F;&#x7528; <code>veth</code> &#x5BF9;&#xFF08;&#x4E24;&#x4E2A;&#x865A;&#x62DF;&#x63A5;&#x53E3;&#x50CF;&#x4F7F;&#x7528;&#x4EA4;&#x53C9;&#x7EBF;&#x8FDE;&#x63A5;&#x4E00;&#x6837;&#xFF09;</li><li>&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684; <code>eth0</code> &#x548C;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684; <code>vethXXX</code> &#x914D;&#x5BF9;</li><li>&#x5E76;&#x4E14;&#x6240;&#x6709;&#x7684; <code>vethXXX</code> &#x90FD;&#x6865;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#xFF08;&#x5728;Docker&#x4E2D;&#x8FD9;&#x4E2A;&#x6865;&#x63A5;&#x5982;&#x679C;&#x662F;&#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x5C31;&#x662F; docker0&#xFF09;</li></ul><p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528; <code>--net container:&#x5BB9;&#x5668;</code> &#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x7F51;&#x7EDC;&#x6808;&#x3002;</p><h2 id="mnt-namespace"><a href="#mnt-namespace" class="headerlink" title="mnt namespace"></a><code>mnt namespace</code> <a href="#mnt-namespace" class="header-anchor">#</a></h2><ul><li>&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684; <code>rootfs</code>&#xFF08;&#x5C31;&#x50CF; <code>chroot</code> &#x4E00;&#x6837;&#xFF09;</li><li>&#x8FDB;&#x7A0B;&#x8FD8;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684; <em>&#x79C1;&#x6709;</em> &#x7684;&#x6302;&#x8F7D;<ul><li><code>/tmp</code> &#xFF08;&#x6BCF;&#x7528;&#x6237;&#x3001;&#x6BCF;&#x670D;&#x52A1;&#xFF09;</li><li><code>/proc</code> &#x548C; <code>/sys</code> &#x7684; masking</li><li>NFS &#x81EA;&#x52A8;&#x6302;&#x8F7D;&#x4E4B;&#x7C7B;&#x7684;</li></ul></li><li>&#x6302;&#x8F7D;&#x53EF;&#x4EE5;&#x662F;&#x5B8C;&#x5168;&#x79C1;&#x6709;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5171;&#x4EAB;&#x7684;</li><li>&#x6CA1;&#x6709;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;&#x6302;&#x8F7D;&#x8F6C;&#x79FB;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;</li></ul><h2 id="uts-namespace"><a href="#uts-namespace" class="headerlink" title="uts namespace"></a><code>uts namespace</code> <a href="#uts-namespace" class="header-anchor">#</a></h2><ul><li><code>gethostname</code> / <code>sethostname</code></li></ul><h2 id="ipc-namespace"><a href="#ipc-namespace" class="headerlink" title="ipc namespace"></a><code>ipc namespace</code> <a href="#ipc-namespace" class="header-anchor">#</a></h2><ul><li>&#x6709;&#x4EBA;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x662F; <code>IPC</code> &#x4E48;&#xFF1F;</li><li>&#x6709;&#x4EBA;&#x5173;&#x5FC3; <code>IPC</code> &#x4E48;&#xFF1F;</li><li>&#x8FD0;&#x884C;&#x8FDB;&#x7A0B;&#xFF08;&#x6216;&#x4E00;&#x7EC4;&#x8FDB;&#x7A0B;&#xFF09;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#xFF1A;<ul><li><code>IPC</code> &#x4FE1;&#x53F7;&#x91CF;</li><li><code>IPC</code> &#x6D88;&#x606F;&#x961F;&#x5217;</li><li><code>IPC</code> &#x5171;&#x4EAB;&#x5185;&#x5B58;</li></ul></li><li>&#x800C;&#x4E0D;&#x4F1A;&#x548C;&#x5176;&#x5B83;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x8FDB;&#x7A0B;&#x53D1;&#x751F;&#x51B2;&#x7A81;</li></ul><h2 id="user-namespace"><a href="#user-namespace" class="headerlink" title="user namespace"></a><code>user namespace</code> <a href="#user-namespace" class="header-anchor">#</a></h2><ul><li>&#x5141;&#x8BB8;&#x6620;&#x5C04; <code>UID/GID</code>&#xFF0C;&#x6BD4;&#x5982;<ul><li>&#x5BB9;&#x5668; <code>C1</code> &#x5185;&#x7684; <code>UID 0 &#x2192; 1999</code> &#x5BF9;&#x5E94;&#x5230;&#x5BBF;&#x4E3B;&#x7684; <code>UID 10000 &#x2192; 11999</code></li><li>&#x5BB9;&#x5668; <code>C2</code> &#x5185;&#x7684; <code>UID 0 &#x2192; 1999</code> &#x5BF9;&#x5E94;&#x5230;&#x5BBF;&#x4E3B;&#x7684; <code>UID 12000 &#x2192; 13999</code></li></ul></li><li>&#x907F;&#x514D;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x989D;&#x5916;&#x914D;&#x7F6E;</li><li>&#x8FD9;&#x6837;&#x8FD8;&#x53EF;&#x4EE5;&#x8BA9; <code>UID 0 (root)</code> &#x53D8;&#x6210;&#x5BBF;&#x4E3B;&#x4E00;&#x4E2A;&#x975E;&#x7279;&#x6743;&#x7684;&#x666E;&#x901A;&#x7528;&#x6237;</li><li>&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5B89;&#x5168;&#x6027;</li><li><strong>&#x4F46;&#x662F;</strong>&#xFF1A;&#x7EC6;&#x8282;&#x662F;&#x9B54;&#x9B3C;&#x2026;&#x2026;</li></ul><h2 id="namespace-cao-zuo"><a href="#namespace-&#x64CD;&#x4F5C;" class="headerlink" title="namespace &#x64CD;&#x4F5C;"></a><code>namespace</code> &#x64CD;&#x4F5C; <a href="#namespace-cao-zuo" class="header-anchor">#</a></h2><ul><li><code>namespace</code> &#x7531; <code>clone()</code> &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x521B;&#x5EFA;</li><li><code>namespace</code> &#x7684;&#x5177;&#x4F53;&#x8868;&#x73B0;&#x4E3A;&#x4F2A;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#xFF1A;<ul><li><code>/proc/&lt;pid&gt;/ns</code></li></ul></li><li>&#x5F53;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#xFF0C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5373;&#x88AB;&#x9500;&#x6BC1;&#x3002;<ul><li>&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x4FDD;&#x7559;&#x7ED1;&#x5B9A;&#x6302;&#x8F7D;&#x7684;&#x4F2A;&#x6587;&#x4EF6;</li></ul></li><li>&#x53EF;&#x4EE5;&#x7528; <code>setns()</code> &#x6765;<em>&#x8FDB;&#x5165;</em>&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;<ul><li>&#x6BD4;&#x5982; <code>util-linux</code> &#x4E2D;&#x7684; <code>nsenter</code> &#x547D;&#x4EE4;&#x3002;</li></ul></li></ul><h1 id="rong-qi-ji-shi-3-copy-on-write"><a href="#&#x5BB9;&#x5668;&#x57FA;&#x77F3;-3&#xFF1A;copy-on-write" class="headerlink" title="&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 3&#xFF1A;copy-on-write"></a>&#x5BB9;&#x5668;&#x57FA;&#x77F3; - 3&#xFF1A;<code>copy-on-write</code> <a href="#rong-qi-ji-shi-3-copy-on-write" class="header-anchor">#</a></h1><h2 id="copy-on-write-cun-chu"><a href="#copy-on-write-&#x5B58;&#x50A8;" class="headerlink" title="copy-on-write &#x5B58;&#x50A8;"></a><code>copy-on-write</code> &#x5B58;&#x50A8; <a href="#copy-on-write-cun-chu" class="header-anchor">#</a></h2><ul><li>&#x53EF;&#x4EE5;&#x5373;&#x65F6;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#xFF08;&#x65E0;&#x9700;&#x590D;&#x5236;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF09;</li><li>&#x5B58;&#x50A8;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x6709;&#x54EA;&#x4E9B;&#x5185;&#x5BB9;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x52A8;</li><li>&#x6709;&#x5F88;&#x591A;&#x53EF;&#x9009;&#x62E9;&#x7684;&#x9014;&#x5F84;&#xFF1A;<ul><li>&#x6587;&#x4EF6;&#x5C42;&#x9762;&#xFF1A;<code>AUFS</code>, <code>overlay</code></li><li>&#x5757;&#x5C42;&#x9762;&#xFF1A;<code>device mapper</code></li><li>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;&#x9762;&#xFF1A;<code>btrfs</code>, <code>zfs</code></li></ul></li><li>&#x663E;&#x8457;&#x7684;&#x964D;&#x4F4E;&#x4E86;&#x7CFB;&#x7EDF;&#x5F00;&#x9500;&#x4EE5;&#x53CA;&#x542F;&#x52A8;&#x65F6;&#x95F4;</li></ul><p>&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x57FA;&#x77F3;&#x4E4B;&#x4E00;&#xFF0C;&#x8FD9;&#x91CC;&#x65E0;&#x6CD5;&#x5C55;&#x5F00;&#x8BB2;&#xFF0C;&#x5355;&#x5355;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x53EF;&#x4EE5;&#x8BB2;&#x4E00;&#x6574;&#x8282;&#x8BFE;&#x3002;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x770B;&#x8FD9;&#x7BC7;&#x535A;&#x6587;<a href="http://jpetazzo.github.io/assets/2015-07-01-deep-dive-into-docker-storage-drivers.html#1" target="_blank" rel="noopener">&#x300A;&#x6DF1;&#x5165; Docker &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x300B;</a></p><h1 id="qi-ta-xi-jie"><a href="#&#x5176;&#x5B83;&#x7EC6;&#x8282;" class="headerlink" title="&#x5176;&#x5B83;&#x7EC6;&#x8282;"></a>&#x5176;&#x5B83;&#x7EC6;&#x8282; <a href="#qi-ta-xi-jie" class="header-anchor">#</a></h1><h2 id="zheng-jiao-xing"><a href="#&#x6B63;&#x4EA4;&#x6027;" class="headerlink" title="&#x6B63;&#x4EA4;&#x6027;"></a>&#x6B63;&#x4EA4;&#x6027; <a href="#zheng-jiao-xing" class="header-anchor">#</a></h2><ul><li>&#x6240;&#x6709;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x4E92;&#x76F8;&#x72EC;&#x7ACB;&#x7684;</li><li>&#x5982;&#x679C;&#x53EA;&#x9700;&#x8981;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#xFF0C;&#x53EA;&#x8981;&#x7528;&#x51E0;&#x4E2A; <code>cgroups</code> &#x5C31;&#x53EF;&#x4EE5;</li><li>&#x53EF;&#x4EE5;&#x7528;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6A21;&#x62DF;&#x8DEF;&#x7531;&#x7F51;&#x7EDC;</li><li>&#x8BA9; debugger &#x8FD0;&#x884C;&#x4E8E;&#x5BB9;&#x5668;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x4E0D;&#x5728;&#x5176; cgroups &#x91CC;&#xFF0C;&#x8FD9;&#x6837;&#x4E0D;&#x53D7;&#x8D44;&#x6E90;&#x9650;&#x5236;&#x7EA6;&#x675F;</li><li>&#x5728;&#x4E00;&#x4E2A;&#x9694;&#x79BB;&#x7684;&#x73AF;&#x5883;&#x4E2D;&#x8BBE;&#x7F6E;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x79FB;&#x52A8;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x3002;</li><li>&#x7B49;&#x7B49;</li></ul><h2 id="capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities <a href="#capabilities" class="header-anchor">#</a></h2><ul><li>&#x53EF;&#x4EE5;&#x5C06;  <code>root</code> / <code>&#x975E;root</code> &#x8FD9;&#x79CD;&#x5206;&#x7C7B;&#x8FDB;&#x884C;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x7EC6;&#x7C92;&#x5EA6;&#x7684;&#x6743;&#x9650;&#x63A7;&#x5236;&#x3002;</li><li>&#x5141;&#x8BB8;&#x4FDD;&#x7559; <code>root</code>&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x63D0;&#x4F9B;&#x5371;&#x9669;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x80FD;&#x529B;</li><li>&#x4F46;&#x662F; <code>CAP_SYS_ADMIN</code> &#x4F9D;&#x65E7;&#x662F;&#x4EC0;&#x4E48;&#x80FD;&#x529B;&#x90FD;&#x6709;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;</li></ul><h2 id="selinux-apparmor"><a href="#SELinux-AppArmor" class="headerlink" title="SELinux / AppArmor"></a>SELinux / AppArmor <a href="#selinux-apparmor" class="header-anchor">#</a></h2><ul><li>&#x8BA9;&#x5BB9;&#x5668;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x4E25;&#x683C;&#x7684;&#x7EA6;&#x675F;&#x9650;&#x5236;&#x4F4F;&#x5176;&#x5185;&#x7684;&#x8FDB;&#x7A0B;</li><li>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x8BDD;&#x9898;</li><li>&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A; Github &#x9879;&#x76EE; <a href="https://github.com/jessfraz/bane" target="_blank" rel="noopener">https://github.com/jessfraz/bane</a></li></ul><h1 id="shi-yong-cgroups-he-namespaces-de-rong-qi-yun-xing-shi"><a href="#&#x4F7F;&#x7528;-cgroups-&#x548C;-namespaces-&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;" class="headerlink" title="&#x4F7F;&#x7528; cgroups &#x548C; namespaces &#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;"></a>&#x4F7F;&#x7528; <code>cgroups</code> &#x548C; <code>namespaces</code> &#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6; <a href="#shi-yong-cgroups-he-namespaces-de-rong-qi-yun-xing-shi" class="header-anchor">#</a></h1><h2 id="lxc"><a href="#LXC" class="headerlink" title="LXC"></a>LXC <a href="#lxc" class="header-anchor">#</a></h2><ul><li>&#x4E00;&#x5957;&#x7528;&#x6237;&#x6001;&#x7684;&#x5DE5;&#x5177;</li><li>&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5C31;&#x662F; <code>/var/lib/lxc</code> &#x4E0B;&#x7684;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;</li><li>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6; + &#x6839;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li>&#x65E9;&#x671F;&#x7248;&#x672C;&#x4E0D;&#x652F;&#x6301; CoW</li><li>&#x65E9;&#x671F;&#x7248;&#x672C;&#x4E0D;&#x652F;&#x6301;&#x79FB;&#x52A8;&#x955C;&#x50CF;</li><li>&#x9700;&#x8981;&#x5F88;&#x590D;&#x6742;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;<ul><li>&#x5BF9;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x5458;(Ops) &#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x4EBA;&#x5458;(Devs) &#x5219;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x3002;</li></ul></li></ul><h2 id="systemd-nspawn"><a href="#systemd-nspawn" class="headerlink" title="systemd-nspawn"></a>systemd-nspawn <a href="#systemd-nspawn" class="header-anchor">#</a></h2><ul><li>&#x6309;&#x7167;&#x5176; manpage &#x7684;&#x8BF4;&#x6CD5;&#xFF1A;<ul><li>&#x201C;&#x7528;&#x4E8E;&#x8C03;&#x8BD5;&#x3001;&#x6D4B;&#x8BD5;&#x548C;&#x6784;&#x5EFA;&#x201D;</li><li>&#x201C;&#x548C; <code>chroot</code> &#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x66F4;&#x5F3A;&#x5927;&#x201D;</li><li>&#x201C;&#x5B9E;&#x73B0;&#x4E86;&#x5BB9;&#x5668;&#x63A5;&#x53E3;&#x201D;</li></ul></li><li>&#x8C8C;&#x4F3C;&#x662F;&#x5C06;&#x81EA;&#x5DF1;&#x89C6;&#x4E3A;&#x4E2D;&#x95F4;&#x4EF6;&#x63A5;&#x53E3;</li><li>&#x6700;&#x8FD1;&#x589E;&#x52A0;&#x4E86;<em>docker&#x955C;&#x50CF;</em>&#x7684;&#x652F;&#x6301;&#xFF08;&#x7ADF;&#x7136;&#x4E0D;&#x6562;&#x6B63;&#x5927;&#x5149;&#x660E;&#x7684;&#x63D0;&#x53CA; docker &#x540D;&#x5B57;&#xFF09;</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INDEX_HOST <span class="meta-string">&quot;index.do&quot;</span> <span class="comment">/* the URL we get the data from */</span> <span class="meta-string">&quot;cker.io&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADER_TOKEN <span class="meta-string">&quot;X-Do&quot;</span> <span class="comment">/* the HTTP header for the auth token */</span> <span class="meta-string">&quot;cker-Token:&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADER_REGISTRY <span class="meta-string">&quot;X-Do&quot;</span> <span class="comment">/*the HTTP header for the registry */</span> <span class="meta-string">&quot;cker-Endpoints:&quot;</span></span></span><br></pre></td></tr></table></figure><h2 id="docker-engine"><a href="#Docker-Engine" class="headerlink" title="Docker Engine"></a>Docker Engine <a href="#docker-engine" class="header-anchor">#</a></h2><ul><li>&#x5F15;&#x64CE;&#x7531; REST API &#x63A7;&#x5236;</li><li>docker &#x6700;&#x521D;&#x7684;&#x7248;&#x672C;&#x662F;&#x4F7F;&#x7528; LXC&#xFF0C;&#x800C;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684; <code>libcontainer</code> &#x8FD0;&#x884C;&#x65F6;&#x3002;&#xFF08;&#x800C;2016&#x5E74;&#x5E95;&#x5219;&#x4F7F;&#x7528;&#x5F00;&#x653E;&#x6807;&#x51C6;&#x7684; runC &#x4E86;&#xFF09;</li><li>&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#x3001;&#x955C;&#x50CF;&#x3001;&#x6784;&#x5EFA;&#x4EE5;&#x53CA;&#x66F4;&#x591A;&#x7684;&#x4E1C;&#x897F;</li><li>&#x4E00;&#x4E9B;&#x4EBA;&#x8BA4;&#x4E3A;&#x5B83;&#x505A;&#x7684;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x5E94;&#x8BE5;&#x5C11;&#x800C;&#x7CBE;&#x3002;</li></ul><h2 id="rkt-runc"><a href="#rkt-runC" class="headerlink" title="rkt, runC"></a>rkt, runC <a href="#rkt-runc" class="header-anchor">#</a></h2><ul><li>&#x56DE;&#x5230;&#x66F4;&#x57FA;&#x7840;&#x7684;&#x4E1C;&#x897F;</li><li>&#x53EA;&#x5173;&#x6CE8;&#x4E8E;&#x5BB9;&#x5668;&#x6267;&#x884C;<ul><li>&#x6CA1;&#x6709; API&#x3001;&#x6CA1;&#x6709;&#x955C;&#x50CF;&#x7BA1;&#x7406;&#x3001;&#x6CA1;&#x6709;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x7B49;&#x7B49;</li></ul></li><li><code>rkt</code> &#x548C; <code>runC</code> &#x5B9E;&#x73B0;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x6807;&#x51C6;&#xFF1A;<ul><li><code>rkt</code> &#x5B9E;&#x73B0;&#x7684;&#x662F; <code>appc</code> (App Container) &#x6807;&#x51C6;</li><li><code>runC</code> &#x5B9E;&#x73B0;&#x7684;&#x662F; <code>OCP</code> (Open Container Project) &#x6807;&#x51C6;</li><li><code>runC</code> &#x662F;&#x5229;&#x7528;&#x4E86; Docker &#x7684; <code>libcontainer</code></li></ul></li></ul><h2 id="na-yi-ge-zui-hao"><a href="#&#x54EA;&#x4E00;&#x4E2A;&#x6700;&#x597D;&#xFF1F;" class="headerlink" title="&#x54EA;&#x4E00;&#x4E2A;&#x6700;&#x597D;&#xFF1F;"></a>&#x54EA;&#x4E00;&#x4E2A;&#x6700;&#x597D;&#xFF1F; <a href="#na-yi-ge-zui-hao" class="header-anchor">#</a></h2><ul><li>&#x9996;&#x5148;&#x9700;&#x8981;&#x5F3A;&#x8C03;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x4EEC;&#x5168;&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x5957;&#x5185;&#x6838;&#x529F;&#x80FD;&#x3002;&#x6240;&#x4EE5;&#x6027;&#x80FD;&#x4E0A;&#x5B83;&#x4EEC;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x3002;</li><li>&#x6240;&#x4EE5;&#x9700;&#x8981;&#x89C2;&#x5BDF;&#x5176;<em>&#x529F;&#x80FD;</em>&#x3001;<em>&#x8BBE;&#x8BA1;</em>&#x3001;<em>&#x751F;&#x6001;&#x7CFB;&#x7EDF;</em>&#x3002;</li></ul><h1 id="shi-yong-qi-ta-ji-zhi-shi-xian-de-rong-qi-yun-xing-shi"><a href="#&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;" class="headerlink" title="&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;"></a>&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6; <a href="#shi-yong-qi-ta-ji-zhi-shi-xian-de-rong-qi-yun-xing-shi" class="header-anchor">#</a></h1><h2 id="openvz"><a href="#OpenVZ" class="headerlink" title="OpenVZ"></a>OpenVZ <a href="#openvz" class="header-anchor">#</a></h2><ul><li>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x8FD8;&#x662F; Linux</li><li>&#x66F4;&#x53E4;&#x8001;&#x4E00;&#x4E9B;&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x7ECF;&#x8FC7;&#x4E86;&#x5B9E;&#x6218;&#x68C0;&#x9A8C;&#x7684;<ul><li>Travis CI &#x4E2D;&#x5982;&#x679C;&#x4F7F;&#x7528; <code>root</code>&#xFF0C;&#x5C31;&#x4F1A;&#x7ED9;&#x4F60;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A; <code>OpenVZ</code> &#x7684;&#x5BB9;&#x5668;/&#x865A;&#x62DF;&#x673A;</li></ul></li><li>&#x8FD8;&#x6709;&#x4E00;&#x5806;&#x5F88;&#x4E0D;&#x9519;&#x7684;&#x529F;&#x80FD;<ul><li><code>ploop</code> &#xFF08;&#x5BF9;&#x5BB9;&#x5668;&#x800C;&#x8A00;&#x66F4;&#x6709;&#x6548;&#x7684;&#x5757;&#x8BBE;&#x5907;&#xFF09;</li><li>checkpoint/restore&#xFF0C;&#x70ED;&#x8FC1;&#x79FB;</li><li><code>venet</code>&#xFF08;&#x66F4;&#x6709;&#x6548;&#x7387;&#x7684; veth&#xFF09;</li></ul></li><li>&#x8FD8;&#x5728;&#x5F00;&#x53D1;&#x548C;&#x7EF4;&#x62A4;</li></ul><h2 id="jails-zones"><a href="#Jails-Zones" class="headerlink" title="Jails / Zones"></a>Jails / Zones <a href="#jails-zones" class="header-anchor">#</a></h2><ul><li>&#x8FD9;&#x662F; FreeBSD / Solaris &#x7279;&#x6709;&#x7684;</li><li>&#x76F8;&#x5BF9;&#x4E8E; <code>namespace</code> &#x548C; <code>cgroups</code> &#x800C;&#x8A00;&#xFF0C;&#x662F;&#x66F4;&#x7C97;&#x7C92;&#x5EA6;&#x7684;&#x63A7;&#x5236;</li><li>&#x91CD;&#x70B9;&#x5F3A;&#x8C03;&#x7684;&#x662F;<strong>&#x5B89;&#x5168;&#x6027;</strong></li><li>&#x5F88;&#x9002;&#x5408;&#x6258;&#x7BA1;&#x4E3B;&#x673A;&#x63D0;&#x4F9B;&#x5546;</li><li>&#x5BF9;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#x610F;&#x4E49;&#x4E0D;&#x5927;<ul><li>&#x6CA1;&#x6709;&#x7B49;&#x540C;&#x4E8E; <code>docker run -it ubuntu</code> &#x7684;&#x4E1C;&#x897F;</li></ul></li><li><a href="https://wiki.illumos.org/display/illumos/illumos+Home" target="_blank" rel="noopener">Illumos</a> &#xFF08;OpenSolaris &#x7684;&#x793E;&#x533A; fork&#xFF09;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; Linux &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;<ul><li>&#x7528; <a href="https://www.joyent.com/blog/triton-docker-and-the-best-of-all-worlds" target="_blank" rel="noopener">Joyent Triton</a></li></ul></li><li>&#x800C; Oracle &#x7684; Solaris &#x5219;&#x53EA;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; Solaris &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; Linux &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;</li></ul><h1 id="ru-he-shou-dong-jian-li-rong-qi"><a href="#&#x5982;&#x4F55;&#x624B;&#x52A8;&#x5EFA;&#x7ACB;&#x5BB9;&#x5668;" class="headerlink" title="&#x5982;&#x4F55;&#x624B;&#x52A8;&#x5EFA;&#x7ACB;&#x5BB9;&#x5668;"></a>&#x5982;&#x4F55;&#x624B;&#x52A8;&#x5EFA;&#x7ACB;&#x5BB9;&#x5668; <a href="#ru-he-shou-dong-jian-li-rong-qi" class="header-anchor">#</a></h1><p><em>&#x4EC5;&#x4E3A;&#x6559;&#x80B2;&#x76EE;&#x7684;&#x1F60F;</em></p><p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528; <code>btrfs</code> &#x6765;&#x8FDB;&#x884C; CoW &#x7684;&#x5B58;&#x50A8;&#x5C42;&#x7BA1;&#x7406;&#xFF0C;&#x5229;&#x7528;&#x5176; subvolume &#x548C; snapshot &#x673A;&#x5236;&#x3002;</p><p>&#x5148;&#x786E;&#x4FDD;&#x6302;&#x8F7D;&#x70B9;&#x90FD;&#x662F; <code>rprivate</code>&#xFF0C;&#x5426;&#x5219;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6302;&#x8F7D;&#x5982;&#x679C;&#x6C61;&#x67D3;&#x4E86;&#x5BBF;&#x4E3B;&#x7684;&#x6302;&#x8F7D;&#x5C31;&#x4E71;&#x5957;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount --make-rprivate /</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x521B;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA; btrfs &#x7684; subvolume&#xFF0C;&#x5E76;&#x4E14;&#x586B;&#x5145;&#x5165; alpine &#x7684;&#x955C;&#x50CF;&#x5185;&#x5BB9;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x521B;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x76EE;&#x5F55;</span></span><br><span class="line">$ mkdir -p images containers</span><br><span class="line"><span class="comment"># &#x521B;&#x5EFA; btrfs &#x7684; subvolume</span></span><br><span class="line">$ btrfs subvol create images/alpine</span><br><span class="line">Create subvolume <span class="string">&apos;images/alpine&apos;</span></span><br><span class="line">$ btrfs subvol list .</span><br><span class="line">ID 257 gen 8 top level 5 path images/alpine</span><br><span class="line"><span class="comment"># &#x586B;&#x5145;&#x5165; alpine &#x7684;&#x955C;&#x50CF;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x501F;&#x7528; docker &#x955C;&#x50CF; rootfs</span></span><br><span class="line">$ CID=$(docker run -d alpine <span class="literal">true</span>)</span><br><span class="line">Unable to find image <span class="string">&apos;alpine:latest&apos;</span> locally</span><br><span class="line">latest: Pulling from library/alpine</span><br><span class="line">0a8490d0dfd3: Pulling fs layer</span><br><span class="line">0a8490d0dfd3: Verifying Checksum</span><br><span class="line">0a8490d0dfd3: Download complete</span><br><span class="line">0a8490d0dfd3: Pull complete</span><br><span class="line">Digest: sha256:dfbd4a3a8ebca874ebd2474f044a0b33600d4523d03b0df76e5c5986cb02d7e8</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> alpine:latest</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$CID</span></span><br><span class="line">434cf134e44ee47211fab5c2da31de2ec13a22d9ed2a3e3da2a9831d7585d71e</span><br><span class="line">$ docker <span class="built_in">export</span> <span class="variable">$CID</span> | tar -C images/alpine/ -xf-</span><br><span class="line">$ ls images/alpine/</span><br><span class="line">bin  etc   lib    mnt   root  sbin  sys  usr</span><br><span class="line">dev  home  media  proc  run   srv   tmp  var</span><br></pre></td></tr></table></figure><p>&#x4EE5;&#x955C;&#x50CF; subvolume &#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x4F7F;&#x7528; snapshot &#x521B;&#x5EFA;&#x5BB9;&#x5668; tupperware&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ btrfs subvol snapshot images/alpine/ containers/tupperware</span><br><span class="line">Create a snapshot of <span class="string">&apos;images/alpine/&apos;</span> <span class="keyword">in</span> <span class="string">&apos;containers/tupperware&apos;</span></span><br><span class="line">$ ls containers/tupperware/</span><br><span class="line">bin  etc   lib    mnt   root  sbin  sys  usr</span><br><span class="line">dev  home  media  proc  run   srv   tmp  var</span><br><span class="line"><span class="comment"># &#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x53EF;&#x4EE5;&#x8BA4;&#x51FA;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5EFA;&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#x6587;&#x4EF6;</span></span><br><span class="line">$ touch containers/tupperware/THIS_IS_TUPPERWAARE</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; <code>chroot</code> &#x8FDB;&#x5165;&#x6211;&#x4EEC;&#x7684;rootfs&#xFF0C;&#x53EF;&#x4EE5;&#x7528; alpine &#x7684;&#x5305;&#x7BA1;&#x7406; apk &#x4E86;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6682;&#x65F6;&#x8FD8;&#x4E0D;&#x80FD;&#x79F0;&#x4E3A;&#x5BB9;&#x5668;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ chroot containers/tupperware/ sh</span><br><span class="line">$ ls</span><br><span class="line">THIS_IS_TUPPERWAARE  media                srv</span><br><span class="line">bin                  mnt                  sys</span><br><span class="line">dev                  proc                 tmp</span><br><span class="line">etc                  root                 usr</span><br><span class="line">home                 run                  var</span><br><span class="line">lib                  sbin</span><br><span class="line">$ apk</span><br><span class="line">apk-tools 2.6.8, compiled <span class="keyword">for</span> x86_64.</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F00;&#x542F; namespace &#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528; <code>unshare</code> &#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unshare --mount --uts --ipc --net --pid --fork bash</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x540E;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5DF2;&#x7ECF;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#xFF0C;&#x7279;&#x522B;&#x662F; ps &#x7684;&#x65F6;&#x5019;&#x89C2;&#x5BDF;&#x5176; pid&#xFF0C;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684; pid&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ps</span><br><span class="line"> PID TTY          TIME CMD</span><br><span class="line">1846 pts/0    00:00:00 sudo</span><br><span class="line">1847 pts/0    00:00:00 bash</span><br><span class="line">2386 pts/0    00:00:00 unshare</span><br><span class="line">2387 pts/0    00:00:00 bash</span><br><span class="line">2412 pts/0    00:00:00 ps</span><br></pre></td></tr></table></figure><p>&#x5176;&#x5B9E;&#x8FD9;&#x4E9B; <code>pid</code> &#x5DF2;&#x7ECF;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x5230;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8BD5;&#x56FE; <code>kill</code> &#x5176;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x8BF4;&#x627E;&#x4E0D;&#x5230;&#x8BE5;&#x8FDB;&#x7A0B;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">kill</span> 2386</span><br><span class="line">bash: <span class="built_in">kill</span>: (2386) - No such process</span><br></pre></td></tr></table></figure><p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#x91CD;&#x65B0;&#x6302;&#x8F7D; <code>/proc</code>&#xFF0C;&#x7136;&#x540E; <code>ps</code> &#x5C31;&#x771F;&#x7684;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4FE1;&#x606F;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mount -t proc none /proc</span><br><span class="line">$ ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 03:43 pts/0    00:00:00 bash</span><br><span class="line">root        28     1  0 03:45 pts/0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure><p>&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x4F9D;&#x65E7;&#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5207;&#x6362;&#x5230; tuppwerware &#x4E0B;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC; <code>pivot_root</code> &#x76F4;&#x63A5;&#x6C38;&#x4F1A;&#x62A5;&#x9519;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> containers/tupperware</span><br><span class="line">$ mkdir oldroot</span><br><span class="line">$ pivot_root . oldroot/</span><br><span class="line">pivot_root: failed to change root from `.<span class="string">&apos; to `oldroot/&apos;</span>: Invalid argument</span><br></pre></td></tr></table></figure><p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x662F;&#x5229;&#x7528; bind-mount&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /</span><br><span class="line">$ mount --<span class="built_in">bind</span> /mnt/data/containers/tupperware/ /mnt/data/containers/tupperware/</span><br><span class="line">$ mount --move /mnt/data/containers/tupperware/ /btrfs</span><br><span class="line">$ <span class="built_in">cd</span> /btrfs/</span><br><span class="line">$ ls</span><br><span class="line">THIS_IS_TUPPERWAARE  dev  home  media  oldroot  root  sbin  sys  usr</span><br><span class="line">bin                  etc  lib   mnt    proc     run   srv   tmp  var</span><br><span class="line">$ pivot_root . oldroot/</span><br><span class="line">$ <span class="built_in">cd</span> /</span><br><span class="line">$ ls -al</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x    1 root     root           180 Jan 30 03:46 .</span><br><span class="line">drwxr-xr-x    1 root     root           180 Jan 30 03:46 ..</span><br><span class="line">-rwxr-xr-x    1 root     root             0 Jan 30 03:32 .dockerenv</span><br><span class="line">-rw-r--r--    1 root     root             0 Jan 30 03:40 THIS_IS_TUPPERWAARE</span><br><span class="line">drwxr-xr-x    1 root     root           808 Dec 26 21:32 bin</span><br><span class="line">drwxr-xr-x    1 root     root            34 Jan 30 03:32 dev</span><br><span class="line">drwxr-xr-x    1 root     root           524 Jan 30 03:32 etc</span><br><span class="line">drwxr-xr-x    1 root     root             0 Dec 26 21:32 home</span><br><span class="line">drwxr-xr-x    1 root     root           278 Dec 26 21:32 lib</span><br><span class="line">drwxr-xr-x    1 root     root            28 Dec 26 21:32 media</span><br><span class="line">drwxr-xr-x    1 root     root             0 Dec 26 21:32 mnt</span><br><span class="line">drwxr-xr-x   26 root     root          4096 Jan 30 03:50 oldroot</span><br><span class="line">drwxr-xr-x    1 root     root             0 Dec 26 21:32 proc</span><br><span class="line">drwx------    1 root     root            24 Jan 30 03:41 root</span><br><span class="line">drwxr-xr-x    1 root     root             0 Dec 26 21:32 run</span><br><span class="line">drwxr-xr-x    1 root     root           778 Dec 26 21:32 sbin</span><br><span class="line">drwxr-xr-x    1 root     root             0 Dec 26 21:32 srv</span><br><span class="line">drwxr-xr-x    1 root     root             0 Dec 26 21:32 sys</span><br><span class="line">drwxrwxrwt    1 root     root             0 Dec 26 21:32 tmp</span><br><span class="line">drwxr-xr-x    1 root     root            40 Dec 26 21:32 usr</span><br><span class="line">drwxr-xr-x    1 root     root            78 Dec 26 21:32 var</span><br><span class="line">$ mount -t proc none /proc</span><br><span class="line">$ ps -ef</span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 bash</span><br><span class="line">   44 root       0:00 ps -ef</span><br></pre></td></tr></table></figure><p>&#x73B0;&#x5728;&#x770B;&#x8D77;&#x6765;&#x5C31;&#x66F4;&#x50CF;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x4E86;&#xFF0C;&#x6709;&#x4E86;&#x81EA;&#x5DF1;&#x7684; rootfs&#xFF0C;&#x6709;&#x4E86;&#x81EA;&#x5DF1;&#x7684; pid &#x7A7A;&#x95F4;&#x3002;&#x4E0D;&#x8FC7; mount &#x8FD8;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5378;&#x6389;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ umount -a</span><br><span class="line">umount: can<span class="string">&apos;t unmount /oldroot/mnt/data: Resource busy</span></span><br><span class="line"><span class="string">umount: can&apos;</span>t unmount /oldroot: Resource busy</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x91CC; <code>/oldroot</code> &#x4E0D;&#x8BA9;&#x5378;&#x8F7D;&#xFF0C;&#x56E0;&#x4E3A;&#x8BBE;&#x5907;&#x5FD9;&#x3002;&#x8FD9;&#x53C8;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x5730;&#x65B9;&#x9700;&#x8981;&#x7ED5;&#x8FC7;&#x7684;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ umount -l /oldroot/</span><br><span class="line">$ mount -t proc none /proc</span><br><span class="line">$ mount</span><br><span class="line">/dev/dm-2 on / <span class="built_in">type</span> btrfs (ro,relatime,space_cache,subvolid=258,subvol=/containers/tupperware)</span><br><span class="line">none on /proc <span class="built_in">type</span> proc (rw,relatime)</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x56DE;&#x6302;&#x8F7D;&#x5C31;&#x6B63;&#x5E38;&#x4E86;&#xFF0C;&#x4EC5;&#x5269;&#x5BB9;&#x5668;&#x7684;&#x6302;&#x8F7D;&#x4E86;&#x3002;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x7F51;&#x7EDC;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x65F6;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x60F3;&#x8BBF;&#x95EE;&#x5916;&#x754C;&#x7F51;&#x7EDC;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x539F;&#x56E0;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x8FD8;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x5462;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">$ ifconfig -a</span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          LOOPBACK  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1</span><br><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x9700;&#x8981;<strong>&#x65B0;&#x5F00;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;</strong>&#xFF0C;&#x5728;<em>&#x5BBF;&#x4E3B;</em>&#x6267;&#x884C;&#x547D;&#x4EE4;&#x5EFA;&#x7ACB;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5148;&#x67E5;&#x5230;&#x6211;&#x4EEC;&#x5BB9;&#x5668;&#x7684;&#x8FDB;&#x7A0B; ID</span></span><br><span class="line">$ pidof unshare</span><br><span class="line">2386</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7136;&#x540E;&#x6DFB;&#x52A0;&#x4E00;&#x5BF9; veth &#x63A5;&#x53E3;</span></span><br><span class="line">$ ip link add name h2386 <span class="built_in">type</span> veth peer name c2386</span><br><span class="line">$ ip link</span><br><span class="line">...</span><br><span class="line">6: c2386@h2386: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether 86:ce:e2:44:86:e5 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">7: h2386@c2386: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether c6:9e:00:0e:df:4d brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x79F0;&#x5BBF;&#x4E3B;&#x7684;&#x90A3;&#x7AEF;&#x53EB; <code>h2386</code>&#xFF0C;&#x5BB9;&#x5668;&#x90A3;&#x7AEF;&#x53EB; <code>c2386</code>&#x3002;</p><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C06;&#x5BB9;&#x5668;&#x7684;&#x90A3;&#x7AEF;&#x7F6E;&#x4E8E;&#x5BB9;&#x5668;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#xFF0C;&#x800C;&#x5BBF;&#x4E3B;&#x8FD9;&#x7AEF;&#x8FDE;&#x5165; <code>docker0</code> &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ip link <span class="built_in">set</span> c2386 netns 2386</span><br><span class="line">$ ip link <span class="built_in">set</span> h2386 master docker0 up</span><br></pre></td></tr></table></figure><p><em>&#x5207;&#x6362;&#x5230;&#x5BB9;&#x5668;&#x5185;</em>&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FDE;&#x5165;&#x8FDB;&#x6765;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig -a</span><br><span class="line">c2386     Link encap:Ethernet  HWaddr 86:CE:E2:44:86:E5</span><br><span class="line">          BROADCAST MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          LOOPBACK  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1</span><br><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line">$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">6: c2386@if7: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN qlen 1000</span><br><span class="line">    link/ether 86:ce:e2:44:86:e5 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C06;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x63A5;&#x53E3;&#x540D;&#x79F0;&#x8BBE;&#x4E3A; <code>eth0</code>&#xFF0C;&#x5E76;&#x4E14;&#x7ED9;&#x5B9A;&#x5730;&#x5740;&#x548C;&#x7F51;&#x5173;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ip link <span class="built_in">set</span> lo up</span><br><span class="line">$ ip link <span class="built_in">set</span> c2386 name eth0 up</span><br><span class="line">$ ip addr add 172.17.10.123/16 dev eth0</span><br><span class="line">$ ip route add default via 172.17.0.1</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x7684;&#x5BB9;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x4E0A;&#x7F51;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ip route</span><br><span class="line">default via 172.17.0.1 dev eth0</span><br><span class="line">172.17.0.0/16 dev eth0  src 172.17.10.123</span><br><span class="line">$ ping 8.8.8.8</span><br><span class="line">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span><br><span class="line">64 bytes from 8.8.8.8: seq=0 ttl=61 time=6.956 ms</span><br><span class="line">64 bytes from 8.8.8.8: seq=1 ttl=61 time=6.405 ms</span><br><span class="line">^C</span><br><span class="line">--- 8.8.8.8 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 6.405/6.680/6.956 ms</span><br></pre></td></tr></table></figure><p><em>&#x89C6;&#x9891;&#x4E2D;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x6B65;&#x65F6;&#x7531;&#x4E8E;&#x7F51;&#x5173;&#x5199;&#x9519;&#x4E86;&#xFF0C;&#x5BFC;&#x81F4;&#x6700;&#x540E;&#x4E00;&#x6B65;&#x7F51;&#x7EDC;&#x672A;&#x80FD;&#x8054;&#x901A;&#x3002;</em></p><p>&#x7531;&#x4E8E;&#x65F6;&#x95F4;&#x6709;&#x9650;&#xFF0C;&#x8FD8;&#x6709;&#x5927;&#x91CF;&#x7684;&#x4E3B;&#x9898;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x65E0;&#x6CD5;&#x6F14;&#x793A;&#xFF0C;&#x6BD4;&#x5982; cgroups&#x3001;devices&#x3001;capabilities, selinux &#x7B49;&#x7B49;&#x5927;&#x91CF;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5728;&#x6F14;&#x793A;&#x4E4B;&#x524D;&#x5C31;&#x63D0;&#x5230;&#xFF0C;<em>&#x4EC5;&#x4E3A;&#x6559;&#x80B2;&#x76EE;&#x7684;</em>&#x3002;&#x6216;&#x8BB8;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x8FC7;&#x51E0;&#x5341;&#x884C;&#x7684; bash &#x811A;&#x672C;&#x5C31;&#x53EF;&#x4EE5;&#x505A;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F46;&#x662F;<strong>&#x80FD;&#x8FD9;&#x4E48;&#x505A;&#x4E0D;&#x7B49;&#x4E8E;&#x5E94;&#x8BE5;&#x8FD9;&#x4E48;&#x505A;</strong>&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线 Meetup 42 - 使用 Docker 1.12 的技巧</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-12-10-video-docker-online-meetup-42-tips-and-tricks-for-using-docker.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-12-10-video-docker-online-meetup-42-tips-and-tricks-for-using-docker.html</id>
    <published>2016-12-09T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.623Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#docker-1-12-de-fu-wu-fa-xian">Docker 1.12 &#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;</a><ul><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#docker-1-12-xin-zeng-nei-rong">Docker 1.12 &#x65B0;&#x589E;&#x5185;&#x5BB9;</a></li><li><a href="#docker-fu-wu-fa-xian-de-fa-zhan">Docker &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x53D1;&#x5C55;</a></li><li><a href="#shi-me-shi-fu-wu">&#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#xFF1F;</a></li><li><a href="#li-jie-fu-wu-fa-xian">&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;</a></li><li><a href="#zai-swarm-mode-xia-yan-shi-fu-wu-fa-xian">&#x5728; Swarm Mode &#x4E0B;&#x6F14;&#x793A;&#x670D;&#x52A1;&#x53D1;&#x73B0;</a></li></ul></li><li><a href="#she-zhi-swarm-ji-qun-yi-ji-ji-cheng-haproxy">&#x8BBE;&#x7F6E; Swarm &#x96C6;&#x7FA4;&#x4EE5;&#x53CA;&#x96C6;&#x6210; HAProxy</a><ul><li><a href="#zi-wo-jie-shao-1">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#wang-luo-tuo-bu">&#x7F51;&#x7EDC;&#x62D3;&#x6251;</a></li><li><a href="#chuang-jian-wang-luo">&#x521B;&#x5EFA;&#x7F51;&#x7EDC;</a></li><li><a href="#chuang-jian-fu-wu">&#x521B;&#x5EFA;&#x670D;&#x52A1;</a></li><li><a href="#diao-shi">&#x8C03;&#x8BD5;</a></li><li><a href="#diao-zheng-fu-wu">&#x8C03;&#x6574;&#x670D;&#x52A1;</a></li><li><a href="#tian-jia-fan-xiang-dai-li-fu-wu">&#x6DFB;&#x52A0;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x670D;&#x52A1;</a></li><li><a href="#sheng-ji-fu-wu">&#x5347;&#x7EA7;&#x670D;&#x52A1;</a></li></ul></li><li><a href="#docker-1-12-ming-ling-xuan-xiang-he-bie-ming-ji-qiao">Docker 1.12 &#x547D;&#x4EE4;&#x9009;&#x9879;&#x548C;&#x522B;&#x540D;&#x6280;&#x5DE7;</a><ul><li><a href="#li-yong-ming-ling-bu-quan">&#x5229;&#x7528;&#x547D;&#x4EE4;&#x8865;&#x5168;</a></li><li><a href="#shi-yong-volume-de-shi-hou-jin-liang-shi-yong-ming-ming-juan">&#x4F7F;&#x7528; <code>volume</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x5377;</a></li><li><a href="#yao-xue-hui-shi-yong-onbuild-jing-xiang">&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528; <code>-onbuild</code> &#x955C;&#x50CF;</a></li><li><a href="#yao-xue-hui-shi-yong-docker-compose">&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528; <code>Docker Compose</code></a></li><li><a href="#shi-yong-alias-lai-yu-ding-yi-bi-jiao-chang-de-ming-ling">&#x4F7F;&#x7528; <code>alias</code> &#x6765;&#x9884;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x957F;&#x7684;&#x547D;&#x4EE4;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup #42: Docker Captains Share Tips &amp; Tricks for Using Docker 1.12<br>by Ajeet Singh Raina, Viktor Farcic, Bret Fisher &#xFF08;Docker &#x961F;&#x957F;&#xFF09;<br>2016-08-31</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/2ihqKMDRkxM" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=2ihqKMDRkxM" target="_blank" rel="noopener">https://www.youtube.com/watch?v=2ihqKMDRkxM</a></p><h1 id="docker-1-12-de-fu-wu-fa-xian"><a href="#Docker-1-12-&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="Docker 1.12 &#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>Docker 1.12 &#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#docker-1-12-de-fu-wu-fa-xian" class="header-anchor">#</a></h1><h2 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h2><p><code>Ajeet Singh Raina</code> &#x66FE;&#x5728; VMWare &#x5DE5;&#x4F5C;&#xFF0C;&#x73B0;&#x5728;&#x5728; Dell &#x5DE5;&#x4F5C;&#x3002;</p><h2 id="docker-1-12-xin-zeng-nei-rong"><a href="#Docker-1-12-&#x65B0;&#x589E;&#x5185;&#x5BB9;" class="headerlink" title="Docker 1.12 &#x65B0;&#x589E;&#x5185;&#x5BB9;"></a>Docker 1.12 &#x65B0;&#x589E;&#x5185;&#x5BB9; <a href="#docker-1-12-xin-zeng-nei-rong" class="header-anchor">#</a></h2><ul><li>&#x5185;&#x7F6E; Swarm Mode</li><li><code>SwarmKit</code> &#x72EC;&#x7ACB;&#x51FA;&#x6765;&#x79F0;&#x4E3A;&#x7F16;&#x6392;&#x7684;&#x57FA;&#x7840;&#x5E93;</li><li>&#x4E09;&#x4E2A;&#x4E3B;&#x8981;&#x7684; <code>Swarm API</code> / <code>CLI</code> &#x88AB;&#x52A0;&#x8FDB;&#x6765;<ul><li><code>docker swarm init/join</code></li><li><code>docker node</code></li><li><code>docker service</code></li></ul></li><li>&#x670D;&#x52A1;(<code>Service</code>)&#x79F0;&#x4E3A;&#x4E3B;&#x8981;&#x6210;&#x5458;</li></ul><h2 id="docker-fu-wu-fa-xian-de-fa-zhan"><a href="#Docker-&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x53D1;&#x5C55;" class="headerlink" title="Docker &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x53D1;&#x5C55;"></a>Docker &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x53D1;&#x5C55; <a href="#docker-fu-wu-fa-xian-de-fa-zhan" class="header-anchor">#</a></h2><ul><li>Docker <code>1.9</code><ul><li>&#x4F7F;&#x7528; <code>/etc/hosts</code> &#x548C; <code>/etc/resolv.conf</code> &#x6765;&#x5BF9;&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x89E3;&#x6790;</li><li>&#x5F88;&#x5BB9;&#x6613;&#x5BFC;&#x81F4; <code>/etc/hosts</code> &#x88AB;&#x7834;&#x574F;</li><li>&#x7F3A;&#x4E4F;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x80FD;&#x529B;</li><li>&#x4F7F;&#x5F97;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5F88;&#x590D;&#x6742;</li></ul></li><li>Docker <code>1.10/1.11</code><ul><li>&#x4F7F;&#x7528;&#x5D4C;&#x5165;&#x5F0F; DNS<ul><li><code>--network-alias=ALIAS</code></li><li><code>--link=CONTAINER_NAME:ALIAS</code></li><li><code>--dns=[IP_ADDRESS...]</code></li><li><code>--dns-search=DOMAIN</code></li></ul></li><li>&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4F7F;&#x7528;&#x5916;&#x7F6E;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#xFF0C;&#x5982; <code>etcd</code>, <code>consul</code>, <code>zookeeper</code> &#x7B49;</li></ul></li><li>Docker <code>1.12</code><ul><li>&#x4E0D;&#x5728;&#x9700;&#x8981;&#x5916;&#x7F6E;&#x952E;&#x503C;&#x5E93;</li><li>&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x76F4;&#x63A5;&#x548C; <code>docker service</code> &#x7ED3;&#x5408;&#x5728;&#x4E00;&#x8D77;</li><li><code>Service</code> &#x6210;&#x4E3A; <code>First Class Citizen</code></li><li><code>Network</code> &#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x8303;&#x7574;(<code>Scope</code>)</li><li>&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4F7F;&#x7528;<code>&#x975E; FQDN</code> &#x540D;&#x79F0;</li><li>&#x7531;&#x5185;&#x7F6E; DNS &#x63D0;&#x4F9B;</li><li>HA &#x9AD8;&#x53EF;&#x7528;</li><li>&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x53D1;&#x73B0; <code>Service</code> &#x4EE5;&#x53CA; <code>Task</code></li></ul></li></ul><h2 id="shi-me-shi-fu-wu"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#xFF1F; <a href="#shi-me-shi-fu-wu" class="header-anchor">#</a></h2><p>&#x662F;&#x7528;&#x6237;&#x4F7F;&#x7528; Swarm &#x7CFB;&#x7EDF;&#x7684;&#x6838;&#x5FC3;&#x7ED3;&#x6784;&#x3002;&#x5B9A;&#x4E49;&#x4E86;&#x5728;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x4EFB;&#x52A1; <code>Task</code>&#xFF0C;<code>Task</code> &#x73B0;&#x5728;&#x4E3B;&#x8981;&#x662F;&#x5BB9;&#x5668;&#xFF0C;&#x5C06;&#x6765;&#x4F1A;&#x6269;&#x5C55;&#x5230; <code>Unikernel</code> &#x548C; <code>VM</code>&#x3002;</p><p>&#x670D;&#x52A1;&#x7C7B;&#x578B;&#xFF1A;</p><ul><li><code>Global</code> &#x5168;&#x5C40;&#x670D;&#x52A1;&#xFF1A; <code>docker service create --mode=global</code></li><li><code>Replicated</code> &#x526F;&#x672C;&#x670D;&#x52A1;&#xFF1A; <code>docker service create --replicas=3</code></li></ul><p>&#x66FE;&#x7ECF;<strong>&#x4EE5;&#x5BB9;&#x5668;&#x4E3A;&#x4E2D;&#x5FC3;</strong>&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5982; <code>docker run -d nginx</code>&#xFF0C;&#x8F6C;&#x53D8;&#x4E3A;<strong>&#x4EE5;&#x670D;&#x52A1;&#x4E3A;&#x4E2D;&#x5FC3;</strong>&#x7684; <code>docker service create --replicas 5 nginx</code></p><h2 id="li-jie-fu-wu-fa-xian"><a href="#&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#li-jie-fu-wu-fa-xian" class="header-anchor">#</a></h2><ul><li>&#x5BB9;&#x5668;&#x5185;&#x4EA7;&#x751F;&#x57DF;&#x540D;&#xFF08;&#x8FD9;&#x91CC;&#x6307;&#x975E; FQDN &#x57DF;&#x540D;&#xFF09;&#x8BF7;&#x6C42;&#xFF0C;</li><li>&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/etc/resolv.conf</code> &#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x662F; <code>nameserver 127.0.0.11</code></li><li>&#x5BB9;&#x5668;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#xFF0C;&#x548C;&#x8FD9;&#x4E2A; DNS &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x3001;&#x53D1;&#x9001;&#x8BF7;&#x6C42;</li><li>&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x88AB; <code>iptables</code> &#x622A;&#x83B7;&#xFF0C;&#x8F6C;&#x53D1;&#x7ED9;&#x5D4C;&#x5165;&#x5F0F; DNS</li><li>&#x5D4C;&#x5165;&#x5F0F; DNS &#x5219;&#x6839;&#x636E;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x7F51;&#x7EDC;&#xFF0C;&#x4EE5;&#x53CA;&#x6240;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x60C5;&#x51B5;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4FE1;&#x606F;</li></ul><h2 id="zai-swarm-mode-xia-yan-shi-fu-wu-fa-xian"><a href="#&#x5728;-Swarm-Mode-&#x4E0B;&#x6F14;&#x793A;&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="&#x5728; Swarm Mode &#x4E0B;&#x6F14;&#x793A;&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>&#x5728; Swarm Mode &#x4E0B;&#x6F14;&#x793A;&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#zai-swarm-mode-xia-yan-shi-fu-wu-fa-xian" class="header-anchor">#</a></h2><ul><li>&#x521B;&#x5EFA; <code>overlay network</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker network create \</span><br><span class="line">-d overlay collabnet \</span><br><span class="line">--subnet 10.0.3.0 \</span><br><span class="line">--opt encrypted</span><br></pre></td></tr></table></figure><ul><li>&#x521B;&#x5EFA;&#x670D;&#x52A1;</li></ul><p>&#x521B;&#x5EFA; <code>DNSRR</code> &#x670D;&#x52A1;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--endpoint-mode dnsrr \</span><br><span class="line">--name wordpressapp \</span><br><span class="line">--replicas 5 \</span><br><span class="line">--network collabnet \</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><p>&#x521B;&#x5EFA; <code>VIP</code> &#x670D;&#x52A1;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--name wordpressapp \</span><br><span class="line">--replicas 5 \</span><br><span class="line">--publish 80:80/tcp \</span><br><span class="line">--network collabnet \</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><ul><li>&#x67E5;&#x770B;&#x670D;&#x52A1;&#x5BF9;&#x5E94;&#x7684; <code>VIP</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker service inspect \</span><br><span class="line">--format=<span class="string">&quot;{{json .Endpoint.VirtualIPs}}&quot;</span> \</span><br><span class="line">wordpressapp</span><br><span class="line">[{<span class="string">&quot;NetworkID&quot;</span>:<span class="string">&quot;34fjvx3s4zz6uzg54jtu63ven&quot;</span>,<span class="string">&quot;Addr&quot;</span>:<span class="string">&quot;10.255.0.6/16&quot;</span>},{<span class="string">&quot;NetworkID&quot;</span>:<span class="string">&quot;8za5qtqs8r0nz8309lopnp6fg&quot;</span>,<span class="string">&quot;Addr&quot;</span>:<span class="string">&quot;10.0.0.2/24&quot;</span>}]</span><br></pre></td></tr></table></figure><ul><li>&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x7684; DNS &#x522B;&#x540D;&#xFF0C;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A; VIP</li><li>DNS &#x4FE1;&#x606F;&#x901A;&#x8FC7; <code>GOSSIP</code> &#x534F;&#x8BAE;&#x5728;&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x95F4;&#x5171;&#x4EAB;</li><li>&#x7136;&#x540E;&#x4EFB;&#x4F55;&#x5BB9;&#x5668;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x540D;&#x79F0;&#x89E3;&#x6790;&#x65F6;&#xFF0C;&#x8282;&#x70B9;&#x5C31;&#x8D1F;&#x8D23;&#x89E3;&#x6790;</li></ul><h1 id="she-zhi-swarm-ji-qun-yi-ji-ji-cheng-haproxy"><a href="#&#x8BBE;&#x7F6E;-Swarm-&#x96C6;&#x7FA4;&#x4EE5;&#x53CA;&#x96C6;&#x6210;-HAProxy" class="headerlink" title="&#x8BBE;&#x7F6E; Swarm &#x96C6;&#x7FA4;&#x4EE5;&#x53CA;&#x96C6;&#x6210; HAProxy"></a>&#x8BBE;&#x7F6E; Swarm &#x96C6;&#x7FA4;&#x4EE5;&#x53CA;&#x96C6;&#x6210; HAProxy <a href="#she-zhi-swarm-ji-qun-yi-ji-ji-cheng-haproxy" class="header-anchor">#</a></h1><p>by <code>Viktor Farcic</code></p><h2 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;-1" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h2><p><strong><a href="https://leanpub.com/the-devops-2-toolkit" target="_blank" rel="noopener">&#x300A;The DevOps 2.0 Toolkit&#x300B;</a></strong> &#x7684;&#x4F5C;&#x8005;&#xFF0C;&#x5728; CloudBee &#x5DE5;&#x4F5C;</p><h2 id="wang-luo-tuo-bu"><a href="#&#x7F51;&#x7EDC;&#x62D3;&#x6251;" class="headerlink" title="&#x7F51;&#x7EDC;&#x62D3;&#x6251;"></a>&#x7F51;&#x7EDC;&#x62D3;&#x6251; <a href="#wang-luo-tuo-bu" class="header-anchor">#</a></h2><p><code>3</code>&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#xFF0C;<code>swarm-1</code>, <code>swarm-2</code>, <code>swarm-3</code>&#x3002;&#x5176;&#x4E2D; <code>swarm-1</code> &#x4E3A;<code>manager</code>&#x3002;</p><h2 id="chuang-jian-wang-luo"><a href="#&#x521B;&#x5EFA;&#x7F51;&#x7EDC;" class="headerlink" title="&#x521B;&#x5EFA;&#x7F51;&#x7EDC;"></a>&#x521B;&#x5EFA;&#x7F51;&#x7EDC; <a href="#chuang-jian-wang-luo" class="header-anchor">#</a></h2><p>&#x521B;&#x5EFA;&#x4E24;&#x4E2A; <code>overlay network</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d overlay proxy</span><br><span class="line">docker network create -d overlay go-demo</span><br></pre></td></tr></table></figure><h2 id="chuang-jian-fu-wu"><a href="#&#x521B;&#x5EFA;&#x670D;&#x52A1;" class="headerlink" title="&#x521B;&#x5EFA;&#x670D;&#x52A1;"></a>&#x521B;&#x5EFA;&#x670D;&#x52A1; <a href="#chuang-jian-fu-wu" class="header-anchor">#</a></h2><p>&#x521B;&#x5EFA; <code>MongoDB</code> &#x670D;&#x52A1;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--name go-demo-db \</span><br><span class="line">--network go-demo \</span><br><span class="line">--reserve-memory 100m \</span><br><span class="line">mongo</span><br></pre></td></tr></table></figure><p>&#x521B;&#x5EFA; <code>go-demo</code> &#x670D;&#x52A1;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--name go-demo \</span><br><span class="line">-e DB=go-demo-db \</span><br><span class="line">--network go-demo \</span><br><span class="line">--network proxy \</span><br><span class="line">--reserve-memory 50m \</span><br><span class="line">vfarcic/go-demo</span><br></pre></td></tr></table></figure><h2 id="diao-shi"><a href="#&#x8C03;&#x8BD5;" class="headerlink" title="&#x8C03;&#x8BD5;"></a>&#x8C03;&#x8BD5; <a href="#diao-shi" class="header-anchor">#</a></h2><p>&#x4E3A;&#x4E86;&#x8C03;&#x8BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x8C03;&#x8BD5;&#x670D;&#x52A1;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--name util \</span><br><span class="line">--network go-demo \</span><br><span class="line">--network proxy \</span><br><span class="line">--mode global \</span><br><span class="line">alpine</span><br><span class="line">sleep 1000000000</span><br></pre></td></tr></table></figure><p>&#x901A;&#x8FC7; <code>docker service ps util</code> &#x6765;&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x5DF2;&#x7ECF;&#x5728;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x4E86;&#x3002;</p><p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;&#x8FDE;&#x5165;&#x672C;&#x8282;&#x70B9;&#x7684; <code>util</code> &#x5BB9;&#x5668;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ID=$(docker ps -q --filter label=com.docker.swarm.service.name=util)</span><br><span class="line">docker <span class="built_in">exec</span> -it <span class="variable">$ID</span> apk add --update drill</span><br><span class="line">docker <span class="built_in">exec</span> -it <span class="variable">$ID</span> drill go-demo</span><br><span class="line">docker <span class="built_in">exec</span> -it <span class="variable">$ID</span> drill go-demo-db</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x5F97;&#x5230;&#x7684; <code>go-demo</code> &#x548C; <code>go-demo-db</code> &#x5BF9;&#x5E94;&#x7684;IP&#x5730;&#x5740;&#x662F;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x662F; <code>VIP</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x5730;&#x5740;&#x3002;</p><h2 id="diao-zheng-fu-wu"><a href="#&#x8C03;&#x6574;&#x670D;&#x52A1;" class="headerlink" title="&#x8C03;&#x6574;&#x670D;&#x52A1;"></a>&#x8C03;&#x6574;&#x670D;&#x52A1; <a href="#diao-zheng-fu-wu" class="header-anchor">#</a></h2><p>Scale Up</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service scale go-demo=5</span><br></pre></td></tr></table></figure><h2 id="tian-jia-fan-xiang-dai-li-fu-wu"><a href="#&#x6DFB;&#x52A0;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x670D;&#x52A1;" class="headerlink" title="&#x6DFB;&#x52A0;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x670D;&#x52A1;"></a>&#x6DFB;&#x52A0;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x670D;&#x52A1; <a href="#tian-jia-fan-xiang-dai-li-fu-wu" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; <code>consul</code> &#x670D;&#x52A1;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/vfarcic/docker-flow-proxy/master/docker-compose.yml</span><br><span class="line"><span class="built_in">export</span> DOCKER_IP=$(docker-machine ip swarm-1)</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x8FD0;&#x884C; <code>haproxy</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--name proxy \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-p 443:443 \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">--network proxy \</span><br><span class="line">-e MODE=swarm \</span><br><span class="line">--replicas 3 \</span><br><span class="line">-e CONSUL_ADDRESS=$(docker-machine ip swarm-1):8500 \</span><br><span class="line">vfarcic/docker-flow-proxy</span><br></pre></td></tr></table></figure><h2 id="sheng-ji-fu-wu"><a href="#&#x5347;&#x7EA7;&#x670D;&#x52A1;" class="headerlink" title="&#x5347;&#x7EA7;&#x670D;&#x52A1;"></a>&#x5347;&#x7EA7;&#x670D;&#x52A1; <a href="#sheng-ji-fu-wu" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service update \</span><br><span class="line">--image vfarcic/go-demo:1.1 \</span><br><span class="line">--update-delay 5s \</span><br><span class="line">go-demo</span><br></pre></td></tr></table></figure><h1 id="docker-1-12-ming-ling-xuan-xiang-he-bie-ming-ji-qiao"><a href="#Docker-1-12-&#x547D;&#x4EE4;&#x9009;&#x9879;&#x548C;&#x522B;&#x540D;&#x6280;&#x5DE7;" class="headerlink" title="Docker 1.12 &#x547D;&#x4EE4;&#x9009;&#x9879;&#x548C;&#x522B;&#x540D;&#x6280;&#x5DE7;"></a>Docker 1.12 &#x547D;&#x4EE4;&#x9009;&#x9879;&#x548C;&#x522B;&#x540D;&#x6280;&#x5DE7; <a href="#docker-1-12-ming-ling-xuan-xiang-he-bie-ming-ji-qiao" class="header-anchor">#</a></h1><p>by <code>Bret Fisher</code></p><h2 id="li-yong-ming-ling-bu-quan"><a href="#&#x5229;&#x7528;&#x547D;&#x4EE4;&#x8865;&#x5168;" class="headerlink" title="&#x5229;&#x7528;&#x547D;&#x4EE4;&#x8865;&#x5168;"></a>&#x5229;&#x7528;&#x547D;&#x4EE4;&#x8865;&#x5168; <a href="#li-yong-ming-ling-bu-quan" class="header-anchor">#</a></h2><p>&#x663E;&#x793A; <code>my</code> &#x5F00;&#x5934;&#x7684;&#x955C;&#x50CF;&#x7528;&#x6765;&#x5220;&#x9664;</p><p><code>docker rmi my&lt;tab&gt;&lt;tab&gt;</code></p><p>&#x663E;&#x793A; <code>--a</code> &#x5F00;&#x5934;&#x7684;&#x53C2;&#x6570;<br><code>docker --a&lt;tab&gt;&lt;tab&gt;</code></p><h2 id="shi-yong-volume-de-shi-hou-jin-liang-shi-yong-ming-ming-juan"><a href="#&#x4F7F;&#x7528;-volume-&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x5377;" class="headerlink" title="&#x4F7F;&#x7528; volume &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x5377;"></a>&#x4F7F;&#x7528; <code>volume</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x5377; <a href="#shi-yong-volume-de-shi-hou-jin-liang-shi-yong-ming-ming-juan" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528;&#x547D;&#x540D;&#x5377;&#x624D;&#x53EF;&#x80FD;&#x901A;&#x8FC7; <code>docker volume ls</code> &#x5217;&#x8868;&#x4E2D;&#x533A;&#x522B;&#x51FA;&#x4E0D;&#x540C;&#x7684;&#x5377;&#x662F;&#x4EC0;&#x4E48;&#x3002;</p><h2 id="yao-xue-hui-shi-yong-onbuild-jing-xiang"><a href="#&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528;-onbuild-&#x955C;&#x50CF;" class="headerlink" title="&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528; -onbuild &#x955C;&#x50CF;"></a>&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528; <code>-onbuild</code> &#x955C;&#x50CF; <a href="#yao-xue-hui-shi-yong-onbuild-jing-xiang" class="header-anchor">#</a></h2><p>&#x50CF; <code>ruby</code>, <code>node</code>, <code>python</code> &#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x6709; <code>onbuild</code> &#x7248;&#x672C;&#xFF0C;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x91CC;&#x9762;&#x5185;&#x7F6E;&#x4E86;&#x5E38;&#x7528;&#x7684;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x57FA;&#x672C;&#x4E0D;&#x5199; <code>Dockerfile</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x3002;&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p><h2 id="yao-xue-hui-shi-yong-docker-compose"><a href="#&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528;-Docker-Compose" class="headerlink" title="&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528; Docker Compose"></a>&#x8981;&#x5B66;&#x4F1A;&#x4F7F;&#x7528; <code>Docker Compose</code> <a href="#yao-xue-hui-shi-yong-docker-compose" class="header-anchor">#</a></h2><p>&#x7279;&#x522B;&#x662F;&#x5B66;&#x4F1A; <code>docker-compose down</code>&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76F4;&#x63A5;&#x524D;&#x53F0; <code>docker-compose up</code>&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x5F00;&#x53D1;&#xFF0C;&#x5F00;&#x53D1;&#x5230;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#xFF0C;<code>Ctrl-C</code> &#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x6837; <code>docker-compose</code> &#x4F1A; <code>kill</code> &#x6389;&#x8FD9;&#x4E9B;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x53EF;&#x95EE;&#x9898;&#x662F;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x8FD8;&#x5728;&#xFF0C;<code>docker ps -a</code> &#x8FD8;&#x4F1A;&#x770B;&#x5230;&#x5B83;&#x4EEC;&#xFF0C;&#x800C;&#x4E14; <code>docker network ls</code> &#x4E5F;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x4E9B;&#x7F51;&#x7EDC;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x66F4;&#x5E72;&#x51C0;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>docker-compose down</code>&#x3002;</p><p>&#x53EF;&#x4EE5;&#x5229;&#x7528; <code>docker-compose down</code> &#x7684; <code>-v</code> &#x53C2;&#x6570;&#x6765;&#x660E;&#x786E;&#x6E05;&#x9664;&#x5377;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5229;&#x7528; <code>--rmi local</code> &#x6765;&#x6E05;&#x9664;&#x81EA;&#x5DF1;&#x6784;&#x5EFA;&#x7684;&#x672C;&#x5730;&#x955C;&#x50CF;&#x3002;</p><h2 id="shi-yong-alias-lai-yu-ding-yi-bi-jiao-chang-de-ming-ling"><a href="#&#x4F7F;&#x7528;-alias-&#x6765;&#x9884;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x957F;&#x7684;&#x547D;&#x4EE4;" class="headerlink" title="&#x4F7F;&#x7528; alias &#x6765;&#x9884;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x957F;&#x7684;&#x547D;&#x4EE4;"></a>&#x4F7F;&#x7528; <code>alias</code> &#x6765;&#x9884;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x957F;&#x7684;&#x547D;&#x4EE4; <a href="#shi-yong-alias-lai-yu-ding-yi-bi-jiao-chang-de-ming-ling" class="header-anchor">#</a></h2><p>&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> drmai=<span class="string">&apos;docker rmi $(docker images -a)&apos;</span></span><br><span class="line"><span class="built_in">alias</span> drdefault=<span class="string">&apos;eval &quot;$(docker-machine env default)&quot;&apos;</span></span><br><span class="line"><span class="built_in">alias</span> drit=<span class="string">&quot;docker exec -it&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="https://1x481n.github.io/blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线 Meetup 41 - 深入 Docker 1.12 网络 - Madhu Venugopal</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-12-09-video-docker-online-meetup-41-deep-dive-into-docker-1-12-networking.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-12-09-video-docker-online-meetup-41-deep-dive-into-docker-1-12-networking.html</id>
    <published>2016-12-08T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.623Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#shi-me-shi-libnetwork">&#x4EC0;&#x4E48;&#x662F; <code>libnetwork</code>&#xFF1F;</a></li><li><a href="#she-ji-si-xiang">&#x8BBE;&#x8BA1;&#x601D;&#x60F3;</a></li><li><a href="#docker-wang-luo-fa-zhan">Docker &#x7F51;&#x7EDC;&#x53D1;&#x5C55;</a></li><li><a href="#cnm-rong-qi-wang-luo-mo-xing"><code>CNM</code> &#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;</a></li><li><a href="#wang-luo-qu-dong">&#x7F51;&#x7EDC;&#x9A71;&#x52A8;</a><ul><li><a href="#case-1-mo-ren-qiao-jie-wang-luo-bridge0">Case 1: &#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC; (<code>bridge0</code>)</a></li><li><a href="#case-2-yong-hu-zi-ding-yi-qiao-jie-wang-luo">Case 2: &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC;</a></li><li><a href="#case-3-qiao-jie-wang-luo-lian-ru-xia-ceng-wang-luo-bing-shi-yong-ipam-mei-you-nat-duan-kou-ying-she">Case 3: &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;<code>IPAM</code> (&#x6CA1;&#x6709;NAT/&#x7AEF;&#x53E3;&#x6620;&#x5C04;)</a></li><li><a href="#case-4-overlay-networking">Case 4: Overlay Networking</a></li><li><a href="#case-5-macvlan-1-12-xin-zeng">Case 5: Macvlan (1.12&#x65B0;&#x589E;)</a></li></ul></li><li><a href="#1-12-xin-gong-neng">1.12 &#x65B0;&#x529F;&#x80FD;</a><ul><li><a href="#swarm-mode-zhong-de-xin-gong-neng">Swarm Mode &#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</a><ul><li><a href="#swarm-mode-zhong-de-duo-su-zhu-hu-lian">Swarm mode &#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;</a></li><li><a href="#an-quan-de-kong-zhi-ceng">&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42;</a></li><li><a href="#an-quan-de-shu-ju-ceng">&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42;</a></li><li><a href="#fu-wu-fa-xian">&#x670D;&#x52A1;&#x53D1;&#x73B0;</a></li><li><a href="#fu-zai-jun-heng">&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><li><a href="#mesh-lu-you">Mesh &#x8DEF;&#x7531;</a></li></ul></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup #41: Deep Dive into Docker 1.12 Networking<br>by Madhu Venugopal</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/nXaF2d97JnE" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=nXaF2d97JnE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=nXaF2d97JnE</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>Madhu Venugopal &#x4EE5;&#x524D;&#x662F; DockerPlane &#x7684; CEO&#xFF0C;&#x540E;&#x6765;&#x88AB; Docker &#x6536;&#x8D2D;&#x4E86;&#x3002;</p><h1 id="shi-me-shi-libnetwork"><a href="#&#x4EC0;&#x4E48;&#x662F;-libnetwork&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; <code>libnetwork</code>&#xFF1F; <a href="#shi-me-shi-libnetwork" class="header-anchor">#</a></h1><p><code>libnetwork</code> &#x662F;&#x7F51;&#x7EDC;&#x90E8;&#x5206;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x9A71;&#x52A8;&#x63A5;&#x53E3;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x4E86;&#x6570;&#x636E;&#x5C42;&#x3001;&#x63A7;&#x5236;&#x5C42;&#x7B49;&#x7B49;&#x3002;</p><ul><li>Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE;</li><li>&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;</li><li>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;&#xFF08;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x4F7F;&#x7528;&#x5916;&#x90E8;&#x5730;&#x5740;&#x7BA1;&#x7406;&#xFF09;</li><li>&#x63D0;&#x4F9B;&#x539F;&#x751F;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8054;</li><li>&#x63D0;&#x4F9B;&#x539F;&#x751F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li><li>&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x6269;&#x5C55;&#xFF0C;&#x5F62;&#x6210;&#x751F;&#x6001;&#x73AF;&#x5883;</li></ul><h1 id="she-ji-si-xiang"><a href="#&#x8BBE;&#x8BA1;&#x601D;&#x60F3;" class="headerlink" title="&#x8BBE;&#x8BA1;&#x601D;&#x60F3;"></a>&#x8BBE;&#x8BA1;&#x601D;&#x60F3; <a href="#she-ji-si-xiang" class="header-anchor">#</a></h1><p>&#x7528;&#x6237;&#x662F;&#x7B2C;&#x4E00;&#x4F4D;&#x7684;</p><ul><li>&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x4EBA;&#x5458;</li><li>IT/&#x7F51;&#x7EDC;&#x8FD0;&#x7EF4;&#x4EBA;&#x5458;</li></ul><p>&#x63D2;&#x4EF6; API &#x8BBE;&#x8BA1;</p><ul><li>&#x601D;&#x60F3;&#x662F;&#xFF1A;<code>&#x5185;&#x7F6E;&#x7535;&#x6C60;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x66F4;&#x6362;</code></li></ul><h1 id="docker-wang-luo-fa-zhan"><a href="#Docker-&#x7F51;&#x7EDC;&#x53D1;&#x5C55;" class="headerlink" title="Docker &#x7F51;&#x7EDC;&#x53D1;&#x5C55;"></a>Docker &#x7F51;&#x7EDC;&#x53D1;&#x5C55; <a href="#docker-wang-luo-fa-zhan" class="header-anchor">#</a></h1><ul><li>Docker <code>1.7</code>:<ul><li>&#x72EC;&#x7ACB;&#x51FA; <code>libnetwork</code> &#x9879;&#x76EE;</li><li>&#x8BBE;&#x8BA1; <code>CNM</code> (&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;)</li><li>&#x8FC1;&#x79FB;&#x65E7;&#x7684; <code>bridge</code>, <code>host</code>, <code>none</code> &#x5230; <code>CNM</code> &#x4E0B;&#x3002;</li></ul></li><li>Docker <code>1.8</code>:<ul><li>&#x901A;&#x8FC7; <code>/etc/hosts</code> &#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x53D1;&#x73B0;</li></ul></li><li>Docker <code>1.9</code>:<ul><li>&#x5B9E;&#x73B0;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8054;</li><li>&#x7F51;&#x7EDC;&#x63D2;&#x4EF6;</li><li><code>IPAM</code> (IP &#x5730;&#x5740;&#x7BA1;&#x7406;) &#x63D2;&#x4EF6;</li><li>&#x7F51;&#x7EDC; <code>UX/API</code></li></ul></li><li>Docker <code>1.10</code>:<ul><li>&#x5185;&#x7F6E;&#x5206;&#x5E03;&#x5F0F; <code>DNS</code> &#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;</li></ul></li><li>Docker <code>1.11</code>:<ul><li>&#x6DFB;&#x52A0;&#x7F51;&#x7EDC;&#x522B;&#x540D; <code>alias</code></li><li>&#x5B9E;&#x73B0; DNS &#x8F6E;&#x8BE2;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li></ul></li><li>Docker <code>1.12</code>:<ul><li>&#x5B9E;&#x73B0;&#x57FA;&#x4E8E;<code>IPVS</code>&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li><li>&#x52A0;&#x5BC6;&#x63A7;&#x5236;&#x5C42;&#x548C;&#x6570;&#x636E;&#x5C42;</li><li>Mesh &#x8DEF;&#x7531;</li><li>&#x5185;&#x7F6E; Swarm Mode &#x96C6;&#x7FA4;&#x7F51;&#x7EDC;&#x4E92;&#x8054;</li></ul></li></ul><h1 id="cnm-rong-qi-wang-luo-mo-xing"><a href="#CNM-&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;" class="headerlink" title="CNM &#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;"></a><code>CNM</code> &#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B; <a href="#cnm-rong-qi-wang-luo-mo-xing" class="header-anchor">#</a></h1><p><a href="https://github.com/docker/libnetwork/blob/master/docs/design.md" target="_blank" rel="noopener">https://github.com/docker/libnetwork/blob/master/docs/design.md</a></p><ul><li><code>Endpoint</code></li><li><code>Network</code></li><li><code>Sandbox</code></li><li><code>Driver</code> &amp; <code>Plugins</code></li></ul><h1 id="wang-luo-qu-dong"><a href="#&#x7F51;&#x7EDC;&#x9A71;&#x52A8;" class="headerlink" title="&#x7F51;&#x7EDC;&#x9A71;&#x52A8;"></a>&#x7F51;&#x7EDC;&#x9A71;&#x52A8; <a href="#wang-luo-qu-dong" class="header-anchor">#</a></h1><h2 id="case-1-mo-ren-qiao-jie-wang-luo-bridge0"><a href="#Case-1-&#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC;-bridge0" class="headerlink" title="Case 1: &#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC; (bridge0)"></a>Case 1: &#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC; (<code>bridge0</code>) <a href="#case-1-mo-ren-qiao-jie-wang-luo-bridge0" class="header-anchor">#</a></h2><p>&#x5BB9;&#x5668;&#x5185;&#x7684; <code>eth0</code> &#x8FDE;&#x63A5;&#x5230;&#x6865;&#x63A5;&#x63A5;&#x53E3; <code>docker0</code>&#xFF0C;&#x7136;&#x540E;&#x5BBF;&#x4E3B;&#x7684; <code>iptables</code> &#x6765;&#x8D1F;&#x8D23; <code>NAT/port-mapping</code> &#x8FDB;&#x884C;&#x5BB9;&#x5668;&#x5185;&#x548C;&#x5BB9;&#x5668;&#x5916;&#x7684;&#x8F6C;&#x6362;&#x4E92;&#x8054;&#xFF0C;&#x6700;&#x540E;&#x6570;&#x636E;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B;&#x7684; <code>eth0</code> &#x8FDE;&#x63A5;&#x5230;&#x4EA4;&#x6362;&#x673A;&#x4E0A;&#x3002;&#x4EA4;&#x6362;&#x673A;&#x53EF;&#x4EE5;&#x662F;&#x666E;&#x901A;&#x7684; <code>ToR(Top-of-Rack) &#x4EA4;&#x6362;</code>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x865A;&#x62DF;&#x6846;&#x67B6;&#x7684; <code>Hypervisor &#x4EA4;&#x6362;</code>&#x3002;</p><h2 id="case-2-yong-hu-zi-ding-yi-qiao-jie-wang-luo"><a href="#Case-2-&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC;" class="headerlink" title="Case 2: &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC;"></a>Case 2: &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6865;&#x63A5;&#x7F51;&#x7EDC; <a href="#case-2-yong-hu-zi-ding-yi-qiao-jie-wang-luo" class="header-anchor">#</a></h2><p>&#x5728;&#x6BCF;&#x4E2A;&#x5BBF;&#x4E3B;&#x4E0A;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">-d bridge \</span><br><span class="line">-o com.docker.network.bridge.name=brnet \</span><br><span class="line">brnet</span><br><span class="line">$ docker run --net=brnet -it busybox ifconfig</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x79CD;&#x62D3;&#x6251;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x662F;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x63A5;&#x53E3;&#x8BBF;&#x95EE; <code>brnet</code> &#x63A5;&#x53E3;&#xFF0C;&#x800C; <code>brnet</code> &#x901A;&#x8FC7;&#x5BBF;&#x4E3B; <code>iptables</code> &#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x6620;&#x5C04;&#xFF0C;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B;&#x7684; <code>eth0</code> &#x8BBF;&#x95EE;&#x4EA4;&#x6362;&#x3002;</p><h2 id="case-3-qiao-jie-wang-luo-lian-ru-xia-ceng-wang-luo-bing-shi-yong-ipam-mei-you-nat-duan-kou-ying-she"><a href="#Case-3-&#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;IPAM-&#x6CA1;&#x6709;NAT-&#x7AEF;&#x53E3;&#x6620;&#x5C04;" class="headerlink" title="Case 3: &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;IPAM (&#x6CA1;&#x6709;NAT/&#x7AEF;&#x53E3;&#x6620;&#x5C04;)"></a>Case 3: &#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x8FDE;&#x5165;&#x4E0B;&#x5C42;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;<code>IPAM</code> (&#x6CA1;&#x6709;NAT/&#x7AEF;&#x53E3;&#x6620;&#x5C04;) <a href="#case-3-qiao-jie-wang-luo-lian-ru-xia-ceng-wang-luo-bing-shi-yong-ipam-mei-you-nat-duan-kou-ying-she" class="header-anchor">#</a></h2><p>&#x5728;&#x6BCF;&#x4E2A;&#x5BBF;&#x4E3B;&#x6267;&#x884C;&#x4E0B;&#x5217;&#x6307;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">-d bridge \</span><br><span class="line">--subnet=192.168.57.0/24 \</span><br><span class="line">--ip-range=192.168.57.32/28 \</span><br><span class="line">--gateway=192.168.57.11 \</span><br><span class="line">--aux-address DefaultGatewayIPv4=192.168.57.1 \</span><br><span class="line">-o com.docker.network.bridge.name=brnet \</span><br><span class="line">brnet</span><br><span class="line">$ brctl addif brnet eth2</span><br><span class="line">$ docker run --net=brnet -it busybox ifconfig</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x5176;&#x5B83;&#x4E3B;&#x673A;&#x7684; <code>--ip-range</code> &#x548C; <code>--gateway</code> &#x9700;&#x8981;&#x505A;&#x5BF9;&#x5E94;&#x8C03;&#x6574;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x62D3;&#x6251;&#x662F;&#xFF0C;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x8FDE;&#x63A5; <code>brnet</code> &#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x76F4;&#x63A5;&#x901A;&#x8FC7; <code>eth2</code> &#x8BBF;&#x95EE;&#x4EA4;&#x6362;&#x3002;</p><h2 id="case-4-overlay-networking"><a href="#Case-4-Overlay-Networking" class="headerlink" title="Case 4: Overlay Networking"></a>Case 4: Overlay Networking <a href="#case-4-overlay-networking" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x8FDE;&#x63A5; <code>ov-net1</code> &#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x901A;&#x8FC7;<code>VXVLAN-VNI 100</code> &#x8FDB;&#x884C;&#x5BBF;&#x4E3B;&#x95F4;&#x4E92;&#x8FDE;&#xFF0C;&#x5BBF;&#x4E3B;&#x95F4;&#x901A;&#x8FC7; <code>Gossip</code> &#x534F;&#x8BAE;&#x5F97;&#x77E5;&#x5404;&#x81EA;&#x7F51;&#x7EDC;&#x4FE1;&#x606F;&#x3002;</p><p>&#x540C;&#x65F6;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x8FD8;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5185; <code>eth1</code> &#x8FDE;&#x63A5; <code>docker_gwbridge</code> &#xFF0C;&#x518D;&#x901A;&#x8FC7; <code>iptables</code> &#x8FDB;&#x884C;NAT&#x4EE5;&#x53CA;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B; <code>eth0</code> &#x8FDE;&#x63A5;&#x4EA4;&#x6362;&#x3002;</p><h2 id="case-5-macvlan-1-12-xin-zeng"><a href="#Case-5-Macvlan-1-12&#x65B0;&#x589E;" class="headerlink" title="Case 5: Macvlan (1.12&#x65B0;&#x589E;)"></a>Case 5: Macvlan (1.12&#x65B0;&#x589E;) <a href="#case-5-macvlan-1-12-xin-zeng" class="header-anchor">#</a></h2><p>&#x5728; <code>VLAN 10</code> &#x4E0A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">-d macvlan \</span><br><span class="line">--subnet=10.1.10.0/24 \</span><br><span class="line">--gateway=10.1.10.1 \</span><br><span class="line">-o parent=eth0.10 \</span><br><span class="line">mcvlan10</span><br><span class="line">$ docker run --net=mcvlan10 -it --rm alpine /bin/sh</span><br></pre></td></tr></table></figure><p>&#x5728; <code>VLAN 20</code> &#x4E0A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">-d macvlan \</span><br><span class="line">--subnet=10.1.20.0/24 \</span><br><span class="line">--gateway=10.1.20.1 \</span><br><span class="line">-o parent=eth0.20 \</span><br><span class="line">mcvlan20</span><br><span class="line">$ docker run --net=mcvlan20 -it --rm alpine /bin/sh</span><br></pre></td></tr></table></figure><p>&#x5BB9;&#x5668;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5185; <code>eth0</code> &#x8BBF;&#x95EE;&#x5BBF;&#x4E3B; <code>eth0.10</code> &#x63A5;&#x53E3;&#x5E76;&#x9644;&#x4E0A; <code>VLAN 10</code> &#x6807;&#x7B7E;&#xFF0C;&#x901A;&#x8FC7;&#x5BBF;&#x4E3B; <code>eth0</code> &#x8D70; <code>802.1Q Trunk</code> &#x51FA;&#x5BBF;&#x4E3B;&#x63A5;&#x5230;&#x4EA4;&#x6362;&#x673A;&#x4E0A;&#x53BB;&#x3002;</p><h1 id="1-12-xin-gong-neng"><a href="#1-12-&#x65B0;&#x529F;&#x80FD;" class="headerlink" title="1.12 &#x65B0;&#x529F;&#x80FD;"></a>1.12 &#x65B0;&#x529F;&#x80FD; <a href="#1-12-xin-gong-neng" class="header-anchor">#</a></h1><h2 id="swarm-mode-zhong-de-xin-gong-neng"><a href="#Swarm-Mode-&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;" class="headerlink" title="Swarm Mode &#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;"></a>Swarm Mode &#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD; <a href="#swarm-mode-zhong-de-xin-gong-neng" class="header-anchor">#</a></h2><ul><li>cluster aware</li><li>&#x5206;&#x5E03;&#x5F0F;&#x63A7;&#x5236;&#x5C42;</li><li>&#x9AD8;&#x6269;&#x5C55;&#x6027;</li></ul><h3 id="swarm-mode-zhong-de-duo-su-zhu-hu-lian"><a href="#Swarm-mode-&#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;" class="headerlink" title="Swarm mode &#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;"></a>Swarm mode &#x4E2D;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE; <a href="#swarm-mode-zhong-de-duo-su-zhu-hu-lian" class="header-anchor">#</a></h3><ul><li>&#x57FA;&#x4E8E; <code>VxLAN</code> &#x8FDB;&#x884C;&#x6570;&#x636E;&#x4E92;&#x8FDE;</li><li>&#x65E0;&#x9700;&#x5916;&#x7F6E;&#x952E;&#x503C;&#x5E93;</li><li>&#x96C6;&#x4E2D;&#x8D44;&#x6E90;&#x5206;&#x914D;</li><li>&#x6539;&#x8FDB;&#x6027;&#x80FD;</li><li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;</li></ul><h3 id="an-quan-de-kong-zhi-ceng"><a href="#&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42;" class="headerlink" title="&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42;"></a>&#x5B89;&#x5168;&#x7684;&#x63A7;&#x5236;&#x5C42; <a href="#an-quan-de-kong-zhi-ceng" class="header-anchor">#</a></h3><ul><li>&#x57FA;&#x4E8E; <code>Gossip</code> &#x534F;&#x8BAE;&#xFF08;<em>&#x770B;&#x6765;&#x516B;&#x5366;&#x8FD8;&#x662F;&#x5F88;&#x5F3A;&#x5927;&#x7684;</em>&#xFF09;</li><li>&#x7F51;&#x7EDC;&#x8303;&#x7574;&#x7684; <code>Gossip</code></li><li>&#x5FEB;&#x901F;&#x6536;&#x655B;</li><li>&#x9ED8;&#x8BA4;&#x5B89;&#x5168;<ul><li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li><li>Swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li></ul></li><li><code>Gossip</code> &#x63A7;&#x5236;&#x6D88;&#x606F;<ul><li>&#x8DEF;&#x7531;&#x72B6;&#x6001;</li><li>&#x670D;&#x52A1;&#x53D1;&#x73B0;</li><li>&#x63D2;&#x4EF6;&#x6570;&#x636E;</li></ul></li><li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;&#x6027;</li></ul><h3 id="an-quan-de-shu-ju-ceng"><a href="#&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42;" class="headerlink" title="&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42;"></a>&#x5B89;&#x5168;&#x7684;&#x6570;&#x636E;&#x5C42; <a href="#an-quan-de-shu-ju-ceng" class="header-anchor">#</a></h3><ul><li>&#x5728; <code>overlay network</code> &#x521B;&#x5EFA;&#x65F6;&#x4F5C;&#x4E3A;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</li><li>&#x4F7F;&#x7528;&#x5185;&#x6838; <code>IPSec</code> &#x6A21;&#x5757;</li><li>&#x6309;&#x9700; Tunnel &#x8BBE;&#x7F6E;</li><li>Swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li><li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li></ul><h3 id="fu-wu-fa-xian"><a href="#&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#fu-wu-fa-xian" class="header-anchor">#</a></h3><ul><li>&#x7531;&#x5185;&#x7F6E; DNS &#x63D0;&#x4F9B;&#x652F;&#x6301;</li><li>&#x9AD8;&#x53EF;&#x7528;(HA)</li><li>&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x53D6;&#x5F97;&#x72B6;&#x6001;&#x4FE1;&#x606F;</li><li>&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x548C;Task</li></ul><h3 id="fu-zai-jun-heng"><a href="#&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#fu-zai-jun-heng" class="header-anchor">#</a></h3><ul><li>&#x5305;&#x62EC;&#x5185;&#x90E8;<code>internal</code>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x548C;&#x8FB9;&#x754C;<code>ingress</code>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li><li>&#x652F;&#x6301; <code>VIP</code> &#x548C; <code>DNS-RR</code></li><li>&#x9AD8;&#x53EF;&#x7528;</li><li>&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x83B7;&#x53D6;&#x72B6;&#x6001;&#x4FE1;&#x606F;</li><li>&#x6700;&#x5C0F;&#x6027;&#x80FD;&#x635F;&#x8017;</li></ul><h3 id="mesh-lu-you"><a href="#Mesh-&#x8DEF;&#x7531;" class="headerlink" title="Mesh &#x8DEF;&#x7531;"></a>Mesh &#x8DEF;&#x7531; <a href="#mesh-lu-you" class="header-anchor">#</a></h3><ul><li>&#x5728;&#x8FB9;&#x754C;&#x8DEF;&#x7531;&#x5185;&#x7F6E; routing mesh</li><li>&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E5F;&#x53C2;&#x52A0;&#x8FB9;&#x754C; routing mesh</li><li>&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x63A5;&#x53D7;&#x53D1;&#x9001;&#x7ED9; <code>PublishedPort</code> &#x7684;&#x8BF7;&#x6C42;</li><li>&#x7AEF;&#x53E3;&#x8F6C;&#x6362;&#x53D1;&#x751F;&#x5728;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x3002;</li><li>&#x5185;&#x90E8;&#x548C;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x673A;&#x5236;</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="https://1x481n.github.io/blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：为容器定制的持久化存储方案 - Infinit - Quentin Hocquet</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html</id>
    <published>2016-12-06T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.622Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#rong-qi-he-cun-chu">&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8;</a></li><li><a href="#infinit-cun-chu-ping-tai">Infinit &#x5B58;&#x50A8;&#x5E73;&#x53F0;</a></li><li><a href="#infinit-shi-wan-quan-fen-bu-shi-de">Infinit &#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684;</a></li><li><a href="#ru-he-zuo-dao-de">&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;</a></li><li><a href="#shen-ru-dht-blocks">&#x6DF1;&#x5165;&#xFF1A;DHT Blocks</a></li><li><a href="#shen-ru-wen-jian-xi-tong-ceng">&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;</a></li><li><a href="#shen-ru-consensus">&#x6DF1;&#x5165;&#xFF1A;Consensus</a></li><li><a href="#shen-ru-overlay">&#x6DF1;&#x5165;&#xFF1A;Overlay</a></li></ul><!-- tocstop --><p>&#x89C6;&#x9891;&#x7B14;&#x8BB0;&#xFF1A;&#x4E3A;&#x5BB9;&#x5668;&#x5B9A;&#x5236;&#x7684;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x65B9;&#x6848; - Infinit - Quentin Hocquet</p><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Persistent storage tailored for containers<br>by Quentin Hocquet<br>@ mefyl<br>CTO @ Infinit<br>&#x5728; Docker Distributed System Summit 2016 &#x4E0A;&#x7684;&#x8BB2;&#x5EA7;<br>2016-10-10</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/k0m-XwCoxo0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=k0m-XwCoxo0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=k0m-XwCoxo0</a></p><p>&#x89C6;&#x9891;&#x94FE;&#x63A5;&#xFF1A;<a href="https://www.youtube.com/watch?v=k0m-XwCoxo0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=k0m-XwCoxo0</a></p><p>&#x5E7B;&#x706F;&#x94FE;&#x63A5;&#xFF1A;<a href="http://www.slideshare.net/Docker/persistent-storage-tailored-for-containers" target="_blank" rel="noopener">http://www.slideshare.net/Docker/persistent-storage-tailored-for-containers</a></p><h1 id="rong-qi-he-cun-chu"><a href="#&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8;" class="headerlink" title="&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8;"></a>&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8; <a href="#rong-qi-he-cun-chu" class="header-anchor">#</a></h1><p>&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x5FEB;&#x6377;&#x3001;&#x53EF;&#x6269;&#x5C55;&#x3001;&#x5F88;&#x7075;&#x6D3B;</p><ul><li>&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x7684;&#x542F;&#x52A8;&#x3001;&#x505C;&#x6B62;</li><li>&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x548C;&#x5BB9;&#x6613;&#x7684;&#x6A2A;&#x5411;&#x6269;&#x5C55;</li><li>&#x7EDF;&#x4E00;&#x7684;&#x5F00;&#x53D1;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;</li><li>&#x800C;&#x4E14;&#x8FD8;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#x7684;&#x5B9A;&#x5236;&#x5404;&#x79CD;&#x9700;&#x6C42;</li></ul><p>&#x4F46;&#x662F;&#x5BB9;&#x5668;&#x66F4;&#x503E;&#x5411;&#x4E8E;<strong>&#x65E0;&#x72B6;&#x6001;&#x5316;</strong>&#xFF0C;&#x5BF9;&#x4E8E;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E16;&#x754C;&#x91CC;&#x66F4;&#x5BB9;&#x6613;&#x4F7F;&#x7528;&#x3002;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x670D;&#x52A1;&#x6709;&#x72B6;&#x6001;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;<strong>&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;</strong>&#x3002;</p><p>&#x7406;&#x60F3;&#x5316;&#x7684;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#xFF1A;</p><ul><li>&#x53EF;&#x4EE5;&#x50CF;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x5BB9;&#x6613;&#x7684;&#x521B;&#x5EFA;&#x3001;&#x542F;&#x52A8;</li><li>&#x53EF;&#x4EE5;&#x8DDF;&#x5BB9;&#x5668;&#x7684;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x6269;&#x5C55;</li><li>&#x5E94;&#x8BE5;&#x548C;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4EE5;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x5DE5;&#x4F5C;</li><li>&#x800C;&#x4E14;&#x5E94;&#x8BE5;&#x548C;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x9700;&#x6C42;</li></ul><h1 id="infinit-cun-chu-ping-tai"><a href="#Infinit-&#x5B58;&#x50A8;&#x5E73;&#x53F0;" class="headerlink" title="Infinit &#x5B58;&#x50A8;&#x5E73;&#x53F0;"></a>Infinit &#x5B58;&#x50A8;&#x5E73;&#x53F0; <a href="#infinit-cun-chu-ping-tai" class="header-anchor">#</a></h1><p>Infinit &#x5B58;&#x50A8;&#x5728;&#x8BBE;&#x8BA1;&#x521D;&#x671F;&#x5C31;&#x8003;&#x8651;&#x4E86;&#x5BB9;&#x5668;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#x3002;&#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x79CD; API&#xFF0C;&#x4ECE; POSIX &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;Object &#xFF08;&#x5982;AWS S3&#xFF0C;OpenStack Swift&#xFF09;&#x5230; Block &#xFF08;iSCSI&#xFF09;&#x3002;&#x5B83;&#x5C06;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x672C;&#x5730;&#x5B58;&#x50A8;&#x805A;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x6210;&#x4E3A;&#x7EDF;&#x4E00;&#x7684;&#x5B58;&#x50A8;&#x6C60;&#x3002;</p><h1 id="infinit-shi-wan-quan-fen-bu-shi-de"><a href="#Infinit-&#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684;" class="headerlink" title="Infinit &#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684;"></a>Infinit &#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684; <a href="#infinit-shi-wan-quan-fen-bu-shi-de" class="header-anchor">#</a></h1><p>&#x6CA1;&#x6709; Leader&#xFF0C;&#x6CA1;&#x6709; follower&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x5E73;&#x7B49;&#x7684;&#x3002;</p><ul><li>&#x5728;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x548C;&#x4E00;&#x4E07;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E00;&#x6837;</li><li>&#x6CA1;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF0C;&#x6CA1;&#x6709;&#x74F6;&#x9888;</li><li>&#x8282;&#x70B9;&#x5F88;&#x5BB9;&#x6613;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5BB9;&#x91CF;&#x8FD8;&#x662F;&#x901F;&#x5EA6;</li><li>&#x62E5;&#x6709;&#x9762;&#x5411;&#x5F00;&#x53D1;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7EDF;&#x4E00;&#x7684; API</li><li>&#x6BCF;&#x4E2A;&#x8BBE;&#x7F6E;&#x90FD;&#x53EF;&#x4EE5;&#x5B9A;&#x5236;</li></ul><p>&#x56E0;&#x6B64; Infinit &#x53EF;&#x4EE5;&#xFF1A;</p><ul><li>&#x548C;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x8F7B;&#x677E;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x8FD0;&#x884C;&#x3002;</li><li>&#x53EF;&#x4EE5;&#x4F34;&#x968F;&#x5BB9;&#x5668;&#x6C60;&#x7684;&#x6269;&#x5BB9;&#x800C;&#x6269;&#x5BB9;</li><li>&#x786E;&#x4FDD;&#x5F00;&#x53D1;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E00;&#x81F4;</li><li>&#x5BF9;&#x4E8E;&#x5404;&#x79CD;&#x9700;&#x6C42;&#x90FD;&#x53EF;&#x914D;&#x7F6E;&#xFF1A;&#x52A0;&#x5BC6;&#x3001;&#x5197;&#x4F59;&#x3001;&#x538B;&#x7F29;&#x7B49;</li></ul><h1 id="ru-he-zuo-dao-de"><a href="#&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;"></a>&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F; <a href="#ru-he-zuo-dao-de" class="header-anchor">#</a></h1><p>Infinit &#x7684;&#x57FA;&#x672C;&#x539F;&#x5219;&#xFF1A;</p><ul><li>&#x5C06;&#x6240;&#x6709;&#x8282;&#x70B9;&#x81F3;&#x4E8E;<strong>&#x4E00;&#x4E2A; overlay network</strong> &#x4E0B;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x548C;&#x8DEF;&#x7531;</li><li>&#x5C06;&#x6570;&#x636E;&#x4EE5;&#x5757;(block)&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x4E8E;<strong>Distribute Hashtable (DHT)</strong> &#xFF08;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5206;&#x5E03;&#x5F0F;&#x952E;&#x503C;&#x5E93;&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x5757;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;</li><li>&#x4F7F;&#x7528;<strong>&#x5BC6;&#x7801;&#x5B66;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</strong>&#x6765;&#x6267;&#x884C;&#x4EFB;&#x4F55; Leader &#x7684;&#x547D;&#x4EE4;</li><li>&#x4F7F;&#x7528;<strong><a href="https://zh.wikipedia.org/wiki/%E5%B0%8D%E7%A8%B1#.E9.82.8F.E8.BC.AF.E4.B8.AD.E7.9A.84.E5.B0.8D.E7.A8.B1" target="_blank" rel="noopener">symmetrical operations</a></strong>&#x6765;&#x786E;&#x4FDD;&#x7A33;&#x5B9A;&#x6027;&#x548C;&#x7075;&#x6D3B;&#x6027;</li></ul><p>&#x8FD9;&#x91CC;&#x7684; overlay network &#x5E76;&#x975E; docker overlay network&#xFF0C;&#x800C;&#x662F;&#x6307;&#x5C06;&#x4E0A;&#x5343;&#x8282;&#x70B9;&#x8054;&#x7CFB;&#x8D77;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x67E5;&#x8BE2;&#x3001;&#x53D1;&#x73B0;&#x3001;&#x8DEF;&#x7531;&#x7684;&#x4E00;&#x7EC4;&#x7B97;&#x6CD5;&#x548C;&#x5B9E;&#x73B0;&#x3002;</p><p><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.58.889&amp;rep=rep1&amp;type=pdf" target="_blank" rel="noopener">&#x5BC6;&#x7801;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</a>&#x975E;&#x5E38;&#x5F3A;&#x5927;&#xFF0C;&#x5229;&#x7528;&#x5BC6;&#x94A5;&#x673A;&#x5236;&#xFF0C;&#x786E;&#x4FDD;&#x80FD;&#x8BBF;&#x95EE;&#x8BE5; Block &#x7684;&#x8282;&#x70B9;&#xFF0C;&#x5FC5;&#x7136;&#x62E5;&#x6709;&#x5BC6;&#x94A5;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x7136;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x53CA;&#x89E3;&#x5BC6;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x53BB;&#x8BE2;&#x95EE;&#x7B2C;&#x4E09;&#x65B9;&#x673A;&#x6784;&#x83B7;&#x5F97;&#x6743;&#x9650;&#x3002;</p><p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x662F; symmetirc &#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x4E86;&#x5BC6;&#x7801;&#x5B66;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x7684;&#x5757;&#x5FC5;&#x987B;&#x81EA;&#x7B7E;&#x540D;&#x4EE5;&#x53CA;&#x52A0;&#x5BC6;&#x3002;</p><h1 id="shen-ru-dht-blocks"><a href="#&#x6DF1;&#x5165;&#xFF1A;DHT-Blocks" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;DHT Blocks"></a>&#x6DF1;&#x5165;&#xFF1A;DHT Blocks <a href="#shen-ru-dht-blocks" class="header-anchor">#</a></h1><p>DHT Blocks &#x5206;&#x4E3A;&#x4E24;&#x5927;&#x7C7B; <code>Mutable blocks</code> &#x548C; <code>Immutable blocks</code>&#x3002;</p><p>&#x53EF;&#x53D8;&#x66F4;&#x7684;&#x5757;(<code>mutable block</code>)&#xFF1A;</p><ul><li>&#x8FD9;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x51B2;&#x7A81;</li><li>&#x800C;&#x4E14;&#x5F88;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x8FC7;&#x671F;&#x548C;&#x5931;&#x6548;&#xFF0C;&#x9700;&#x8981;&#x7ECF;&#x5E38;&#x68C0;&#x67E5;</li><li>&#x5F88;&#x96BE;&#x53BB;&#x9A8C;&#x8BC1;&#x4EE5;&#x53CA;&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;</li></ul><p>&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x5757;(<code>immutable block</code>)&#xFF1A;</p><ul><li>&#x4E0D;&#x4F1A;&#x6709;&#x51B2;&#x7A81;</li><li>&#x4E0D;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x53EF;&#x4EE5;&#x4E00;&#x76F4;&#x7F13;&#x5B58;</li><li>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x53BB;&#x9A8C;&#x8BC1;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x5757;&#x662F; addressable &#x7684;&#xFF1A;<code>address = hash (content)</code></li></ul><p><strong>&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x5757;</strong> &#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x83B7;&#x53D6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x7528; LRU &#x7F13;&#x5B58;&#x3002;</p><p>&#x7531;&#x4E8E; <code>Immutable Block</code> &#x7684;&#x7279;&#x6027;&#x5F88;&#x8D5E;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8BBE;&#x8BA1; Infinit &#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x4F7F;&#x7528; <code>Immutable Block</code>&#x3002;</p><h1 id="shen-ru-wen-jian-xi-tong-ceng"><a href="#&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;"></a>&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42; <a href="#shen-ru-wen-jian-xi-tong-ceng" class="header-anchor">#</a></h1><p>&#x6587;&#x4EF6;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5E26;&#x5143;&#x6570;&#x636E;&#x7684; <code>Mutable Block</code> &#x548C;&#x4E00;&#x4E2A; <code>Immutable Block</code> &#x7EC4;&#x6210;&#x7684;<code>FAT (File Allocation Table)</code>&#x3002;</p><p>&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x4F7F;&#x7528; <code>Immutable Block</code> &#x8FDB;&#x884C;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x7F13;&#x5B58;&#x3002;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x6587;&#x4EF6;&#x53D8;&#x66F4;&#xFF0C;&#x4F1A;&#x5148;&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;&#x66FF;&#x4EE3;&#x7684; <code>Immutable Block</code>&#xFF0C;&#x7ED3;&#x675F;&#x540E;&#x53EA;&#x9700;&#x8981;&#x5F88;&#x77ED;&#x6682;&#x7684;&#x4FEE;&#x6539; <code>inode</code>&#xFF0C;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x7248;&#x672C;&#x66FF;&#x6362;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x8F7B;&#x6613;&#x7684;&#x786E;&#x4FDD;&#x539F;&#x5B50;&#x8BFB;&#x5199;&#x3002;</p><p>POSIX &#x7684; API &#x662F;&#x987A;&#x5E8F;&#x7684;&#xFF0C;&#x800C; Infinit &#x662F;&#x9AD8;&#x5EA6;&#x5E76;&#x884C;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x63D0;&#x4F9B;&#x4E86;&#x76EE;&#x5F55;&#x9884;&#x8BFB;&#x3001;&#x4EE5;&#x53CA;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#x9884;&#x8BFB;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x540E;&#x53F0;&#x4EE5;&#x9AD8;&#x5EA6;&#x5E76;&#x884C;&#x6279;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x83B7;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x964D;&#x4F4E;&#x524D;&#x53F0;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x3002;</p><h1 id="shen-ru-consensus"><a href="#&#x6DF1;&#x5165;&#xFF1A;Consensus" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;Consensus"></a>&#x6DF1;&#x5165;&#xFF1A;Consensus <a href="#shen-ru-consensus" class="header-anchor">#</a></h1><p>&#x7531;&#x4E8E;&#x662F;&#x57FA;&#x4E8E; Block &#x7684; Consensus&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A; Block &#x90FD;&#x6709;&#x4E00;&#x7EC4; Quorum&#xFF0C;&#x4F7F;&#x7528; Paxos &#x7B97;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x5BFC;&#x81F4;&#x6CA1;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF0C;&#x800C;&#x4E14;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A; Block &#x7684; quorum &#x90FD;&#x4E0D;&#x540C;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5355;&#x4E00;&#x74F6;&#x9888;&#x95EE;&#x9898;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x4F7F;&#x7528; Raft&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x4E86;&#x66F4;&#x590D;&#x6742;&#x7684; Multipaxos &#x7684;&#x7B97;&#x6CD5;&#x3002;</p><h1 id="shen-ru-overlay"><a href="#&#x6DF1;&#x5165;&#xFF1A;Overlay" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;Overlay"></a>&#x6DF1;&#x5165;&#xFF1A;Overlay <a href="#shen-ru-overlay" class="header-anchor">#</a></h1><p>overlay &#x5C42;&#x662F; Infinit &#x5E73;&#x53F0;&#x4E2D;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x5B9A;&#x5236;&#x70B9;&#xFF1A;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x7B97;&#x6CD5;&#x7684;&#x9009;&#x62E9;&#xFF1A;</p><ul><li>&#x51E0;&#x5343;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x8BDD;&#xFF1A;<a href="https://github.com/papers-we-love/papers-we-love/blob/master/distributed_systems/kelips-building-an-efficient-and-stable-p2p-dht-through-increased-memory-and-background-overhead.pdf" target="_blank" rel="noopener"><code>kelips</code></a>, <a href="https://pdos.csail.mit.edu/~petar/papers/maymounkov-kademlia-lncs.pdf" target="_blank" rel="noopener"><code>kademlia</code></a>, <a href="https://pdos.csail.mit.edu/papers/chord:sigcomm01/chord_sigcomm.pdf" target="_blank" rel="noopener"><code>chord</code></a>,</li><li>&#x51E0;&#x767E;&#x4E2A;&#x8282;&#x70B9;&#x51E0;&#x5341;&#x4E2A;TB &#x7684;&#x8BDD;&#xFF1A;<code>global knowledge</code>, <code>Kouncil</code></li></ul><p>&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#xFF1A;<code>rack-aware</code> &#x673A;&#x67B6;&#xFF0C;<code>zone-aware</code> &#x533A;&#x57DF;&#xFF0C;<code>reliability-aware</code> &#x53EF;&#x9760;&#x6027;&#x3001;<code>ensure local</code> &#x672C;&#x5730;&#x5B58;&#x50A8;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="docker summit" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker-summit/"/>
    
  </entry>
  
  <entry>
    <title>Docker 1.13 新增功能</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-11-14-what-is-new-in-docker-1-13.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-11-14-what-is-new-in-docker-1-13.html</id>
    <published>2016-11-13T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.622Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#qian-yan">&#x524D;&#x8A00;</a><ul><li><a href="#top-10-xin-zeng-gong-neng">Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;</a></li></ul></li><li><a href="#docker-jing-xiang-gou-jian">Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;</a><ul><li><a href="#cong-yi-you-jing-xiang-qu-de-huan-cun">&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;</a></li><li><a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan">&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;</a></li><li><a href="#gou-jian-jing-xiang-shi-zhi-chi-yong-network-zhi-ding-wang-luo">&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528; <code>--network</code> &#x6307;&#x5B9A;&#x7F51;&#x7EDC;</a></li><li><a href="#kai-shi-yun-xu-docker-build-zhong-ding-yi-dockerfile-wei-shi-yong-de-can-shu-arg">&#x5F00;&#x59CB;&#x5141;&#x8BB8; <code>docker build</code> &#x4E2D;&#x5B9A;&#x4E49; <code>Dockerfile</code> &#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09;</a></li></ul></li><li><a href="#an-zhuang">&#x5B89;&#x88C5;</a><ul><li><a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti">&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898;</a></li><li><a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi">&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;</a></li></ul></li><li><a href="#wang-luo">&#x7F51;&#x7EDC;</a><ul><li><a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo">&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC;</a></li><li><a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou">&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</a></li><li><a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;</a></li><li><a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-de-jie-dian">&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9;</a></li><li><a href="#yun-xu-service-vip-ke-yi-bei-ping">&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code></a></li></ul></li><li><a href="#cha-jian">&#x63D2;&#x4EF6;</a><ul><li><a href="#cha-jian-gong-neng-zheng-shi-qi-yong">&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;</a></li></ul></li><li><a href="#ming-ling-xing">&#x547D;&#x4EE4;&#x884C;</a><ul><li><a href="#checkpoint-gong-neng-shi-yan-gong-neng"><code>checkpoint</code> &#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;</a><ul><li><a href="#zhun-bei-gong-zuo">&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</a></li><li><a href="#chuang-jian-checkpoint-ji-hui-fu">&#x521B;&#x5EFA; Checkpoint &#x53CA;&#x6062;&#x590D;</a></li></ul></li><li><a href="#docker-stats-zhong-yu-ke-yi-xian-shi-rong-qi-ming-liao"><code>docker stats</code> &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86;</a></li><li><a href="#gei-docker-ps-zeng-jia-is-task-guo-lu-qi">&#x7ED9; <code>docker ps</code> &#x589E;&#x52A0; <code>is-task</code> &#x8FC7;&#x6EE4;&#x5668;</a></li><li><a href="#zai-ye-bu-hui-chu-xian-ke-hu-duan-he-fu-wu-duan-bu-tong-ban-ben-dao-zhi-de-cuo-wu-liao">&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86;</a></li><li><a href="#docker-inspect-jiang-ke-yi-cha-kan-ren-he-docker-dui-xiang"><code>docker inspect</code> &#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; docker &#x5BF9;&#x8C61;</a></li></ul></li><li><a href="#yun-xing-shi">&#x8FD0;&#x884C;&#x65F6;</a><ul><li><a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu">&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570;</a></li><li><a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e">&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;</a></li><li><a href="#zeng-jia-docker-system-ming-ling">&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</a></li><li><a href="#ti-sheng-overlay2-de-you-xian-ji">&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7;</a></li><li><a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li><li><a href="#windows-nei-zhi-de-yun-xing-windows-cheng-xu-de-docker-on-windows-de-gai-jin">Windows &#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x7684; Docker on Windows &#x7684;&#x6539;&#x8FDB;</a></li></ul></li><li><a href="#swarm-mode">Swarm Mode</a><ul><li><a href="#zheng-shi-zhi-chi-docker-stack">&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code></a></li><li><a href="#tian-jia-secret-guan-li">&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406;</a></li><li><a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi">&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;</a></li><li><a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng">&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</a></li><li><a href="#bu-chong-liao-yi-xie-docker-service-create-suo-que-shi-de-can-shu">&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B; <code>docker service create</code> &#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570;</a></li><li><a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi-shi-yan-gong-neng">&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;</a></li><li><a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force">&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></a></li></ul></li><li><a href="#fei-qi">&#x5E9F;&#x5F03;</a></li></ul><!-- tocstop --><h1 id="qian-yan"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00; <a href="#qian-yan" class="header-anchor">#</a></h1><p><em>2017&#x5E74;1&#x6708;19&#x65E5;&#x66F4;&#x65B0;</em></p><p><code>Docker 1.13</code> &#x5728; 2017 &#x5E74; 1 &#x6708; 18 &#x65E5;&#x53D1;&#x5E03;&#x4E86;&#x3002;&#x4ECE; 2016 &#x5E74; 7 &#x6708; 29 &#x65E5;&#x53D1;&#x5E03; <code>1.12</code> &#x53D1;&#x5E03;&#x4EE5;&#x6765;&#xFF0C;&#x5DF2;&#x7ECF;&#x8FC7;&#x53BB; 5 &#x4E2A;&#x591A;&#x6708;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D3B;&#x8DC3;&#x7684; Docker &#x793E;&#x533A;&#x6765;&#x8BF4;&#xFF0C;&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x90FD; <code>1.13</code> &#x90FD;&#x65B0;&#x589E;&#x4E86;&#x4EC0;&#x4E48;&#x5185;&#x5BB9;&#x5427;&#x3002;</p><p><code>1.13</code> &#x6709;<a href="https://github.com/docker/docker/milestone/56" target="_blank" rel="noopener">&#x4E00;&#x5343;&#x56DB;&#x767E;&#x591A;&#x4E2A; issue/pull request</a>&#xFF0C;&#x4E94;&#x5343;&#x591A;&#x4E2A; commits&#xFF0C;&#x662F; Docker &#x5386;&#x53F2;&#x4E0A;&#x6700;&#x9AD8;&#x7684;&#x53D1;&#x5E03;&#x7248;&#x672C;&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5C0F;&#x7248;&#x672C;&#x53D8;&#x5316;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x5927;&#x91CF;&#x7684;&#x66F4;&#x65B0;&#x3002;</p><p>&#x5728;&#x53D1;&#x5E03;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7248;&#x672C;&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Ubuntu / CentOS &#x7CFB;&#x7EDF;&#x4E2D;&#x76F4;&#x63A5;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com/ | sh -s -- --mirror AzureChinaCloud</span><br></pre></td></tr></table></figure><h2 id="top-10-xin-zeng-gong-neng"><a href="#Top-10-&#x65B0;&#x589E;&#x529F;&#x80FD;" class="headerlink" title="Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;"></a>Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD; <a href="#top-10-xin-zeng-gong-neng" class="header-anchor">#</a></h2><ul><li>1&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x670D;&#x52A1;&#x6808; <code>docker stack</code></li><li>2&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x63D2;&#x4EF6;&#xFF1A;<code>docker plugin</code></li><li>3&#x3001;&#x6DFB;&#x52A0;&#x5728; Swarm &#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7BA1;&#x7406;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF1A;<code>docker secret</code></li><li>4&#x3001;&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</li><li>5&#x3001;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x8FDB;&#x884C;&#x670D;&#x52A1;&#x90E8;&#x7F72;</li><li>6&#x3001;&#x6DFB;&#x52A0; <code>docker service</code> &#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</li><li>7&#x3001;&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></li><li>8&#x3001;&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</li><li>9&#x3001;&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;</li><li>10&#x3001;&#x89E3;&#x51B3;&#x4E2D;&#x56FD; <code>GFW</code> &#x5899;&#x6389; <code>docker-engine</code> <code>apt</code>/<code>yum</code> &#x6E90;&#x7684;&#x95EE;&#x9898;</li></ul><p>&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x8BE6;&#x7EC6;&#x89E3;&#x8BFB;&#x4E00;&#x4E0B; <a href="https://github.com/docker/docker/releases/tag/v1.13.0" target="_blank" rel="noopener"><code>1.13.0</code> &#x65B0;&#x589E;&#x529F;&#x80FD;</a> &#x5427;&#x3002;</p><h1 id="docker-jing-xiang-gou-jian"><a href="#Docker-&#x955C;&#x50CF;&#x6784;&#x5EFA;" class="headerlink" title="Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;"></a>Docker &#x955C;&#x50CF;&#x6784;&#x5EFA; <a href="#docker-jing-xiang-gou-jian" class="header-anchor">#</a></h1><h2 id="cong-yi-you-jing-xiang-qu-de-huan-cun"><a href="#&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;" class="headerlink" title="&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;"></a>&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58; <a href="#cong-yi-you-jing-xiang-qu-de-huan-cun" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26839" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26839</a></p><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5145;&#x5206;&#x5229;&#x7528;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#x7279;&#x6027;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x907F;&#x514D;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#x662F;&#x66FE;&#x7ECF;&#x5728;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x8FC7;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x5728; CI &#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x6784;&#x5EFA;&#x65F6;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x800C;&#x8BE5;&#x673A;&#x5668;&#x6CA1;&#x6709;&#x6784;&#x5EFA;&#x8FC7;&#x8BE5;&#x955C;&#x50CF;&#xFF0C;&#x56E0;&#x6B64;&#x7F13;&#x5B58;&#x603B;&#x662F;&#x7528;&#x4E0D;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#x6D6A;&#x8D39;&#x5728;&#x4E86;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#x4E0A;&#x4E86;&#x3002;</p><p>&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x4E3A; <code>docker build</code> &#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x53C2;&#x6570; <code>--cache-from</code>&#xFF0C;&#x5229;&#x7528;&#x955C;&#x50CF;&#x4E2D;&#x7684; History &#x6765;&#x5224;&#x65AD;&#x8BE5;&#x5C42;&#x662F;&#x5426;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#x4E00;&#x81F4;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;</p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x5148;&#x4E0B;&#x8F7D;&#x83B7;&#x53D6;&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x7684;&#x955C;&#x50CF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull mongo:3.2</span><br><span class="line">3.2: Pulling from library/mongo</span><br><span class="line">386a066cd84a: Pull complete</span><br><span class="line">524267bc200a: Pull complete</span><br><span class="line">476d61c7c43a: Pull complete</span><br><span class="line">0750d0e28b90: Pull complete</span><br><span class="line">4bedd83d0855: Pull complete</span><br><span class="line">b3b5d21a0eda: Pull complete</span><br><span class="line">7354b6c26240: Pull complete</span><br><span class="line">db792d386b51: Pull complete</span><br><span class="line">a867bd77950c: Pull complete</span><br><span class="line">Digest: sha256:532a19da83ee0e4e2a2ec6bc4212fc4af26357c040675d5c2629a4e4c4563cef</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mongo:3.2</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x540E;&#x7684; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x4E0A; <code>--cache-from mongo:3.2</code> &#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5982;&#x679C;&#x662F;&#x5DF2;&#x7ECF;&#x5728; <code>mongo:3.2</code> &#x4E2D;&#x5B58;&#x5728;&#x5E76;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x7684;&#x5C42;&#xFF0C;&#x5C31;&#x4F1A;&#x7528; <code>mongo:3.2</code> &#x4E2D;&#x7684;&#x8BE5;&#x5C42;&#x505A;&#x7F13;&#x5B58;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --cache-from mongo:3.2 -t mongo:3.2.1 .</span><br><span class="line">Sending build context to Docker daemon 4.608 kB</span><br><span class="line">Step 1/18 : FROM debian:jessie</span><br><span class="line"> ---&gt; 73e72bf822ca</span><br><span class="line">Step 2/18 : RUN groupadd -r mongodb &amp;&amp; useradd -r -g mongodb mongodb</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 0f6297900a5e</span><br><span class="line">Step 3/18 : RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends numactl &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a465f2e906fc</span><br><span class="line">Step 4/18 : ENV GOSU_VERSION 1.7</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; d448ddca2126</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="ya-bian-squash-jing-xiang-shi-yan-jie-duan"><a href="#&#x538B;&#x6241;-squash-&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;" class="headerlink" title="&#x538B;&#x6241;(squash)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;"></a>&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09; <a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/22641" target="_blank" rel="noopener">https://github.com/docker/docker/pull/22641</a></p><p>&#x5BF9;&#x4E8E;&#x603B;&#x662F;&#x628A; <code>Dockerfile</code> &#x5F53;&#x505A; <code>bash</code> &#x6587;&#x4EF6;&#x6765;&#x7528;&#x7684;&#x4EBA;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5F88;&#x5FEB;&#x7531;&#x4E8E;&#x592A;&#x591A;&#x7684; <code>RUN</code> &#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x6709;&#x7279;&#x522B;&#x591A;&#x7684;&#x5C42;&#xFF0C;&#x955C;&#x50CF;&#x8D85;&#x7EA7;&#x81C3;&#x80BF;&#xFF0C;&#x800C;&#x4E14;&#x751A;&#x81F3;&#x4F1A;&#x78B0;&#x5230;&#x8D85;&#x51FA;&#x6700;&#x5927;&#x5C42;&#x6570;&#x9650;&#x5236;&#x7684;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E9B;&#x4EBA;&#x5F80;&#x5F80;&#x4E0D;&#x4ECE;&#x81EA;&#x8EAB;&#x627E;&#x95EE;&#x9898;&#xFF0C;&#x53CD;&#x800C;&#x53BB;&#x5BFB;&#x627E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#xFF0C;&#x6BD4;&#x5982;&#x5BFC;&#x51FA;&#x955C;&#x50CF;&#x505A;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5BFC;&#x5165;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x5F88;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x5BFC;&#x81F4;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x5931;&#x8D25;&#x5916;&#xFF0C;&#x8FD8;&#x5BFC;&#x81F4; <code>docker history</code> &#x4E22;&#x5931;&#xFF0C;&#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x53D8;&#x4E3A;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x3002;&#x5176;&#x5B9E;&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x9075;&#x5FAA; <code>Dockerfile</code> &#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x591A;&#x4E2A;&#x547D;&#x4EE4;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A; <code>RUN</code>&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A; <code>RUN</code> &#x8981;&#x7CBE;&#x5FC3;&#x8BBE;&#x8BA1;&#xFF0C;&#x786E;&#x4FDD;&#x5B89;&#x88C5;&#x6784;&#x5EFA;&#x6700;&#x540E;&#x8FDB;&#x884C;&#x6E05;&#x7406;&#x3002;&#x8FD9;&#x6837;&#x624D;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x955C;&#x50CF;&#x4F53;&#x79EF;&#xFF0C;&#x4EE5;&#x53CA;&#x6700;&#x5927;&#x5316;&#x7684;&#x5229;&#x7528;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x3002;</p><p>&#x5728; Docker 1.13 &#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x8FD9;&#x7FA4;&#x7528;&#x6237;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; <code>--squash</code> &#x53C2;&#x6570;&#x7ED9; <code>docker build</code>&#xFF0C;&#x5176;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;&#x5C06; <code>Dockerfile</code> &#x4E2D;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x538B;&#x7F29;&#x4E3A;&#x4E00;&#x5C42;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x4E0E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x4FDD;&#x7559;&#x4E86; <code>docker history</code>&#x3002;</p><p>&#x6BD4;&#x5982;&#x5982;&#x4E0B;&#x7684; <code>Dockerfile</code>&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> hello &gt; /hello</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> world &gt;&gt; /hello</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> touch remove_me /remove_me</span></span><br><span class="line"><span class="keyword">ENV</span> HELLO world</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> rm /remove_me</span></span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6B63;&#x5E38;&#x7684;&#x6784;&#x5EFA;&#x7684;&#x8BDD;&#xFF0C;&#x6BD4;&#x5982; <code>docker build -t my-not-squash .</code>&#xFF0C;&#x5176; <code>history</code> &#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">history</span> my-not-squash</span><br><span class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</span><br><span class="line">305297a526e2        About a minute ago   /bin/sh -c rm /remove_me                        0 B</span><br><span class="line">60b8e896d443        About a minute ago   /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></span><br><span class="line">a21f3c75b6b0        About a minute ago   /bin/sh -c touch remove_me /remove_me           0 B</span><br><span class="line">038bca5b58cb        About a minute ago   /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 12 B</span><br><span class="line">f81b1006f556        About a minute ago   /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  6 B</span><br><span class="line">e02e811dd08f        5 weeks ago          /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></span><br><span class="line">&lt;missing&gt;           5 weeks ago          /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></span><br></pre></td></tr></table></figure><p>&#x800C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7528; <code>--squash</code> &#x6784;&#x5EFA;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mysquash --squash .</span><br></pre></td></tr></table></figure><p>&#x5176; <code>history</code> &#x5219;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">history</span> mysquash</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">a557e397ff56        15 seconds ago                                                      12 B                merge sha256:305297a526e218e77f1b4b273442f8ac6283e2907e6513ff36e9048aa130dea6 to sha256:e02e811dd08fd49e7f6032625495118e63f597eb150403d02e3238af1df240ba</span><br><span class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c rm /remove_me                        0 B</span><br><span class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></span><br><span class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c touch remove_me /remove_me           0 B</span><br><span class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 0 B</span><br><span class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  0 B</span><br><span class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></span><br><span class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x5C42;&#x7684;&#x5C42;ID&#x90FD; <code>&lt;missing&gt;</code> &#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x591A;&#x4E86;&#x4E00;&#x5C42; <code>merge</code>&#x3002;</p><p><strong>&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x89E3;&#x51B3;&#x61D2;&#x60F0;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x64B0;&#x5199; Dockerfile &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F9D;&#x65E7;&#x9700;&#x8981;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4E0D;&#x8981;&#x8BD5;&#x56FE;&#x7528;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x53BB;&#x538B;&#x7F29;&#x955C;&#x50CF;&#x3002;</strong></p><h2 id="gou-jian-jing-xiang-shi-zhi-chi-yong-network-zhi-ding-wang-luo"><a href="#&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528;-network-&#x6307;&#x5B9A;&#x7F51;&#x7EDC;" class="headerlink" title="&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528; --network &#x6307;&#x5B9A;&#x7F51;&#x7EDC;"></a>&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x652F;&#x6301;&#x7528; <code>--network</code> &#x6307;&#x5B9A;&#x7F51;&#x7EDC; <a href="#gou-jian-jing-xiang-shi-zhi-chi-yong-network-zhi-ding-wang-luo" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27702" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27702</a><br><a href="https://github.com/docker/docker/issues/10324" target="_blank" rel="noopener">https://github.com/docker/docker/issues/10324</a></p><p>&#x5728;&#x4E00;&#x4E9B;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5B9A;&#x5236; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x6765;&#x63D0;&#x4F9B;&#x7279;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x548C; IP &#x5730;&#x5740;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5E94;&#x5BF9; GFW&#xFF0C;&#x8FD8;&#x662F;&#x516C;&#x53F8;&#x5185;&#x90E8; Git &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x6709;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6784;&#x5EFA;&#x65F6;&#x4FEE;&#x6539; <code>/etc/hosts</code> &#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x4F7F;&#x7528;&#x5185;&#x90E8; DNS &#x867D;&#x7136;&#x662F;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x5C06;&#x662F;&#x5168;&#x5F15;&#x64CE;&#x8303;&#x56F4;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x975E;&#x6240;&#x6709;&#x73AF;&#x5883;&#x90FD;&#x4F1A;&#x6709;&#x5185;&#x90E8; DNS&#x3002;&#x66F4;&#x597D;&#x5730;&#x505A;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6216;&#x8BB8;&#x8FD9;&#x4E2A;&#x6784;&#x5EFA;&#x6240;&#x9700; Git &#x670D;&#x52A1;&#x5668;&#x4F4D;&#x4E8E;&#x5BB9;&#x5668;&#x5185;&#x7F51;&#x7EDC;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x67D0;&#x4E2A; <code>overlay</code> &#x7F51;&#x7EDC;&#x6765;&#x7ED9;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x6240;&#x9700;&#x3002;</p><p>&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x4E3A; <code>docker build</code> &#x63D0;&#x4F9B;&#x4E86; <code>--network</code> &#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6784;&#x5EFA;&#x65F6;&#x7684;&#x7F51;&#x7EDC;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A; <code>Dockerfile</code> &#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> cat /etc/hosts</span></span><br></pre></td></tr></table></figure><p>&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x770B;&#x770B;&#x6784;&#x5EFA;&#x65F6;&#x7684; <code>/etc/hosts</code> &#x7684;&#x5185;&#x5BB9;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5BBF;&#x4E3B;&#x7684; <code>/etc/hosts</code> &#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x6761; <code>1.2.3.4</code> &#x5230; <code>example.com</code> &#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.2.3.4  example.com</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5982;&#x540C;&#x4EE5;&#x5F80;&#xFF0C;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7F51;&#x7EDC;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x90A3;&#x4E48;&#x7ED3;&#x679C;&#x4F1A;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --no-cache -t build-network .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1/2 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2/2 : RUN cat /etc/hosts</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 42f0c014500f</span><br><span class="line">127.0.0.1localhost</span><br><span class="line">::1localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0ip6-localnet</span><br><span class="line">ff00::0ip6-mcastprefix</span><br><span class="line">ff02::1ip6-allnodes</span><br><span class="line">ff02::2ip6-allrouters</span><br><span class="line">172.17.0.22866979c4d77</span><br><span class="line"> ---&gt; 5f0b3dd56a32</span><br><span class="line">Removing intermediate container 42f0c014500f</span><br><span class="line">Successfully built 5f0b3dd56a32</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x8FD9;&#x6B21;&#x6784;&#x5EFA;&#x6240;&#x770B;&#x5230;&#x7684;&#x662F;&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x7F51;&#x7EDC;&#x7684; <code>/etc/hosts</code>&#xFF0C;&#x5176;&#x5185;&#x6CA1;&#x6709;&#x5BBF;&#x4E3B;&#x4E0A;&#x6DFB;&#x52A0;&#x7684;&#x6761;&#x76EE; <code>1.2.3.4  example.com</code>&#x3002;</p><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528; <code>docker build --network=host</code> &#x6765;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x6784;&#x5EFA;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --no-cache -t build-network --network=host .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1/2 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2/2 : RUN cat /etc/hosts</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> b990c4e55424</span><br><span class="line"><span class="comment"># Your system has configured &apos;manage_etc_hosts&apos; as True.</span></span><br><span class="line"><span class="comment"># As a result, if you wish for changes to this file to persist</span></span><br><span class="line"><span class="comment"># then you will need to either</span></span><br><span class="line"><span class="comment"># a.) make changes to the master file in /etc/cloud/templates/hosts.tmpl</span></span><br><span class="line"><span class="comment"># b.) change or remove the value of &apos;manage_etc_hosts&apos; in</span></span><br><span class="line"><span class="comment">#     /etc/cloud/cloud.cfg or cloud-config from user-data</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">127.0.1.1 d1.localdomain d1</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># The following lines are desirable for IPv6 capable hosts</span></span><br><span class="line">::1 ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">ff02::3 ip6-allhosts</span><br><span class="line"></span><br><span class="line">1.2.3.4  example.com</span><br><span class="line"></span><br><span class="line"> ---&gt; 63ef6cb93316</span><br><span class="line">Removing intermediate container b990c4e55424</span><br><span class="line">Successfully built 63ef6cb93316</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x4E86; <code>--network=host</code> &#x53C2;&#x6570;&#xFF0C;&#x4E8E;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x56E0;&#x6B64; <code>/etc/hosts</code> &#x4E5F;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x770B;&#x5230; <code>1.2.3.4  example.com</code> &#x6761;&#x76EE;&#x3002;</p><h2 id="kai-shi-yun-xu-docker-build-zhong-ding-yi-dockerfile-wei-shi-yong-de-can-shu-arg"><a href="#&#x5F00;&#x59CB;&#x5141;&#x8BB8;-docker-build-&#x4E2D;&#x5B9A;&#x4E49;-Dockerfile-&#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09;" class="headerlink" title="&#x5F00;&#x59CB;&#x5141;&#x8BB8; docker build &#x4E2D;&#x5B9A;&#x4E49; Dockerfile &#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09;"></a>&#x5F00;&#x59CB;&#x5141;&#x8BB8; <code>docker build</code> &#x4E2D;&#x5B9A;&#x4E49; <code>Dockerfile</code> &#x672A;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF08;ARG&#xFF09; <a href="#kai-shi-yun-xu-docker-build-zhong-ding-yi-dockerfile-wei-shi-yong-de-can-shu-arg" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27412" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27412</a></p><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x65F6;&#x53EF;&#x4EE5;&#x7528; <code>--build-arg</code> &#x6765;&#x5B9A;&#x4E49;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x6837; <code>Dockerfile</code> &#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x503C;&#x6765;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E; CI/CD &#x7CFB;&#x7EDF;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x5957; <code>Dockerfile</code> &#x6765;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x6761;&#x4EF6;&#x4E0B;&#x7684;&#x955C;&#x50CF;&#x3002;</p><p>&#x4F46;&#x5728; <code>1.13</code> &#x4EE5;&#x524D;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5728; CI &#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x65F6;&#x5E0C;&#x671B;&#x7528;&#x4E00;&#x5957;&#x6784;&#x5EFA;&#x547D;&#x4EE4;&#x3001;&#x811A;&#x672C;&#xFF0C;&#x901A;&#x8FC7;&#x7ED9;&#x5165;&#x4E0D;&#x540C;&#x7684; <code>Dockerfile</code> &#x6765;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x800C; <code>--build-arg</code> &#x7684;&#x76EE;&#x7684;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x7528;&#x5230;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6709;&#x7684; <code>Dockerfile</code> &#x4E2D;&#x6CA1;&#x7528;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x90A3;&#x4E48;&#x6784;&#x5EFA;&#x5C31;&#x4F1A;&#x5931;&#x8D25;&#x3002;<a href="https://github.com/docker/docker/issues/26249" target="_blank" rel="noopener">#26249</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat Dockerfile</span><br><span class="line">FROM ubuntu</span><br><span class="line">RUN env</span><br><span class="line">$ docker build -t myapp --build-arg VERSION=1.2.3 --no-cache .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2 : RUN env</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 81f4ba452a49</span><br><span class="line">HOSTNAME=2866979c4d77</span><br><span class="line">HOME=/root</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">PWD=/</span><br><span class="line"> ---&gt; f78b4696a1ca</span><br><span class="line">Removing intermediate container 81f4ba452a49</span><br><span class="line">One or more build-args [VERSION] were not consumed, failing build.</span><br></pre></td></tr></table></figure><p>&#x5176;&#x80CC;&#x540E;&#x7684;&#x601D;&#x60F3;&#x662F;&#xFF0C;&#x5982;&#x679C; <code>--build-arg</code> &#x6307;&#x5B9A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A;&#x62FC;&#x5199;&#x9519;&#x8BEF;&#x3001;&#x6216;&#x8005;&#x5FD8;&#x8BB0;&#x4E86;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x800C;&#x51FA;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6700;&#x521D; <code>docker build</code> &#x5BF9;&#x4E8E;&#x8FD9;&#x7C7B;&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x6784;&#x5EFA;&#x5931;&#x8D25;&#x3002;</p><p>&#x4F46;&#x662F;&#x5728;&#x4E0A;&#x9762;&#x7684; CI &#x7684;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;<code>--build-arg</code> &#x53EA;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;<strong>&#x53EF;&#x80FD;</strong>&#x7528;&#x5230;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x5E76;&#x4E0D;&#x5F3A;&#x5236;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x56E0;&#x4E3A; <code>Dockerfile</code> &#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x53EF;&#x80FD;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5C31;&#x62A5;&#x9519;&#x5C31;&#x6709;&#x4E9B;&#x8FC7;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x5C06;&#x5176;<strong>&#x964D;&#x4E3A;&#x8B66;&#x544A;</strong>&#xFF0C;&#x5E76;&#x4E0D;&#x7EC8;&#x6B62;&#x6784;&#x5EFA;&#xFF0C;&#x53EA;&#x662F;&#x63D0;&#x9192;&#x7528;&#x6237;&#x6709;&#x4E9B;&#x53D8;&#x91CF;&#x672A;&#x4F7F;&#x7528;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --no-cache -t myapp --build-arg VERSION=1.2.3 .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Step 1/2 : FROM ubuntu</span><br><span class="line"> ---&gt; 104bec311bcd</span><br><span class="line">Step 2/2 : RUN env</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> bb5e605cb4d0</span><br><span class="line">HOSTNAME=2866979c4d77</span><br><span class="line">HOME=/root</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">PWD=/</span><br><span class="line"> ---&gt; 97207d784048</span><br><span class="line">Removing intermediate container bb5e605cb4d0</span><br><span class="line">[Warning] One or more build-args [VERSION] were not consumed</span><br><span class="line">Successfully built 97207d784048</span><br></pre></td></tr></table></figure><h1 id="an-zhuang"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5; <a href="#an-zhuang" class="header-anchor">#</a></h1><h2 id="jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti"><a href="#&#x89E3;&#x51B3;-GFW-&#x5F71;&#x54CD;-Docker-&#x5B89;&#x88C5;&#x95EE;&#x9898;" class="headerlink" title="&#x89E3;&#x51B3; GFW &#x5F71;&#x54CD; Docker &#x5B89;&#x88C5;&#x95EE;&#x9898;"></a>&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898; <a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27005" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27005</a></p><p>&#x5B98;&#x65B9;&#x7684; <code>apt</code>/<code>yum</code> &#x6E90;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>AWS</code> &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x5B89;&#x5168;&#x4F7F;&#x7528;&#x4E86; <code>HTTPS</code>&#xFF0C;&#x56E0;&#x6B64;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x5F88;&#x4E50;&#x4E8E;&#x5E72;&#x6270;&#x5927;&#x5BB6;&#x4F7F;&#x7528;&#x3002;&#x6CA1;&#x529E;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5404;&#x4E2A;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7EB7;&#x7EB7;&#x5EFA;&#x7ACB;&#x81EA;&#x5DF1;&#x5B98;&#x65B9;&#x6E90;&#x955C;&#x50CF;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x3001;DaoCloud&#x3001;Azura &#x7B49;&#x7B49;&#xFF0C;&#x5E76;&#x4E14;&#x81EA;&#x5DF1;&#x505A;&#x4E86;&#x4E2A;&#x4FEE;&#x8BA2;&#x7248;&#x7684; <code>https://get.docker.com</code> &#x7684;&#x811A;&#x672C;&#x6765;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x3002;</p><p>&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x5B98;&#x65B9;&#x7684; <code>https://get.docker.com</code> &#x5C06;&#x652F;&#x6301; <code>--mirror</code> &#x53C2;&#x6570;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x6E90;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x6301;&#x5FAE;&#x8F6F;&#x7684; Azure &#x4E91;&#xFF0C;&#xFF08;<a href="https://github.com/docker/docker/pull/28858" target="_blank" rel="noopener">&#x6216;&#x963F;&#x91CC;&#x4E91;&#xFF1F;&#xFF08;&#x66F4;&#x65B0;&#xFF1A;&#x7531;&#x4E8E;&#x963F;&#x91CC;&#x4E91;&#x955C;&#x50CF;&#x6E90;&#x4E0D;&#x652F;&#x6301; HTTPS&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x652F;&#x6301;&#x963F;&#x91CC;&#x4E91;&#xFF09;</a>&#xFF09;&#x3002;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure><p>&#x66FF;&#x6362;&#x4E3A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh -s -- --mirror AzureChinaCloud</span><br></pre></td></tr></table></figure><h2 id="zeng-jia-geng-duo-de-xi-tong-zhi-chi"><a href="#&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;" class="headerlink" title="&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;"></a>&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301; <a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi" class="header-anchor">#</a></h2><p>&#x5728;&#x8FD9;&#x6B21;&#x53D1;&#x5E03;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <a href="https://github.com/docker/docker/pull/27993" target="_blank" rel="noopener"><code>Ubuntu 16.10</code> &#x7684;&#x5B89;&#x88C5;&#x5305;</a>&#xFF0C;&#x800C;&#x4E14;&#x5BF9; <code>Ubuntu</code> &#x7CFB;&#x7EDF;&#x589E;&#x52A0;&#x4E86; <a href="https://github.com/docker/docker/pull/23438" target="_blank" rel="noopener"><code>PPC64LE</code></a> &#x548C; <a href="https://github.com/docker/docker/pull/26104" target="_blank" rel="noopener"><code>s390x</code></a> &#x6784;&#x67B6;&#x7684;&#x5B89;&#x88C5;&#x5305;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x4E86; <a href="https://github.com/docker/docker/pull/24116" target="_blank" rel="noopener"><code>VMWare Photon OS</code> &#x7CFB;&#x7EDF;</a>&#x7684; <code>RPM</code> &#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x4EE5;&#x53CA;&#x5728; <code>https://get.docker.com</code> &#x7684;&#x652F;&#x6301;&#x3002;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x4E86; <a href="https://github.com/docker/docker/pull/28222" target="_blank" rel="noopener"><code>Fedora 25</code></a>&#xFF0C;&#x751A;&#x81F3;&#x5F00;&#x59CB;&#x652F;&#x6301; <a href="https://github.com/docker/docker/pull/27625" target="_blank" rel="noopener"><code>arm64</code></a>&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x7ED3;&#x675F;&#xFF0C;&#x800C;&#x88AB;&#x79FB;&#x9664;&#x652F;&#x6301;&#xFF0C;&#x6BD4;&#x5982; <code>Ubuntu 15.10</code>&#x3001;<code>Fedora 22</code> &#x90FD;&#x4E0D;&#x5728;&#x652F;&#x6301;&#x4E86;&#x3002;</p><h1 id="wang-luo"><a href="#&#x7F51;&#x7EDC;" class="headerlink" title="&#x7F51;&#x7EDC;"></a>&#x7F51;&#x7EDC; <a href="#wang-luo" class="header-anchor">#</a></h1><h2 id="yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo"><a href="#&#x5141;&#x8BB8;-docker-run-&#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684;-swarm-mode-&#x7684;&#x7F51;&#x7EDC;" class="headerlink" title="&#x5141;&#x8BB8; docker run &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684;&#x7F51;&#x7EDC;"></a>&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC; <a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/25962" target="_blank" rel="noopener">https://github.com/docker/docker/pull/25962</a></p><p>&#x5728; Docker 1.12 &#x53D1;&#x5E03;&#x65B0;&#x7684; Swarm Mode &#x4E4B;&#x540E;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x95EE;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x5165; Swarm Mode &#x670D;&#x52A1;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E2D;&#x53BB;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#xFF0C;&#x56E0;&#x4E3A; <code>swarm</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x662F;&#x4E3A;&#x4E86; <code>swarm mode service</code> &#x51C6;&#x5907;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x66F4;&#x5065;&#x58EE;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker run</code>&#xFF0C;&#x4F1A;&#x7834;&#x574F;&#x4E86;&#x8FD9;&#x91CC;&#x9762;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x3002;</p><p>&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5927;&#x5BB6;&#x9700;&#x6C42;&#x5F88;&#x591A;&#xFF0C;&#x4E8E;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x6298;&#x8877;&#x7684;&#x529E;&#x6CD5;&#x3002;1.13 &#x5141;&#x8BB8;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BBE;&#x5B9A;&#x8BE5;&#x7F51;&#x7EDC;&#x4E3A; <code>attachable</code>&#xFF0C;&#x5141;&#x8BB8;&#x4E4B;&#x540E;&#x7684; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x5230;&#x8BE5;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;</p><p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x3001;&#x4E0D;&#x5141;&#x8BB8;&#x4E4B;&#x540E; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay mynet1</span><br><span class="line">xmgoco2vfrtp0ggc5r0p5z4mg</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5141;&#x8BB8; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x4F7F;&#x7528; 1.13 &#x65B0;&#x52A0;&#x5165;&#x7684; <code>--attachable</code> &#x53C2;&#x6570;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay --attachable mynet2</span><br><span class="line">yvcyhoc6ni0436jux9azc4cjt</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x4E00;&#x4E2A; <code>web</code> &#x670D;&#x52A1;&#xFF0C;&#x8FDE;&#x5165;&#x8FD9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create \</span><br><span class="line">    --name web \</span><br><span class="line">    --network mynet1 \</span><br><span class="line">    --network mynet2 \</span><br><span class="line">    nginx</span><br><span class="line">vv91wd7166y80lbl833rugl2z</span><br></pre></td></tr></table></figure><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528; <code>docker run</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --network mynet1 busybox</span><br><span class="line">docker: Error response from daemon: Could not attach to network mynet1: rpc error: code = 7 desc = network mynet1 not manually attachable.</span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E; <code>mynet1</code> &#x4E0D;&#x5141;&#x8BB8;&#x624B;&#x52A8; <code>attach</code> &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x62A5;&#x9519;&#x4E86;&#x3002;</p><p>&#x5728; 1.12 &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F1A;&#x62A5;&#x544A;&#x8BE5;&#x7F51;&#x7EDC;&#x65E0;&#x6CD5;&#x7ED9; <code>docker run</code> &#x4F7F;&#x7528;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: swarm-scoped network (mynet1) is not compatible with `docker create` or `docker run`. This network can only be used by a docker service.</span><br><span class="line">See <span class="string">&apos;docker run --help&apos;</span>.</span><br></pre></td></tr></table></figure><p><strong>&#x4E0D;&#x8FC7;&#xFF0C;<code>--attachable</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;&#x7F51;&#x7EDC;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x6253;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x7F3A;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;&#x7528;&#x6237;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#x3002;</strong></p><h2 id="yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou"><a href="#&#x5141;&#x8BB8;-docker-service-create-&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;" class="headerlink" title="&#x5141;&#x8BB8; docker service create &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;"></a>&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3; <a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27917" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27917</a><br><a href="https://github.com/docker/docker/pull/28943" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28943</a></p><p><code>docker service create</code> &#x4E2D;&#x7684; <code>--publish</code> &#x683C;&#x5F0F;&#x6709;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x53D8;&#x5316;&#x3002;&#xFF08;&#x5728; 1.13 &#x7684; RC &#x671F;&#x95F4;&#xFF0C;&#x66FE;&#x7ECF;&#x53BB;&#x6389; <code>--publish</code>&#xFF0C;&#x6539;&#x4E3A; <code>--port</code>&#xFF0C;&#x7ECF;&#x8FC7;&#x8BA8;&#x8BBA;&#x540E;&#xFF0C;&#x51B3;&#x5B9A;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; <code>--publish</code>&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;&#x65B0;&#x7684; <code>--port</code> &#x9009;&#x9879;&#x3002;&#xFF09;</p><p>&#x5728; 1.12 &#x4E2D;&#xFF0C;<code>docker service create</code> &#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x53C2;&#x6570; <code>--publish 80:80</code> &#x8FD9;&#x7C7B;&#x5F62;&#x5F0F;&#x6620;&#x5C04;<strong>&#x8FB9;&#x754C;(ingress)&#x7F51;&#x7EDC;</strong>&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6620;&#x5C04;&#x4F1A;&#x4EAB;&#x53D7;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4EE5;&#x53CA; routing mesh&#x3002;</p><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x53E6;&#x4E00;&#x79CD;&#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF0C;&#x88AB;&#x79F0;&#x4E3A; <code>host</code> &#x6A21;&#x5F0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7528;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x6620;&#x5C04;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x53EA;&#x4F1A;&#x6620;&#x5C04;&#x4E8E;&#x5BB9;&#x5668;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x3002;&#x8FD9;&#x5C31;&#x548C;&#x4E00;&#x4EE3; Swarm &#x4E2D;&#x4E00;&#x6837;&#x4E86;&#x3002;&#x867D;&#x7136;&#x5931;&#x53BB;&#x4E86;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9A;&#x4E86;&#x6620;&#x5C04;&#x70B9;&#xFF0C;&#x5728;&#x6709;&#x7684;&#x65F6;&#x5019;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;&#x9700;&#x8981;&#x7684;&#x3002;</p><p>&#x73B0;&#x5728; <code>--publish</code> &#x7684;&#x65B0;&#x7684;&#x53C2;&#x6570;&#x5F62;&#x5F0F;&#x548C; <code>--mount</code> &#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x53C2;&#x6570;&#x503C;&#x4E3A; <code>,</code> &#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x952E;&#x503C;&#x95F4;&#x4EE5; <code>=</code> &#x7B49;&#x53F7;&#x5206;&#x9694;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301; 4 &#x9879;&#x5185;&#x5BB9;&#xFF1A;</p><ul><li><code>protocol</code>&#xFF1A; &#x652F;&#x6301; <code>tcp</code> &#x6216;&#x8005; <code>udp</code></li><li><code>mode</code>&#xFF1A; &#x652F;&#x6301; <code>ingress</code> &#x6216;&#x8005; <code>host</code></li><li><code>target</code>&#xFF1A; &#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li><li><code>published</code>&#xFF1A; &#x6620;&#x5C04;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li></ul><p>&#x6BD4;&#x5982;&#xFF0C;&#x4E0E; <code>-p 8080:80</code> &#x7B49;&#x6548;&#x7684; <code>--publish</code> &#x65B0;&#x683C;&#x5F0F;&#x9009;&#x9879;&#x4E3A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--publish protocol=tcp,mode=ingress,published=8080,target=80</span><br></pre></td></tr></table></figure><p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; <code>-p 8080:80</code>&#xFF0C;&#x4F46;&#x662F;&#x65B0;&#x7684;&#x9009;&#x9879;&#x683C;&#x5F0F;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x80FD;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F7F;&#x7528; 1.13 &#x5F00;&#x59CB;&#x52A0;&#x5165;&#x7684; <code>host</code> &#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@d1:~$ docker service create --name web \</span><br><span class="line">    --publish mode=host,published=80,target=80 \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure><p>&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@d1:~$ docker node ls</span><br><span class="line">ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS</span><br><span class="line">ntjybj51u6zp44akeawuf3i05    d2        Ready   Active</span><br><span class="line">tp7icvjzvxla2n18j3nztgjz6    d3        Ready   Active</span><br><span class="line">vyf3mgcj3uonrnh5xxquasp38 *  d1        Ready   Active        Leader</span><br><span class="line">ubuntu@d1:~$ docker service ps web</span><br><span class="line">ID            NAME    IMAGE         NODE  DESIRED STATE  CURRENT STATE          ERROR  PORTS</span><br><span class="line">5tij5sjvfpsf  web.1   nginx:latest  d3    Running        Running 5 minutes ago         *:80-&gt;80/tcp</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x96C6;&#x7FA4;&#x6709;3&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x5C31;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x8DD1;&#x5230;&#x4E86; <code>d3</code> &#x4E0A;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x4EE5;&#x524D;&#x7684;&#x4F7F;&#x7528;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x7F51;&#x7EDC; <code>ingress</code> &#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#x90FD;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#x3002;</p><p>&#x4F46;&#x662F;&#xFF0C;<code>host</code> &#x6A21;&#x5F0F;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x53EA;&#x6620;&#x5C04;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC; <code>curl d1</code> &#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x4EC0;&#x4E48;&#x770B;&#x4E0D;&#x5230;&#x7F51;&#x9875;&#xFF0C;&#x800C; <code>curl d3</code> &#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@d1:~$ curl localhost</span><br><span class="line">curl: (7) Failed to connect to localhost port 80: Connection refused</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@d3:~$ curl localhost</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><a href="#iptables-&#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;" class="headerlink" title="iptables &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;"></a><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD; <a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28257" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28257</a></p><p>&#x4ECE;&#x9ED8;&#x8BA4; <code>FORWARD</code> &#x6539;&#x4E3A; <code>DROP</code>&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;<a href="https://github.com/docker/docker/issues/14041" target="_blank" rel="noopener">&#x5BB9;&#x5668;&#x5916;&#x9732;&#x7684;&#x5B89;&#x5168;&#x95EE;&#x9898;</a>&#x3002;</p><h2 id="zai-docker-network-inspect-li-xian-shi-lian-ru-de-jie-dian"><a href="#&#x5728;-docker-network-inspect-&#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9;" class="headerlink" title="&#x5728; docker network inspect &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9;"></a>&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x7684;&#x8282;&#x70B9; <a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-de-jie-dian" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x77E5;&#x9053;&#xFF0C;&#x5728; <code>swarm mode</code> &#x4E2D;&#x521B;&#x5EFA;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E0B;&#x5B50;&#x5C31;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A; <code>docker network ls</code> &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x4F7F;&#x7528;&#x8BE5;&#x7F51;&#x7EDC;&#x7684;&#x5BB9;&#x5668;&#x8C03;&#x5EA6;&#x5230;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x540E;&#xFF0C;&#x624D;&#x4F1A;&#x5C06;&#x8BE5;&#x8282;&#x70B9;&#x8FDE;&#x5165;&#x6B64; <code>overlay</code> &#x7F51;&#x7EDC;&#x3002;&#x5728;&#x7F51;&#x7EDC;&#x6392;&#x969C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x6709;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x5F97;&#x77E5;&#x73B0;&#x5728;&#x8FDE;&#x5165;&#x8BE5; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x5230;&#x5E95;&#x6709;&#x54EA;&#x4E9B;&#xFF0C;&#x8FD9;&#x5728; <code>1.13</code> &#x4E4B;&#x524D;&#x4E0D;&#x5BB9;&#x6613;&#x505A;&#x5230;&#x3002;</p><p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;<code>docker network inspect</code> &#x5C06;&#x663E;&#x793A;&#x8FDE;&#x63A5;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#x8282;&#x70B9;&#xFF08;&#x5BBF;&#x4E3B;&#xFF09;&#x6709;&#x54EA;&#x4E9B;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">   {</span><br><span class="line">       <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;jjpnbdh8vu4onjojskntd2jhh&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2017-01-18T00:00:31.742146058Z&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;swarm&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay&quot;</span>,</span><br><span class="line">       <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;IPAM&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">           <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">               {</span><br><span class="line">                   <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;10.0.0.0/24&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;10.0.0.1&quot;</span></span><br><span class="line">               }</span><br><span class="line">           ]</span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;Containers&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;3cafea27c53de34724e46d4fe83c9e60311b628b82e9be66d8d2e0812669d575&quot;</span>: {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;myapp.2.qz2hs1eqq3ikx59ydh0w7u1g4&quot;</span>,</span><br><span class="line">               <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;0e26b08254e851b7b238215cec07acdd8b0b68dc4671f55235e203a0c260522f&quot;</span>,</span><br><span class="line">               <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:0a:00:00:04&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;10.0.0.4/24&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">           }</span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Options&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;com.docker.network.driver.overlay.vxlanid_list&quot;</span>: <span class="string">&quot;4097&quot;</span></span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Labels&quot;</span>: {},</span><br><span class="line">       <span class="string">&quot;Peers&quot;</span>: [</span><br><span class="line">           {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;d1-23348b84b134&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;138.197.213.116&quot;</span></span><br><span class="line">           },</span><br><span class="line">           {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;d2-8964dea9e75c&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;138.197.221.47&quot;</span></span><br><span class="line">           }</span><br><span class="line">       ]</span><br><span class="line">   }</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x4E00;&#x5171;&#x6709;&#x4E24;&#x4E2A;&#x5BBF;&#x4E3B;&#x8FDE;&#x5165;&#x4E86;&#x8FD9;&#x4E2A; <code>mynet</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5206;&#x522B;&#x4E3A; <code>138.197.213.116</code> &#x548C; <code>138.197.221.47</code>&#x3002;</p><h2 id="yun-xu-service-vip-ke-yi-bei-ping"><a href="#&#x5141;&#x8BB8;-service-VIP-&#x53EF;&#x4EE5;&#x88AB;-ping" class="headerlink" title="&#x5141;&#x8BB8; service VIP &#x53EF;&#x4EE5;&#x88AB; ping"></a>&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code> <a href="#yun-xu-service-vip-ke-yi-bei-ping" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28019" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28019</a></p><p>&#x5728; 1.12 &#x7684;&#x4E8C;&#x4EE3; Swarm &#x6392;&#x969C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;<a href="https://github.com/docker/docker/issues/25497" target="_blank" rel="noopener">&#x8DE8;&#x8282;&#x70B9;&#x7684;&#x670D;&#x52A1; VIP &#x4E0D;&#x53EF;&#x4EE5; <code>ping</code></a>&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x641E;&#x4E0D;&#x61C2;&#x662F; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E0D;&#x901A;&#x5462;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x6CA1;&#x8D77;&#x6765;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6709;&#x95EE;&#x9898;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728; 1.13 &#x89E3;&#x51B3;&#x4E86;&#xFF0C;VIP &#x53EF;&#x4EE5;&#x968F;&#x4FBF; <code>ping</code>&#xFF0C;&#x8DE8;&#x5BBF;&#x4E3B;&#x4E5F;&#x6CA1;&#x5173;&#x7CFB;&#x3002;</p><h1 id="cha-jian"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6; <a href="#cha-jian" class="header-anchor">#</a></h1><h2 id="cha-jian-gong-neng-zheng-shi-qi-yong"><a href="#&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;" class="headerlink" title="&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;"></a>&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528; <a href="#cha-jian-gong-neng-zheng-shi-qi-yong" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28226" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28226</a></p><p>&#x5728; 1.12 &#x5F15;&#x5165;&#x4E86;&#x63D2;&#x4EF6;&#x6982;&#x5FF5;&#x540E;&#xFF0C;&#x4F5C;&#x4E3A;&#x8BD5;&#x9A8C;&#x7279;&#x6027;&#x5F97;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5173;&#x6CE8;&#x3002;&#x5305;&#x62EC; <a href="https://store.docker.com/" target="_blank" rel="noopener">Docker Store</a> &#x5F00;&#x59CB;&#x51C6;&#x5907;&#x4E0A;&#x7EBF;&#xFF0C;&#x4EE5;&#x53CA;&#x7B2C;&#x4E09;&#x65B9;&#x7684;&#x63D2;&#x4EF6;&#x7684;&#x5F00;&#x53D1;&#x3002;&#x73B0;&#x5728; 1.13 &#x63D2;&#x4EF6;&#x4F5C;&#x4E3A;&#x6B63;&#x5F0F;&#x529F;&#x80FD;&#x63D0;&#x4F9B;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ docker plugin</span><br><span class="line"></span><br><span class="line">Usage:docker plugin COMMAND</span><br><span class="line"></span><br><span class="line">Manage plugins</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a plugin from a rootfs and config</span><br><span class="line">  <span class="built_in">disable</span>     Disable a plugin</span><br><span class="line">  <span class="built_in">enable</span>      Enable a plugin</span><br><span class="line">  inspect     Display detailed information on one or more plugins</span><br><span class="line">  install     Install a plugin</span><br><span class="line">  ls          List plugins</span><br><span class="line">  push        Push a plugin to a registry</span><br><span class="line">  rm          Remove one or more plugins</span><br><span class="line">  <span class="built_in">set</span>         Change settings <span class="keyword">for</span> a plugin</span><br><span class="line"></span><br><span class="line">Run <span class="string">&apos;docker plugin COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure><p>&#x76F8;&#x6BD4;&#x4E8E; 1.12 &#x7684;&#x8BD5;&#x9A8C;&#x7248;&#x672C;&#x800C;&#x8A00;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x589E;&#x52A0;&#x4E86; <code>docker plugin create</code> &#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6709; <code>config.json</code> &#x6587;&#x4EF6;&#x548C; <code>rootfs</code> &#x76EE;&#x5F55;&#x7684;&#x76EE;&#x5F55;&#x6765;&#x521B;&#x5EFA;&#x63D2;&#x4EF6;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ls -ls /home/pluginDir</span><br><span class="line"></span><br><span class="line">4 -rw-r--r--  1 root root 431 Nov  7 01:40 config.json</span><br><span class="line">0 drwxr-xr-x 19 root root 420 Nov  7 01:40 rootfs</span><br><span class="line"></span><br><span class="line">$ docker plugin create plugin /home/pluginDir</span><br><span class="line">plugin</span><br><span class="line"></span><br><span class="line">$ docker plugin ls</span><br><span class="line">ID                  NAME                TAG                 DESCRIPTION                  ENABLED</span><br><span class="line">672d8144ec02        plugin              latest              A sample plugin <span class="keyword">for</span> Docker   <span class="literal">false</span></span><br></pre></td></tr></table></figure><h1 id="ming-ling-xing"><a href="#&#x547D;&#x4EE4;&#x884C;" class="headerlink" title="&#x547D;&#x4EE4;&#x884C;"></a>&#x547D;&#x4EE4;&#x884C; <a href="#ming-ling-xing" class="header-anchor">#</a></h1><h2 id="checkpoint-gong-neng-shi-yan-gong-neng"><a href="#checkpoint-&#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;" class="headerlink" title="checkpoint &#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;"></a><code>checkpoint</code> &#x529F;&#x80FD;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09; <a href="#checkpoint-gong-neng-shi-yan-gong-neng" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/22049" target="_blank" rel="noopener">https://github.com/docker/docker/pull/22049</a></p><p><code>checkpoint</code> &#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x5C06;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x72B6;&#x6001;&#x51BB;&#x7ED3;&#x5E76;&#x4FDD;&#x5B58;&#x4E3A;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;&#x5C06;&#x6765;&#x53EF;&#x4EE5;&#x4ECE;&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x6062;&#x590D;&#x6B64;&#x65F6;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p><h3 id="zhun-bei-gong-zuo"><a href="#&#x51C6;&#x5907;&#x5DE5;&#x4F5C;" class="headerlink" title="&#x51C6;&#x5907;&#x5DE5;&#x4F5C;"></a>&#x51C6;&#x5907;&#x5DE5;&#x4F5C; <a href="#zhun-bei-gong-zuo" class="header-anchor">#</a></h3><p>&#x76EE;&#x524D;&#x5B83;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x662F; <code>criu</code> &#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x56E0;&#x6B64;&#x5728; Linux &#x4E0A;&#x9700;&#x8981;&#x5148;&#x5B89;&#x88C5;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#xFF08;&#x76EE;&#x524D;&#x5C1A;&#x65E0;&#x6CD5;&#x5728; Docker for Mac &#x4E2D;&#x4F7F;&#x7528; <a href="https://github.com/docker/for-mac/issues/1059" target="_blank" rel="noopener">docker/for-mac#1059</a>)</p><p>&#x5982;&#x679C;&#x672A;&#x5B89;&#x88C5; <code>criu</code> &#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x5982;&#x4E0B;&#x62A5;&#x9519;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: Cannot checkpoint container myapp1: rpc error: code = 2 desc = <span class="built_in">exit</span> status 1: <span class="string">&quot;Unable to execute CRIU command: criu\n&quot;</span></span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E; Ubuntu &#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5B89;&#x88C5; <code>criu</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y criu</span><br></pre></td></tr></table></figure><blockquote><p>&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x662F;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5728; <code>docker.service</code> &#x4E2D; <code>ExecStart=</code> &#x8FD9;&#x884C;&#x540E;&#x9762;&#x6DFB;&#x52A0; <code>--experimental</code> &#x9009;&#x9879;&#x3002;&#x5176;&#x5B83;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#x4E5F;&#x9700;&#x5982;&#x6B64;&#x914D;&#x7F6E;&#x3002;</p></blockquote><p>&#x7136;&#x540E;&#x4E0D;&#x8981;&#x5FD8;&#x4E86; <code>systemctl daemon-reload</code> &#x548C; <code>systemctl restart docker</code>&#x3002;</p><h3 id="chuang-jian-checkpoint-ji-hui-fu"><a href="#&#x521B;&#x5EFA;-Checkpoint-&#x53CA;&#x6062;&#x590D;" class="headerlink" title="&#x521B;&#x5EFA; Checkpoint &#x53CA;&#x6062;&#x590D;"></a>&#x521B;&#x5EFA; Checkpoint &#x53CA;&#x6062;&#x590D; <a href="#chuang-jian-checkpoint-ji-hui-fu" class="header-anchor">#</a></h3><p>&#x6267;&#x884C; <code>docker checkpoint create</code> &#x5C31;&#x53EF;&#x4EE5;&#x4E3A;&#x5BB9;&#x5668;&#x521B;&#x5EFA; <code>checkpoint</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker checkpoint create myapp1 checkpoint1</span><br><span class="line">checkpoint1</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x4E3A;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x591A;&#x4E2A; <code>checkpoint</code>&#xFF0C;&#x6BCF;&#x4E2A;&#x8D77;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x5B57;&#x5C31;&#x662F;&#x4E86;&#x3002;</p><p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7528; <code>docker checkpoint ls</code> &#x6765;&#x5217;&#x51FA;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684; <code>checkpoint</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker checkpoint ls myapp1</span><br><span class="line">CHECKPOINT NAME</span><br><span class="line">checkpoint1</span><br></pre></td></tr></table></figure><p><em>&#x5982;&#x679C;&#x4E0D;&#x52A0; <code>--leave-running</code> &#x53C2;&#x6570;&#x7684;&#x8BDD;&#xFF0C;&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x5728;&#x521B;&#x5EFA;&#x5B8C; <code>checkpoint</code> &#x5C31;&#x4F1A;&#x88AB;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#x3002;</em></p><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker start --checkpoint</code> &#x6765;&#x4ECE;&#x67D0;&#x4E2A; <code>checkpoint</code> &#x6062;&#x590D;&#x8FD0;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start --checkpoint checkpoint1 myapp1</span><br></pre></td></tr></table></figure><p>&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x4ECE; <code>checkpoint1</code> &#x8FD9;&#x4E2A;&#x70B9;&#x6062;&#x590D;&#x5E76;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;</p><p>&#x5907;&#x4EFD;&#x65F6;&#x53EF;&#x4EE5;&#x7528; <code>--checkpoint-dir</code> &#x6307;&#x5B9A;&#x5177;&#x4F53;&#x7684;&#x4FDD;&#x5B58; <code>checkpoint</code> &#x7684;&#x76EE;&#x5F55;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker checkpoint create --checkpoint-dir <span class="variable">$PWD</span>/backup --leave-running myapp1 checkpoint1</span><br><span class="line">checkpoint1</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; <code>backup</code> &#x4E2D;&#x770B;&#x5230;&#x5B9E;&#x9645;&#x4FDD;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ tree backup/</span><br><span class="line">backup/</span><br><span class="line">&#x2514;&#x2500;&#x2500; checkpoint1</span><br><span class="line">   &#x251C;&#x2500;&#x2500; cgroup.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; config.json</span><br><span class="line">   &#x251C;&#x2500;&#x2500; core-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; core-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; criu.work</span><br><span class="line">   &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; dump.log</span><br><span class="line">   &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; stats-dump</span><br><span class="line">   &#x251C;&#x2500;&#x2500; descriptors.json</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fdinfo-2.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fdinfo-3.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fs-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; fs-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ids-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ids-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; inventory.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ip6tables-9.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; ipcns-var-10.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; iptables-9.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; mm-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; mm-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; mountpoints-12.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pagemap-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pagemap-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pages-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pages-2.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pipes-data.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pipes.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; pstree.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; reg-files.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; seccomp.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; sigacts-1.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; sigacts-54.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; tmpfs-dev-46.tar.gz.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; tmpfs-dev-49.tar.gz.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; tmpfs-dev-50.tar.gz.img</span><br><span class="line">   &#x251C;&#x2500;&#x2500; unixsk.img</span><br><span class="line">   &#x2514;&#x2500;&#x2500; utsns-11.img</span><br></pre></td></tr></table></figure><h2 id="docker-stats-zhong-yu-ke-yi-xian-shi-rong-qi-ming-liao"><a href="#docker-stats-&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86;" class="headerlink" title="docker stats &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86;"></a><code>docker stats</code> &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x4E86; <a href="#docker-stats-zhong-yu-ke-yi-xian-shi-rong-qi-ming-liao" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27797" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27797</a><br><a href="https://github.com/docker/docker/pull/24987" target="_blank" rel="noopener">https://github.com/docker/docker/pull/24987</a></p><p><code>docker stats</code> &#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x7684;&#x8D44;&#x6E90;&#x5360;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x7528;&#x6765;&#x5206;&#x6790;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x5F00;&#x9500;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x3002;&#x4E0D;&#x8FC7;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x6709;&#x4E2A;&#x5F88;&#x8BA8;&#x538C;&#x7684;&#x95EE;&#x9898;&#xFF0C;<code>docker stats</code> &#x4E0D;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats</span><br><span class="line">CONTAINER           CPU %               MEM USAGE / LIMIT       MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">e8cb2945b156        0.00%               1.434 MiB / 488.4 MiB   0.29%               1.3 kB / 648 B      12.3 kB / 0 B       2</span><br><span class="line">61aada055db8        0.00%               3.598 MiB / 488.4 MiB   0.74%               1.3 kB / 1.3 kB     2.29 MB / 0 B       2</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x8BA9;&#x4EBA;&#x6839;&#x672C;&#x6CA1;&#x529E;&#x6CD5;&#x77E5;&#x9053;&#x5230;&#x5E95;&#x8C01;&#x662F;&#x8C01;&#x3002;&#x4E8E;&#x662F;&#x6709;&#x5404;&#x79CD;<a href="https://github.com/docker/docker/issues/20973" target="_blank" rel="noopener">&#x53D8;&#x901A;&#x7684;&#x529E;&#x6CD5;</a>&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats $(docker ps --format={{.Names}})</span><br></pre></td></tr></table></figure><p>&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x5217;&#x8868;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x589E;&#x52A0;&#x3001;&#x5220;&#x9664;&#x90FD;&#x5F97;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x3002;</p><p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x867D;&#x7136;&#x4F9D;&#x65E7;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x4F46;&#x662F;&#x589E;&#x52A0;&#x4E86; <code>--format</code> &#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x8BBE;&#x8BA1;&#x8F93;&#x51FA;&#x683C;&#x5F0F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats --format <span class="string">&apos;table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}\t{{.NetIO}}\t{{.BlockIO}}\t{{.PIDs}}&apos;</span></span><br><span class="line">NAME                               CPU %               MEM USAGE / LIMIT       MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">app2.1.5tij5sjvfpsft2lctxh8m8trn   0.00%               1.434 MiB / 488.4 MiB   0.29%               1.3 kB / 648 B      12.3 kB / 0 B       2</span><br><span class="line">app1.1.mjmb8b0f0w5sy2v41jth3v9s4   0.00%               3.598 MiB / 488.4 MiB   0.74%               1.3 kB / 1.3 kB     2.29 MB / 0 B       2</span><br></pre></td></tr></table></figure><h2 id="gei-docker-ps-zeng-jia-is-task-guo-lu-qi"><a href="#&#x7ED9;-docker-ps-&#x589E;&#x52A0;-is-task-&#x8FC7;&#x6EE4;&#x5668;" class="headerlink" title="&#x7ED9; docker ps &#x589E;&#x52A0; is-task &#x8FC7;&#x6EE4;&#x5668;"></a>&#x7ED9; <code>docker ps</code> &#x589E;&#x52A0; <code>is-task</code> &#x8FC7;&#x6EE4;&#x5668; <a href="#gei-docker-ps-zeng-jia-is-task-guo-lu-qi" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/24411" target="_blank" rel="noopener">https://github.com/docker/docker/pull/24411</a></p><p>&#x5F00;&#x59CB;&#x4F7F;&#x7528; Swarm Mode &#x540E;&#xFF0C;&#x7ECF;&#x5E38;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#xFF0C;<code>docker ps</code> &#x6240;&#x770B;&#x5230;&#x7684;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x5230;&#x5E95;&#x54EA;&#x4E9B;&#x662F;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#xFF1F;&#x54EA;&#x4E9B;&#x662F; <code>docker run</code> &#x8DD1;&#x8D77;&#x6765;&#x7684;&#x5355;&#x72EC;&#x7684;&#x5BB9;&#x5668;&#xFF1F;</p><p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <code>is-task</code> &#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x4EE5;&#x533A;&#x5206;&#x666E;&#x901A;&#x5BB9;&#x5668;&#x548C; Swarm Mode &#x7684;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps -f <span class="string">&apos;is-task=true&apos;</span></span><br><span class="line">CONTAINER ID        IMAGE                                                                           COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">cdf0d35db1d3        nginx@sha256:33ff28a2763feccc1e1071a97960b7fef714d6e17e2d0ff573b74825d0049303   <span class="string">&quot;nginx -g &apos;daemon ...&quot;</span>   44 seconds ago      Up 44 seconds       80/tcp, 443/tcp     myservice.1.6rdwhkb84j6ioyqlvk6h6bql8</span><br></pre></td></tr></table></figure><h2 id="zai-ye-bu-hui-chu-xian-ke-hu-duan-he-fu-wu-duan-bu-tong-ban-ben-dao-zhi-de-cuo-wu-liao"><a href="#&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86;" class="headerlink" title="&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86;"></a>&#x518D;&#x4E5F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x4E86; <a href="#zai-ye-bu-hui-chu-xian-ke-hu-duan-he-fu-wu-duan-bu-tong-ban-ben-dao-zhi-de-cuo-wu-liao" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27745" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27745</a></p><p>&#x5728;&#x4EE5;&#x524D;&#xFF0C;docker &#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x5FC5;&#x987B;&#x7248;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x4F1A;&#x62A5; <code>Client and server don&apos;t have the same version</code> &#x8FD9;&#x7C7B;&#x9519;&#x8BEF;&#x3002;&#x540E;&#x6765;&#x589E;&#x52A0;&#x4E86; <code>DOCKER_API_VERSION</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x9AD8;&#x4E8E;&#x670D;&#x52A1;&#x7AEF;&#x7248;&#x672C;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x7AEF; API &#x7248;&#x672C;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x8FD9;&#x7C7B;&#x9519;&#x8BEF;&#x3002;</p><p>&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x7248;&#x672C;&#x5224;&#x65AD;&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4ECE;&#x800C;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x7248;&#x672C;&#x4E0D;&#x4E00;&#x81F4;&#x800C;&#x62A5;&#x9519;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      1.13.0-dev</span><br><span class="line"> API version:  1.24 (downgraded from 1.25)</span><br><span class="line"> Go version:   go1.7.3</span><br><span class="line"> Git commit:   ec3a34b</span><br><span class="line"> Built:        Wed Oct 26 00:54:51 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      1.12.2</span><br><span class="line"> API version:  1.24</span><br><span class="line"> Go version:   go1.6.3</span><br><span class="line"> Git commit:   bb80604</span><br><span class="line"> Built:        Tue Oct 11 17:00:50 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"> Experimental: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="docker-inspect-jiang-ke-yi-cha-kan-ren-he-docker-dui-xiang"><a href="#docker-inspect-&#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55;-docker-&#x5BF9;&#x8C61;" class="headerlink" title="docker inspect &#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; docker &#x5BF9;&#x8C61;"></a><code>docker inspect</code> &#x5C06;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; docker &#x5BF9;&#x8C61; <a href="#docker-inspect-jiang-ke-yi-cha-kan-ren-he-docker-dui-xiang" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/23614" target="_blank" rel="noopener">https://github.com/docker/docker/pull/23614</a></p><p>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5F88;&#x719F;&#x6089; <code>docker inspect</code>&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x7528;&#x5B83;&#x67E5;&#x770B;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3002;&#x4ECE; <code>1.13</code> &#x5F00;&#x59CB;&#xFF0C;&#x8FD9;&#x5C06;&#x53D8;&#x7684;&#x66F4;&#x9AD8;&#x7EA7;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4EFB;&#x4F55; Docker &#x5BF9;&#x8C61;&#x3002;&#x4ECE;&#x7F51;&#x7EDC;&#x3001;task&#x3001;service&#x3001;volume&#x5230;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7B49;&#x7B49;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x7528; <code>docker service ps</code> &#x5217;&#x51FA;&#x4E86;&#x670D;&#x52A1;&#x5BF9;&#x5E94;&#x7684; <code>task</code> &#x5217;&#x8868;&#xFF0C;&#x5F97;&#x5230; <code>task id</code> &#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker inspect</code> &#x8FD9;&#x4E2A; <code>task id</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps myservice</span><br><span class="line">ID            NAME         IMAGE         NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS</span><br><span class="line">6rdwhkb84j6i  myservice.1  nginx:latest  d1    Running        Running 13 minutes ago</span><br><span class="line">$ docker inspect 6rdwhkb84j6i</span><br><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        <span class="string">&quot;ID&quot;</span>: <span class="string">&quot;6rdwhkb84j6ioyqlvk6h6bql8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: {</span><br><span class="line">            <span class="string">&quot;Index&quot;</span>: 17</span><br><span class="line">        },</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2017-01-18T14:40:40.959516063Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;UpdatedAt&quot;</span>: <span class="string">&quot;2017-01-18T14:40:52.302378995Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Spec&quot;</span>: {</span><br><span class="line">            <span class="string">&quot;ContainerSpec&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;nginx:latest@sha256:33ff28a2763feccc1e1071a97960b7fef714d6e17e2d0ff573b74825d0049303&quot;</span>,</span><br><span class="line">                <span class="string">&quot;DNSConfig&quot;</span>: {}</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;Resources&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;Limits&quot;</span>: {},</span><br><span class="line">                <span class="string">&quot;Reservations&quot;</span>: {}</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;Condition&quot;</span>: <span class="string">&quot;any&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaxAttempts&quot;</span>: 0</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;Placement&quot;</span>: {},</span><br><span class="line">            <span class="string">&quot;ForceUpdate&quot;</span>: 0</span><br><span class="line">        },</span><br><span class="line">        <span class="string">&quot;ServiceID&quot;</span>: <span class="string">&quot;u7bidaojbndhrsgyj29unv4wg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Slot&quot;</span>: 1,</span><br><span class="line">        <span class="string">&quot;NodeID&quot;</span>: <span class="string">&quot;5s5nvnif1i4frentwidiu97mn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Status&quot;</span>: {</span><br><span class="line">            <span class="string">&quot;Timestamp&quot;</span>: <span class="string">&quot;2017-01-18T14:40:52.252715087Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;State&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Message&quot;</span>: <span class="string">&quot;started&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ContainerStatus&quot;</span>: {</span><br><span class="line">                <span class="string">&quot;ContainerID&quot;</span>: <span class="string">&quot;cdf0d35db1d37266af56b59dd8c3cd54de46442987e25e6fd25d38da1da7e459&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PID&quot;</span>: 6563</span><br><span class="line">            },</span><br><span class="line">            <span class="string">&quot;PortStatus&quot;</span>: {}</span><br><span class="line">        },</span><br><span class="line">        <span class="string">&quot;DesiredState&quot;</span>: <span class="string">&quot;running&quot;</span></span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="yun-xing-shi"><a href="#&#x8FD0;&#x884C;&#x65F6;" class="headerlink" title="&#x8FD0;&#x884C;&#x65F6;"></a>&#x8FD0;&#x884C;&#x65F6; <a href="#yun-xing-shi" class="header-anchor">#</a></h1><h2 id="bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu"><a href="#&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;-experimental-&#x53C2;&#x6570;" class="headerlink" title="&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; --experimental &#x53C2;&#x6570;"></a>&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570; <a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27223" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27223</a></p><p>&#x4EE5;&#x524D;&#x6211;&#x4EEC;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x6D4B;&#x8BD5;&#x5F53;&#x524D;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x5FC5;&#x987B;&#x6DFB;&#x52A0;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x6E90;&#xFF0C;&#x91CD;&#x88C5; <code>docker</code>&#x3002;&#x8FD9;&#x7ED9;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x5E26;&#x6765;&#x4E86;&#x56F0;&#x96BE;&#x3002;&#x73B0;&#x5728;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x4E0D;&#x5728;&#x5206;&#x4E3A;&#x4E24;&#x7EC4;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6784;&#x5EFA;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x76F4;&#x63A5;&#x5728; <code>dockerd</code> &#x540E;&#x6DFB;&#x52A0; <code>--experimental</code> &#x5373;&#x53EF;&#x3002;</p><h2 id="zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e"><a href="#&#x5728;-overlay2-&#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E;-xfs-&#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;" class="headerlink" title="&#x5728; overlay2 &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; xfs &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;"></a>&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D; <a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/24771" target="_blank" rel="noopener">https://github.com/docker/docker/pull/24771</a></p><p>&#x5728; 1.13 &#x4E4B;&#x524D;&#xFF0C;&#x53EA;&#x6709;&#x5757;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9A71;&#x52A8;&#xFF08;&#x5982; <code>devicemapper</code>, <code>xfs</code>, <code>zfs</code>&#x7B49;&#xFF09;&#x652F;&#x6301;&#x78C1;&#x76D8;&#x914D;&#x989D;&#x80FD;&#x529B;&#xFF0C;&#x800C;&#x6240;&#x6709; <code>Union FS</code> &#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x914D;&#x989D;&#x3002;&#x73B0;&#x5728;&#x9488;&#x5BF9;&#x4F7F;&#x7528; <code>XFS</code> &#x4E3A;&#x540E;&#x7AEF;&#x7684; <code>overlay2</code> &#x9A71;&#x52A8;&#x652F;&#x6301;&#x4E86;&#x78C1;&#x76D8;&#x914D;&#x989D;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x5C06;&#x6765;&#x79FB;&#x690D;&#x5230; <code>AUFS</code>&#x3002;</p><h2 id="zeng-jia-docker-system-ming-ling"><a href="#&#x589E;&#x52A0;-docker-system-&#x547D;&#x4EE4;" class="headerlink" title="&#x589E;&#x52A0; docker system &#x547D;&#x4EE4;"></a>&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4; <a href="#zeng-jia-docker-system-ming-ling" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26108" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26108</a><br><a href="https://github.com/docker/docker/pull/27525" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27525</a></p><p>&#x5F88;&#x591A;&#x4EBA;&#x5728;&#x4EE5;&#x524D;&#x641E;&#x4E0D;&#x61C2;&#x81EA;&#x5DF1;&#x7684;&#x955C;&#x50CF;&#x5230;&#x5E95;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3001;&#x5BB9;&#x5668;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#xFF0C;&#x5377;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3002;&#x600E;&#x4E48;&#x5220;&#x9664;&#x4E0D;&#x7528;&#x7684;&#x4E1C;&#x897F;&#x4EE5;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>system</code> &#x547D;&#x4EE4;&#x6765;&#x5E2E;&#x52A9;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker system</span><br><span class="line"></span><br><span class="line">Usage:docker system COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">     --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"> df          Show docker disk usage</span><br><span class="line"> events      Get real time events from the server</span><br><span class="line"> info        Display system-wide information</span><br><span class="line"> prune       Remove unused data</span><br><span class="line"></span><br><span class="line">Run <span class="string">&apos;docker system COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure><p><code>docker system df</code> &#x662F;&#x663E;&#x793A;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker system df</span><br><span class="line">TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE</span><br><span class="line">Images              3                   3                   700.3 MB            123 MB (17%)</span><br><span class="line">Containers          3                   3                   15 B                0 B (0%)</span><br><span class="line">Local Volumes       1                   1                   219.4 MB            0 B (0%)</span><br></pre></td></tr></table></figure><p>&#x663E;&#x793A;&#x7684;&#x5217;&#x8868;&#x4E2D;&#x5217;&#x51FA;&#x4E86;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x672C;&#x5730;&#x5377;&#x6240;&#x5360;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x80FD;&#x56DE;&#x6536;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x955C;&#x50CF;&#x6709; 123MB &#x7684;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x56DE;&#x6536;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;<code>docker</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>prune</code> &#x547D;&#x4EE4;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p><ul><li><code>docker image prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;</li><li><code>docker container prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5BB9;&#x5668;</li><li><code>docker volume prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5377;</li><li><code>docker network prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x7F51;&#x7EDC;</li><li><code>docker system prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x5377;&#x3001;&#x7F51;&#x7EDC;</li></ul><p>&#x8FD8;&#x8BB0;&#x5F97;&#x4E4B;&#x524D;&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x6240;&#x7528;&#x7684; <code>docker rmi $(docker images -f dangling=true -aq)</code> &#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#x4E48;&#xFF1F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730; <code>docker image prune</code> &#x5373;&#x53EF;&#x5220;&#x9664;&#x3002;</p><p>&#x6B64;&#x5916;&#xFF0C;&#x4ECE;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x547D;&#x4EE4;&#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x4E86;&#x3002;&#x4E4B;&#x524D;&#x9ED8;&#x8BA4;&#x7684; <code>docker info</code>&#xFF0C;<code>docker ps</code>&#xFF0C;<code>docker rm</code>&#xFF0C;<code>docker run</code> &#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5BF9;&#x5E94;&#x7684; <code>docker image</code>, <code>docker container</code>, <code>docker system</code> &#x4E0B;&#x4E86;&#x3002;&#x76EE;&#x524D;&#x4E4B;&#x524D;&#x7684;&#x547D;&#x4EE4;&#x4F9D;&#x65E7;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x4F1A;&#x7EE7;&#x7EED;&#x4FDD;&#x6301;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x662F;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x7684;&#x7248;&#x672C;&#x4E86;&#x3002;</p><h2 id="ti-sheng-overlay2-de-you-xian-ji"><a href="#&#x63D0;&#x5347;-overlay2-&#x7684;&#x4F18;&#x5148;&#x7EA7;" class="headerlink" title="&#x63D0;&#x5347; overlay2 &#x7684;&#x4F18;&#x5148;&#x7EA7;"></a>&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7; <a href="#ti-sheng-overlay2-de-you-xian-ji" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27932" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27932</a></p><p>&#x7531;&#x4E8E; <code>overlay2</code> &#x5728; 4.+ &#x5185;&#x6838;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;&#x8D8B;&#x4E8E;&#x7A33;&#x5B9A;&#xFF0C;&#x56E0;&#x6B64;&#x5C06;&#x5176;&#x4F18;&#x5148;&#x7EA7;&#x63D0;&#x5230; <code>devicemapper</code> &#x4E4B;&#x4E0A;&#xFF08;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#x7684;&#x4F9D;&#x65E7;&#x662F; <code>aufs</code>&#xFF09;</p><h2 id="docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><a href="#docker-exec-t-&#x81EA;&#x52A8;&#x6DFB;&#x52A0;-TERM-&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="headerlink" title="docker exec -t &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;"></a><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF; <a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26461" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26461</a></p><p>&#x5BF9;&#x4E8E;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528; <code>vi</code>&#x3001;<code>htop</code> &#x4E4B;&#x7C7B;&#x5DE5;&#x5177;&#x7684;&#x4EBA;&#x6765;&#x8BF4;&#x662F;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x7684;&#x3002;&#x4E4B;&#x524D;&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5B9A;&#x4E49; <code>TERM</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x9700;&#x8981;&#x7EC8;&#x7AEF;&#x9875;&#x9762;&#x5E03;&#x5C40;&#x7684;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x53EF;&#x80FD;&#x4F1A;&#x4E0D;&#x6B63;&#x5E38;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ htop</span><br><span class="line">Error opening terminal: unknown.</span><br></pre></td></tr></table></figure><p>&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x4E3A; <code>docker exec -t</code> &#x9009;&#x9879;&#x6DFB;&#x52A0;&#x4E86;&#x7EE7;&#x627F;&#x81EA;&#x5F53;&#x524D;&#x7684; <code>TERM</code> &#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;&#x7C7B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x3002;</p><h2 id="windows-nei-zhi-de-yun-xing-windows-cheng-xu-de-docker-on-windows-de-gai-jin"><a href="#Windows-&#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C;-Windows-&#x7A0B;&#x5E8F;&#x7684;-Docker-on-Windows-&#x7684;&#x6539;&#x8FDB;" class="headerlink" title="Windows &#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x7684; Docker on Windows &#x7684;&#x6539;&#x8FDB;"></a>Windows &#x5185;&#x7F6E;&#x7684;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x7684; Docker on Windows &#x7684;&#x6539;&#x8FDB; <a href="#windows-nei-zhi-de-yun-xing-windows-cheng-xu-de-docker-on-windows-de-gai-jin" class="header-anchor">#</a></h2><ul><li><a href="https://github.com/docker/docker/pull/28415" target="_blank" rel="noopener">#28415</a>&#xFF1A;&#x652F;&#x6301; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>USER</code> &#x4E86;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/25736" target="_blank" rel="noopener">#25736</a>&#xFF1A;&#x652F;&#x6301; <code>syslog</code> &#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/28189" target="_blank" rel="noopener">#28189</a>&#xFF1A;&#x652F;&#x6301; <code>fluentd</code> &#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/28182" target="_blank" rel="noopener">#28182</a>&#xFF1A;&#x7EC8;&#x4E8E;&#x652F;&#x6301; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E86;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/22208" target="_blank" rel="noopener">#22208</a>&#xFF1A;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x6307;&#x5B9A;&#x9759;&#x6001;IP&#x4E86;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/23391" target="_blank" rel="noopener">#23391</a>&#xFF1A;&#x652F;&#x6301;&#x5B58;&#x50A8;&#x5C42;&#x9A71;&#x52A8;&#x7684;&#x78C1;&#x76D8;&#x914D;&#x989D;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/25737" target="_blank" rel="noopener">#25737</a>&#xFF1A;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528; <code>docker stats</code> &#x4E86;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/25891" target="_blank" rel="noopener">#25891</a>&#xFF1A;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528; <code>docker top</code> &#x4E86;&#xFF1B;</li><li><a href="https://github.com/docker/docker/pull/27838" target="_blank" rel="noopener">#27838</a>&#xFF1A;Windows &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528; Swarm Mode &#x8DD1;&#x96C6;&#x7FA4;&#x4E86;&#xFF1B;</li></ul><h1 id="swarm-mode"><a href="#Swarm-Mode" class="headerlink" title="Swarm Mode"></a>Swarm Mode <a href="#swarm-mode" class="header-anchor">#</a></h1><h2 id="zheng-shi-zhi-chi-docker-stack"><a href="#&#x6B63;&#x5F0F;&#x652F;&#x6301;-docker-stack" class="headerlink" title="&#x6B63;&#x5F0F;&#x652F;&#x6301; docker stack"></a>&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code> <a href="#zheng-shi-zhi-chi-docker-stack" class="header-anchor">#</a></h2><p>1.12 &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F; Swarm Mode&#x3002;&#x7531;&#x4E8E;&#x57FA;&#x7840;&#x7406;&#x5FF5;&#x53D8;&#x5316;&#x5F88;&#x5927;&#xFF0C;&#x56E0;&#x6B64;&#x5148;&#x884C;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x57FA;&#x672C;&#x7684;&#x670D;&#x52A1;(<code>service</code>)&#xFF0C;&#x4F46;&#x662F;&#x9488;&#x5BF9;&#x5E94;&#x7528;/&#x670D;&#x52A1;&#x6808;(<code>stack</code>)&#x6CA1;&#x6709;&#x6210;&#x719F;&#xFF0C;&#x53EA;&#x662F;&#x8BD5;&#x884C;&#x4F7F;&#x7528; <code>.DAB</code> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x3002;&#x4F46;&#x662F; <code>DAB</code> &#x662F; <code>JSON</code> &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x64B0;&#x5199;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#x3002;&#x76F8;&#x5BF9;&#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x7684; <code>docker-compose.yml</code> &#x5374;&#x65E0;&#x6CD5;&#x5728; <code>docker stack</code> &#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;&#x53EA;&#x53EF;&#x4EE5;&#x7528; <code>docker-compose bundle</code> &#x547D;&#x4EE4;&#x5C06; <code>docker-compose.yml</code> &#x8F6C;&#x6362;&#x4E3A; <code>.dab</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x62FF;&#x5230;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x7528;&#x4E0D;&#x4E86;&#x3002;</p><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#xFF08;<a href="https://github.com/docker/docker/pull/27998" target="_blank" rel="noopener">#27998</a>&#xFF09;&#xFF0C;&#x5927;&#x5927;&#x65B9;&#x4FBF;&#x4E86;&#x4E60;&#x60EF;&#x4E86; <code>docker compose</code> &#x7684;&#x7528;&#x6237;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x7406;&#x5FF5;&#x7684;&#x6F14;&#x5316;&#xFF0C;&#x539F;&#x6709;&#x7684; <code>docker-compose.yml</code> <code>v2</code> &#x683C;&#x5F0F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>v3</code> &#x683C;&#x5F0F;&#x3002;</p><p>&#x5E78;&#x8FD0;&#x7684;&#x662F; <code>v3</code> &#x548C; <code>v2</code> &#x683C;&#x5F0F;&#x5DEE;&#x8DDD;&#x4E0D;&#x5927;&#x3002;</p><ul><li>&#x5C06;&#x4E00;&#x4E9B;&#x8FC7;&#x65F6;&#x7684;&#x4E1C;&#x897F;&#x53BB;&#x6389;&#xFF0C;&#x5982; <code>volumes_from</code>&#xFF0C;&#x9700;&#x8981;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7528;&#x547D;&#x540D;&#x5377;&#xFF1B;</li><li>&#x53BB;&#x9664; <code>volume_driver</code>&#xFF0C;&#x8FD9;&#x79CD;&#x670D;&#x52A1;&#x5168;&#x5C40;&#x7684;&#x4E1C;&#x897F;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#xFF0C;&#x76F4;&#x63A5;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x5377;&#x4F7F;&#x7528; <code>volume</code> &#x952E;&#x4E0B;&#x7684; <code>driver</code> &#x5373;&#x53EF;&#xFF1B;</li><li>&#x5C06; <code>cpu_shares</code>, <code>cpu_quota</code>, <code>cpuset</code>, <code>mem_limit</code>, <code>memswap_limit</code> &#x79FB;&#x5230; <code>deploy</code> &#x4E0B;&#x7684; <code>resources</code> &#x4E0B;&#x8FDB;&#x884C;&#x7BA1;&#x63A7;&#xFF0C;&#x6BD5;&#x7ADF;&#x8FD9;&#x662F;&#x90E8;&#x7F72;&#x8D44;&#x6E90;&#x63A7;&#x5236;&#x7684;&#x90E8;&#x5206;&#x3002;</li></ul><p>&#x5177;&#x4F53;&#x5DEE;&#x5F02;&#x53EF;&#x4EE5;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#upgrading" target="_blank" rel="noopener">https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#upgrading</a></p><p>&#x7528;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">&#x6211;&#x7684; LNMP &#x7684;&#x793A;&#x4F8B;</a>&#x4E3A;&#x4F8B;&#x5B50;&#xFF0C;&#x663E;&#x7136;&#x7B2C;&#x4E00;&#x884C;&#x7684; <code>version: &apos;2&apos;</code> &#x9700;&#x8981;&#x6362;&#x6210; <code>version: &apos;3&apos;</code> &#x1F60F;&#x3002;</p><p>&#x7136;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x91CC;&#x7684; <code>build</code> &#x663E;&#x7136;&#x7528;&#x4E0D;&#x4E86;&#x4E86;&#x3002;&#x90A3;&#x4E48;&#x6539;&#x6210; <code>v3</code> &#x683C;&#x5F0F;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x662F;&#xFF1A;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&apos;3&apos;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">nginx:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&quot;twang2218/lnmp-nginx:v1.2&quot;</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">        <span class="attr">deploy:</span></span><br><span class="line">            <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">    <span class="attr">php:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&quot;twang2218/lnmp-php:v1.2&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">MYSQL_PASSWORD:</span> <span class="string">Passw0rd</span></span><br><span class="line">        <span class="attr">deploy:</span></span><br><span class="line">            <span class="attr">replicas:</span> <span class="number">4</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">mysql:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mysql-data:/var/lib/mysql</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">TZ:</span> <span class="string">&apos;Asia/Shanghai&apos;</span></span><br><span class="line">            <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">Passw0rd</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">[&apos;mysqld&apos;,</span> <span class="string">&apos;--character-set-server=utf8&apos;</span><span class="string">]</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">mysql-data:</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">backend:</span></span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x5728; <code>nginx</code> &#x548C; <code>php</code> &#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x7684; <code>deploy</code> &#x914D;&#x7F6E;&#xFF1A;</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">replicas:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F; <code>v3</code> &#x65B0;&#x589E;&#x7684;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x6307;&#x5B9A;&#x4E86;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x7684;&#x526F;&#x672C;&#x6570;&#x91CF;&#x3002;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#xFF0C;&#x5177;&#x4F53;&#x8BF7;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;:</p><p><a href="https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#deploy" target="_blank" rel="noopener">https://github.com/docker/docker.github.io/blob/vnext-compose/compose/compose-file.md#deploy</a></p><p>&#x5982;&#x679C;&#x5728; swarm &#x73AF;&#x5883;&#x90E8;&#x7F72;&#x8BE5;&#x670D;&#x52A1;&#x6808;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker stack deploy --compose-file docker-compose.yml lnmp</span><br><span class="line">Creating network lnmp_frontend</span><br><span class="line">Creating network lnmp_backend</span><br><span class="line">Creating network lnmp_default</span><br><span class="line">Creating service lnmp_mysql</span><br><span class="line">Creating service lnmp_nginx</span><br><span class="line">Creating service lnmp_php</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7528; <code>docker stack ls</code> &#x6216; <code>docker stack ps</code> &#x6765;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x6808;&#x72B6;&#x6001;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ docker stack ls</span><br><span class="line">NAME  SERVICES</span><br><span class="line">lnmp  3</span><br><span class="line">$ docker stack ps lnmp -f <span class="string">&apos;desired-state=Running&apos;</span></span><br><span class="line">ID            NAME          IMAGE                      NODE  DESIRED STATE  CURRENT STATE               ERROR  PORTS</span><br><span class="line">1x6qiieam21p  lnmp_mysql.1  mysql:5.7                  d1    Running        Running 52 seconds ago</span><br><span class="line">7irrc6v9xnbo  lnmp_nginx.1  twang2218/lnmp-nginx:v1.2  d1    Running        Running about a minute ago</span><br><span class="line">2bq2kjm6xacn  lnmp_php.1    twang2218/lnmp-php:v1.2    d1    Running        Running about a minute ago</span><br><span class="line">edp0ed1k6u9w  lnmp_nginx.2  twang2218/lnmp-nginx:v1.2  d1    Running        Running 58 seconds ago</span><br><span class="line">1hlmkgtpf1pa  lnmp_php.2    twang2218/lnmp-php:v1.2    d2    Running        Running about a minute ago</span><br><span class="line">0xjjyu3tyewp  lnmp_php.3    twang2218/lnmp-php:v1.2    d2    Running        Running about a minute ago</span><br><span class="line">e9lgn25kyepx  lnmp_php.4    twang2218/lnmp-php:v1.2    d1    Running        Running about a minute ago</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x7531;&#x4E8E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684; <code>replicas</code> &#x9879;&#x76EE;&#xFF0C;&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x4E86; 2 &#x4E2A; <code>nginx</code> &#x670D;&#x52A1;&#x5BB9;&#x5668;&#x526F;&#x672C;&#xFF0C;&#x548C; 4 &#x4E2A; <code>php</code> &#x670D;&#x52A1;&#x5BB9;&#x5668;&#x526F;&#x672C;&#x3002;</p><p>&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F; <code>ingress</code> &#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x6620;&#x5C04;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6765;&#x67E5;&#x770B;&#x9875;&#x9762;&#xFF0C;&#x4EAB;&#x53D7;&#x4E8C;&#x4EE3; Swarm &#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x3002;</p><p>&#x5220;&#x6389; <code>stack</code>&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7B80;&#x5355;&#x5730; <code>docker stack rm lnmp</code> &#x5373;&#x53EF;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x547D;&#x540D;&#x5377;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664; (<a href="https://github.com/docker/docker/issues/29158" target="_blank" rel="noopener">#29158</a>)&#xFF0C;&#x5982;&#x9700;&#x5220;&#x9664;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7684;&#x53BB;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x8282;&#x70B9;&#x53BB; <code>docker volume rm</code> &#x5377;&#x3002;</p><h2 id="tian-jia-secret-guan-li"><a href="#&#x6DFB;&#x52A0;-secret-&#x7BA1;&#x7406;" class="headerlink" title="&#x6DFB;&#x52A0; secret &#x7BA1;&#x7406;"></a>&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406; <a href="#tian-jia-secret-guan-li" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27794" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27794</a></p><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#x7BA1;&#x7406;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7B49;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker secret --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:docker secret COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker secrets</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">     --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"> create      Create a secret using stdin as content</span><br><span class="line"> inspect     Inspect a secret</span><br><span class="line"> ls          List secrets</span><br><span class="line"> rm          Remove a secret</span><br><span class="line"></span><br><span class="line">Run <span class="string">&apos;docker secret COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure><p><code>docker secret create</code> &#x4ECE;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x5165;&#x6307;&#x5B9A;&#x540D;&#x79F0;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;MySuperSecretPassword&quot;</span> | docker secret create mysql_password</span><br></pre></td></tr></table></figure><p>&#x5728;&#x5C06;&#x6765;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--secret</code> &#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x54EA;&#x4E9B; <code>secret</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  docker service create --name privateweb --secret mysql_password nginx</span><br></pre></td></tr></table></figure><p>&#x6240;&#x6307;&#x5B9A;&#x7684; <code>secret</code> &#x4F1A;&#x4EE5;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x4E8E; <code>/var/run/secrets/</code> &#x76EE;&#x5F55;&#x4E0B;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@d5cec6381df8:/<span class="comment"># ls -al /var/run/secrets/</span></span><br><span class="line">total 8</span><br><span class="line">drwxrwxrwt 2 root root   60 Dec  6 03:16 .</span><br><span class="line">drwxr-xr-x 4 root root 4096 Dec  6 03:16 ..</span><br><span class="line">-r--r--r-- 1 root root   22 Dec  6 03:16 mysql_password</span><br></pre></td></tr></table></figure><p><code>secret</code> &#x7684;&#x6743;&#x9650;&#x662F; <code>444</code> &#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x975E; <code>root</code> &#x7528;&#x6237;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5176;&#x5185;&#x5BB9;&#xFF0C;&#x8BFB;&#x53D6;&#x6240;&#x9700;&#x7684;&#x5BC6;&#x7801;&#x6216;&#x8005;&#x5BC6;&#x94A5;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x975E; root &#x7528;&#x6237;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x5F88;&#x91CD;&#x8981;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@d5cec6381df8:/<span class="comment"># cat /var/run/secrets/mysql_password</span></span><br><span class="line">MySuperSecretPassword</span><br></pre></td></tr></table></figure><h2 id="tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi"><a href="#&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;"></a>&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301; <a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27279" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27279</a></p><p>Docker 1.10 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x7136;&#x540E;&#x5728; 1.11 &#x8FDB;&#x4E00;&#x6B65;&#x652F;&#x6301;&#x4E86; DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;1.12 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; VIP &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#x800C; 1.12 &#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86; <code>HEALTHCHECK</code> &#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x80FD;&#x529B;&#x3002;&#x4F46;&#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x8FD9;&#x4E24;&#x4E2A;&#x529F;&#x80FD;&#x5728; 1.12 &#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#xFF0C;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5C31;&#x5DF2;&#x7ECF;&#x5C06;&#x6D41;&#x91CF;&#x5F00;&#x59CB;&#x5BFC;&#x6D41;&#x7ED9;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x90E8;&#x5206;&#x670D;&#x52A1;&#x4F1A;&#x8BBF;&#x95EE;&#x5931;&#x8D25;&#x3002;</p><p>&#x5728; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5229;&#x7528; <code>Dockerfile</code> &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x529F;&#x80FD;&#xFF0C;&#x6765;&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5C1A;&#x672A;&#x5904;&#x4E8E;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5C06;&#x4E0D;&#x4F1A;&#x628A;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x7ED9;&#x8FD9;&#x4E2A;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5230;&#x5BB9;&#x5668;&#x786E;&#x5B9E;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x518D;&#x66F4;&#x65B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p><h2 id="tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng"><a href="#&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;" class="headerlink" title="&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;"></a>&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD; <a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/26421" target="_blank" rel="noopener">https://github.com/docker/docker/pull/26421</a></p><p>&#x5F53; Docker 1.12 &#x63D0;&#x4F9B;&#x4E86; Swarm Mode &#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x540E;&#xFF0C;&#x5927;&#x5BB6;&#x90FD;&#x5F88;&#x5174;&#x594B;&#xFF0C;&#x5185;&#x7F6E;&#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x8BA9;&#x6301;&#x7EED;&#x53D1;&#x5E03;&#x53D8;&#x5F97;&#x66F4;&#x4E3A;&#x8F7B;&#x677E;&#x3002;1.12 &#x63D0;&#x4F9B;&#x4E86;&#x5F53;&#x670D;&#x52A1;&#x5347;&#x7EA7;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x8D85;&#x8FC7;&#x91CD;&#x8BD5;&#x6B21;&#x6570;&#x5219;&#x505C;&#x6B62;&#x5347;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x65B9;&#x4FBF;&#xFF0C;&#x907F;&#x514D;&#x8BA9;&#x9519;&#x8BEF;&#x7684;&#x5E94;&#x7528;&#x66FF;&#x4EE3;&#x73B0;&#x6709;&#x6B63;&#x5E38;&#x670D;&#x52A1;&#x3002;&#x4F46;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x867D;&#x7136;&#x63D0;&#x51FA;&#xFF0C;&#x4F46;&#x5E76;&#x672A;&#x80FD;&#x5728; 1.12 &#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x662F;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x540E;&#xFF0C;&#x5982;&#x4F55;&#x8BA9;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1F;&#x96BE;&#x9053;&#x662F;&#x518D;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x66F4;&#x65B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x66F4;&#x65B0;&#x7684;&#x662F;&#x65E7;&#x7248;&#x672C;&#x4E48;&#xFF1F;&#x90A3;&#x4E48;&#x65E7;&#x7248;&#x672C;&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#xFF1F;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5728;&#x81EA;&#x52A8;&#x5316;&#x5904;&#x7406;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x5728; 1.13 &#x91CC;&#xFF0C;&#x5F00;&#x59CB;&#x652F;&#x6301; <code>docker service update --rollback</code> &#x529F;&#x80FD;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7531;&#x7BA1;&#x7406;&#x5458;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x5C06;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker service update \</span><br><span class="line">  --rollback \</span><br><span class="line">  --update-delay 0s \</span><br><span class="line">  my_web</span><br></pre></td></tr></table></figure><h2 id="bu-chong-liao-yi-xie-docker-service-create-suo-que-shi-de-can-shu"><a href="#&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B;-docker-service-create-&#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570;" class="headerlink" title="&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B; docker service create &#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570;"></a>&#x8865;&#x5145;&#x4E86;&#x4E00;&#x4E9B; <code>docker service create</code> &#x6240;&#x7F3A;&#x5931;&#x7684;&#x53C2;&#x6570; <a href="#bu-chong-liao-yi-xie-docker-service-create-suo-que-shi-de-can-shu" class="header-anchor">#</a></h2><p>&#x4ECE; <code>Docker 1.12</code> &#x53D1;&#x5E03; <code>Swarm Mode</code> &#x5F00;&#x59CB;&#xFF0C;<code>docker service create</code> &#x5728;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x6210;&#x4E3A;&#x4E86;&#x65B0;&#x7684; <code>docker run</code>&#xFF0C;&#x4F46;&#x662F;&#x76F8;&#x5BF9;&#x4E8E; <code>docker run</code> &#x7684;&#x5B9A;&#x5236;&#x53C2;&#x6570;&#x800C;&#x8A00;&#xFF0C;<code>docker service create</code> &#x8981;&#x663E;&#x5F97;&#x5355;&#x8584;&#x7684;&#x591A;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x7531;&#x4E8E; <code>docker service create</code> &#x662F;&#x9762;&#x5411;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x53EF;&#x80FD;&#x628A; <code>docker run</code> &#x4E0A;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&#x90FD;&#x7167;&#x642C;&#x8FC7;&#x6765;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x4E00;&#x7504;&#x522B;&#xFF0C;&#x6709;&#x7684;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B9E;&#x73B0;&#xFF0C;&#x6709;&#x7684;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x3002;&#x5728; <code>Docker 1.13</code>&#xFF0C;&#x4F34;&#x968F;&#x7740;&#x65B0;&#x589E;&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x8FD8;&#x6709;&#x4E0D;&#x5C11;&#x8FD9;&#x7C7B;&#x53C2;&#x6570;&#x4E5F;&#x88AB;&#x6DFB;&#x52A0;&#x56DE;&#x6765;&#x4E86;&#x3002;</p><ul><li><a href="https://github.com/docker/docker/pull/24844" target="_blank" rel="noopener">#24844</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--env-file</code></li><li><a href="https://github.com/docker/docker/pull/25317" target="_blank" rel="noopener">#25317</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--group</code></li><li><a href="https://github.com/docker/docker/pull/27369" target="_blank" rel="noopener">#27369</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--no-health-check</code>, <code>--health-*</code></li><li><a href="https://github.com/docker/docker/pull/27567" target="_blank" rel="noopener">#27567</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--dns</code>, <code>--dns-opt</code>, <code>--dns-search</code></li><li><a href="https://github.com/docker/docker/pull/27857" target="_blank" rel="noopener">#27857</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--hostname</code></li><li><a href="https://github.com/docker/docker/pull/28031" target="_blank" rel="noopener">#28031</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--host</code></li><li><a href="https://github.com/docker/docker/pull/28076" target="_blank" rel="noopener">#28076</a>&#xFF1A;&#x6DFB;&#x52A0; <code>--tty</code></li></ul><h2 id="tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi-shi-yan-gong-neng"><a href="#&#x6DFB;&#x52A0;&#x547D;&#x4EE4;-docker-service-logs-&#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;" class="headerlink" title="&#x6DFB;&#x52A0;&#x547D;&#x4EE4; docker service logs &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09;"></a>&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF08;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF09; <a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi-shi-yan-gong-neng" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/28089" target="_blank" rel="noopener">https://github.com/docker/docker/pull/28089</a></p><p>Swarm Mode &#x542F;&#x52A8;&#x670D;&#x52A1;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x5F88;&#x9EBB;&#x70E6;&#x3002;&#x5728; <code>docker-compose</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker-compose logs &lt;&#x670D;&#x52A1;&#x540D;&gt;</code> &#x5373;&#x53EF;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;&#x662F;&#x8DD1;&#x5728;&#x4E0D;&#x540C;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x3002;&#x4F46;&#x662F; <code>docker service</code> &#x4E0D;&#x652F;&#x6301; <code>logs</code> &#x547D;&#x4EE4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x73B0;&#x5728;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;&#x9700;&#x8981; <code>docker service ps</code> &#x67E5;&#x770B;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x5728;&#x54EA;&#x4E9B;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4E00;&#x4E2A;&#x4E2A;&#x8FDB;&#x53BB;&#x5148; <code>docker ps</code> &#x627E;&#x5230;&#x5BB9;&#x5668; ID&#xFF0C;&#x7136;&#x540E;&#x5728; <code>docker logs &lt;&#x5BB9;&#x5668;ID&gt;</code> &#x67E5;&#x770B;&#x5177;&#x4F53;&#x65E5;&#x5FD7;&#x3002;&#x975E;&#x5E38;&#x7E41;&#x7410;&#x3002;</p><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86; <code>docker service logs</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x4EE5;&#x8FBE;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x662F;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x5728;&#x542F;&#x7528;&#x8BD5;&#x9A8C;&#x6A21;&#x5F0F;&#x540E;(<code>dockerd --experimental</code>)&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;</p><h2 id="zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force"><a href="#&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879;-docker-service-update-force" class="headerlink" title="&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; docker service update --force"></a>&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code> <a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force" class="header-anchor">#</a></h2><p><a href="https://github.com/docker/docker/pull/27596" target="_blank" rel="noopener">https://github.com/docker/docker/pull/27596</a></p><p>&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528; <code>docker swarm mode</code> &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x78B0;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;&#xFF0C;&#x4FEE;&#x590D;&#x91CD;&#x542F;&#x8BE5;&#x8282;&#x70B9;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x539F;&#x6765;&#x8BE5;&#x8282;&#x70B9;&#x8DD1;&#x7684;&#x670D;&#x52A1;&#x88AB;&#x8C03;&#x5EA6;&#x5230;&#x4E86;&#x522B;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;swarm manager &#x7684;&#x4ECB;&#x5165;&#x4FDD;&#x8BC1;&#x4E86;&#x670D;&#x52A1;&#x7684;&#x53EF;&#x7528;&#x6027;&#x3002;&#x53EF;&#x662F;&#x8282;&#x70B9;&#x6062;&#x590D;&#x540E;&#xFF0C;&#x9664;&#x975E;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x4E2A;&#x522B;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E2A;&#x65B0;&#x4FEE;&#x590D;&#x7684;&#x8282;&#x70B9;&#x5C31;&#x4E00;&#x76F4;&#x95F2;&#x7740;&#xFF0C;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x6570;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5; swarm manager &#x4E0D;&#x4F1A;&#x4ECB;&#x5165;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;&#x96C6;&#x7FA4;&#x6269;&#x5BB9;&#x540E;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x65B0;&#x6269;&#x5BB9;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x6700;&#x521D;&#x90FD;&#x662F;&#x7A7A;&#x95F2;&#x7684;&#x3002;&#x5728; 1.12 &#x552F;&#x4E00;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6539;&#x70B9;&#x513F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#x4ECE;&#x800C;&#x89E6;&#x53D1; swarm &#x7684;&#x5347;&#x7EA7;&#x884C;&#x4E3A;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x597D;&#x529E;&#x6CD5;&#x3002;</p><p>&#x5728; 1.13&#xFF0C;&#x5F15;&#x5165;&#x4E86; <code>docker service update --force</code> &#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x5F3A;&#x5236;&#x89E6;&#x53D1;&#x518D;&#x53D1;&#x5E03;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F3A;&#x5236;&#x91CD;&#x65B0; <code>pull</code> &#x8BE5;&#x955C;&#x50CF;&#x3001;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#xFF0C;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x7531;&#x4E8E;&#x5404;&#x79CD;&#x7EF4;&#x62A4;&#x5BFC;&#x81F4;&#x7684;&#x96C6;&#x7FA4;&#x8D1F;&#x8F7D;&#x4E0D;&#x5E73;&#x8861;&#x7684;&#x60C5;&#x51B5;&#x5F97;&#x5230;&#x7F13;&#x89E3;&#xFF0C;&#x518D;&#x6B21;&#x5E73;&#x8861;&#x96C6;&#x7FA4;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x662F; <code>docker service update</code> &#x547D;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x9075;&#x5FAA;&#x6240;&#x6307;&#x5B9A;&#x7684; <code>--update-parallelism</code> &#x548C; <code>--update-delay</code> &#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x3002;</p><h1 id="fei-qi"><a href="#&#x5E9F;&#x5F03;" class="headerlink" title="&#x5E9F;&#x5F03;"></a>&#x5E9F;&#x5F03; <a href="#fei-qi" class="header-anchor">#</a></h1><ul><li>&#x5E9F;&#x5F03; <code>docker daemon</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528; <code>dockerd</code> &#x53D6;&#x4EE3;&#x3002;&#x5176;&#x5B9E; 1.12 &#x5DF2;&#x7ECF;&#x6362;&#x4E86;</li><li>&#x79FB;&#x9664;&#x5BF9; Ubuntu 15.10&#x3001;Fedora 22 &#x7684;&#x652F;&#x6301;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x90FD; EOL &#x4E86;&#x3002;</li><li>&#x5E9F;&#x5F03; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>MAINTAINER</code> &#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x7528; <code>LABEL maintainer=&lt;...&gt;</code> &#x4EE3;&#x66FF;</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#qian-yan&quot;&gt;&amp;#x524D;&amp;#x8A00;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="blog" scheme="https://1x481n.github.io/blog.lab99.org/tags/blog/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记： Windows Server 和 Docker - John Starks</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-08-12-video-windows-server-and-docker.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-08-12-video-windows-server-and-docker.html</id>
    <published>2016-08-11T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.622Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#ji-ben-gai-nian">&#x57FA;&#x672C;&#x6982;&#x5FF5;</a><ul><li><a href="#shi-me-shi-docker-on-windows">&#x4EC0;&#x4E48;&#x662F; Docker on Windows</a></li><li><a href="#yan-shi">&#x6F14;&#x793A;</a></li><li><a href="#zen-me-zuo-dao-de">&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F;</a></li><li><a href="#gou-jia">&#x6784;&#x67B6;</a><ul><li><a href="#compute-service">Compute Service</a></li><li><a href="#windows-server-containers-gou-jia">Windows Server Containers &#x6784;&#x67B6;</a></li><li><a href="#windows-rong-qi-li-mian-bao-han-de-dong-xi">Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F;</a></li></ul></li><li><a href="#ji-chu-jing-xiang">&#x57FA;&#x7840;&#x955C;&#x50CF;</a></li></ul></li><li><a href="#windows-server-container-shi-xian-jia-gou">Windows Server Container &#x5B9E;&#x73B0;&#x67B6;&#x6784;</a><ul><li><a href="#ming-ming-kong-jian">&#x547D;&#x540D;&#x7A7A;&#x95F4;</a><ul><li><a href="#object-namespace">Object namespace</a></li></ul></li><li><a href="#wen-jian-xi-tong">&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li><li><a href="#zhu-ce-biao">&#x6CE8;&#x518C;&#x8868;</a></li></ul></li><li><a href="#hyper-v-rong-qi-jia-gou">Hyper-V &#x5BB9;&#x5668;&#x67B6;&#x6784;</a><ul><li><a href="#making-it-work">Making it work</a></li><li><a href="#cloning">Cloning</a></li></ul></li><li><a href="#wen-da">&#x95EE;&#x7B54;</a><ul><li><a href="#wei-ruan-zhe-chong-hyper-v-de-ji-zhu-shi-bu-shi-ke-yi-yong-lai-pao-linux">&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD; Hyper-V &#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1; Linux &#xFF1F;</a></li><li><a href="#ni-men-zhi-qian-ti-dao-de-compute-service-shi-you-liao-gong-kai-de-api-liao-me">&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684; Compute Service &#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684; API &#x4E86;&#x4E48;&#xFF1F;</a></li><li><a href="#wo-men-xu-yao-zai-windows-docker-zhong-shi-yong-overlay-network-lai-zhi-chi-swarm-ni-men-shi-me-shi-hou-neng-gou-zhi-chi-overlay-network">&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows Docker &#x4E2D;&#x4F7F;&#x7528; overlay network &#x6765;&#x652F;&#x6301; Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301; overlay network&#xFF1F;</a></li><li><a href="#docker-for-windows-he-ni-men-zhe-li-jie-shao-de-docker-on-windows-zhong-de-hyper-v-rong-qi-de-hua-cong-ji-zhu-ceng-mian-shang-you-shi-me-bu-tong"><code>Docker for Windows</code> &#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684; <code>Docker on Windows</code> &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668; &#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;</a></li><li><a href="#zai-di-yi-ban-zhong-ni-men-you-na-xie-docker-gong-neng-bu-zhi-chi">&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><code>DockerCon16</code></p><p>Windows Server &amp; Docker<br>(The Internals Behind Bringing Docker and Containers to Windows)<br>by John Starks &amp; Taylor Brown<br>Principal Leads in Windows, Microsoft</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/85nCF5S8Qok" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=85nCF5S8Qok" target="_blank" rel="noopener">https://www.youtube.com/watch?v=85nCF5S8Qok</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=v03145c99ec&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/v03145c99ec.html" target="_blank" rel="noopener">http://v.qq.com/x/page/v03145c99ec.html</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>Taylor Brown &#x662F;&#x5FAE;&#x8F6F; Windows &#x670D;&#x52A1;&#x5668;&#x90E8;&#x5206;&#x7684; Principal Leads Program Manager&#x3002;</p><p>&#x5DF2;&#x7ECF;&#x548C; Docker &#x56E2;&#x961F;&#x5408;&#x4F5C;&#x4E24;&#x5E74;&#x4E86;&#x3002;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x5FAE;&#x8F6F;&#x56E2;&#x961F;&#x98DE;&#x5230;Docker&#x603B;&#x90E8;&#xFF0C;&#x7136;&#x540E;&#x95EE;&#xFF0C;&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x8BA9;Docker &#x547D;&#x4EE4;&#x884C;&#x652F;&#x6301;&#x5FAE;&#x8F6F;&#x505A;&#x7684;&#x5BB9;&#x5668;API&#xFF1F;&#x5F53;&#x65F6;&#xFF0C;Solomon Hykes (CTO) &#x5728;&#x4F1A;&#x8BAE;&#x5BA4;&#x91CC;&#x5C31;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x662F;&#x5F00;&#x6E90;&#x7684;&#x5440;&#xFF0C;&#x4F60;&#x4EEC;&#x60F3;&#x505A;&#x4EC0;&#x4E48;&#x6539;&#x53D8;&#x7684;&#x8BDD;&#xFF0C;&#x81EA;&#x5DF1;&#x6539;&#x5457;&#x3002;&#x7136;&#x540E;&#x5FAE;&#x8F6F;&#x56E2;&#x961F;&#x4E00;&#x8138;&#x832B;&#x7136;&#x2026;&#x2026;&#x1F633; &#xFF08;<em>&#x663E;&#x7136;&#x8FD9;&#x5E2E;&#x4EBA;&#x5B8C;&#x5168;&#x4E0D;&#x7406;&#x89E3;&#x5F00;&#x6E90;&#x793E;&#x533A;&#x7684;&#x6982;&#x5FF5;</em>&#xFF09;&#x3002;&#x4E24;&#x5E74;&#x4E4B;&#x540E;&#xFF0C;&#x786E;&#x5B9E;&#x53D1;&#x73B0;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x5730;&#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x975E;&#x5E38;&#x6709;&#x8DA3;&#x5473;&#xFF0C;&#x5B8C;&#x6210;&#x4E86;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x3002;</p><p>John Starks &#x662F;&#x5FAE;&#x8F6F;&#x7684;&#x5BB9;&#x5668;&#x90E8;&#x5206;&#x7684;&#x4E3B;&#x8981;&#x6784;&#x67B6;&#x5E08;&#x4E4B;&#x4E00;&#x3002;</p><h1 id="ji-ben-gai-nian"><a href="#&#x57FA;&#x672C;&#x6982;&#x5FF5;" class="headerlink" title="&#x57FA;&#x672C;&#x6982;&#x5FF5;"></a>&#x57FA;&#x672C;&#x6982;&#x5FF5; <a href="#ji-ben-gai-nian" class="header-anchor">#</a></h1><h2 id="shi-me-shi-docker-on-windows"><a href="#&#x4EC0;&#x4E48;&#x662F;-Docker-on-Windows" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Docker on Windows"></a>&#x4EC0;&#x4E48;&#x662F; Docker on Windows <a href="#shi-me-shi-docker-on-windows" class="header-anchor">#</a></h2><p>&#x4E0D;&#x8981;&#x548C; <code>Docker for Windows</code> &#x5F04;&#x6DF7;&#x4E86;&#x3002;<code>Docker for Windows</code> &#x662F;&#x5728; Windows &#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Linux &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x91CC;&#x9762;&#x8DD1; Linux Docker&#x3002;</p><p>&#x800C; <code>Docker on Windows</code> &#x662F;&#x5C06; Docker &#x5F15;&#x64CE;&#x79FB;&#x690D;&#x5230; Windows&#xFF0C;&#x63D0;&#x4F9B; Docker API&#xFF0C; &#x76F4;&#x63A5;&#x5728; Windows &#x7CFB;&#x7EDF;&#x4E0A;&#x901A;&#x8FC7;&#x79FB;&#x690D;&#x540E;&#x7684; Docker Engine&#xFF0C;&#x6765;&#x8FD0;&#x884C;Windows&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x91CC;&#x9762;&#x8DD1;&#x7684;&#x662F; Windows &#x7A0B;&#x5E8F;&#xFF0C;&#x8FD0;&#x884C;&#x4E8E; Windows &#x5185;&#x6838;&#xFF08;&#x800C;&#x4E0D;&#x662F;Linux&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x4E8E;Linux&#x5185;&#x6838;&#xFF09;&#x3002;&#x7531;&#x4E8E;&#x4F7F;&#x7528; Docker API&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301; Compose, Swarm &#x7B49;&#x3002;</p><p><code>Docker on Windows</code> &#x4E0D;&#x662F;&#x5FAE;&#x8F6F;&#x7684; fork&#xFF0C;&#x800C;&#x662F;&#x5C31;&#x5728; GitHub &#x7684;<code>docker/docker</code> &#x7684; <code>master</code> &#x5206;&#x652F;&#x91CC;&#x3002;</p><p>&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x628A; <code>Docker on Windows</code> &#x96C6;&#x6210;&#x5230; <code>Docker for Windows</code> &#x4E2D;&#x53BB;&#x3002;</p><p>&#x79FB;&#x690D;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x5F88;&#x591A; Linux (<em>&#x5B58;&#x5728;&#x5F88;&#x591A;&#x5E74;&#x7684;</em>)&#x7279;&#x6027;&#x5728; Windows &#x4E0A;&#x90FD;&#x6CA1;&#x6709;&#x7C7B;&#x4F3C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x73B0;&#x6539; Windows &#x5185;&#x6838;&#x624D;&#x80FD;&#x7EE7;&#x7EED;&#x79FB;&#x690D;&#x3002;&#x6240;&#x4EE5;&#x8FC7;&#x53BB;&#x7684; Windows &#x65E0;&#x6CD5;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x6539;&#x4E86;&#x5185;&#x6838;&#x540E;&#x7684;&#x8FD8;&#x6CA1;&#x53D1;&#x5E03;&#x7684; Windows Server 2016 &#x4EE5;&#x53CA;&#x6700;&#x65B0;&#x7248;&#x7684; Windows 10&#x3002;</p><p>&#xFF08;<em>&#x6CE8;&#xFF1A;&#x975E;&#x5E38;&#x6000;&#x7591;&#x8FD9;&#x79CD;&#x4E34;&#x65F6;&#x6539;&#x7684;&#x4E1C;&#x897F;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;Linux &#x8FD9;&#x7C7B;&#x4E1C;&#x897F;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x8FD1;10&#x5E74;&#x4E86;&#xFF0C;&#x4E0D;&#x65AD;&#x5730;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#x548C;&#x5B8C;&#x5584;&#xFF0C;&#x73B0;&#x5728;&#x5F88;&#x7A33;&#x5B9A;&#x3002;&#x5FAE;&#x8F6F;&#x7684;&#x8FD9;&#x4E1C;&#x897F;&#xFF0C;&#x73B0;&#x6539;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x50CF; Linux &#x4E16;&#x754C;&#x90A3;&#x6837;&#x5E7F;&#x6CDB;&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6D4B;&#x8BD5;&#xFF0C;&#x5C31;&#x7B97;&#x5B9E;&#x73B0;&#x4E86;&#x4E5F;&#x4E0D;&#x5927;&#x9760;&#x8C31;&#x3002;</em>)</p><p>&#x4E00;&#x5B9A;&#x8981;&#x533A;&#x522B;&#x5F00;&#xFF0C;&#x8FD9;&#x662F;&#x5728; Windows &#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C; Windows &#x5BB9;&#x5668;&#xFF0C;&#x91CC;&#x9762;&#x8DD1;&#x7684;&#x662F; Windows &#x7A0B;&#x5E8F;&#x3002;&#x800C;&#x4E0D;&#x662F;&#x8FD0;&#x884C; Linux &#x5BB9;&#x5668;&#xFF0C;&#x91CC;&#x9762;&#x8DD1; Linux &#x7A0B;&#x5E8F;&#x3002;(<em>&#x6CE8;&#xFF1A;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4ECA;&#x5929; Docker Hub &#x4E0A;&#x7684;&#x5927;&#x90E8;&#x5206;&#x955C;&#x50CF;&#xFF0C;&#x5305;&#x62EC;&#x6240;&#x6709;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#xFF0C;&#x90FD;&#x7528;&#x4E0D;&#x4E86;&#x3002;&#x90A3;&#x4E9B;&#x90FD;&#x662F;&#x4E3A; Linux &#x5BB9;&#x5668;&#x51C6;&#x5907;&#x7684;&#x3002;</em>)</p><p>&#x5982;&#x679C;&#x73B0;&#x5728;&#x60F3;&#x5C1D;&#x8BD5;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x94FE;&#x63A5;&#xFF1A; <a href="http://aka.ms/containers" target="_blank" rel="noopener">http://aka.ms/containers</a></p><h2 id="yan-shi"><a href="#&#x6F14;&#x793A;" class="headerlink" title="&#x6F14;&#x793A;"></a>&#x6F14;&#x793A; <a href="#yan-shi" class="header-anchor">#</a></h2><p>&#x5728;&#x4E00;&#x4E2A; <code>CMD</code> &#x7A97;&#x53E3;&#x91CC;&#xFF0C;&#x76F4;&#x63A5;&#x7528; <code>dockerd</code> &#x547D;&#x4EE4;&#x8D77;&#x4E86;&#x4E00;&#x4E2A; Docker Engine&#x3002;</p><p>&#x5728;&#x53E6;&#x4E00;&#x4E2A; <code>CMD</code> &#x7A97;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982; <code>docker images</code> &#x4E4B;&#x7C7B;&#x7684;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x6CE8;&#x610F;&#x89C6;&#x9891;&#x91CC;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x2026;&#x2026;&#x1F605;</em>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm demo cmd /c <span class="built_in">echo</span> Hello, DockerCon1</span><br></pre></td></tr></table></figure><p>&#x2026;&#x2026;&#x7B49;&#x5F85;&#x4E86;&#x5927;&#x7EA6;3&#x79D2;&#x591A;&#x540E;&#xFF0C;&#x7EC8;&#x4E8E;&#x8F93;&#x51FA;&#x4E86; <code>Hello, DockerCon1</code>&#x2026;&#x2026;<em>&#x8BF4;&#x597D;&#x7684;&#x79D2;&#x8D77;&#x5462;&#xFF1F;</em></p><h2 id="zen-me-zuo-dao-de"><a href="#&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F;"></a>&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F; <a href="#zen-me-zuo-dao-de" class="header-anchor">#</a></h2><p>&#x6539;&#x5457;&#x3002;</p><ul><li>&#x5728; Windows &#x7CFB;&#x7EDF;&#x5C42;&#x9762;&#xFF0C;&#x589E;&#x52A0;namespace, &#x589E;&#x52A0; Resource Controls(&#x6A21;&#x62DF; cgroups&#xFF09;&#xFF0C;&#x589E;&#x52A0; Union FS&#x3002;</li><li>&#x6539;&#x9020; Docker &#x672C;&#x8EAB;&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x9ED8;&#x8BA4; *nix &#x7684;&#x4E1C;&#x897F;&#x901A;&#x7528;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;fork, console, network &#x63D2;&#x4EF6;&#x7B49;&#x7B49;</li><li>&#x6539;&#x9020; Windows &#x4EE5;&#x9002;&#x5E94;&#x5BB9;&#x5668;&#x3002;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5FAE;&#x8F6F;&#x8FD9;&#x5E2E;&#x8D27;&#x6253;&#x7B97;&#x91CD;&#x590D;&#x9020;&#x8F6E;&#x5B50;&#xFF0C;&#x60F3;&#x6309;&#x81EA;&#x5DF1;&#x7684;&#x601D;&#x8DEF;&#x8BBE;&#x8BA1;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#xFF0C;&#x7ED3;&#x679C;&#x78B0;&#x4E86;&#x5F88;&#x591A;&#x9489;&#x5B50;&#x540E;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x505A;&#x6CD5;&#x8C8C;&#x4F3C;&#x4E0D;&#x5927;&#x5BF9;&#x2026;&#x2026;&#x548C;Docker &#x7684;&#x4EA4;&#x6D41;&#x4E2D;&#xFF0C;&#x9010;&#x6B65;&#x7684;&#x53D1;&#x73B0;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4FEE;&#x6B63;&#x81EA;&#x5DF1;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x8DEF;&#x3002;</li></ul><h2 id="gou-jia"><a href="#&#x6784;&#x67B6;" class="headerlink" title="&#x6784;&#x67B6;"></a>&#x6784;&#x67B6; <a href="#gou-jia" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E; Linux &#x800C;&#x8A00;&#xFF0C;&#x6784;&#x67B6;&#x4E0A;&#x4ECE;&#x4E0B;&#x5F80;&#x4E0A;&#x662F;&#xFF0C; Linux &#x5185;&#x6838;&#x4E0A;&#xFF0C;&#x8FD0;&#x884C; <code>containerd</code> =&gt; <code>runC</code> =&gt; <code>libcontainerd</code> =&gt; <code>Docker Engine</code> =&gt; <code>REST API</code></p><p>&#x800C; Windows &#x4ECE; <code>libcontainerd</code> &#x5F80;&#x4E0A;&#x6784;&#x67B6;&#x4E0A;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x4E3B;&#x8981;&#x53D8;&#x5316;&#x5728;&#x4E0B;&#x5C42;&#x3002;&#x5185;&#x6838;&#x652F;&#x6301;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E; <code>cgroups</code>, <code>namespace</code>, <code>Union FS</code> &#x4E4B;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x5176;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>Compute Service</code> &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x8BE5;&#x670D;&#x52A1;&#x66FF;&#x4EE3; <code>containerd</code> &#x548C; <code>runc</code> &#x6765;&#x7ED9; <code>libcontinerd</code> &#x63D0;&#x4F9B;&#x652F;&#x6301;&#x3002;</p><h3 id="compute-service"><a href="#Compute-Service" class="headerlink" title="Compute Service"></a>Compute Service <a href="#compute-service" class="header-anchor">#</a></h3><p>&#x7531;&#x4E8E;&#x73B0;&#x5728;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x8FD9;&#x4E9B;&#x65B0;&#x52A0;&#x5165;&#x7684;&#x529F;&#x80FD;&#x8FD8;&#x5904;&#x4E8E;&#x5FEB;&#x901F;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#xFF0C;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x63D0;&#x4F9B;&#x7A33;&#x5B9A;&#x7684;&#x5E95;&#x5C42; API&#xFF0C;&#x6240;&#x4EE5;&#x52A0;&#x5165;&#x4E00;&#x5C42;&#x66F4;&#x9AD8;&#x5C42;&#x9762;&#x7684; API&#xFF0C;&#x7ED9;&#x5BB9;&#x5668;&#xFF0C;&#x65B9;&#x4FBF;&#x5BB9;&#x5668;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x91CC;&#x7684; <code>Compute Service</code> &#x53EF;&#x4EE5;&#x5927;&#x81F4;&#x7406;&#x89E3;&#x4E3A; <code>containerd</code> on Windows&#x3002;</p><p>&#x8D1F;&#x8D23;&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#xFF0C;&#x8D77;&#x3001;&#x505C;&#x3001;&#x91CD;&#x542F;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x52A1;&#x3002;&#x5C06;&#x5E95;&#x5C42;&#x7684;&#x7EC6;&#x8282;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x3002;</p><p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x6709; Compute Service &#x7684; C#, Go &#x8BED;&#x8A00;&#x5C01;&#x88C5;&#x7684;&#x8C03;&#x7528;&#x5E93;&#x4E86;&#x3002;</p><h3 id="windows-server-containers-gou-jia"><a href="#Windows-Server-Containers-&#x6784;&#x67B6;" class="headerlink" title="Windows Server Containers &#x6784;&#x67B6;"></a>Windows Server Containers &#x6784;&#x67B6; <a href="#windows-server-containers-gou-jia" class="header-anchor">#</a></h3><p>&#x548C; Linux &#x4E0A;&#x4E00;&#x6837;&#xFF0C;&#x5BB9;&#x5668;&#x548C;&#x5BBF;&#x4E3B;&#x7CFB;&#x7EDF;&#x5171;&#x4EAB;&#x5185;&#x6838;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x91CC;&#x662F;&#x5171;&#x4EAB; Windows &#x5185;&#x6838;&#x3002;</p><p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#x89C6;&#x9891;&#x4E2D;&#x7684;&#x67B6;&#x6784;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x548C; Linux &#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x7406;&#x5FF5;&#x4E0D;&#x540C;&#x3002;Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#xFF0C;&#x5305;&#x62EC;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x90A3;&#x4E00;&#x7FA4;&#x8FDB;&#x7A0B;&#xFF0C;&#x4EE5;&#x53CA;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x662F; Linux &#x6240;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x3002;</p><h3 id="windows-rong-qi-li-mian-bao-han-de-dong-xi"><a href="#Windows-&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F;" class="headerlink" title="Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F;"></a>Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F; <a href="#windows-rong-qi-li-mian-bao-han-de-dong-xi" class="header-anchor">#</a></h3><p>Linux &#x4E16;&#x754C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x8FDB;&#x7A0B;&#x76F4;&#x63A5;&#x53D1; <code>syscall</code>&#xFF0C;&#x5185;&#x6838;&#x5E2E;&#x4F60;&#x8C03;&#x5EA6;&#x505A;&#x4E8B;&#x60C5;&#x3002;</p><p>&#x800C; Windows &#x7684;&#x67B6;&#x6784;&#x8981;&#x81C3;&#x80BF;&#x7684;&#x591A;&#x3002;Windows &#x5E76;&#x4E0D;&#x66B4;&#x9732;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x7528;&#x4E00;&#x7FA4; DLL &#xFF08;&#x6BD4;&#x5982; <code>kernel32.dll</code> &#x7B49;) &#x5C06;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x5C01;&#x88C5;&#x8D77;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x63D0;&#x4F9B;&#x4E00;&#x7EC4; Windows API &#x7ED9;&#x5E94;&#x7528;&#x8C03;&#x7528;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5728; Windows &#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x4E00;&#x7FA4; DLL &#x670D;&#x52A1;&#xFF0C;&#x7701;&#x4E0D;&#x6389;&#x2026;&#x2026;</p><p>&#x540C;&#x6837;&#xFF0C;Windows &#x8981;&#x8DD1;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF0C;&#x6709;&#x592A;&#x591A;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x7684;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x5373;&#x4F7F;&#x5E94;&#x7528;&#x611F;&#x89C9;&#x4E0D;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x95F4;&#x4F9D;&#x8D56;&#x7684;RPC&#x90FD;&#x88AB; Win32 API &#x6240;&#x63A9;&#x76D6;&#x4E86;&#xFF0C;Windows &#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7D27;&#x8026;&#x5408;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5BFC;&#x81F4;&#x8FD9;&#x4E9B;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x670D;&#x52A1;&#x4E5F;&#x7701;&#x4E0D;&#x6389;&#x3002;&#x5373;&#x4F7F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x8DD1;&#x8FD9;&#x4E48;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x8DD1;&#x8D77;&#x6765;&#xFF0C;&#x5426;&#x5219;&#x5373;&#x4F7F;&#x6700;&#x7B80;&#x5355;&#x7684; DNS &#x67E5;&#x8BE2;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x4E0D;&#x5B58;&#x5728;&#x800C;&#x9519;&#x8BEF;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5728; Windows &#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x50CF; Linux &#x90A3;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x60F3;&#x7684;&#x53EA;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x5F88;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x505A;&#x4E8B;&#x60C5;&#x3002;&#x4F60;&#x5FC5;&#x987B;&#x628A;&#x8FD9;&#x4E00;&#x5927;&#x5806;&#x4E1C;&#x897F;&#x6254;&#x5230;&#x5BB9;&#x5668;&#x91CC;&#xFF0C;&#x4E00;&#x5927;&#x5806;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x8DD1;&#x8D77;&#x6765;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x3002;</p><p>&#x6BCF;&#x6B21;&#x542F;&#x52A8; Windows &#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x8DDF;&#x542F;&#x52A8;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#x4E00;&#x6837;&#xFF0C;&#x5148;&#x542F;&#x52A8; <code>smss</code> &#xFF08;<em>&#x76F8;&#x5F53;&#x4E8E; Linux/Unix &#x4E16;&#x754C;&#x7684;<code>init</code>&#x2026;&#x2026;&#x1F613;</em>)&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x542F;&#x52A8;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#xFF0C;&#x6700;&#x540E;&#x624D;&#x662F;&#x8C03;&#x7528;&#x4F60;&#x8BA9;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5728; Windows &#x4E2D;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709; <code>FROM scratch</code> &#x8FD9;&#x4E1C;&#x897F;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x5FC5;&#x987B;&#x5728;&#x91CC;&#x9762;&#x51C6;&#x5907;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x6240;&#x6709;&#x8FD9;&#x4E00;&#x5927;&#x7FA4;&#x4E1C;&#x897F;&#x3002;</p><p><em>&#x6CE8;&#xFF1A;&#x5F88;&#x591A;&#x4EBA;&#x9519;&#x8BEF;&#x7684;&#x628A; Docker &#x5F53;&#x865A;&#x62DF;&#x673A;&#x7528;&#xFF0C;&#x8FD8;&#x5728;&#x91CC;&#x9762;&#x8DD1; <code>supervisord</code> &#x4E4B;&#x7C7B;&#x7684;&#x6765;&#x60F3;&#x529E;&#x6CD5;&#x652F;&#x6301;&#x670D;&#x52A1;&#xFF0C;&#x6700;&#x540E;&#x5F62;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x8D85;&#x81C3;&#x80BF;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#xFF0C;&#x6027;&#x80FD;&#x3001;&#x7A33;&#x5B9A;&#x6027;&#x90FD;&#x4E0D;&#x597D;&#x3002;&#x5FAE;&#x8F6F;&#x7684;&#x8FD9;&#x4E2A; Windows Container &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x53CD;&#x9762;&#x6559;&#x6750;&#x3002;</em></p><h2 id="ji-chu-jing-xiang"><a href="#&#x57FA;&#x7840;&#x955C;&#x50CF;" class="headerlink" title="&#x57FA;&#x7840;&#x955C;&#x50CF;"></a>&#x57FA;&#x7840;&#x955C;&#x50CF; <a href="#ji-chu-jing-xiang" class="header-anchor">#</a></h2><p>&#x5FAE;&#x8F6F;&#x53D1;&#x5E03;&#x7684;&#x955C;&#x50CF;&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7684;&#x57FA;&#x7840;&#x955C;&#x50CF;&#xFF1A;</p><ul><li><code>windowsservercore</code>: &#x6BD4;&#x8F83;&#x5927;(<strong>9.3GB</strong>) (<em>&#x6CE8;&#xFF1A;&#x6655;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x80FD;&#x4EC5;&#x4EC5;&#x53EB;&#x6BD4;&#x8F83;&#x5927;&#x4E48;&#xFF1F;&#xFF1F;&#xFF1F;</em>)&#xFF0C;&#x9AD8;&#x5EA6;&#x517C;&#x5BB9;</li><li><code>nanoserver</code>: &#x8D85;&#x5C0F;&#xFF0C;&#x8D85;&#x5FEB;&#xFF0C;&#x4E0D;&#x8FC7;&#x66F4;&#x5C11;&#x7684;API&#x652F;&#x6301;&#x3002;(<em>&#x6CE8;&#xFF1A;&#x9760;&#xFF0C;&#x4F60;&#x5BB6;&#x7BA1; 600MB~810MB &#x7684;&#x955C;&#x50CF;&#x53EB;&#x505A;&#x8D85;&#x5C0F;&#x7684;&#x955C;&#x50CF;&#xFF1F;&#xFF1F;&#xFF1F;&#x8FD8;&#x662F;&#x529F;&#x80FD;&#x53D7;&#x9650;&#x7248;&#xFF1F;&#xFF1F;</em>)</li></ul><p>&#x4ED6;&#x4EEC;&#x4E3A;&#x4E86;&#x505A;&#x8FD9;&#x4E2A;<strong>&#x8D85;&#x5C0F;</strong> &#x7684;&#x955C;&#x50CF;&#xFF0C;&#x53BB;&#x9664;&#x4E86;&#x5F88;&#x591A;Windows&#x670D;&#x52A1;&#x5668;&#x91CC;&#x4E0D;&#x5927;&#x7528;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6BD4;&#x5982;&#x53BB;&#x9664;&#x4E86;&#x4F20;&#x771F;&#x670D;&#x52A1;&#x2026;&#x2026;&#x6655;&#xFF0C;&#x4EC0;&#x4E48;&#x5E74;&#x4EE3;&#x4E86;&#x8FD9;&#x4E2A;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x6807;&#x914D;&#x5440;&#xFF1F;</p><p>&#x5230;&#x73B0;&#x5728;&#x4E3A;&#x6B62;&#x8FD8;&#x4E0D;&#x80FD; <code>docker pull</code> &#x5462;&#xFF0C;&#x4E0D;&#x8FC7;&#x5F88;&#x5FEB;&#x4F1A;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x4F1A;&#x76F4;&#x63A5;&#x4ECE;&#x5FAE;&#x8F6F;&#x670D;&#x52A1;&#x5668;&#x4E0B;&#x8F7D;&#x3002;</p><p>&#x6F14;&#x793A;&#x4E86;&#x4E00;&#x4E0B;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x955C;&#x50CF;&#x8D77;&#x4E2A; <code>cmd</code>&#xFF0C;<strong>&#x8D85;&#x5C0F;</strong> &#x955C;&#x50CF;&#x5927;&#x6982;&#x7528;&#x4E86;2&#x79D2;&#x591A;&#xFF0C;<code>windowsservercore</code> &#x90A3;&#x4E2A;&#x5927;&#x6982;&#x7528;&#x4E86;3&#x79D2;&#x591A;&#x2026;&#x2026;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm nanoserver cmd</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm windowsservercore cmd</span><br></pre></td></tr></table></figure><p>&#x8FDB;&#x5165; <code>cmd</code> &#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x5217;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x4E24;&#x4E2A;&#x955C;&#x50CF;&#x5DEE;&#x5F02;&#xFF0C;&#x76F8;&#x6BD4;&#x4E8E; <code>windowsservercore</code> &#x800C;&#x8A00;&#xFF0C;<code>nanoserver</code> &#x4E2D;&#x7684;&#x670D;&#x52A1;&#x5B9E;&#x5728;&#x662F;&#x5C11;&#x592A;&#x591A;&#x4E86;&#x2026;&#x2026;&#xFF08;&#x4E0D;&#x8FC7;&#x4F9D;&#x65E7;&#x5F88;&#x591A;&#x5F88;&#x591A;&#x2026;&#x2026;&#xFF09;</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell get-service</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x67E5;&#x770B;&#x8FDB;&#x7A0B;</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell get-process</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668; (Task Manager) &#x91CC;&#x770B;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x662F;&#x771F;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x6838;&#x7684;&#x5BB9;&#x5668;&#x3002;</p><h1 id="windows-server-container-shi-xian-jia-gou"><a href="#Windows-Server-Container-&#x5B9E;&#x73B0;&#x67B6;&#x6784;" class="headerlink" title="Windows Server Container &#x5B9E;&#x73B0;&#x67B6;&#x6784;"></a>Windows Server Container &#x5B9E;&#x73B0;&#x67B6;&#x6784; <a href="#windows-server-container-shi-xian-jia-gou" class="header-anchor">#</a></h1><h2 id="ming-ming-kong-jian"><a href="#&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x5185;&#x90E8;&#x5E76;&#x4E0D;&#x79F0;&#x5176;&#x4E3A; <code>namespace</code>&#xFF0C;&#x800C;&#x662F;&#x79F0;&#x4E4B;&#x4E3A; <code>silo</code> (&#x8C37;&#x4ED3;&#x6216;&#x8005;&#x5BFC;&#x5F39;&#x53D1;&#x5C04;&#x4E95;&#xFF09;</p><p>&#x8FD9;&#x4E1C;&#x897F;&#x662F;&#x5BF9; Windows &#x7684; <code>Job object</code> &#x7684;&#x6269;&#x5C55;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x7EC4;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E00;&#x7EC4;&#x53D7;&#x9650;&#x8FDB;&#x7A0B;&#xFF0C;&#x65B0;&#x7684;&#x5185;&#x6838;&#x63D0;&#x4F9B;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x80FD;&#x529B;&#x3002;</p><p>&#x65B0;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x652F;&#x6301;&#x4E86;&#xFF1A;</p><ul><li>&#x6CE8;&#x518C;&#x8868;</li><li>&#x8FDB;&#x7A0B; ID, &#x4F1A;&#x8BDD;</li><li>Object namespace</li><li>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li>&#x7F51;&#x7EDC;&#x90E8;&#x5206;</li></ul><h3 id="object-namespace"><a href="#Object-namespace" class="headerlink" title="Object namespace"></a>Object namespace <a href="#object-namespace" class="header-anchor">#</a></h3><p>&#x7CFB;&#x7EDF;&#x7EA7;&#x7684; namespace&#xFF0C;&#x662F;&#x5BF9;&#x7528;&#x6237;&#x9690;&#x85CF;&#x7684;&#x3002;&#x5176;&#x5B9E;&#x5728; Windows &#x4E2D;&#xFF0C;&#x4E5F;&#x662F;&#x5B58;&#x5728;&#x7C7B;&#x4F3C;&#x4E8E; Linux &#x4E2D;&#x7684; <code>/</code> &#x7684;&#x6982;&#x5FF5;&#x7684;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5728; NT &#x5185;&#x6838;&#x773C;&#x91CC;&#xFF0C;<code>C:\Windows</code> &#x6620;&#x5C04;&#x5230; <code>\DosDevices\C:\Windows</code> &#x4E0B;&#x3002;</p><p>&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x7684;&#x8BBE;&#x5907;&#x6240;&#x9700;&#x7684; entry point&#xFF0C; &#x5982;&#xFF1A;</p><ul><li><code>\DosDevices\C:</code> &#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li><code>\Registry</code> &#xFF1A; &#x6CE8;&#x518C;&#x8868;</li><li><code>\Device\Tcp</code> &#xFF1A; TCP &#x901A;&#x8BAF;</li></ul><p>&#x800C; <code>silo</code> &#x53EF;&#x4EE5;&#x6A21;&#x4EFF; Linux &#x91CC;&#x9762; <code>chroot</code> &#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x6765;&#x6539;&#x53D8;&#x4E0A;&#x8FF0; entry point &#x7684; root &#x4F4D;&#x7F6E;&#x3002;</p><ul><li><code>\Silos\foo\DosDevices\C:</code></li><li><code>\Silos\bar\DosDevices\C:</code></li></ul><p>&#x6F14;&#x793A;&#x4E86;&#x4E00;&#x4E0B;&#x67E5;&#x770B;&#x4E0A;&#x8FF0;&#x7684;&#x8DEF;&#x5F84;&#x3002;Windows &#x9A71;&#x52A8;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E2D;&#x6709;&#x4E00;&#x4E2A; <code>objdir.exe</code> &#x7684;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x770B;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x3002;</p><p>&#x5206;&#x522B;&#x5728;&#x5BBF;&#x4E3B;&#x548C; <code>nanoserver</code> &#x5BB9;&#x5668;&#x4E2D;&#x6267;&#x884C; <code>objdir \</code>&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x3002;&#x7136;&#x540E;&#x7528; <code>objdir \GLOBAL??</code>&#xFF0C;&#x5206;&#x522B;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x5BBF;&#x4E3B;&#x673A;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5BB9;&#x5668;&#x5185;&#x5C11;&#x4E86;&#x5F88;&#x591A;&#x5F88;&#x591A;&#x4E1C;&#x897F; &#xFF08;20 vs 133)&#x3002;</p><p>&#x5728;&#x5BBF;&#x4E3B;&#x4E0A;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6620;&#x5C04;&#x3002;<code>objdir \Silos\460\GLOBAL??</code>&#xFF0C;&#x8FD9;&#x6837;&#x663E;&#x793A;&#x7684;&#x5C31;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;20&#x6761;&#x4FE1;&#x606F;&#x3002;</p><h2 id="wen-jian-xi-tong"><a href="#&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; <a href="#wen-jian-xi-tong" class="header-anchor">#</a></h2><p>&#x5C31;&#x548C;&#x524D;&#x9762;&#x8BF4;&#x7684; Windows &#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x4E00;&#x6837;&#xFF0C;Windows &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E5F;&#x975E;&#x5E38;&#x590D;&#x6742;&#x3002;&#x968F;&#x7740;&#x4E0D;&#x65AD;&#x7684;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x7279;&#x6027;&#x8FDB;&#x53BB;&#xFF0C;Transactions, File IDs, USN journal &#x7B49;&#x7B49;&#xFF0C;&#x800C;Windows&#x7A0B;&#x5E8F;&#x5F88;&#x591A;&#x4F9D;&#x8D56;&#x4E8E;&#x8FD9;&#x4E9B;&#x7279;&#x6027;&#x3002;</p><p>&#x56E0;&#x6B64;&#x5982;&#x679C;&#x8981;&#x57FA;&#x4E8E;&#x6B64;&#x53BB;&#x505A;&#x4E00;&#x4E2A; Linux &#x4E16;&#x754C;&#x4E2D;&#x7684; AUFS&#xFF0C;&#x6216;&#x8005; Overlay FS&#xFF0C;&#x4F46;&#x662F;&#x652F;&#x6301;&#x4E0A;&#x9762;&#x8FD9;&#x4E9B; NTFS &#x7279;&#x6027;&#x7684;&#xFF0C;&#x6781;&#x4E3A;&#x56F0;&#x96BE;&#x3002;</p><p>&#x4E8E;&#x662F;&#x5728; Windows Container v1 &#x4E2D;&#xFF0C;&#x91C7;&#x7528;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E; <code>Device Mapper</code> &#x7684;&#x529E;&#x6CD5; (<em>&#x6CE8;&#xFF1A;Really?? &#x751A;&#x591A; bug &#x7684;&#x90A3;&#x4E2A; Device Mapper&#xFF1F;&#xFF1F;</em>) &#xFF0C;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5757;&#x8BBE;&#x5907;&#x662F;&#x865A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x662F; <code>&#x865A;&#x62DF;&#x5757;&#x8BBE;&#x5907;</code> + <code>&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x7684;NTFS &#x5206;&#x533A;</code> &#x7684;&#x65B9;&#x5F0F;&#x3002;&#x4F7F;&#x7528; symlink &#x5230;&#x5BBF;&#x4E3B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5404;&#x5C42;&#xFF0C;&#x8FD9;&#x6837;&#x8BA9;&#x5757;&#x8BBE;&#x5907;&#x4E0D;&#x4F1A;&#x8FC7;&#x4E8E;&#x81C3;&#x80BF;&#x3002;</p><h2 id="zhu-ce-biao"><a href="#&#x6CE8;&#x518C;&#x8868;" class="headerlink" title="&#x6CE8;&#x518C;&#x8868;"></a>&#x6CE8;&#x518C;&#x8868; <a href="#zhu-ce-biao" class="header-anchor">#</a></h2><p>&#x6CE8;&#x518C;&#x8868;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x7531;&#x4E8E;&#x5B83;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6240;&#x4EE5;&#x9488;&#x5BF9;&#x6CE8;&#x518C;&#x8868;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x662F;&#x771F;&#x7684;&#x505A;&#x4E86;&#x4E00;&#x4E2A; Union FS &#x5728;&#x4E0A;&#x9762;&#x3002;</p><p>&#x4E3A;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x4FDD;&#x5B58;&#x4E00;&#x6574;&#x5957;&#x6CE8;&#x518C;&#x8868;&#x7684;clone&#x3002;</p><p>&#x7531;&#x4E8E;&#x8FD9;&#x662F; Windows &#x7279;&#x6709;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x6C61;&#x67D3; Docker &#x4EE3;&#x7801;&#xFF0C;&#x4ED6;&#x4EEC;&#x628A;&#x6CE8;&#x518C;&#x8868;&#x8FD9;&#x4E2A;&#x7279;&#x4F8B;&#x5BF9; Docker &#x9690;&#x85CF;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x4ECE; Docker &#x89C6;&#x89D2;&#x770B;&#x6CE8;&#x518C;&#x8868;&#x7684;&#x6539;&#x53D8;&#x5C31;&#x662F;&#x6587;&#x4EF6;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;<code>docker diff</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x770B;&#x5230;&#x6CE8;&#x518C;&#x8868;&#x6587;&#x4EF6;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x3002;</p><h1 id="hyper-v-rong-qi-jia-gou"><a href="#Hyper-V-&#x5BB9;&#x5668;&#x67B6;&#x6784;" class="headerlink" title="Hyper-V &#x5BB9;&#x5668;&#x67B6;&#x6784;"></a>Hyper-V &#x5BB9;&#x5668;&#x67B6;&#x6784; <a href="#hyper-v-rong-qi-jia-gou" class="header-anchor">#</a></h1><p>Hyper-V &#x7684;&#x5BB9;&#x5668;&#x6784;&#x67B6;&#x5C31;&#x548C; Docker &#x975E;&#x5E38;&#x4E0D;&#x540C;&#x4E86;&#x3002;&#x8FD9;&#x91CC;&#x7B49;&#x4E8E;&#x662F;&#x8DD1;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x6838;&#x8FD0;&#x884C;&#x3002;</p><p>&#x52A8;&#x673A;&#x662F;&#x56E0;&#x4E3A;&#x89C9;&#x5F97;&#x6709;&#x4E9B;&#x5E94;&#x7528;&#x9700;&#x8981;&#x66F4;&#x597D;&#x7684;&#x9694;&#x79BB;&#x3002;&#x6BD4;&#x5982;&#x591A;&#x79DF;&#x6237;&#x4F7F;&#x7528;&#x3001;&#x907F;&#x514D;&#x63D0;&#x6743;&#x9650;&#x6F0F;&#x6D1E;&#x3001;&#x6709;&#x4E9B;&#x7279;&#x522B;&#x7684;&#x89C4;&#x5B9A;&#x8BF4;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x5FC5;&#x987B;&#x8FD0;&#x884C;&#x4E8E;vm&#x4E2D;&#x7B49;&#x7B49;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5FAE;&#x8F6F;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x7528;VM&#x6765;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x5FAE;&#x8F6F;&#x53EF;&#x4E0D;&#x5F97;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x60F3;&#x6CD5;&#x4E48;&#xFF0C;&#x4ED6;&#x4EEC;&#x5DF2;&#x7ECF;&#x628A;&#x5BB9;&#x5668;&#x6574;&#x7684;&#x8DDF;&#x4E2A;VM&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#x2026;&#x2026;</em>&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x65B9;&#x6CD5;&#x662F;&#x8BB2;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x72EC;&#x7ACB;&#x7684;&#x8FD0;&#x884C;&#x4E8E;&#x4E00;&#x4E2A; VM &#x4E2D;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#x7684;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --isolation=hyperv</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5BB9;&#x5668;&#x5C31;&#x8FD0;&#x884C;&#x4E8E; Hyper-V &#x865A;&#x62DF;&#x673A;&#x91CC;&#x4E86;&#x3002;</p><p>&#x800C; Windows 10 &#x7684;&#x7CFB;&#x7EDF;&#x91CC;&#xFF0C;&#x9ED8;&#x8BA4;&#x5C31;&#x662F;&#x5982;&#x6B64;&#x3002;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x90A3;&#x4E9B;&#x7D27;&#x8026;&#x5408;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x8BA9; Windows &#x670D;&#x52A1;&#x5668;&#x7684;&#x5BB9;&#x5668;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x6838;&#x7248;&#x672C;&#x4E0D;&#x4E00;&#x81F4;&#x7136;&#x540E;&#x51FA;&#x9519;&#x2026;&#x2026;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x8DD1;&#x4E2A;VM&#x6765;&#x8FD0;&#x884C;&#x670D;&#x52A1;&#x5668;&#x5185;&#x6838;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5230;&#x91CC;&#x9762;&#x8DD1;&#x4E2A;Docker&#x2026;&#x2026;</p><p>&#x8FD0;&#x884C;&#x4E8E; Windows Server Container &#x7684;&#x955C;&#x50CF;&#x548C;&#x8FD0;&#x884C;&#x4E8E; Hyper-V VM &#x7684;&#x955C;&#x50CF;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x8FD9;&#x662F;&#x597D;&#x4E8B;&#x60C5;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#x955C;&#x50CF;&#x3002;</p><h2 id="making-it-work"><a href="#Making-it-work" class="headerlink" title="Making it work"></a>Making it work <a href="#making-it-work" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#x662F;&#x8BA9;VM&#x5C3D;&#x53EF;&#x80FD;&#x53D8;&#x5C0F;&#xFF0C;&#x5E76;&#x4E14;&#x65E0;&#x72B6;&#x6001;&#x3002;&#x867D;&#x7136;&#x4E0D;&#x662F;&#x6700;&#x5C0F;&#x7684;Windows&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5C0F;&#xFF0C;&#x800C;&#x4E14;&#x6570;&#x636E;&#x6539;&#x53D8;&#x4E0D;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x70B9;&#x548C; Moby &#x5F88;&#x50CF;</em>)</p><p>&#x5B58;&#x50A8;&#x662F;&#x57FA;&#x4E8E; SMB&#x7684;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x548C; moby 1.12 &#x76EE;&#x524D;&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x5F88;&#x50CF;</em>&#xFF09;&#xFF0C; &#x4E0D;&#x8FC7;&#x6CA1;&#x6709;&#x771F;&#x6B63;&#x7684;&#x8D70;&#x7F51;&#x7EDC;&#xFF0C;&#x800C;&#x662F;&#x8D70;&#x7684; <code>VMBus</code> &#xFF08;&#x7C7B;&#x4F3C;&#x4E8E; kvm &#x4E2D;&#x7684;<code>virtio</code>&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x662F;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5BBF;&#x4E3B;&#x8D1F;&#x8D23;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6587;&#x4EF6;&#x7F13;&#x5B58;&#x5171;&#x4EAB;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x591A;&#x5B9E;&#x4F8B;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8DE8;&#x5BB9;&#x5668;&#x5982;&#x679C;&#x6709;&#x91CD;&#x590D;&#x6587;&#x4EF6;&#x5C42;&#x7684;&#x8BDD;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0D;&#x662F;&#x591A;&#x526F;&#x672C;&#xFF0C;&#x800C;&#x662F;&#x5355;&#x526F;&#x672C;&#xFF0C;&#x8282;&#x7EA6;&#x5185;&#x5B58;&#x63D0;&#x9AD8;IO&#x6548;&#x7387;&#x3002;</p><p>&#x7F51;&#x7EDC;&#x548C;&#x6240;&#x6709;VM&#x4E00;&#x6837;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5305;&#x62EC;&#x4E4B;&#x524D;&#x4E0D;&#x8D70;&#x865A;&#x62DF;&#x673A;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x6838;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4E5F;&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x5B9E;&#x73B0;&#x7684;&#x3002;(<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x70B9;&#x548C; Linux &#x4E0B;&#x7684; Docker &#x4E0D;&#x540C;</em>)</p><h2 id="cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning <a href="#cloning" class="header-anchor">#</a></h2><p>&#x5373;&#x4F7F;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x542F;&#x52A8;&#x4E00;&#x4E2A; Hyper-V &#x7684;&#x5BB9;&#x5668;&#x4E5F;&#x662F;&#x5F88;&#x6162;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x82B1;40&#x591A;&#x79D2;&#x7684;&#x65F6;&#x95F4;&#x624D;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x597D;&#x53BB;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x8FDB;&#x7A0B;&#x3002;</p><p>&#x4E8E;&#x662F;&#x60F3;&#x4E86;&#x4E2A;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#x8FD9;&#x4E2A; Hyper-V &#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B83;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x72B6;&#x6001;&#x4FDD;&#x7559;&#xFF0C;&#x4EE5;&#x540E;&#x6BCF;&#x6B21;&#x5728;&#x8FD0;&#x884C; Hyper-V &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;Clone&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x7136;&#x540E; Copy-on-Write&#xFF0C;&#x8FD9;&#x6837;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x5C31;&#x5F88;&#x5FEB;&#x4E86;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x4E0D;&#x5C31;&#x662F;Linux fork&#x4E48;&#x2026;&#x2026;</em>)&#x3002;</p><p>&#x4F7F;&#x7528; <code>--isolation</code> &#x6765;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Hyper-V &#x865A;&#x62DF;&#x673A;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --isolation=hyperv demo cmd /c <span class="built_in">echo</span> Help I am trapped <span class="keyword">in</span> a VM</span><br></pre></td></tr></table></figure><p>&#x5927;&#x7EA6;10&#x79D2;&#x540E;&#xFF0C;&#x51FA;&#x7ED3;&#x679C;&#x4E86;&#x2026;&#x2026;&#x1F613;</p><p>&#x5982;&#x679C;&#x8FD9;&#x65F6;&#x53BB;&#x770B;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x4E24;&#x4E2A;&#x5947;&#x602A;&#x7684;&#x6CA1;&#x6709;&#x540D;&#x5B57;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x5E76;Freeze &#x7684; Hyper-V &#x5BB9;&#x5668;&#x8FDB;&#x7A0B;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x9000;&#x51FA;&#x5BB9;&#x5668;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x53C8;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x5947;&#x602A;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p><p>Taylor &#x9A6C;&#x4E0A;&#x8865;&#x5145;&#x8BF4;&#x6211;&#x4EEC;&#x4F1A;&#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x5730;&#x2026;&#x2026;&#x7136;&#x540E;&#xFF0C;John &#x8BF4;&#xFF0C;3&#x5468;&#x524D;&#x4ED6;&#x53BB;&#x5EA6;&#x5047;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x542C;&#x4ED6;&#x4EEC;&#x8BF4;&#x8981;&#x4FEE;&#x590D;&#x4E86;&#xFF0C;&#x4ECA;&#x5929;&#x8FD8;&#x6CA1;&#x4FEE;&#x590D;&#x2026;&#x2026;</p><p>&#x7EE7;&#x7EED;&#x6F14;&#x793A;&#xFF0C;&#x6309;&#x7167;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x4F1A;&#x5FEB;&#x4E00;&#x4E9B;&#x2026;&#x2026;6&#x79D2;&#x2026;&#x2026;</p><h1 id="wen-da"><a href="#&#x95EE;&#x7B54;" class="headerlink" title="&#x95EE;&#x7B54;"></a>&#x95EE;&#x7B54; <a href="#wen-da" class="header-anchor">#</a></h1><h2 id="wei-ruan-zhe-chong-hyper-v-de-ji-zhu-shi-bu-shi-ke-yi-yong-lai-pao-linux"><a href="#&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD;-Hyper-V-&#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1;-Linux-&#xFF1F;" class="headerlink" title="&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD; Hyper-V &#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1; Linux &#xFF1F;"></a>&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD; Hyper-V &#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1; Linux &#xFF1F; <a href="#wei-ruan-zhe-chong-hyper-v-de-ji-zhu-shi-bu-shi-ke-yi-yong-lai-pao-linux" class="header-anchor">#</a></h2><p>John &#x8BF4;&#xFF0C;&#x5443;&#xFF0C;&#x5148;&#x8BA9; Taylor &#x4ECE;&#x653F;&#x6CBB;&#x89D2;&#x5EA6;&#x56DE;&#x7B54;&#x4E00;&#x4E0B;&#x5427; &#x1F60A;&#x2026;&#x2026;&#x3002;Taylor &#x8FD9;&#x9700;&#x8981;&#x770B;&#x7528;&#x6237;&#x7684;&#x53CD;&#x9988;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x66F4;&#x591A;&#x7684;&#x7528;&#x6237;&#x9700;&#x6C42;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x5C31;&#x4F1A;&#x7ED9;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x66F4;&#x591A;&#x7684;&#x538B;&#x529B;&#x53BB;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x3002;</p><p>John &#x8865;&#x5145;&#x8BF4;&#xFF0C;&#x8FD9;&#x79CD;&#x60F3;&#x6CD5;&#x542C;&#x8D77;&#x6765;&#x5F88;&#x8D5E;&#xFF0C;&#x6211;&#x975E;&#x5E38;&#x5E0C;&#x671B;&#x5FAE;&#x8F6F;&#x80FD;&#x8BA9;&#x6211;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#x3002;</p><h2 id="ni-men-zhi-qian-ti-dao-de-compute-service-shi-you-liao-gong-kai-de-api-liao-me"><a href="#&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;-Compute-Service-&#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684;-API-&#x4E86;&#x4E48;&#xFF1F;" class="headerlink" title="&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684; Compute Service &#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684; API &#x4E86;&#x4E48;&#xFF1F;"></a>&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684; Compute Service &#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684; API &#x4E86;&#x4E48;&#xFF1F; <a href="#ni-men-zhi-qian-ti-dao-de-compute-service-shi-you-liao-gong-kai-de-api-liao-me" class="header-anchor">#</a></h2><p>&#x6211;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x4E86;2&#x4E2A;GitHub&#x7684;repo&#xFF0C;&#x5206;&#x522B;&#x662F; C# &#x548C; Go &#x5305;&#x88C5;&#x7684;&#x8FD9;&#x4E2A; API&#xFF0C;&#x8FD9;&#x662F;&#x4E34;&#x65F6;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x90FD;&#x653E;&#x5230; MSDN &#x4E2D;&#x53BB;&#x3002;Taylor &#x8865;&#x5145;&#x8BF4;&#xFF0C;&#x6700;&#x7EC8;&#x5FAE;&#x8F6F;&#x672A;&#x6765;&#x5341;&#x51E0;&#x5E74;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x5173;&#x4E8E;docker &#x4E1C;&#x897F;&#x90FD;&#x4F1A;&#x653E;&#x5230; <a href="https://dockers.microsoft.com" target="_blank" rel="noopener">https://dockers.microsoft.com</a> &#x4E2D;&#x53BB;&#x3002;</p><h2 id="wo-men-xu-yao-zai-windows-docker-zhong-shi-yong-overlay-network-lai-zhi-chi-swarm-ni-men-shi-me-shi-hou-neng-gou-zhi-chi-overlay-network"><a href="#&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows-Docker-&#x4E2D;&#x4F7F;&#x7528;-overlay-network-&#x6765;&#x652F;&#x6301;-Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301;-overlay-network&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows Docker &#x4E2D;&#x4F7F;&#x7528; overlay network &#x6765;&#x652F;&#x6301; Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301; overlay network&#xFF1F;"></a>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows Docker &#x4E2D;&#x4F7F;&#x7528; overlay network &#x6765;&#x652F;&#x6301; Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301; overlay network&#xFF1F; <a href="#wo-men-xu-yao-zai-windows-docker-zhong-shi-yong-overlay-network-lai-zhi-chi-swarm-ni-men-shi-me-shi-hou-neng-gou-zhi-chi-overlay-network" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x4E3B;&#x8981;&#x7684;&#x6CE8;&#x610F;&#x529B;&#x662F;&#x5148;&#x8BA9; Docker Engine &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x8003;&#x8651; Swarm, Compose &#x8FD9;&#x4E9B;&#x80FD;&#x529B;&#x3002;</p><h2 id="docker-for-windows-he-ni-men-zhe-li-jie-shao-de-docker-on-windows-zhong-de-hyper-v-rong-qi-de-hua-cong-ji-zhu-ceng-mian-shang-you-shi-me-bu-tong"><a href="#Docker-for-Windows-&#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684;-Docker-on-Windows-&#x4E2D;&#x7684;-Hyper-V-&#x5BB9;&#x5668;-&#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;" class="headerlink" title="Docker for Windows &#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684; Docker on Windows &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668; &#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;"></a><code>Docker for Windows</code> &#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684; <code>Docker on Windows</code> &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668; &#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F; <a href="#docker-for-windows-he-ni-men-zhe-li-jie-shao-de-docker-on-windows-zhong-de-hyper-v-rong-qi-de-hua-cong-ji-zhu-ceng-mian-shang-you-shi-me-bu-tong" class="header-anchor">#</a></h2><p>&#x6211;&#x60F3;&#x6709;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x6709;&#x673A;&#x4F1A;&#x5171;&#x4EAB;&#x3002;&#x5F53;&#x7136;&#x65B9;&#x5F0F;&#x4E0A;&#x4E0D;&#x540C;&#xFF0C;<code>Docker for Windows</code> &#x4E2D;&#x7684;&#x662F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Hyper-V &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x91CC;&#x9762;&#x8DD1;&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x3002;&#x800C; <code>Docker on Windows</code> &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668;&#x662F;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; Hyper-V &#x865A;&#x62DF;&#x673A;&#x3002;</p><h2 id="zai-di-yi-ban-zhong-ni-men-you-na-xie-docker-gong-neng-bu-zhi-chi"><a href="#&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B;-Docker-&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;" class="headerlink" title="&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;"></a>&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F; <a href="#zai-di-yi-ban-zhong-ni-men-you-na-xie-docker-gong-neng-bu-zhi-chi" class="header-anchor">#</a></h2><p>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;&#x6240;&#x6709; Linux &#x7279;&#x5B9A;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x90A3;&#x5269;&#x4E0B;&#x6765;&#x7684;&#x8FD8;&#x591A;&#x4E48;&#xFF1F;&#xFF1F;</em>)&#xFF0C;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x73B0;&#x5728;&#x6B63;&#x5728;&#x8BD5;&#x56FE;&#x8BA9; <code>docker top</code> &#x80FD;&#x591F;&#x5DE5;&#x4F5C;&#xFF08;John &#x5F88;&#x8BE7;&#x5F02;&#x7684;&#x95EE;&#xFF0C;&#x771F;&#x7684;&#xFF1F;&#x6211;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x554A;&#xFF09;&#xFF0C;&#x56E0;&#x4E3A;&#x673A;&#x5236;&#x4E0A;&#x548C; Linux &#x5F88;&#x4E0D;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x50CF;&#x8FD9;&#x6837;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x5C31;&#x9700;&#x8981;&#x4E0D;&#x5C11;&#x5DE5;&#x4F5C;&#x53BB;&#x505A;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 运维 - Docker Networking 进阶指南 - Madhu Venugopal</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-08-08-video-docker-ops-docker-networking-deep-dive-considerations-and-troubleshooting.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-08-08-video-docker-ops-docker-networking-deep-dive-considerations-and-troubleshooting.html</id>
    <published>2016-08-07T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.621Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#jie-shao">&#x4ECB;&#x7ECD;</a><ul><li><a href="#shi-me-shi-libnetwork">&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F;</a><ul><li><a href="#docker-wang-luo-hu-lian">Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE;</a></li><li><a href="#ding-yi-rong-qi-wang-luo-mo-xing">&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;</a></li><li><a href="#ti-gong-nei-zhi-ip-di-zhi-guan-li">&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;</a></li><li><a href="#ti-gong-nei-zhi-de-duo-su-zhu-wang-luo-hu-lian">&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;</a></li><li><a href="#ti-gong-nei-zhi-de-fu-wu-fa-xian-yi-ji-fu-zai-jun-heng">&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><li><a href="#yun-xu-sheng-tai-xi-tong-kuo-zhan">&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55;</a></li></ul></li><li><a href="#docker-1-12-swarm-mode-de-xin-de-te-xing">Docker 1.12 Swarm Mode &#x7684;&#x65B0;&#x7684;&#x7279;&#x6027;</a></li><li><a href="#macvlan-qu-dong">Macvlan &#x9A71;&#x52A8;</a></li></ul></li><li><a href="#shen-ru">&#x6DF1;&#x5165;</a><ul><li><a href="#duo-rong-qi-wang-luo">&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;</a></li><li><a href="#wang-luo-kong-zhi-ceng-mian">&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762;</a></li><li><a href="#an-quan-shu-ju-ceng">&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42;</a></li><li><a href="#fu-wu-fa-xian">&#x670D;&#x52A1;&#x53D1;&#x73B0;</a></li><li><a href="#nei-zhi-fu-zai-jun-heng">&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><li><a href="#mesh-lu-you">Mesh &#x8DEF;&#x7531;</a></li></ul></li><li><a href="#demo">Demo</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon16 - Docker for Ops - Docker for Ops - Docker Networking Deep Dive, Considerations and Troubleshooting<br>by Madhu Venugopal, Jana Radhakrishnan</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/Gwdo3fo6pZg" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=Gwdo3fo6pZg" target="_blank" rel="noopener">https://www.youtube.com/watch?v=Gwdo3fo6pZg</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=o0319rxyutt&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/o0319rxyutt.html" target="_blank" rel="noopener">http://v.qq.com/x/page/o0319rxyutt.html</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x4ED6;&#x4EEC;&#x4E4B;&#x524D;&#x5DE5;&#x4F5C;&#x4E8E; SocketPlane&#xFF0C;2015&#x5E74;&#x521D;&#xFF0C;Docker &#x6536;&#x8D2D;&#x4E86; SocketPlane&#xFF0C;&#x6210;&#x4E3A;&#x4ECA;&#x5929; Docker Networking &#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p><h1 id="jie-shao"><a href="#&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4ECB;&#x7ECD;"></a>&#x4ECB;&#x7ECD; <a href="#jie-shao" class="header-anchor">#</a></h1><p>by Madhu Venugopal</p><h2 id="shi-me-shi-libnetwork"><a href="#&#x4EC0;&#x4E48;&#x662F;-libnetwork&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F; <a href="#shi-me-shi-libnetwork" class="header-anchor">#</a></h2><h3 id="docker-wang-luo-hu-lian"><a href="#Docker-&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;" class="headerlink" title="Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE;"></a>Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE; <a href="#docker-wang-luo-hu-lian" class="header-anchor">#</a></h3><p>&#x8BB8;&#x591A;&#x4EBA;&#x8BA4;&#x4E3A; <code>libnetwork</code> &#x53EA;&#x662F;&#x8D1F;&#x8D23; <code>vlan</code>, <code>vxlan</code> &#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x9A71;&#x52A8;&#x90E8;&#x5206;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#xFF0C;<code>libnetwork</code> &#x4E0D;&#x4EC5;&#x662F;&#x9A71;&#x52A8;&#x63A5;&#x53E3;&#x3002;</p><p>&#x7F51;&#x7EDC;&#x5206;&#x7BA1;&#x7406;&#x5C42;&#x9762;&#x3001;&#x63A7;&#x5236;&#x5C42;&#x9762;&#x548C;&#x6570;&#x636E;&#x5C42;&#x9762;&#x3002;</p><p>&#x9A71;&#x52A8;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x5904;&#x7406;&#x6570;&#x636E;&#x5C42;&#x9762;&#xFF0C;&#x6240;&#x4EE5;&#x4ECA;&#x5929;&#x6709; <code>plugins</code> &#x63A5;&#x53E3;&#xFF0C;<code>overlay</code>, <code>bridge</code>&#xFF0C;&#x4EE5;&#x53CA;&#x65B0;&#x7684; <code>macvlan</code> &#x7B49;&#x591A;&#x79CD;&#x9A71;&#x52A8;&#x3002;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x5904;&#x7406;&#x6570;&#x636E;&#x5C42;&#x9762;&#x7684;&#x4E8B;&#x7269;&#x3002;</p><h3 id="ding-yi-rong-qi-wang-luo-mo-xing"><a href="#&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;" class="headerlink" title="&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;"></a>&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B; <a href="#ding-yi-rong-qi-wang-luo-mo-xing" class="header-anchor">#</a></h3><h3 id="ti-gong-nei-zhi-ip-di-zhi-guan-li"><a href="#&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;" class="headerlink" title="&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;"></a>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406; <a href="#ti-gong-nei-zhi-ip-di-zhi-guan-li" class="header-anchor">#</a></h3><p>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;IP&#xFF0C;&#x6307;&#x5B9A;&#x5B50;&#x7F51;&#xFF0C;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x8303;&#x56F4;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x5C06;<code>DHCP</code> pipe out&#x7ED9;&#x5916;&#x9762;&#x7684; <code>DHCP</code> &#x670D;&#x52A1;&#x5668;&#x6765;&#x7ED9;&#x5BB9;&#x5668;&#x5185;&#x5206;&#x914D;IP&#x5730;&#x5740;&#x3002;</p><h3 id="ti-gong-nei-zhi-de-duo-su-zhu-wang-luo-hu-lian"><a href="#&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;" class="headerlink" title="&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;"></a>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE; <a href="#ti-gong-nei-zhi-de-duo-su-zhu-wang-luo-hu-lian" class="header-anchor">#</a></h3><p>&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;&#x4E3B;&#x8981;&#x662F;&#x4E24;&#x4E2A;&#x5C42;&#x9762;&#xFF0C;&#x63A7;&#x5236;&#x5C42;&#x9762;&#x548C;&#x6570;&#x636E;&#x5C42;&#x9762;&#x3002;</p><p>&#x6570;&#x636E;&#x5C42;&#x9762;&#x73B0;&#x5728;&#x901A;&#x8FC7; <code>overlay</code> &#x9A71;&#x52A8;&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; plugin &#x63D0;&#x4F9B;&#x7684;&#x5176;&#x5B83;&#x9A71;&#x52A8;&#x3002;<br>&#x63A7;&#x5236;&#x5C42;&#x9762;&#x5728; <code>1.12</code> &#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>gossip</code> &#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5C42;&#x7684;&#x9A71;&#x52A8;&#xFF08;<code>macvlan</code>, <code>ipvlan</code>, &#x6216;&#x8005;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x673A;&#x5236;&#x652F;&#x6301;&#x7684; <code>ovs</code> &#x7B49;&#xFF09;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x79CD;&#x901A;&#x4FE1;&#x662F;&#x53EF;&#x6269;&#x5C55;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x5B89;&#x5168;&#x7684;&#xFF08;TLS&#xFF09;&#x3002;</p><h3 id="ti-gong-nei-zhi-de-fu-wu-fa-xian-yi-ji-fu-zai-jun-heng"><a href="#&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#ti-gong-nei-zhi-de-fu-wu-fa-xian-yi-ji-fu-zai-jun-heng" class="header-anchor">#</a></h3><p>&#x4ECE; <code>1.10</code> &#x540E;&#x5F15;&#x5165;&#x4E86; <code>DNS</code> &#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x670D;&#x52A1;&#x540D;&#x3001;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x7F51;&#x7EDC;&#x522B;&#x540D;&#x6765;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;&#x5728; <code>1.12</code> &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x57FA;&#x4E8E; <code>Virtual IP</code> &#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4E4B;&#x524D;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>DNS&#x8F6E;&#x8BE2;</code>(<code>dnsrr</code>) &#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p><h3 id="yun-xu-sheng-tai-xi-tong-kuo-zhan"><a href="#&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55;" class="headerlink" title="&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55;"></a>&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55; <a href="#yun-xu-sheng-tai-xi-tong-kuo-zhan" class="header-anchor">#</a></h3><h2 id="docker-1-12-swarm-mode-de-xin-de-te-xing"><a href="#Docker-1-12-Swarm-Mode-&#x7684;&#x65B0;&#x7684;&#x7279;&#x6027;" class="headerlink" title="Docker 1.12 Swarm Mode &#x7684;&#x65B0;&#x7684;&#x7279;&#x6027;"></a>Docker 1.12 Swarm Mode &#x7684;&#x65B0;&#x7684;&#x7279;&#x6027; <a href="#docker-1-12-swarm-mode-de-xin-de-te-xing" class="header-anchor">#</a></h2><ul><li>Cluster aware</li><li>&#x53BB;&#x4E2D;&#x5FC3;&#x5316;&#x7684;&#x63A7;&#x5236;&#x5C42;</li><li>&#x9AD8;&#x5EA6;&#x53EF;&#x6269;&#x5C55;</li></ul><p>&#x5728; <code>1.12</code> &#x4E2D;&#xFF0C;<code>CNM</code> (Container Networking Model) &#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x96C6;&#x7FA4;&#x6240;&#x9700;&#x7684;&#x7279;&#x6027;&#xFF1A;</p><ul><li>&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;&#x65E0;&#x9700;&#x5916;&#x7F6E;key-value store</li></ul><p>&#x5728; <code>1.9</code> ~ <code>1.11</code> &#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8054;&#xFF0C;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5916;&#x7F6E;&#x952E;&#x503C;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x5728; <code>1.12</code> &#x7684; Swarm Mode &#x4E0B;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;</p><ul><li><code>1.12</code> &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x52A0;&#x5BC6;&#x7684;&#x6570;&#x636E;&#x5C42;&#x3001;&#x63A7;&#x5236;&#x5C42;</li><li>&#x670D;&#x52A1;&#x53D1;&#x73B0;</li><li>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF1A;<code>1.10</code> ~ <code>1.11</code> &#x53EF;&#x4EE5;&#x7528;<code>DNS&#x8F6E;&#x8BE2;</code>&#xFF1B;<code>1.12</code>&#x5F15;&#x5165;&#x4E86; <code>VIP</code>&#x3002;</li><li><code>1.12</code> &#x5F15;&#x5165;&#x4E86;Mesh&#x8DEF;&#x7531;</li></ul><h2 id="macvlan-qu-dong"><a href="#Macvlan-&#x9A71;&#x52A8;" class="headerlink" title="Macvlan &#x9A71;&#x52A8;"></a>Macvlan &#x9A71;&#x52A8; <a href="#macvlan-qu-dong" class="header-anchor">#</a></h2><ul><li>&#x4ECE; <code>1.11</code> &#x4F5C;&#x4E3A;&#x8BD5;&#x9A8C;&#x9A71;&#x52A8;&#x5F15;&#x5165;&#xFF0C;&#x73B0;&#x5728;&#x79BB;&#x5F00;&#x8BD5;&#x9A8C;&#x72B6;&#x6001;&#x4E86;</li><li>&#x548C;&#x4E0B;&#x5C42;&#x96C6;&#x6210;</li><li>&#x5C06;&#x5BB9;&#x5668;&#x7F6E;&#x4E8E;&#x73B0;&#x6709;<code>VLan</code>&#x73AF;&#x5883;</li></ul><p>&#x521B;&#x5EFA; macvlan &#x7F51;&#x7EDC;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d macvlan \</span><br><span class="line">    --subnet=192.168.0.0/16 \</span><br><span class="line">    --ip-range=192.168.41.0/24 \</span><br><span class="line">    --aux-address=<span class="string">&quot;favorite_ip_ever=192.168.41.2&quot;</span> \</span><br><span class="line">    --gateway=192.168.41.1 \</span><br><span class="line">    -o parent=eth0.41 \</span><br><span class="line">    macnet41</span><br></pre></td></tr></table></figure><p>&#x67E5;&#x770B;IP&#x5730;&#x5740;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --net=macnet41 -it --rm alpine /bin/sh</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x6837;&#x5B50;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x5C06;&#x4F1A;&#x76F4;&#x63A5;&#x9001;&#x5230;&#x4E0B;&#x5C42;<code>vlan</code>&#x3002;&#x8FD9;&#x662F;&#x76EE;&#x524D;&#x6700;&#x9AD8;&#x7F51;&#x7EDC;&#x6548;&#x7387;&#x7684;&#x9A71;&#x52A8;&#x3002;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;<code>NAT</code>&#xFF0C;&#x6CA1;&#x6709;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x901A;&#x8BAF;&#x76F4;&#x63A5;&#x901A;&#x8FC7;VLan&#x9001;&#x51FA;&#x3002;</p><p><code>Macvlan</code> &#x9A71;&#x52A8;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5229;&#x7528;&#x7684; Linux <code>macvlan</code> &#x5185;&#x6838;&#x9A71;&#x52A8;&#xFF0C;&#x8BE5;&#x9A71;&#x52A8;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x6838;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x5927;&#x7EA6;&#x4ECE; <code>Linux 3.2</code> &#x5F00;&#x59CB;&#x5C31;&#x5728;&#x5185;&#x6838;&#x91CC;&#x4E86;&#x3002;</p><p><em>&#x6CE8;&#xFF1A;&#x5B9E;&#x9645;&#x4E0A;&#x662F;2007&#x5E74; <code>2.6.23</code> &#x5C31;&#x52A0;&#x5165;&#x5185;&#x6838;&#x4E86;&#xFF0C;&#x540E;&#x6765;&#x5728; <code>2.6.33</code>, <code>3.9</code>, <code>3.16</code> &#x7B49;&#x4E2D;&#x8FDB;&#x884C;&#x8FC7;&#x6539;&#x8FDB;&#xFF0C;&#x800C;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x65B0;&#x7684; <code>ipvlan</code> &#x662F;&#x5728; Linux &#x5185;&#x6838; <code>3.19</code> &#x5F15;&#x5165;&#x7684;&#x3002;</em></p><h1 id="shen-ru"><a href="#&#x6DF1;&#x5165;" class="headerlink" title="&#x6DF1;&#x5165;"></a>&#x6DF1;&#x5165; <a href="#shen-ru" class="header-anchor">#</a></h1><p>by Jana Radhakrishnan</p><h2 id="duo-rong-qi-wang-luo"><a href="#&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;" class="headerlink" title="&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;"></a>&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC; <a href="#duo-rong-qi-wang-luo" class="header-anchor">#</a></h2><ul><li>&#x57FA;&#x4E8E; VXLAN &#x7684;&#x6570;&#x636E;&#x8DEF;&#x5F84;&#x5E76;&#x672A;&#x6539;&#x53D8;</li><li>&#x65E0;&#x9700;&#x989D;&#x5916;&#x7684;&#x952E;&#x503C;&#x5E93;</li><li>&#x96C6;&#x4E2D;&#x8D44;&#x6E90;&#x5206;&#x914D;</li><li>&#x6539;&#x8FDB;&#x6027;&#x80FD;</li><li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;&#x6027;</li></ul><h2 id="wang-luo-kong-zhi-ceng-mian"><a href="#&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762;" class="headerlink" title="&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762;"></a>&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762; <a href="#wang-luo-kong-zhi-ceng-mian" class="header-anchor">#</a></h2><p>&#x63A7;&#x5236;&#x5C42;&#x9762;&#x57FA;&#x672C;&#x4E0A;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x8DEF;&#x7531;&#x534F;&#x8BAE;&#x3002;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x4F7F;&#x7528; <code>BGP</code>&#xFF0C;&#x867D;&#x7136; <code>BGP</code> &#x53EF;&#x4EE5;&#x652F;&#x6301;&#x975E;&#x5E38;&#x590D;&#x6742;&#x5927;&#x578B;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x95EE;&#x9898;&#x662F;&#x65E0;&#x6CD5;&#x5FEB;&#x901F;&#x6536;&#x655B;&#x3002;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x800C;&#x8A00;&#xFF0C;&#x5FEB;&#x901F;&#x6536;&#x655B;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x57FA;&#x4E8E; <code>gossip</code> &#x534F;&#x8BAE;&#x3002;</p><p><a href="https://www.cs.cornell.edu/~asdas/research/dsn02-swim.pdf" target="_blank" rel="noopener">https://www.cs.cornell.edu/~asdas/research/dsn02-swim.pdf</a></p><ul><li>&#x57FA;&#x4E8E; Gossip &#x7684;&#x534F;&#x8BAE;</li><li>&#x63A7;&#x5236; <code>gossip</code> &#x5E7F;&#x64AD;&#x63A7;&#x5236;&#x5728;&#x67D0;&#x4E2A;&#x7F51;&#x7EDC; scope &#x5185;&#xFF08;&#x964D;&#x4F4E;&#x6D41;&#x91CF;&#x3001;&#x5FEB;&#x901F;&#x6536;&#x655B;&#xFF09;</li><li>&#x5FEB;&#x901F;&#x6536;&#x655B;</li><li>&#x9ED8;&#x8BA4;&#x5B89;&#x5168;<ul><li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li><li>swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li></ul></li><li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;</li></ul><h2 id="an-quan-shu-ju-ceng"><a href="#&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42;" class="headerlink" title="&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42;"></a>&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42; <a href="#an-quan-shu-ju-ceng" class="header-anchor">#</a></h2><ul><li>&#x5728;&#x521B;&#x5EFA; <code>overlay</code> &#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#x4F5C;&#x4E3A;&#x9009;&#x9879;&#x63D0;&#x4F9B;&#xFF0C;&#x6CE8;&#xFF1A;<code>--opt secure</code></li><li>&#x4F7F;&#x7528; Linux &#x5185;&#x6838; <code>IPSec</code> &#x9A71;&#x52A8;</li><li>&#x6309;&#x9700;&#x901A;&#x9053;&#x8BBE;&#x7F6E;</li><li>Swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li><li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li><li>&#x9AD8;&#x6027;&#x80FD;</li></ul><p>&#x6CE8;&#x610F;&#x542F;&#x7528;&#x540E;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x670D;&#x52A1;&#x81EA;&#x8EAB;&#x652F;&#x6301;&#x5B89;&#x5168;&#x901A;&#x8BAF;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5185;&#x7F6E;&#x7684;&#x5B89;&#x5168;&#x52A0;&#x5BC6;&#x673A;&#x5236;&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5B89;&#x5168;&#x52A0;&#x5BC6;&#x673A;&#x5236;&#x7684;&#x901A;&#x8BAF;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E14;&#x670D;&#x52A1;&#x7F6E;&#x4E8E;&#x516C;&#x7F51;&#x4E4B;&#x4E0A;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x5B89;&#x5168;&#x52A0;&#x5BC6;&#x901A;&#x9053;&#x3002;</p><h2 id="fu-wu-fa-xian"><a href="#&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#fu-wu-fa-xian" class="header-anchor">#</a></h2><ul><li>&#x7531;&#x5185;&#x7F6E;&#x7684; DNS &#x63D0;&#x4F9B;&#xFF08;&#x4ECE; <code>1.10</code> &#x5F00;&#x59CB;&#xFF09;</li><li>&#x9AD8;&#x53EF;&#x7528;</li><li>&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x53BB;&#x5F97;&#x77E5;&#x72B6;&#x6001;</li><li>&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x53D1;&#x73B0;&#x670D;&#x52A1;(<code>service</code>)&#x548C;&#x4EFB;&#x52A1;(<code>task</code>)</li></ul><p>&#x9ED8;&#x8BA4;&#x4F7F;&#x7528; <code>docker service create</code> &#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5728;&#x8BF7;&#x6C42; DNS &#x89E3;&#x6790;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;&#x5176;&#x865A;&#x62DF;IP (<code>Virtual IP</code>)&#xFF0C;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684; <code>Endpoint</code> &#x662F; <code>vip</code>&#x3002;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x6307;&#x5B9A;&#x5176;&#x4E3A; <code>dnsrr</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; DNS &#x8F6E;&#x8BE2;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BF7;&#x6C42; DNS &#x670D;&#x52A1;&#x65F6;&#x89E3;&#x6790;&#x5230;&#x7684;&#x5C31;&#x662F;&#x591A;&#x4E2A; DNS &#x8BB0;&#x5F55;&#xFF0C;&#x53CD;&#x5E94;&#x7684;&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x7684;IP&#x5730;&#x5740;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x5927;&#x90E8;&#x5206;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F7F;&#x7528; <code>vip</code> &#x6A21;&#x5F0F;&#xFF1B;&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x975E;&#x5E38;&#x5E0C;&#x671B;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#xFF08;&#x6BD4;&#x5982;&#x5229;&#x7528;DNS&#x7F13;&#x5B58;&#x4EC0;&#x4E48;&#x7684;&#xFF09;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>dnsrr</code> &#x6765;&#x8FD4;&#x56DE;&#x591A;&#x4E2A;IP&#x3002;</p><p>&#x76EE;&#x524D;&#x4F7F;&#x7528;&#x975E; FQDN&#xFF0C;&#x4E3B;&#x8981;&#x8003;&#x8651;&#x7684;&#x662F;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>FQDN</code>&#xFF0C;&#x90A3;&#x4E48;&#x66F4;&#x6362;&#x73AF;&#x5883;&#x540E;&#xFF0C;<code>FQDN</code> &#x6539;&#x53D8;&#x4F1A;&#x5BFC;&#x81F4;&#x6269;&#x5C55;&#x6027;&#x53D8;&#x5DEE;&#x3002;&#x56E0;&#x6B64;&#x76EE;&#x524D; Docker&#x5B9E;&#x73B0;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x975E;<code>FQDN</code>&#x7684;&#x5F62;&#x5F0F;&#x7684;&#x670D;&#x52A1;&#x540D;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p><p>&#x5185;&#x7F6E;&#x7684;DNS&#x8BF7;&#x6C42;&#x4F1A;&#x4F9D;&#x636E;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x53D1;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x89E3;&#x6790;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x53D1;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5185;&#x7F6E;DNS&#x4F1A;&#x77E5;&#x9053;&#x8BF7;&#x6C42;&#x662F;&#x4ECE;&#x8C01;&#x53D1;&#x6765;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x5B83;&#x6240;&#x5904;&#x4E8E;&#x54EA;&#x4E9B;&#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x8FD4;&#x56DE;&#x8BE5;&#x5BB9;&#x5668;&#x6240;&#x9700;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><h2 id="nei-zhi-fu-zai-jun-heng"><a href="#&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#nei-zhi-fu-zai-jun-heng" class="header-anchor">#</a></h2><p>&#x5728; <code>1.12</code> &#x4E2D;&#x5F15;&#x5165;&#x7684;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p><p>&#x9996;&#x5148;&#x901A;&#x8FC7;<code>DNS</code>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>&#x865A;&#x62DF;IP</code>&#xFF0C;&#x8FD9;&#x4E2A;<code>&#x865A;&#x62DF;IP</code>&#x662F;&#x4E0D;&#x4F1A;&#x53D8;&#x5316;&#x7684;&#x3002;&#x8FD9;&#x4E2A;<code>&#x865A;&#x62DF;IP</code>&#x662F;&#x5728;&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x662F;&#x6240;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;update&#xFF0C;&#x8FD9;&#x4E2A;IP&#x4E5F;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#x5C42;&#x6846;&#x67B6;&#x662F;&#x5426;&#x9075;&#x5FAA;&#x4E86;<code>DNS TTL</code>&#x7684;&#x7EA6;&#x5B9A;&#x3002;&#x800C;&#x4F7F;&#x7528;<code>DNS-RR</code>&#xFF0C;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x4F1A;&#x968F;&#x673A;&#x4E71;&#x5E8F;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x5DF2;&#x8FBE;&#x5230;&#x4E0D;&#x540C;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x4F46;&#x662F;&#x5E94;&#x7528;&#x5C42;&#x7684;DNS&#x5B9E;&#x73B0;&#x7684;&#x7F3A;&#x9677;&#x53EF;&#x80FD;&#x4F1A;&#x65E0;&#x6CD5;&#x5229;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x6CA1;&#x9519;&#xFF0C;Java&#x540C;&#x5B66;&#xFF0C;&#x8BF4;&#x4F60;&#x5462;&#x2026;&#x2026;</em>&#xFF09;&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x4EBA;&#x79F0; <code>DNS-RR</code> &#x662F; <strong>poor man&#x2019;s load balancer</strong>&#x3002;</p><p><code>1.12</code> &#x5F15;&#x5165;&#x7684; <code>vip</code> &#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x662F;&#x57FA;&#x4E8E; Linux &#x5185;&#x6838;&#x7684; <code>ipvs</code> &#x9A71;&#x52A8;&#xFF0C;&#x662F;&#x975E;&#x5E38;&#x7A33;&#x5B9A;&#x7684;&#x4E00;&#x4E2A;&#x9A71;&#x52A8;&#xFF0C;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x6838;&#x5341;&#x591A;&#x5E74;&#x4E86;&#x3002;</p><p>&#x5728;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709;&#x96C6;&#x4E2D;&#x5F0F;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x5185;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x865A;&#x62DF;IP&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x548C;&#x5E94;&#x7528;&#x8BBF;&#x95EE;&#x865A;&#x62DF;IP&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x865A;&#x62DF;IP&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x53BB;&#x51B3;&#x5B9A;&#x8BE5;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x54EA;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x56E0;&#x6B64;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5355;&#x70B9;&#x6545;&#x969C;&#x3002;</p><p>&#x5B9E;&#x73B0;&#x4E0A;&#xFF0C;&#x4F7F;&#x7528; <code>iptables</code> &#x53BB;trap <code>&#x865A;&#x62DF;ip</code>&#x7684;&#x8BBF;&#x95EE;&#xFF0C;&#x8F6C;&#x5230;&#x5185;&#x6838; <code>ipvs</code> &#x53BB;&#x9009;&#x62E9;&#x670D;&#x52A1;IP&#x5217;&#x8868;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#xFF0C;&#x7136;&#x540E;&#x8F6C;&#x53D1;&#x8BBF;&#x95EE;&#x3002;</p><h2 id="mesh-lu-you"><a href="#Mesh-&#x8DEF;&#x7531;" class="headerlink" title="Mesh &#x8DEF;&#x7531;"></a>Mesh &#x8DEF;&#x7531; <a href="#mesh-lu-you" class="header-anchor">#</a></h2><p>Mesh &#x8DEF;&#x7531;&#x540C;&#x6837;&#x4E5F;&#x662F;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x673A;&#x5236;</p><ul><li>&#x4E3A;&#x8FB9;&#x754C;&#x8DEF;&#x7531;&#x5185;&#x7F6E;&#x4E86; mesh &#x8DEF;&#x7531;</li><li>Worker &#x8282;&#x70B9;&#x4E5F;&#x53C2;&#x4E0E; <code>ingress</code> &#x7684; mesh &#x8DEF;&#x7531;</li><li>&#x6240;&#x6709;&#x7684;worker&#x8282;&#x70B9;&#x90FD;&#x63A5;&#x53D7;&#x6765;&#x81EA; <code>PublishedPort</code> &#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</li><li>&#x7AEF;&#x53E3;&#x8F6C;&#x63A5;&#x53D1;&#x751F;&#x5728;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;</li><li>&#x4F7F;&#x7528;&#x7684;&#x662F;&#x548C;&#x4E4B;&#x524D;&#x6240;&#x8FF0;&#x7684;&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4E00;&#x6837;&#x7684;&#x673A;&#x5236;&#x53BB;&#x63A5;&#x53D7;&#x5916;&#x90E8;&#x8BF7;&#x6C42;</li></ul><p>&#x4F5C;&#x4E3A;&#x7528;&#x6237;&#xFF0C;&#x4F7F;&#x7528; mesh &#x8DEF;&#x7531;&#xFF0C;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53EA;&#x8981;&#x58F0;&#x660E;&#x4E86; <code>PublishedPort</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>--publish</code> &#x540E;&#xFF0C;&#x5404;&#x4E2A; worker &#x8282;&#x70B9;&#x5C31;&#x4F1A;&#x8FDB;&#x884C; mesh &#x8DEF;&#x7531;&#x3002;</p><h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x9996;&#x5148;&#x7528; <code>docker swarm init</code> &#x548C; <code>docker swarm join</code> &#x5EFA;&#x7ACB;&#x4E86; <code>1+2</code> &#x4E09;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x3002;</p><p>&#x7136;&#x540E;&#x67E5;&#x770B; <code>netns</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ls /var/run/docker/netns</span><br><span class="line">1-9cycns5i9w    f681820dbdc5</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x662F; <code>overlay network</code> &#x6C99;&#x7BB1;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F; <code>ingress</code> &#x7684;&#x7F51;&#x7EDC;&#x3002;</p><p>&#x68C0;&#x67E5; <code>iptables</code> &#x89C4;&#x5219;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -t nat -nvL</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x9762;&#x7684; <code>DOCKER-INGRESS</code> chain&#x3002;&#x76EE;&#x524D;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x73B0;&#x5728;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">--name sw \</span><br><span class="line">-p 8080:80 \</span><br><span class="line">--replicas 3 \</span><br><span class="line">mrjana/simpleweb</span><br><span class="line">simpleweb</span><br></pre></td></tr></table></figure><p>&#x518D;&#x6B21;&#x68C0;&#x67E5; <code>iptables</code> &#x4E2D;&#x7684; <code>DOCKER-INGRESS</code> chain&#x3002;&#x4F1A;&#x53D1;&#x73B0;&#x591A;&#x4E86;2&#x6761;&#x8BB0;&#x5F55;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x6307;&#x5B9A;&#x4E86;&#x76EE;&#x6807;&#x4E3A; <code>tcp dpt:8080</code> &#x7684;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x5230; <code>172.19.0.2:8080</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nsenter --net=/var/run/docker/netns/f681820dbdc5 bash</span><br></pre></td></tr></table></figure><p>&#x1F613;&#x2026;&#x2026;&#x5F88;&#x4E0D;&#x5E78;&#xFF0C;&#x8FD9;&#x673A;&#x5668;&#x6CA1;&#x88C5; <code>nsenter</code>&#xFF0C;&#x4E8E;&#x662F;&#x6362;&#x4E2A;&#x529E;&#x6CD5;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/run/netns</span><br><span class="line">touch /var/run/netns/n</span><br><span class="line">mount -o <span class="built_in">bind</span> /var/run/docker/netns/f681820dbdc5 /var/run/netns/n</span><br><span class="line">ip netns <span class="built_in">exec</span> n bash</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x8FD9;&#x4E2A; ingress &#x7684;&#x6C99;&#x7BB1;&#x4E86;(<code>netns</code>)&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x6267;&#x884C; <code>ifconfig</code> &#x67E5;&#x770B;&#x5176;&#x63A5;&#x53E3;&#x4FE1;&#x606F;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -nvL</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t mangle -nvL</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -L</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x5728; <code>POSTROUTING</code> &#x90E8;&#x5206;&#x770B;&#x5230;&#x6539;&#x53D8;&#x4E86;&#x6E90;IP&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x5F53;&#x6570;&#x636E;&#x5305;&#x8FD4;&#x56DE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x7ECF;&#x8FC7; <code>ingress</code> &#x7F51;&#x7EDC;&#xFF0C;&#x7531; <code>ipvs</code> &#x6765;&#x51B3;&#x5B9A;&#x9001;&#x56DE;&#x5230;&#x54EA;&#x91CC;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x6211;&#x4EEC;&#x6539;&#x53D8;&#x4E86;&#x7AEF;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x9700;&#x8981;&#x4ECE;&#x8FD9;&#x91CC;&#x7ECF;&#x8FC7;&#x6765;&#x5C06;&#x7AEF;&#x53E3;&#x6362;&#x56DE;&#x6765;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 运维 - Docker Storage 和 Volumes 进阶指南 - Brian Goff</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-26-video-docker-for-ops-docker-storage-and-volumes-deep-dive-and-considerations.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-26-video-docker-for-ops-docker-storage-and-volumes-deep-dive-and-considerations.html</id>
    <published>2016-07-25T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.621Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#image-yu-container-cun-chu">Image &#x4E0E; Container &#x5B58;&#x50A8;</a><ul><li><a href="#wo-ying-gai-xuan-ze-na-ge-storage-driver">&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A; <code>storage driver</code>&#xFF1F;</a></li><li><a href="#ru-he-zhi-ding-storage-driver">&#x5982;&#x4F55;&#x6307;&#x5B9A; Storage Driver&#xFF1F;</a></li></ul></li><li><a href="#persistent-storage">Persistent Storage</a><ul><li><a href="#docker-shi-wei-wu-zhuang-tai-ying-yong-zhun-bei-de">Docker &#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01;</a></li><li><a href="#wo-yao-zen-me-zai-docker-li-xx">&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728; Docker &#x91CC; XX &#xFF1F;</a></li><li><a href="#storage-fei-chang-kun-nan">Storage &#x975E;&#x5E38;&#x56F0;&#x96BE;</a></li><li><a href="#create-a-volume">Create a volume</a></li><li><a href="#create-a-volume-nfs">Create a volume - NFS</a></li><li><a href="#create-a-volume-btrfs">Create a volume - BTRFS</a></li><li><a href="#create-a-volume-gluster">Create a volume - Gluster</a></li><li><a href="#create-a-volume-swarm-mode">Create a volume - Swarm Mode</a></li></ul></li><li><a href="#qa">QA</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon16 - Docker for Ops - Docker Storage and Volumes Deep Dive and Considerations<br>by Brian Goff, Core Engineer, @cpuguy83</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/X_q2l8hotAc" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=X_q2l8hotAc" target="_blank" rel="noopener">https://www.youtube.com/watch?v=X_q2l8hotAc</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=m03195b0m96&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/m03195b0m96.html" target="_blank" rel="noopener">http://v.qq.com/x/page/m03195b0m96.html</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x5728; GitHub &#x4E0A;&#x53EB; <a href="https://github.com/cpuguy83" target="_blank" rel="noopener">cpuguy83</a>&#x3002;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528; Docker 3 &#x5E74;&#x4E86;&#x3002;&#x66FE;&#x7ECF;&#x90E8;&#x7F72;&#x5931;&#x8D25;&#xFF0C;&#x56E0;&#x4E3A;<code>yaml</code>&#x7684;&#x4F9D;&#x8D56;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x540E;&#x6765;&#x5F00;&#x59CB;&#x63A5;&#x89E6; Docker&#xFF0C;&#x751A;&#x81F3;&#x5B66;&#x4E60; Go&#xFF0C;&#x7136;&#x540E;&#x9010;&#x6B65;&#x7684;&#x53D8;&#x4E3A;&#x5F88;&#x6DF1;&#x5165;&#x7684; Docker &#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x3002;</p><h1 id="image-yu-container-cun-chu"><a href="#Image-&#x4E0E;-Container-&#x5B58;&#x50A8;" class="headerlink" title="Image &#x4E0E; Container &#x5B58;&#x50A8;"></a>Image &#x4E0E; Container &#x5B58;&#x50A8; <a href="#image-yu-container-cun-chu" class="header-anchor">#</a></h1><p>Docker &#x79F0;&#x5176;&#x4E3A; <code>Storage Driver</code> &#xFF0C;&#x5185;&#x90E8;&#x53EB;&#x5B83; <code>Graph Driver</code>&#x3002;</p><p>&#x6BCF;&#x6B21;&#x5F53; <code>docker pull</code> &#x6216; <code>docker run</code> &#x4E4B;&#x540E;&#xFF0C;Docker &#x4ECE; Hub &#x4E4B;&#x7C7B;&#x7684;&#x53D6;&#x56DE; Image&#xFF0C;&#x800C; <strong>Image &#x662F;&#x4E00;&#x5806;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;&#x7684;&#x96C6;&#x5408;</strong>&#x3002;<code>Storage Driver</code> &#x8D1F;&#x8D23;&#x628A;&#x8FD9;&#x4E9B;&#x5C42;&#x6574;&#x5408;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7ED9;&#x5BB9;&#x5668;&#x3002;</p><h2 id="wo-ying-gai-xuan-ze-na-ge-storage-driver"><a href="#&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A;-storage-driver&#xFF1F;" class="headerlink" title="&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A; storage driver&#xFF1F;"></a>&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A; <code>storage driver</code>&#xFF1F; <a href="#wo-ying-gai-xuan-ze-na-ge-storage-driver" class="header-anchor">#</a></h2><table><thead><tr><th>&#x5B58;&#x50A8;&#x9A71;&#x52A8;</th><th>&#x7C7B;&#x578B;</th><th>&#x5185;&#x6838;&#x652F;&#x6301;</th><th>&#x7A7A;&#x95F4;&#x914D;&#x989D;</th><th>&#x95EE;&#x9898;&#x6307;&#x6570;</th></tr></thead><tbody><tr><td><code>AUFS</code></td><td>FS</td><td>No</td><td>No</td><td>1</td></tr><tr><td><code>BTRFS</code></td><td>Block</td><td>Yes</td><td>No</td><td>5</td></tr><tr><td><code>DeviceMapper</code></td><td>Block</td><td>Yes</td><td>Yes</td><td>6</td></tr><tr><td><code>Overlay</code></td><td>FS</td><td>Yes</td><td>No</td><td>5</td></tr><tr><td><code>Overlay2</code></td><td>FS</td><td>Yes</td><td>No</td><td>3</td></tr><tr><td><code>ZFS</code></td><td>Block</td><td>No</td><td>Yes</td><td>1</td></tr></tbody></table><p><code>AUFS</code> &#x5B58;&#x5728;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x5230;&#x4ECA;&#x5929;&#x5DF2;&#x7ECF;&#x5F88;&#x7A33;&#x5B9A;&#x4E86;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E; docker &#x4F7F;&#x7528;&#x800C;&#x8A00;&#xFF0C;&#x4E0D;&#x5927;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x3002;</p><p><code>DeviceMapper</code>&#x662F;&#x6BD4;&#x8F83;&#x8001;&#x7684;&#x6280;&#x672F;&#x4E86;&#xFF0C;&#x603B;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x3002;</p><p><code>Overlay</code> &#x7B2C;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x662F;&#x4F7F;&#x7528; <code>3.18</code> &#x4EE5;&#x4E0A;&#x7684;&#x5185;&#x6838;&#xFF0C;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#x6B20;&#x7F3A;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x5F88;&#x591A; <code>hard link</code>&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4; <code>inode</code> &#x8FC7;&#x591A;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5728; <code>4.0</code> &#x5185;&#x6838;&#x4EE5;&#x4E0A;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5728; <code>Docker 1.12</code> &#x6709;&#x4E86; <code>Overlay2</code> &#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p><p><code>ZFS</code> &#x5F88;&#x8001;&#x724C;&#x7684;&#x5B58;&#x50A8;&#x4ECB;&#x8D28;&#xFF0C;&#x5F88;&#x7A33;&#x5B9A;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7; Linux Kernel &#x662F;&#x4E0D;&#x4F1A;&#x652F;&#x6301;&#x4E86;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x6240;&#x6709;&#x7684; <code>Block</code> &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x90FD;&#x652F;&#x6301;<code>&#x78C1;&#x76D8;&#x914D;&#x989D;</code>&#xFF0C;&#x4F46;&#x662F; <code>FS</code> &#x7684;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x3002;<code>Docker 1.12</code> &#x4EE5;&#x540E;&#x652F;&#x6301; &#x914D;&#x989D; &#x4E86;&#x3002;</p><h2 id="ru-he-zhi-ding-storage-driver"><a href="#&#x5982;&#x4F55;&#x6307;&#x5B9A;-Storage-Driver&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x6307;&#x5B9A; Storage Driver&#xFF1F;"></a>&#x5982;&#x4F55;&#x6307;&#x5B9A; Storage Driver&#xFF1F; <a href="#ru-he-zhi-ding-storage-driver" class="header-anchor">#</a></h2><p><code>1.10</code> &#x4EE5;&#x540E;&#xFF0C;<code>Docker Daemon</code> &#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>JSON</code> &#x6587;&#x4EF6;&#x914D;&#x7F6E; <code>Docker Daemon</code> &#x4E86;&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x6307;&#x5B9A; <code>storage driver</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&apos;{ &quot;storage-driver&quot;: &quot;overlay2&quot; }&apos;</span> &gt; /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>&#x6539;&#x53D8; <code>storage driver</code> &#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x673A;&#x5668;&#x4E0A;&#x6240;&#x6709;&#x7684; <code>image</code>&#x3001;&#x5BB9;&#x5668;&#x90FD;&#x4E0D;&#x89C1;&#x4E86;&#xFF0C;&#x5F88;&#x591A;&#x4EBA; freaking out &#x4E86;&#x3002;&#x5176;&#x5B9E;&#x4E1C;&#x897F;&#x6CA1;&#x4E22;&#xFF0C;&#x8FD8;&#x5728;&#x90A3;&#x91CC;&#xFF0C;&#x4F46;&#x95EE;&#x9898;&#x662F; Docker &#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x53EA;&#x80FD;&#x652F;&#x6301;&#x4E00;&#x4E2A; Storage Driver&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x628A; Storage driver &#x518D;&#x6362;&#x56DE;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x5BFC;&#x51FA;&#x3001;&#x4FDD;&#x5B58;&#x955C;&#x50CF;&#x5565;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x653E;&#x5230;&#x65B0;&#x7684; storage driver &#x4E2D;&#x53BB;&#x3002;</p><h1 id="persistent-storage"><a href="#Persistent-Storage" class="headerlink" title="Persistent Storage"></a>Persistent Storage <a href="#persistent-storage" class="header-anchor">#</a></h1><p>&#x5728; Docker &#x4E2D;&#x88AB;&#x79F0;&#x4E3A; <code>Volumes</code>&#xFF0C;&#x8FD9;&#x662F;&#x5728;&#x5BB9;&#x5668;&#x751F;&#x5B58;&#x5468;&#x671F;&#x4E4B;&#x5916;&#xFF0C;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x5730;&#x65B9;&#x3002;</p><h2 id="docker-shi-wei-wu-zhuang-tai-ying-yong-zhun-bei-de"><a href="#Docker-&#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01;" class="headerlink" title="Docker &#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01;"></a>Docker &#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01; <a href="#docker-shi-wei-wu-zhuang-tai-ying-yong-zhun-bei-de" class="header-anchor">#</a></h2><p><strong>&#x8FD9;&#x8BF4;&#x6CD5;&#x5176;&#x5B9E;&#x4E0D;&#x5BF9;</strong>&#x3002;</p><p>&#x4E25;&#x683C;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x786E;&#x5B9E;&#x66F4;&#x5BB9;&#x6613;&#x8FC1;&#x79FB;&#x5230; Docker &#x4E0A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B8C;&#x5168;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x5B58;&#x50A8;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x8BF4; Docker &#x5C31;&#x5C40;&#x9650;&#x4E8E;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x4E86;&#x3002;</p><p>Brian &#x81EA;&#x5DF1;&#x6240;&#x5728;&#x516C;&#x53F8;&#x5C31;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6240;&#x6709;&#x90FD;&#x5728; Docker &#x91CC;&#xFF0C;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x3001;Web apps&#x3001;Redis &#x5230;VPN tunnel&#x3002;</p><h2 id="wo-yao-zen-me-zai-docker-li-xx"><a href="#&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728;-Docker-&#x91CC;-XX-&#xFF1F;" class="headerlink" title="&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728; Docker &#x91CC; XX &#xFF1F;"></a>&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728; Docker &#x91CC; XX &#xFF1F; <a href="#wo-yao-zen-me-zai-docker-li-xx" class="header-anchor">#</a></h2><p>&#x6BD4;&#x5982;&#x5982;&#x4F55;&#x5728; Docker &#x91CC;&#x5B58;&#x6570;&#x636E;&#x5E93;&#xFF1F;&#x5982;&#x4F55;&#x5907;&#x4EFD;&#x6570;&#x636E;&#xFF1F;&#x5982;&#x4F55;&#x8FC1;&#x79FB;&#x6570;&#x636E;&#xFF1F;</p><p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x7684;&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; Docker&#xFF0C;&#x8FD9;&#x4E9B;&#x4E8B;&#x60C5;&#x600E;&#x4E48;&#x505A;&#x7684;&#xFF1F;&#x56E0;&#x4E3A;Docker&#x975E;&#x5E38;&#x7684;&#x7B80;&#x5355;&#xFF0C;&#x5E73;&#x65F6;shell&#x4E0B;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x7684;&#xFF0C;Docker&#x5C31;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x3002;&#x5E73;&#x65F6;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5982;&#x4F55;&#x505A;&#xFF0C;Docker&#x91CC;&#x9762;&#x5C31;&#x5982;&#x4F55;&#x505A;&#x3002;&#x4E00;&#x5207;&#x90FD;&#x5F88;&#x81EA;&#x7136;&#x3002;</p><p>Docker &#x5E76;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#x8BA1;&#x7B97;&#x73AF;&#x5883;&#x3002;</p><p>&#x5BB9;&#x5668;&#x7684;&#x610F;&#x4E49;&#x4E0D;&#x5728;&#x4E8E;&#x5BB9;&#x5668;&#x672C;&#x8EAB;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x610F;&#x4E49;&#x5728;&#x4E8E;&#x62BD;&#x8C61;&#x67B6;&#x6784;&#xFF0C;&#x5E76;&#x4E14;&#x5173;&#x6CE8;&#x4E8E;&#x5E94;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5173;&#x6CE8;&#x4E8E;&#x6784;&#x5EFA;&#x672C;&#x8EAB;&#x3002;</p><h2 id="storage-fei-chang-kun-nan"><a href="#Storage-&#x975E;&#x5E38;&#x56F0;&#x96BE;" class="headerlink" title="Storage &#x975E;&#x5E38;&#x56F0;&#x96BE;"></a>Storage &#x975E;&#x5E38;&#x56F0;&#x96BE; <a href="#storage-fei-chang-kun-nan" class="header-anchor">#</a></h2><p>Brian &#x95EE;&#x5927;&#x5BB6;&#x8C01;&#x4E22;&#x5931;&#x8FC7;&#x6570;&#x636E;&#xFF0C;&#x5373;&#x4F7F;&#x6709;&#x5907;&#x4EFD;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x5907;&#x4EFD;&#x7684;&#x8BBE;&#x5907;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x574F;&#x4E86;&#xFF0C;&#x4E4B;&#x524D;&#x6CA1;&#x6CE8;&#x610F;&#x5230;&#xFF1B;&#x6216;&#x8005;&#x4E4B;&#x524D;&#x4EE5;&#x4E3A;&#x5DE5;&#x4F5C;&#xFF0C;&#x7B49;&#x9700;&#x8981;&#x6062;&#x590D;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x4E0D;&#x80FD;&#x7528;&#x4E86;&#x3002;</p><h2 id="create-a-volume"><a href="#Create-a-volume" class="headerlink" title="Create a volume"></a>Create a volume <a href="#create-a-volume" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker volume create --name important_data</span><br><span class="line">docker run -d -v important_data:/var/lib/postgresql/data --name pgdb postgres</span><br><span class="line">docker rm -f pgdb</span><br><span class="line"><span class="comment"># &#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x8FD8;&#x5728;</span></span><br><span class="line">docker run -d -v important_data:/var/lib/postgresql/data --name pgdb postgres</span><br></pre></td></tr></table></figure><h2 id="create-a-volume-nfs"><a href="#Create-a-volume-NFS" class="headerlink" title="Create a volume - NFS"></a>Create a volume - NFS <a href="#create-a-volume-nfs" class="header-anchor">#</a></h2><p><code>docker volume</code> &#x5176;&#x5B9E;&#x652F;&#x6301;&#x7ED1;&#x5B9A;&#x5F88;&#x591A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982; <code>NFS</code> &#x7684;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker volume create \</span><br><span class="line">    --name important_data \</span><br><span class="line">    --opt <span class="built_in">type</span>=nfs \</span><br><span class="line">    --opt device=1.2.3.4:/<span class="built_in">export</span>/path</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x4F60;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x5C31;&#x5728; <code>NFS</code>&#x4E86;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55; docker host &#x4E0A;&#x8FD0;&#x884C; <code>postgresql</code> &#x6570;&#x636E;&#x5E93;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F; <code>NFS</code>&#xFF1B;&#x4F60;&#x7684; <code>postgressql</code> &#x4F1A;&#x53D8;&#x5F97;&#x8D85;&#x6162;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F; <code>NFS</code>&#x2026;&#x2026;</p><h2 id="create-a-volume-btrfs"><a href="#Create-a-volume-BTRFS" class="headerlink" title="Create a volume - BTRFS"></a>Create a volume - BTRFS <a href="#create-a-volume-btrfs" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker volume create \</span><br><span class="line">    --name important_data</span><br><span class="line">    --opt <span class="built_in">type</span>=btrfs \</span><br><span class="line">    --opt device=/dev/sdb</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5C31;&#x652F;&#x6301; <code>snapshot</code>, <code>clone</code> &#x4E86;&#x3002;</p><h2 id="create-a-volume-gluster"><a href="#Create-a-volume-Gluster" class="headerlink" title="Create a volume - Gluster"></a>Create a volume - Gluster <a href="#create-a-volume-gluster" class="header-anchor">#</a></h2><p>Docker Volume &#x8FD8;&#x652F;&#x6301;&#x5927;&#x91CF;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x51E0;&#x4E4E;&#x5404;&#x79CD;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x90FD;&#x6709;&#x652F;&#x6301;&#x3002;&#x6BD4;&#x5982;&#x652F;&#x6301; <code>glusterfs</code> &#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker volume create \</span><br><span class="line">    --name important_data</span><br><span class="line">    --driver glusterfs</span><br></pre></td></tr></table></figure><h2 id="create-a-volume-swarm-mode"><a href="#Create-a-volume-Swarm-Mode" class="headerlink" title="Create a volume - Swarm Mode"></a>Create a volume - Swarm Mode <a href="#create-a-volume-swarm-mode" class="header-anchor">#</a></h2><p>&#x5728; 1.12 &#x96C6;&#x6210;&#x8FDB;&#x6765;&#x7684; <code>Docker Swarm Mode</code> &#x4E0B;&#x4F7F;&#x7528; Volume</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=important_data,target=/var/lib/postgresql/data,volume \</span><br><span class="line">    --driver=<span class="built_in">local</span> \</span><br><span class="line">    postgres</span><br></pre></td></tr></table></figure><blockquote><p>Docker is for anything you are crazy enough to try - Brian Goff</p></blockquote><ul><li>&#x4E0D;&#x8981;&#x6302;&#x8F7D;&#x5230;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x3002;</li><li>&#x4E0D;&#x8981;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#xFF08;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4EA4;&#x6D41;&#x6765;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#x6765;&#x4EA4;&#x6D41;&#xFF09;&#xFF0C;&#x6BD4;&#x5982; <code>volumes_from</code> &#x57FA;&#x672C;&#x662F;&#x4E2A;&#x5F88;&#x5DEE;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x8FD9;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x7B49;&#x4E8E;&#x9501;&#x5B9A;&#x4E86;&#x8FD9;&#x4E2A;&#x5377;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0B;&#x53EF;&#x80FD;&#x80FD;&#x5DE5;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x67D0;&#x4E9B;&#x7CFB;&#x7EDF;&#x4E0B;&#x4F1A;&#x4EA7;&#x751F;&#x5D29;&#x6E83;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x6837;&#x4F1A;&#x4EA7;&#x751F;&#x5F88;&#x9EBB;&#x70E6;&#x7684; <code>race condition</code> &#x7684;&#x95EE;&#x9898;&#x3002;</li></ul><h1 id="qa"><a href="#QA" class="headerlink" title="QA"></a>QA <a href="#qa" class="header-anchor">#</a></h1><h4 id="q-docker-deng-yu-ti-gong-liao-yi-ge-tong-yi-de-juan-jie-kou-na-me-shi-bu-shi-ke-yi-shuo-qi-shi-bei-fen-geng-rong-yi-liao-wo-zhi-xu-yao-gao-su-it-guy-bei-fen-volume-jiu-wan-liao-er-bu-yong-guan-xin-ju-ti-shi-shi-me-shu-ju-zhi-lei-de"><a href="#Q-Docker-&#x7B49;&#x4E8E;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5377;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8BF4;&#x5176;&#x5B9E;&#x5907;&#x4EFD;&#x66F4;&#x5BB9;&#x6613;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9;-IT-guy-&#x5907;&#x4EFD;-Volume-&#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x800C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#xFF1F;" class="headerlink" title="Q: Docker &#x7B49;&#x4E8E;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5377;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8BF4;&#x5176;&#x5B9E;&#x5907;&#x4EFD;&#x66F4;&#x5BB9;&#x6613;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9; IT guy &#x5907;&#x4EFD; Volume &#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x800C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#xFF1F;"></a>Q: Docker &#x7B49;&#x4E8E;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5377;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8BF4;&#x5176;&#x5B9E;&#x5907;&#x4EFD;&#x66F4;&#x5BB9;&#x6613;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9; IT guy &#x5907;&#x4EFD; Volume &#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x800C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#xFF1F; <a href="#q-docker-deng-yu-ti-gong-liao-yi-ge-tong-yi-de-juan-jie-kou-na-me-shi-bu-shi-ke-yi-shuo-qi-shi-bei-fen-geng-rong-yi-liao-wo-zhi-xu-yao-gao-su-it-guy-bei-fen-volume-jiu-wan-liao-er-bu-yong-guan-xin-ju-ti-shi-shi-me-shu-ju-zhi-lei-de" class="header-anchor">#</a></h4><p>Docker&#x786E;&#x5B9E;&#x63D0;&#x4F9B;&#x4E86;&#x7EDF;&#x4E00;&#x7684;&#x63A5;&#x53E3;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x57FA;&#x4E8E; VFS &#x673A;&#x5236;&#x7684;&#x3002;&#x5907;&#x4EFD;&#x53EF;&#x4EE5;&#x6709;&#x4E24;&#x79CD;&#x505A;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x9009;&#x62E9;&#x90A3;&#x4E9B;&#x652F;&#x6301;&#x5907;&#x4EFD;&#x673A;&#x5236;&#x7684; Storage&#xFF1B;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x624B;&#x52A8;&#x5907;&#x4EFD;&#xFF0C;&#x8D77;&#x4E2A;&#x5BB9;&#x5668;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x5377;&#x7136;&#x540E;&#x5907;&#x4EFD;&#x3002;&#x5173;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5907;&#x4EFD;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x73B0;&#x5728;&#x505A; Replication &#x975E;&#x5E38;&#x5BB9;&#x6613;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x8981;&#x63D0;&#x4F9B;HA&#xFF0C;&#x5C3D;&#x91CF;&#x901A;&#x8FC7; Replication&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x672C;&#x5730;&#x5907;&#x4EFD;&#x7684;&#x5F62;&#x5F0F;&#x3002;</p><h4 id="q-1-aufs-kai-shi-bei-yi-xie-fa-xing-ban-qu-diao-liao-na-me-jiang-lai-mo-ren-de-storage-driver-hui-shi-shi-me-2-spotify-ti-gong-liao-docker-gc-lai-qing-li-la-ji-yao-shi-docker-you-yuan-sheng-de-jie-jue-fang-an-hui-geng-hao-zhe-fang-mian-you-shi-me-ji-hua-mei-you"><a href="#Q-1-AUFS-&#x5F00;&#x59CB;&#x88AB;&#x4E00;&#x4E9B;&#x53D1;&#x884C;&#x7248;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x9ED8;&#x8BA4;&#x7684;-Storage-Driver&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;2-Spotify-&#x63D0;&#x4F9B;&#x4E86;-docker-gc-&#x6765;&#x6E05;&#x7406;&#x5783;&#x573E;&#xFF0C;&#x8981;&#x662F;-Docker-&#x6709;&#x539F;&#x751F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x6709;&#x4EC0;&#x4E48;&#x8BA1;&#x5212;&#x6CA1;&#x6709;&#xFF1F;" class="headerlink" title="Q: 1. AUFS &#x5F00;&#x59CB;&#x88AB;&#x4E00;&#x4E9B;&#x53D1;&#x884C;&#x7248;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x9ED8;&#x8BA4;&#x7684; Storage Driver&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;2. Spotify &#x63D0;&#x4F9B;&#x4E86; docker-gc &#x6765;&#x6E05;&#x7406;&#x5783;&#x573E;&#xFF0C;&#x8981;&#x662F; Docker &#x6709;&#x539F;&#x751F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x6709;&#x4EC0;&#x4E48;&#x8BA1;&#x5212;&#x6CA1;&#x6709;&#xFF1F;"></a>Q: 1. AUFS &#x5F00;&#x59CB;&#x88AB;&#x4E00;&#x4E9B;&#x53D1;&#x884C;&#x7248;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x9ED8;&#x8BA4;&#x7684; Storage Driver&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;2. Spotify &#x63D0;&#x4F9B;&#x4E86; docker-gc &#x6765;&#x6E05;&#x7406;&#x5783;&#x573E;&#xFF0C;&#x8981;&#x662F; Docker &#x6709;&#x539F;&#x751F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x6709;&#x4EC0;&#x4E48;&#x8BA1;&#x5212;&#x6CA1;&#x6709;&#xFF1F; <a href="#q-1-aufs-kai-shi-bei-yi-xie-fa-xing-ban-qu-diao-liao-na-me-jiang-lai-mo-ren-de-storage-driver-hui-shi-shi-me-2-spotify-ti-gong-liao-docker-gc-lai-qing-li-la-ji-yao-shi-docker-you-yuan-sheng-de-jie-jue-fang-an-hui-geng-hao-zhe-fang-mian-you-shi-me-ji-hua-mei-you" class="header-anchor">#</a></h4><p>&#x867D;&#x7136;&#x8BF4;&#x8981;&#x53BB;&#x6389; <code>AUFS</code>&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x591A;&#x6700;&#x540E;&#x6CA1;&#x6709;&#x53BB;&#x6389;&#xFF0C;&#x7279;&#x522B;&#x662F; <code>Ubuntu 16.04</code> &#x5185;&#x7F6E;&#x4E86; <code>AUFS</code>&#xFF0C;&#x8FD9;&#x4E2A;LTS&#x7248;&#x672C;&#x4F1A;&#x6301;&#x7EED;&#x5F88;&#x591A;&#x5E74;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x662F;&#x592A;&#x5927;&#x7684;&#x95EE;&#x9898;&#x3002;<code>Overlay</code> &#x662F;&#x5C06;&#x6765;&#x7684;&#x5E0C;&#x671B;&#xFF0C;&#x4F46;&#x662F;&#x73B0;&#x5728;&#x8FD8;&#x6709;&#x4E00;&#x4E9B; kernel bug&#x9700;&#x8981;&#x53BB;&#x5904;&#x7406;&#xFF0C;Brian &#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x5411;&#x4EBA;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x8FC7; <code>Overlay FS</code>&#xFF0C;&#x9664;&#x975E;&#x662F;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;&#x4F46;&#x662F;&#x5E0C;&#x671B;&#x8FD9;&#x4E2A;&#x5C06;&#x6765;&#x80FD;&#x6210;&#x719F;&#x8D77;&#x6765;&#x3002;</p><p>&#x81F3;&#x4E8E;&#x5783;&#x573E;&#x56DE;&#x6536;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x7684;&#xFF0C;&#x4E00;&#x76F4;&#x5728;&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x5728; <code>Docker 1.10</code> &#x4E4B;&#x524D;&#x8FD9;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x597D;&#x5F88;&#x591A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x5728;&#x8003;&#x8651;&#x5177;&#x4F53;&#x600E;&#x4E48;&#x53BB;&#x505A;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#xFF0C;GC&#x8FD9;&#x4E1C;&#x897F;&#x653E;&#x5230;&#x54EA;&#x91CC;&#x90FD;&#x662F;&#x6BD4;&#x8F83;&#x96BE;&#x4EE5;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8981;&#x505A;&#x5C31;&#x5F97;&#x505A;&#x5BF9;&#xFF0C;&#x4E0D;&#x80FD;&#x628A;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x5373;&#x5C06;&#x8FD0;&#x884C;&#x7684; image &#x7ED9;&#x5220;&#x6389;&#x3002;</p><h4 id="q-dui-yu-swarm-mode-er-yan-tui-jian-shi-yong-shi-me-volume-driver-lai-gong-xiang-juan"><a href="#Q-&#x5BF9;&#x4E8E;-Swarm-Mode-&#x800C;&#x8A00;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4EC0;&#x4E48;-Volume-driver-&#x6765;&#x5171;&#x4EAB;&#x5377;&#xFF1F;" class="headerlink" title="Q: &#x5BF9;&#x4E8E; Swarm Mode &#x800C;&#x8A00;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4EC0;&#x4E48; Volume driver &#x6765;&#x5171;&#x4EAB;&#x5377;&#xFF1F;"></a>Q: &#x5BF9;&#x4E8E; Swarm Mode &#x800C;&#x8A00;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4EC0;&#x4E48; Volume driver &#x6765;&#x5171;&#x4EAB;&#x5377;&#xFF1F; <a href="#q-dui-yu-swarm-mode-er-yan-tui-jian-shi-yong-shi-me-volume-driver-lai-gong-xiang-juan" class="header-anchor">#</a></h4><p>&#x8FD9;&#x4F9D;&#x8D56;&#x4E8E;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;&#x6709;&#x4E00;&#x4E9B;&#x63D2;&#x4EF6;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x5757;&#x5B58;&#x50A8;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x6709;&#x5176;&#x7279;&#x5B9A;&#x7684;&#x4E91;&#x5B58;&#x50A8;&#x63D2;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x79C1;&#x6709;&#x4E91;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x63A8;&#x8350;&#x7528; <code>gluster</code>&#x6216;&#x8005;<code>ceph</code>&#x3002;</p><h4 id="q-docker-de-overlay-network-fei-chang-fang-bian-dui-yong-hu-tou-ming-ke-yi-zai-gan-zhi-bu-dao-de-qing-kuang-xia-shi-xian-ji-qun-kua-zhu-ji-fang-wen-na-me-jiang-lai-you-mei-you-ke-neng-zuo-yi-ge-lei-si-de-overlay-storage-de-dong-xi-ye-neng-gou-zhe-me-fang-bian-de-shi-yong-cun-chu"><a href="#Q-Docker-&#x7684;-Overlay-Network-&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x900F;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x8DE8;&#x4E3B;&#x673A;&#x8BBF;&#x95EE;&#x3002;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x6709;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x505A;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;-Overlay-Storage-&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x8FD9;&#x4E48;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#xFF1F;" class="headerlink" title="Q: Docker &#x7684; Overlay Network &#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x900F;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x8DE8;&#x4E3B;&#x673A;&#x8BBF;&#x95EE;&#x3002;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x6709;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x505A;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684; Overlay Storage &#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x8FD9;&#x4E48;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#xFF1F;"></a>Q: Docker &#x7684; Overlay Network &#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x900F;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x8DE8;&#x4E3B;&#x673A;&#x8BBF;&#x95EE;&#x3002;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x6709;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x505A;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684; Overlay Storage &#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x8FD9;&#x4E48;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#xFF1F; <a href="#q-docker-de-overlay-network-fei-chang-fang-bian-dui-yong-hu-tou-ming-ke-yi-zai-gan-zhi-bu-dao-de-qing-kuang-xia-shi-xian-ji-qun-kua-zhu-ji-fang-wen-na-me-jiang-lai-you-mei-you-ke-neng-zuo-yi-ge-lei-si-de-overlay-storage-de-dong-xi-ye-neng-gou-zhe-me-fang-bian-de-shi-yong-cun-chu" class="header-anchor">#</a></h4><p><code>Storage is Hard</code>. &#x8FD9;&#x662F;&#x6211;&#x552F;&#x4E00;&#x80FD;&#x8BF4;&#x7684;&#x3002;&#x8FD9;&#x6B21;&#x5927;&#x4F1A;&#x5C55;&#x53F0;&#x4E0A;&#x6709;&#x4E00;&#x534A;&#x90FD;&#x662F; Storage &#x5382;&#x5546;&#xFF0C;&#x63A8;&#x8350;&#x53BB;&#x770B;&#x4E00;&#x4E0B;&#x4ED6;&#x4EEC;&#x7684;&#x6280;&#x672F;&#x3002;</p><h4 id="q-ru-guo-wo-you-ge-python-app-wo-xian-zai-xiang-yong-swarm-qu-scale-na-me-shu-ju-ku-zen-me-scale"><a href="#Q-&#x5982;&#x679C;&#x6211;&#x6709;&#x4E2A;-Python-app&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x60F3;&#x7528;-Swarm-&#x53BB;scale&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E93;&#x600E;&#x4E48;scale&#xFF1F;" class="headerlink" title="Q: &#x5982;&#x679C;&#x6211;&#x6709;&#x4E2A; Python app&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x60F3;&#x7528; Swarm &#x53BB;scale&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E93;&#x600E;&#x4E48;scale&#xFF1F;"></a>Q: &#x5982;&#x679C;&#x6211;&#x6709;&#x4E2A; Python app&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x60F3;&#x7528; Swarm &#x53BB;scale&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E93;&#x600E;&#x4E48;scale&#xFF1F; <a href="#q-ru-guo-wo-you-ge-python-app-wo-xian-zai-xiang-yong-swarm-qu-scale-na-me-shu-ju-ku-zen-me-scale" class="header-anchor">#</a></h4><p>&#x9996;&#x5148;&#x662F;&#x4E0D;&#x8981;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x5E93;&#x5B58;&#x50A8;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x800C;&#x4F7F;&#x7528; <code>replicas</code>&#x3002;</p><h4 id="q-wo-men-zai-jie-jue-yi-ge-fen-fa-shu-ju-de-wen-ti-wo-men-xi-wang-feng-zhuang-shu-ju-ku-jin-jing-xiang-zhe-yang-yong-hu-qi-dong-jing-xiang-de-shi-hou-ke-yi-bu-yong-xia-zai-huo-zhe-sheng-cheng-zhe-xie-shu-ju-dan-shi-fen-fa-yi-ge-10gb-de-image-xian-ran-bu-zha-yang-you-shi-me-hao-jian-yi-me"><a href="#Q-&#x6211;&#x4EEC;&#x5728;&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C01;&#x88C5;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x542F;&#x52A8;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x4E0B;&#x8F7D;&#x6216;&#x8005;&#x751F;&#x6210;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x5206;&#x53D1;&#x4E00;&#x4E2A;10GB&#x7684;-image-&#x663E;&#x7136;&#x4E0D;&#x548B;&#x6837;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5EFA;&#x8BAE;&#x4E48;&#xFF1F;" class="headerlink" title="Q: &#x6211;&#x4EEC;&#x5728;&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C01;&#x88C5;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x542F;&#x52A8;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x4E0B;&#x8F7D;&#x6216;&#x8005;&#x751F;&#x6210;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x5206;&#x53D1;&#x4E00;&#x4E2A;10GB&#x7684; image &#x663E;&#x7136;&#x4E0D;&#x548B;&#x6837;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5EFA;&#x8BAE;&#x4E48;&#xFF1F;"></a>Q: &#x6211;&#x4EEC;&#x5728;&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C01;&#x88C5;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x542F;&#x52A8;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x4E0B;&#x8F7D;&#x6216;&#x8005;&#x751F;&#x6210;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x5206;&#x53D1;&#x4E00;&#x4E2A;10GB&#x7684; image &#x663E;&#x7136;&#x4E0D;&#x548B;&#x6837;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5EFA;&#x8BAE;&#x4E48;&#xFF1F; <a href="#q-wo-men-zai-jie-jue-yi-ge-fen-fa-shu-ju-de-wen-ti-wo-men-xi-wang-feng-zhuang-shu-ju-ku-jin-jing-xiang-zhe-yang-yong-hu-qi-dong-jing-xiang-de-shi-hou-ke-yi-bu-yong-xia-zai-huo-zhe-sheng-cheng-zhe-xie-shu-ju-dan-shi-fen-fa-yi-ge-10gb-de-image-xian-ran-bu-zha-yang-you-shi-me-hao-jian-yi-me" class="header-anchor">#</a></h4><p>&#x9996;&#x5148;&#x662F;&#x4E0D;&#x63A8;&#x8350;&#x5C06;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x5230;&#x955C;&#x50CF;&#x91CC;&#xFF0C;&#x5E94;&#x8BE5;&#x8BBE;&#x6CD5;&#x662F;&#x5206;&#x53D1;&#x6570;&#x636E;&#x3002;&#x901A;&#x8FC7;<code>FTP</code>, <code>HTTP</code>, <code>S3</code> &#x4E4B;&#x7C7B;&#x7684;&#x5206;&#x53D1;&#x624B;&#x6BB5;&#x3002;</p><h4 id="q-ni-shuo-bu-yao-shi-yong-bang-ding-su-zhu-mu-lu-wo-de-li-jie-shi-bu-yao-bang-ding-te-ding-su-zhu-mu-lu-na-me-you-mei-you-bie-de-yuan-yin-bu-shi-yong-bang-ding-su-zhu-mu-lu-ni"><a href="#Q-&#x4F60;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x5462;&#xFF1F;" class="headerlink" title="Q: &#x4F60;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x5462;&#xFF1F;"></a>Q: &#x4F60;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x5462;&#xFF1F; <a href="#q-ni-shuo-bu-yao-shi-yong-bang-ding-su-zhu-mu-lu-wo-de-li-jie-shi-bu-yao-bang-ding-te-ding-su-zhu-mu-lu-na-me-you-mei-you-bie-de-yuan-yin-bu-shi-yong-bang-ding-su-zhu-mu-lu-ni" class="header-anchor">#</a></h4><p>&#x9996;&#x5148;&#x6211;&#x5E76;&#x4E0D;&#x8BA4;&#x4E3A;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x662F; Volume&#xFF0C;&#x6211;&#x7279;&#x610F;&#x56DE;&#x907F;&#x4E86;&#x5C06;&#x5176;&#x8BF4;&#x4E3A; Volume &#x7684;&#x505A;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x6709; Volume &#x5BF9;&#x8C61;&#xFF0C;&#x548C; Host Path&#xFF0C;&#x8FD9;&#x662F;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BD4;&#x5982;&#x73B0;&#x5728;&#x7684;&#x5982;&#x679C;-v&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x4F1A;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x53BB;&#x6302;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x5B9E;&#x9645;&#x7684;&#x610F;&#x56FE;&#x662F;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x4F1A;&#x7ED1;&#x8FDB;&#x5BB9;&#x5668;&#xFF0C;&#x8BA9;&#x5BB9;&#x5668;&#x5185;&#x4EA7;&#x751F;&#x6DF7;&#x4E71;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x53EF;&#x9760;&#x6027;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x800C;&#x662F;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7684;&#x505A;&#x6CD5;&#x7B49;&#x4E8E;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;Docker&#x63A7;&#x5236;&#x8303;&#x56F4;&#x5916;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x5728;&#x6784;&#x67B6;&#x4E0A;&#x6253;&#x4E86;&#x4E00;&#x4E2A;&#x6D1E;&#x7684;&#x6982;&#x5FF5;&#x3002;</p><h4 id="q-shi-me-storage-driver-su-du-zui-kuai"><a href="#Q-&#x4EC0;&#x4E48;-Storage-driver-&#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF1F;" class="headerlink" title="Q: &#x4EC0;&#x4E48; Storage driver &#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF1F;"></a>Q: &#x4EC0;&#x4E48; Storage driver &#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF1F; <a href="#q-shi-me-storage-driver-su-du-zui-kuai" class="header-anchor">#</a></h4><p>&#x73B0;&#x5728;&#x7684;&#x8BDD;&#xFF0C;<code>overlay2</code> &#x6700;&#x5FEB;&#xFF0C;&#x5B83;&#x6709;&#x5F88;&#x5DE7;&#x5999;&#x7684;&#x7F13;&#x5B58;&#x673A;&#x5236;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x8BA9;&#x4E0D;&#x540C;&#x7684;&#x5BB9;&#x5668;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;page&#x3002;</p><h4 id="q-ke-bu-ke-yi-jiang-device-chuan-jin-rong-qi-nei-ran-hou-zai-li-mian-chuang-jian-soft-raid-ran-hou-shi-yong-ta-men"><a href="#Q-&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x5C06;-device-&#x4F20;&#x8FDB;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x521B;&#x5EFA;-Soft-RAID&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#xFF1F;" class="headerlink" title="Q: &#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x5C06; device &#x4F20;&#x8FDB;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x521B;&#x5EFA; Soft RAID&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#xFF1F;"></a>Q: &#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x5C06; device &#x4F20;&#x8FDB;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x521B;&#x5EFA; Soft RAID&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#xFF1F; <a href="#q-ke-bu-ke-yi-jiang-device-chuan-jin-rong-qi-nei-ran-hou-zai-li-mian-chuang-jian-soft-raid-ran-hou-shi-yong-ta-men" class="header-anchor">#</a></h4><p>&#x5728; <code>docker cli</code> &#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--device</code> &#x6765;&#x6307;&#x5B9A;&#x67D0;&#x4E2A; <code>device</code> &#x6216;&#x8005;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#x7684; <code>device</code> &#x7ED9;&#x5BB9;&#x5668;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：绿字黑屏 - Docker 安全示例 - Diogo Mónica</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-21-video-green-font-black-background-docker-security-by-example.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-21-video-green-font-black-background-docker-security-by-example.html</id>
    <published>2016-07-20T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.621Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#jie-shao">&#x4ECB;&#x7ECD;</a></li><li><a href="#chuang-jian-digital-ocean-fu-wu-qi">&#x521B;&#x5EFA; Digital Ocean &#x670D;&#x52A1;&#x5668;</a></li><li><a href="#apparmor">AppArmor</a></li><li><a href="#bane">Bane</a></li><li><a href="#capabilities">Capabilities</a></li><li><a href="#zhi-du-wen-jian-xi-tong">&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li><li><a href="#user-namespace">user namespace</a></li><li><a href="#content-trust">Content Trust</a></li><li><a href="#dui-kang-fork-bomb">&#x5BF9;&#x6297; fork bomb</a><ul><li><a href="#kernel-memory">Kernel Memory</a></li></ul></li><li><a href="#wen-jian-xi-tong">&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon15 EU - Green Font, Black Background - Docker Security by Example<br>by Diogo M&#xF3;nica, Security Lead, Docker<br>(2015-12-04)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/blNIreAq6hc" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=blNIreAq6hc" target="_blank" rel="noopener">https://www.youtube.com/watch?v=blNIreAq6hc</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=k03143nuw7k&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/k03143nuw7k.html" target="_blank" rel="noopener">http://v.qq.com/x/page/k03143nuw7k.html</a></p><h1 id="jie-shao"><a href="#&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4ECB;&#x7ECD;"></a>&#x4ECB;&#x7ECD; <a href="#jie-shao" class="header-anchor">#</a></h1><p>Diogo M&#xF3;nica&#xFF0C;Docker &#x5B89;&#x5168; Lead&#xFF0C;&#x559C;&#x6B22; GPG &#x548C; Perl</p><p>&#x9996;&#x5148;&#x58F0;&#x660E;&#xFF0C;&#x9898;&#x76EE;&#x867D;&#x7136;&#x662F;&#x7EFF;&#x5B57;&#x9ED1;&#x5C4F;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6211;&#x7684;&#x5B57;&#x662F;&#x767D;&#x7684;&#xFF0C;&#x90A3;&#x79CD;&#x5C4F;&#x5E55;&#x4E71;&#x7FFB;&#x7684;&#x4E1C;&#x897F;&#x53EA;&#x6709;&#x597D;&#x83B1;&#x575E;&#x7535;&#x5F71;&#x4E2D;&#x624D;&#x6709;&#x3002;&#x5176;&#x6B21;&#x662F;&#x6574;&#x4E2A;&#x6F14;&#x793A;&#x6CA1;&#x6709; PPT&#xFF0C;&#x5168;&#x90E8;&#x4F9D;&#x8D56;&#x4E92;&#x8054;&#x7F51;&#xFF0C;&#x5982;&#x679C;&#x7F51;&#x65AD;&#x4E86;&#x2026;&#x2026;&#x90A3;&#x4F30;&#x8BA1;&#x662F;&#x5168; DockerCon &#x6700;&#x957F;&#x7684;&#x89E3;&#x7B54;session&#x4E86;&#x3002;</p><p>&#x800C;&#x4E14;&#xFF0C;&#x5168;&#x90E8;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x73B0;&#x573A;&#x5B8C;&#x6210;&#xFF0C;&#x4ECE;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7A7A;&#x767D;&#x865A;&#x62DF;&#x673A;&#x5F00;&#x59CB;&#x3002;</p><h1 id="chuang-jian-digital-ocean-fu-wu-qi"><a href="#&#x521B;&#x5EFA;-Digital-Ocean-&#x670D;&#x52A1;&#x5668;" class="headerlink" title="&#x521B;&#x5EFA; Digital Ocean &#x670D;&#x52A1;&#x5668;"></a>&#x521B;&#x5EFA; Digital Ocean &#x670D;&#x52A1;&#x5668; <a href="#chuang-jian-digital-ocean-fu-wu-qi" class="header-anchor">#</a></h1><p>&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; $10/month &#x7684;&#x4F26;&#x6566;&#x4F4D;&#x7F6E;&#x7684; Droplet&#xFF0C;Ubuntu 15.10</p><p>&#x521D;&#x59CB;&#x5316;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5B89;&#x88C5;&#x5FC5;&#x8981;&#x8F6F;&#x4EF6;</span></span><br><span class="line">apt-get install vim tree curl golang-go</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x7F16;&#x8F91; <code>.bashrc</code> &#x914D;&#x7F6E; GOPATH &#x548C; PATH&#x3002;</p><p>&#x7136;&#x540E;&#x5B89;&#x88C5; <code>experimental</code> &#x5206;&#x652F;&#x7684; docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -ssL https://experimental.docker.com | sh</span><br></pre></td></tr></table></figure><p>&#x5B89;&#x88C5;&#x540E;&#xFF0C;&#x542F;&#x7528; Content Trust</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DOCKER_CONTENT_TRUST=1</span><br></pre></td></tr></table></figure><h1 id="apparmor"><a href="#AppArmor" class="headerlink" title="AppArmor"></a>AppArmor <a href="#apparmor" class="header-anchor">#</a></h1><p>&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Alpine &#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C; <code>top</code> &#x547D;&#x4EE4;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run alpine top</span><br></pre></td></tr></table></figure><p>&#x6267;&#x884C;&#x540E;&#x4E00;&#x5207;&#x6B63;&#x5E38;&#xFF0C;&#x4F46;&#x662F; <code>Ctrl-C</code> &#x65E0;&#x6CD5;&#x9000;&#x51FA;&#x3002;&#x4E8E;&#x662F;&#x51B3;&#x5B9A;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E76;&#x4E14; kill &#x6389;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">kill</span> &#x5BB9;&#x5668;&#x540D;</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x662F;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x62A5;&#x9519;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: Cannot <span class="built_in">kill</span> thirsty_pasteur: permission denied</span><br></pre></td></tr></table></figure><p> &#x4E8E;&#x662F;&#x5F00;&#x59CB;&#x68C0;&#x67E5;&#x65E5;&#x5FD7;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail /var/<span class="built_in">log</span>/syslog</span><br></pre></td></tr></table></figure><p>&#x5728;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;&#x770B;&#x5230;&#x4E86;&#x4E00;&#x884C;&#x8BF4; <code>apparmor=&quot;DENIED&quot;</code>&#xFF0C;&#x770B;&#x6765;&#x662F; AppArmor &#x963B;&#x6B62;&#x4E86;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x3002;</p><p>&#x90A3;&#x4E48;&#x7EE7;&#x7EED; debug&#xFF0C;&#x4F7F;&#x7528; <code>aa-status</code> &#x53EF;&#x4EE5;&#x67E5;&#x770B; AppArmor &#x7684;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4E2D;&#x4F1A;&#x5305;&#x542B;&#x6240;&#x4F7F;&#x7528;&#x7684; <code>profile</code>&#x3002;&#x5728;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6709;6&#x4E2A;profiles &#x662F; enforce&#x7684;&#xFF0C;14&#x4E2A;&#x662F;complain&#x7684;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x4E2A; enforce &#x7684;&#x662F; <code>docker-default</code>&#x3002;</p><p>&#x6253;&#x5F00; AppArmor &#x7684; docker &#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>/etc/apparmor.d/docker</code> &#x4EE5;&#x53CA; <code>/etc/apparmor.d/docker-engine</code>&#x3002;</p><p>&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x662F; kill &#x64CD;&#x4F5C;&#x88AB;&#x7981;&#x6B62;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x80FD;&#x662F;&#x5173;&#x4E8E; signal &#x7684;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep signal docker-engine</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x5230; <code>docker-engine</code> &#x4E2D;&#x6709; <code>signal</code> &#x63A7;&#x5236;&#xFF0C;&#x800C; <code>docker</code> &#x4E2D;&#x6CA1;&#x6709;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x5C06; <code>docker-engine</code> &#x4E2D;&#x7684; <code>signal (receive) ...</code> &#x90A3;&#x4E00;&#x884C;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x5230;  <code>docker</code> &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#xFF0C;&#x91CD;&#x8F7D;&#x8FD9;&#x4E2A; AppArmor&#xFF0C;<code>systemctl reload apparmor</code>&#x3002;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5; <code>docker kill</code> &#x6389;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#x3002;</p><h1 id="bane"><a href="#Bane" class="headerlink" title="Bane"></a>Bane <a href="#bane" class="header-anchor">#</a></h1><p>&#x7531;&#x4E8E; AppArmor &#x8BED;&#x6CD5;&#x770B;&#x7740;&#x5F88;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x4E8E;&#x662F;&#x6253;&#x7B97;&#x88C5;&#x4E2A; Go &#x63D2;&#x4EF6;&#x6765;&#x5E2E;&#x52A9;&#x505A;&#x5B89;&#x5168;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/jfrazelle/bane</span><br><span class="line">go install github.com/jfrazelle/bane</span><br></pre></td></tr></table></figure><p>&#x4F7F;&#x7528; bane &#x5B9A;&#x4E49;&#x7684;&#x793A;&#x4F8B;&#x5B89;&#x5168;&#x89C4;&#x5219; <code>sample.toml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ bane sample.toml</span><br><span class="line">Profile installed successfully you can now run the profile with</span><br><span class="line">`docker run --security-opt=<span class="string">&quot;apparmor:docker-nginx&quot;</span>`</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5C31;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A; AppArmor profile&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x63D0;&#x793A;&#x4F7F;&#x7528; <code>--security-opt</code> &#x9009;&#x9879;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A; profile &#x4E86;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --security-opt=<span class="string">&quot;apparmor:docker-nginx&quot;</span> -it nginx bash</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;<code>ping</code> &#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x7F51;&#x7EDC;, &#x800C; <code>top</code>, <code>dash</code>, <code>sh</code> &#x4E5F;&#x90FD;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x751F;&#x6210;&#x7684; AppArmor profile &#x63A7;&#x5236;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><h1 id="capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities <a href="#capabilities" class="header-anchor">#</a></h1><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--cap-drop</code> &#x53C2;&#x6570;&#x6765;&#x53D6;&#x6D88;&#x6389;&#x67D0;&#x4E9B;&#x80FD;&#x529B;&#x3002;&#x6BD4;&#x5982;&#xFF0C;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it alpine sh</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5; ping, traceroute&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D6;&#x6D88;&#x5176;&#x7F51;&#x7EDC;&#x80FD;&#x529B;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">cap</span>-drop=NET_RAW -it alpine sh</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837; traceroute &#x5C31;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;&#x9664;&#x4E86; <code>NET_RAW</code> &#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x6709;&#x610F;&#x601D;&#x7684;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#xFF0C;&#x6BD4;&#x5982; <code>CHOWN</code>&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x5C31;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>chown</code> &#x547D;&#x4EE4;&#x4E86;&#x3002;</p><h1 id="zhi-du-wen-jian-xi-tong"><a href="#&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; <a href="#zhi-du-wen-jian-xi-tong" class="header-anchor">#</a></h1><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53D8;&#x6210;&#x53EA;&#x8BFB;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">read</span>-only -it alpine sh</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#xFF0C;<code>touch</code> &#x4E4B;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x90FD;&#x65E0;&#x6CD5;&#x7528;&#x4E86;&#x3002;</p><h1 id="user-namespace"><a href="#user-namespace" class="headerlink" title="user namespace"></a>user namespace <a href="#user-namespace" class="header-anchor">#</a></h1><p>&#x5F53;&#x524D;(<em>1.10&#x4E4B;&#x524D;</em>)&#xFF0C;docker &#x5185;&#x7684; <code>uid 0</code> &#x5C31;&#x662F;docker &#x5916;&#x7684; <code>uid 0</code>&#xFF0C;&#x76EE;&#x524D;&#x6CA1;&#x6709;&#x4F7F;&#x7528; user namespace&#x3002;</p><p>&#x7531;&#x4E8E;&#x5185;&#x90E8;&#x548C;&#x5916;&#x90E8;&#x7684;UID&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x5185;&#x7684;<code>root</code>&#xFF0C;&#x5C31;&#x662F;&#x5BB9;&#x5668;&#x5916;&#x7684;root&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it \</span><br><span class="line">    -v /bin:/data/bin \</span><br><span class="line">    alpine sh</span><br></pre></td></tr></table></figure><p>&#x90A3;&#x4E48;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5185;&#x4FEE;&#x6539;&#x4E86; <code>/data/bin</code> &#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5BBF;&#x4E3B;&#x7684;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#x7684;&#x6587;&#x4EF6;&#x5C31;&#x88AB;&#x6539;&#x52A8;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#x3002;</p><p>&#x542F;&#x7528; user namespace &#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x901A;&#x8FC7;&#x4FEE;&#x6539; docker daemon &#x542F;&#x52A8;&#x53C2;&#x6570;&#x65E2;&#x53EF;&#x4EE5;&#xFF1A;</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ExecStart</span>=/usr/bin/docker daemon --userns-remap=default -s overlay -H fd://</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x7684; <code>overlay</code> &#x662F;&#x4F7F;&#x7528; overlay fs&#xFF0C;&#x6CA1;&#x4EC0;&#x4E48;&#x7279;&#x522B;&#x7684;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8BA8;&#x538C; aufs &#x800C;&#x5DF2;&#x2026;&#x2026;</p><p>&#x7136;&#x540E;&#x91CD;&#x542F; docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><p>&#x9A8C;&#x8BC1;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x4F7F;&#x7528; docker info &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x65B0;&#x542F;&#x7528;&#x7684; overlayfs</span></span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528; ps &#x67E5;&#x770B; docker &#x914D;&#x7F6E;</span></span><br><span class="line">ps -ef | grep docker</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x914D;&#x7F6E;&#x751F;&#x6548;&#x4E86;&#x3002;</p><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53BB; <code>/var/lib/docker/</code> &#x770B;&#x5230;&#x51E0;&#x4E2A;&#x65B0;&#x7684;&#x76EE;&#x5F55;&#xFF1A;<code>0.0</code> &#x548C; <code>10000.10000</code>&#x3002;</p><p>&#x524D;&#x9762;&#x7684; <code>0.0</code> &#x5C31;&#x662F;&#x4E4B;&#x524D; UID &#x4E3A; 0 &#x7684;namespace&#xFF0C;&#x800C; <code>10000.10000</code> &#x5219;&#x662F;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86; <code>userns-remap=default</code> &#x540E;&#x5EFA;&#x7ACB;&#x7684;&#x65B0;&#x7684; UID=10000&#x7684;namespace&#x3002;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x67E5;&#x770B;&#x5177;&#x4F53;&#x7684;uid,gid&#x7684;mapping&#x7684;&#x8303;&#x56F4;&#x53EF;&#x4EE5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/subgid</span><br><span class="line">cat /etc/subuid</span><br></pre></td></tr></table></figure><p>&#x6240;&#x6709;&#x8BE5;namespace&#x7684;&#x955C;&#x50CF;&#x90FD;&#x4F1A;&#x88AB;&#x653E;&#x7F6E;&#x5728;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>repositories-overlay</code> &#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x76EE;&#x524D;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x6267;&#x884C;&#x4E86; <code>docker pull alpine</code> &#x540E;&#xFF0C;&#x5176;&#x955C;&#x50CF;&#x4FE1;&#x606F;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x6267;&#x884C;&#x521A;&#x624D; <code>-v /bin:/data/bin</code> &#x7684; <code>docker run</code> &#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#xFF0C;&#x867D;&#x7136; <code>id</code> &#x663E;&#x793A;&#x8FD8;&#x662F; <code>uid=0, root</code>&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5230; <code>/data/bin</code> &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x4FEE;&#x6539;&#x5176;&#x6587;&#x4EF6;&#x4E86;&#x3002;</p><h1 id="content-trust"><a href="#Content-Trust" class="headerlink" title="Content Trust"></a>Content Trust <a href="#content-trust" class="header-anchor">#</a></h1><p>&#x6700;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;&#x4E86; <code>DOCKER_CONTENT_TRUST=1</code> &#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x7684; <code>docker pull</code> &#x90FD;&#x4F1A;&#x9A8C;&#x8BC1;&#x6BCF;&#x4E00;&#x4E2A;&#x90E8;&#x5206;&#x662F;&#x5426;&#x53EF;&#x4FE1;&#x4EFB;&#x3002;&#x4E00;&#x5207;&#x90FD;&#x662F;&#x900F;&#x660E;&#x7684;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x3002;</p><p>&#x6E05;&#x7A7A;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x548C;&#x955C;&#x50CF;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f $(docker ps -a -q)</span><br><span class="line">docker rmi -f $(docker images -q)</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x7981;&#x7528; Content Trust&#xFF0C;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull --<span class="built_in">disable</span>-content-trust alpine</span><br></pre></td></tr></table></figure><p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x52A0;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#xFF08;&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;&#x4E86;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF09;&#xFF0C;&#x5C31;&#x4F1A;&#x542F;&#x7528; Content Trust&#xFF0C;Docker &#x5C31;&#x4F1A;&#x4F7F;&#x7528; Notary &#x6765;&#x8FDB;&#x884C;&#x955C;&#x50CF;&#x7684;&#x9A8C;&#x8BC1;&#x3002;</p><p>&#x5B9E;&#x9645;&#x4E0A;&#x540E;&#x9762;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x901A;&#x8FC7; Notary &#x5BF9;&#x955C;&#x50CF;&#x540D;&#x5B57; <code>alpine:latest</code> &#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x89E3;&#x6790;&#x4E3A;&#x4E00;&#x4E2A;&#x7ECF;&#x8FC7;&#x7B7E;&#x540D;&#x8BA4;&#x8BC1;&#x7684;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x800C; docker &#x5B9E;&#x9645;&#x4E0A; pull &#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x90A3;&#x4E2A;&#x955C;&#x50CF;&#x540D;&#x5B57;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull alpine@sha256:xxxxxxxx</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p>docker &#x4F1A;&#x5BF9; pull &#x4E0B;&#x6765;&#x7684;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F; Markle Hash Tree &#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x6821;&#x9A8C;&#x955C;&#x50CF;&#x5168;&#x90E8;&#x5C42;&#x7684;&#x5B8C;&#x6574;&#x6027;&#x3002;</p><p>&#x4F7F;&#x7528;&#x5E26; Content Trust &#x540E;&#xFF0C;<code>repositories-overlay</code> &#x6587;&#x4EF6;&#x4E2D;&#x9664;&#x4E86;&#x9ED8;&#x8BA4;&#x7684; latest &#x5BF9;&#x5E94;&#x503C;&#x5916;&#xFF0C;&#x591A;&#x4E86;&#x4E00;&#x4E2A; sha256&#x7684;&#x6821;&#x9A8C;&#x6570;&#x503C;&#x3002;</p><p>&#x5728;&#x5B89;&#x88C5;&#x4E86; notary &#x7684;&#x673A;&#x5668;&#x4E0A;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notary list docker.io/library/alpine</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>tree ~/.docker/trust/</code> &#x6765;&#x663E;&#x793A; Content Trust &#x7684;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x548C;&#x6570;&#x636E;&#x3002;</p><h1 id="dui-kang-fork-bomb"><a href="#&#x5BF9;&#x6297;-fork-bomb" class="headerlink" title="&#x5BF9;&#x6297; fork bomb"></a>&#x5BF9;&#x6297; fork bomb <a href="#dui-kang-fork-bomb" class="header-anchor">#</a></h1><p>&#x5E38;&#x89C1;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#xFF0C;&#x4FEE;&#x6539; <code>docker.service</code> &#x6587;&#x4EF6;&#xFF0C;&#x5C06; <code>LimitNPROC</code> &#x6539;&#x4E3A; <code>100</code>&#x3002;&#x53EF;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x662F;&#x6BCF;&#x7528;&#x6237;&#x7EA7;&#x522B;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4EE5;&#x4E3A;&#x6240;&#x6709;&#x7684;docker&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x53D7;&#x9650;&#xFF0C;&#x90A3;&#x4E48;&#x8981;&#x662F;&#x8DD1;1000&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x80FD;&#x8DD1;100&#x4E2A;&#x8FDB;&#x7A0B;&#x2026;&#x2026;</p><p>&#x6F14;&#x793A;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4E00;&#x4E2A; bash &#x547D;&#x4EE4;&#x8FDB;&#x884C; <code>fork bomb</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:(){ :|: &amp; };:</span><br></pre></td></tr></table></figure><p>&#x8C8C;&#x4F3C;&#x5F88;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x9650;&#x5236;&#x4E86;&#x7528;&#x6237;&#x7684; <code>nproc</code> &#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x62C5;&#x5FC3; <code>fork bomb</code> &#x4E86;&#x3002;&#x53EF;&#x5B9E;&#x9645;&#x4E0A;&#x7531;&#x4E8E;&#x8FD9;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x8303;&#x56F4;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x800C;&#x662F;&#x6574;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x56E0;&#x4E3A;&#x4E4B;&#x524D;&#x7684;&#x8FD9;&#x4E2A; fork bomb &#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x5EFA;&#x7ACB;&#x65B0;&#x7684;&#x8FDB;&#x57CE;&#x4E86;&#x3002;</p><p>&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -u daemon --<span class="built_in">ulimit</span> nproc=3 ubuntu bash</span><br><span class="line">docker run -itd -u daemon --<span class="built_in">ulimit</span> nproc=3 ubuntu bash</span><br><span class="line">docker run -itd -u daemon --<span class="built_in">ulimit</span> nproc=3 ubuntu bash</span><br><span class="line">docker run -itd -u daemon --<span class="built_in">ulimit</span> nproc=3 ubuntu bash</span><br></pre></td></tr></table></figure><p>&#x7B2C;&#x56DB;&#x4E2A;&#x5BB9;&#x5668;&#x4F1A;&#x51FA;&#x9519;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x7528;&#x6237;&#x8303;&#x56F4;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x524D;&#x4E09;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;bash&#x5DF2;&#x7ECF;&#x5360;&#x4E86;3&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x7B2C;4&#x4E2A;&#x5C31;&#x8D85;&#x51FA;&#x4E86;&#x9650;&#x5236;&#x4E86;&#x3002;</p><h2 id="kernel-memory"><a href="#Kernel-Memory" class="headerlink" title="Kernel Memory"></a>Kernel Memory <a href="#kernel-memory" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x9650;&#x5236; <code>kernel-memory</code>&#xFF0C;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --kernel-memory=1m ubuntu bash</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x8FD9;&#x6B21;&#x8FD0;&#x884C; fork bomb &#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x4E3B;&#x673A;&#x8FD9;&#x5730;&#x6302;&#x4E86;&#x3002;&#x73B0;&#x5728;&#x6709;&#x4E24;&#x4E2A; PR &#x5173;&#x4E8E;&#x63A7;&#x5236;&#x5BB9;&#x5668;&#x5185; fork &#x6570;&#x91CF;&#x7684;&#xFF0C;&#x5C06;&#x4F1A;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p><h1 id="wen-jian-xi-tong"><a href="#&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; <a href="#wen-jian-xi-tong" class="header-anchor">#</a></h1><p>&#x6F14;&#x793A;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A; PHP &#x7F51;&#x7AD9;&#xFF0C;&#x5B58;&#x5728;&#x6267;&#x884C;&#x8FDC;&#x7A0B;&#x547D;&#x4EE4;&#x7684;&#x6F0F;&#x6D1E;&#x3002;&#x4E8E;&#x662F;&#x901A;&#x8FC7;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x6F0F;&#x6D1E;&#x5F00;&#x59CB;&#x7BE1;&#x6539;&#x4E3B;&#x673A;&#x6587;&#x4EF6;&#x3002;&#x5229;&#x7528;&#x4E86; <code>curl</code> &#x4E0B;&#x8F7D;&#x4E86;&#x4E2A;web shell&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7; <code>echo</code> &#x7BE1;&#x6539;&#x4E86; <code>index.html</code>&#x3002;</p><p>&#x597D;&#x4E86;&#xFF0C;&#x8FD0;&#x7EF4;&#x51CC;&#x6668;&#x63A5;&#x5230;&#x4E86;&#x7535;&#x8BDD;&#xFF0C;&#x8BF4;&#x7F51;&#x7AD9;&#x88AB;&#x9ED1;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x590D;&#x3002;&#x4E8E;&#x662F;&#x5148;&#x901A;&#x8FC7; <code>docker logs</code> &#x6CE8;&#x610F;&#x5230;&#x4E86;&#x4E00;&#x4E9B;&#x5947;&#x602A;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4EFB;&#x52A1;&#x7D27;&#x6025;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x7ED9;&#x4F60;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#x7684;&#x65F6;&#x95F4;&#x53BB;&#x5206;&#x6790;&#x5165;&#x4FB5;&#x8FC7;&#x7A0B;&#x3002;&#x4E8E;&#x662F;&#x9700;&#x8981;&#x5148;&#x4FEE;&#x590D;&#x3002;&#x5148;&#x770B;&#x770B;&#x5BB9;&#x5668;&#x81EA;&#x8FD0;&#x884C;&#x540E;&#x90FD;&#x4FEE;&#x6539;&#x4E86;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x597D;&#x4E86;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker diff &#x5BB9;&#x5668;&#x540D;</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5F88;&#x6E05;&#x6670;&#x7684;&#x663E;&#x793A;&#x4E86;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x88AB;&#x6DFB;&#x52A0;&#x4E86;&#x3002;&#x4E00;&#x773C;&#x5C31;&#x770B;&#x5230;&#x4E86; <code>shell.php</code> &#x6587;&#x4EF6;&#x3002;</p><p>&#x4E3A;&#x4E86;&#x4FDD;&#x5B58;&#x73B0;&#x573A;&#xFF0C;&#x4F7F;&#x7528; <code>docker commit &#x5BB9;&#x5668;&#x540D;</code>&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x53D8;&#x5316;&#x7ED3;&#x679C;&#x7684;&#x955C;&#x50CF; ID&#x3002;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x53EF;&#x4EE5;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x9700;&#x8981;&#x6062;&#x590D;&#x7F51;&#x7AD9;&#x8FD0;&#x884C;&#x3002;</p><p>&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x7F51;&#x7AD9;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 --link db:db website</span><br></pre></td></tr></table></figure><p>&#x597D;&#x4E86;&#xFF0C;&#x7F51;&#x7AD9;&#x5C31;&#x6B64;&#x6062;&#x590D;&#x4E86;&#x3002;&#x4F7F;&#x7528; Docker &#x53EF;&#x4EE5;&#x8BA9;&#x6062;&#x590D;&#x5DE5;&#x4F5C;&#x5F02;&#x5E38;&#x8F7B;&#x677E;&#x3002;</p><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x54CD;&#x5E94;&#x8FD9;&#x6B21;&#x5165;&#x4FB5;&#xFF0C;&#x770B;&#x770B;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#x3002;&#x521A;&#x624D;&#x6211;&#x4EEC;commit&#x4E86;&#x955C;&#x50CF;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5219;&#x9700;&#x8981;&#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x770B;&#x770B;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it xxxxxx bash</span><br></pre></td></tr></table></figure><p>&#x4F7F;&#x7528;&#x521A;&#x624D; <code>commit</code> &#x7684;&#x6821;&#x9A8C;&#x503C;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x8FDB;&#x6765;&#x770B;&#x770B;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4E9B;&#x4EC0;&#x4E48;&#x4E8B;&#x60C5;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x8981;&#x662F; docker &#x53EF;&#x4EE5;&#x5728;&#x6700;&#x5F00;&#x59CB;&#x963B;&#x6B62;&#x8FD9;&#x6B21;&#x5165;&#x4FB5;&#xFF0C;&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x3002;&#x53EF;&#x4EE5;&#x4E48;&#xFF1F;&#x53EF;&#x4EE5;&#x3002;&#x6BD4;&#x5982;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x7684; <code>--read-only</code> &#x53C2;&#x6570;&#xFF0C;&#x4F7F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53EA;&#x8BFB;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 \</span><br><span class="line">    --link db:db \</span><br><span class="line">    -v /tmp/apacherun:/var/run/apache2/ \</span><br><span class="line">    -v /tmp/apachelock:/var/lock/apache2/ \</span><br><span class="line">    --sig-proxy=<span class="literal">false</span> \</span><br><span class="line">    --<span class="built_in">read</span>-only \</span><br><span class="line">    website</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>Docker 问答录（100 问）</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-14-faq.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-14-faq.html</id>
    <published>2016-07-13T19:43:23.000Z</published>
    <updated>2020-10-26T19:10:47.621Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><h1 id="qian-yan"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00; <a href="#qian-yan" class="header-anchor">#</a></h1><blockquote><p>&#x8FD9;&#x662F;&#x6211;&#x5728; QQ &#x7FA4; <code>325486037</code> &#x91CC;&#xFF0C;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x53CA;&#x5176;&#x89E3;&#x7B54;&#xFF0C;&#x5927;&#x591A;&#x662F;&#x521D;&#x5B66; Docker &#x65F6;&#x5E38;&#x89C1;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5176;&#x4E2D;&#x7684;&#x56DE;&#x7B54;&#xFF0C;&#x662F;&#x57FA;&#x4E8E;&#x6211;&#x5B66;&#x4E60;&#x548C;&#x4F7F;&#x7528; Docker &#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x8BA4;&#x77E5;&#xFF0C;&#x591A;&#x6570;&#x662F;&#x9075;&#x5FAA; Docker &#x5B98;&#x65B9;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x539F;&#x5219;&#x800C;&#x8FDB;&#x884C;&#x7684;&#x89E3;&#x7B54;&#x3002;&#x7531;&#x4E8E;&#x4E2A;&#x4EBA;&#x80FD;&#x529B;&#x6240;&#x9650;&#xFF0C;&#x56DE;&#x7B54;&#x53EF;&#x80FD;&#x4F1A;&#x7247;&#x9762;&#x6216;&#x9519;&#x8BEF;&#x3002;&#x5982;&#x53D1;&#x73B0;&#x9519;&#x8BEF;&#x540E;&#xFF0C;&#x6B22;&#x8FCE;&#x544A;&#x8BC9;&#x6211;&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x4FEE;&#x6B63;&#x8BE5;&#x6587;&#x6863;&#x907F;&#x514D;&#x8BEF;&#x5BFC;&#x4ED6;&#x4EBA;&#xFF0C;&#x6587;&#x6863;&#x4F1A;&#x4E0D;&#x5B9A;&#x671F;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;</p></blockquote><p><strong><a href="https://github.com/twang2218/blog.lab99.org/commits/master/source/_posts/docker/2016-07-14-faq.md" target="_blank" rel="noopener">&#x3010;&#x66F4;&#x65B0;&#xFF1A;2017&#x5E74;10&#x6708;31&#x65E5;&#x3011;</a></strong></p><!-- toc --><ul><li><a href="#docker-yin-qing-xiang-guan-wen-ti-67">Docker &#x5F15;&#x64CE;&#x76F8;&#x5173;&#x95EE;&#x9898; <code>(67)</code></a><ul><li><a href="#gai-nian-wen-ti-5">&#x6982;&#x5FF5;&#x95EE;&#x9898; <code>(5)</code></a><ul><li><a href="#su-zhu-ru-guo-he-rong-qi-xi-tong-bu-tong-de-hua-na-bu-shi-he-xu-ni-ji-yi-yang-yi-ceng-ceng-de-diao-yong-na-me-docker-he-xu-ni-ji-huan-you-shi-me-chai-bie">&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48; Docker &#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F;</a></li><li><a href="#docker-zi-liao-hao-shao-a-wang-shang-de-ming-ling-zen-me-bu-neng-yong">Docker &#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F;</a></li><li><a href="#ru-he-xuan-ze-docker-shu-ji">&#x5982;&#x4F55;&#x9009;&#x62E9; Docker &#x4E66;&#x7C4D;&#xFF1F;</a></li><li><a href="#zong-shuo-kan-guan-fang-wen-dang-ke-shi-docker-guan-wang-wen-dang-jing-chang-bei-qiang-kan-bu-liao-zen-me-ban">&#x603B;&#x8BF4;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x53EF;&#x662F; Docker &#x5B98;&#x7F51;&#x6587;&#x6863;&#x7ECF;&#x5E38;&#x88AB;&#x5899;&#xFF0C;&#x770B;&#x4E0D;&#x4E86;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#docker-1-8-yi-hou-ban-ben-du-you-shi-me-gai-jin-me">Docker 1.8 &#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F;</a></li></ul></li><li><a href="#an-zhuang-pei-zhi-wen-ti-8">&#x5B89;&#x88C5;&#x3001;&#x914D;&#x7F6E;&#x95EE;&#x9898; <code>(8)</code></a><ul><li><a href="#docker-zen-me-zhe-me-duo-ruan-jian-wo-gai-zhuang-na-ge">Docker &#x600E;&#x4E48;&#x8FD9;&#x4E48;&#x591A;&#x8F6F;&#x4EF6;&#xFF0C;&#x6211;&#x8BE5;&#x88C5;&#x54EA;&#x4E2A;&#xFF1F;</a></li><li><a href="#shi-zhi-jie-yong-yum-apt-get-an-zhuang-docker-ma">&#x662F;&#x76F4;&#x63A5;&#x7528; <code>yum</code> / <code>apt-get</code> &#x5B89;&#x88C5; Docker &#x5417;&#xFF1F;</a></li><li><a href="#bu-shi-du-yi-jing-fa-bu-docker-17-07-liao-me-wo-zen-me-sheng-ji-dao-zui-xin-huan-shi-17-05-ya">&#x4E0D;&#x662F;&#x90FD;&#x5DF2;&#x7ECF;&#x53D1;&#x5E03; Docker 17.07 &#x4E86;&#x4E48;&#xFF1F;&#x6211;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x8FD8;&#x662F; 17.05 &#x5440;&#xFF1F;</a></li><li><a href="#docker-pull-hao-man-a-zen-me-ban"><code>docker pull</code> &#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#zen-me-xiu-gai-liao-docker-fu-wu-pei-zhi-hou-bu-qi-zuo-yong">&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86; docker &#x670D;&#x52A1;&#x914D;&#x7F6E;&#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;</a></li><li><a href="#ru-guo-docker-sheng-ji-huo-zhe-chong-qi-de-hua-na-rong-qi-shi-bu-shi-du-hui-bei-ting-diao-ran-hou-chong-qi-a">&#x5982;&#x679C; Docker &#x5347;&#x7EA7;&#x6216;&#x8005;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x4E0D;&#x662F;&#x90FD;&#x4F1A;&#x88AB;&#x505C;&#x6389;&#x7136;&#x540E;&#x91CD;&#x542F;&#x554A;&#xFF1F;</a></li><li><a href="#wei-shi-me-zhi-xing-docker-ming-ling-hui-bao-permission-denied-mei-quan-xian-de-cuo-wu-a">&#x4E3A;&#x4EC0;&#x4E48;&#x6267;&#x884C; docker &#x547D;&#x4EE4;&#x4F1A;&#x62A5; <code>permission denied</code> &#x6CA1;&#x6743;&#x9650;&#x7684;&#x9519;&#x8BEF;&#x554A;&#xFF1F;</a></li><li><a href="#fu-wu-qi-shang-xian-hou-zen-me-fa-xian-zong-you-ge-xmrig-de-rong-qi-zai-pao-shan-liao-huan-chu-lai-zhe-shi-shi-me-gui">&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x600E;&#x4E48;&#x53D1;&#x73B0;&#x603B;&#x6709;&#x4E2A; <code>xmrig</code> &#x7684;&#x5BB9;&#x5668;&#x5728;&#x8DD1;&#xFF0C;&#x5220;&#x4E86;&#x8FD8;&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;</a></li></ul></li><li><a href="#wang-luo-wen-ti-13">&#x7F51;&#x7EDC;&#x95EE;&#x9898; <code>(13)</code></a><ul><li><a href="#zen-me-gu-ding-rong-qi-ip-di-zhi-mei-ci-chong-qi-rong-qi-du-yao-bian-hua-ip-di-zhi-zen-me-ban">&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316; IP &#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#ru-he-xiu-gai-rong-qi-de-etc-hosts-wen-jian">&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#xFF1F;</a></li><li><a href="#zen-me-ying-she-su-zhu-duan-kou-dockerfile-zhong-de-expose-he-docker-run-p-you-sha-qu-bie">&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;<code>Dockerfile</code> &#x4E2D;&#x7684;<code>EXPOSE</code>&#x548C; <code>docker run -p</code> &#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F;</a></li><li><a href="#wo-yao-ying-she-hao-ji-bai-ge-duan-kou-nan-dao-yao-yi-ge-ge-p-me">&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A; <code>-p</code> &#x4E48;&#xFF1F;</a></li><li><a href="#wei-shi-me-p-hou-huan-shi-wu-fa-tong-guo-ying-she-duan-kou-fang-wen-rong-qi-li-mian-de-fu-wu">&#x4E3A;&#x4EC0;&#x4E48; <code>-p</code> &#x540E;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x7684;&#x670D;&#x52A1;&#xFF1F;</a></li><li><a href="#vethxxxx-zhe-chong-xu-ni-wang-qia-he-rong-qi-de-dui-ying-guan-xi-cong-na-li-kan"><code>vethxxxx</code> &#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F;</a></li><li><a href="#ru-he-rang-yi-ge-rong-qi-lian-jie-liang-ge-wang-luo">&#x5982;&#x4F55;&#x8BA9;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1F;</a></li><li><a href="#docker-duo-su-zhu-wang-luo-zen-me-pei-zhi">Docker &#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F;</a></li><li><a href="#ming-ming-docker-network-ls-zhong-kan-dao-liao-jian-li-de-overlay-wang-luo-zen-me-docker-run-huan-shuo-wang-luo-bu-cun-zai-a">&#x660E;&#x660E; <code>docker network ls</code> &#x4E2D;&#x770B;&#x5230;&#x4E86;&#x5EFA;&#x7ACB;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x600E;&#x4E48; <code>docker run</code> &#x8FD8;&#x8BF4;&#x7F51;&#x7EDC;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;</a></li><li><a href="#shi-yong-swarm-mode-de-shi-kan-dao-you-ge-jiao-ingress-de-overlay-wang-luo-ta-he-zi-ji-chuang-jian-de-wang-luo-you-shi-me-qu-bie">&#x4F7F;&#x7528; <code>Swarm Mode</code> &#x7684;&#x65F6;&#xFF0C;&#x770B;&#x5230;&#x6709;&#x4E2A;&#x53EB; <code>ingress</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5B83;&#x548C;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684;&#x7F51;&#x7EDC;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</a></li><li><a href="#ting-shuo-link-guo-shi-bu-zai-yong-liao-na-rong-qi-hu-lian-fu-wu-fa-xian-zen-me-ban">&#x542C;&#x8BF4; <code>--link</code> &#x8FC7;&#x65F6;&#x4E0D;&#x518D;&#x7528;&#x4E86;&#xFF1F;&#x90A3;&#x5BB9;&#x5668;&#x4E92;&#x8054;&#x3001;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#shi-yong-hbase-hadoop-de-shi-hou-fan-xiang-jie-xi-zong-shi-bu-dui-zen-me-ban">&#x4F7F;&#x7528; HBase/Hadoop &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x603B;&#x662F;&#x4E0D;&#x5BF9;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#rong-qi-zen-me-qu-su-zhu-ji-ip-a">&#x5BB9;&#x5668;&#x600E;&#x4E48;&#x53D6;&#x5BBF;&#x4E3B;&#x673A; IP &#x554A;&#xFF1F;</a></li></ul></li><li><a href="#cun-chu-wen-ti-11">&#x5B58;&#x50A8;&#x95EE;&#x9898; <code>(11)</code></a><ul><li><a href="#rong-qi-ci-pan-ke-yi-xian-zhi-pei-e-me">&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F;</a></li><li><a href="#rong-qi-nei-de-shu-ju-gai-bao-cun-zai-jing-xiang-li-huan-shi-wu-li-ji-li">&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F;</a></li><li><a href="#kan-dao-zong-shuo-yao-bao-chi-rong-qi-wu-zhuang-tai-na-shi-me-shi-wu-zhuang-tai">&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F;</a></li><li><a href="#shu-ju-rong-qi-shu-ju-juan-ming-ming-juan-ni-ming-juan-gua-zai-mu-lu-zhe-xie-du-you-shi-me-qu-bie">&#x6570;&#x636E;&#x5BB9;&#x5668;&#x3001;&#x6570;&#x636E;&#x5377;&#x3001;&#x547D;&#x540D;&#x5377;&#x3001;&#x533F;&#x540D;&#x5377;&#x3001;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x8FD9;&#x4E9B;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</a></li><li><a href="#juan-he-gua-zai-mu-lu-you-shi-me-qu-bie">&#x5377;&#x548C;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</a></li><li><a href="#wei-shi-me-bang-ding-liao-su-zhu-de-wen-jian-dao-rong-qi-su-zhu-xiu-gai-liao-wen-jian-rong-qi-nei-kan-dao-de-huan-shi-jiu-de-nei-rong-a">&#x4E3A;&#x4EC0;&#x4E48;&#x7ED1;&#x5B9A;&#x4E86;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x5BBF;&#x4E3B;&#x4FEE;&#x6539;&#x4E86;&#x6587;&#x4EF6;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x770B;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x65E7;&#x7684;&#x5185;&#x5BB9;&#x554A;&#xFF1F;</a></li><li><a href="#duo-ge-docker-rong-qi-zhi-jian-gong-xiang-shu-ju-zen-me-ban-nfs">&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS &#xFF1F;</a></li><li><a href="#ji-ran-yi-ge-rong-qi-yi-ge-ying-yong-na-me-wo-xiang-zai-gai-rong-qi-zhong-yong-ji-hua-ren-wu-cron-zen-me-ban">&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1; <code>cron</code> &#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#ru-he-chu-shi-hua-juan">&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;&#x5377;&#xFF1F;</a></li><li><a href="#wei-shi-me-shuo-shu-ju-ku-bu-gua-he-fang-zai-docker-rong-qi-li-yun-xing">&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x9002;&#x5408;&#x653E;&#x5728; Docker &#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;&#xFF1F;</a></li><li><a href="#ru-he-lie-chu-rong-qi-he-suo-shi-yong-de-juan-de-guan-xi">&#x5982;&#x4F55;&#x5217;&#x51FA;&#x5BB9;&#x5668;&#x548C;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x7684;&#x5173;&#x7CFB;&#xFF1F;</a></li></ul></li><li><a href="#jing-xiang-wen-ti-17">&#x955C;&#x50CF;&#x95EE;&#x9898; <code>(17)</code></a><ul><li><a href="#docker-pull-xia-lai-de-jing-xiang-wen-jian-du-zai-na"><code>docker pull</code> &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F;</a></li><li><a href="#docker-images-ming-ling-xian-shi-de-jing-xiang-zhan-liao-hao-da-de-kong-jian-zen-me-ban-mei-ci-du-shi-xia-zai-zhe-me-da-de-jing-xiang"><code>docker images</code> &#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F;</a></li><li><a href="#docker-images-a-hou-xian-shi-liao-hao-duo-none-de-jing-xiang-du-shi-shi-me-ya-neng-shan-me"><code>docker images -a</code> &#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A; <code>&lt;none&gt;</code> &#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F;</a></li><li><a href="#wei-shi-me-docker-hub-de-jing-xiang-chi-cun-he-docker-images-bu-yi-zhi">&#x4E3A;&#x4EC0;&#x4E48; Docker Hub &#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C; <code>docker images</code> &#x4E0D;&#x4E00;&#x81F4;&#xFF1F;</a></li><li><a href="#docker-commit-zen-me-yong-a"><code>docker commit</code> &#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F;</a></li><li><a href="#wei-shi-me-shuo-bu-yao-shi-yong-import-export-save-load-commit-lai-gou-jian-jing-xiang">&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528; <code>import</code>, <code>export</code>, <code>save</code>, <code>load</code>, <code>commit</code> &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF1F;</a></li><li><a href="#dockerfile-zen-me-xie"><code>Dockerfile</code> &#x600E;&#x4E48;&#x5199;&#xFF1F;</a></li><li><a href="#dockerfile-jiu-shi-shell-jiao-ben-ba-na-wo-dong-yi-xing-xing-ba-xu-yao-zhuang-de-dong-xi-du-xie-jin-qu-bu-jiu-xing-liao"><code>Dockerfile</code> &#x5C31;&#x662F; <code>shell</code> &#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002;</a></li><li><a href="#na-wo-ba-suo-you-ming-ling-du-he-bing-dao-yi-ge-run-jiu-dui-liao-ba">&#x90A3;&#x6211;&#x628A;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x90FD;&#x5408;&#x5E76;&#x5230;&#x4E00;&#x4E2A; <code>RUN</code> &#x5C31;&#x5BF9;&#x4E86;&#x5427;&#xFF1F;</a></li><li><a href="#context-dao-di-shi-yi-ge-shi-me-gai-nian"><code>context</code> &#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F;</a></li><li><a href="#entrypoint-he-cmd-dao-di-you-shi-me-bu-tong"><code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;</a></li><li><a href="#na-dao-yi-ge-jing-xiang-ru-he-huo-de-jing-xiang-de-dockerfile">&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code> &#xFF1F;</a></li><li><a href="#zai-ni-de-lnmp-de-li-zi-zhong-php-de-dockerfile-li-mian-de-gou-jian-yi-lai-he-yun-xing-yi-lai-du-shi-shi-me-yi-si">&#x5728;&#x4F60;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP &#x7684; <code>Dockerfile</code> &#x91CC;&#x9762;&#x7684; &#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D; &#x548C; &#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D; &#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;</a></li><li><a href="#ying-yong-dai-ma-shi-ying-gai-gua-zai-su-zhu-mu-lu-huan-shi-fang-ru-jing-xiang-nei">&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F;</a></li><li><a href="#wei-shi-me-zai-dockerfile-zhong-zhi-xing-dao-ru-sql-service-xxx-start-bu-guan-yong">&#x4E3A;&#x4EC0;&#x4E48;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x6267;&#x884C;&#xFF08;&#x5BFC;&#x5165; <code>.sql</code>&#x3001;<code>service xxx start</code>&#xFF09;&#x4E0D;&#x7BA1;&#x7528;&#xFF1F;</a></li><li><a href="#wei-shi-me-ji-yu-alpine-de-jing-xiang-na-me-xiao-wo-ke-yi-du-huan-cheng-ji-yu-alpine-de-jing-xiang-me">&#x4E3A;&#x4EC0;&#x4E48;&#x57FA;&#x4E8E; Alpine &#x7684;&#x955C;&#x50CF;&#x90A3;&#x4E48;&#x5C0F;&#xFF1F;&#x6211;&#x53EF;&#x4EE5;&#x90FD;&#x6362;&#x6210;&#x57FA;&#x4E8E; Alpine &#x7684;&#x955C;&#x50CF;&#x4E48;&#xFF1F;</a></li><li><a href="#ke-yi-kan-dao-jing-xiang-ge-ceng-de-yi-lai-guan-xi-me">&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x955C;&#x50CF;&#x5404;&#x5C42;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x4E48;&#xFF1F;</a></li></ul></li><li><a href="#ri-zhi-wen-ti-2">&#x65E5;&#x5FD7;&#x95EE;&#x9898; <code>(2)</code></a><ul><li><a href="#docker-ri-zhi-du-zai-na-li-zen-me-shou-ji">Docker &#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F;</a></li><li><a href="#bu-tong-rong-qi-de-ri-zhi-hui-ju-dao-fluentd-hou-ru-he-qu-fen">&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6C47;&#x805A;&#x5230; <code>fluentd</code> &#x540E;&#x5982;&#x4F55;&#x533A;&#x5206;&#xFF1F;</a></li></ul></li><li><a href="#shi-yong-wen-ti-11">&#x4F7F;&#x7528;&#x95EE;&#x9898; <code>(11)</code></a><ul><li><a href="#wei-shi-me-rong-qi-yi-yun-xing-jiu-tui-chu-a">&#x4E3A;&#x4EC0;&#x4E48;&#x5BB9;&#x5668;&#x4E00;&#x8FD0;&#x884C;&#x5C31;&#x9000;&#x51FA;&#x554A;&#xFF1F;</a></li><li><a href="#ru-he-zai-docker-rong-qi-nei-shi-yong-docker-ming-ling-bi-ru-zai-jenkins-rong-qi-zhong">&#x5982;&#x4F55;&#x5728; Docker  &#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;(&#x6BD4;&#x5982;&#x5728; Jenkins &#x5BB9;&#x5668;&#x4E2D;)&#xFF1F;</a></li><li><a href="#docker-rong-qi-ru-he-sui-xi-tong-yi-tong-qi-dong">Docker &#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F;</a></li><li><a href="#docker-stats-xian-shi-de-zhi-you-rong-qi-id-zen-me-cai-neng-xian-shi-rong-qi-ming-zi"><code>docker stats</code> &#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F;</a></li><li><a href="#wo-yong-de-shi-a-li-yun-ubuntu-14-04-zhu-ji-nei-he-huan-shi-3-13-zen-me-ban">&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91; <code>Ubuntu 14.04</code> &#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;<code>3.13</code>&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#ru-he-dong-tai-xiu-gai-nei-cun-xian-zhi">&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F;</a></li><li><a href="#jing-chang-zai-ge-chong-docker-ming-ling-li-kan-dao-label-label-shi-shi-me-gan-shi-me-yong-de">&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD; <code>Docker</code> &#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230; <code>--label</code>&#xFF0C;<code>label</code> &#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F;</a></li><li><a href="#du-shuo-bu-yao-yong-root-qu-yun-xing-fu-wu-dan-wo-kan-dao-de-dockerfile-du-shi-yong-root-qu-yun-xing-zhe-bu-an-quan-ba">&#x90FD;&#x8BF4;&#x4E0D;&#x8981;&#x7528; <code>root</code> &#x53BB;&#x8FD0;&#x884C;&#x670D;&#x52A1;&#xFF0C;&#x4F46;&#x6211;&#x770B;&#x5230;&#x7684; <code>Dockerfile</code> &#x90FD;&#x662F;&#x7528; <code>root</code> &#x53BB;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x5427;&#xFF1F;</a></li><li><a href="#wo-zai-rong-qi-li-yun-xing-systemctl-start-xxx-zen-me-bao-cuo-a">&#x6211;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C; <code>systemctl start xxx</code> &#x600E;&#x4E48;&#x62A5;&#x9519;&#x554A;&#xFF1F;</a></li><li><a href="#rong-qi-nei-de-shi-jian-he-su-zhu-bu-yi-zhi-zen-me-tong-bu-a">&#x5BB9;&#x5668;&#x5185;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x600E;&#x4E48;&#x540C;&#x6B65;&#x554A;&#xFF1F;</a></li><li><a href="#wo-xiang-rang-wo-de-cheng-xu-ping-hua-tui-chu-wei-shi-me-jie-huo-sigterm-xin-hao-bu-guan-yong-a">&#x6211;&#x60F3;&#x8BA9;&#x6211;&#x7684;&#x7A0B;&#x5E8F;&#x5E73;&#x6ED1;&#x9000;&#x51FA;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x622A;&#x83B7; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF1F;</a></li></ul></li></ul></li><li><a href="#docker-compose-xiang-guan-wen-ti-2">Docker Compose &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(2)</code></a><ul><li><a href="#ni-na-ge-lnmp-li-zi-zhong-de-docker-compose-yml-zhong-you-hao-duo-networks-du-shi-shi-me-yi-si-a">&#x4F60;&#x90A3;&#x4E2A; <code>LNMP</code> &#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>docker-compose.yml</code> &#x4E2D;&#x6709;&#x597D;&#x591A; <code>networks</code>&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F;</a></li><li><a href="#shi-yong-compose-de-shi-hou-peng-dao-an-http-request-took-too-long-to-complete-cuo-wu-zen-me-ban">&#x4F7F;&#x7528; Compose &#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230; &#x201C;An HTTP request took too long to complete&#x2026;.&#x201D; &#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li></ul></li><li><a href="#docker-swarm-xiang-guan-wen-ti-8">Docker Swarm &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(8)</code></a><ul><li><a href="#wo-de-docker-ban-ben-shi-1-12-qing-wen-wo-pao-de-shi-yi-dai-swarm-huan-shi-er-dai-swarm-a">&#x6211;&#x7684; Docker &#x7248;&#x672C;&#x662F; 1.12&#xFF0C;&#x8BF7;&#x95EE;&#x6211;&#x8DD1;&#x7684;&#x662F;&#x4E00;&#x4EE3; Swarm &#x8FD8;&#x662F;&#x4E8C;&#x4EE3; Swarm &#x554A;&#xFF1F;</a></li><li><a href="#swarm-huan-jing-zhong-zen-me-zhi-ding-mou-ge-rong-qi-zai-zhi-ding-de-su-zhu-shang-yun-xing-ni">Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F;</a></li><li><a href="#wei-shi-me-swarm-ji-qun-de-overlay-network-kua-su-zhu-wu-fa-hu-fang">&#x4E3A;&#x4EC0;&#x4E48; Swarm &#x96C6;&#x7FA4;&#x7684; overlay network &#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F;</a></li><li><a href="#docker-er-dai-swarm-ji-swarm-mode-docker-service-create-bu-ke-yi-shi-yong-v-na-zen-me-shi-yong-juan-volume">Docker &#x4E8C;&#x4EE3;Swarm (&#x65E2; Swarm Mode)&#xFF0C;<code>docker service create</code> &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-v</code> &#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;(Volume)&#xFF1F;</a></li><li><a href="#dui-yu-liang-jie-dian-ji-qun-lai-shuo-replicas-2-he-mode-global-shi-bu-shi-yi-ge-yi-si">&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;<code>--replicas=2</code> &#x548C; <code>--mode=global</code> &#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F;</a></li><li><a href="#yi-dai-swarm-de-shi-hou-ke-yi-yong-docker-run-a-er-dai-zen-me-you-nong-ge-docker-service-create-chu-lai-wei-shi-me-yao-duo-ci-yi-ju">&#x4E00;&#x4EE3; Swarm &#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x7528; <code>docker run</code> &#x554A;&#xFF0C;&#x4E8C;&#x4EE3;&#x600E;&#x4E48;&#x53C8;&#x5F04;&#x4E2A; <code>docker service create</code> &#x51FA;&#x6765;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x591A;&#x6B64;&#x4E00;&#x4E3E;&#xFF1F;</a></li><li><a href="#docker-service-ps-li-mian-zong-shi-you-yi-dui-shi-bai-huo-zhe-shutdown-de-li-shi-rong-qi-zen-me-shan-a"><code>docker service ps</code> &#x91CC;&#x9762;&#x603B;&#x662F;&#x6709;&#x4E00;&#x5806;&#x5931;&#x8D25;&#x6216;&#x8005;shutdown&#x7684;&#x5386;&#x53F2;&#x5BB9;&#x5668;&#xFF0C;&#x600E;&#x4E48;&#x5220;&#x554A;&#xFF1F;</a></li><li><a href="#zen-me-cai-neng-rang-docker-service-create-chuang-jian-de-fu-wu-zheng-chang-tui-chu-shi-bu-chong-qi-a">&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; <code>docker service create</code> &#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#x65F6;&#x4E0D;&#x91CD;&#x542F;&#x554A;&#xFF1F;</a></li></ul></li><li><a href="#docker-machine-xiang-guan-wen-ti-5">Docker Machine &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(5)</code></a><ul><li><a href="#da-kai-ming-ling-xing-hou-kan-dao-xia-zai-sha-boot2docker-iso-ran-hou-zong-shi-chao-shi-shi-bai-zen-me-ban">&#x6253;&#x5F00;&#x547D;&#x4EE4;&#x884C;&#x540E;&#xFF0C;&#x770B;&#x5230;&#x4E0B;&#x8F7D;&#x5565; <code>boot2docker.iso</code>&#xFF0C;&#x7136;&#x540E;&#x603B;&#x662F;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#zhuang-wan-docker-toolbox-hou-fa-xian-xia-zai-jing-xiang-su-du-tai-man-shi-bu-shi-xu-yao-xiu-gai-shi-me-pei-zhi-wen-jian">&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F;</a></li><li><a href="#ru-he-zai-docker-toolbox-zhong-chuang-jian-de-default-xu-ni-ji-zhong-tian-jia-docker-opts-zhi-lei-de-pei-zhi">&#x5982;&#x4F55;&#x5728; Docker Toolbox &#x4E2D;&#x521B;&#x5EFA;&#x7684; <code>default</code> &#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;<code>DOCKER_OPTS</code>&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F;</a></li><li><a href="#docker-machine-chuang-jian-de-zhu-ji-zen-me-zhi-jie-ssh-jin-qu-gai-liao-root-mi-ma-hao-xiang-ye-mei-yong"><code>docker-machine</code> &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5; <code>ssh</code> &#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86; <code>root</code> &#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F;</a></li><li><a href="#docker-machine-shi-yong-d-generic-shi-zhi-ding-yong-hu-generic-ssh-user-hou-fa-xian-yao-sudo-mi-ma-jie-guo-bao-cuo-tui-chu-zhe-shi-zen-me-hui-shi"><code>docker-machine</code> &#x4F7F;&#x7528; <code>-d generic</code> &#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237; <code>--generic-ssh-user</code> &#x540E;&#x53D1;&#x73B0;&#x8981; <code>sudo</code> &#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;</a></li></ul></li><li><a href="#docker-registry-xiang-guan-wen-ti-10">Docker Registry &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(10)</code></a><ul><li><a href="#wo-docker-push-de-shi-hou-zen-me-bao-authentication-required-cuo-wu">&#x6211; <code>docker push</code> &#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5; <code>authentication required</code> &#x9519;&#x8BEF;&#xFF1F;</a></li><li><a href="#wei-shi-me-wo-docker-login-shi-bai-liao-wo-zhu-ce-yong-hu-liao-zai-wang-zhan-deng-lu-ye-mei-wen-ti-ya">&#x4E3A;&#x4EC0;&#x4E48;&#x6211; <code>docker login</code> &#x5931;&#x8D25;&#x4E86;&#xFF1F;&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237;&#x4E86;&#xFF0C;&#x5728;&#x7F51;&#x7AD9;&#x767B;&#x5F55;&#x4E5F;&#x6CA1;&#x95EE;&#x9898;&#x5440;&#xFF1F;</a></li><li><a href="#wo-zhu-ce-yong-hu-pinkman-liao-zen-me-huan-shi-wu-fa-docker-push-mrwhite-xxx-a">&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237; <code>pinkman</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5; <code>docker push mrwhite/xxx</code> &#x554A;&#xFF1F;</a></li><li><a href="#bu-guan-yong-a-wo-zhe-hui-docker-push-pinkman-xxx-liao-zen-me-gao-su-wo-jing-xiang-bu-cun-zai-a">&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE; <code>docker push pinkman/xxx</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x955C;&#x50CF;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;</a></li><li><a href="#docker-push-dao-si-you-registry-zong-shi-bu-cheng-gong-zen-me-ban"><code>docker push</code> &#x5230;&#x79C1;&#x6709; <code>registry</code> &#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li><li><a href="#wo-docker-push-liao-hen-duo-jing-xiang-dao-si-you-de-registry-shang-zen-me-cai-neng-cha-kan-shang-mian-du-you-sha-huo-zhe-sou-suo">&#x6211; <code>docker push</code> &#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684; <code>registry</code> &#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F;</a></li><li><a href="#docker-search-wei-shi-me-mei-you-ban-fa-zai-si-you-registry-zhong-yong"><code>docker search</code> &#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5728;&#x79C1;&#x6709; <code>Registry</code> &#x4E2D;&#x7528;&#xFF1F;</a></li><li><a href="#ru-he-shan-chu-si-you-registry-zhong-de-jing-xiang">&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709; <code>registry</code> &#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F;</a></li><li><a href="#shi-yong-guo-nei-jing-xiang-huan-shi-man-gong-si-nei-hao-duo-docker-zhu-ji-du-xu-yao-qu-chong-fu-xia-zai-jing-xiang-zha-ban">&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A; docker &#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F;</a></li><li><a href="#zi-ji-jia-de-registry-zen-me-ren-he-yong-hu-du-ke-yi-qu-dao-jing-xiang-zhe-bu-an-quan-a">&#x81EA;&#x5DF1;&#x67B6;&#x7684; <code>registry</code> &#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F;</a></li></ul></li><li><a href="#xi-tong-xiang-guan-wen-ti-7">&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x95EE;&#x9898; <code>(7)</code></a><ul><li><a href="#centos-rhel-hong-mao-xi-tong-te-you-wen-ti">CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898;</a><ul><li><a href="#zai-centos-6-shang-an-zhuang-hou-zen-me-zui-gao-zhi-you-docker-1-7-zhe-ge-ban-ben">&#x5728; CentOS 6 &#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709; Docker 1.7 &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F;</a></li><li><a href="#gua-zai-su-zhu-mu-lu-jie-guo-permission-denied-mei-quan-xian">&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C; <code>Permission denied</code>&#xFF0C;&#x6CA1;&#x6743;&#x9650;</a></li><li><a href="#docker-de-var-lib-docker-devicemapper-zhan-yong-kong-jian-bu-duan-zeng-chang-zen-me-po">Docker&#x7684; <code>/var/lib/docker/devicemapper</code> &#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;, &#x600E;&#x4E48;&#x7834;&#xFF1F;</a></li><li><a href="#centos-7-de-nei-he-tai-lao-liao-3-10-shi-bu-shi-hen-duo-docker-gong-neng-bu-zhi-chi">CentOS 7 &#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86; 3.10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;</a></li><li><a href="#centos-7-rhel-7-sheng-ji-1-12-hou-wu-fa-qi-dong-zen-me-hui-shi">CentOS 7/RHEL 7 &#x5347;&#x7EA7; 1.12 &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;</a></li></ul></li><li><a href="#mac-windows-xiang-guan-wen-ti">Mac / Windows &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul><li><a href="#wei-shi-me-zai-mac-xia-gua-zai-su-zhu-mu-lu-usr-local-nginx-bu-cheng-gong">&#x4E3A;&#x4EC0;&#x4E48;&#x5728;<code>Mac</code>&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;<code>/usr/local/nginx</code>&#x4E0D;&#x6210;&#x529F;&#xFF1F;</a></li><li><a href="#ting-shuo-windows-10-windows-server-2016-nei-zhi-docker-liao-he-docker-guan-wang-xia-zai-de-docker-for-windows-you-shi-me-qu-bie-a">&#x542C;&#x8BF4; Windows 10&#x3001;Windows Server 2016 &#x5185;&#x7F6E; Docker &#x4E86;&#xFF1F;&#x548C; Docker &#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x7684; Docker for Windows &#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x554A;&#xFF1F;</a></li></ul></li></ul></li><li><a href="#qi-ta-wen-ti-1">&#x5176;&#x5B83;&#x95EE;&#x9898; <code>(1)</code></a><ul><li><a href="#kubernetes-zhe-ci-zha-nian-a-wei-sha-you-ren-guan-ta-jiao-k8s"><code>Kubernetes</code> &#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;&#x4E3A;&#x5565;&#x6709;&#x4EBA;&#x7BA1;&#x5B83;&#x53EB; <code>k8s</code> &#xFF1F;</a></li></ul></li></ul><!-- tocstop --><h1 id="docker-yin-qing-xiang-guan-wen-ti-67"><a href="#Docker-&#x5F15;&#x64CE;&#x76F8;&#x5173;&#x95EE;&#x9898;-67" class="headerlink" title="Docker &#x5F15;&#x64CE;&#x76F8;&#x5173;&#x95EE;&#x9898; (67)"></a>Docker &#x5F15;&#x64CE;&#x76F8;&#x5173;&#x95EE;&#x9898; <code>(67)</code> <a href="#docker-yin-qing-xiang-guan-wen-ti-67" class="header-anchor">#</a></h1><h2 id="gai-nian-wen-ti-5"><a href="#&#x6982;&#x5FF5;&#x95EE;&#x9898;-5" class="headerlink" title="&#x6982;&#x5FF5;&#x95EE;&#x9898; (5)"></a>&#x6982;&#x5FF5;&#x95EE;&#x9898; <code>(5)</code> <a href="#gai-nian-wen-ti-5" class="header-anchor">#</a></h2><h3 id="su-zhu-ru-guo-he-rong-qi-xi-tong-bu-tong-de-hua-na-bu-shi-he-xu-ni-ji-yi-yang-yi-ceng-ceng-de-diao-yong-na-me-docker-he-xu-ni-ji-huan-you-shi-me-chai-bie"><a href="#&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;-Docker-&#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F;" class="headerlink" title="&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48; Docker &#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F;"></a>&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48; Docker &#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F; <a href="#su-zhu-ru-guo-he-rong-qi-xi-tong-bu-tong-de-hua-na-bu-shi-he-xu-ni-ji-yi-yang-yi-ceng-ceng-de-diao-yong-na-me-docker-he-xu-ni-ji-huan-you-shi-me-chai-bie" class="header-anchor">#</a></h3><p>&#x8981;&#x628A; Windows &#x548C; Linux &#x5206;&#x6E05;&#x695A;&#xFF0C;&#x66F4;&#x8981;&#x628A;&#x5185;&#x6838;(<code>kernel</code>)&#x548C;&#x7528;&#x6237;&#x7A7A;&#x95F4;(<code>userland</code>)&#x5206;&#x6E05;&#x695A;&#x3002;</p><p>&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;&#x662F;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4E8E;<code>&#x5BBF;&#x4E3B;&#x5185;&#x6838;</code>&#x7684;&#xFF0C;&#x8FD9;&#x70B9;&#x548C;&#x5BBF;&#x4E3B;&#x8FDB;&#x7A0B;&#x4E00;&#x81F4;&#xFF0C;&#x53EA;&#x662F;&#x5BB9;&#x5668;&#x7684; <code>userland</code> &#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x7684; <code>userland</code> &#x7531;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x63D0;&#x4F9B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x955C;&#x50CF;&#x63D0;&#x4F9B;&#x4E86; <code>rootfs</code>&#x3002;</p><p>&#x5047;&#x8BBE;&#x5BBF;&#x4E3B;&#x662F; <code>Ubuntu</code>&#xFF0C;&#x5BB9;&#x5668;&#x662F; <code>CentOS</code>&#x3002;<code>CentOS</code> &#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x4F1A;&#x76F4;&#x63A5;&#x5411; <code>Ubuntu</code> &#x5BBF;&#x4E3B;&#x5185;&#x6838;&#x53D1;&#x9001; <code>syscall</code>&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x76F4;&#x63A5;&#x6216;&#x95F4;&#x63A5;&#x7684;&#x4F7F;&#x7528;&#x4EFB;&#x4F55; <code>Ubuntu</code> &#x7684; <code>userland</code> &#x7684;&#x5E93;&#x3002;</p><p>&#x8FD9;&#x70B9;&#x548C;&#x865A;&#x62DF;&#x673A;&#x6709;&#x672C;&#x8D28;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x662F;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x73B0;&#x6709;&#x7CFB;&#x7EDF;&#x4E0A;&#x865A;&#x62DF;&#x4E00;&#x5957;&#x7269;&#x7406;&#x8BBE;&#x5907;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x865A;&#x62DF;&#x73AF;&#x5883;&#x5185;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x73AF;&#x5883;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#xFF0C;&#x5728;&#x5185;&#x6838;&#x4E4B;&#x4E0A;&#x518D;&#x8DD1;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E76;&#x5728;&#x91CC;&#x9762;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x3002;</p><p>&#x8FD8;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53BB;&#x8003;&#x8651;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;<code>CentOS</code> &#x7684;&#x8FDB;&#x7A0B;&#x53D1;&#x9001; <code>syscall</code> &#x5185;&#x6838;&#x8C03;&#x7528;&#xFF0C;&#x8BE5;&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684; <code>CentOS</code> &#x7684;&#x5185;&#x6838;&#x63A5;&#x5230;&#xFF0C;&#x7136;&#x540E; <code>CentOS</code> &#x5185;&#x6838;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x786C;&#x4EF6;&#x65F6;&#xFF0C;&#x7531;&#x865A;&#x62DF;&#x673A;&#x7684;&#x670D;&#x52A1;&#x8F6F;&#x4EF6;&#x622A;&#x83B7;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>Ubuntu</code> &#x7684;&#x5185;&#x6838;&#x53CA; <code>userland</code> &#x7684;&#x5E93;&#x53BB;&#x6267;&#x884C;&#x3002;</p><p>&#x800C;&#x4E14;&#xFF0C;Linux &#x548C; Windows &#x5728;&#x8FD9;&#x70B9;&#x4E0A;&#x975E;&#x5E38;&#x4E0D;&#x540C;&#x3002;Linux &#x7684;&#x8FDB;&#x7A0B;&#x662F;&#x76F4;&#x63A5;&#x53D1; <code>syscall</code> &#x7684;&#xFF0C;&#x800C; Windows &#x5219;&#x628A; <code>syscall</code> &#x9690;&#x85CF;&#x4E8E;&#x4E00;&#x5C42;&#x5C42;&#x7684; <code>DLL</code> &#x670D;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x56E0;&#x6B64; Windows &#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5982;&#x679C;&#x8981;&#x6267;&#x884C;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x9700;&#x8981; Windows &#x5185;&#x6838;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x6765;&#x652F;&#x6491;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C; Windows &#x8981;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x5C06;&#x4E0D;&#x4F1A;&#x50CF; Linux &#x8FD9;&#x6837;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x800C;&#x662F;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x3002;&#x770B;&#x4E00;&#x4E0B;&#x5FAE;&#x8F6F;&#x79FB;&#x690D;&#x7684; Docker &#x5C31;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x4E86;&#x3002;</p><p>&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x628A; Docker &#x548C;&#x865A;&#x62DF;&#x673A;&#x5F04;&#x6DF7;&#xFF0C;Docker &#x5BB9;&#x5668;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x800C;&#x5DF2;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5229;&#x7528;&#x955C;&#x50CF;&#x63D0;&#x4F9B;&#x7684; <code>rootfs</code> &#x63D0;&#x4F9B;&#x4E86;&#x8C03;&#x7528;&#x6240;&#x9700;&#x7684; <code>userland</code> &#x5E93;&#x652F;&#x6301;&#xFF0C;&#x4F7F;&#x5F97;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x5728;&#x53D7;&#x63A7;&#x73AF;&#x5883;&#x4E0B;&#x8FD0;&#x884C;&#x800C;&#x5DF2;&#xFF0C;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x865A;&#x62DF;&#x51FA;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x51FA;&#x6765;&#x3002;</p><p>&#x53C2;&#x8003;&#xFF1A;</p><ul><li>(&#x82F1;&#x6587;): <a href="https://www.docker.com/what-docker" target="_blank" rel="noopener">https://www.docker.com/what-docker</a></li><li>(&#x4E2D;&#x6587;): <a href="https://www.docker-cn.com/what-docker" target="_blank" rel="noopener">https://www.docker-cn.com/what-docker</a></li></ul><p><a href="/post/docker-2016-08-12-video-windows-server-and-docker.html">&#x89C6;&#x9891;&#x7B14;&#x8BB0;&#xFF1A; Windows Server &#x548C; Docker - John Starks</a></p><h3 id="docker-zi-liao-hao-shao-a-wang-shang-de-ming-ling-zen-me-bu-neng-yong"><a href="#Docker-&#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F;" class="headerlink" title="Docker &#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F;"></a>Docker &#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F; <a href="#docker-zi-liao-hao-shao-a-wang-shang-de-ming-ling-zen-me-bu-neng-yong" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#xFF0C;&#x505A;&#x6280;&#x672F;&#x5DE5;&#x4F5C;&#xFF0C;&#x8BF7;&#x73CD;&#x60DC;&#x751F;&#x547D;&#xFF0C;&#x8FDC;&#x79BB;&#x767E;&#x5EA6;&#xFF1B;<br>&#x5176;&#x6B21;&#xFF0C;&#x4E0D;&#x7FFB;&#x5899;&#x3001;&#x4E0D;&#x7528;Google&#x3001;&#x4E0D;&#x770B;&#x82F1;&#x6587;&#x8D44;&#x6599;&#xFF0C;&#x90A3;&#x8BF7;&#x8F6C;&#x884C;&#xFF0C;&#x6CA1;&#x6CD5;&#x6DF7;&#x3002;</p><p>&#x7136;&#x540E;&#x662F;&#x56DE;&#x7B54;&#x95EE;&#x9898;&#xFF0C;Docker&#x7684;&#x8D44;&#x6599;&#x5176;&#x5B9E;&#x5F88;&#x4E30;&#x5BCC;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8BB2;&#x89E3;&#x975E;&#x5E38;&#x8BE6;&#x7EC6;&#x3002;</p><ul><li>(&#x82F1;&#x6587;): <a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></li><li>(&#x4E2D;&#x6587;): <a href="https://docs.docker-cn.com" target="_blank" rel="noopener">https://docs.docker-cn.com</a> (&#x6587;&#x6863;&#x6709;&#x5751;&#xFF0C;&#x4E0D;&#x5C11;&#x4EE3;&#x7801;&#x683C;&#x5F0F;&#x6709;&#x9519;)</li><li>(&#x8001;&#x9EA6;&#x7684;&#x7FFB;&#x8BD1;): <a href="https://www.gitbook.com/read/book/octowhale/docker-doc-cn" target="_blank" rel="noopener">https://www.gitbook.com/read/book/octowhale/docker-doc-cn</a></li></ul><p>&#x53E6;&#x5916;&#xFF0C;Docker&#x6709;&#x4E30;&#x5BCC;&#x7684;&#x955C;&#x50CF;&#x5E93;&#xFF0C;Docker Hub&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5B98;&#x65B9;(Official)&#x7684;&#x955C;&#x50CF;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x5236;&#x4F5C;&#x6BD4;&#x8F83;&#x7CBE;&#x826F;&#x3002;</p><p><a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">https://hub.docker.com/explore/</a></p><p>&#x6240;&#x6709;&#x7684;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#x90FD;&#x6709; <code>Dockerfile</code>&#xFF0C;&#x4EE5;&#x53CA;&#x5728;github&#x4E0A;&#x6709;&#x5168;&#x90E8;&#x751F;&#x6210;&#x955C;&#x50CF;&#x7684;&#x914D;&#x5957;&#x6587;&#x4EF6;&#xFF0C;&#x9075;&#x5FAA;&#x4E86;<code>Dockerfile</code>&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E5F;&#x662F;&#x5F88;&#x597D;&#x5730;&#x5B66;&#x4E60;&#x8D44;&#x6599;&#x3002;</p><p>&#x53E6;&#x5916;&#xFF0C;&#x5728; YouTube &#x7684; Docker &#x5B98;&#x65B9;&#x9891;&#x9053;&#x4E0B;&#x6709;&#x51E0;&#x767E;&#x4E2A;&#x89C6;&#x9891;&#x8BB2;&#x5EA7;&#xFF0C;&#x4ECE;&#x521D;&#x7EA7;&#x5230;&#x9AD8;&#x7EA7;&#x7528;&#x6237;&#x90FD;&#x80FD;&#x4ECE;&#x91CC;&#x9762;&#x5B66;&#x5230;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x3002;</p><p><a href="https://www.youtube.com/user/dockerrun" target="_blank" rel="noopener">https://www.youtube.com/user/dockerrun</a></p><h3 id="ru-he-xuan-ze-docker-shu-ji"><a href="#&#x5982;&#x4F55;&#x9009;&#x62E9;-Docker-&#x4E66;&#x7C4D;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x9009;&#x62E9; Docker &#x4E66;&#x7C4D;&#xFF1F;"></a>&#x5982;&#x4F55;&#x9009;&#x62E9; Docker &#x4E66;&#x7C4D;&#xFF1F; <a href="#ru-he-xuan-ze-docker-shu-ji" class="header-anchor">#</a></h3><p>Docker &#x5C5E;&#x4E8E;&#x654F;&#x6377;&#x5F00;&#x53D1;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;&#x5E76;&#x4E14;&#x5904;&#x4E8E;&#x9AD8;&#x901F;&#x521B;&#x65B0;&#x9636;&#x6BB5;&#xFF0C;&#x6BCF;&#x5E74;&#x90FD;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x7248;&#x672C;&#x53D1;&#x5E03;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x79CD;&#x5FEB;&#x901F;&#x5F00;&#x53D1;&#x7684;&#x7279;&#x6027;&#xFF0C;Docker &#x4E00;&#x822C;&#x53EA;&#x4FDD;&#x7559;&#x51E0;&#x4E2A;&#x7248;&#x672C;&#x5185;&#x7684;&#x5411;&#x540E;&#x517C;&#x5BB9;&#x6027;&#xFF0C;&#x518D;&#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x5E9F;&#x5F03;&#x3002;&#x56E0;&#x6B64;&#x9009;&#x62E9;&#x56FE;&#x4E66;&#x7684;&#x65F6;&#x5019;&#xFF0C;<strong>&#x4E0D;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x6BD4;&#x5F53;&#x524D;&#x7248;&#x672C;&#x4F4E;&#x8D85;&#x8FC7;2-3&#x4E2A;&#x7248;&#x672C;&#x7684;&#x4E66;&#x7C4D;</strong>&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5E02;&#x9762;&#x4E0A;&#x5927;&#x90E8;&#x5206;&#x4E66;&#x7C4D;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x4E2D;&#x6587;&#x4E66;&#x7C4D;&#x3001;&#x7F51;&#x6587;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x90FD;&#x8FC7;&#x65F6;&#x4E86;&#x3002;</p><p>Docker &#x7248;&#x672C;&#x53F7;&#x5728; 2017 &#x5E74;&#x4EE5;&#x524D;&#xFF0C;&#x4F7F;&#x7528; <code>&lt;&#x5927;&#x7248;&#x672C;&#x53F7;&gt;.&lt;&#x5C0F;&#x7248;&#x672C;&#x53F7;&gt;.&lt;&#x8865;&#x4E01;&#x7248;&#x672C;&#x53F7;&gt;</code> &#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x90A3;&#x65F6; Docker &#x57FA;&#x672C;&#x4F1A;&#x4FDD;&#x6301; <strong>3 &#x4E2A;&#x5C0F;&#x7248;&#x672C;&#x53F7;</strong> &#x4E4B;&#x5185;&#x7684;&#x517C;&#x5BB9;&#x6027;&#xFF08;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#x5BA3;&#x5E03;&#x5E9F;&#x5F03;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5728; 3 &#x4E2A;&#x7248;&#x672C;&#x540E;&#x624D;&#x5F7B;&#x5E95;&#x79FB;&#x9664;&#xFF09;&#x3002;</p><p>&#x800C;&#x4ECE; 2017 &#x5E74;&#x6625;&#x4EE5;&#x540E;&#xFF0C;Docker &#x4F7F;&#x7528;&#x4E86;&#x65B0;&#x7248;&#x672C;&#x53F7;&#x7ED3;&#x6784;&#xFF1A;<code>&lt;&#x5E74;&gt;.&lt;&#x6708;&gt;.&lt;&#x8865;&#x4E01;&#x7248;&#x672C;&#x53F7;&gt;</code>&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x6BCF;&#x6708;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;<strong>&#x524D;&#x6CBF;(Edge)&#x7248;&#x672C;</strong>&#xFF0C;&#x6BCF;&#x5B63;&#x5EA6;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;<strong>&#x7A33;&#x5B9A;(Stable)&#x7248;&#x672C;</strong>&#x3002;&#x56E0;&#x6B64;&#x9009;&#x62E9;&#x4E66;&#x7C4D;&#x4E5F;&#x5E94;&#x8BE5;&#x4EE5;&#x4ECB;&#x7ECD; <strong>2-3&#x4E2A;&#x5B63;&#x5EA6;&#x4EE5;&#x5185;&#x7248;&#x672C;</strong> &#x7684;&#x4E66;&#x7C4D;&#x4E3A;&#x51C6;&#x3002;&#x90A3;&#x4E9B;&#x4ECB;&#x7ECD;&#x4E00;&#x5E74;&#x4EE5;&#x524D;&#x53D1;&#x5E03;&#x7684; Docker &#x7248;&#x672C;&#x7684;&#x4E66;&#x7C4D;&#x4E0D;&#x5E94;&#x8BE5;&#x518D;&#x770B;&#x4E86;&#x3002;</p><p>&#x56E0;&#x6B64;&#x5728;&#x8D2D;&#x4E70; Docker &#x56FE;&#x4E66;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E94;&#x8BE5;&#x9075;&#x5FAA;&#x8FD9;&#x6837;&#x7684;&#x539F;&#x5219;&#xFF1A;<strong>&#x89C2;&#x5BDF;&#x4E00;&#x4E0B;&#x5F53;&#x524D;&#x7684; Docker &#x7248;&#x672C;&#x53F7;&#xFF0C;&#x9009;&#x62E9;&#x4E0D;&#x8981;&#x665A;&#x4E8E; 3 &#x4E2A;&#x7248;&#x672C;&#x7684; Docker &#x4E66;&#x7C4D;&#x3002;</strong> &#x6BD4;&#x5982;&#x5199;&#x8FD9;&#x6BB5;&#x6587;&#x5B57;&#x65F6;&#x4E3A; <code>17.06</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x8981;&#x8D2D;&#x4E70;&#x4ECB;&#x7ECD; Docker <code>1.12</code> &#x53CA;&#x5176;&#x4EE5;&#x524D;&#x7248;&#x672C;&#x7684;&#x4E66;&#x7C4D;&#x4E86;&#xFF0C;&#x5426;&#x5219;&#x770B;&#x5230;&#x7684;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x53EF;&#x80FD;&#x5C06;&#x4F1A;&#x56E0;&#x8FC7;&#x65F6;&#x800C;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x6216;&#x8005;&#x5DF2;&#x7ECF;&#x4E0D;&#x5FC5;&#x5982;&#x6B64;&#x7E41;&#x7410;&#x6709;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x5B9E;&#x73B0;&#x4E86;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;&#x5BF9;&#x4E8E; Docker &#x5B66;&#x4E60;&#x800C;&#x8A00;&#xFF0C;<strong>&#x6700;&#x597D;&#x7684;&#x4E66;&#x7C4D;&#x662F;&#x5B98;&#x7F51;&#x6587;&#x6863;</strong>&#xFF0C;&#x5B98;&#x7F51;&#x7684;&#x6587;&#x6863;&#x5F88;&#x4E30;&#x5BCC;&#x3002;</p><ul><li>&#x65B0;&#x624B;&#x6559;&#x7A0B;&#xFF1A;<ul><li>&#xFF08;&#x82F1;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">https://docs.docker.com/get-started/</a></li><li>&#xFF08;&#x4E2D;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker-cn.com/get-started/" target="_blank" rel="noopener">https://docs.docker-cn.com/get-started/</a></li><li>&#xFF08;&#x8001;&#x9EA6;&#x7684;&#x7FFB;&#x8BD1;&#xFF09;&#xFF1A;<a href="https://docs-cn.docker.octowhale.com/get_started/001.Orientation.html" target="_blank" rel="noopener">https://docs-cn.docker.octowhale.com/get_started/001.Orientation.html</a></li></ul></li><li>Docker &#x8BFE;&#x7A0B;&#xFF1A;<a href="http://training.play-with-docker.com/" target="_blank" rel="noopener">http://training.play-with-docker.com/</a><ul><li>&#x8FD0;&#x7EF4;&#x4EBA;&#x5458;&#x8BFE;&#x7A0B;&#xFF1A;<a href="http://training.play-with-docker.com/ops-landing/" target="_blank" rel="noopener">http://training.play-with-docker.com/ops-landing/</a></li><li>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8BFE;&#x7A0B;&#xFF1A;<a href="http://training.play-with-docker.com/dev-landing/" target="_blank" rel="noopener">http://training.play-with-docker.com/dev-landing/</a></li></ul></li><li>&#x5927;&#x91CF;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<ul><li>&#xFF08;&#x82F1;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker.com/samples/" target="_blank" rel="noopener">https://docs.docker.com/samples/</a></li><li>&#xFF08;&#x4E2D;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker-cn.com/samples/" target="_blank" rel="noopener">https://docs.docker-cn.com/samples/</a></li></ul></li><li>&#x7528;&#x6237;&#x6587;&#x6863;&#xFF1A;<ul><li>&#xFF08;&#x82F1;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/</a></li><li>&#xFF08;&#x4E2D;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker-cn.com/engine/userguide/" target="_blank" rel="noopener">https://docs.docker-cn.com/engine/userguide/</a></li><li>&#x955C;&#x50CF;&#xFF1A;<ul><li>(&#x82F1;&#x6587;&#xFF09;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></li><li>(&#x8001;&#x9EA6;&#x7684;&#x7FFB;&#x8BD1;)&#xFF1A;<a href="https://docs-cn.docker.octowhale.com/engine/userguide/eng-image/dockerfile_best-practices.html" target="_blank" rel="noopener">https://docs-cn.docker.octowhale.com/engine/userguide/eng-image/dockerfile_best-practices.html</a></li></ul></li><li>&#x5B58;&#x50A8;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/storagedriver/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/storagedriver/</a></li><li>&#x7F51;&#x7EDC;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/networking/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/</a></li></ul></li><li>&#x7BA1;&#x7406;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/admin/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/</a><ul><li>&#x5B58;&#x50A8;&#xFF1A;<a href="https://docs.docker.com/engine/admin/volumes/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/volumes/</a></li></ul></li><li>&#x5B89;&#x5168;&#xFF1A;<a href="https://docs.docker.com/engine/security/security/" target="_blank" rel="noopener">https://docs.docker.com/engine/security/security/</a></li><li>&#x96C6;&#x7FA4;&#xFF1A;<a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/</a></li></ul><blockquote><p>&#x90E8;&#x5206;&#x6587;&#x6863;&#x6709;&#x5BF9;&#x5E94;&#x5B98;&#x65B9;&#x7684;&#x4E2D;&#x6587;&#x7FFB;&#x8BD1;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE; <a href="https://docs.docker-cn.com" target="_blank" rel="noopener">https://docs.docker-cn.com</a> &#x67E5;&#x770B;&#x3002;&#x4F46;&#x662F;&#x4E00;&#x5B9A;&#x8981;<strong>&#x6CE8;&#x610F;&#x4EE3;&#x7801;&#x683C;&#x5F0F;</strong>&#xFF0C;&#x4E2D;&#x6587;&#x6587;&#x6863;&#x4E2D;<strong>&#x8BB8;&#x591A;&#x683C;&#x5F0F;&#x662F;&#x9519;&#x8BEF;&#x7684;</strong>&#xFF0C;&#x5E94;&#x8BE5;&#x5BF9;&#x6BD4;&#x82F1;&#x6587;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x6765;&#x770B;&#x3002;</p></blockquote><p>&#x5BF9;&#x4E8E;&#x65B0;&#x624B;&#x800C;&#x8A00;&#xFF0C;&#x5E94;&#x8BE5;&#x5148;&#x4ECE;&#x65B0;&#x624B;&#x6559;&#x7A0B;&#x5F00;&#x59CB;&#xFF0C;&#x5185;&#x5BB9;&#x8FD8;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x6613;&#x61C2;&#x7684;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x4E0A;&#x624B;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x7528;&#x6237;&#x6587;&#x6863;&#x597D;&#x597D;&#x770B;&#x4E00;&#x904D;&#xFF0C;&#x91CC;&#x9762;&#x628A;&#x5F88;&#x591A; Docker &#x7684;&#x57FA;&#x7840;&#x6982;&#x5FF5;&#x8BB2;&#x7684;&#x5F88;&#x6E05;&#x695A;&#x3002;&#x6982;&#x5FF5;&#x6E05;&#x6670;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x628A;&#x5B98;&#x7F51;&#x7ED9;&#x51FA;&#x7684;&#x4F8B;&#x5B50;&#x597D;&#x597D;&#x7684;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E9B;&#x4F8B;&#x5B50;&#x90FD;&#x662F;&#x5177;&#x4F53;&#x600E;&#x4E48;&#x5E94;&#x7528; Docker &#x7684;&#xFF0C;&#x6709;&#x6587;&#x5B57;&#x8BF4;&#x660E;&#x4EE5;&#x53CA;&#x5177;&#x4F53;&#x7684;&#x8003;&#x8651;&#xFF0C;&#x5F88;&#x9002;&#x5408;&#x5B66;&#x4E60;&#x3002;</p><h3 id="zong-shuo-kan-guan-fang-wen-dang-ke-shi-docker-guan-wang-wen-dang-jing-chang-bei-qiang-kan-bu-liao-zen-me-ban"><a href="#&#x603B;&#x8BF4;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x53EF;&#x662F;-Docker-&#x5B98;&#x7F51;&#x6587;&#x6863;&#x7ECF;&#x5E38;&#x88AB;&#x5899;&#xFF0C;&#x770B;&#x4E0D;&#x4E86;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x603B;&#x8BF4;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x53EF;&#x662F; Docker &#x5B98;&#x7F51;&#x6587;&#x6863;&#x7ECF;&#x5E38;&#x88AB;&#x5899;&#xFF0C;&#x770B;&#x4E0D;&#x4E86;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x603B;&#x8BF4;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x53EF;&#x662F; Docker &#x5B98;&#x7F51;&#x6587;&#x6863;&#x7ECF;&#x5E38;&#x88AB;&#x5899;&#xFF0C;&#x770B;&#x4E0D;&#x4E86;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#zong-shuo-kan-guan-fang-wen-dang-ke-shi-docker-guan-wang-wen-dang-jing-chang-bei-qiang-kan-bu-liao-zen-me-ban" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;<em>&#x611F;&#x8C22;</em>&#x4F1F;&#x5927;&#x7684;&#x5899;&#x53CA;&#x5176;&#x5148;&#x7956;&#x3002;</p><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x672C;&#x5730;&#x8FD0;&#x884C; Docker &#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x4EE5; docker &#x7684;&#x65B9;&#x5F0F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 80:4000 docs/docker.github.io</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x8BBF;&#x95EE; Docker &#x5BBF;&#x4E3B;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#xFF0C;&#x5982; <a href="http://localhost" target="_blank" rel="noopener">http://localhost</a>&#xFF0C;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x5B98;&#x7F51;&#x6587;&#x6863;&#x4E86;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x8BBF;&#x95EE;&#x4E0D;&#x4E86;&#x6211;&#x7684;&#x95EE;&#x7B54;&#x5F55;&#x7684;&#x7AE5;&#x978B;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x672C;&#x5730;&#x8FD0;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 80:80 twang2218/blog.lab99.org</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x672C;&#x5730; <code>80</code> &#x7AEF;&#x53E3;&#x770B;&#x5230;&#x6700;&#x65B0;&#x7684;&#x95EE;&#x7B54;&#x5F55;&#x4E86;&#x3002;</p><h3 id="docker-1-8-yi-hou-ban-ben-du-you-shi-me-gai-jin-me"><a href="#Docker-1-8-&#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F;" class="headerlink" title="Docker 1.8 &#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F;"></a>Docker 1.8 &#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F; <a href="#docker-1-8-yi-hou-ban-ben-du-you-shi-me-gai-jin-me" class="header-anchor">#</a></h3><p>&#x6BCF;&#x4E2A;&#x7248;&#x672C;&#x53D1;&#x5E03;&#x65F6;&#xFF0C;&#x5B98;&#x65B9;&#x535A;&#x5BA2; <a href="https://blog.docker.com" target="_blank" rel="noopener">https://blog.docker.com</a> &#x90FD;&#x4F1A;&#x6709;&#x4E13;&#x95E8;&#x6587;&#x7AE0;&#x63CF;&#x8FF0;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x6539;&#x8FDB;&#x3002;</p><ul><li><code>1.9</code>: <a href="https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/" target="_blank" rel="noopener">https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/</a></li><li><code>1.10</code>: <a href="https://blog.docker.com/2016/02/docker-1-10/" target="_blank" rel="noopener">https://blog.docker.com/2016/02/docker-1-10/</a></li><li><code>1.11</code>: <a href="https://blog.docker.com/2016/04/docker-engine-1-11-runc/" target="_blank" rel="noopener">https://blog.docker.com/2016/04/docker-engine-1-11-runc/</a></li><li><code>1.12</code>: <a href="https://blog.docker.com/2016/06/docker-1-12-built-in-orchestration/" target="_blank" rel="noopener">https://blog.docker.com/2016/06/docker-1-12-built-in-orchestration/</a></li></ul><p>&#x53E6;&#x5916;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x5B59;&#x5B8F;&#x4EAE;&#x7EF4;&#x62A4;&#x7684;<a href="https://github.com/allencloud/docker-changelog-chinese" target="_blank" rel="noopener">&#x300A;Docker &#x4E2D;&#x6587; Changelog&#x300B;</a>&#xFF1A;</p><ul><li><code>1.10</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.10.0-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.10.0-changelog.md</a></li><li><code>1.11</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.0-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.0-changelog.md</a></li><li><code>1.11.1</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.1-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.1-changelog.md</a></li><li><code>1.12</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.12.0-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.12.0-changelog.md</a></li></ul><p>&#x5173;&#x4E8E; <code>Docker 1.13</code> &#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x6211;&#x5199;&#x7684;<a href="/post/docker-2016-11-14-what-is-new-in-docker-1-13.html">&#x300A;Docker 1.13 &#x65B0;&#x589E;&#x529F;&#x80FD;&#x300B;</a>&#x3002;</p><h2 id="an-zhuang-pei-zhi-wen-ti-8"><a href="#&#x5B89;&#x88C5;&#x3001;&#x914D;&#x7F6E;&#x95EE;&#x9898;-8" class="headerlink" title="&#x5B89;&#x88C5;&#x3001;&#x914D;&#x7F6E;&#x95EE;&#x9898; (8)"></a>&#x5B89;&#x88C5;&#x3001;&#x914D;&#x7F6E;&#x95EE;&#x9898; <code>(8)</code> <a href="#an-zhuang-pei-zhi-wen-ti-8" class="header-anchor">#</a></h2><h3 id="docker-zen-me-zhe-me-duo-ruan-jian-wo-gai-zhuang-na-ge"><a href="#Docker-&#x600E;&#x4E48;&#x8FD9;&#x4E48;&#x591A;&#x8F6F;&#x4EF6;&#xFF0C;&#x6211;&#x8BE5;&#x88C5;&#x54EA;&#x4E2A;&#xFF1F;" class="headerlink" title="Docker &#x600E;&#x4E48;&#x8FD9;&#x4E48;&#x591A;&#x8F6F;&#x4EF6;&#xFF0C;&#x6211;&#x8BE5;&#x88C5;&#x54EA;&#x4E2A;&#xFF1F;"></a>Docker &#x600E;&#x4E48;&#x8FD9;&#x4E48;&#x591A;&#x8F6F;&#x4EF6;&#xFF0C;&#x6211;&#x8BE5;&#x88C5;&#x54EA;&#x4E2A;&#xFF1F; <a href="#docker-zen-me-zhe-me-duo-ruan-jian-wo-gai-zhuang-na-ge" class="header-anchor">#</a></h3><p>&#x597D;&#x5427;&#xFF0C;&#x6211;&#x51B3;&#x5B9A;&#x8981;&#x88C5; Docker &#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x6765;&#x6253;&#x5F00; <a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">Docker &#x5B89;&#x88C5;&#x6587;&#x6863;</a> (<a href="https://docs.docker-cn.com/engine/installation/" target="_blank" rel="noopener">&#x4E2D;&#x6587;</a> &#x770B;&#x770B;&#x600E;&#x4E48;&#x88C5;&#x5427;&#x2026;&#x2026;&#x5443;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x50BB;&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD9;&#x4E48;&#x591A;&#x79CD;&#x9009;&#x62E9;&#x554A;&#xFF1F;&#xFF01;</p><p>&#x9996;&#x5148;&#xFF0C;Docker &#x6709;&#x597D;&#x51E0;&#x4E2A;<em>&#x7248;&#x672C;</em>&#xFF0C;&#x793E;&#x533A;&#x7248;&#xFF08;Community Edition&#xFF09;&#x3001;&#x4F01;&#x4E1A;&#x57FA;&#x7840;&#x7248;&#xFF08;Enterprise Edition Basic&#xFF09;&#x3001;&#x4F01;&#x4E1A;&#x6807;&#x51C6;&#x7248;&#xFF08;Enterprise Edition Standard&#xFF09;&#x3001;&#x4F01;&#x4E1A;&#x9AD8;&#x7EA7;&#x7248;&#xFF08;Enterprise Edition Advanced&#xFF09;&#x3002;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x5B66;&#x4E60;&#x4F7F;&#x7528;&#x800C;&#x8A00;&#xFF0C;<em>&#x4F7F;&#x7528;&#x793E;&#x533A;&#x7248;&#x5C31;&#x5DF2;&#x8DB3;&#x591F;</em>&#xFF0C;&#x6240;&#x4EE5;&#x8BB0;&#x4F4F;<strong>CE</strong>&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p><p>&#x5176;&#x6B21;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x5806;<em>&#x5E73;&#x53F0;</em>&#x7279;&#x5B9A;&#x7684;&#x7248;&#x672C;&#xFF0C;Docker for Mac&#x3001;Docker for Windows&#x3001;Docker Toolbox&#x3001;Docker for Azure&#x3001;Docker for AWS &#x7B49;&#x7B49;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x5806;&#x4E0D;&#x540C; Linux &#x7684;&#x53D1;&#x884C;&#x7248;&#x3002;&#x90A3;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x7528;&#x54EA;&#x4E2A;&#xFF1F;&#x5176;&#x5B9E;&#x4E0D;&#x96BE;&#x9009;&#x62E9;&#xFF0C;&#x8FD9;&#x90FD;&#x662F;&#x5E73;&#x53F0;&#x7279;&#x5B9A;&#x7684;&#x4E1C;&#x897F;&#x561B;&#xFF0C;&#x9009;&#x62E9;&#x81EA;&#x5DF1;&#x5E73;&#x53F0;&#x5C31;&#x5B8C;&#x4E86;&#x1F602;&#xFF1A;</p><ul><li>macOS &#x5C31;&#x9009;&#x62E9; <a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">Docker for Mac</a>&#xFF1B;<ul><li>&#x963F;&#x91CC;&#x4E91;&#xFF08;&#x672A;&#x53CA;&#x65F6;&#x66F4;&#x65B0;&#xFF09;&#xFF1A;<a href="https://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/stable/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/stable/</a></li></ul></li><li>Linux &#x5C31;&#x9009;&#x62E9;&#x81EA;&#x5DF1;&#x5E73;&#x53F0;&#x7684; Docker &#x6E90;&#xFF1A;<ul><li>Ubuntu: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/</a></li><li>Debian: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/debian/</a></li><li>CentOS: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/centos/</a></li><li>Fedora: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/fedora/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/fedora/</a></li></ul></li><li>Windows &#x8981;&#x9EBB;&#x70E6;&#x4E9B;&#xFF1A;<ul><li>&#x5982;&#x679C;&#x662F; <em>Windows 10</em> <em>&#x4E13;&#x4E1A;&#x7248;&#x3001;&#x4F01;&#x4E1A;&#x7248;&#x3001;&#x6559;&#x80B2;&#x7248;</em>&#xFF0C;&#x5E76;&#x4E14;&#x7248;&#x672C;&#x5728; <code>10586</code> &#x4EE5;&#x540E;&#xFF0C;&#x5E76;&#x4E14;<em>&#x4E0D;&#x6253;&#x7B97;</em>&#x5728; Docker &#x8FD0;&#x884C;<em>&#x540C;&#x65F6;</em>&#x518D;&#x8FD0;&#x884C;&#x5176;&#x5B83;&#x865A;&#x62DF;&#x673A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x88C5; <a href="https://docs.docker.com/docker-for-windows/" target="_blank" rel="noopener">Docker for Windows</a>&#x3002;<ul><li>&#x963F;&#x91CC;&#x4E91;&#xFF08;&#x672A;&#x53CA;&#x65F6;&#x66F4;&#x65B0;&#xFF09;&#xFF1A;<a href="https://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/stable/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/stable/</a></li></ul></li><li><strong>&#x5176;&#x5B83;&#x60C5;&#x51B5;</strong>&#x90FD;&#x88C5; <a href="https://docs.docker.com/toolbox/overview/" target="_blank" rel="noopener">Docker Toolbox</a><ul><li>&#x963F;&#x91CC;&#x4E91;&#xFF1A;<a href="https://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</a></li></ul></li></ul></li><li>&#x5982;&#x679C;&#x662F;&#x7279;&#x5B9A;&#x4E91;&#x670D;&#x52A1;&#x5E73;&#x53F0;&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x7279;&#x5B9A;&#x670D;&#x52A1;&#x5E73;&#x53F0;&#x7684;&#x7248;&#x672C;&#xFF08;&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#xFF09;&#xFF1A;<ul><li>AWS&#xFF1A;<a href="https://docs.docker.com/docker-for-aws/" target="_blank" rel="noopener">Docker for AWS</a></li><li>Azure&#xFF1A;<a href="https://docs.docker.com/docker-for-azure/" target="_blank" rel="noopener">Docker for Azure</a></li></ul></li></ul><p>&#x6700;&#x540E;&#x662F;<em>&#x53D1;&#x5E03;&#x901A;&#x9053;</em>&#xFF0C;&#x4ECE;&#x4ECA;&#x5E74;&#x521D;&#x5F00;&#x59CB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4ECE; <code>1.13</code> &#x4EE5;&#x540E;&#xFF0C;Docker &#x4F7F;&#x7528;&#x4E86;&#x65B0;&#x7684;&#x7248;&#x672C;&#x53F7;&#x89C4;&#x5219;&#xFF0C;&#x5C06;&#x91C7;&#x7528;&#x7C7B;&#x4F3C; Ubuntu &#x90A3;&#x79CD; <code>&lt;&#x5E74;&gt;.&lt;&#x6708;&gt;</code> &#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982; <code>17.03</code>, <code>17.06</code> &#x7B49;&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5C06;&#x53D1;&#x5E03;&#x901A;&#x9053;&#x5206;&#x4E3A;<strong>&#x524D;&#x6CBF;&#x7248;&#x672C;(Edge)</strong>&#x548C;<strong>&#x7A33;&#x5B9A;&#x7248;&#x672C;(Stable)</strong>&#x3002;&#x524D;&#x6CBF;&#x901A;&#x9053;&#x5C06;&#x57FA;&#x672C;&#x6BCF;&#x4E2A;&#x6708;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x7A33;&#x5B9A;&#x901A;&#x9053;&#x5C06;&#x57FA;&#x672C;&#x6BCF;3&#x4E2A;&#x6708;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x3002;&#x8FD9;&#x6837; Docker &#x7684;&#x53D1;&#x5E03;&#x5C06;&#x6709;&#x89C4;&#x5F8B;&#x53EF;&#x5BFB;&#x3002;&#x5BF9;&#x4E8E;&#x559C;&#x6B22;&#x5C1D;&#x9C9C;&#x7684;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x524D;&#x6CBF;&#x7248;&#x672C;&#xFF0C;&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x7A33;&#x5B9A;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7A33;&#x5B9A;&#x7248;&#x672C;&#x3002;</p><blockquote><p>&#x8FD9;&#x91CC;&#x9762;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x53C2;&#x8003;<a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x5B89;&#x88C5;&#x6587;&#x6863;</a> (<a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">&#x4E2D;&#x6587;</a>)&#x914D;&#x7F6E; Linux &#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x56FD;&#x5185;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8981;&#x5C06;&#x5176;&#x4E2D;&#x7684; <code>https://download.docker.com/linux/</code> &#x66FF;&#x6362;&#x4E3A; <code>https://mirrors.aliyun.com/docker-ce/linux/</code>&#x3002;</p></blockquote><p>&#x6BD4;&#x5982;&#xFF0C;&#x6587;&#x6863;&#x5982;&#x679C;&#x8981;&#x6C42;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable&quot;</span></span><br></pre></td></tr></table></figure><p>&#x90A3;&#x4E48;&#x5C31;<strong>&#x66FF;&#x6362;</strong>&#x4E3A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable&quot;</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5B89;&#x88C5; Docker &#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x8F6F;&#x4EF6;&#x6E90;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x7FFB;&#x5899;&#x4E86;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x4E0D;&#x662F;&#x52A0;&#x901F;&#x5668;&#xFF0C;&#x4E0D;&#x8981;&#x641E;&#x9519;&#x4E86;&#xFF0C;&#x52A0;&#x901F;&#x5668;&#x4F9D;&#x65E7;&#x9700;&#x8981;&#x914D;&#xFF01;</em>&#xFF09;</p><h3 id="shi-zhi-jie-yong-yum-apt-get-an-zhuang-docker-ma"><a href="#&#x662F;&#x76F4;&#x63A5;&#x7528;-yum-apt-get-&#x5B89;&#x88C5;-Docker-&#x5417;&#xFF1F;" class="headerlink" title="&#x662F;&#x76F4;&#x63A5;&#x7528; yum / apt-get &#x5B89;&#x88C5; Docker &#x5417;&#xFF1F;"></a>&#x662F;&#x76F4;&#x63A5;&#x7528; <code>yum</code> / <code>apt-get</code> &#x5B89;&#x88C5; Docker &#x5417;&#xFF1F; <a href="#shi-zhi-jie-yong-yum-apt-get-an-zhuang-docker-ma" class="header-anchor">#</a></h3><p>&#x5F88;&#x591A;&#x4EBA;&#x95EE;&#x5230; <code>docker</code>, <code>docker.io</code>, <code>docker-engine</code> &#x751A;&#x81F3; <code>lxc-docker</code> &#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</p><p>&#x5176;&#x4E2D;&#xFF0C;RHEL/CentOS &#x8F6F;&#x4EF6;&#x6E90;&#x4E2D;&#x7684; Docker &#x5305;&#x540D;&#x4E3A; <code>docker</code>&#xFF1B;Ubuntu &#x8F6F;&#x4EF6;&#x6E90;&#x4E2D;&#x7684; Docker &#x5305;&#x540D;&#x4E3A; <code>docker.io</code>&#xFF1B;&#x800C;&#x5F88;&#x53E4;&#x8001;&#x7684; Docker &#x6E90;&#x4E2D; Docker &#x4E5F;&#x66FE;&#x53EB;&#x505A; <code>lxc-docker</code>&#x3002;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x8001;&#x65E7;&#x7684; Docker &#x7248;&#x672C;&#xFF0C;&#x5E76;&#x4E14;&#x57FA;&#x672C;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;&#x5230;&#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528; Docker &#x800C;&#x8A00;&#xFF0C;&#x4F7F;&#x7528;&#x6700;&#x65B0;&#x7248;&#x672C;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x53E6;&#x5916;&#xFF0C;17.04 &#x4EE5;&#x540E;&#xFF0C;&#x5305;&#x540D;&#x4ECE; <code>docker-engine</code> &#x6539;&#x4E3A; <code>docker-ce</code>&#xFF0C;&#x56E0;&#x6B64;&#x4ECE;&#x73B0;&#x5728;&#x5F00;&#x59CB;&#x5B89;&#x88C5;&#xFF0C;&#x5E94;&#x8BE5;&#x90FD;&#x4F7F;&#x7528; <code>docker-ce</code> &#x8FD9;&#x4E2A;&#x5305;&#x3002;</p><blockquote><p>&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684;&#x8F6F;&#x4EF6;&#x6E90;&#x4E2D;&#x7684; Docker &#x5305;&#xFF0C;&#x53BB;&#x4F7F;&#x7528; Docker &#x5B98;&#x65B9;&#x6E90;&#x7684;&#x5305;&#x3002;</p></blockquote><p>&#x6B63;&#x786E;&#x7684;&#x5B89;&#x88C5;&#x65B9;&#x6CD5;&#x6709;&#x4E24;&#x79CD;&#xFF1A;</p><ul><li>&#x4E00;&#x79CD;&#x662F;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x5B89;&#x88C5;&#x6587;&#x6863;&#x53BB;&#x914D;&#x7F6E; <a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">apt</a> &#x6216;&#x8005; <a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/centos/" target="_blank" rel="noopener">yum</a> &#x7684;&#x6E90;&#xFF1B;</li><li>&#x53E6;&#x4E00;&#x79CD;&#x5219;&#x662F;&#x4F7F;&#x7528;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x5FEB;&#x901F;&#x5B89;&#x88C5;&#x3002;</li></ul><p>&#x5B98;&#x65B9;&#x6587;&#x6863;&#x5BF9;&#x914D;&#x7F6E;&#x6E90;&#x7684;&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x6709;&#x5F88;&#x8BE6;&#x7EC6;&#x7684;&#x8BB2;&#x89E3;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8D58;&#x8FF0;&#xFF0C;&#x9700;&#x8981;&#x7684;&#x76F4;&#x63A5;&#x53BB;&#x770B;<a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x3002;&#x8FD9;&#x91CC;&#x53EA;&#x4ECB;&#x7ECD;&#x4F7F;&#x7528;&#x5B98;&#x65B9;&#x7684;&#x811A;&#x672C;&#x5FEB;&#x901F;&#x5B89;&#x88C5;&#xFF1A;</p><h4 id="17-04-ji-yi-hou-de-ban-ben"><a href="#17-04-&#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;" class="headerlink" title="17.04 &#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;"></a>17.04 &#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C; <a href="#17-04-ji-yi-hou-de-ban-ben" class="header-anchor">#</a></h4><p>&#x4ECE; <code>17.04</code> &#x4EE5;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5B89;&#x88C5;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CHANNEL=stable</span><br><span class="line">curl -fsSL https://get.docker.com/ | sh -s -- --mirror Aliyun</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5B98;&#x65B9;&#x811A;&#x672C;&#x5B89;&#x88C5;&#xFF0C;&#x901A;&#x8FC7;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6307;&#x5B9A;&#x5B89;&#x88C5;&#x901A;&#x9053;&#x4E3A; <code>stable</code>&#xFF0C;&#xFF08;&#x5982;&#x679C;&#x559C;&#x6B22;&#x5C1D;&#x9C9C;&#x53EF;&#x4EE5;&#x6539;&#x4E3A; <code>edge</code>, <code>test</code>&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x6E90;(apt/yum)&#x6765;&#x5B89;&#x88C5; Docker CE &#x7248;&#x672C;&#x3002;</p><h4 id="17-03-ji-yi-qian-de-ban-ben"><a href="#17-03-&#x53CA;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;" class="headerlink" title="17.03 &#x53CA;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;"></a>17.03 &#x53CA;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C; <a href="#17-03-ji-yi-qian-de-ban-ben" class="header-anchor">#</a></h4><p>&#x65E9;&#x671F;&#x7684;&#x7248;&#x672C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x963F;&#x91CC;&#x4E91;&#x6216;&#x8005; DaoCloud &#x8001;&#x7684;&#x811A;&#x672C;&#x5B89;&#x88C5;&#xFF1A;</p><p>&#x4F7F;&#x7528;<code>&#x963F;&#x91CC;&#x4E91;</code>&#x7684;&#x5B89;&#x88C5;&#x811A;&#x672C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure><p>&#x4F7F;&#x7528;<code>DaoCloud</code>&#x7684;Docker&#x5B89;&#x88C5;&#x811A;&#x672C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure><h3 id="bu-shi-du-yi-jing-fa-bu-docker-17-07-liao-me-wo-zen-me-sheng-ji-dao-zui-xin-huan-shi-17-05-ya"><a href="#&#x4E0D;&#x662F;&#x90FD;&#x5DF2;&#x7ECF;&#x53D1;&#x5E03;-Docker-17-07-&#x4E86;&#x4E48;&#xFF1F;&#x6211;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x8FD8;&#x662F;-17-05-&#x5440;&#xFF1F;" class="headerlink" title="&#x4E0D;&#x662F;&#x90FD;&#x5DF2;&#x7ECF;&#x53D1;&#x5E03; Docker 17.07 &#x4E86;&#x4E48;&#xFF1F;&#x6211;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x8FD8;&#x662F; 17.05 &#x5440;&#xFF1F;"></a>&#x4E0D;&#x662F;&#x90FD;&#x5DF2;&#x7ECF;&#x53D1;&#x5E03; Docker 17.07 &#x4E86;&#x4E48;&#xFF1F;&#x6211;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x8FD8;&#x662F; 17.05 &#x5440;&#xFF1F; <a href="#bu-shi-du-yi-jing-fa-bu-docker-17-07-liao-me-wo-zen-me-sheng-ji-dao-zui-xin-huan-shi-17-05-ya" class="header-anchor">#</a></h3><p>&#x4ECE; <strong>17.04</strong> &#x4EE5;&#x540E;&#xFF0C;Docker &#x7684;&#x6E90;&#x7684;&#x7ED3;&#x6784;&#x4EE5;&#x53CA;&#x5305;&#x540D;&#x90FD;&#x8FDB;&#x884C;&#x4E86;&#x8C03;&#x6574;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x4F60;&#x4F60;&#x8FD8;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x65E7;&#x7684;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x53C2;&#x7167;<a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#xFF0C;&#x66F4;&#x65B0;&#x6E90;&#x7684;&#x5730;&#x5740;&#x4E3A;&#x65B0;&#x7684;&#x6E90;&#x3002;&#x524D;&#x9762;&#x7684;&#x95EE;&#x7B54;&#x4E2D;&#x5DF2;&#x7ECF;&#x7ED9;&#x51FA;&#x4E86;&#x94FE;&#x63A5;&#x548C;&#x66FF;&#x4EE3;&#x7528;&#x7684;&#x963F;&#x91CC;&#x4E91;&#x6E90;&#x955C;&#x50CF;&#x5730;&#x5740;&#xFF0C;&#x53C2;&#x7167;&#x4FEE;&#x6539;&#xFF08;apt/yum&#xFF09;&#x6E90;&#x3002;</p><p>&#x4FEE;&#x6539;&#x597D;&#x540E;&#xFF0C;&#x5378;&#x8F7D;&#x65E7;&#x7684; <code>docker-engine</code>&#xFF0C;&#x5B89;&#x88C5;&#x65B0;&#x7684; <code>docker-ce</code> &#x5373;&#x53EF;&#x3002;</p><h3 id="docker-pull-hao-man-a-zen-me-ban"><a href="#docker-pull-&#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="docker pull &#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a><code>docker pull</code> &#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#docker-pull-hao-man-a-zen-me-ban" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#xFF0C;&#x8981;&#x201C;&#x611F;&#x8C22;&#x201D;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x53CA;&#x5176;&#x4EB2;&#x5C5E;&#x3002;</p><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Docker &#x955C;&#x50CF;&#x52A0;&#x901F;&#x5668;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x52A0;&#x901F;&#x5668;&#x5C31;&#x662F;&#x955C;&#x50CF;&#x3001;&#x4EE3;&#x7406;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x56FD;&#x5185;&#x6709;&#x4E0D;&#x5C11;&#x673A;&#x6784;&#x63D0;&#x4F9B;&#x4E86;&#x514D;&#x8D39;&#x7684;&#x52A0;&#x901F;&#x5668;&#x4EE5;&#x65B9;&#x4FBF;&#x5927;&#x5BB6;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x91CC;&#x5217;&#x51FA;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x52A0;&#x901F;&#x5668;&#x670D;&#x52A1;&#xFF1A;</p><ul><li><a href="https://www.docker-cn.com/registry-mirror" target="_blank" rel="noopener">Docker &#x5B98;&#x65B9;&#x7684;&#x4E2D;&#x56FD;&#x955C;&#x50CF;&#x52A0;&#x901F;&#x5668;</a>&#xFF1A;&#x4ECE;2017&#x5E74;6&#x6708;9&#x65E5;&#x8D77;&#xFF0C;<strong>Docker &#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x4E86;&#x5728;&#x4E2D;&#x56FD;&#x7684;&#x52A0;&#x901F;&#x5668;</strong>&#xFF0C;&#x4EE5;&#x89E3;&#x51B3;&#x5899;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4E0D;&#x7528;&#x6CE8;&#x518C;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#xFF1A;<code>https://registry.docker-cn.com</code> &#x5373;&#x53EF;&#x3002;</li><li><a href="http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker" target="_blank" rel="noopener">&#x4E2D;&#x56FD;&#x79D1;&#x6280;&#x5927;&#x5B66;&#x7684;&#x955C;&#x50CF;&#x52A0;&#x901F;&#x5668;</a>&#xFF1A;&#x4E2D;&#x79D1;&#x5927;&#x7684;&#x52A0;&#x901F;&#x5668;&#x4E0D;&#x7528;&#x6CE8;&#x518C;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5730;&#x5740; <code>https://docker.mirrors.ustc.edu.cn/</code> &#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#x5373;&#x53EF;&#x3002;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF1A;<a href="http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker</a></li><li><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">&#x963F;&#x91CC;&#x4E91;&#x52A0;&#x901F;&#x5668;</a>&#xFF1A;&#x6CE8;&#x518C;&#x963F;&#x91CC;&#x4E91;&#x5F00;&#x53D1;&#x8D26;&#x6237;(<em>&#x514D;&#x8D39;&#x7684;</em>)&#x540E;&#xFF0C;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#xFF1A; <a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a></li><li><a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">DaoCloud &#x52A0;&#x901F;&#x5668;</a>&#xFF1A;<a href="http://account.daocloud.io/signup" target="_blank" rel="noopener">&#x6CE8;&#x518C; <code>DaoCloud</code> &#x8D26;&#x6237;</a>(<em>&#x652F;&#x6301;&#x5FAE;&#x4FE1;&#x767B;&#x5F55;</em>)&#xFF0C;&#x7136;&#x540E;&#x8BBF;&#x95EE;&#xFF1A; <a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">https://www.daocloud.io/mirror#accelerator-doc</a></li></ul><blockquote><p>&#x6CE8;&#x610F;&#xFF1A;<strong>&#x4E0D;&#x8981;&#x4F7F;&#x7528;</strong>&#x52A0;&#x901F;&#x5668;&#x7F51;&#x7AD9;&#x6240;&#x7ED9;&#x7684;&#x914D;&#x7F6E;&#x811A;&#x672C;&#xFF0C;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x9519;&#x8BEF;&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x83B7;&#x53D6;&#x5176;&#x63D0;&#x4F9B;&#x7684;<strong>&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;</strong>&#x5373;&#x53EF;&#x3002;</p></blockquote><h4 id="ubuntu-14-04-pei-zhi-jia-su-qi-huo-qi-ta-shi-yong-upstart-de-xi-tong"><a href="#Ubuntu-14-04-&#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4F7F;&#x7528;-Upstart-&#x7684;&#x7CFB;&#x7EDF;&#xFF09;" class="headerlink" title="Ubuntu 14.04 &#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4F7F;&#x7528; Upstart &#x7684;&#x7CFB;&#x7EDF;&#xFF09;"></a>Ubuntu 14.04 &#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4F7F;&#x7528; Upstart &#x7684;&#x7CFB;&#x7EDF;&#xFF09; <a href="#ubuntu-14-04-pei-zhi-jia-su-qi-huo-qi-ta-shi-yong-upstart-de-xi-tong" class="header-anchor">#</a></h4><p><code>Ubuntu 14.04</code> &#x662F;&#x4F7F;&#x7528; <code>upstart</code> &#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x7C7B;&#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x901A;&#x8FC7;&#x7F16;&#x8F91;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#x3002;</p><p>&#x5982;&#x679C;&#x662F; <code>Ubuntu 14.04</code>&#xFF0C;&#x90A3;&#x4E48;&#x7F16;&#x8F91; <code>/etc/default/docker</code>&#xFF0C;&#x5728;&#x91CC;&#x9762;&#x5BFB;&#x627E; <code>DOCKER_OPTS</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x7684;&#x8FD9;&#x4E00;&#x884C;&#xFF0C;&#x5728;&#x5176;&#x540E;&#x6DFB;&#x52A0; <code>-&#x2013;registry-mirror=&lt;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&gt;</code>&#x3002;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x8BE5;&#x884C;&#x5DF2;&#x88AB;&#x6CE8;&#x91CA;&#xFF0C;&#x6216;&#x8005;&#x4E0D;&#x5B58;&#x5728;&#x8BE5;&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x6DFB;&#x4E00;&#x884C;&#x5373;&#x53EF;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x5B98;&#x65B9;&#x6E90;&#x5B89;&#x88C5;&#x4E86; <code>docker-engine</code> &#x540E;&#xFF0C;&#x4F1A;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684; <code>/etc/default/docker</code>&#xFF0C;&#x5176;&#x4E2D;&#x76F8;&#x5173; <code>DOCKER_OPTS</code> &#x7684;&#x884C;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use DOCKER_OPTS to modify the daemon startup options.</span></span><br><span class="line"><span class="comment">#DOCKER_OPTS=&quot;--dns 8.8.8.8 --dns 8.8.4.4&quot;</span></span><br></pre></td></tr></table></figure><p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7684;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#x4E3A; <code>https://registry.docker-cn.com</code>&#xFF0C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x5C06;&#x5176;&#x6539;&#x4E3A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use DOCKER_OPTS to modify the daemon startup options.</span></span><br><span class="line"><span class="comment">#DOCKER_OPTS=&quot;--dns 8.8.8.8 --dns 8.8.4.4&quot;</span></span><br><span class="line">DOCKER_OPTS=<span class="string">&quot;--registry-mirror=https://registry.docker-cn.com&quot;</span></span><br></pre></td></tr></table></figure><p>&#x4FDD;&#x5B58;&#x6587;&#x4EF6;&#x540E;&#xFF0C;&#x91CD;&#x542F; Docker &#x5F15;&#x64CE;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker restart</span><br><span class="line">docker stop/waiting</span><br><span class="line">docker start/running, process 3620</span><br></pre></td></tr></table></figure><p>&#x91CD;&#x542F;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x786E;&#x8BA4;&#x4E00;&#x4E0B;&#x914D;&#x7F6E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x751F;&#x6548;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ps -ef | grep dockerd</span><br><span class="line">root      3620     1  0 04:26 ?        00:00:00 /usr/bin/dockerd --registry-mirror=https://registry.docker-cn.com --raw-logs</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x914D;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x751F;&#x6548;&#x540E;&#x8FD9;&#x91CC;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x6240;&#x914D;&#x7F6E;&#x7684;&#x52A0;&#x901F;&#x5668;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><h4 id="ubuntu-16-04-huo-centos-7-pei-zhi-jia-su-qi-huo-qi-ta-shi-yong-systemd-de-xi-tong"><a href="#Ubuntu-16-04-&#x6216;-CentOS-7-&#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4F7F;&#x7528;-Systemd-&#x7684;&#x7CFB;&#x7EDF;&#xFF09;" class="headerlink" title="Ubuntu 16.04 &#x6216; CentOS 7 &#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4F7F;&#x7528; Systemd &#x7684;&#x7CFB;&#x7EDF;&#xFF09;"></a>Ubuntu 16.04 &#x6216; CentOS 7 &#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4F7F;&#x7528; Systemd &#x7684;&#x7CFB;&#x7EDF;&#xFF09; <a href="#ubuntu-16-04-huo-centos-7-pei-zhi-jia-su-qi-huo-qi-ta-shi-yong-systemd-de-xi-tong" class="header-anchor">#</a></h4><p><code>Ubuntu 16.04</code> &#x548C; <code>CentOS 7</code> &#x8FD9;&#x7C7B;&#x7CFB;&#x7EDF;&#x90FD;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x4F7F;&#x7528; <code>systemd</code> &#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;&#x7BA1;&#x7406;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528; <code>systemd</code> &#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E94;&#x8BE5;&#x901A;&#x8FC7;&#x7F16;&#x8F91;&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>docker.service</code> &#x6765;&#x8FDB;&#x884C;&#x52A0;&#x901F;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x3002;</p><p>&#x5728;&#x542F;&#x7528;&#x670D;&#x52A1;&#x540E;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7F16;&#x8F91; <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> &#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/systemd/system/multi-user.target.wants/docker.service</span><br></pre></td></tr></table></figure><p>&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230; <code>ExecStart=</code> &#x8FD9;&#x4E00;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x5176;&#x884C;&#x5C3E;&#x6DFB;&#x52A0;&#x4E0A;&#x6240;&#x9700;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7684;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#x4E3A; <code>https://registry.docker-cn.com</code>&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x914D;&#x7F6E;&#xFF1A;</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ExecStart</span>=/usr/bin/dockerd --registry-mirror=https://registry.docker-cn.com</span><br></pre></td></tr></table></figure><blockquote><p>&#x6CE8;: Docker 1.12 &#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;<code>dockerd</code> &#x5E94;&#x8BE5;&#x6362;&#x4E3A; <code>docker daemon</code>&#xFF0C;&#x66F4;&#x65E9;&#x7684;&#x7248;&#x672C;&#x5219;&#x662F; <code>docker -d</code>&#x3002;&#x4E0D;&#x8FC7;&#x8FD8;&#x5728;&#x7528;&#x90A3;&#x4E9B;&#x7248;&#x672C;&#x7684;&#x7AE5;&#x978B;&#xFF0C;&#x5347;&#x7EA7;&#x5427;&#x2026;&#x2026;&#x1F613;</p></blockquote><p>&#x4FDD;&#x5B58;&#x9000;&#x51FA;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;&#x670D;&#x52A1;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p>&#x786E;&#x8BA4;&#x4E00;&#x4E0B;&#x914D;&#x7F6E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x751F;&#x6548;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ps -ef | grep dockerd</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x914D;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x751F;&#x6548;&#x540E;&#x5C31;&#x4F1A;&#x5728;&#x8FD9;&#x91CC;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x6240;&#x914D;&#x7F6E;&#x7684;&#x52A0;&#x901F;&#x5668;&#x3002;</p><p>&#x5728; <code>1.13</code> &#x7248;&#x672C;&#x4EE5;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker info</code> &#x67E5;&#x770B;&#xFF0C;&#x5982;&#x679C;&#x914D;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x52A0;&#x901F;&#x5668; <code>Registry Mirror</code> &#x4F1A;&#x5728;&#x6700;&#x4E0B;&#x9762;&#x5217;&#x51FA;&#x6765;&#x3002;</p><p>&#x5982;&#x679C;&#x91CD;&#x542F;&#x540E;&#x53D1;&#x73B0;&#x65E0;&#x6CD5;&#x542F;&#x52A8; <code>docker</code> &#x670D;&#x52A1;&#xFF0C;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF0C;&#x770B;&#x770B;&#x662F;&#x4E0D;&#x662F;&#x4E4B;&#x524D;&#x6267;&#x884C;&#x8FC7;&#x90A3;&#x4E9B;&#x52A0;&#x901F;&#x5668;&#x7F51;&#x7AD9;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x505A;&#x8FC7;&#x7C7B;&#x4F3C;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x662F;&#x4E0D;&#x662F;&#x88AB;&#x5EFA;&#x7ACB;&#x4E86; <code>/etc/docker/daemon.json</code> &#x4EE5;&#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#xFF0C;&#x5220;&#x6389;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CD;&#x542F;&#x670D;&#x52A1;&#x3002;</p><p>&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x662F;&#x4EF6;&#x597D;&#x4E8B;&#xFF0C;&#x6BD4;&#x5982;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x4E0D;&#x5FC5;&#x91CD;&#x542F;&#x670D;&#x52A1;&#xFF0C;&#x53EA;&#x9700;&#x53D1;&#x9001; <code>SIGHUP</code> &#x4FE1;&#x53F7;&#x5373;&#x53EF;&#x3002;&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x76EE;&#x524D;&#x5728; <code>dockerd</code> &#x4E2D;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x65E0;&#x6CD5;&#x8F93;&#x51FA;&#x5F53;&#x524D;&#x751F;&#x6548;&#x914D;&#x7F6E;&#xFF0C;&#x5E76;&#x4E14;&#x5F53; <code>dockerd</code> &#x7684;&#x53C2;&#x6570;&#x548C; <code>daemon.json</code> &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x6709;&#x6240;&#x91CD;&#x590D;&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4F18;&#x5148;&#x7EA7;&#x8986;&#x76D6;&#x53E6;&#x4E00;&#x4E2A;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x5F15;&#x64CE;&#x542F;&#x52A8;&#x5931;&#x8D25;&#x3002;&#x5F88;&#x591A;&#x4EBA;&#x53D1;&#x73B0;&#x914D;&#x4E86;&#x52A0;&#x901F;&#x5668;&#x540E; Docker &#x542F;&#x52A8;&#x4E0D;&#x8D77;&#x6765;&#x4E86;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x539F;&#x56E0;&#x3002;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53BB;&#x6389;&#x91CD;&#x590D;&#x9879;&#x3002;&#x4E0D;&#x8FC7;&#x5728;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x524D;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x4FEE;&#x6539; <code>docker.service</code> &#x8FD9;&#x7C7B;&#x505A;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>daemon.json</code>&#x3002;&#x65B9;&#x4FBF; <code>ps -ef | grep dockerd</code> &#x4E00;&#x773C;&#x770B;&#x5230;&#x5B9E;&#x9645;&#x914D;&#x7F6E;&#x60C5;&#x51B5;&#x3002;</p><h3 id="zen-me-xiu-gai-liao-docker-fu-wu-pei-zhi-hou-bu-qi-zuo-yong"><a href="#&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86;-docker-&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86; docker &#x670D;&#x52A1;&#x914D;&#x7F6E;&#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;"></a>&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86; docker &#x670D;&#x52A1;&#x914D;&#x7F6E;&#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F; <a href="#zen-me-xiu-gai-liao-docker-fu-wu-pei-zhi-hou-bu-qi-zuo-yong" class="header-anchor">#</a></h3><p>&#x6539;&#x52A8;&#x771F;&#x7684;&#x751F;&#x6548;&#x4E86;&#x4E48;&#xFF1F;&#x5728;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E0B; <code>ps -ef | grep dockerd</code> &#x770B;&#x770B;&#xFF0C;&#x81EA;&#x5DF1;&#x505A;&#x7684;&#x90A3;&#x4E9B;&#x914D;&#x7F6E;&#x6709;&#x4E48;&#xFF1F;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x5C31;&#x8BF4;&#x660E;&#x6CA1;&#x6709;&#x751F;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8981;&#x68C0;&#x67E5;&#x539F;&#x56E0;&#x4E86;&#x3002;</p><p>&#x9996;&#x5148;&#xFF0C;&#x6539;&#x5B8C;&#x914D;&#x7F6E;&#x91CD;&#x542F;&#x670D;&#x52A1;&#x4E86;&#x4E48;&#xFF1F;&#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x770B;&#x7740;&#x5F88;&#x5C0F;&#x767D;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9E;&#x5F88;&#x591A;&#x4EBA;&#x72AF;&#x4E86;&#x8FD9;&#x4E2A;&#x5C0F;&#x767D;&#x7684;&#x9519;&#x8BEF;&#x3002;</p><ul><li><code>Ubuntu 14.04</code>: <code>sudo service docker restart</code></li><li><code>Ubuntu 16.04</code>, <code>CentOS 7</code>: <code>sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker</code></li></ul><p>&#x53E6;&#x5916;&#xFF0C;&#x4F60;&#x6539;&#x5BF9;&#x4E86;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E86;&#x4E48;&#xFF1F;</p><p>&#x4E0D;&#x5C11;&#x4EBA;&#x61D2;&#x5F97;&#x770B;&#x82F1;&#x6587;&#x6587;&#x6863;&#xFF0C;<em>&#x767E;&#x5EA6;</em>&#x4E2A;&#x6587;&#x7AE0;&#x5C31;&#x7167;&#x7740;&#x914D;&#xFF0C;&#x65E2;&#x4E0D;&#x7BA1;&#x767E;&#x5EA6;&#x5F97;&#x5230;&#x7684;&#x6587;&#x7AE0;&#x6240;&#x8BB2;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E5F;&#x6CA1;&#x6CE8;&#x610F;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x4E14;&#x4E2D;&#x6587;&#x6587;&#x7AE0;&#x5F80;&#x5F80;&#x81EA;&#x8EAB;&#x8868;&#x8FBE;&#x63CF;&#x8FF0;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x5F88;&#x591A;&#x60F3;&#x5F53;&#x7136;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x7ED3;&#x679C;&#x65E0;&#x6570;&#x5751;&#x3002;&#x8FD9;&#x4E48;&#x767E;&#x5EA6;&#x7684;&#x4EBA;&#xFF0C;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x538B;&#x6839;&#x5C31;&#x6539;&#x9519;&#x4E86;&#x6587;&#x4EF6;&#x3002;</p><blockquote><p>&#x73CD;&#x7231;&#x751F;&#x547D;&#xFF0C;&#x8FDC;&#x79BB;&#x767E;&#x5EA6;&#x3002;</p></blockquote><p>&#x6700;&#x8FD1;&#x4E24;&#x5E74;&#x5904;&#x4E8E; <code>upstart</code> &#x5230; <code>systemd</code> &#x7684;&#x8FC7;&#x6E21;&#x671F;&#xFF0C;&#x6240;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x65B9;&#x5F0F;<strong>&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;</strong>&#xFF0C;&#x8981;&#x770B;&#x770B;&#x81EA;&#x5DF1;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x4EE5;&#x53CA;&#x4EC0;&#x4E48;&#x7248;&#x672C;&#x3002;</p><p>&#x5BF9;&#x4E8E; <code>upstart</code> &#x7684;&#x7CFB;&#x7EDF;&#xFF08;<code>Ubuntu 14.10</code>&#x6216;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;<code>Debian 7</code>&#x6216;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF09;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x80FD;&#x5728; <code>/etc/default/docker</code>&#xFF0C;&#x5176;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#x57FA;&#x672C;&#x662F;&#x914D;&#x7F6E; <code>DOCKER_*</code> &#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3002;</p><p>&#x800C;&#x5BF9;&#x4E8E; <code>systemd</code> &#x7684;&#x7CFB;&#x7EDF;(<code>Ubuntu 15.04</code>&#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;<code>Debian 8</code>&#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;<code>CentOS 7</code>/<code>RHEL 7</code>&#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;)&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5219;&#x5728; <code>systemd</code> &#x7684;&#x914D;&#x7F6E;&#x76EE;&#x5F55;&#x4E0B;&#x3002;</p><p>&#x9996;&#x5148;&#x5E94;&#x8BE5; <code>enable</code> &#x8BE5;&#x670D;&#x52A1;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> &#xFF08;&#x53EA;&#x8981;&#x670D;&#x52A1; <code>enable</code> &#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x7BA1;&#x4EC0;&#x4E48;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E94;&#x8BE5;&#x90FD;&#x4F1A;&#x5728;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x770B;&#x5230;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF09;</p><blockquote><p>&#x8981;&#x6CE8;&#x610F; <code>upstart</code> &#x7684;&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x548C; <code>systemd</code> &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x662F;<strong>&#x4E0D;&#x540C;&#x7684;</strong>&#xFF0C;&#x4E0D;&#x8981;&#x62FF;&#x7740; <code>upstart</code> &#x7684;&#x914D;&#x7F6E;&#x884C;&#x76F4;&#x63A5;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x5230; <code>systemd</code> &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#xFF0C;&#x4E24;&#x7801;&#x4E8B;&#x513F;&#xFF0C;&#x8BF7;&#x5148;&#x5B66;&#x4E60;&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x3002;</p></blockquote><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<br><a href="https://docs.docker.com/engine/admin/configuring/#ubuntu" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/configuring/#ubuntu</a><br><a href="https://docs.docker.com/engine/admin/systemd/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/systemd/</a></p><h3 id="ru-guo-docker-sheng-ji-huo-zhe-chong-qi-de-hua-na-rong-qi-shi-bu-shi-du-hui-bei-ting-diao-ran-hou-chong-qi-a"><a href="#&#x5982;&#x679C;-Docker-&#x5347;&#x7EA7;&#x6216;&#x8005;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x4E0D;&#x662F;&#x90FD;&#x4F1A;&#x88AB;&#x505C;&#x6389;&#x7136;&#x540E;&#x91CD;&#x542F;&#x554A;&#xFF1F;" class="headerlink" title="&#x5982;&#x679C; Docker &#x5347;&#x7EA7;&#x6216;&#x8005;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x4E0D;&#x662F;&#x90FD;&#x4F1A;&#x88AB;&#x505C;&#x6389;&#x7136;&#x540E;&#x91CD;&#x542F;&#x554A;&#xFF1F;"></a>&#x5982;&#x679C; Docker &#x5347;&#x7EA7;&#x6216;&#x8005;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5BB9;&#x5668;&#x662F;&#x4E0D;&#x662F;&#x90FD;&#x4F1A;&#x88AB;&#x505C;&#x6389;&#x7136;&#x540E;&#x91CD;&#x542F;&#x554A;&#xFF1F; <a href="#ru-guo-docker-sheng-ji-huo-zhe-chong-qi-de-hua-na-rong-qi-shi-bu-shi-du-hui-bei-ting-diao-ran-hou-chong-qi-a" class="header-anchor">#</a></h3><p>&#x5728; <code>1.12</code> &#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#xFF0C;&#x4F46;&#x662F;&#x4ECE; <code>1.12</code> &#x5F00;&#x59CB;&#xFF0C;Docker &#x5F15;&#x64CE;&#x52A0;&#x5165;&#x4E86; <code>--live-restore</code> &#x53C2;&#x6570;&#xFF0C;&#x4F7F;&#x7528;&#x8BE5;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5F15;&#x64CE;&#x5347;&#x7EA7;&#x3001;&#x91CD;&#x542F;&#x5BFC;&#x81F4;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x670D;&#x52A1;&#x7684;&#x60C5;&#x51B5;&#x3002;</p><p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x8BE5;&#x529F;&#x80FD;&#x4E0D;&#x4F1A;&#x88AB;&#x542F;&#x52A8;&#xFF0C;&#x5982;&#x9700;&#x542F;&#x52A8;&#xFF0C;&#x9700;&#x8981;&#x914D;&#x7F6E; <code>docker</code> &#x670D;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x6BD4;&#x5982; <code>Ubuntu 16.04</code> &#x8FD9;&#x7C7B; <code>systemd</code> &#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539; <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> &#x6587;&#x4EF6;&#xFF0C;&#x5728; <code>ExecStart=</code> &#x540E;&#x9762;&#x914D;&#x7F6E;&#x4E0A; <code>--live-restore</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd \</span><br><span class="line">    --registry-mirror=https://registry.docker-cn.com \</span><br><span class="line">    --live-restore</span><br></pre></td></tr></table></figure><p>&#x4E0A;&#x9762;&#x7684;&#x683C;&#x5F0F;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x884C;&#x5C3E; <code>\</code> &#x7684;&#x6362;&#x884C;&#x5F62;&#x5F0F;&#xFF0C;&#x8FD9;&#x70B9;&#x548C; <code>bash</code> &#x811A;&#x672C;&#x4E00;&#x6837;&#xFF0C;<code>systemd</code> &#x652F;&#x6301;&#x8FD9;&#x79CD;&#x6362;&#x884C;&#x5F62;&#x5F0F;&#xFF0C;&#x5982;&#x5BF9;&#x6B64;&#x4E0D;&#x4E86;&#x89E3;&#x53EF;&#x4EE5;&#x5148;&#x53BB;&#x5B66;&#x4E60; <code>bash</code> &#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x3002;</p><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;<code>--live-restore</code> &#x548C; <code>Swarm Mode</code> &#x4E0D;&#x517C;&#x5BB9;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E5F;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x67D0;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x91CD;&#x542F;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x4E0A;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x4F1A;&#x88AB;&#x8C03;&#x5EA6;&#x5230;&#x522B;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x670D;&#x52A1;&#x5E76;&#x4E0D;&#x4F1A;&#x88AB;&#x4E2D;&#x65AD;&#x3002;</p><p>&#x53C2;&#x8003;&#x6587;&#x6863;&#xFF1A;</p><ul><li><a href="https://docs.docker.com/engine/admin/live-restore/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/live-restore/</a></li></ul><h3 id="wei-shi-me-zhi-xing-docker-ming-ling-hui-bao-permission-denied-mei-quan-xian-de-cuo-wu-a"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x6267;&#x884C;-docker-&#x547D;&#x4EE4;&#x4F1A;&#x62A5;-permission-denied-&#x6CA1;&#x6743;&#x9650;&#x7684;&#x9519;&#x8BEF;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x6267;&#x884C; docker &#x547D;&#x4EE4;&#x4F1A;&#x62A5; permission denied &#x6CA1;&#x6743;&#x9650;&#x7684;&#x9519;&#x8BEF;&#x554A;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x6267;&#x884C; docker &#x547D;&#x4EE4;&#x4F1A;&#x62A5; <code>permission denied</code> &#x6CA1;&#x6743;&#x9650;&#x7684;&#x9519;&#x8BEF;&#x554A;&#xFF1F; <a href="#wei-shi-me-zhi-xing-docker-ming-ling-hui-bao-permission-denied-mei-quan-xian-de-cuo-wu-a" class="header-anchor">#</a></h3><p>&#x5728; Linux &#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x4E00;&#x4E9B;&#x65B0;&#x88C5;&#x4E86; docker &#x7684;&#x7528;&#x6237;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x4F7F;&#x7528;&#x4E86; <code>sudo</code> &#x547D;&#x4EE4;&#x5B89;&#x88C5;&#x597D;&#x4E86; Docker &#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x5F53;&#x524D;&#x7528;&#x6237;&#x4E00;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x4F1A;&#x62A5;&#x6CA1;&#x6743;&#x9650;&#x7684;&#x9519;&#x8BEF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dial unix /var/run/docker.sock: permission denied</span><br></pre></td></tr></table></figure><p>&#x4E00;&#x4E9B;&#x6765;&#x81EA;&#x4E8E; Windows &#x4E16;&#x754C;&#x7684;&#x4EBA;&#xFF0C;&#x5C31;&#x4F1A;&#x8E66;&#x51FA;&#x6765;&#x8BF4;&#xFF0C;&#x7528; <code>root</code> &#x5440;&#x2026;&#x2026;&#x1F613;&#x3002;&#x800C;&#x53E6;&#x4E00;&#x4E9B;&#x6709;&#x57FA;&#x672C;&#x5E38;&#x8BC6;&#x3001;&#x77E5;&#x9053;&#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>root</code> &#x4EBA;&#x53EF;&#x80FD;&#x4F1A;&#x8BF4;&#xFF0C;&#x90A3;&#x5C31;&#x7528; <code>sudo docker</code> &#x5427;&#x3002;&#x8FD9;&#x4E24;&#x8005;&#x90FD;&#x662F;&#x4E0D;&#x5BF9;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x4E0D;&#x5408;&#x9002;&#x7684;&#x3002;</p><p>&#x8BF4;&#x4F7F;&#x7528; <code>root</code> &#x7684;&#x4EBA;&#xFF0C;&#x5E94;&#x8BE5;&#x56DE;&#x53BB;&#x597D;&#x597D;&#x5B66;&#x4E60;&#x4E00;&#x4E0B; Linux &#x6743;&#x9650;&#x5E38;&#x8BC6;&#x3002;&#x4E00;&#x822C; <strong>&#x4E0D;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>root</code> &#x7528;&#x6237;</strong>&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>root</code> &#x7528;&#x6237;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E25;&#x91CD;&#x7684;&#x8FDD;&#x53CD;&#x4E86;&#x5B89;&#x5168;&#x89C4;&#x8303;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x6781;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x64CD;&#x4F5C;&#x4E8B;&#x6545;&#x3002;&#x8FD9;&#x4E0D;&#x662F; Windows &#x4E16;&#x754C;&#xFF0C;Linux/Unix &#x4E16;&#x754C;&#x662F;&#x6709;&#x4E25;&#x683C;&#x7684;&#x6743;&#x9650;&#x8981;&#x6C42;&#x7684;&#xFF0C;&#x53EA;&#x5E94;&#x8BE5;<strong>&#x4F7F;&#x7528;&#x6700;&#x5C0F;&#x7684;&#x6743;&#x9650;&#x505A;&#x4E8B;&#x60C5;</strong>&#x3002;&#x5982;&#x679C;&#x8FD8;&#x4E0D;&#x719F;&#x6089; Linux &#x6743;&#x9650;&#x673A;&#x5236;&#xFF0C;&#x90A3;&#x5C31;&#x53BB;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#xFF0C;&#x4E0D;&#x8981;&#x628A; Windows &#x7684;&#x574F;&#x6BDB;&#x75C5;&#x5E26;&#x8FC7;&#x6765;&#x3002;</p><p>&#x8BF4;&#x4F7F;&#x7528; <code>sudo docker</code> &#x7684;&#x4EBA;&#xFF0C;&#x601D;&#x8DEF;&#x662F;&#x5BF9;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x7406;&#x89E3;&#x4E86;&#x5E73;&#x65F6;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x666E;&#x901A;&#x7528;&#x6237;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624D; <code>sudo</code> &#x63D0;&#x5347;&#x6743;&#x9650;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x4F46;&#x662F;&#x95EE;&#x9898;&#x5C31;&#x5728;&#x8FD9;&#x4E2A;<strong>&#x9700;&#x8981;</strong>&#x4E8C;&#x5B57;&#x4E0A;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;<strong>&#x4E0D;&#x9700;&#x8981; <code>root</code> &#x6743;&#x9650;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;</strong>&#x3002;</p><p>&#x5176;&#x5B9E;&#x5982;&#x679C;&#x770B;&#x8FC7;<a href="https://docs.docker.com/engine/installation/linux/linux-postinstall/#manage-docker-as-a-non-root-user" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x5B89;&#x88C5;&#x6587;&#x6863;</a>&#x7684;&#x8BDD;&#x90FD;&#x4F1A;&#x77E5;&#x9053;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x64CD;&#x4F5C; <code>docker</code> &#x7684;&#x7528;&#x6237;&#xFF0C;&#x52A0;&#x5165; <code>docker</code> &#x7EC4;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x7528;&#x6237;&#x65E2;&#x62E5;&#x6709;&#x4E86;&#x64CD;&#x4F5C; <code>docker</code> &#x7684;&#x6743;&#x9650;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><p>&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x5F53;&#x524D;&#x7528;&#x6237;&#x52A0;&#x5165; <code>docker</code> &#x7EC4;&#xFF0C;<strong>&#x9000;&#x51FA;&#x3001;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x7CFB;&#x7EDF;&#x540E;</strong>&#xFF0C;&#x6267;&#x884C; <code>docker info</code> &#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x53EF;&#x4EE5;&#x4E0D;&#x7528; <code>sudo</code> &#x76F4;&#x63A5;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;&#x4E86;&#x3002;</p><p>&#x5982;&#x679C;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x522B;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x7684; <code>$USER</code> &#x6362;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x7528;&#x6237;&#x540D;&#x5373;&#x53EF;&#x3002;</p><p>&#x5C06;&#x7528;&#x6237;&#x6DFB;&#x52A0;&#x5230; <code>docker</code> &#x7EC4;&#xFF0C;&#x53EF;&#x4EE5;&#x907F;&#x514D; <code>root</code> &#x6743;&#x9650;&#x8BEF;&#x64CD;&#x4F5C;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E; <code>dockerd</code> &#x5F15;&#x64CE;&#x662F;&#x8FD0;&#x884C;&#x5728; <code>root</code> &#x7528;&#x6237;&#x4E0B;&#x7684;&#xFF0C;&#x800C; <code>docker</code> &#x7EC4;&#x6210;&#x5458;&#x6709;&#x6743;&#x9650;&#x6307;&#x6325; <code>dockerd</code> &#x5F15;&#x64CE;&#x6765;&#x505A;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8BE5;&#x7528;&#x6237;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x62E5;&#x6709;&#x4E86; <code>root</code> &#x7684;&#x6743;&#x9650;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x4E0D;&#x8981;&#x8BEF;&#x89E3;&#x4E86;&#x5C06;&#x5F53;&#x524D;&#x7528;&#x6237;&#x52A0;&#x5165; <code>docker</code> &#x7EC4;&#x7684;&#x521D;&#x8877;&#xFF0C;&#x8FD9;&#x548C;&#x8D4B;&#x4E88;&#x7528;&#x6237; <code>sudo</code> &#x6743;&#x529B;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x53EF;&#x4E0D;&#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x5C31;&#x6CA1;&#x6709; <code>root</code> &#x6743;&#x9650;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x53EA;&#x662F;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>sudo</code> &#x4E86;&#xFF0C;&#x4E5F;&#x964D;&#x4F4E;&#x4E86;&#x4F7F;&#x7528; <code>sudo</code> &#x65F6;&#x8BEF;&#x64CD;&#x4F5C;&#x7684;&#x53EF;&#x80FD;&#x3002;</p><p>&#x6B64;&#x5916;&#xFF0C;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x6743;&#x9650;&#x95EE;&#x9898;&#xFF0C;&#x5168;&#x662F;&#x6307;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;&#x64CD;&#x4F5C;<strong>&#x672C;&#x673A;</strong> <code>dockerd</code> &#x5F15;&#x64CE;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x8FC7; <code>/var/run/docker.sock</code> &#x6765;&#x64CD;&#x4F5C; <code>dockerd</code> &#x5F15;&#x64CE;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x53EA;&#x6709;&#x8FD9;&#x79CD;&#x6709;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x6743;&#x9650;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x800C; <code>docker</code> &#x547D;&#x4EE4;&#x8FD8;&#x53EF;&#x4EE5;&#x64CD;&#x4F5C;<strong>&#x8FDC;&#x7A0B;</strong> <code>dockerd</code> &#x7684;&#x5F15;&#x64CE;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>-H</code> &#x53C2;&#x6570;&#xFF0C;&#x6216;&#x8005; <code>DOCKER_HOST</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6240;&#x6307;&#x5B9A;&#x7684; Docker &#x4E3B;&#x673A;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x901A;&#x8BAF;&#x8D70;&#x7684;&#x662F;&#x7F51;&#x7EDC;&#x3001;HTTP&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x6743;&#x9650;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6253;&#x7B97;&#x64CD;&#x4F5C;&#x672C;&#x673A;&#x7684; <code>dockerd</code> &#x5F15;&#x64CE;&#xFF0C;&#x5219;&#x4E0D;&#x9700;&#x8981;&#x5C06;&#x7528;&#x6237;&#x52A0;&#x5165; <code>docker</code> &#x7EC4;&#xFF0C;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x64CD;&#x4F5C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x5668;&#x7684;&#x3002;</p><h3 id="fu-wu-qi-shang-xian-hou-zen-me-fa-xian-zong-you-ge-xmrig-de-rong-qi-zai-pao-shan-liao-huan-chu-lai-zhe-shi-shi-me-gui"><a href="#&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x600E;&#x4E48;&#x53D1;&#x73B0;&#x603B;&#x6709;&#x4E2A;-xmrig-&#x7684;&#x5BB9;&#x5668;&#x5728;&#x8DD1;&#xFF0C;&#x5220;&#x4E86;&#x8FD8;&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;" class="headerlink" title="&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x600E;&#x4E48;&#x53D1;&#x73B0;&#x603B;&#x6709;&#x4E2A; xmrig &#x7684;&#x5BB9;&#x5668;&#x5728;&#x8DD1;&#xFF0C;&#x5220;&#x4E86;&#x8FD8;&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;"></a>&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x600E;&#x4E48;&#x53D1;&#x73B0;&#x603B;&#x6709;&#x4E2A; <code>xmrig</code> &#x7684;&#x5BB9;&#x5668;&#x5728;&#x8DD1;&#xFF0C;&#x5220;&#x4E86;&#x8FD8;&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F; <a href="#fu-wu-qi-shang-xian-hou-zen-me-fa-xian-zong-you-ge-xmrig-de-rong-qi-zai-pao-shan-liao-huan-chu-lai-zhe-shi-shi-me-gui" class="header-anchor">#</a></h3><blockquote><p><strong>&#x8B66;&#x544A;&#xFF01;&#xFF01;</strong>&#x4F60;&#x7684;&#x670D;&#x52A1;&#x5668;&#x5DF2;&#x7ECF;<strong>&#x88AB;&#x5165;&#x4FB5;&#x4E86;</strong>&#xFF01;&#xFF01;</p></blockquote><p>&#x6709;&#x4E9B;&#x4EBA;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x7A81;&#x7136;&#x591A;&#x4E86;&#x4E00;&#x4E9B;&#x83AB;&#x540D;&#x5947;&#x5999;&#x7684;&#x5BB9;&#x5668;&#x5728;&#x8DD1;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">IMAGE           COMMAND                  CREATED      STATUS                      PORTS    NAMES</span><br><span class="line">linuxrun/cpu2   <span class="string">&quot;./xmrig --algo=cr....&quot;</span>  4 hours ago  Exited (137) 7 minutes ago           linuxrun-cpu2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x5C31;&#x662F;&#x6709;&#x4EBA;&#x5728;&#x4F60;&#x7684; Docker &#x5BBF;&#x4E3B;&#x4E0A;&#x8DD1;&#x4E86;&#x4E00;&#x4E2A; <code>xmrig</code> &#x6316;&#x77FF;&#x7684;&#x8815;&#x866B;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x7684;&#x7CFB;&#x7EDF;<strong>&#x88AB;&#x5165;&#x4FB5;&#x4E86;</strong>&#x2026;&#x2026;&#x1F613;&#x3002;</p><p>&#x5728;&#x4F60;&#x5927;&#x53EB; Docker &#x4E0D;&#x5B89;&#x5168;&#x4E4B;&#x524D;&#xFF0C;<em>&#x5148;&#x68C0;&#x8BA8;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;</em>&#x662F;&#x4E0D;&#x662F;&#x505A;&#x9519;&#x4E86;&#x3002;&#x68C0;&#x67E5;&#x4E00;&#x4E0B; <code>dockerd</code> &#x5F15;&#x64CE;&#x662F;&#x5426;&#x914D;&#x7F6E;&#x9519;&#x8BEF;&#xFF1A;<code>ps -ef | grep dockerd</code>&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x770B;&#x5230;&#x7684;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep dockerd</span><br><span class="line">123  root   12:34   /usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x5728;&#x5176;&#x4E2D;&#x6CA1;&#x6709; <code>--tlsverify</code> &#x7C7B;&#x7684; TLS &#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x4F60;&#x5C06;&#x4F60;&#x7684;&#x7CFB;&#x7EDF;&#x5927;&#x95E8;&#x5F7B;&#x5E95;&#x655E;&#x5F00;&#x4E86;&#x3002;&#x8FD9;&#x662F;&#x914D;&#x7F6E;&#x4E0A;<strong>&#x4E25;&#x91CD;&#x7684;&#x5B89;&#x5168;&#x4E8B;&#x6545;</strong>&#x3002;</p><p><code>-H tcp://0.0.0.0:2375</code> &#x662F;&#x8BF4;&#x4F60;&#x5E0C;&#x671B;&#x901A;&#x8FC7; <code>2375/tcp</code> &#x6765;&#x64CD;&#x63A7;&#x4F60;&#x7684; Docker &#x5F15;&#x64CE;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x52A0; <code>--tlsverify</code> &#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x8868;&#x660E;&#x4F60;&#x7684;&#x610F;&#x56FE;&#x662F;<strong>&#x5141;&#x8BB8;&#x4EFB;&#x4F55;&#x4EBA;</strong>&#x6765;&#x64CD;&#x63A7;&#x4F60;&#x7684; Docker &#x5F15;&#x64CE;&#xFF0C;&#x800C; Docker &#x5F15;&#x64CE;&#x662F;&#x4EE5; <code>root</code> &#x6743;&#x9650;&#x5141;&#x8BB8;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4F60;&#x7B49;&#x4E8E;&#x7ED9;&#x4E86;<strong>&#x5730;&#x7403;&#x4E0A;&#x6240;&#x6709;&#x4EBA;</strong>&#x4F60;&#x670D;&#x52A1;&#x5668;&#x7684; <code>root</code> &#x6743;&#x9650;&#xFF0C;&#x800C;&#x4E14;<strong>&#x8FD8;&#x6CA1;&#x5BC6;&#x7801;</strong>&#x3002;</p><p>&#x5982;&#x679C;&#x7EC6;&#x5FC3;&#x4E00;&#x4E9B;&#xFF0C;&#x53BB;&#x67E5;&#x770B; <code>dockerd</code> &#x7684;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF0C;<code>journalctl -u docker</code>&#xFF0C;&#x65E5;&#x5FD7;&#x4E2D;&#x6709;&#x660E;&#x786E;&#x7684;&#x8B66;&#x544A;&#xFF0C;&#x8B66;&#x544A;&#x4F60;&#x8FD9;&#x4E48;&#x914D;&#x7F6E;&#x662F;&#x6781;&#x7AEF;&#x5371;&#x9669;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ journalctl -u docker</span><br><span class="line">...</span><br><span class="line">level=warning msg=<span class="string">&quot;[!] DON&apos;T BIND ON ANY IP ADDRESS WITHOUT setting --tlsverify IF YOU DON&apos;T KNOW WHAT YOU&apos;RE DOING [!]&quot;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x4F60;&#x90FD;&#x5FFD;&#x7565;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x88AB;&#x522B;&#x4EBA;&#x5165;&#x4FB5;&#x5C31;&#x592A;&#x6B63;&#x5E38;&#x4E86;&#xFF0C;&#x662F;&#x4F60;&#x81EA;&#x5DF1;<em>&#x9080;&#x8BF7;</em>&#x522B;&#x4EBA;&#x6765;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;Docker &#x670D;&#x52A1;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;<em>&#x5FC5;&#x987B;</em>&#x901A;&#x8FC7; TLS &#x4FDD;&#x62A4;&#x8D77;&#x6765;&#xFF0C;&#x4EE5;&#x540E;&#x89C1;&#x5230; <code>-H tcp://....</code> &#x5C31;&#x8981;&#x68C0;&#x67E5;&#xFF0C;&#x662F;&#x5426;&#x540C;&#x65F6;&#x914D;&#x7F6E;&#x4E86; <code>--tlsverify</code>&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x770B;&#x5230;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x4E25;&#x91CD;&#x9519;&#x8BEF;&#x4E86;&#x3002;</p><p>&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>docker-machine</code> &#x8FDB;&#x884C; Docker &#x5BBF;&#x4E3B;&#x7BA1;&#x7406;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x56E0;&#x4E3A; <code>docker-machine</code> &#x4F1A;&#x5E2E;&#x4F60;&#x521B;&#x5EFA;&#x8BC1;&#x4E66;&#x3001;&#x914D;&#x7F6E; TLS&#xFF0C;&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5B89;&#x5168;&#x3002;</p><p>&#x8FDB;&#x4E00;&#x6B65;&#x5982;&#x4F55;&#x914D;&#x7F6E; TLS &#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/security/https/" target="_blank" rel="noopener">https://docs.docker.com/engine/security/https/</a><br>&#x5173;&#x4E8E; <code>docker-machine</code> &#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/machine/overview/" target="_blank" rel="noopener">https://docs.docker.com/machine/overview/</a></p><h2 id="wang-luo-wen-ti-13"><a href="#&#x7F51;&#x7EDC;&#x95EE;&#x9898;-13" class="headerlink" title="&#x7F51;&#x7EDC;&#x95EE;&#x9898; (13)"></a>&#x7F51;&#x7EDC;&#x95EE;&#x9898; <code>(13)</code> <a href="#wang-luo-wen-ti-13" class="header-anchor">#</a></h2><h3 id="zen-me-gu-ding-rong-qi-ip-di-zhi-mei-ci-chong-qi-rong-qi-du-yao-bian-hua-ip-di-zhi-zen-me-ban"><a href="#&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668;-IP-&#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316;-IP-&#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316; IP &#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316; IP &#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#zen-me-gu-ding-rong-qi-ip-di-zhi-mei-ci-chong-qi-rong-qi-du-yao-bian-hua-ip-di-zhi-zen-me-ban" class="header-anchor">#</a></h3><p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#x7684;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#xFF0C;&#x800C;&#x662F;&#x5BB9;&#x5668;&#x3002;&#x5176;&#x5730;&#x5740;&#x662F;&#x4F9B;&#x5BB9;&#x5668;&#x95F4;&#x901A;&#x8BAF;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x95F4;&#x5219;&#x4E0D;&#x7528; IP &#x76F4;&#x63A5;&#x901A;&#x8BAF;&#xFF0C;&#x800C;&#x4F7F;&#x7528;<code>&#x5BB9;&#x5668;&#x540D;</code>&#x3001;<code>&#x670D;&#x52A1;&#x540D;</code>&#x3001;<code>&#x7F51;&#x7EDC;&#x522B;&#x540D;</code>&#x3002;</p><p>&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;<code>docker run</code> &#x5728;&#x4E0D;&#x6307;&#x5B9A; <code>--network</code> &#x65F6;&#xFF0C;&#x6240;&#x5728;&#x7684;&#x7F51;&#x7EDC;&#x662F; <code>default bridge</code>&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>--link</code> &#x53C2;&#x6570;&#x624D;&#x53EF;&#x4EE5;&#x8BA9;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x627E;&#x5230;&#x5BF9;&#x65B9;&#x3002;</p><p>&#x8FD9;&#x662F;&#x6709;&#x5C40;&#x9650;&#x6027;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>/etc/hosts</code> &#x9759;&#x6001;&#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x6302;&#x4E86;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x542F;&#x52A8;IP&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x867D;&#x7136;&#x8BF4;&#x8FD9;&#x79CD;&#x6539;&#x53D8;Docker&#x662F;&#x53EF;&#x80FD;&#x66F4;&#x65B0;<code>/etc/hosts</code>&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6709;&#x8BF8;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x4E3A;&#x7ADE;&#x4E89;&#x5192;&#x9669;&#x5BFC;&#x81F4; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x635F;&#x6BC1;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8FD8;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x5728;&#x53D6;&#x5F97; <code>/etc/hosts</code> &#x7684;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x4E0D;&#x518D;&#x53BB;&#x76D1;&#x89C6;&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x53D8;&#x52A8;&#x3002;&#x79CD;&#x79CD;&#x539F;&#x56E0;&#x90FD;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x65E7;&#x7684;&#x4E3B;&#x673A;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x540D;&#x8BBF;&#x95EE;&#x5230;&#x65B0;&#x7684;&#x4E3B;&#x673A;&#x3002;</p><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/</a></p><p>&#x5982;&#x679C;&#x53EF;&#x80FD;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x8FC7;&#x65F6;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x7528;&#x4E0B;&#x9762;&#x8BF4;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p><p>&#x800C;&#x5BF9;&#x4E8E;&#x65B0;&#x7684;&#x73AF;&#x5883;&#xFF08;Docker 1.10&#x4EE5;&#x4E0A;&#xFF09;&#xFF0C;&#x5E94;&#x8BE5;&#x7ED9;&#x5BB9;&#x5668;&#x5EFA;&#x7ACB;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5BF9;&#x65B9;&#x5BB9;&#x5668;&#x7684;&#x5BB9;&#x5668;&#x540D;&#x3001;&#x670D;&#x52A1;&#x540D;&#x3001;&#x7F51;&#x7EDC;&#x522B;&#x540D;&#x6765;&#x627E;&#x5230;&#x5BF9;&#x65B9;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5E2E;&#x52A9;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x662F;Docker &#x5185;&#x7F6E;&#x7684;DNS&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x65E0;&#x8BBA;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x91CD;&#x542F;&#x3001;&#x66F4;&#x6362;IP&#xFF0C;&#x5185;&#x7F6E;&#x7684;DNS&#x90FD;&#x80FD;&#x6B63;&#x786E;&#x6307;&#x5B9A;&#x5230;&#x5BF9;&#x65B9;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks</a></p><p>&#x5EFA;&#x8BAE;&#x53C2;&#x8003;&#x4E00;&#x4E0B;&#x6211;&#x5199;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#xFF1A;<br><a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p><h3 id="ru-he-xiu-gai-rong-qi-de-etc-hosts-wen-jian"><a href="#&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684;-etc-hosts-&#x6587;&#x4EF6;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684; /etc/hosts &#x6587;&#x4EF6;&#xFF1F;"></a>&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#xFF1F; <a href="#ru-he-xiu-gai-rong-qi-de-etc-hosts-wen-jian" class="header-anchor">#</a></h3><p>&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x968F;&#x610F;&#x4FEE;&#x6539;&#xFF0C;&#x5982;&#x679C;&#x5FC5;&#x987B;&#x6DFB;&#x52A0;&#x4E3B;&#x673A;&#x540D;&#x548C; IP &#x5730;&#x5740;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF0C;&#x5E94;&#x8BE5;&#x5728; <code>docker run</code> &#x65F6;&#x4F7F;&#x7528; <code>--add-host</code> &#x53C2;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x5728; <code>docker-compose.yml</code> &#x4E2D;&#x6DFB;&#x52A0; <code>extra_hosts</code> &#x9879;&#x3002;</p><p>&#x4E0D;&#x8FC7;&#x5728;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x5E94;&#x8BE5;&#x518D;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x771F;&#x7684;&#x9700;&#x8981;&#x4FEE;&#x6539; <code>/etc/hosts</code> &#x4E48;&#xFF1F;&#x5982;&#x679C;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5BB9;&#x5668;&#x95F4;&#x4E92;&#x76F8;&#x8BBF;&#x95EE;&#xFF0C;&#x5E94;&#x8BE5;&#x5EFA;&#x7ACB;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; Docker &#x5185;&#x7F6E;&#x7684; DNS &#x670D;&#x52A1;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E00;&#x4E0B;&#x6211;&#x5199;&#x7684;&#x8FD9;&#x4E2A; LNMP &#x591A;&#x5BB9;&#x5668;&#x4E92;&#x8FDE;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p><h3 id="zen-me-ying-she-su-zhu-duan-kou-dockerfile-zhong-de-expose-he-docker-run-p-you-sha-qu-bie"><a href="#&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;Dockerfile-&#x4E2D;&#x7684;EXPOSE&#x548C;-docker-run-p-&#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;Dockerfile &#x4E2D;&#x7684;EXPOSE&#x548C; docker run -p &#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F;"></a>&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;<code>Dockerfile</code> &#x4E2D;&#x7684;<code>EXPOSE</code>&#x548C; <code>docker run -p</code> &#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F; <a href="#zen-me-ying-she-su-zhu-duan-kou-dockerfile-zhong-de-expose-he-docker-run-p-you-sha-qu-bie" class="header-anchor">#</a></h3><p>Docker&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>EXPOSE</code> &#xFF0C;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>PUBLISH</code> &#x3002;</p><ul><li><code>EXPOSE</code> &#x662F;&#x955C;&#x50CF;/&#x5BB9;&#x5668;&#x58F0;&#x660E;&#x8981;&#x66B4;&#x9732;&#x8BE5;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x4F9B;&#x5176;&#x4ED6;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x3002;&#x8FD9;&#x79CD;&#x58F0;&#x660E;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x8BBE;&#x5B9A; <code>--icc=false</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x6807;&#x6CE8;&#xFF0C;&#x5E76;&#x4E0D;&#x5F3A;&#x5236;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6CA1;&#x6709;&#x58F0;&#x660E; <code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x5F3A;&#x5236; <code>--icc=false</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x6709; <code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x624D;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;</li><li><code>PUBLISH</code> &#x5219;&#x662F;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x5C06;&#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x516C;&#x5F00;&#x4E8E;&#x5916;&#x754C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5BBF;&#x4E3B;&#x4E4B;&#x5916;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x5BBF;&#x4E3B;IP&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x8BE5;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#xFF0C;&#x8BBF;&#x95EE;&#x5230;&#x5BB9;&#x5668;&#x5BF9;&#x5E94;&#x7AEF;&#x53E3;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x670D;&#x52A1;&#x3002;</li></ul><p><code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x4E0D; <code>PUBLISH</code>&#xFF0C;&#x8FD9;&#x6837;&#x53EA;&#x6709;&#x5BB9;&#x5668;&#x95F4;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x5BBF;&#x4E3B;&#x4E4B;&#x5916;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x3002;&#x800C; <code>PUBLISH</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x4E8B;&#x5148; <code>EXPOSE</code>&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4; <code>PUBLISH</code> &#x7B49;&#x4E8E;&#x540C;&#x65F6;&#x9690;&#x5F0F;&#x5B9A;&#x4E49;&#x4E86;&#x8BE5;&#x7AEF;&#x53E3;&#x8981; <code>EXPOSE</code>&#x3002;</p><p><code>docker run</code> &#x547D;&#x4EE4;&#x4E2D;&#x7684; <code>-p</code>, <code>-P</code> &#x53C2;&#x6570;&#xFF0C;&#x4EE5;&#x53CA; <code>docker-compose.yml</code> &#x4E2D;&#x7684;  <code>ports</code> &#x90E8;&#x5206;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5747;&#x662F;&#x6307; <code>PUBLISH</code>&#x3002;</p><p>&#x5C0F;&#x5199; <code>-p</code> &#x662F;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A; <code>[&#x5BBF;&#x4E3B;IP:]&lt;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&gt;:&lt;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;&gt;</code>&#xFF0C;&#x5176;&#x4E2D;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#x548C;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;&#xFF0C;&#x65E2;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<code>1000-2000:1000-2000</code>&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x5BBF;&#x4E3B;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5BBF;&#x4E3B;IP&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5BBF;&#x4E3B;IP&#x65F6;&#xFF0C;&#x5B88;&#x62A4;&#x6240;&#x6709;&#x63A5;&#x53E3;&#x3002;</p><p>&#x5927;&#x5199; <code>-P</code> &#x5219;&#x662F;&#x81EA;&#x52A8;&#x6620;&#x5C04;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x5B9A;&#x4E49; <code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x968F;&#x673A;&#x6620;&#x5C04;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x67D0;&#x4E2A;&#x7AEF;&#x53E3;&#x3002;</p><h3 id="wo-yao-ying-she-hao-ji-bai-ge-duan-kou-nan-dao-yao-yi-ge-ge-p-me"><a href="#&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;-p-&#x4E48;&#xFF1F;" class="headerlink" title="&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A; -p &#x4E48;&#xFF1F;"></a>&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A; <code>-p</code> &#x4E48;&#xFF1F; <a href="#wo-yao-ying-she-hao-ji-bai-ge-duan-kou-nan-dao-yao-yi-ge-ge-p-me" class="header-anchor">#</a></h3><p><code>-p</code> &#x662F;&#x53EF;&#x4EE5;&#x7528;&#x8303;&#x56F4;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p 8001-8010:8001-8010</span><br></pre></td></tr></table></figure><h3 id="wei-shi-me-p-hou-huan-shi-wu-fa-tong-guo-ying-she-duan-kou-fang-wen-rong-qi-li-mian-de-fu-wu"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-p-&#x540E;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x7684;&#x670D;&#x52A1;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; -p &#x540E;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x7684;&#x670D;&#x52A1;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; <code>-p</code> &#x540E;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x7684;&#x670D;&#x52A1;&#xFF1F; <a href="#wei-shi-me-p-hou-huan-shi-wu-fa-tong-guo-ying-she-duan-kou-fang-wen-rong-qi-li-mian-de-fu-wu" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#xFF0C;&#x5F53;&#x7136;&#x662F;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A; docker &#x7684;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x542F;&#x52A8;&#x6B63;&#x5E38;&#xFF1A; <code>docker ps</code>&#x3001;<code>docker top &lt;&#x5BB9;&#x5668;ID&gt;</code>&#x3001;<code>docker logs &lt;&#x5BB9;&#x5668;ID&gt;</code>&#x3001;<code>docker exec -it &lt;&#x5BB9;&#x5668;ID&gt; bash</code>&#x7B49;&#xFF0C;&#x8FD9;&#x662F;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x6392;&#x969C;&#x7684;&#x547D;&#x4EE4;&#xFF1B;&#x5982;&#x679C;&#x662F; <code>docker-compose</code> &#x4E5F;&#x6709;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x8FD9;&#x4E00;&#x7EC4;&#x547D;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x6392;&#x969C;&#x5F88;&#x5BB9;&#x6613;&#x3002;</p><p>&#x5982;&#x679C;&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x4E00;&#x5207;&#x6B63;&#x5E38;&#xFF0C;&#x751A;&#x81F3;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#xFF0C;<code>docker ps</code> &#x4E5F;&#x663E;&#x793A;&#x51FA;&#x4E86;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x6210;&#x529F;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;<strong>&#x68C0;&#x67E5;&#x9632;&#x706B;&#x5899;</strong>&#x4E86;&#x3002;</p><h4 id="ben-ji-fang-huo-qiang"><a href="#&#x672C;&#x673A;&#x9632;&#x706B;&#x5899;" class="headerlink" title="&#x672C;&#x673A;&#x9632;&#x706B;&#x5899;"></a>&#x672C;&#x673A;&#x9632;&#x706B;&#x5899; <a href="#ben-ji-fang-huo-qiang" class="header-anchor">#</a></h4><p>&#x5728; Docker &#x8FD0;&#x884C;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;<strong>&#x4E0D;&#x5E94;&#x8BE5;&#x8FD0;&#x884C;&#x4EFB;&#x4F55;&#x9632;&#x706B;&#x5899;</strong>&#x2026;&#x2026;&#x6CA1;&#x9519;&#xFF0C;&#x8BF4;&#x4F60;&#x5462;&#xFF0C;CentOS &#x7684; <strong>firewalld</strong> &#x548C; Ubuntu &#x7684; <strong>ufw</strong> &#x540C;&#x5B66;&#x3002;&#x7531;&#x4E8E; Docker &#x4F7F;&#x7528; <code>iptables</code> &#x89C4;&#x5219;&#x6765;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x6D41;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x800C;&#x90A3;&#x4E9B;&#x9632;&#x706B;&#x5899;&#x603B;&#x4EE5;&#x4E3A;&#x53EA;&#x6709;&#x81EA;&#x5DF1;&#x64B0;&#x5199; <code>iptables</code>&#xFF0C;&#x4ECE;&#x800C;&#x7ECF;&#x5E38;&#x4F1A;&#x5BFC;&#x81F4; Docker &#x8BBE;&#x7F6E;&#x4E86;&#x4E00;&#x4E9B;&#x89C4;&#x5219;&#xFF0C;&#x7136;&#x540E;&#x8F6C;&#x773C;&#x5C31;&#x88AB; <code>firewalld</code> &#x6216; <code>ufw</code> &#x7ED9;&#x6E05;&#x4E86;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x8D77;&#x3001;&#x505C;&#x9632;&#x706B;&#x5899;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x3002;&#x4ECE;&#x800C;&#x5BFC;&#x81F4; Docker &#x7684;&#x7F51;&#x7EDC;&#x4ECE;&#x5916;&#x754C;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x3002;</p><blockquote><p>&#x4E3A;&#x4E86;&#x907F;&#x514D; <code>iptables</code> &#x7684;&#x89C4;&#x5219;&#x5E72;&#x6270;&#xFF0C;&#x4E0D;&#x8981;&#x5728;&#x8FD0;&#x884C; Docker &#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x8FD0;&#x884C;<strong>&#x4EFB;&#x4F55;&#x9632;&#x706B;&#x5899;</strong>&#x6216;&#x914D;&#x7F6E;&#x81EA;&#x5B9A;&#x4E49;&#x7684; <code>iptables</code> &#x89C4;&#x5219;&#xFF0C;<em>&#x9664;&#x975E;</em>&#x4F60;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x4F60;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x5E76;&#x4E14;&#x77E5;&#x9053;&#x4F1A;&#x4EA7;&#x751F;&#x4EC0;&#x4E48;&#x540E;&#x679C;&#x3002;<br>&#x53E6;&#x5916;&#xFF0C;<strong>&#x5173;&#x95ED;&#x9632;&#x706B;&#x5899;&#x540E;&#xFF0C;&#x8BB0;&#x5F97;&#x91CD;&#x542F;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x81F3;&#x5C11;&#x662F;&#x91CD;&#x542F; Docker &#x670D;&#x52A1;&#x3002;&#x5426;&#x5219;&#x9632;&#x706B;&#x5899;&#x7684;&#x8D77;&#x3001;&#x505C;&#x3001;&#x5237;&#x65B0;&#x8FD9;&#x7C7B;&#x884C;&#x4E3A;&#x4F1A;&#x5BFC;&#x81F4;&#x6E05;&#x7A7A; Docker &#x8BBE;&#x7F6E;&#x7684;&#x7F51;&#x7EDC;&#x89C4;&#x5219;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x7F51;&#x7EDC;&#x65E0;&#x6CD5;&#x548C;&#x5916;&#x90E8;&#x4E92;&#x8054;&#x3002;</p></blockquote><h4 id="bian-jie-fang-huo-qiang"><a href="#&#x8FB9;&#x754C;&#x9632;&#x706B;&#x5899;" class="headerlink" title="&#x8FB9;&#x754C;&#x9632;&#x706B;&#x5899;"></a>&#x8FB9;&#x754C;&#x9632;&#x706B;&#x5899; <a href="#bian-jie-fang-huo-qiang" class="header-anchor">#</a></h4><p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E91;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x90A3;&#x4E48;&#x9664;&#x4E86;&#x672C;&#x673A;&#x9632;&#x706B;&#x5899;&#x5916;&#xFF0C;&#x4E91;&#x670D;&#x52A1;&#x7684;&#x670D;&#x52A1;&#x5546;&#x4E00;&#x822C;&#x4F1A;&#x63D0;&#x4F9B;&#x8FB9;&#x754C;&#x9632;&#x706B;&#x5899;&#x670D;&#x52A1;&#xFF0C;&#x6BD4;&#x5982;&#x5B89;&#x5168;&#x7EC4;&#x3001;&#x5B89;&#x5168;&#x7B56;&#x7565;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6709;&#x4E9B;&#x670D;&#x52A1;&#x5668;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x8D77;&#x89C1;&#xFF0C;&#x9ED8;&#x8BA4;&#x53EA;&#x5F00;&#x901A;&#x5FC5;&#x9700;&#x7684; <code>22</code> &#x7AEF;&#x53E3;&#x7ED9; SSH &#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x5176;&#x5B83;&#x7AEF;&#x53E3;&#x5C4F;&#x853D;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x8FDC;&#x7A0B;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668; <code>-p</code> &#x7AEF;&#x53E3;&#x5931;&#x8D25;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x3002;&#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x4F60;&#x5728;&#x670D;&#x52A1;&#x5668;&#x672C;&#x5730;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#xFF0C;&#x6BD4;&#x5982; <code>curl localhost</code> &#x6CA1;&#x6709;&#x963B;&#x788D;&#xFF0C;&#x4F46;&#x662F;&#x8FDC;&#x7A0B;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x5C31;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x53BB;&#x68C0;&#x67E5;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7684;&#x5B89;&#x5168;&#x8BBE;&#x7F6E;&#xFF0C;&#x662F;&#x5426;&#x5FD8;&#x8BB0;&#x4E86;&#x5F00;&#x542F;&#x6240;&#x9700;&#x7684;&#x7AEF;&#x53E3;&#x3002;</p><h3 id="vethxxxx-zhe-chong-xu-ni-wang-qia-he-rong-qi-de-dui-ying-guan-xi-cong-na-li-kan"><a href="#vethxxxx-&#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F;" class="headerlink" title="vethxxxx &#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F;"></a><code>vethxxxx</code> &#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F; <a href="#vethxxxx-zhe-chong-xu-ni-wang-qia-he-rong-qi-de-dui-ying-guan-xi-cong-na-li-kan" class="header-anchor">#</a></h3><p><code>&#x5317;&#x4EAC;-ZZ-&#x867E;&#x7C73;</code>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x597D;&#x529E;&#x6CD5;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                       DRIVER</span><br><span class="line">56f04389b8f0        dockerlnmp_backend         bridge</span><br><span class="line">094fcb269385        dockerlnmp_frontend        bridge</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>NETWORK ID</code>&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C; <code>ip a | grep veth</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ip a | grep veth</span><br><span class="line">12: veth22996d2@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</span><br><span class="line">14: veth34ace9a@if13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</span><br><span class="line">16: veth0bb3771@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</span><br><span class="line">22: veth399b874@if21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-094fcb269385 state UP group default</span><br><span class="line">24: vethf24a0a9@if23: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-094fcb269385 state UP group default</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>br-56f04389b8f0</code> &#x4EE5;&#x53CA; <code>br-094fcb269385</code>&#xFF0C;<code>br-</code> &#x540E;&#x9762;&#x7684;&#x662F;&#x4E0A;&#x9762;&#x7684;<code>&#x7F51;&#x7EDC;id</code>&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x770B;&#x51FA; <code>veth</code> &#x548C; Docker &#x7F51;&#x7EDC;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x800C;&#x5BB9;&#x5668;&#x90FD;&#x662F;&#x8FDE;&#x63A5;&#x5230;&#x4E86;&#x67D0;&#x4E2A;Docker&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#xFF0C;&#x4ECE;&#x800C;&#x5C31;&#x6709;&#x4E86;&#x5BB9;&#x5668;&#x548C; <code>veth</code> &#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x67D0;&#x4E2A;&#x7F51;&#x7EDC;&#x51FA;&#x73B0;&#x4E86;&#x591A;&#x4E2A; <code>veth</code> &#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF; <code>veth22996d2@if11</code> &#x540E;&#x9762;&#x7684; <code>if11</code> &#x8FD9;&#x90E8;&#x5206;&#xFF0C;&#x548C;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>ip addr</code> &#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4E00;&#x822C; <code>&#x5947;-&#x5076;</code>&#x662F;&#x4E00;&#x5BF9;&#x3002;</p><h3 id="ru-he-rang-yi-ge-rong-qi-lian-jie-liang-ge-wang-luo"><a href="#&#x5982;&#x4F55;&#x8BA9;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x8BA9;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1F;"></a>&#x5982;&#x4F55;&#x8BA9;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1F; <a href="#ru-he-rang-yi-ge-rong-qi-lian-jie-liang-ge-wang-luo" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x662F;&#x4F7F;&#x7528; <code>docker run</code>&#xFF0C;&#x90A3;&#x5F88;&#x4E0D;&#x5E78;&#xFF0C;&#x4E00;&#x6B21;&#x53EA;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x4E3A; <code>docker run</code> &#x7684; <code>--network</code> &#x53C2;&#x6570;&#x53EA;&#x53EF;&#x4EE5;&#x51FA;&#x73B0;&#x4E00;&#x6B21;&#xFF08;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x591A;&#x6B21;&#xFF0C;&#x6700;&#x540E;&#x7684;&#x4F1A;&#x8986;&#x76D6;&#x4E4B;&#x524D;&#x7684;&#xFF09;&#x3002;&#x4E0D;&#x8FC7;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x547D;&#x4EE4; <code>docker network connect</code> &#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#x3002;</p><p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create mynet1</span><br><span class="line">$ docker network create mynet2</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x8FDE;&#x63A5;&#x8FD9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name web --network mynet1 nginx</span><br><span class="line">$ docker network connect mynet2 web</span><br></pre></td></tr></table></figure><p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F7F;&#x7528; <code>docker-compose</code> &#x90A3;&#x5C31;&#x6CA1;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<a href="https://docs.docker.com/engine/reference/api/docker_remote_api_v1.24/#/create-a-container" target="_blank" rel="noopener"><code>Docker Remote API</code></a> &#x662F;&#x652F;&#x6301;&#x4E00;&#x6B21;&#x6027;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4F30;&#x8BA1;&#x662F;&#x547D;&#x4EE4;&#x884C;&#x4E0A;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x6240;&#x4EE5; <code>docker run</code> &#x9650;&#x5B9A;&#x4E3A;&#x53EA;&#x53EF;&#x4EE5;&#x4E00;&#x6B21;&#x8FDE;&#x4E00;&#x4E2A;&#x3002;<code>docker-compose</code> &#x76F4;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x670D;&#x52A1;&#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x5165;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&apos;2&apos;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mynet1</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mynet2</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">mynet1:</span></span><br><span class="line">    <span class="attr">mynet2:</span></span><br></pre></td></tr></table></figure><h3 id="docker-duo-su-zhu-wang-luo-zen-me-pei-zhi"><a href="#Docker-&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F;" class="headerlink" title="Docker &#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F;"></a>Docker &#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F; <a href="#docker-duo-su-zhu-wang-luo-zen-me-pei-zhi" class="header-anchor">#</a></h3><p>Docker &#x8DE8;&#x8282;&#x70B9;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x4E92;&#x8054;&#xFF0C;&#x6700;&#x901A;&#x7528;&#x7684;&#x662F;&#x4F7F;&#x7528; <code>overlay</code> &#x7F51;&#x7EDC;&#x3002;</p><p>&#x4E00;&#x4EE3; Swarm &#x5DF2;&#x7ECF;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x8981;&#x6C42;&#x4F7F;&#x7528; <code>overlay</code> &#x7F51;&#x7EDC;&#x524D;&#x5148;&#x51C6;&#x5907;&#x597D;&#x5206;&#x5E03;&#x5F0F;&#x952E;&#x503C;&#x5E93;&#xFF0C;&#x6BD4;&#x5982; <code>etcd</code>, <code>consul</code> &#x6216; <code>zookeeper</code>&#x3002;&#x7136;&#x540E;&#x5728;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x7684; Docker &#x5F15;&#x64CE;&#x4E2D;&#xFF0C;&#x914D;&#x7F6E; <code>--cluster-store</code> &#x548C; <code>--cluster-advertise</code> &#x53C2;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x624D;&#x53EF;&#x4EE5;&#x4E92;&#x8FDE;&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6211;&#x5199;&#x7684; LNMP &#x5BB9;&#x5668;&#x4E92;&#x8054;&#x4F8B;&#x5B50;&#x4E2D;&#x7684; <a href="https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/run1.sh" target="_blank" rel="noopener"><strong>run1.sh</strong></a> &#x8FD9;&#x4E2A;&#x811A;&#x672C;&#xFF0C;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5229;&#x7528; <code>docker-machine</code>&#x81EA;&#x52A8;&#x5EFA;&#x7ACB; Swarm &#x5E76;&#x4E14;&#x914D;&#x7F6E;&#x597D; <code>overlay</code> &#x7684;&#x811A;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x6790;&#x5176;&#x6D41;&#x7A0B;&#x3002;</p><p>&#x73B0;&#x5728;&#x90FD;&#x5728;&#x4F7F;&#x7528;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>Docker Swarm Mode</code>&#xFF0C;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x8981; <code>docker swarm init</code> &#x5EFA;&#x7ACB;&#x96C6;&#x7FA4;&#xFF0C;&#x5176;&#x5B83;&#x8282;&#x70B9; <code>docker swarm join</code> &#x52A0;&#x5165;&#x96C6;&#x7FA4;&#x540E;&#xFF0C;&#x96C6;&#x7FA4;&#x5185;&#x7684;&#x670D;&#x52A1;&#x5C31;&#x81EA;&#x52A8;&#x5EFA;&#x7ACB;&#x4E86; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E92;&#x8054;&#x80FD;&#x529B;&#x3002;</p><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x662F;<strong>&#x591A;&#x7F51;&#x5361;&#x73AF;&#x5883;</strong>&#xFF0C;&#x65E0;&#x8BBA;&#x662F; <code>docker swarm init</code> &#x8FD8;&#x662F; <code>docker swarm join</code>&#xFF0C;&#x90FD;&#x4E0D;&#x8981;&#x5FD8;&#x8BB0;&#x4F7F;&#x7528;&#x53C2;&#x6570; <code>--advertise-addr</code> &#x6307;&#x5B9A;&#x5BA3;&#x544A;&#x5730;&#x5740;&#xFF0C;&#x5426;&#x5219;&#x81EA;&#x52A8;&#x9009;&#x62E9;&#x7684;&#x5730;&#x5740;&#x5F88;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x4F60;&#x671F;&#x671B;&#x7684;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x96C6;&#x7FA4;&#x4E92;&#x8054;&#x5931;&#x8D25;&#x3002;&#x683C;&#x5F0F;&#x4E3A; <code>--advertise-addr &lt;&#x5730;&#x5740;&gt;:&lt;&#x7AEF;&#x53E3;&gt;</code>&#xFF0C;&#x5730;&#x5740;&#x53EF;&#x4EE5;&#x662F; IP &#x5730;&#x5740;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x7F51;&#x5361;&#x63A5;&#x53E3;&#xFF0C;&#x6BD4;&#x5982; <code>eth0</code>&#x3002;&#x7AEF;&#x53E3;&#x9ED8;&#x8BA4;&#x4E3A; <code>2377</code>&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6539;&#x52A8;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x3002;</p><p>&#x6B64;&#x5916;&#xFF0C;&#x8FD9;&#x662F;&#x4F9B;<strong>&#x670D;&#x52A1;</strong>&#x4F7F;&#x7528;&#x7684; <code>overlay</code>&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709; <code>docker service create</code> &#x7684;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x7F51;&#x7EDC;&#xFF0C;&#x800C; <code>docker run</code> &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x7F51;&#x7EDC;&#xFF0C;&#x9664;&#x975E;&#x660E;&#x786E;&#x8BE5;&#x7F51;&#x7EDC;&#x4E3A; <code>--attachable</code>&#x3002;</p><p>&#x5173;&#x4E8E; <code>overlay</code> &#x7F51;&#x7EDC;&#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/networking/get-started-overlay/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/get-started-overlay/</a></p><p>&#x867D;&#x7136;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x552F;&#x4E00;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8054;&#x65B9;&#x6848;&#x3002;Docker &#x5185;&#x7F6E;&#x4E86;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x7684;&#x4E92;&#x8054;&#x65B9;&#x6848;&#xFF0C;&#x6BD4;&#x5982;&#x6548;&#x7387;&#x6BD4;&#x8F83;&#x9AD8;&#x7684; <code>macvlan</code>&#x3002;&#x5982;&#x679C;&#x5728;&#x5C40;&#x57DF;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x5BF9; <code>overlay</code> &#x7684;&#x989D;&#x5916;&#x5F00;&#x9500;&#x4E0D;&#x6EE1;&#x610F;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8003;&#x8651; <code>macvlan</code> &#x4EE5;&#x53CA; <code>ipvlan</code>&#xFF0C;&#x8FD9;&#x662F;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x65B9;&#x6848;&#x3002;<br><a href="https://docs.docker.com/engine/userguide/networking/get-started-macvlan/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/get-started-macvlan/</a></p><p>&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x7B2C;&#x4E09;&#x65B9;&#x7684;&#x7F51;&#x7EDC;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x8DE8;&#x5BBF;&#x4E3B;&#x4E92;&#x8054;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5B98;&#x7F51;&#x5BF9;&#x5E94;&#x6587;&#x6863;&#x8FDB;&#x4E00;&#x6B65;&#x67E5;&#x770B;&#xFF1A;<a href="https://docs.docker.com/engine/extend/legacy_plugins/#/network-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/legacy_plugins/#/network-plugins</a></p><h3 id="ming-ming-docker-network-ls-zhong-kan-dao-liao-jian-li-de-overlay-wang-luo-zen-me-docker-run-huan-shuo-wang-luo-bu-cun-zai-a"><a href="#&#x660E;&#x660E;-docker-network-ls-&#x4E2D;&#x770B;&#x5230;&#x4E86;&#x5EFA;&#x7ACB;&#x7684;-overlay-&#x7F51;&#x7EDC;&#xFF0C;&#x600E;&#x4E48;-docker-run-&#x8FD8;&#x8BF4;&#x7F51;&#x7EDC;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;" class="headerlink" title="&#x660E;&#x660E; docker network ls &#x4E2D;&#x770B;&#x5230;&#x4E86;&#x5EFA;&#x7ACB;&#x7684; overlay &#x7F51;&#x7EDC;&#xFF0C;&#x600E;&#x4E48; docker run &#x8FD8;&#x8BF4;&#x7F51;&#x7EDC;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;"></a>&#x660E;&#x660E; <code>docker network ls</code> &#x4E2D;&#x770B;&#x5230;&#x4E86;&#x5EFA;&#x7ACB;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x600E;&#x4E48; <code>docker run</code> &#x8FD8;&#x8BF4;&#x7F51;&#x7EDC;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F; <a href="#ming-ming-docker-network-ls-zhong-kan-dao-liao-jian-li-de-overlay-wang-luo-zen-me-docker-run-huan-shuo-wang-luo-bu-cun-zai-a" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x5728; <code>docker network ls</code> &#x4E2D;&#x770B;&#x5230;&#x4E86;&#x5982;&#x4E0B;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">...</span><br><span class="line">24pz359114y0        mynet               overlay             swarm</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x540D;&#x4E3A; <code>mynet</code> &#x7684;&#x7F51;&#x7EDC;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x5230; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x3002;&#x5982;&#x679C;&#x8BD5;&#x56FE;&#x8FDE;&#x63A5;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x62A5;&#x9519;&#x3002;</p><p>&#x5982;&#x679C;&#x662F; 1.12 &#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x6837;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm --network mynet busybox</span><br><span class="line">docker: Error response from daemon: network mynet not found.</span><br><span class="line">See <span class="string">&apos;docker run --help&apos;</span>.</span><br></pre></td></tr></table></figure><p>&#x62A5;&#x9519;&#x8BF4; <code>mynet</code> &#x7F51;&#x7EDC;&#x627E;&#x4E0D;&#x5230;&#x3002;&#x5176;&#x5B9E;&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x540D;&#x4E3A; <code>mynet</code> &#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x9A71;&#x52A8;&#x662F; <code>overlay</code> &#x6CA1;&#x6709;&#x9519;&#xFF0C;&#x4F46;&#x5B83;&#x7684; <code>Scope</code> &#x662F; <code>swarm</code>&#x3002;&#x8FD9;&#x4E2A;&#x610F;&#x601D;&#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x662F;&#x5728;&#x4E8C;&#x4EE3; <code>Swarm</code> &#x73AF;&#x5883;&#x4E2D;&#x5EFA;&#x7ACB;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x53EF;&#x4EE5;&#x7531; <code>Swarm</code> &#x73AF;&#x5883;&#x4E0B;&#x7684;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;&#x800C; <code>docker run</code> &#x6240;&#x8FD0;&#x884C;&#x7684;&#x53EA;&#x662F;&#x96F6;&#x6563;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x975E; <code>Service</code>&#xFF0C;&#x56E0;&#x6B64;&#x81EA;&#x7136;&#x5728;&#x96F6;&#x6563;&#x5BB9;&#x5668;&#x6240;&#x80FD;&#x4F7F;&#x7528;&#x7684;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x53EB; <code>mynet</code> &#x7F51;&#x7EDC;&#x3002;</p><p><code>docker run</code> &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x662F; <code>Scope</code> &#x4E3A; <code>global</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x5916;&#x7F6E;&#x952E;&#x503C;&#x5E93;&#x6240;&#x5EFA;&#x7ACB;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4EE3; <code>Swarm</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x3002;</p><p>&#x8FD9;&#x70B9;&#x5728; 1.13 &#x540E;&#x7A0D;&#x6709;&#x53D8;&#x5316;&#x3002;&#x5982;&#x679C;&#x662F; 1.13 &#x4EE5;&#x540E;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm --network mynet busybox</span><br><span class="line">docker: Error response from daemon: Could not attach to network mynet: rpc error: code = 7</span><br><span class="line"> desc = network mynet not manually attachable.</span><br></pre></td></tr></table></figure><p>&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x4E0D;&#x518D;&#x8BF4;&#x7F51;&#x7EDC;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x800C;&#x662F;&#x8BF4;&#x8FD9;&#x4E2A; <code>mynet</code> &#x7F51;&#x7EDC;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x3002;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5141;&#x8BB8;&#x5728;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#x58F0;&#x660E;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x88AB;&#x96F6;&#x6563;&#x7684;&#x5BB9;&#x5668;&#x6240;&#x8FDE;&#x63A5;&#x3002;&#x5982;&#x679C; <code>docker network create</code> &#x52A0;&#x4E86; <code>--attachable</code> &#x7684;&#x53C2;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x540E;&#x671F;&#xFF0C;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x662F;&#x53EF;&#x4EE5;&#x88AB;&#x666E;&#x901A;&#x5BB9;&#x5668;&#x6240;&#x8FDE;&#x63A5;&#x7684;&#x3002;</p><p>&#x4F46;&#x662F;&#x8FD9;&#x662F;&#x5728;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x53E3;&#x5B50;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x5141;&#x8BB8;&#x666E;&#x901A;&#x5BB9;&#x5668;&#x94FE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x3002;</p><h3 id="shi-yong-swarm-mode-de-shi-kan-dao-you-ge-jiao-ingress-de-overlay-wang-luo-ta-he-zi-ji-chuang-jian-de-wang-luo-you-shi-me-qu-bie"><a href="#&#x4F7F;&#x7528;-Swarm-Mode-&#x7684;&#x65F6;&#xFF0C;&#x770B;&#x5230;&#x6709;&#x4E2A;&#x53EB;-ingress-&#x7684;-overlay-&#x7F51;&#x7EDC;&#xFF0C;&#x5B83;&#x548C;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684;&#x7F51;&#x7EDC;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;" class="headerlink" title="&#x4F7F;&#x7528; Swarm Mode &#x7684;&#x65F6;&#xFF0C;&#x770B;&#x5230;&#x6709;&#x4E2A;&#x53EB; ingress &#x7684; overlay &#x7F51;&#x7EDC;&#xFF0C;&#x5B83;&#x548C;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684;&#x7F51;&#x7EDC;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;"></a>&#x4F7F;&#x7528; <code>Swarm Mode</code> &#x7684;&#x65F6;&#xFF0C;&#x770B;&#x5230;&#x6709;&#x4E2A;&#x53EB; <code>ingress</code> &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5B83;&#x548C;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684;&#x7F51;&#x7EDC;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F; <a href="#shi-yong-swarm-mode-de-shi-kan-dao-you-ge-jiao-ingress-de-overlay-wang-luo-ta-he-zi-ji-chuang-jian-de-wang-luo-you-shi-me-qu-bie" class="header-anchor">#</a></h3><p>&#x5728;&#x542F;&#x7528;&#x4E86;&#x4E8C;&#x4EE3; Swarm &#x540E;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x7F51;&#x7EDC;&#x5217;&#x8868;&#x65F6;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>ingress</code> &#x7684; overlay &#x7F51;&#x7EDC;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">6beb824623a4        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">f3f636574c7a        docker_gwbridge     bridge              <span class="built_in">local</span></span><br><span class="line">cfeb2513a4a3        host                host                <span class="built_in">local</span></span><br><span class="line">88smbt683r5p        ingress             overlay             swarm</span><br><span class="line">24pz359114y0        mynet               overlay             swarm</span><br><span class="line">d35d69ece740        none                null                <span class="built_in">local</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E24;&#x4E2A; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x662F;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x7684; <code>mynet</code>&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x5219;&#x662F; Docker &#x5F15;&#x64CE;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684; <code>ingress</code>&#xFF0C;&#x4ECE;&#x9A71;&#x52A8;&#x548C; <code>Scope</code> &#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#x90FD;&#x662F;&#x7ED9; Swarm Mode &#x4F7F;&#x7528;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x3002;</p><p><code>ingress</code> &#x662F; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x662F;&#x666E;&#x901A;&#x7684; <code>overlay network</code>&#xFF0C;&#x5B83;&#x662F;&#x4E3A;&#x8FB9;&#x754C;&#x8FDB;&#x5165;&#x6D41;&#x91CF;&#x7279;&#x6B8A;&#x51C6;&#x5907;&#x7684;&#x7F51;&#x7EDC;&#x3002;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x5B58;&#x5728;&#x4E8E;&#x96C6;&#x7FA4;&#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;Docker&#x5BBF;&#x4E3B;&#x4E0A;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x5EFA;&#x7ACB;&#x3002;</p><p>&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528; <code>docker service create -p 80:80</code> &#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x6C42;&#x6620;&#x5C04;&#x96C6;&#x7FA4;&#x7AEF;&#x53E3; <code>80</code> &#x5230;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#x4E0A;&#x3002;&#x5176;&#x6548;&#x679C;&#x662F;&#x8BBF;&#x95EE;&#x4EFB;&#x4E00;&#x8282;&#x70B9;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#xFF0C;&#x5373;&#x4F7F;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x6CA1;&#x6709;&#x8FD0;&#x884C;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F9D;&#x65E7;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x53D6;&#x5F97;&#x7ED3;&#x679C;&#x3002;&#x5B9E;&#x73B0;&#x8FD9;&#x6837;&#x6548;&#x679C;&#x7684;&#x4E00;&#x4E2A;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x56E0;&#x4E3A; <code>ingress</code> &#x7F51;&#x7EDC;&#x7684;&#x5B58;&#x5728;&#x3002;</p><p>Swarm &#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;<strong>&#x9690;&#x85CF;&#x7684;&#x6C99;&#x7BB1;&#x5BB9;&#x5668;</strong>&#x76D1;&#x542C;&#x5BBF;&#x4E3B;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#xFF0C;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x6765;&#x81EA;&#x96C6;&#x7FA4;&#x5916;&#x754C;&#x7684;&#x8BBF;&#x95EE;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker network inspect ingress</code> &#x6765;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x6C99;&#x7BB1;&#x5BB9;&#x5668;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect ingress</span><br><span class="line">[</span><br><span class="line">   {</span><br><span class="line">       <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ingress&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;88smbt683r5p7c0l7sd0dpniw&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;swarm&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay&quot;</span>,</span><br><span class="line">       <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;IPAM&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">           <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">               {</span><br><span class="line">                   <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;10.255.0.0/16&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;10.255.0.1&quot;</span></span><br><span class="line">               }</span><br><span class="line">           ]</span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;Containers&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;faff08692b5f916fcb15aa7ac6bc8633a0fa714a52a1fb75e57525c94581c45a&quot;</span>: {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;web.1.1jyunyva6picwsztzrj6t2cio&quot;</span>,</span><br><span class="line">               <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;58240770eb25565b472384731b1b90e36141a633ce184a5163829cf96e9d1195&quot;</span>,</span><br><span class="line">               <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:0a:ff:00:05&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;10.255.0.5/16&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">           },</span><br><span class="line">           <span class="string">&quot;ingress-sbox&quot;</span>: {</span><br><span class="line">               <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ingress-endpoint&quot;</span>,</span><br><span class="line">               <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;fe8f89d4f99d7bacb14c5cb723682c180278d62e9edd10b523cdd81a45695c5d&quot;</span>,</span><br><span class="line">               <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:0a:ff:00:03&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;10.255.0.3/16&quot;</span>,</span><br><span class="line">               <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">           }</span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Options&quot;</span>: {</span><br><span class="line">           <span class="string">&quot;com.docker.network.driver.overlay.vxlanid_list&quot;</span>: <span class="string">&quot;256&quot;</span></span><br><span class="line">       },</span><br><span class="line">       <span class="string">&quot;Labels&quot;</span>: {}</span><br><span class="line">   }</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x8FD4;&#x56DE;&#x4FE1;&#x606F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>ingress-endpoint</code> &#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x8FB9;&#x754C;&#x6C99;&#x7BB1;&#x5BB9;&#x5668;&#x3002;</p><p>&#x5F53;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x4E86; <code>-p</code> &#x53C2;&#x6570;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x7684;&#x52A0;&#x5165;&#x5230; <code>ingress</code> &#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x5728;&#x6C99;&#x7BB1;&#x4E2D;&#x6CE8;&#x518C;&#x6620;&#x5C04;&#x4FE1;&#x606F;&#xFF0C;&#x544A;&#x77E5;&#x54EA;&#x4E2A;&#x670D;&#x52A1;&#x8981;&#x6C42;&#x5B88;&#x62A4;&#x54EA;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x5177;&#x4F53;&#x5BF9;&#x5E94;&#x5BB9;&#x5668;&#x662F;&#x54EA;&#x4E9B;&#x3002;</p><p>&#x56E0;&#x6B64;&#x5F53;&#x6C99;&#x7BB1;&#x6536;&#x5230;&#x5916;&#x90E8;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x7AEF;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x5177;&#x4F53;&#x670D;&#x52A1;&#x5728;&#x5B88;&#x62A4;&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A; <code>ingress</code> &#x7F51;&#x7EDC;&#x53BB;&#x5C06;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;&#x5BF9;&#x5E94;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x3002;&#x800C;&#x7531;&#x4E8E; <code>ingress</code> &#x7684;&#x672C;&#x8D28;&#x662F; <code>overlay network</code>&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x65E0;&#x8BBA;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x4E8E;&#x54EA;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x6C99;&#x7BB1;&#x90FD;&#x53EF;&#x4EE5;&#x6210;&#x529F;&#x7684;&#x5C06;&#x8FDE;&#x63A5;&#x8F6C;&#x53D1;&#x7ED9;&#x6B63;&#x786E;&#x7684;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;<code>ingress</code> &#x662F;&#x7279;&#x6B8A;&#x7528;&#x9014;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x53EA;&#x8981;&#x670D;&#x52A1;&#x6709; <code>-p</code> &#x9009;&#x9879;&#xFF0C;&#x90A3;&#x4E48;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x88AB;&#x52A0;&#x5165;&#x8BE5;&#x7F51;&#x7EDC;&#x3002;&#x56E0;&#x6B64;&#x628A; <code>ingress</code> &#x7F51;&#x7EDC;&#x5F53;&#x505A;&#x666E;&#x901A;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#xFF0C;&#x9664;&#x4E86;&#x4F1A;&#x5E72;&#x6270; Swarm &#x6B63;&#x5E38;&#x7684;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x4E5F;&#x4F1A;&#x7834;&#x574F;&#x670D;&#x52A1;&#x9694;&#x79BB;&#x7684;&#x5B89;&#x5168;&#x673A;&#x5236;&#x3002;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x628A;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x5F53;&#x505A;&#x666E;&#x901A;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x6765;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x63A7;&#x5236;&#x670D;&#x52A1;&#x4E92;&#x8054;&#x548C;&#x9694;&#x79BB;&#x65F6;&#xFF0C;&#x8BF7;&#x7528;&#x81EA;&#x884C;&#x521B;&#x5EFA;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x3002;</p><h3 id="ting-shuo-link-guo-shi-bu-zai-yong-liao-na-rong-qi-hu-lian-fu-wu-fa-xian-zen-me-ban"><a href="#&#x542C;&#x8BF4;-link-&#x8FC7;&#x65F6;&#x4E0D;&#x518D;&#x7528;&#x4E86;&#xFF1F;&#x90A3;&#x5BB9;&#x5668;&#x4E92;&#x8054;&#x3001;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x542C;&#x8BF4; --link &#x8FC7;&#x65F6;&#x4E0D;&#x518D;&#x7528;&#x4E86;&#xFF1F;&#x90A3;&#x5BB9;&#x5668;&#x4E92;&#x8054;&#x3001;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x542C;&#x8BF4; <code>--link</code> &#x8FC7;&#x65F6;&#x4E0D;&#x518D;&#x7528;&#x4E86;&#xFF1F;&#x90A3;&#x5BB9;&#x5668;&#x4E92;&#x8054;&#x3001;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#ting-shuo-link-guo-shi-bu-zai-yong-liao-na-rong-qi-hu-lian-fu-wu-fa-xian-zen-me-ban" class="header-anchor">#</a></h3><p>&#x5728; 1-2 &#x5E74;&#x524D;&#xFF0C;Docker &#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x8FDE;&#x63A5;&#x4E8E;&#x9ED8;&#x8BA4;&#x7684;&#x6865;&#x63A5;&#x7F51;&#x7EDC;&#x4E0A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F88;&#x591A;&#x8001;&#x6587;&#x7AE0;&#x9F13;&#x6363;&#x7684; <code>docker0</code> &#x6865;&#x63A5;&#x7F51;&#x5361;&#x3002;&#x56E0;&#x6B64;&#x5B9E;&#x9645;&#x4E0A;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x4E92;&#x8054;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x9694;&#x79BB;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x6837;&#x5B89;&#x5168;&#x6027;&#x4E0D;&#x597D;&#x3002;&#x800C;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x662F;&#x5728;&#x8FD9;&#x79CD;&#x73AF;&#x5883;&#x4E0B;&#x53D1;&#x5C55;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x51E1;&#x662F; <code>--link</code> &#x7684;&#x4E3B;&#x673A;&#x7684;&#x522B;&#x540D;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x4E8E; <code>/etc/hosts</code> &#x4E2D;&#xFF0C;&#x5176;&#x5730;&#x5740;&#x7531; Docker &#x5F15;&#x64CE;&#x7EF4;&#x62A4;&#x3002;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x95F4;&#x624D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>&#x522B;&#x540D;</strong>&#x4E92;&#x8BBF;&#x3002;</p><p>&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x5E76;&#x4E0D;&#x662F;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;Docker &#x65E9;&#x5728;&#x4E00;&#x5E74;&#x591A;&#x4EE5;&#x524D;&#x5C31;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x4E86;&#x3002;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x4E92;&#x8054;&#xFF0C;&#x5E76;&#x4E14;&#xFF0C;Docker &#x5185;&#x7F6E;&#x4E86; DNS&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x540D;&#x3001;&#x5BB9;&#x5668;&#x540D;&#x3001;&#x522B;&#x540D;&#x6765;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x540D;&#x79F0;&#x4F1A;&#x7ECF;&#x7531;&#x5185;&#x7F6E;&#x7684; DNS &#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x5176;&#x7ED3;&#x679C;&#x662F;&#x52A8;&#x6001;&#x7684;&#xFF1B;&#x800C;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4E0D;&#x53EF;&#x4EE5;&#x4E92;&#x8054;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x73B0;&#x5728;&#x65E9;&#x5C31;&#x4E0D;&#x7528; <code>--link</code> &#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x975E;&#x5E38;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x3002;</p><p>&#x9996;&#x5148;&#x662F;&#x56E0;&#x4E3A;&#x4F7F;&#x7528; <code>--link</code> &#x5C31;&#x5F88;&#x53EF;&#x80FD;&#x8FD8;&#x5728;&#x7528;&#x9ED8;&#x8BA4;&#x6865;&#x63A5;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x5F88;&#x4E0D;&#x5B89;&#x5168;&#xFF0C;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x6CA1;&#x6709;&#x9002;&#x5EA6;&#x9694;&#x79BB;&#xFF0C;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x624D;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x4E92;&#x8054;&#x9694;&#x79BB;&#x3002;</p><p>&#x5176;&#x6B21;&#xFF0C;&#x4FEE;&#x6539; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x6709;&#x5F88;&#x591A;&#x5F0A;&#x75C5;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x9AD8;&#x9891;&#x7E41;&#x7684;&#x5BB9;&#x5668;&#x542F;&#x505C;&#x73AF;&#x5883;&#x65F6;&#xFF0C;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x7ADE;&#x4E89;&#x5192;&#x9669;&#xFF0C;&#x5BFC;&#x81F4; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x635F;&#x574F;&#xFF0C;&#x51FA;&#x73B0;&#x8BBF;&#x95EE;&#x6545;&#x969C;&#xFF1B;&#x6216;&#x8005;&#x6709;&#x4E9B;&#x5E94;&#x7528;&#x53D1;&#x73B0;&#x662F;&#x6765;&#x81EA;&#x4E8E; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x540E;&#xFF0C;&#x5C31;&#x5047;&#x5B9A;&#x5176;&#x4E3A;&#x9759;&#x6001;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x7F13;&#x5B58;&#x7ED3;&#x679C;&#x4E0D;&#x518D;&#x67E5;&#x8BE2;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5BB9;&#x5668;&#x542F;&#x505C; IP &#x53D8;&#x66F4;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x65E7;&#x7684;&#x6761;&#x76EE;&#x800C;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x6B63;&#x786E;&#x7684;&#x5BB9;&#x5668;&#x7B49;&#x7B49;&#x3002;</p><p>&#x53E6;&#x5916;&#xFF0C;&#x5728;&#x4E00;&#x4EE3; Swarm &#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5728; <code>docker-compose.yml</code> &#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>links</code> &#x5C31;&#x610F;&#x5473;&#x7740;&#x670D;&#x52A1;&#x95F4;&#x7684;&#x5F3A;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x56E0;&#x6B64;&#x8C03;&#x5EA6;&#x65F6;&#x4E0D;&#x4F1A;&#x5C06;&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x4E8E;&#x4E0D;&#x540C;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x662F;&#x5168;&#x90E8;&#x8FD0;&#x884C;&#x4E8E;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4F7F;&#x5F97;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x5931;&#x8D25;&#x3002;</p><p>&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x518D;&#x4F7F;&#x7528; <code>--link</code> &#x4EE5;&#x53CA; <code>docker-compose.yml</code> &#x4E2D;&#x7684; <code>links</code> &#x4E86;&#x3002;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>docker network</code>&#xFF0C;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#xFF0C;&#x800C; <code>docker run --network</code> &#x6765;&#x8FDE;&#x63A5;&#x7279;&#x5B9A;&#x7F51;&#x7EDC;&#x3002;&#x6216;&#x8005;&#x4F7F;&#x7528; <code>version: &apos;2&apos;</code> &#x7684; <code>docker-compose.yml</code> &#x76F4;&#x63A5;&#x5B9A;&#x4E49;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x5E76;&#x4F7F;&#x7528;&#x3002;</p><p>&#x5EFA;&#x8BAE;&#x53BB;&#x770B;&#x4E00;&#x4E0B;&#x6211;&#x5199;&#x7684; <code>LNMP</code> &#x591A;&#x5BB9;&#x5668;&#x4E92;&#x8054;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p><h3 id="shi-yong-hbase-hadoop-de-shi-hou-fan-xiang-jie-xi-zong-shi-bu-dui-zen-me-ban"><a href="#&#x4F7F;&#x7528;-HBase-Hadoop-&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x603B;&#x662F;&#x4E0D;&#x5BF9;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x4F7F;&#x7528; HBase/Hadoop &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x603B;&#x662F;&#x4E0D;&#x5BF9;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x4F7F;&#x7528; HBase/Hadoop &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x603B;&#x662F;&#x4E0D;&#x5BF9;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#shi-yong-hbase-hadoop-de-shi-hou-fan-xiang-jie-xi-zong-shi-bu-dui-zen-me-ban" class="header-anchor">#</a></h3><p>Hadoop/HBase &#x8FD9;&#x7C7B;&#x4E1C;&#x897F;&#x603B;&#x559C;&#x6B22;&#x6839;&#x636E;&#x8BBE;&#x5B9A;&#x7684;&#x540D;&#x79F0;&#x6B63;&#x5411;&#x7684;&#x89E3;&#x6790;&#x4E00;&#x904D;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x67D0;&#x4E2A;&#x65F6;&#x5019;&#x4F1A;&#x53CD;&#x5411;&#x7684;&#x89E3;&#x6790;&#x4E00;&#x904D;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x4E00;&#x81F4;&#x3002;&#x8FD9;&#x79CD;&#x9ED8;&#x8BA4;&#x5047;&#x5B9A;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528; <code>/etc/hosts</code> &#x7684;&#x65F6;&#x5019;&#x3002;&#x6B63;&#x5411;&#x89E3;&#x6790;&#x4F1A;&#x4ECE; <code>/etc/hosts</code> &#x4E2D;&#x53D6;&#x5F97;&#xFF0C;&#x800C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x5219;&#x66F4;&#x53EF;&#x80FD;&#x8D70; DNS&#xFF0C;&#x4E8E;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</p><p>&#x5BF9;&#x4E8E; Docker &#x800C;&#x8A00;&#xFF0C;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x540E;&#xFF0C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6709;&#x5F88;&#x591A;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x5185;&#x7F6E; DNS &#x53EF;&#x4EE5;&#x6839;&#x636E;<strong>&#x670D;&#x52A1;&#x540D;</strong>&#x3001;<strong>&#x5BB9;&#x5668;&#x540D;</strong>&#x3001;<strong>&#x7F51;&#x7EDC;&#x522B;&#x540D;</strong>&#x3001;<strong>&lt;&#x5BB9;&#x5668;&#x540D;&gt;.&lt;&#x7F51;&#x7EDC;&#x540D;&gt;</strong> &#x7B49;&#x6765;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x3002;&#x56E0;&#x6B64;&#x6B63;&#x5411;&#x89E3;&#x6790;&#x8BBE;&#x7F6E;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#xFF0C;&#x5176;&#x7ED3;&#x679C;&#x90FD;&#x4F1A;&#x6307;&#x5411;&#x5BB9;&#x5668;&#x7684; IP&#x3002;</p><p>&#x800C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x5219;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x53EA;&#x8FD4;&#x56DE;<code>&lt;&#x5BB9;&#x5668;&#x540D;&gt;.&lt;&#x7F51;&#x7EDC;&#x540D;&gt;</code>&#x3002;</p><p>&#x6240;&#x4EE5;&#x5F53;&#x6709;&#x4EBA;&#x8FD9;&#x6837;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm \</span><br><span class="line">    --name wombat.example.com \</span><br><span class="line">    --hostname wombat.example.com \</span><br><span class="line">    --network net1 \</span><br><span class="line">    m3adow/nettools</span><br></pre></td></tr></table></figure><p>&#x4F1A;&#x53D1;&#x73B0;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x5E76;&#x975E;&#x81EA;&#x5DF1;&#x6240;&#x671F;&#x671B;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">50: eth0@if51: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    link/ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.0.2/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:acff:fe13:2/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ <span class="comment"># dig +short wombat.example.com</span></span><br><span class="line">172.19.0.2</span><br><span class="line">/ <span class="comment"># host 172.19.0.2</span></span><br><span class="line">2.0.19.172.in-addr.arpa domain name pointer wombat.example.com.net1.</span><br></pre></td></tr></table></figure><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;&#xFF0C;&#x7531; <code>wombat.example.com</code> &#x6B63;&#x5411;&#x89E3;&#x6790;&#x7684;&#x8BDD;&#xFF0C;&#x5176;&#x7ED3;&#x679C;&#x662F; <code>172.19.0.2</code>&#xFF0C;&#x786E;&#x5B9E;&#x662F;&#x6211;&#x4EEC;&#x7684; IP &#x5730;&#x5740;&#xFF1B;&#x4F46;&#x662F;&#x7531;  <code>172.19.0.2</code> &#x53CD;&#x5411;&#x89E3;&#x6790;&#x7684;&#x8BDD;&#xFF0C;&#x6240;&#x5F97;&#x5230;&#x7684;&#x57DF;&#x540D;&#x786E;&#x5B9E; <code>wombat.example.com.net1</code>&#x3002;&#x591A;&#x4E86;&#x4E00;&#x4E2A; <code>.net1</code> &#x7684;&#x5C3E;&#x5DF4;&#x3002;&#x4ECE;&#x800C;&#x5BFC;&#x81F4; HBase/Hadoop &#x8FD9;&#x7C7B;&#x8F6F;&#x4EF6;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x3002;</p><p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x77E5;&#x9053;&#x53CD;&#x5411;&#x57DF;&#x540D;&#x89E3;&#x6790;&#x7684;&#x683C;&#x5F0F;&#x4E3A; <code>&lt;&#x5BB9;&#x5668;&#x540D;&gt;.&lt;&#x7F51;&#x7EDC;&#x540D;&gt;</code>&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x7F51;&#x7EDC;&#x540D;&#x8BBE;&#x4E3A;&#x57DF;&#x540D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create example.com</span><br><span class="line">$ docker run -it --rm \</span><br><span class="line">    --name wombat \</span><br><span class="line">    --hostname wombat.example.com \</span><br><span class="line">    --network example.com \</span><br><span class="line">    m3adow/nettools</span><br><span class="line">/ <span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">52: eth0@if53: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    link/ether 02:42:ac:15:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.21.0.2/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:acff:fe15:2/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ <span class="comment"># dig +short wombat.example.com</span></span><br><span class="line">172.21.0.2</span><br><span class="line">/ <span class="comment"># host 172.21.0.2</span></span><br><span class="line">2.0.21.172.in-addr.arpa domain name pointer wombat.example.com.</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x770B;&#x5230;&#xFF0C;&#x6B63;&#x5411;&#x89E3;&#x6790;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x53CD;&#x5411;&#x89E3;&#x6790;&#x4E5F;&#x5F97;&#x5230;&#x4E86; <code>wombat.example.com</code> &#x8FD9;&#x4E2A;&#x6240;&#x671F;&#x671B;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><blockquote><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x670D;&#x52A1;&#x540D;&#x3001;&#x4E3B;&#x673A;&#x540D;&#x3001;&#x5BB9;&#x5668;&#x540D;&#x8FD9;&#x7C7B;&#x53EF;&#x7528;&#x4E8E;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x4F7F;&#x7528; <strong>&#x975E; FQDN</strong>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E0D;&#x5305;&#x542B; <code>.</code> &#x7684;&#x5355;&#x4E00;&#x540D;&#x5B57;&#xFF0C;&#x5426;&#x5219;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p></blockquote><h3 id="rong-qi-zen-me-qu-su-zhu-ji-ip-a"><a href="#&#x5BB9;&#x5668;&#x600E;&#x4E48;&#x53D6;&#x5BBF;&#x4E3B;&#x673A;-IP-&#x554A;&#xFF1F;" class="headerlink" title="&#x5BB9;&#x5668;&#x600E;&#x4E48;&#x53D6;&#x5BBF;&#x4E3B;&#x673A; IP &#x554A;&#xFF1F;"></a>&#x5BB9;&#x5668;&#x600E;&#x4E48;&#x53D6;&#x5BBF;&#x4E3B;&#x673A; IP &#x554A;&#xFF1F; <a href="#rong-qi-zen-me-qu-su-zhu-ji-ip-a" class="header-anchor">#</a></h3><h4 id="dan-ji-huan-jing"><a href="#&#x5355;&#x673A;&#x73AF;&#x5883;" class="headerlink" title="&#x5355;&#x673A;&#x73AF;&#x5883;"></a>&#x5355;&#x673A;&#x73AF;&#x5883; <a href="#dan-ji-huan-jing" class="header-anchor">#</a></h4><p>&#x5982;&#x679C;&#x662F;&#x5355;&#x673A;&#x73AF;&#x5883;&#xFF0C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x5FC5;&#x7422;&#x78E8;&#x600E;&#x4E48;&#x7A81;&#x7834;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x9650;&#x5236;&#xFF0C;&#x76F4;&#x63A5;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x9001;&#x8FDB;&#x53BB;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e HOST_IP=&lt;&#x5BBF;&#x4E3B;&#x7684;IP&#x5730;&#x5740;&gt; nginx</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5BB9;&#x5668;&#x5185;&#x76F4;&#x63A5;&#x8BFB;&#x53D6; <code>HOST_IP</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5373;&#x53EF;&#x3002;</p><h4 id="ji-qun-huan-jing"><a href="#&#x96C6;&#x7FA4;&#x73AF;&#x5883;" class="headerlink" title="&#x96C6;&#x7FA4;&#x73AF;&#x5883;"></a>&#x96C6;&#x7FA4;&#x73AF;&#x5883; <a href="#ji-qun-huan-jing" class="header-anchor">#</a></h4><p>&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;<code>docker service create</code> &#x4E2D;&#x7684; <code>-e</code> &#x4EE5;&#x53CA; <code>--env-file</code>&#x662F;&#x5728;&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x65F6;&#x6307;&#x5B9A;&#x3001;&#x8BFB;&#x53D6;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x800C;&#x4E14;&#x76EE;&#x524D;&#x4E0D;&#x5B58;&#x5728; <code>dockerd -e</code> &#x9009;&#x9879;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x8FBE;&#x4E0D;&#x5230;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x6548;&#x679C;&#x3002;</p><p>&#x4E0D;&#x8FC7;&#x6709;&#x53D8;&#x901A;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5BBF;&#x4E3B;&#x4E0A;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A; <code>/etc/variables</code> &#x6587;&#x4EF6;&#xFF08;&#x540D;&#x5B57;&#x968F;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7528;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E3E;&#x4F8B;&#xFF09;&#x3002;&#x5176;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOST_IP=1.2.3.4</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D; <code>1.2.3.4</code> &#x662F;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5BBF;&#x4E3B; IP&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x7684; <code>/etc/variables</code> &#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x540C;&#x3002;</p><p>&#x800C;&#x5728;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x6302;&#x8F7D;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x7AEF;&#x672C;&#x5730;&#x6587;&#x4EF6;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name app \</span><br><span class="line">    --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/etc/variables,target=/etc/variables:ro \</span><br><span class="line">    myapp</span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E; <code>--mount</code> &#x662F;&#x53D1;&#x751F;&#x4E8E;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x662F;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7684; <code>/etc/variables</code>&#xFF0C;&#x91CC;&#x9762;&#x6240;&#x5305;&#x542B;&#x7684;&#x4E5F;&#x662F;&#x8BE5;&#x670D;&#x52A1;&#x5668;&#x7684; IP &#x5730;&#x5740;&#x3002;</p><p>&#x5728; <code>myapp</code> &#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x7684;&#x5165;&#x53E3;&#x811A;&#x672C;&#x52A0;&#x5165;&#x52A0;&#x8F7D;&#x8BE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6587;&#x4EF6;&#x7684;&#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/variables</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837; <code>app</code> &#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x62E5;&#x6709; <code>HOST_IP</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x5176;&#x503C;&#x4E3A;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x5BBF;&#x4E3B; IP&#x3002;</p><h2 id="cun-chu-wen-ti-11"><a href="#&#x5B58;&#x50A8;&#x95EE;&#x9898;-11" class="headerlink" title="&#x5B58;&#x50A8;&#x95EE;&#x9898; (11)"></a>&#x5B58;&#x50A8;&#x95EE;&#x9898; <code>(11)</code> <a href="#cun-chu-wen-ti-11" class="header-anchor">#</a></h2><h3 id="rong-qi-ci-pan-ke-yi-xian-zhi-pei-e-me"><a href="#&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F;" class="headerlink" title="&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F;"></a>&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F; <a href="#rong-qi-ci-pan-ke-yi-xian-zhi-pei-e-me" class="header-anchor">#</a></h3><p>&#x5BF9;&#x4E8E; <code>devicemapper</code>, <code>btrfs</code>, <code>zfs</code> &#x6765;&#x8BF4;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--storage-opt size=100G</code> &#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x9650;&#x5236; <code>rootfs</code> &#x7684;&#x5927;&#x5C0F;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker create -it --storage-opt size=120G fedora /bin/bash</span><br></pre></td></tr></table></figure><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/run/#/set-storage-driver-options-per-container" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/run/#/set-storage-driver-options-per-container</a></p><h3 id="rong-qi-nei-de-shu-ju-gai-bao-cun-zai-jing-xiang-li-huan-shi-wu-li-ji-li"><a href="#&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F;" class="headerlink" title="&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F;"></a>&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F; <a href="#rong-qi-nei-de-shu-ju-gai-bao-cun-zai-jing-xiang-li-huan-shi-wu-li-ji-li" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x6240;&#x8C13;&#x6570;&#x636E;&#x662F;&#x6307;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x90E8;&#x5206;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x4E0D;&#x5E94;&#x8BE5;&#x4FDD;&#x5B58;&#x4E8E;&#x955C;&#x50CF;&#x5185;&#x3002;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x57FA;&#x7840;&#x6587;&#x4EF6;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x800C;&#x53D8;&#x5316;&#x90E8;&#x5206;&#x4F7F;&#x7528;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6216;&#x8005;&#x6570;&#x636E;&#x5377;&#x6765;&#x89E3;&#x51B3;&#x3002;</p><p>&#x5EFA;&#x8BAE;&#x770B;&#x4E00;&#x4E0B;&#x5B98;&#x7F51; <code>docker volume</code> &#x7684;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank" rel="noopener">https://docs.docker.com/engine/tutorials/dockervolumes/</a></p><h3 id="kan-dao-zong-shuo-yao-bao-chi-rong-qi-wu-zhuang-tai-na-shi-me-shi-wu-zhuang-tai"><a href="#&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F;" class="headerlink" title="&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F;"></a>&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F; <a href="#kan-dao-zong-shuo-yao-bao-chi-rong-qi-wu-zhuang-tai-na-shi-me-shi-wu-zhuang-tai" class="header-anchor">#</a></h3><p>&#x8FD9;&#x91CC;&#x8BF4;&#x5230;&#x7684;&#x6709;&#x4E24;&#x4E2A;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;&#xFF1A;</p><h4 id="rong-qi-cun-chu-ceng-de-wu-zhuang-tai"><a href="#&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001;" class="headerlink" title="&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001;"></a>&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001; <a href="#rong-qi-cun-chu-ceng-de-wu-zhuang-tai" class="header-anchor">#</a></h4><p>&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x7684;&#x5B58;&#x50A8;&#x5C42;&#x662F;&#x6307;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x4E00;&#x822C;&#x662F; <code>Union FS</code>&#xFF0C;&#x5982; <code>AUFS</code>&#xFF0C;&#x6216;&#x8005;&#x662F;&#x4F7F;&#x7528;&#x5757;&#x8BBE;&#x5907;&#x7684;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#xFF08;&#x5982; <code>snapshot</code> &#xFF09;&#x8FDB;&#x884C;&#x6A21;&#x62DF;&#xFF0C;&#x5982; <code>devicemapper</code>&#x3002;</p><p><code>Union FS</code> &#x8FD9;&#x7C7B;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x5728;&#x73B0;&#x6709;&#x5B58;&#x50A8;&#x4E0A;&#xFF0C;&#x518D;&#x52A0;&#x4E00;&#x5C42;&#x6216;&#x591A;&#x5C42;&#x5B58;&#x50A8;&#xFF0C;&#x8FD9;&#x7C7B;&#x5B58;&#x50A8;&#x7684;&#x8BFB;&#x5199;&#x6027;&#x80FD;&#x5E76;&#x4E0D;&#x597D;&#x3002;&#x5E76;&#x4E14;&#x5BF9;&#x4E8E; <code>CentOS</code> &#x8FD9;&#x7C7B;&#x53EA;&#x80FD;&#x4F7F;&#x7528; <code>devicemapper</code> &#x7684;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x8BFB;&#x5199;&#x8FD8;&#x7ECF;&#x5E38;&#x51FA; bug&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>&#x5728; Docker &#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8981;&#x907F;&#x514D;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x8BFB;&#x5199;</strong>&#x3002;&#x9891;&#x7E41;&#x8BFB;&#x5199;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<code>&#x5377;</code>&#x3002;&#x9700;&#x8981;&#x6301;&#x4E45;&#x5316;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<strong>&#x547D;&#x540D;&#x5377;</strong>&#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#x3002;&#x7531;&#x4E8E;&#x547D;&#x540D;&#x5377;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x548C;&#x5BB9;&#x5668;&#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x6D88;&#x4EA1;&#x91CD;&#x5EFA;&#xFF0C;&#x5377;&#x4E0D;&#x4F1A;&#x8DDF;&#x968F;&#x6D88;&#x4EA1;&#x3002;&#x6240;&#x4EE5;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x5220;&#x4E86;&#x91CD;&#x65B0;<code>run</code>&#xFF0C;&#x800C;&#x5176;&#x6302;&#x8F7D;&#x7684;<code>&#x5377;</code>&#x5219;&#x4F1A;&#x4FDD;&#x6301;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x3002;</p><h4 id="fu-wu-ceng-mian-de-wu-zhuang-tai"><a href="#&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;" class="headerlink" title="&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;"></a>&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001; <a href="#fu-wu-ceng-mian-de-wu-zhuang-tai" class="header-anchor">#</a></h4><p>&#x4F7F;&#x7528;&#x5377;&#x6301;&#x4E45;&#x5316;&#x5BB9;&#x5668;&#x72B6;&#x6001;&#xFF0C;&#x867D;&#x7136;&#x4ECE;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x89D2;&#x5EA6;&#x770B;&#xFF0C;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4ECE;&#x670D;&#x52A1;&#x5C42;&#x9762;&#x770B;&#xFF0C;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x662F;&#x6709;&#x72B6;&#x6001;&#x7684;&#x3002;</p><p>&#x4ECE;&#x670D;&#x52A1;&#x5C42;&#x9762;&#x4E0A;&#x8BF4;&#xFF0C;&#x4E5F;&#x5B58;&#x5728;&#x65E0;&#x72B6;&#x6001;&#x670D;&#x52A1;&#x3002;&#x5C31;&#x662F;&#x8BF4;&#x670D;&#x52A1;&#x672C;&#x8EAB;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x5165;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x3002;&#x6BD4;&#x5982;&#x524D;&#x7AEF; <code>nginx</code>&#xFF0C;&#x5B83;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x5165;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF08;&#x65E5;&#x5FD7;&#x8D70;Docker&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#xFF09;&#xFF0C;&#x4E2D;&#x95F4;&#x7684; <code>php</code>, <code>node.js</code> &#x7B49;&#x670D;&#x52A1;&#xFF0C;&#x53EF;&#x80FD;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x672C;&#x5730;&#x5B58;&#x50A8;&#xFF0C;&#x5B83;&#x4EEC;&#x6240;&#x9700;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5728; <code>redis</code>, <code>mysql</code>, <code>mongodb</code> &#x4E2D;&#x4E86;&#x3002;&#x8FD9;&#x7C7B;&#x670D;&#x52A1;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x5377;&#xFF0C;&#x4E5F;&#x4E0D;&#x53D1;&#x751F;&#x672C;&#x5730;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x5220;&#x9664;&#x3001;&#x91CD;&#x542F;&#x3001;&#x4E0D;&#x4FDD;&#x5B58;&#x81EA;&#x8EAB;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x4E0D;&#x5F71;&#x54CD;&#x670D;&#x52A1;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x662F;<code>&#x65E0;&#x72B6;&#x6001;&#x670D;&#x52A1;</code>&#x3002;&#x8FD9;&#x7C7B;&#x670D;&#x52A1;&#x7531;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4EEC;&#x7684;&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x66F4;&#x65B9;&#x4FBF;&#x3002;</p><p>&#x4E4B;&#x524D;&#x6CA1;&#x6709; <code>docker volume</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6709;&#x4E9B;&#x4EBA;&#x8BF4; Docker &#x53EA;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x65E0;&#x72B6;&#x6001;&#x670D;&#x52A1;&#xFF0C;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x53EA;&#x770B;&#x5230;&#x4E86;&#x5B58;&#x50A8;&#x5C42;&#x9700;&#x6C42;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x6CA1;&#x6709; <code>docker volume</code> &#x7684;&#x6301;&#x4E45;&#x5316;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p><p>&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x8BF4;&#x6CD5;&#x5DF2;&#x7ECF;&#x4E0D;&#x6210;&#x7ACB;&#xFF0C;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x6709;&#x72B6;&#x6001;&#xFF0C;&#x72B6;&#x6001;&#x6301;&#x4E45;&#x5316;&#x7528; <code>docker volume</code>&#x3002;</p><p>&#x5F53;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x6709;&#x72B6;&#x6001;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684; <code>local</code> &#x5377;&#x9A71;&#x52A8;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;<code>&#x672C;&#x5730;&#x5B58;&#x50A8;</code>&#x8FDB;&#x884C;&#x72B6;&#x6001;&#x6301;&#x4E45;&#x5316;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5355;&#x673A;&#x670D;&#x52A1;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x518D;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x4F7F;&#x7528;<code>&#x672C;&#x5730;&#x5B58;&#x50A8;</code>&#x7684;&#x5377;&#xFF0C;&#x53EA;&#x53EF;&#x4EE5;&#x4E3A;&#x5F53;&#x524D;&#x4E3B;&#x673A;&#x63D0;&#x4F9B;&#x6301;&#x4E45;&#x5316;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x8DE8;&#x4E3B;&#x673A;&#x3002;</p><p>&#x4F46;&#x8FD9;&#x53EA;&#x662F;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684; <code>local</code> &#x9A71;&#x52A8;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528; <code>&#x672C;&#x5730;&#x5B58;&#x50A8;</code> &#x800C;&#x5DF2;&#x3002;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;/&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8DE8;&#x4E3B;&#x673A;&#x7684;&#x95EE;&#x9898;&#x3002;<code>docker volume</code> &#x81EA;&#x7136;&#x652F;&#x6301;&#x5F88;&#x591A;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x6BD4;&#x5982; <code>flocker</code>&#x3001;<code>glusterfs</code>&#x3001;<code>ceph</code>&#x3001;<code>ipfs</code> &#x7B49;&#x7B49;&#x3002;&#x5E38;&#x7528;&#x7684;&#x63D2;&#x4EF6;&#x5217;&#x8868;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins</a></p><h3 id="shu-ju-rong-qi-shu-ju-juan-ming-ming-juan-ni-ming-juan-gua-zai-mu-lu-zhe-xie-du-you-shi-me-qu-bie"><a href="#&#x6570;&#x636E;&#x5BB9;&#x5668;&#x3001;&#x6570;&#x636E;&#x5377;&#x3001;&#x547D;&#x540D;&#x5377;&#x3001;&#x533F;&#x540D;&#x5377;&#x3001;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x8FD9;&#x4E9B;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;" class="headerlink" title="&#x6570;&#x636E;&#x5BB9;&#x5668;&#x3001;&#x6570;&#x636E;&#x5377;&#x3001;&#x547D;&#x540D;&#x5377;&#x3001;&#x533F;&#x540D;&#x5377;&#x3001;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x8FD9;&#x4E9B;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;"></a>&#x6570;&#x636E;&#x5BB9;&#x5668;&#x3001;&#x6570;&#x636E;&#x5377;&#x3001;&#x547D;&#x540D;&#x5377;&#x3001;&#x533F;&#x540D;&#x5377;&#x3001;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x8FD9;&#x4E9B;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F; <a href="#shu-ju-rong-qi-shu-ju-juan-ming-ming-juan-ni-ming-juan-gua-zai-mu-lu-zhe-xie-du-you-shi-me-qu-bie" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#xFF0C;&#x6302;&#x8F7D;&#x5206;&#x4E3A;<code>&#x6302;&#x8F7D;&#x672C;&#x5730;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;</code> &#x548C; <code>&#x6302;&#x8F7D;&#x6570;&#x636E;&#x5377;(Volume)</code>&#x3002;&#x800C;<code>&#x6570;&#x636E;&#x5377;</code>&#x53C8;&#x5206;&#x4E3A;<code>&#x533F;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x548C;<code>&#x547D;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x3002;</p><p><strong>&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;</strong>&#x7684;&#x6982;&#x5FF5;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7ED1;&#x5B9A;&#x5230;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x6837;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5176;&#x5F62;&#x5F0F;&#x662F;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v /var/www:/app nginx</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6CE8;&#x610F;&#x5230; <code>-v</code> &#x7684;&#x53C2;&#x6570;&#x4E2D;&#xFF0C;&#x524D;&#x534A;&#x90E8;&#x5206;&#x662F;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;&#x5728; <code>docker run</code> &#x4E2D;&#x5FC5;&#x987B;&#x662F;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x5728; <code>docker-compose</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x56E0;&#x4E3A; <code>docker-compose</code> &#x4F1A;&#x5E2E;&#x4F60;&#x8865;&#x5168;&#x8DEF;&#x5F84;&#x3002;</p><p>&#x53E6;&#x4E00;&#x79CD;&#x5F62;&#x5F0F;&#x662F;&#x4F7F;&#x7528; <code>Docker Volume</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<strong>&#x6570;&#x636E;&#x5377;</strong>&#x3002;&#x8FD9;&#x662F;&#x5F88;&#x591A;&#x770B;<em>&#x53E4;&#x8463;&#x4E66;</em>&#x7684;&#x4EBA;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x6982;&#x5FF5;&#xFF0C;<strong>&#x4E0D;&#x8981;&#x8DDF;&#x6570;&#x636E;&#x5BB9;&#x5668;&#xFF08;Data Container&#xFF09;&#x5F04;&#x6DF7;</strong>&#x3002;&#x6570;&#x636E;&#x5377;&#x662F; Docker &#x5F15;&#x64CE;&#x7EF4;&#x62A4;&#x7684;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528; <code>docker volume create</code> &#x547D;&#x4EE4;&#x521B;&#x5EFA;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5377;&#x9A71;&#x52A8;&#x652F;&#x6301;&#x591A;&#x79CD;&#x5B58;&#x50A8;&#x65B9;&#x6848;&#x3002;&#x5176;&#x9ED8;&#x8BA4;&#x7684;&#x9A71;&#x52A8;&#x4E3A; <code>local</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x672C;&#x5730;&#x5377;&#x9A71;&#x52A8;&#x3002;&#x672C;&#x5730;&#x9A71;&#x52A8;&#x652F;&#x6301;<strong>&#x547D;&#x540D;&#x5377;</strong>&#x548C;<strong>&#x533F;&#x540D;&#x5377;</strong>&#x3002;</p><p>&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x547D;&#x540D;&#x5377;&#x5C31;&#x662F;&#x6709;&#x540D;&#x5B57;&#x7684;&#x5377;&#xFF0C;&#x4F7F;&#x7528; <code>docker volume create --name xxx</code> &#x5F62;&#x5F0F;&#x521B;&#x5EFA;&#x5E76;&#x547D;&#x540D;&#x7684;&#x5377;&#xFF1B;&#x800C;&#x533F;&#x540D;&#x5377;&#x5C31;&#x662F;&#x6CA1;&#x540D;&#x5B57;&#x7684;&#x5377;&#xFF0C;&#x4E00;&#x822C;&#x662F; <code>docker run -v /data</code> &#x8FD9;&#x79CD;&#x4E0D;&#x6307;&#x5B9A;&#x5377;&#x540D;&#x7684;&#x65F6;&#x5019;&#x6240;&#x4EA7;&#x751F;&#xFF0C;&#x6216;&#x8005; <code>Dockerfile</code> &#x91CC;&#x9762;&#x7684;&#x5B9A;&#x4E49;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7684;&#x3002;</p><p>&#x6709;&#x540D;&#x5B57;&#x7684;&#x5377;&#xFF0C;&#x5728;&#x7528;&#x8FC7;&#x4E00;&#x6B21;&#x540E;&#xFF0C;&#x4EE5;&#x540E;&#x6302;&#x8F7D;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x540D;&#x5B57;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x822C;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x6570;&#x636E;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x5377;&#x4FDD;&#x5B58;&#x3002;</p><p>&#x800C;&#x533F;&#x540D;&#x5377;&#x5219;&#x662F;&#x968F;&#x7740;&#x5BB9;&#x5668;&#x5EFA;&#x7ACB;&#x800C;&#x5EFA;&#x7ACB;&#xFF0C;&#x968F;&#x7740;&#x5BB9;&#x5668;&#x6D88;&#x4EA1;&#x800C;&#x6DF9;&#x6CA1;&#x4E8E;&#x5377;&#x5217;&#x8868;&#x4E2D;&#xFF08;&#x5BF9;&#x4E8E; <code>docker run</code> &#x533F;&#x540D;&#x5377;&#x4E0D;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x5220;&#x9664;&#xFF09;&#x3002;<strong>&#x5BF9;&#x4E8E;&#x4E8C;&#x4EE3; Swarm &#x670D;&#x52A1;&#x800C;&#x8A00;&#xFF0C;&#x533F;&#x540D;&#x5377;&#x4F1A;&#x968F;&#x7740;&#x670D;&#x52A1;&#x5220;&#x9664;&#x800C;&#x81EA;&#x52A8;&#x5220;&#x9664;&#x3002;</strong> &#x56E0;&#x6B64;&#x533F;&#x540D;&#x5377;&#x53EA;&#x5B58;&#x653E;&#x65E0;&#x5173;&#x7D27;&#x8981;&#x7684;&#x4E34;&#x65F6;&#x6570;&#x636E;&#xFF0C;&#x968F;&#x7740;&#x5BB9;&#x5668;&#x6D88;&#x4EA1;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5C06;&#x5931;&#x53BB;&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x3002;</p><p>&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x53EB;&#x6570;&#x636E;&#x5BB9;&#x5668; (Data Container) &#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4F7F;&#x7528; <code>--volumes-from</code> &#x7684;&#x4E1C;&#x897F;&#x3002;&#x8FD9;&#x65E9;&#x5C31;&#x4E0D;&#x7528;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x770B;&#x4E86;&#x4E66;&#x8FD8;&#x5728;&#x8BF4;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x90A3;&#x8BF4;&#x660E;&#x4E66;&#x5DF2;&#x7ECF;&#x8FC7;&#x65F6;&#x4E86;&#x3002;&#x6309;&#x7167;&#x4ECA;&#x5929;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x8FD9;&#x7C7B;&#x6570;&#x636E;&#x5BB9;&#x5668;&#xFF0C;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x6302;&#x4E86;&#x4E2A;&#x533F;&#x540D;&#x5377;&#x7684;&#x5BB9;&#x5668;&#x7F62;&#x4E86;&#x3002;</p><p>&#x5728; <code>Dockerfile</code> &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6302;&#x8F7D;&#xFF0C;&#x662F;&#x6307; <code>&#x533F;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x3002;<code>Dockerfile</code> &#x4E2D;&#x6307;&#x5B9A; <code>VOLUME</code> &#x7684;&#x76EE;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x67D0;&#x4E2A;&#x8DEF;&#x5F84;&#x786E;&#x5B9A;&#x4E3A;&#x5377;&#x3002;</p><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x6309;&#x7167;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x8981;&#x6C42;&#xFF0C;<strong>&#x4E0D;&#x5E94;&#x8BE5;&#x5728;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x5185;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5199;&#x5165;&#x64CD;&#x4F5C;</strong>&#xFF0C;&#x6240;&#x6709;&#x5199;&#x5165;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x5377;&#x3002;&#x5982;&#x679C;&#x5B9A;&#x5236;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x67D0;&#x4E9B;&#x76EE;&#x5F55;&#x4F1A;&#x53D1;&#x751F;&#x9891;&#x7E41;&#x5927;&#x91CF;&#x7684;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x4E48;<strong>&#x4E3A;&#x4E86;&#x907F;&#x514D;</strong>&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x7531;&#x4E8E;&#x7528;&#x6237;&#x758F;&#x5FFD;&#x800C;&#x5FD8;&#x8BB0;&#x6307;&#x5B9A;&#x5377;&#xFF0C;&#x5BFC;&#x81F4;&#x5BB9;&#x5668;&#x53D1;&#x751F;&#x5B58;&#x50A8;&#x5C42;&#x5199;&#x5165;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x4F7F;&#x7528; <code>VOLUME</code> &#x6765;&#x6307;&#x5B9A;&#x67D0;&#x4E9B;&#x76EE;&#x5F55;&#x4E3A;&#x533F;&#x540D;&#x5377;&#x3002;&#x8FD9;&#x6837;&#x5373;&#x4F7F;&#x7528;&#x6237;&#x5FD8;&#x8BB0;&#x4E86;&#x6307;&#x5B9A;&#x5377;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x4E0D;&#x826F;&#x7684;&#x540E;&#x679C;&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8986;&#x76D6;&#x3002;&#x901A;&#x8FC7; <code>docker run</code> &#x7684; <code>-v</code> &#x53C2;&#x6570;&#x6216;&#x8005; <code>docker-compose.yml</code> &#x7684; <code>volumes</code> &#x6307;&#x5B9A;&#x3002;&#x4F7F;&#x7528;<code>&#x547D;&#x540D;&#x5377;</code>&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;<code>&#x547D;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x7684;&#x540D;&#x5B57;&#x6765;&#x6307;&#x5B9A;&#x6302;&#x8F7D;&#xFF0C;&#x5171;&#x4EAB;&#x5176;&#x5185;&#x5BB9;&#xFF08;&#x4E0D;&#x8FC7;<strong>&#x8981;&#x6CE8;&#x610F;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x7684;&#x7ADE;&#x4E89;&#x95EE;&#x9898;</strong>&#xFF09;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;<code>Dockerfile</code> &#x4E2D;&#x8BF4; <code>VOLUME /data</code>&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x76F4;&#x63A5; <code>docker run</code>&#xFF0C;&#x5176; <code>/data</code> &#x5C31;&#x4F1A;&#x88AB;&#x6302;&#x8F7D;&#x4E3A;&#x533F;&#x540D;&#x5377;&#xFF0C;&#x5411; <code>/data</code> &#x5199;&#x5165;&#x7684;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x5199;&#x5165;&#x5230;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#xFF0C;&#x800C;&#x662F;&#x5199;&#x5165;&#x5230;&#x4E86;&#x533F;&#x540D;&#x5377;&#x4E2D;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x8FD0;&#x884C;&#x65F6; <code>docker run -v mydata:/data</code>&#xFF0C;&#x8FD9;&#x5C31;&#x8986;&#x76D6;&#x4E86; <code>/data</code> &#x7684;&#x6302;&#x8F7D;&#x8BBE;&#x7F6E;&#xFF0C;&#x8981;&#x6C42;&#x5C06; <code>/data</code> &#x6302;&#x8F7D;&#x5230;&#x540D;&#x4E3A; <code>mydata</code> &#x7684;&#x547D;&#x540D;&#x5377;&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x8BF4; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>VOLUME</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x5C42;&#x4FDD;&#x9669;&#xFF0C;&#x786E;&#x4FDD;&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x7684;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4E0D;&#x5411;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x5185;&#x8FDB;&#x884C;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;</p><p>&#x6570;&#x636E;&#x5377;&#x9ED8;&#x8BA4;&#x53EF;&#x80FD;&#x4F1A;&#x4FDD;&#x5B58;&#x4E8E; <code>/var/lib/docker/volumes</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x4E00;&#x822C;&#x4E0D;&#x9700;&#x8981;&#x3001;&#x4E5F;<strong>&#x4E0D;&#x5E94;&#x8BE5;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;</strong>&#x3002;</p><h3 id="juan-he-gua-zai-mu-lu-you-shi-me-qu-bie"><a href="#&#x5377;&#x548C;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;" class="headerlink" title="&#x5377;&#x548C;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;"></a>&#x5377;&#x548C;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F; <a href="#juan-he-gua-zai-mu-lu-you-shi-me-qu-bie" class="header-anchor">#</a></h3><p>&#x5377; (Docker Volume) &#x662F;&#x53D7;&#x63A7;&#x5B58;&#x50A8;&#xFF0C;&#x662F;&#x7531; Docker &#x5F15;&#x64CE;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x7EF4;&#x62A4;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x4F7F;&#x7528;&#x5377;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x5FC5;&#x5904;&#x7406; <code>uid</code>&#x3001;<code>SELinux</code> &#x7B49;&#x5404;&#x79CD;&#x6743;&#x9650;&#x95EE;&#x9898;&#xFF0C;Docker &#x5F15;&#x64CE;&#x5728;&#x5EFA;&#x7ACB;&#x5377;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x5B89;&#x5168;&#x89C4;&#x5219;&#xFF0C;&#x4EE5;&#x53CA;&#x6839;&#x636E;&#x6302;&#x8F7D;&#x70B9;&#x8C03;&#x6574;&#x6743;&#x9650;&#x3002;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7EDF;&#x4E00;&#x5217;&#x8868;&#x3001;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x9664;&#x4E86;&#x672C;&#x5730;&#x5377;&#x5916;&#xFF0C;&#x8FD8;&#x652F;&#x6301;&#x7F51;&#x7EDC;&#x5377;&#x3001;&#x5206;&#x5E03;&#x5F0F;&#x5377;&#x3002;</p><p>&#x800C;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x90A3;&#x5C31;&#x6CA1;&#x4EBA;&#x7BA1;&#x4E86;&#xFF0C;&#x5C5E;&#x4E8E;&#x7528;&#x6237;&#x81EA;&#x884C;&#x7EF4;&#x62A4;&#x3002;&#x4F60;&#x5C31;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x5904;&#x7406;&#x6240;&#x6709;&#x6743;&#x9650;&#x95EE;&#x9898;&#x3002;&#x7279;&#x522B;&#x662F;&#x5728; <code>CentOS</code> &#x4E0A;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x78B0;&#x5230; <code>Permission Denied</code>&#xFF0C;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5377;&#xFF0C;&#x800C;&#x662F;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x5BF9; SELinux &#x5B89;&#x5168;&#x6743;&#x9650;&#x4E00;&#x65E0;&#x6240;&#x77E5;&#x5BFC;&#x81F4;&#x3002;</p><h3 id="wei-shi-me-bang-ding-liao-su-zhu-de-wen-jian-dao-rong-qi-su-zhu-xiu-gai-liao-wen-jian-rong-qi-nei-kan-dao-de-huan-shi-jiu-de-nei-rong-a"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x7ED1;&#x5B9A;&#x4E86;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x5BBF;&#x4E3B;&#x4FEE;&#x6539;&#x4E86;&#x6587;&#x4EF6;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x770B;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x65E7;&#x7684;&#x5185;&#x5BB9;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x7ED1;&#x5B9A;&#x4E86;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x5BBF;&#x4E3B;&#x4FEE;&#x6539;&#x4E86;&#x6587;&#x4EF6;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x770B;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x65E7;&#x7684;&#x5185;&#x5BB9;&#x554A;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x7ED1;&#x5B9A;&#x4E86;&#x5BBF;&#x4E3B;&#x7684;&#x6587;&#x4EF6;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x5BBF;&#x4E3B;&#x4FEE;&#x6539;&#x4E86;&#x6587;&#x4EF6;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x770B;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x65E7;&#x7684;&#x5185;&#x5BB9;&#x554A;&#xFF1F; <a href="#wei-shi-me-bang-ding-liao-su-zhu-de-wen-jian-dao-rong-qi-su-zhu-xiu-gai-liao-wen-jian-rong-qi-nei-kan-dao-de-huan-shi-jiu-de-nei-rong-a" class="header-anchor">#</a></h3><p>&#x5728;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x5185;&#x5BB9;&#x7684;&#x5F62;&#x5F0F;&#x4E2D;&#xFF0C;&#x6709;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5C31;&#x662F;<strong>&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x6587;&#x4EF6;</strong>&#xFF0C;&#x65E2;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v <span class="variable">$PWD</span>/myapp.ini:/app/app.ini myapp</span><br></pre></td></tr></table></figure><p>&#x5728; <code>myapp.ini</code> &#x6587;&#x4EF6;<strong>&#x4E0D;&#x53D1;&#x751F;&#x6539;&#x53D8;</strong>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x7ED1;&#x5B9A;&#x662F;&#x548C;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x6027;&#x8D28;&#x4E00;&#x6837;&#xFF0C;&#x540C;&#x6837;&#x662F;&#x5C06;&#x5BBF;&#x4E3B;&#x6587;&#x4EF6;&#x7ED1;&#x5B9A;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x4E00;&#x65E6;&#x6587;&#x4EF6;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x60C5;&#x51B5;&#x5219;&#x6709;&#x4E0D;&#x540C;&#x3002;</p><p>&#x7B80;&#x5355;&#x7684;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#xFF0C;&#x6BD4;&#x5982; <code>echo &quot;name = jessie&quot; &gt;&gt; myapp.ini</code>&#xFF0C;&#x8FD9;&#x7C7B;&#x4FEE;&#x6539;&#x4F9D;&#x65E7;&#x8FD8;&#x662F;&#x539F;&#x6765;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5BBF;&#x4E3B;&#xFF08;&#x6216;&#x5BB9;&#x5668;&#xFF09;&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x7684;&#x6539;&#x52A8;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x662F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7684;&#x3002;</p><p>&#x800C;&#x590D;&#x6742;&#x7684;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x4F7F;&#x7528; <code>vim</code>&#xFF0C;&#x6216;&#x8005;&#x5176;&#x5B83;&#x7F16;&#x8F91;&#x5668;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x65B9;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x770B;&#x4E0D;&#x5230;&#x3002;</p><p>&#x5176;&#x539F;&#x56E0;&#x662F;&#x8FD9;&#x7C7B;&#x7F16;&#x8F91;&#x5668;&#x5728;&#x4FDD;&#x5B58;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x91C7;&#x7528;&#x4E00;&#x79CD;&#x907F;&#x514D;&#x5199;&#x5165;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D1;&#x751F;&#x6545;&#x969C;&#x800C;&#x5BFC;&#x81F4;&#x6587;&#x4EF6;&#x4E22;&#x5931;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x65E2;&#x5148;&#x628A;&#x5185;&#x5BB9;&#x5199;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x4E2D;&#x53BB;&#xFF0C;&#x5199;&#x597D;&#x4E86;&#x540E;&#xFF0C;&#x518D;&#x5220;&#x9664;&#x65E7;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x65B0;&#x6587;&#x4EF6;&#x6539;&#x540D;&#x4E3A;&#x65E7;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x4ECE;&#x800C;&#x5B8C;&#x6210;&#x4FDD;&#x5B58;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x4ECE;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x867D;&#x7136;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x5B57;&#x548C;&#x8FC7;&#x53BB;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x4E86;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x867D;&#x7136;&#x662F;&#x540C;&#x540D;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x65E7;&#x7684;&#x6587;&#x4EF6;&#x7684; <code>inode</code> &#x548C;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x7684; <code>inode</code> &#x4E0D;&#x540C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls -i</span><br><span class="line">268541 hello.txt</span><br><span class="line">$ vi hello.txt</span><br><span class="line">$ ls -i</span><br><span class="line">268716 hello.txt</span><br></pre></td></tr></table></figure><p>&#x5982;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x7ECF;&#x8FC7; <code>vim</code> &#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x540E;&#xFF0C;<code>inode</code> &#x4ECE; <code>268541</code> &#x53D8;&#x4E3A;&#x4E86; <code>268716</code>&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x521A;&#x624D;&#x8BF4;&#x7684;&#xFF0C;&#x540D;&#x5B57;&#x8FD8;&#x662F;&#x90A3;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x6587;&#x4EF6;&#x5DF2;&#x4E0D;&#x662F;&#x539F;&#x6765;&#x7684;&#x6587;&#x4EF6;&#x4E86;&#x3002;</p><p>&#x800C; Docker &#x7684; <strong>&#x7ED1;&#x5B9A;</strong>&#x5BBF;&#x4E3B;&#x6587;&#x4EF6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5728;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x773C;&#x91CC;&#xFF0C;&#x9488;&#x5BF9;&#x7684;&#x662F; <code>inode</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6587;&#x4EF6;&#x540D;&#x3002;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x5185;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x4F9D;&#x65E7;&#x662F;&#x4E4B;&#x524D;&#x65E7;&#x7684; <code>inode</code> &#x5BF9;&#x5E94;&#x7684;&#x90A3;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x65E7;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x8FD9;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x90A3;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5728;&#x5BBF;&#x4E3B;&#x5185;&#x4FEE;&#x6539;&#x7ED1;&#x5B9A;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x7ED3;&#x679C;&#x53D1;&#x73B0;&#x5BB9;&#x5668;&#x5185;&#x770B;&#x4E0D;&#x5230;&#x6539;&#x53D8;&#xFF0C;&#x5176;&#x539F;&#x56E0;&#x5C31;&#x5728;&#x4E8E;<strong>&#x5BBF;&#x4E3B;&#x7684;&#x90A3;&#x4E2A;&#x6587;&#x4EF6;&#x5DF2;&#x4E0D;&#x662F;&#x539F;&#x6765;&#x7684;&#x6587;&#x4EF6;&#x4E86;</strong>&#x1F602;&#x3002;</p><p>&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x53EF;&#x80FD;&#x6539;&#x53D8;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;<strong>&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x662F;&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;</strong>&#xFF0C;&#x8FD9;&#x6837;&#x53EA;&#x8981;&#x76EE;&#x5F55;&#x4E0D;&#x8DD1;&#xFF0C;&#x91CC;&#x9762;&#x6587;&#x4EF6;&#x7231;&#x548B;&#x6539;&#x5C31;&#x548B;&#x6539;&#x1F601;&#x3002;</p><h3 id="duo-ge-docker-rong-qi-zhi-jian-gong-xiang-shu-ju-zen-me-ban-nfs"><a href="#&#x591A;&#x4E2A;-Docker-&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS-&#xFF1F;" class="headerlink" title="&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS &#xFF1F;"></a>&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS &#xFF1F; <a href="#duo-ge-docker-rong-qi-zhi-jian-gong-xiang-shu-ju-zen-me-ban-nfs" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BBF;&#x4E3B;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5377;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x7A0B;&#x5E8F;&#x4E0A;&#x8981;&#x5904;&#x7406;&#x597D;&#x5E76;&#x53D1;&#x95EE;&#x9898;&#x3002;</p><p>&#x5982;&#x679C;&#x662F;&#x4E0D;&#x540C;&#x5BBF;&#x4E3B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x5377;&#x9A71;&#x52A8;&#xFF0C;&#x8BA9;&#x5206;&#x5E03;&#x5728;&#x4E0D;&#x540C;&#x5BBF;&#x4E3B;&#x7684;&#x5BB9;&#x5668;&#x90FD;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x5982;S3&#x4E4B;&#x7C7B;&#xFF1A;</p><p><a href="https://docs.docker.com/engine/extend/plugins/#volume-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/plugins/#volume-plugins</a></p><h3 id="ji-ran-yi-ge-rong-qi-yi-ge-ying-yong-na-me-wo-xiang-zai-gai-rong-qi-zhong-yong-ji-hua-ren-wu-cron-zen-me-ban"><a href="#&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;-cron-&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1; cron &#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1; <code>cron</code> &#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#ji-ran-yi-ge-rong-qi-yi-ge-ying-yong-na-me-wo-xiang-zai-gai-rong-qi-zhong-yong-ji-hua-ren-wu-cron-zen-me-ban" class="header-anchor">#</a></h3><p><code>cron</code> &#x5176;&#x5B9E;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x53E6;&#x8D77;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6765;&#x8FDB;&#x884C;&#xFF0C;&#x5982;&#x9700;&#x8BBF;&#x95EE;&#x8BE5;&#x5E94;&#x7528;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x8BE5;&#x5E94;&#x7528;&#x7684;&#x6570;&#x636E;&#x5377;&#x5373;&#x53EF;&#x3002;&#x800C; <code>cron</code> &#x7684;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;<code>cron</code> &#x4EE5;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#x5373;&#x53EF;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6709;&#x4E2A; <code>python</code> &#x811A;&#x672C;&#x53EF;&#x4EE5;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x6784;&#x5EFA;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p><p>&#x9996;&#x5148;&#x57FA;&#x4E8E; <code>python</code> &#x7684;&#x955C;&#x50CF;&#x5B9A;&#x5236;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.5</span>.<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get install -y cron \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get autoremove -y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./cronpy /etc/cron.d/cronpy</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;cron&quot;</span>, <span class="string">&quot;-f&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D;&#x6240;&#x63D0;&#x53CA;&#x7684; <code>cronpy</code> &#x5C31;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BA1;&#x5212;&#x6267;&#x884C;&#x7684; <code>cron</code> &#x811A;&#x672C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * root /app/task.py &gt;&gt; /var/<span class="built_in">log</span>/task.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8FD9;&#x4E2A;&#x8BA1;&#x5212;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5B9A;&#x65F6;&#x6267;&#x884C; <code>/app/task.py</code> &#x6587;&#x4EF6;&#xFF0C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x5728; <code>/var/log/task.log</code> &#x4E2D;&#x3002;&#x8FD9;&#x4E2A; <code>task.py</code> &#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x53EA;&#x662F;&#x8F93;&#x51FA;&#x4E2A;&#x65F6;&#x95F4;&#x800C;&#x5DF2;&#x3002;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">print(<span class="string">&quot;Cron job has run at {0} with environment variable &quot;</span>.format(str(datetime.now())))</span><br></pre></td></tr></table></figure><p>&#x8FD9; <code>task.py</code> &#x53EF;&#x4EE5;&#x5728;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x653E;&#x8FDB;&#x53BB;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x4E3E;&#x4F8B;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x6784;&#x5EFA;&#x955C;&#x50CF;</span></span><br><span class="line">docker build -t cronjob:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FD0;&#x884C;&#x955C;&#x50CF;</span></span><br><span class="line">docker run \</span><br><span class="line">    --name cronjob \</span><br><span class="line">    -d \</span><br><span class="line">    -v $(<span class="built_in">pwd</span>)/task.py:/app/task.py \</span><br><span class="line">    -v $(<span class="built_in">pwd</span>)/<span class="built_in">log</span>/:/var/<span class="built_in">log</span>/ \</span><br><span class="line">    cronjob:latest</span><br></pre></td></tr></table></figure><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E94;&#x8BE5;&#x5728;&#x6784;&#x5EFA;&#x4E3B;&#x673A;&#x4E0A;&#x8D4B;&#x4E88; <code>task.py</code> &#x6587;&#x4EF6;&#x53EF;&#x6267;&#x884C;&#x6743;&#x9650;&#x3002;</p><h3 id="ru-he-chu-shi-hua-juan"><a href="#&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;&#x5377;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;&#x5377;&#xFF1F;"></a>&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;&#x5377;&#xFF1F; <a href="#ru-he-chu-shi-hua-juan" class="header-anchor">#</a></h3><p>&#x5377;&#xFF08;<code>Volume</code>&#xFF09;&#xFF0C;&#x662F;&#x7528;&#x4E8E;&#x52A8;&#x6001;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5176;&#x5185;&#x5B58;&#x50A8;&#x7684;&#x90FD;&#x662F;&#x52A8;&#x6001;&#x6570;&#x636E;&#xFF0C;&#x8FD0;&#x884C;&#x65F6;&#x4F1A;&#x53D8;&#x5316;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x91CC;&#x9762;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#x91CC;&#x9762;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8FDB;&#x884C;&#x3002;&#x6216;&#x8005;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x52A0;&#x5165;&#x521D;&#x59CB;&#x5316;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x6BD4;&#x5982; <code>mysql</code> &#x955C;&#x50CF;&#x4E2D;&#x7684;&#x521D;&#x59CB;&#x5316;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x811A;&#x672C;&#xFF1B;&#x6216;&#x8005;&#x81EA;&#x5DF1;&#x5355;&#x72EC;&#x5236;&#x4F5C;&#x7EAF;&#x7CB9;&#x7528;&#x4E8E;&#x521D;&#x59CB;&#x5316;&#x5377;&#x7528;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5355;&#x72EC;&#x4E00;&#x6B21;&#x6027;&#x8FD0;&#x884C;&#x4EE5;&#x5C06;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x704C;&#x5165;&#x5377;&#x4E2D;&#x3002;</p><p>&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x9700;&#x8981;&#x4E2A;&#x5377; <code>mydata</code>&#xFF0C;&#x7136;&#x540E;&#x91CC;&#x9762;&#x9700;&#x8981;&#x6709;&#x4E2A; <code>hello.txt</code> &#x6587;&#x4EF6;&#x662F;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x5426;&#x5219;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5C31;&#x8981;&#x51FA;&#x5927;&#x4E8B;&#x513F;&#x4E86;&#x2026;&#x2026;&#xFF08;&#x8FD9;&#x9700;&#x6C42;&#x5F88;&#x50BB;&#x6211;&#x77E5;&#x9053;&#x2026;&#x2026;&#x1F605;&#x597D;&#x5427;&#xFF0C;&#x5047;&#x8BBE;&#x5982;&#x6B64;&#xFF09;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x5148;&#x6709;&#x8FD9;&#x4E2A;&#x5377;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create --name mydata</span><br></pre></td></tr></table></figure><p>&#x90A3;&#x600E;&#x4E48;&#x628A;&#x8FD9;&#x4E2A;&#x8D85;&#x91CD;&#x8981;&#x7684; <code>hello.txt</code> &#x6587;&#x4EF6;&#x653E;&#x5165;&#x5377;&#x4E2D;&#x5462;&#xFF1F;&#x6709;&#x51E0;&#x79CD;&#x529E;&#x6CD5;&#x3002;</p><h4 id="zheng-chang-gua-zai-gai-mydata-juan-ran-hou-docker-cp-jin-qu"><a href="#&#x6B63;&#x5E38;&#x6302;&#x8F7D;&#x8BE5;-mydata-&#x5377;&#xFF0C;&#x7136;&#x540E;-docker-cp-&#x8FDB;&#x53BB;" class="headerlink" title="&#x6B63;&#x5E38;&#x6302;&#x8F7D;&#x8BE5; mydata &#x5377;&#xFF0C;&#x7136;&#x540E; docker cp &#x8FDB;&#x53BB;"></a>&#x6B63;&#x5E38;&#x6302;&#x8F7D;&#x8BE5; <code>mydata</code> &#x5377;&#xFF0C;&#x7136;&#x540E; <code>docker cp</code> &#x8FDB;&#x53BB; <a href="#zheng-chang-gua-zai-gai-mydata-juan-ran-hou-docker-cp-jin-qu" class="header-anchor">#</a></h4><p>&#x8FD9;&#x662F;&#x4E2A;&#x5F88;&#x50BB;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5E76;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E; <code>hello.txt</code> &#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name web -v mydata:/data nginx</span><br><span class="line">$ docker cp ./hello.txt web:/data/</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x662F;&#x5148;&#x8BA9;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#xFF0C;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x518D;&#x628A;&#x6240;&#x9700;&#x6570;&#x636E;&#x5BFC;&#x5165;&#x5377;&#x91CC;&#x9762;&#x53BB;&#x3002;&#x4EE5;&#x540E;&#x5BB9;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>/data/hello.txt</code> &#x6587;&#x4EF6;&#x4E86;&#x3002;</p><p>&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x662F;&#x4E25;&#x91CD;&#x4F9D;&#x8D56;&#x4E8E;&#x8FD9;&#x4E2A; <code>hello.txt</code> &#x6587;&#x4EF6;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x5C31;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#x3002;&#x5BB9;&#x5668;&#x4F1A;&#x56E0;&#x4E3A; <code>hello.txt</code> &#x6587;&#x4EF6;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x800C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x5BFC;&#x81F4;&#x6839;&#x672C;&#x6CA1;&#x6709; <code>docker cp</code> &#x7684;&#x673A;&#x4F1A;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D8;&#x901A;&#x4E00;&#x4E0B;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm \</span><br><span class="line">    -v <span class="variable">$PWD</span>:/<span class="built_in">source</span> \</span><br><span class="line">    -v mydata:/data \</span><br><span class="line">    busybox \</span><br><span class="line">    cp /<span class="built_in">source</span>/hello.txt /data/</span><br><span class="line">$ docker run -d --name web -v mydata:/data nginx</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5148;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A; <code>busybox</code> &#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x6302;&#x8F7D;&#x8981;&#x590D;&#x5236;&#x7684;&#x6E90;&#x4EE5;&#x53CA;&#x76EE;&#x6807;&#x7684; <code>mydata</code> &#x5377;&#xFF0C;&#x7136;&#x540E;&#x7528; <code>cp</code> &#x547D;&#x4EE4;&#x5C06; <code>hello.txt</code> &#x590D;&#x5236;&#x5230; <code>mydata</code> &#x4E2D;&#x53BB;&#x3002;&#x6570;&#x636E;&#x5BFC;&#x5165;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6B63;&#x5F0F;&#x6302;&#x8F7D; <code>mydata</code> &#x5377;&#x5230;&#x6B63;&#x5F0F;&#x7684;&#x5BB9;&#x5668;&#x4E0A;&#x5E76;&#x542F;&#x52A8;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4E25;&#x91CD;&#x4F9D;&#x8D56; <code>/data/hello.txt</code> &#x7684;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x987A;&#x5229;&#x8FD0;&#x884C;&#x4E86;&#x3002;</p><h4 id="zhuan-men-zhi-zuo-chu-shi-hua-jing-xiang"><a href="#&#x4E13;&#x95E8;&#x5236;&#x4F5C;&#x521D;&#x59CB;&#x5316;&#x955C;&#x50CF;" class="headerlink" title="&#x4E13;&#x95E8;&#x5236;&#x4F5C;&#x521D;&#x59CB;&#x5316;&#x955C;&#x50CF;"></a>&#x4E13;&#x95E8;&#x5236;&#x4F5C;&#x521D;&#x59CB;&#x5316;&#x955C;&#x50CF; <a href="#zhuan-men-zhi-zuo-chu-shi-hua-jing-xiang" class="header-anchor">#</a></h4><p>&#x624B;&#x52A8;&#x7684;&#x53BB;&#x6267;&#x884C; <code>docker cp</code>&#xFF0C;&#x6216;&#x8005; <code>docker run ... cp ...</code> &#x5E76;&#x4E0D;&#x662F;&#x5F88;&#x6B63;&#x89C4;&#x3002;&#x53EF;&#x4EE5;&#x5199;&#x4E2A;&#x811A;&#x672C;&#x8BA9;&#x4E00;&#x5207;&#x90FD;&#x6807;&#x51C6;&#x5316;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x9664;&#x4E86;&#x6D41;&#x7A0B;&#x5916;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x7684;&#x7248;&#x672C;&#x5FC5;&#x987B;&#x662F;&#x6240;&#x671F;&#x671B;&#x7684;&#xFF0C;&#x5426;&#x5219;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x9519;&#x8BEF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x4F1A;&#x8BA9;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x8FBE;&#x4E0D;&#x5230;&#x9884;&#x671F;&#x7684;&#x6548;&#x679C;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x529E;&#x6CD5;&#x662F;&#x4E13;&#x95E8;&#x5236;&#x4F5C;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x5377;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x505A;&#x6CD5;&#x4E5F;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x5728; CI/CD &#x6D41;&#x7A0B;&#x4E2D;&#x5BF9;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x786E;&#x8BA4;&#x3002;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> hello.txt /<span class="built_in">source</span>/</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /data</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;cp&quot;</span>, <span class="string">&quot;/source/hello.txt&quot;</span>, <span class="string">&quot;/data/&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x7684;&#x955C;&#x50CF;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x751F;&#x5B58;&#x76EE;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x6302;&#x8F7D; <code>mydata</code> &#x5377;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x6570;&#x636E;&#x5BFC;&#x5165;&#x8FDB;&#x53BB;&#x3002;&#x5047;&#x8BBE;&#x6784;&#x5EFA;&#x597D;&#x7684;&#x955C;&#x50CF;&#x540D;&#x4E3A; <code>volume-prepare</code>&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x5BFC;&#x5165;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -v mydata:/data volume-prepare</span><br></pre></td></tr></table></figure><h4 id="zai-jing-xiang-de-dockerfile-zhi-zuo-zhong-jia-ru-chu-shi-hua-bu-fen"><a href="#&#x5728;&#x955C;&#x50CF;&#x7684;-Dockerfile-&#x5236;&#x4F5C;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x521D;&#x59CB;&#x5316;&#x90E8;&#x5206;" class="headerlink" title="&#x5728;&#x955C;&#x50CF;&#x7684; Dockerfile &#x5236;&#x4F5C;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x521D;&#x59CB;&#x5316;&#x90E8;&#x5206;"></a>&#x5728;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code> &#x5236;&#x4F5C;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x521D;&#x59CB;&#x5316;&#x90E8;&#x5206; <a href="#zai-jing-xiang-de-dockerfile-zhi-zuo-zhong-jia-ru-chu-shi-hua-bu-fen" class="header-anchor">#</a></h4><p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x95EE;&#x7B54;&#x4E2D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x5230;&#xFF0C;&#x5B98;&#x65B9;&#x955C;&#x50CF; <code>mysql</code> &#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6765;&#x6DFB;&#x52A0;&#x521D;&#x59CB;&#x5316;&#x811A;&#x672C;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x5B9A;&#x5236;&#x7684;&#x521D;&#x59CB;&#x5316;&#x811A;&#x672C;&#x3002;</p><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5C06; <code>hello.txt</code> &#x5728;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x52A0;&#x5165;&#x5230; <code>mydata</code> &#x5377;&#x4E2D;&#x53BB;&#x3002;</p><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5199;&#x4E00;&#x4E2A;&#x8FDB;&#x5165;&#x70B9;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x7528;&#x4EE5;&#x786E;&#x4FDD;&#x5728;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x8FD0;&#x884C;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x5C06;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x6570;&#x636E;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;/data/hello.txt&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    cp /<span class="built_in">source</span>/hello.txt /data/</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure><p>&#x540D;&#x4E3A; <code>entrypoint.sh</code> &#x7684;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5224;&#x65AD;&#x4E00;&#x4E0B; <code>/data/hello.txt</code> &#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#x3002;&#x521D;&#x59CB;&#x5316;&#x884C;&#x4E3A;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C06;&#x5B9E;&#x73B0;&#x51C6;&#x5907;&#x597D;&#x7684; <code>/source/hello.txt</code> &#x590D;&#x5236;&#x5230; <code>/data/</code> &#x76EE;&#x5F55;&#x4E2D;&#x53BB;&#xFF0C;&#x4EE5;&#x5B8C;&#x6210;&#x521D;&#x59CB;&#x5316;&#x3002;&#x7A0B;&#x5E8F;&#x7684;&#x6700;&#x540E;&#xFF0C;&#x5C06;&#x6267;&#x884C;&#x9001;&#x5165;&#x7684;&#x547D;&#x4EE4;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5199; <code>Dockerfile</code>&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> hello.txt /<span class="built_in">source</span>/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> entrypoint.sh /</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /data</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/entrypoint.sh&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>&#x5F53;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0; <code>/data</code> &#x76EE;&#x5F55;&#x4E0B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E86; <code>hello.txt</code> &#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x6210;&#x529F;&#x4E86;&#x3002;</p><h3 id="wei-shi-me-shuo-shu-ju-ku-bu-gua-he-fang-zai-docker-rong-qi-li-yun-xing"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x9002;&#x5408;&#x653E;&#x5728;-Docker-&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x9002;&#x5408;&#x653E;&#x5728; Docker &#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x9002;&#x5408;&#x653E;&#x5728; Docker &#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;&#xFF1F; <a href="#wei-shi-me-shuo-shu-ju-ku-bu-gua-he-fang-zai-docker-rong-qi-li-yun-xing" class="header-anchor">#</a></h3><p>&#x4E0D;&#x4E3A;&#x4EC0;&#x4E48;&#xFF0C;<strong>&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x8BF4;&#x6CD5;&#x4E0D;&#x5BF9;</strong>&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x8BA4;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x5FC5;&#x987B;&#x653E;&#x5230;&#x5BB9;&#x5668;&#x5916;&#x8FD0;&#x884C;&#x7684;&#x4EBA;&#x6839;&#x672C;&#x4E0D;&#x77E5;&#x9053; <code>Docker Volume</code> &#x4E3A;&#x4F55;&#x7269;&#x3002;</p><p>&#x5728;&#x65E9;&#x5E74; Docker &#x6CA1;&#x6709; <code>Docker Volume</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x662F;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x5DF2;&#x7ECF;&#x5F88;&#x591A;&#x5E74;&#x8FC7;&#x53BB;&#x4E86;&#x3002;&#x73B0;&#x5728;&#x6709; <code>Docker Volume</code> &#x89E3;&#x51B3;&#x6301;&#x4E45;&#x5316;&#x95EE;&#x9898;&#xFF0C;&#x4ECE;&#x672C;&#x5730;&#x76EE;&#x5F55;&#x7ED1;&#x5B9A;&#x3001;&#x53D7;&#x63A7;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3001;&#x5757;&#x8BBE;&#x5907;&#x3001;&#x7F51;&#x7EDC;&#x5B58;&#x50A8;&#x5230;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#xFF0C;<code>Docker Volume</code> &#x90FD;&#x652F;&#x6301;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x6570;&#x636E;&#x8BFB;&#x5199;&#x7C7B;&#x7684;&#x670D;&#x52A1;&#x4E0D;&#x9002;&#x4E8E;&#x8FD0;&#x884C;&#x4E8E;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8BF4;&#x6CD5;&#x3002;</p><p>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5377;&#x662F;&#x76F4;&#x63A5;&#x5411;&#x5BBF;&#x4E3B;&#x5199;&#x5165;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x6027;&#x80FD;&#x635F;&#x8017;&#x3002;&#x800C;&#x4E14;&#x5377;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x72EC;&#x7ACB;&#x4E8E;&#x5BB9;&#x5668;&#xFF0C;&#x5BB9;&#x5668;&#x6D88;&#x4EA1;&#x5377;&#x4E0D;&#x6D88;&#x4EA1;&#xFF0C;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#x6307;&#x5B9A;&#x547D;&#x540D;&#x5377;&#xFF0C;&#x6570;&#x636E;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x4E5F;&#x4E0D;&#x5B58;&#x5728;&#x65E0;&#x6CD5;&#x6301;&#x4E45;&#x5316;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x5EFA;&#x8BAE;&#x53BB;&#x9605;&#x8BFB;&#x4E00;&#x4E0B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;</p><ul><li><a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank" rel="noopener">https://docs.docker.com/engine/tutorials/dockervolumes/</a></li><li><a href="https://docs.docker.com/engine/reference/commandline/volume_create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/volume_create/</a></li><li><a href="https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins</a></li></ul><h3 id="ru-he-lie-chu-rong-qi-he-suo-shi-yong-de-juan-de-guan-xi"><a href="#&#x5982;&#x4F55;&#x5217;&#x51FA;&#x5BB9;&#x5668;&#x548C;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x7684;&#x5173;&#x7CFB;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5217;&#x51FA;&#x5BB9;&#x5668;&#x548C;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x7684;&#x5173;&#x7CFB;&#xFF1F;"></a>&#x5982;&#x4F55;&#x5217;&#x51FA;&#x5BB9;&#x5668;&#x548C;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x7684;&#x5173;&#x7CFB;&#xFF1F; <a href="#ru-he-lie-chu-rong-qi-he-suo-shi-yong-de-juan-de-guan-xi" class="header-anchor">#</a></h3><p>&#x8981;&#x611F;&#x8C22;&#x5F3A;&#x5927;&#x7684; <code>Go Template</code>&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x663E;&#x793A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format <span class="string">&apos;{{.Name}} =&gt; {{with .Mounts}}{{range .}}</span></span><br><span class="line"><span class="string">    {{.Name}},{{end}}{{end}}&apos;</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure><p><em>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x6362;&#x884C;&#x548C;&#x7A7A;&#x683C;&#x662F;&#x6709;&#x610F;&#x5982;&#x6B64;&#x7684;</em>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x518D;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x63A7;&#x5236;&#x7F29;&#x8FDB;&#x683C;&#x5F0F;&#x3002;&#x5176;&#x7ED3;&#x679C;&#x5C06;&#x662F;&#x5982;&#x4E0B;&#x5F62;&#x5F0F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect --format <span class="string">&apos;{{.Name}} =&gt; {{with .Mounts}}{{range .}}</span></span><br><span class="line"><span class="string">    {{.Name}}{{end}}{{end}}&apos;</span> $(docker ps -aq)</span><br><span class="line">/device_api_1 =&gt;</span><br><span class="line">/device_dashboard-debug_1 =&gt;</span><br><span class="line">/device_redis_1 =&gt;</span><br><span class="line">    device_redis-data</span><br><span class="line">/device_mongo_1 =&gt;</span><br><span class="line">    device_mongo-data</span><br><span class="line">    61453e46c3409f42e938324d7feffc6aeb6b7ce16d2080566e3b128c910c9570</span><br><span class="line">/prometheus_prometheus_1 =&gt;</span><br><span class="line">    fc0185ed3fc637295de810efaff7333e8ff2f6050d7f9368a22e19fb2c1e3c3f</span><br></pre></td></tr></table></figure><h2 id="jing-xiang-wen-ti-17"><a href="#&#x955C;&#x50CF;&#x95EE;&#x9898;-17" class="headerlink" title="&#x955C;&#x50CF;&#x95EE;&#x9898; (17)"></a>&#x955C;&#x50CF;&#x95EE;&#x9898; <code>(17)</code> <a href="#jing-xiang-wen-ti-17" class="header-anchor">#</a></h2><h3 id="docker-pull-xia-lai-de-jing-xiang-wen-jian-du-zai-na"><a href="#docker-pull-&#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F;" class="headerlink" title="docker pull &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F;"></a><code>docker pull</code> &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F; <a href="#docker-pull-xia-lai-de-jing-xiang-wen-jian-du-zai-na" class="header-anchor">#</a></h3><blockquote><p>&#x521D;&#x5B66; Docker &#x8981;&#x53CD;&#x590D;&#x544A;&#x8BEB;&#x81EA;&#x5DF1;&#xFF0C;<strong>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;</strong>&#x3002;</p></blockquote><p>Docker&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;Docker &#x955C;&#x50CF;&#x4E5F;&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x7684; ISO &#x6587;&#x4EF6;&#x3002;Docker &#x7684;&#x955C;&#x50CF;&#x662F;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x90FD;&#x662F;&#x7531;&#x5F88;&#x591A;&#x5C42;&#xFF0C;&#x5F88;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x7EC4;&#x6210;&#x3002;&#x800C;&#x4E0D;&#x540C;&#x7684;&#x955C;&#x50CF;&#x662F;&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x7684;&#x5C42;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5177;&#x4F53;&#x54EA;&#x4E2A;&#x6587;&#x4EF6;&#x662F; <code>pull</code> &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x5177;&#x4F53;&#x955C;&#x50CF;&#x4FDD;&#x5B58;&#x4F4D;&#x7F6E;&#x53D6;&#x51B3;&#x4E8E;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E00;&#x822C;<code>Linux</code>&#x7CFB;&#x7EDF;&#x4E0B;&#xFF0C;&#x5728; <code>/var/lib/docker</code> &#x91CC;&#x3002;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528; <code>Union FS</code> &#x7684;&#x7CFB;&#x7EDF;(<code>Ubuntu</code>)&#xFF0C;&#x5982; <code>aufs</code>, <code>overlay2</code> &#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; <code>/var/lib/docker/{aufs,overlay2}</code> &#x4E0B;&#x770B;&#x5230;&#x627E;&#x5230;&#x5404;&#x4E2A;&#x955C;&#x50CF;&#x7684;&#x5C42;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x5C42;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x4F46;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;<code>CentOS</code>&#x8FD9;&#x7C7B;&#x6CA1;&#x6709;<code>Union FS</code>&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x5982;<code>devicemapper</code>&#x8FD9;&#x7C7B;&#x4E1C;&#x897F;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x529F;&#x80FD;(&#x5982;<code>snapshot</code>)&#x6A21;&#x62DF;&#xFF0C;&#x955C;&#x50CF;&#x4F1A;&#x5B58;&#x50A8;&#x4E8E;&#x5757;&#x8BBE;&#x5907;&#x91CC;&#xFF0C;&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x770B;&#x5230;&#x5177;&#x4F53;&#x6BCF;&#x5C42;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x6BCF;&#x5C42;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>CentOS/RHEL</code> &#x4F7F;&#x7528; <code>lvm-loop</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x672C;&#x5730;&#x7A00;&#x758F;&#x6587;&#x4EF6;&#x6A21;&#x62DF;&#x5757;&#x8BBE;&#x5907;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4F1A;&#x4F4D;&#x4E8E; <code>/var/lib/docker/devicemapper/devicemapper/data</code> &#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x63A8;&#x8350;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5F88;&#x5927;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x4F60;&#x5728;&#x7528; <code>devicemapper + loop</code> &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x53BB;&#x53C2;&#x7167;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x6362; <code>direct-lvm</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5206;&#x914D;&#x771F;&#x6B63;&#x7684;&#x5757;&#x8BBE;&#x5907;&#x7ED9; <code>devicemapper</code> &#x53BB;&#x7528;&#x3002;</p><h3 id="docker-images-ming-ling-xian-shi-de-jing-xiang-zhan-liao-hao-da-de-kong-jian-zen-me-ban-mei-ci-du-shi-xia-zai-zhe-me-da-de-jing-xiang"><a href="#docker-images-&#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F;" class="headerlink" title="docker images &#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F;"></a><code>docker images</code> &#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F; <a href="#docker-images-ming-ling-xian-shi-de-jing-xiang-zhan-liao-hao-da-de-kong-jian-zen-me-ban-mei-ci-du-shi-xia-zai-zhe-me-da-de-jing-xiang" class="header-anchor">#</a></h3><p>&#x8FD9;&#x4E2A;&#x663E;&#x793A;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x8BA1;&#x7B97;&#x540E;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8981;&#x77E5;&#x9053; docker image &#x662F;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x5728;<code>1.10</code>&#x4E4B;&#x524D;&#xFF0C;&#x4E0D;&#x540C;&#x955C;&#x50CF;&#x65E0;&#x6CD5;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x5C42;&#xFF0C;&#x6240;&#x4EE5;&#x57FA;&#x672C;&#x4E0A;&#x786E;&#x5B9E;&#x662F;&#x4E0B;&#x8F7D;&#x5927;&#x5C0F;&#x3002;&#x4F46;&#x662F;&#x4ECE;<code>1.10</code>&#x4E4B;&#x540E;&#xFF0C;&#x5DF2;&#x6709;&#x7684;&#x5C42;&#xFF08;&#x901A;&#x8FC7;<code>SHA256</code>&#x6765;&#x5224;&#x65AD;&#xFF09;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x4E0B;&#x8F7D;&#x3002;&#x53EA;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x53D8;&#x5316;&#x7684;&#x5C42;&#x3002;&#x6240;&#x4EE5;&#x5B9E;&#x9645;&#x4E0B;&#x8F7D;&#x5927;&#x5C0F;&#x6BD4;&#x8FD9;&#x4E2A;&#x6570;&#x503C;&#x8981;&#x5C0F;&#x3002;&#x800C;&#x4E14;&#x672C;&#x5730;&#x786C;&#x76D8;&#x7A7A;&#x95F4;&#x5360;&#x7528;&#xFF0C;&#x4E5F;&#x6BD4;<code>docker images</code>&#x5217;&#x51FA;&#x6765;&#x7684;&#x4E1C;&#x897F;&#x52A0;&#x8D77;&#x6765;&#x5C0F;&#x5F88;&#x591A;&#xFF0C;&#x5F88;&#x591A;&#x91CD;&#x590D;&#x7684;&#x90E8;&#x5206;&#x5171;&#x4EAB;&#x4E86;&#x3002;</p><h3 id="docker-images-a-hou-xian-shi-liao-hao-duo-none-de-jing-xiang-du-shi-shi-me-ya-neng-shan-me"><a href="#docker-images-a-&#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A;-lt-none-gt-&#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F;" class="headerlink" title="docker images -a &#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A; &lt;none&gt; &#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F;"></a><code>docker images -a</code> &#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A; <code>&lt;none&gt;</code> &#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F; <a href="#docker-images-a-hou-xian-shi-liao-hao-duo-none-de-jing-xiang-du-shi-shi-me-ya-neng-shan-me" class="header-anchor">#</a></h3><p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;<code>&lt;none&gt;</code> &#x5C31;&#x662F;&#x8BF4;&#x8BE5;&#x955C;&#x50CF;&#x6CA1;&#x6709;&#x6253;&#x6807;&#x7B7E;&#x3002;&#x800C;&#x6CA1;&#x6709;&#x6253;&#x6807;&#x7B7E;&#x955C;&#x50CF;&#x4E00;&#x822C;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#xFF0C;&#x4E00;&#x7C7B;&#x662F;<strong>&#x4F9D;&#x8D56;&#x955C;&#x50CF;</strong>&#xFF0C;&#x4E00;&#x7C7B;&#x662F;<strong>&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;</strong>&#x3002;</p><h4 id="yi-lai-jing-xiang"><a href="#&#x4F9D;&#x8D56;&#x955C;&#x50CF;" class="headerlink" title="&#x4F9D;&#x8D56;&#x955C;&#x50CF;"></a>&#x4F9D;&#x8D56;&#x955C;&#x50CF; <a href="#yi-lai-jing-xiang" class="header-anchor">#</a></h4><p>Docker&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x5B58;&#x50A8;&#x5C42;&#x662F;Union FS&#xFF0C;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x3002;&#x6240;&#x4EE5;&#x4EFB;&#x4F55;&#x955C;&#x50CF;&#x9664;&#x4E86;&#x6700;&#x4E0A;&#x9762;&#x4E00;&#x5C42;&#x6253;&#x4E0A;&#x6807;&#x7B7E;(tag)&#x5916;&#xFF0C;&#x5176;&#x5B83;&#x4E0B;&#x9762;&#x4F9D;&#x8D56;&#x7684;&#x4E00;&#x5C42;&#x5C42;&#x5B58;&#x50A8;&#x4E5F;&#x662F;&#x5B58;&#x5728;&#x7684;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x6CA1;&#x6709;&#x6253;&#x4E0A;&#x4EFB;&#x4F55;&#x6807;&#x7B7E;&#xFF0C;&#x6240;&#x4EE5;&#x5728; <code>docker images -a</code> &#x7684;&#x65F6;&#x5019;&#x4F1A;&#x4EE5; <code>&lt;none&gt;</code> &#x7684;&#x5F62;&#x5F0F;&#x663E;&#x793A;&#x3002;&#x6CE8;&#x610F;&#x89C2;&#x5BDF;&#x4E00;&#x4E0B; <code>docker pull</code> &#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x7684;<code>sha256</code>&#x7684;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B; <code>&lt;none&gt;</code> &#x4E2D;&#x7684;&#x76F8;&#x540C;&#x6821;&#x9A8C;&#x503C;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5B83;&#x4EEC;&#x5C31;&#x662F;&#x4F9D;&#x8D56;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;<strong>&#x4E0D;&#x5E94;&#x5F53;&#x88AB;&#x5220;&#x9664;</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x6807;&#x7B7E;&#x955C;&#x50CF;&#x5728;&#x4F9D;&#x8D56;&#x5B83;&#x4EEC;&#x3002;</p><h4 id="diu-liao-biao-qian-de-jing-xiang"><a href="#&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;" class="headerlink" title="&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;"></a>&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF; <a href="#diu-liao-biao-qian-de-jing-xiang" class="header-anchor">#</a></h4><p>&#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#x53EF;&#x80FD;&#x672C;&#x6765;&#x6709;&#x6807;&#x7B7E;&#xFF0C;&#x540E;&#x6765;&#x4E22;&#x4E86;&#x3002;&#x539F;&#x56E0;&#x53EF;&#x80FD;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><ul><li><code>docker pull</code> &#x4E86;&#x4E00;&#x4E2A;&#x540C;&#x6837;&#x6807;&#x7B7E;&#x4F46;&#x662F;&#x65B0;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x4E8E;&#x662F;&#x8BE5;&#x6807;&#x7B7E;&#x4ECE;&#x65E7;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#x8F6C;&#x79FB;&#x5230;&#x4E86;&#x65B0;&#x7248;&#x672C;&#x955C;&#x50CF;&#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#x65E7;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#x4E0A;&#x7684;&#x6807;&#x7B7E;&#x5C31;&#x4E22;&#x4E86;&#xFF1B;</li><li><code>docker build</code> &#x65F6;&#x6307;&#x5B9A;&#x7684;&#x6807;&#x7B7E;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF;&#x62E5;&#x6709;&#x8BE5;&#x6807;&#x7B7E;&#xFF0C;&#x800C;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF;&#x5C31;&#x4E22;&#x5931;&#x4E86;&#x6807;&#x7B7E;&#x3002;</li></ul><p>&#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#x88AB;&#x79F0;&#x4E3A; <code>dangling</code> - &#x865A;&#x60AC;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#xFF0C;&#x624B;&#x52A8;&#x5220;&#x9664; dangling &#x955C;&#x50CF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E; 1.13 &#x4EE5;&#x524D;&#x7684;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x4F7F;&#x7528; <code>dangling=true</code> &#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#x5373;&#x53EF;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;<code>docker rmi $(docker images -aq -f &quot;dangling=true&quot;)</code></p><p>&#x5BF9;&#x4E8E;&#x9891;&#x7E41;&#x6784;&#x5EFA;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x6BD4;&#x5982; Jenkins &#x4E4B;&#x7C7B;&#x7684;&#x73AF;&#x5883;&#x3002;&#x624B;&#x52A8;&#x6E05;&#x7406;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x597D;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x5E94;&#x8BE5;&#x5B9A;&#x671F;&#x6267;&#x884C;&#x56FA;&#x5B9A;&#x811A;&#x672C;&#x6765;&#x6E05;&#x7406;&#x8FD9;&#x4E9B;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;&#x3002;&#x5F88;&#x5E78;&#x8FD0;&#xFF0C;Spotify &#x4E5F;&#x9762;&#x4E34;&#x4E86;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4ED6;&#x4EEC;&#x5DF2;&#x7ECF;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x5DE5;&#x5177;&#x6765;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;<a href="https://github.com/spotify/docker-gc" target="_blank" rel="noopener">https://github.com/spotify/docker-gc</a></p><h3 id="wei-shi-me-docker-hub-de-jing-xiang-chi-cun-he-docker-images-bu-yi-zhi"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-Docker-Hub-&#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C;-docker-images-&#x4E0D;&#x4E00;&#x81F4;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; Docker Hub &#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C; docker images &#x4E0D;&#x4E00;&#x81F4;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; Docker Hub &#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C; <code>docker images</code> &#x4E0D;&#x4E00;&#x81F4;&#xFF1F; <a href="#wei-shi-me-docker-hub-de-jing-xiang-chi-cun-he-docker-images-bu-yi-zhi" class="header-anchor">#</a></h3><p>Docker Hub&#x4E0A;&#x663E;&#x793A;&#x7684;&#x662F;&#x7ECF;&#x8FC7; <code>gzip</code> &#x538B;&#x7F29;&#x540E;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5927;&#x5C0F;&#x4E5F;&#x662F;&#x4F60;&#x5C06;&#x4E0B;&#x8F7D;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x4E5F;&#x662F; Docker Hub &#x7528;&#x6237;&#x6700;&#x5173;&#x5FC3;&#x7684;&#x5927;&#x5C0F;&#x3002;</p><p>&#x800C; <code>docker images</code> &#x663E;&#x793A;&#x7684;&#x662F;<code>pull</code>&#x4E0B;&#x6765;&#x5E76;&#x89E3;&#x538B;&#x7F29;&#x540E;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;<code>docker images</code>&#x7684;&#x65F6;&#x5019;&#x66F4;&#x5173;&#x5FC3;&#x7684;&#x662F;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x5360;&#x7528;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x663E;&#x793A;&#x7684;&#x662F;&#x672A;&#x538B;&#x7F29;&#x955C;&#x50CF;&#x7684;&#x5927;&#x5C0F;&#x3002;</p><h3 id="docker-commit-zen-me-yong-a"><a href="#docker-commit-&#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F;" class="headerlink" title="docker commit &#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F;"></a><code>docker commit</code> &#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F; <a href="#docker-commit-zen-me-yong-a" class="header-anchor">#</a></h3><p>&#x7B80;&#x5355;&#x7684;&#x56DE;&#x7B54;&#x5C31;&#x662F;&#xFF0C;&#x4E0D;&#x8981;&#x7528; <code>commit</code>&#xFF0C;&#x53BB;&#x5199; <code>Dockerfile</code>&#x3002;</p><blockquote><p>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x3002;&#x8FD9;&#x53E5;&#x8BDD;&#x8981;&#x5728;&#x5B66;&#x4E60; Docker &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x53CD;&#x590D;&#x63D0;&#x9192;&#x81EA;&#x5DF1;&#x3002;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x628A;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x6982;&#x5FF5;&#x5E26;&#x8FC7;&#x6765;&#x3002;</p></blockquote><p>Docker &#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x597D;&#x7684; <code>Dockerfile</code> &#x7684;&#x673A;&#x5236;&#x6765;&#x5E2E;&#x52A9;&#x5B9A;&#x5236;&#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; Shell &#x547D;&#x4EE4;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x8FD9;&#x6837;&#x5236;&#x4F5C;&#x7684;&#x955C;&#x50CF;&#x66F4;&#x52A0;&#x900F;&#x660E;&#xFF0C;&#x4E5F;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#xFF0C;&#x5728;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x5347;&#x7EA7;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x7684;&#x5B89;&#x5168;&#x7EF4;&#x62A4;&#x64CD;&#x4F5C;&#x3002;</p><p>&#x4F7F;&#x7528; <code>docker commit</code> &#x5236;&#x4F5C;&#x7684;&#x955C;&#x50CF;&#x88AB;&#x79F0;&#x4E3A;<code>&#x9ED1;&#x7BB1;&#x955C;&#x50CF;</code>&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x91CC;&#x9762;&#x8FDB;&#x884C;&#x7684;&#x662F;&#x9ED1;&#x7BB1;&#x64CD;&#x4F5C;&#xFF0C;&#x9664;&#x672C;&#x4EBA;&#x5916;&#x65E0;&#x4EBA;&#x77E5;&#x6653;&#x3002;&#x5373;&#x4F7F;&#x8FD9;&#x4E2A;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x7684;&#x4EBA;&#xFF0C;&#x8FC7;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x4E5F;&#x4E0D;&#x4F1A;&#x5B8C;&#x6574;&#x7684;&#x8BB0;&#x8D77;&#x91CC;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x90A3;&#x4E48;&#x5F53;&#x6709;&#x4E9B;&#x4E1C;&#x897F;&#x9700;&#x8981;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x6216;&#x8005;&#x56E0;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x66F4;&#x65B0;&#x800C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x4F1A;&#x8BA9;&#x4E00;&#x5207;&#x53D8;&#x5F97;&#x5F02;&#x5E38;&#x56F0;&#x96BE;&#xFF0C;&#x5C31;&#x5982;&#x540C;&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8C03;&#x8BD5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x5668;&#x4E00;&#x6837;&#xFF0C;&#x5931;&#x53BB;&#x4E86; Docker &#x7684;&#x4F18;&#x52BF;&#x4E86;&#x3002;</p><p>&#x53E6;&#x5916;&#xFF0C;Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5176;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F; Union FS&#xFF0C;&#x5206;&#x5C42;&#x5F0F;&#x5B58;&#x50A8;&#xFF0C;&#x6BCF;&#x4E00;&#x6B21; <code>commit</code> &#x90FD;&#x4F1A;&#x5EFA;&#x7ACB;&#x4E00;&#x5C42;&#xFF0C;&#x4E0A;&#x4E00;&#x5C42;&#x7684;&#x6587;&#x4EF6;&#x5E76;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A; <code>rm</code> &#x800C;&#x5220;&#x9664;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x5F53;&#x524D;&#x5C42;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x800C;&#x770B;&#x4E0D;&#x5230;&#x4E86;&#x800C;&#x5DF2;&#xFF0C;&#x6BCF;&#x6B21; <code>docker pull</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E9B;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x4F1A;&#x5982;&#x5F71;&#x968F;&#x5F62;&#xFF0C;&#x6240;&#x5F97;&#x5230;&#x7684;&#x955C;&#x50CF;&#x4E5F;&#x5FC5;&#x7136;&#x81C3;&#x80BF;&#x4E0D;&#x582A;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x968F;&#x7740;&#x6587;&#x4EF6;&#x5C42;&#x6570;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x955C;&#x50CF;&#x66F4;&#x81C3;&#x80BF;&#xFF0C;&#x5176;&#x8FD0;&#x884C;&#x65F6;&#x6027;&#x80FD;&#x4E5F;&#x5FC5;&#x7136;&#x4F1A;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#x3002;&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x8FDD;&#x80CC;&#x4E86; Docker &#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x3002;</p><p>&#x4F7F;&#x7528; <code>commit</code> &#x7684;&#x573A;&#x5408;&#x662F;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x73AF;&#x5883;&#xFF0C;&#x6BD4;&#x5982;&#x5165;&#x4FB5;&#x540E;&#x4FDD;&#x5B58;&#x73B0;&#x573A;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4E0D;&#x5E94;&#x8BE5;&#x6210;&#x4E3A;&#x5B9A;&#x5236;&#x955C;&#x50CF;&#x7684;&#x6807;&#x51C6;&#x505A;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8BF7;&#x7528; <code>Dockerfile</code> &#x5B9A;&#x5236;&#x955C;&#x50CF;&#x3002;</p><h3 id="wei-shi-me-shuo-bu-yao-shi-yong-import-export-save-load-commit-lai-gou-jian-jing-xiang"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;-import-export-save-load-commit-&#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528; import, export, save, load, commit &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528; <code>import</code>, <code>export</code>, <code>save</code>, <code>load</code>, <code>commit</code> &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF1F; <a href="#wei-shi-me-shuo-bu-yao-shi-yong-import-export-save-load-commit-lai-gou-jian-jing-xiang" class="header-anchor">#</a></h3><p><code>commit</code> &#x547D;&#x4EE4;&#x5728;&#x524D;&#x4E00;&#x4E2A;&#x95EE;&#x7B54;&#x5DF2;&#x7ECF;&#x8BF4;&#x8FC7;&#xFF0C;&#x8FD9;&#x662F;&#x5236;&#x4F5C;<strong>&#x9ED1;&#x7BB1;&#x955C;&#x50CF;</strong>&#xFF0C;&#x65E0;&#x6CD5;&#x7EF4;&#x62A4;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x4F7F;&#x7528;&#x3002;</p><p><code>import</code> &#x548C; <code>export</code> &#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;&#x4E00;&#x4E2A;<em>&#x5BB9;&#x5668;</em>&#x6765;&#x4FDD;&#x5B58;&#x4E3A; <code>tar</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5BFC;&#x5165;&#x4E3A;<em>&#x955C;&#x50CF;</em>&#x3002;&#x8FD9;&#x6837;&#x5236;&#x4F5C;&#x7684;&#x955C;&#x50CF;&#x540C;&#x6837;&#x662F;<strong>&#x9ED1;&#x7BB1;&#x955C;&#x50CF;</strong>&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x3002;&#x800C;&#x4E14;&#x8FD9;&#x7C7B;&#x5BFC;&#x5165;&#x5BFC;&#x51FA;&#x4F1A;&#x5BFC;&#x81F4;&#x539F;&#x6709;&#x5206;&#x5C42;&#x4E22;&#x5931;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x5C42;&#xFF0C;&#x800C;&#x4E14;&#x4F1A;&#x4E22;&#x5931;&#x5F88;&#x591A;&#x76F8;&#x5173;&#x955C;&#x50CF;&#x5143;&#x6570;&#x636E;&#x6216;&#x8005;&#x914D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982; <code>CMD</code> &#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x80FD;&#x4E22;&#x5931;&#xFF0C;&#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x542F;&#x52A8;&#x3002;</p><p><code>save</code> &#x548C; <code>load</code> &#x786E;&#x5B9E;&#x662F;&#x955C;&#x50CF;&#x4FDD;&#x5B58;&#x548C;&#x52A0;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x662F;&#x5728;&#x6CA1;&#x6709; <code>registry</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x624B;&#x52A8;&#x628A;&#x955C;&#x50CF;&#x8003;&#x6765;&#x8003;&#x53BB;&#xFF0C;&#x8FD9;&#x662F;&#x56DE;&#x5230;&#x4E86;&#x5341;&#x591A;&#x5E74;&#x7684; U &#x76D8;&#x65F6;&#x4EE3;&#x1F62D;&#x3002;&#x8FD9;&#x540C;&#x6837;&#x662F;&#x4E0D;&#x63A8;&#x8350;&#x7684;&#xFF0C;&#x955C;&#x50CF;&#x7684;&#x53D1;&#x5E03;&#x3001;&#x66F4;&#x65B0;&#x7EF4;&#x62A4;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>registry</code>&#x3002;&#x65E0;&#x8BBA;&#x662F;&#x81EA;&#x5DF1;&#x67B6;&#x8BBE;&#x79C1;&#x6709; <code>registry</code> &#x670D;&#x52A1;&#xFF0C;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x516C;&#x6709; <code>registry</code> &#x670D;&#x52A1;&#xFF0C;&#x5982; <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>&#x3002;</p><h3 id="dockerfile-zen-me-xie"><a href="#Dockerfile-&#x600E;&#x4E48;&#x5199;&#xFF1F;" class="headerlink" title="Dockerfile &#x600E;&#x4E48;&#x5199;&#xFF1F;"></a><code>Dockerfile</code> &#x600E;&#x4E48;&#x5199;&#xFF1F; <a href="#dockerfile-zen-me-xie" class="header-anchor">#</a></h3><p>&#x6700;&#x76F4;&#x63A5;&#x4E5F;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x3002;</p><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x8BB2;&#x8FF0;&#x5177;&#x4F53; <code>Dockerfile</code> &#x7684;&#x547D;&#x4EE4;&#x8BED;&#x6CD5;&#xFF1A;<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/</a></p><p>&#x7136;&#x540E;&#xFF0C;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#x5B98;&#x65B9;&#x7684; <code>Dockerfile</code> &#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></p><p>&#x6700;&#x540E;&#xFF0C;&#x53BB; Docker Hub &#x5B66;&#x4E60;&#x90A3;&#x4E9B;<strong><a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">&#x5B98;&#x65B9;(Official)&#x955C;&#x50CF;</a></strong> <code>Dockerfile</code> &#x548B;&#x5199;&#x7684;&#x3002;</p><h3 id="dockerfile-jiu-shi-shell-jiao-ben-ba-na-wo-dong-yi-xing-xing-ba-xu-yao-zhuang-de-dong-xi-du-xie-jin-qu-bu-jiu-xing-liao"><a href="#Dockerfile-&#x5C31;&#x662F;-shell-&#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002;" class="headerlink" title="Dockerfile &#x5C31;&#x662F; shell &#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002;"></a><code>Dockerfile</code> &#x5C31;&#x662F; <code>shell</code> &#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002; <a href="#dockerfile-jiu-shi-shell-jiao-ben-ba-na-wo-dong-yi-xing-xing-ba-xu-yao-zhuang-de-dong-xi-du-xie-jin-qu-bu-jiu-xing-liao" class="header-anchor">#</a></h3><p>&#x4E0D;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x3002;</p><blockquote><p><code>Dockerfile</code> &#x4E0D;&#x7B49;&#x4E8E; <code>.sh</code> &#x811A;&#x672C;</p></blockquote><p><code>Dockerfile</code> &#x786E;&#x5B9E;&#x662F;&#x63CF;&#x8FF0;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86; <code>RUN</code> &#x8FD9;&#x6837;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; shell &#x547D;&#x4EE4;&#x3002;&#x4F46;&#x662F;&#x548C;&#x666E;&#x901A; shell &#x811A;&#x672C;&#x8FD8;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4E0D;&#x540C;&#x3002;</p><p><code>Dockerfile</code> &#x63CF;&#x8FF0;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x955C;&#x50CF;&#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x8981;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E00;&#x4E2A;<code>RUN</code>&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x4E00;&#x5C42;&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x5B9A;&#x8981;&#x7406;&#x89E3;&#x201C;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x201D;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x4E0A;&#x4E00;&#x5C42;&#x7684;&#x4E1C;&#x897F;&#x4E0D;&#x4F1A;&#x88AB;&#x7269;&#x7406;&#x5220;&#x9664;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x4FDD;&#x7559;&#x7ED9;&#x4E0B;&#x4E00;&#x5C42;&#xFF0C;&#x4E0B;&#x4E00;&#x5C42;&#x4E2D;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5220;&#x9664;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x8FD9;&#x4E00;&#x5C42;&#x505A;&#x7684;&#x67D0;&#x4E2A;&#x6807;&#x8BB0;&#xFF0C;&#x8BF4;&#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x4E1C;&#x897F;&#x5220;&#x4E86;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x4F1A;&#x53BB;&#x4FEE;&#x6539;&#x4E0A;&#x4E00;&#x5C42;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BCF;&#x4E00;&#x5C42;&#x90FD;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x5BB9;&#x5668;&#x672C;&#x8EAB;&#x7684; <code>immutable</code> &#x7279;&#x6027;&#xFF0C;&#x8981;&#x4FDD;&#x6301;&#x81EA;&#x8EAB;&#x7684;&#x9759;&#x6001;&#x7279;&#x6027;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x65B0;&#x624B;&#x4F1A;&#x5E38;&#x72AF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x628A; <code>Dockerfile</code> &#x5F53;&#x505A; shell &#x811A;&#x672C;&#x6765;&#x5199;&#x4E86;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> yum update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install gcc</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install python</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> jdk-xxxx.tar.gz /tmp</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> xxxx &amp;&amp; install</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> xxx &amp;&amp; configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x76F8;&#x5F53;&#x9519;&#x8BEF;&#x7684;&#x3002;&#x9664;&#x4E86;&#x65E0;&#x754F;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x5F88;&#x591A;&#x5C42;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x90FD;&#x88AB;&#x88C5;&#x8FDB;&#x4E86;&#x955C;&#x50CF;&#x91CC;&#xFF0C;&#x6BD4;&#x5982;&#x7F16;&#x8BD1;&#x73AF;&#x5883;&#x3001;&#x66F4;&#x65B0;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#x7B49;&#x7B49;&#x3002;&#x7ED3;&#x679C;&#x5C31;&#x662F;&#x4EA7;&#x751F;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x3001;&#x975E;&#x5E38;&#x591A;&#x5C42;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x589E;&#x52A0;&#x4E86;&#x6784;&#x5EFA;&#x90E8;&#x7F72;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x5F88;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;</p><p>&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#x5E94;&#x8BE5;&#x662F;&#x628A;<strong>&#x540C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x547D;&#x4EE4;</strong>&#x653E;&#x5230;&#x4E00;&#x4E2A; <code>RUN</code> &#x4E0B;&#xFF0C;&#x591A;&#x6761;&#x547D;&#x4EE4;&#x5E94;&#x8BE5;&#x7528; <code>&amp;&amp;</code> &#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6700;&#x540E;&#x8981;&#x6253;&#x626B;&#x5E72;&#x51C0;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x73AF;&#x5883;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x6458;&#x81EA;&#x5B98;&#x65B9; <code>redis</code> &#x955C;&#x50CF; <code>Dockerfile</code> &#x7684;&#x90E8;&#x5206;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> buildDeps=<span class="string">&apos;gcc libc6-dev make&apos;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">set</span> -x \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y <span class="variable">$buildDeps</span> --no-install-recommends \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -O redis.tar.gz <span class="string">&quot;<span class="variable">$REDIS_DOWNLOAD_URL</span>&quot;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$REDIS_DOWNLOAD_SHA1</span> *redis.tar.gz&quot;</span> | sha1sum -c - \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm redis.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; make -C /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; make -C /usr/src/redis install \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -r /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove <span class="variable">$buildDeps</span></span></span><br></pre></td></tr></table></figure><h3 id="na-wo-ba-suo-you-ming-ling-du-he-bing-dao-yi-ge-run-jiu-dui-liao-ba"><a href="#&#x90A3;&#x6211;&#x628A;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x90FD;&#x5408;&#x5E76;&#x5230;&#x4E00;&#x4E2A;-RUN-&#x5C31;&#x5BF9;&#x4E86;&#x5427;&#xFF1F;" class="headerlink" title="&#x90A3;&#x6211;&#x628A;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x90FD;&#x5408;&#x5E76;&#x5230;&#x4E00;&#x4E2A; RUN &#x5C31;&#x5BF9;&#x4E86;&#x5427;&#xFF1F;"></a>&#x90A3;&#x6211;&#x628A;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x90FD;&#x5408;&#x5E76;&#x5230;&#x4E00;&#x4E2A; <code>RUN</code> &#x5C31;&#x5BF9;&#x4E86;&#x5427;&#xFF1F; <a href="#na-wo-ba-suo-you-ming-ling-du-he-bing-dao-yi-ge-run-jiu-dui-liao-ba" class="header-anchor">#</a></h3><p>&#x4E0D;&#x662F;&#x628A;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x90FD;&#x5408;&#x4E3A;&#x4E00;&#x4E2A; <code>RUN</code>&#xFF0C;&#x8981;&#x5408;&#x7406;&#x5206;&#x5C42;&#xFF0C;&#x4EE5;&#x52A0;&#x5FEB;&#x6784;&#x5EFA;&#x548C;&#x90E8;&#x7F72;&#x3002;</p><blockquote><p>&#x5408;&#x7406;&#x5206;&#x5C42;&#x5C31;&#x662F;&#x5C06;&#x5177;&#x6709;<strong>&#x4E0D;&#x540C;&#x53D8;&#x66F4;&#x9891;&#x7E41;&#x7A0B;&#x5EA6;</strong>&#x7684;&#x5C42;&#xFF0C;&#x8FDB;&#x884C;&#x62C6;&#x5206;&#xFF0C;&#x8BA9;&#x7A33;&#x5B9A;&#x7684;&#x90E8;&#x5206;&#x5728;&#x57FA;&#x7840;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x53D8;&#x66F4;&#x7684;&#x90E8;&#x5206;&#x5728;&#x8868;&#x5C42;&#xFF0C;&#x4F7F;&#x5F97;&#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x5229;&#x7528;&#xFF0C;&#x4EE5;&#x589E;&#x52A0;&#x6784;&#x5EFA;&#x548C;&#x90E8;&#x7F72;&#x7684;&#x901F;&#x5EA6;&#x3002;</p></blockquote><p>&#x4EE5; <a href="https://coding.net/u/twang2218/p/docker-example/git/blob/master/node/Dockerfile" target="_blank" rel="noopener"><code>node.js</code> &#x7684;&#x5E94;&#x7528;&#x793A;&#x4F8B;&#x955C;&#x50CF;</a>&#x4E3A;&#x4F8B;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x590D;&#x5236;&#x5E94;&#x7528;&#x548C;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5982;&#x679C;&#x90FD;&#x5408;&#x5E76;&#x4E00;&#x8D77;&#xFF0C;&#x4F1A;&#x5199;&#x6210;&#x8FD9;&#x6837;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> . /usr/src/app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><p>&#x4F46;&#x662F;&#xFF0C;&#x5728; <code>node.js</code> &#x5E94;&#x7528;&#x955C;&#x50CF;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x5219;&#x662F;&#x8FD9;&#x4E48;&#x5199;&#x7684;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> package.json /usr/src/app/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /usr/src/app</span></span><br></pre></td></tr></table></figure><p>&#x4ECE;&#x5C42;&#x6570;&#x4E0A;&#x770B;&#xFF0C;&#x786E;&#x5B9E;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E09;&#x884C;&#x5206;&#x5F00;&#x662F;&#x6545;&#x610F;&#x8FD9;&#x6837;&#x505A;&#x7684;&#xFF0C;&#x5176;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x5408;&#x7406;&#x5206;&#x5C42;&#xFF0C;&#x5145;&#x5206;&#x5229;&#x7528; Docker &#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4EE5;&#x589E;&#x52A0;&#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x7684;&#x6548;&#x7387;&#x3002;</p><p>&#x5728; <code>docker build</code> &#x7684;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x5C42;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x8FC7;&#xFF0C;&#x800C;&#x4E14;&#x8BE5;&#x5C42;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x90A3;&#x4E48; <code>docker</code> &#x5C31;&#x4F1A;<strong>&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</strong>&#xFF0C;&#x4E0D;&#x4F1A;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5408;&#x7406;&#x5206;&#x5C42;&#xFF0C;&#x5145;&#x5206;&#x5229;&#x7528;&#x7F13;&#x5B58;&#xFF0C;&#x4F1A;&#x663E;&#x8457;&#x52A0;&#x901F;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x3002;</p><p>&#x7B2C;&#x4E00;&#x884C;&#x7684;&#x76EE;&#x7684;&#x662F;&#x5C06; <code>package.json</code> &#x590D;&#x5236;&#x5230;&#x5E94;&#x7528;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x76EE;&#x5F55;&#x3002;&#x8FD9;&#x6837;&#x53EA;&#x6709; <code>pakcage.json</code> &#x53D1;&#x751F;&#x6539;&#x53D8;&#x540E;&#xFF0C;&#x624D;&#x4F1A;&#x89E6;&#x53D1;&#x7B2C;&#x4E8C;&#x884C; <code>RUN npm install</code>&#x3002;&#x800C;&#x53EA;&#x8981; <code>package.json</code> &#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x6539;&#x53D8;&#x5C31;&#x4E0D;&#x4F1A;&#x5F15;&#x53D1; <code>npm install</code>&#xFF0C;&#x53EA;&#x4F1A;&#x5F15;&#x53D1;&#x7B2C;&#x4E09;&#x884C;&#x7684; <code>COPY . /usr/src/app</code>&#xFF0C;&#x4ECE;&#x800C;&#x52A0;&#x5FEB;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x3002;</p><p>&#x800C;&#x5982;&#x679C;&#x6309;&#x7167;&#x524D;&#x9762;&#x6240;&#x63D0;&#x5230;&#x7684;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E24;&#x5C42;&#xFF0C;&#x90A3;&#x4E48;&#x4EFB;&#x4F55;&#x4EE3;&#x7801;&#x6539;&#x53D8;&#xFF0C;&#x90FD;&#x4F1A;&#x89E6;&#x53D1; <code>RUN npm install</code>&#xFF0C;&#x4ECE;&#x800C;&#x6D6A;&#x8D39;&#x5927;&#x91CF;&#x7684;&#x5E26;&#x5BBD;&#x548C;&#x65F6;&#x95F4;&#x3002;</p><p>&#x5408;&#x7406;&#x5206;&#x5C42;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x52A0;&#x5FEB;&#x6784;&#x5EFA;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x52A0;&#x5FEB;&#x90E8;&#x7F72;&#xFF0C;&#x8981;&#x77E5;&#x9053;&#xFF0C;<code>docker pull</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x5206;&#x5C42;&#x4E0B;&#x8F7D;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x5C42;&#x5C31;<strong>&#x4E0D;&#x4F1A;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;</strong>&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x8FD9;&#x91CC;&#x7684; <code>RUN npm install</code> &#x8FD9;&#x4E00;&#x5C42;&#xFF0C;&#x5F80;&#x5F80;&#x4F1A;&#x51E0;&#x767E; MB &#x751A;&#x81F3;&#x4E0A; GB&#x3002;&#x800C;&#x5728; <code>package.json</code> &#x672A;&#x53D1;&#x751F;&#x53D8;&#x66F4;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x6709; <code>COPY . /usr/src/app</code> &#x8FD9;&#x4E00;&#x5C42;&#x4F1A;&#x88AB;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x53EA;&#x6709;&#x8FD9;&#x4E00;&#x5C42;&#x4F1A;&#x5728;&#x5404;&#x4E2A;&#x8282;&#x70B9; <code>docker pull</code> &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#xFF0C;&#x5F80;&#x5F80;&#x8FD9;&#x4E00;&#x5C42;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#x53EA;&#x6709;&#x51E0;&#x5341; MB&#xFF0C;&#x751A;&#x81F3;&#x66F4;&#x5C0F;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x5E76;&#x884C;&#x90E8;&#x7F72;&#x4E2D;&#xFF0C;&#x6240;&#x8282;&#x7EA6;&#x7684;&#x4E1C;&#x897F;&#x5411;&#x6D41;&#x91CF;&#x662F;&#x975E;&#x5E38;&#x663E;&#x8457;&#x7684;&#x3002;&#x7279;&#x522B;&#x662F;&#x654F;&#x6377;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x4EE3;&#x7801;&#x53D8;&#x66F4;&#x7684;&#x9891;&#x7E41;&#x5EA6;&#x8981;&#x6BD4;&#x4F9D;&#x8D56;&#x53D8;&#x66F4;&#x7684;&#x9891;&#x7E41;&#x5EA6;&#x9AD8;&#x5F88;&#x591A;&#xFF0C;&#x6BCF;&#x6B21;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x4F9D;&#x8D56;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6D41;&#x91CF;&#x548C;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x6D6A;&#x8D39;&#x3002;</p><h3 id="context-dao-di-shi-yi-ge-shi-me-gai-nian"><a href="#context-&#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F;" class="headerlink" title="context &#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F;"></a><code>context</code> &#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F; <a href="#context-dao-di-shi-yi-ge-shi-me-gai-nian" class="header-anchor">#</a></h3><p><code>context</code>&#xFF0C;<strong>&#x4E0A;&#x4E0B;&#x6587;</strong>&#xFF0C;&#x662F; <code>docker build</code> &#x4E2D;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x3002;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x5FC5;&#x987B;&#x6307;&#x5B9A; <code>context</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t xxx &lt;context&#x8DEF;&#x5F84;&gt;</span><br></pre></td></tr></table></figure><p>&#x6216;&#x8005; <code>docker-compose.yml</code> &#x4E2D;&#x7684;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">        <span class="attr">context:</span> <span class="string">&lt;context&#x8DEF;&#x5F84;&gt;</span></span><br><span class="line">        <span class="attr">dockerfile:</span> <span class="string">dockerfile</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x90FD;&#x9700;&#x8981;&#x6307;&#x5B9A; <code>context</code>&#x3002;</p><p><code>context</code> &#x662F;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x4E0D;&#x8981;&#x548C;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;<code>Dockerfile</code> &#x4E2D;&#x7684; <code>WORKDIR</code> &#x5F04;&#x6DF7;&#xFF0C;<code>context</code> &#x662F; <code>docker build</code> &#x547D;&#x4EE4;&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x3002;</p><p><code>docker build</code> &#x547D;&#x4EE4;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x771F;&#x6B63;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x5E76;&#x975E;&#x7531;&#x8BE5;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x5B8C;&#x6210;&#x3002;<code>docker build</code> &#x547D;&#x4EE4;&#x5C06; <code>context</code> &#x7684;&#x76EE;&#x5F55;&#x4E0A;&#x4F20;&#x7ED9; <code>Docker</code> &#x5F15;&#x64CE;&#xFF0C;&#x7531;&#x5B83;&#x8D1F;&#x8D23;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x3002;</p><p>&#x5728; Dockerfile &#x4E2D;&#x5982;&#x679C;&#x5199; <code>COPY ./package.json /app/</code> &#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x610F;&#x601D;&#x5E76;&#x4E0D;&#x662F;&#x6307;&#x6267;&#x884C; <code>docker build</code> &#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>package.json</code>&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x6307; <code>Dockerfile</code> &#x6240;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>package.json</code>&#xFF0C;&#x800C;&#x662F;&#x6307; <code>context</code> &#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>package.json</code>&#x3002;</p><p>&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x4EBA;&#x53D1;&#x73B0; <code>COPY ../package.json /app</code> &#x6216;&#x8005; <code>COPY /opt/xxxx /app</code> &#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x90FD;&#x5728; <code>context</code> &#x4E4B;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x771F;&#x6B63;&#x9700;&#x8981;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x5B83;&#x4EEC;&#x590D;&#x5236;&#x5230; <code>context</code> &#x76EE;&#x5F55;&#x4E0B;&#x518D;&#x64CD;&#x4F5C;&#x3002;</p><p>&#x8BDD;&#x8BF4;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;&#x7F51;&#x6587;&#x751A;&#x81F3;&#x641E;&#x7B11;&#x7684;&#x8BF4;&#x8981;&#x628A; <code>Dockerfile</code> &#x653E;&#x5230;&#x78C1;&#x76D8;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x624D;&#x80FD;&#x6784;&#x5EFA;&#x5982;&#x4F55;&#x5982;&#x4F55;&#x3002;&#x8FD9;&#x90FD;&#x662F;&#x5BF9; <code>context</code> &#x5B8C;&#x5168;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x8868;&#x73B0;&#x3002;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x628A;&#x6574;&#x4E2A;&#x78C1;&#x76D8;<strong>&#x51E0;&#x5341;&#x4E2A; GB</strong>&#x5F53;&#x505A;&#x4E0A;&#x4E0B;&#x6587;&#x53D1;&#x9001;&#x7ED9; <code>dockerd</code> &#x5F15;&#x64CE;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x1F631;&#x2026;&#x2026;</p><p><code>docker build -t xxx .</code> &#x4E2D;&#x7684;&#x8FD9;&#x4E2A;<code>.</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5728;&#x6307;&#x5B9A; <code>Context</code> &#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x5E76;&#x975E;&#x662F;&#x6307;&#x5B9A; <code>Dockerfile</code> &#x6240;&#x5728;&#x76EE;&#x5F55;&#x3002;</p><p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x989D;&#x5916;&#x6307;&#x5B9A; <code>Dockerfile</code> &#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x5C06; <code>Context</code> &#x4E0B;&#x7684;&#x540D;&#x4E3A; <code>Dockerfile</code> &#x7684;&#x6587;&#x4EF6;&#x4F5C;&#x4E3A; <code>Dockerfile</code>&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x4EBA;&#x4F1A;&#x6DF7;&#x6DC6;&#xFF0C;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E2A; <code>.</code> &#x662F;&#x5728;&#x8BF4; <code>Dockerfile</code> &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#x3002;</p><p>&#x4E00;&#x822C;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;<code>Dockerfile</code> &#x53EF;&#x80FD;&#x88AB;&#x653E;&#x7F6E;&#x4E8E;&#x4E24;&#x4E2A;&#x4F4D;&#x7F6E;&#x3002;</p><ul><li>&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x662F;&#x653E;&#x7F6E;&#x4E8E;&#x9879;&#x76EE;&#x9876;&#x7EA7;&#x76EE;&#x5F55;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x662F;&#x5728;&#x9876;&#x7EA7;&#x76EE;&#x5F55;&#x6784;&#x5EFA;&#x65F6;&#xFF0C;&#x9879;&#x76EE;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x90FD;&#x5728;&#x4E0A;&#x4E0B;&#x6587;&#x5185;&#xFF0C;&#x65B9;&#x4FBF;&#x6784;&#x5EFA;&#xFF1B;</li><li>&#x53E6;&#x4E00;&#x4E2A;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x5C06;&#x6240;&#x6709; Docker &#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x96C6;&#x4E2D;&#x4E8E;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x6BD4;&#x5982; <code>docker</code> &#x76EE;&#x5F55;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6240;&#x6709;&#x4E0D;&#x540C;&#x5206;&#x652F;&#x7684; <code>Dockerfile</code>&#xFF0C;&#x4EE5;&#x53CA; <code>docker-compose.yml</code> &#x7C7B;&#x7684;&#x6587;&#x4EF6;&#x3001;entrypoint &#x7684;&#x811A;&#x672C;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x6240;&#x5728;&#x76EE;&#x5F55;&#x4E0D;&#x518D;&#x662F; <code>Dockerfile</code> &#x6240;&#x5728;&#x76EE;&#x5F55;&#x4E86;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</li></ul><p>&#x6B64;&#x5916;&#xFF0C;&#x9879;&#x76EE;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x6784;&#x5EFA;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x53D1;&#x9001;&#x7ED9; <code>dockerd</code> &#x5F15;&#x64CE;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x5904;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>.dockerignore</code> &#x6587;&#x4EF6;&#x6765;&#x8FC7;&#x6EE4;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5185;&#x5BB9;&#x3002;<code>.dockerignore</code> &#x6587;&#x4EF6;&#x5E94;&#x8BE5;&#x653E;&#x7F6E;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x9876;&#x7EA7;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5185;&#x5BB9;&#x683C;&#x5F0F;&#x548C; <code>.gitignore</code> &#x4E00;&#x6837;&#x3002;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp</span><br><span class="line">db</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5C31;&#x8FC7;&#x6EE4;&#x4E86; <code>tmp</code> &#x548C; <code>db</code> &#x76EE;&#x5F55;&#xFF0C;&#x5B83;&#x4EEC;&#x4E0D;&#x4F1A;&#x88AB;&#x4F5C;&#x4E3A;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x53D1;&#x7ED9; <code>dockerd</code> &#x5F15;&#x64CE;&#x3002;</p><blockquote><p>&#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x4F60;&#x7684; <code>docker build</code> &#x9700;&#x8981;&#x53D1;&#x9001;&#x5E9E;&#x5927;&#x7684; Context &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x6765;&#x68C0;&#x67E5;&#x662F;&#x4E0D;&#x662F; <code>.dockerignore</code> &#x5FD8;&#x4E86;&#x64B0;&#x5199;&#xFF0C;&#x6216;&#x8005;&#x5FD8;&#x4E86;&#x8FC7;&#x6EE4;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x4E86;&#x3002;</p></blockquote><h3 id="entrypoint-he-cmd-dao-di-you-shi-me-bu-tong"><a href="#ENTRYPOINT-&#x548C;-CMD-&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;" class="headerlink" title="ENTRYPOINT &#x548C; CMD &#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;"></a><code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F; <a href="#entrypoint-he-cmd-dao-di-you-shi-me-bu-tong" class="header-anchor">#</a></h3><p><code>Dockerfile</code> &#x7684;&#x76EE;&#x7684;&#x662F;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x51C6;&#x5907;&#x7684;&#x662F;&#x4E3B;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;&#x90A3;&#x4E48;&#x51C6;&#x5907;&#x597D;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x624D;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x542F;&#x52A8;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x8C03;&#x7528; <code>ENTRYPOINT</code>&#xFF0C;&#x5E76;&#x4E14;&#x628A; <code>CMD</code> &#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x8FDB;&#x53BB;&#x8FD0;&#x884C;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x7684;&#x6982;&#x5FF5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT <span class="string">&quot;CMD&quot;</span></span><br></pre></td></tr></table></figure><p>&#x5047;&#x8BBE;&#x6709;&#x4E2A; <code>myubuntu</code> &#x955C;&#x50CF; <code>ENTRYPOINT</code> &#x662F; <code>sh -c</code>&#xFF0C;&#x800C;&#x6211;&#x4EEC; <code>docker run -it myubuntu uname -a</code>&#x3002;&#x90A3;&#x4E48; <code>uname -a</code> &#x5C31;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x6307;&#x5B9A;&#x7684; <code>CMD</code>&#xFF0C;&#x90A3;&#x4E48; Docker &#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;&#x5C31;&#x662F;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&quot;uname -a&quot;</span></span><br></pre></td></tr></table></figure><ul><li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>ENTRYPOINT</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EA;&#x6267;&#x884C; <code>CMD</code>&#xFF1B;</li><li>&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86; <code>ENTRYPOINT</code> &#x800C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>CMD</code>&#xFF0C;&#x81EA;&#x7136;&#x6267;&#x884C; <code>ENTRYPOINT</code>;</li><li>&#x5982;&#x679C; <code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x90FD;&#x6307;&#x5B9A;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5982;&#x540C;&#x4E0A;&#x9762;&#x6240;&#x8FF0;&#xFF0C;&#x6267;&#x884C; <code>ENTRYPOINT &quot;CMD&quot;</code>&#xFF1B;</li><li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>ENTRYPOINT</code>&#xFF0C;&#x800C; <code>CMD</code> &#x7528;&#x7684;&#x662F;&#x4E0A;&#x8FF0;&#x90A3;&#x79CD; shell &#x547D;&#x4EE4;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5219;&#x81EA;&#x52A8;&#x4F7F;&#x7528; <code>sh -c</code> &#x4F5C;&#x4E3A; <code>ENTRYPOINT</code>&#x3002;</li></ul><p>&#x6CE8;&#x610F;&#x6700;&#x540E;&#x4E00;&#x70B9;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x8FD9;&#x4E2A;&#x533A;&#x522B;&#x5BFC;&#x81F4;&#x4E86;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x653E;&#x5230; <code>CMD</code> &#x548C; <code>ENTRYPOINT</code> &#x4E0B;&#x6548;&#x679C;&#x4E0D;&#x540C;&#xFF0C;&#x56E0;&#x6B64;&#x6709;&#x53EF;&#x80FD;&#x653E;&#x5728; <code>ENTRYPOINT</code> &#x4E0B;&#x7684;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x7531;&#x4E8E;&#x9700;&#x8981; <code>tty</code> &#x800C;&#x8FD0;&#x884C;&#x65F6;&#x5FD8;&#x8BB0;&#x4E86;&#x7ED9;&#xFF08;&#x6BD4;&#x5982;&#x5FD8;&#x8BB0;&#x4E86;<code>docker-compose.yml</code> &#x7684; <code>tty:true</code>&#xFF09;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x53EF;&#x4EE5;&#x5F88;&#x7075;&#x6D3B;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x505A;&#x4E2A; <code>git</code> &#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x628A; <code>git</code> &#x547D;&#x4EE4;&#x6307;&#x5B9A;&#x4E3A; <code>ENTRYPOINT</code>&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5728; <code>docker run</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76F4;&#x63A5;&#x8DDF;&#x5B50;&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x3002;&#x6BD4;&#x5982; <code>docker run git log</code> &#x5C31;&#x662F;&#x663E;&#x793A;&#x65E5;&#x5FD7;&#x3002;</p><h3 id="na-dao-yi-ge-jing-xiang-ru-he-huo-de-jing-xiang-de-dockerfile"><a href="#&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684;-Dockerfile-&#xFF1F;" class="headerlink" title="&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684; Dockerfile &#xFF1F;"></a>&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code> &#xFF1F; <a href="#na-dao-yi-ge-jing-xiang-ru-he-huo-de-jing-xiang-de-dockerfile" class="header-anchor">#</a></h3><ul><li>&#x76F4;&#x63A5;&#x53BB; Docker Hub &#x4E0A;&#x770B;&#xFF1A;&#x5927;&#x591A;&#x6570; Docker Hub &#x4E0A;&#x7684;&#x955C;&#x50CF;&#x90FD;&#x4F1A;&#x6709; <code>Dockerfile</code>&#xFF0C;&#x76F4;&#x63A5;&#x5728; Docker Hub &#x7684;&#x955C;&#x50CF;&#x9875;&#x9762;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>Dockerfile</code> &#x7684;&#x94FE;&#x63A5;&#xFF1B;</li><li>&#x5982;&#x679C;&#x662F;&#x81EA;&#x5DF1;&#x516C;&#x53F8;&#x505A;&#x7684;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6253;&#x4E2A;&#x7535;&#x8BDD;&#x3001;&#x53D1;&#x4E2A;&#x6D88;&#x606F;&#x95EE;&#x4E00;&#x4E0B;&#x3002;&#x522B;&#x770B;&#x8FD9;&#x4E2A;&#x8BF4;&#x6CD5;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x50BB;&#xFF0C;&#x4E0D;&#x5C11;&#x4EBA;&#x90FD;&#x5B81;&#x53EF;&#x81EA;&#x5DF1;&#x7422;&#x78E8;&#x4E5F;&#x4E0D;&#x53BB;&#x95EE;&#xFF1B;</li><li>&#x5982;&#x679C;&#x6CA1;&#x6709; <code>Dockerfile</code>&#xFF0C;&#x4E00;&#x822C;&#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#x5C31;&#x4E0D;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x8FD9;&#x7C7B;&#x9ED1;&#x7BB1;&#x4F3C;&#x7684;&#x955C;&#x50CF;&#x5F88;&#x5BB9;&#x6709;&#x6709;&#x95EE;&#x9898;&#x3002;&#x5982;&#x679C;&#x662F;&#x4EC0;&#x4E48;&#x7279;&#x6B8A;&#x539F;&#x56E0;&#xFF0C;&#x90A3;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x770B;&#xFF1B;</li><li><code>docker history</code> &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x955C;&#x50CF;&#x6BCF;&#x4E00;&#x5C42;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x547D;&#x4EE4;&#xFF0C;&#x5F53;&#x7136;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x7684; <code>commit</code> &#x770B;&#x4E0D;&#x89C1;&#x64CD;&#x4F5C;&#xFF1B;</li><li><code>docker inspect</code> &#x53EF;&#x4EE5;&#x5206;&#x6790;&#x955C;&#x50CF;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#x3002;</li><li>&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x955C;&#x50CF;&#xFF0C;&#x8FDB;&#x5165;<code>shell</code>&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x53BB;&#x8FDB;&#x4E00;&#x6B65;&#x5206;&#x6790;&#x65E5;&#x5FD7;&#x3001;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x53CA;&#x53D8;&#x5316;&#x3002;</li><li>&#x7ECF;&#x8FC7;&#x5206;&#x6790;&#x540E;&#xFF0C;&#x81EA;&#x5DF1;&#x5199; <code>Dockerfile</code> &#x8FD8;&#x539F;&#x64CD;&#x4F5C;&#x3002;</li></ul><h3 id="zai-ni-de-lnmp-de-li-zi-zhong-php-de-dockerfile-li-mian-de-gou-jian-yi-lai-he-yun-xing-yi-lai-du-shi-shi-me-yi-si"><a href="#&#x5728;&#x4F60;&#x7684;-LNMP-&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP-&#x7684;-Dockerfile-&#x91CC;&#x9762;&#x7684;-&#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D;-&#x548C;-&#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D;-&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;" class="headerlink" title="&#x5728;&#x4F60;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP &#x7684; Dockerfile &#x91CC;&#x9762;&#x7684; &#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D; &#x548C; &#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D; &#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;"></a>&#x5728;&#x4F60;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP &#x7684; <code>Dockerfile</code> &#x91CC;&#x9762;&#x7684; &#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D; &#x548C; &#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D; &#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F; <a href="#zai-ni-de-lnmp-de-li-zi-zhong-php-de-dockerfile-li-mian-de-gou-jian-yi-lai-he-yun-xing-yi-lai-du-shi-shi-me-yi-si" class="header-anchor">#</a></h3><p>&#x8FD9;&#x91CC;&#x6240;&#x63D0;&#x5230;&#x7684;&#x662F;&#x6211;&#x7684;&#x90A3;&#x4E2A; LNMP &#x4F8B;&#x5B50;&#x7684; <code>php</code> &#x670D;&#x52A1;&#x7684; <code>Dockerfile</code>&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/php/Dockerfile" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/php/Dockerfile</a></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">7</span>-fpm</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash"><span class="comment"># &quot;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&quot;</span></span></span><br><span class="line">    &amp;&amp; buildDeps=<span class="string">&quot; \</span></span><br><span class="line"><span class="string">        build-essential \</span></span><br><span class="line"><span class="string">        php5-dev \</span></span><br><span class="line"><span class="string">        libfreetype6-dev \</span></span><br><span class="line"><span class="string">        libjpeg62-turbo-dev \</span></span><br><span class="line"><span class="string">        libmcrypt-dev \</span></span><br><span class="line"><span class="string">        libpng12-dev \</span></span><br><span class="line"><span class="string">    &quot;</span> \</span><br><span class="line"><span class="comment"># &quot;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&quot;</span></span><br><span class="line">    &amp;&amp; runtimeDeps=<span class="string">&quot; \</span></span><br><span class="line"><span class="string">        libfreetype6 \</span></span><br><span class="line"><span class="string">        libjpeg62-turbo \</span></span><br><span class="line"><span class="string">        libmcrypt4 \</span></span><br><span class="line"><span class="string">        libpng12-0 \</span></span><br><span class="line"><span class="string">    &quot;</span> \</span><br><span class="line"><span class="comment"># &quot;&#x5B89;&#x88C5; php &#x4EE5;&#x53CA;&#x7F16;&#x8BD1;&#x6784;&#x5EFA;&#x7EC4;&#x4EF6;&#x6240;&#x9700;&#x5305;&quot;</span></span><br><span class="line">    &amp;&amp; apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y ${runtimeDeps} ${buildDeps} --no-install-recommends \</span><br><span class="line"><span class="comment"># &quot;&#x7F16;&#x8BD1;&#x5B89;&#x88C5; php &#x7EC4;&#x4EF6;&quot;</span></span><br><span class="line">    &amp;&amp; docker-php-ext-install iconv mcrypt mysqli pdo pdo_mysql zip \</span><br><span class="line">    &amp;&amp; docker-php-ext-configure gd \</span><br><span class="line">        --with-freetype-dir=/usr/include/ \</span><br><span class="line">        --with-jpeg-dir=/usr/include/ \</span><br><span class="line">    &amp;&amp; docker-php-ext-install gd \</span><br><span class="line"><span class="comment"># &quot;&#x6E05;&#x7406;&quot;</span></span><br><span class="line">    &amp;&amp; apt-get purge -y --auto-remove \</span><br><span class="line">        -o APT::AutoRemove::RecommendsImportant=false \</span><br><span class="line">        -o APT::AutoRemove::SuggestsImportant=false \</span><br><span class="line">        $buildDeps \</span><br><span class="line">    &amp;&amp; rm -rf /var/cache/apt/* \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x662F;&#x9488;&#x5BF9; <code>php</code> &#x955C;&#x50CF;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B; <code>php:7-fpm</code> &#x4E2D;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x6240;&#x9700;&#x7684; <code>mysqli</code>, <code>pdo_mysql</code>, <code>gd</code> &#x7B49;&#x7EC4;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x5B89;&#x88C5;&#xFF0C;&#x800C;&#x4E14;&#xFF0C;&#x90E8;&#x5206;&#x7EC4;&#x4EF6;&#x8FD8;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x6D89;&#x53CA;&#x4E86;&#x4E24;&#x7C7B;&#x4F9D;&#x8D56;&#x5E93;/&#x5DE5;&#x5177;&#xFF0C;&#x4E00;&#x7C7B;&#x662F;&#x5B89;&#x88C5;&#x3001;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#xFF1B;&#x53E6;&#x4E00;&#x7C7B;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x6240;&#x9700;&#x7684;&#x4F9D;&#x8D56;&#x3002;&#x8981;&#x8BB0;&#x4F4F; <code>Dockerfile</code> &#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x4E2D;&#x8981;&#x6C42;&#x6700;&#x7EC8;&#x955C;&#x50CF;&#x53EA;&#x5E94;&#x8BE5;&#x4FDD;&#x7559;&#x6700;&#x5C0F;&#x7684;&#x6240;&#x9700;&#x4F9D;&#x8D56;&#xFF0C;&#x56E0;&#x6B64;&#x5B89;&#x88C5;&#x6784;&#x5EFA;&#x7684;&#x4F9D;&#x8D56;&#x5E94;&#x8BE5;&#x5728;&#x5B89;&#x88C5;&#x7ED3;&#x675F;&#x540E;&#x6E05;&#x9664;&#xFF0C;&#x8FD9;&#x4E00;&#x5C42;&#x53EA;&#x4FDD;&#x7559;&#x771F;&#x6B63;&#x9700;&#x8981;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x4F9D;&#x8D56;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x8FD9;&#x91CC;&#x533A;&#x5206;&#x4E86; <code>buildDeps</code> &#x548C; <code>runtimeDeps</code> &#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5B89;&#x88C5;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x5378;&#x8F7D;&#x3001;&#x6E05;&#x7406; <code>buildDeps</code> &#x7684;&#x4F9D;&#x8D56;&#x3002;&#x8FD9;&#x6837;&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x65E0;&#x5173;&#x7684;&#x4E1C;&#x897F;&#x8FD8;&#x5728;&#x8BE5;&#x5C42;&#x4E2D;&#x3002;</p><h3 id="ying-yong-dai-ma-shi-ying-gai-gua-zai-su-zhu-mu-lu-huan-shi-fang-ru-jing-xiang-nei"><a href="#&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F;" class="headerlink" title="&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F;"></a>&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F; <a href="#ying-yong-dai-ma-shi-ying-gai-gua-zai-su-zhu-mu-lu-huan-shi-fang-ru-jing-xiang-nei" class="header-anchor">#</a></h3><p>&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p><p>&#x5982;&#x679C;&#x4EE3;&#x7801;&#x53D8;&#x52A8;&#x975E;&#x5E38;&#x9891;&#x7E41;&#xFF0C;&#x6BD4;&#x5982;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#xFF0C;&#x4EE3;&#x7801;&#x51E0;&#x4E4E;&#x6BCF;&#x51E0;&#x5206;&#x949F;&#x5C31;&#x9700;&#x8981;&#x53D8;&#x52A8;&#x8C03;&#x8BD5;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--volume</code> &#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7684;&#x529E;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x6784;&#x5EFA;&#x65B0;&#x955C;&#x50CF;&#xFF0C;&#x76F4;&#x63A5;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x52A0;&#x8F7D;&#x6700;&#x65B0;&#x4EE3;&#x7801;&#xFF0C;&#x751A;&#x81F3;&#x6709;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x4ECE;&#x800C;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p><p>&#x5982;&#x679C;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x9891;&#x7E41;&#x53D8;&#x52A8;&#xFF0C;&#x6BD4;&#x5982;&#x53D1;&#x5E03;&#x9636;&#x6BB5;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x6784;&#x5EFA;&#x597D;&#x7684;&#x5E94;&#x7528;&#x653E;&#x5165;&#x955C;&#x50CF;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x662F;&#x4F7F;&#x7528; CI/CD &#x5DE5;&#x5177;&#xFF0C;&#x5982; <code>Jenkins</code>, <code>Drone.io</code>, <code>Gitlab CI</code> &#x7B49;&#xFF0C;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x3001;&#x53D1;&#x5E03;&#x955C;&#x50CF;&#x3001;&#x4EE5;&#x53CA;&#x5206;&#x6B65;&#x53D1;&#x5E03;&#x4E0A;&#x7EBF;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E5F;&#x662F;&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x9891;&#x7E41;&#x53D8;&#x66F4;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#xFF0C;&#x6216;&#x8005;&#x52A8;&#x6001;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5377;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x5E76;&#x975E;&#x9891;&#x7E41;&#x53D8;&#x66F4;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x5176;&#x7EB3;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x4E2D;&#xFF0C;&#x8D70; CI/CD &#x6D41;&#x7A0B;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;</p><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x867D;&#x7136;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x5229;&#x4E8E;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x56E0;&#x4E3A;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x524D;&#x8FD8;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x96C6;&#x7FA4;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x540C;&#x6B65;&#x5B58;&#x5728;&#x6240;&#x6302;&#x8F7D;&#x7684;&#x76EE;&#x5F55;&#x53CA;&#x5176;&#x5185;&#x5BB9;&#x3002;&#x56E0;&#x6B64;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x66F4;&#x503E;&#x5411;&#x4E8E;&#x5C06;&#x5E94;&#x7528;&#x6253;&#x5165;&#x955C;&#x50CF;&#xFF0C;&#x65B9;&#x4FBF;&#x90E8;&#x7F72;&#x3002;</p><h3 id="wei-shi-me-zai-dockerfile-zhong-zhi-xing-dao-ru-sql-service-xxx-start-bu-guan-yong"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x5728;-Dockerfile-&#x4E2D;&#x6267;&#x884C;&#xFF08;&#x5BFC;&#x5165;-sql&#x3001;service-xxx-start&#xFF09;&#x4E0D;&#x7BA1;&#x7528;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x5728; Dockerfile &#x4E2D;&#x6267;&#x884C;&#xFF08;&#x5BFC;&#x5165; .sql&#x3001;service xxx start&#xFF09;&#x4E0D;&#x7BA1;&#x7528;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x6267;&#x884C;&#xFF08;&#x5BFC;&#x5165; <code>.sql</code>&#x3001;<code>service xxx start</code>&#xFF09;&#x4E0D;&#x7BA1;&#x7528;&#xFF1F; <a href="#wei-shi-me-zai-dockerfile-zhong-zhi-xing-dao-ru-sql-service-xxx-start-bu-guan-yong" class="header-anchor">#</a></h3><p>&#x8FD9;&#x662F;&#x5178;&#x578B;&#x7684;&#x5BF9; <code>Dockerfile</code> &#x4EE5;&#x53CA;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x4E0D;&#x4E86;&#x89E3;&#x3002;</p><blockquote><p><code>Dockerfile</code> &#x4E0D;&#x662F; <code>shell</code> &#x811A;&#x672C;&#xFF0C;&#x800C;&#x662F;&#x5B9A;&#x5236; <code>rootfs</code> &#x7684;&#x811A;&#x672C;&#x3002;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x6784;&#x5EFA;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#x3002;</p></blockquote><p>&#x5BFC;&#x5165; <code>.sql</code> &#x6587;&#x4EF6;&#x5230;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4FEE;&#x6539;&#x7684;&#x662F;&#x6570;&#x636E;&#x5E93;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x4E8E;&#x5377;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x533F;&#x540D;&#x5377;&#xFF0C;&#x56E0;&#x6B64;&#x5F53;&#x5BFC;&#x5165;&#x884C;&#x4E3A;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x6784;&#x5EFA;&#x8BE5;&#x5C42;&#x7684;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#xFF0C;&#x533F;&#x540D;&#x5377;&#x88AB;&#x629B;&#x5F03;&#xFF0C;&#x6240;&#x6709;&#x5BFC;&#x5165;&#x884C;&#x4E3A;&#x90FD;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x8C13;&#x7684;&#x5BFC;&#x5165; <code>.sql</code> &#x7684;&#x884C;&#x4E3A;&#x5728; <code>Dockerfile</code> &#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x3002;</p><p>&#x800C; <code>service xxxx start</code> &#x4E5F;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#xFF0C;&#x8FD9;&#x662F;&#x542F;&#x52A8;&#x540E;&#x53F0;&#x670D;&#x52A1;&#xFF0C;&#x4E14;&#x4E0D;&#x8BF4; Docker &#x4E2D;&#x4E0D;&#x7528;&#x540E;&#x53F0;&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x79CD;&#x542F;&#x52A8;&#x884C;&#x4E3A;&#x5BF9;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6839;&#x672C;&#x6CA1;&#x5F71;&#x54CD;&#xFF0C;&#x8FD9;&#x4EC5;&#x4EC5;&#x662F;&#x8BA9;&#x540E;&#x53F0;&#x5728;&#x6784;&#x5EFA;&#x6240;&#x7528;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E00;&#x4E0B;&#xFF0C;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x3002;&#x6700;&#x540E;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E86;&#xFF0C;&#x8BE5;&#x6CA1;&#x542F;&#x52A8;&#x7684;&#x4E1C;&#x897F;&#x8FD8;&#x662F;&#x4E0D;&#x4F1A;&#x542F;&#x52A8;&#x3002;</p><p>&#x4F46;&#x662F;&#x4E0D;&#x8981;&#x56E0;&#x6B64;&#x5C31;&#x76F2;&#x76EE;&#x7684;&#x5F97;&#x51FA; <code>Dockerfile</code> &#x65E0;&#x6CD5;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x5E93;&#x7684;&#x7ED3;&#x8BBA;&#x3002;&#x6240;&#x6709;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#x90FD;&#x8003;&#x8651;&#x5230;&#x4E86;&#x5B9A;&#x5236;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53BB;&#x770B;&#x7279;&#x5B9A;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#x7684;&#x6587;&#x6863;&#xFF0C;&#x57FA;&#x672C;&#x90FD;&#x4F1A;&#x770B;&#x5230;&#x5B9A;&#x5236;&#x3001;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p><p>&#x6BD4;&#x5982;&#x5B98;&#x65B9; <code>mysql</code> &#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x521D;&#x59CB;&#x5316;&#x7684; <code>.sql</code> &#x811A;&#x672C;&#x6587;&#x4EF6;&#x5728; <code>Dockerfile</code> &#x4E2D; <code>COPY</code> &#x81F3; <code>/docker-entrypoint-initdb.d/</code> &#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x6240;&#x6302;&#x8F7D;&#x7684;&#x5377;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x4F9D;&#x6B21;<a href="https://github.com/docker-library/mysql/blob/4dd33136c4739667a223d39b6f829beb27b235cf/5.7/docker-entrypoint.sh#L151" target="_blank" rel="noopener">&#x6267;&#x884C;&#x8BE5;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x6587;&#x4EF6;</a>&#xFF0C;&#x4ECE;&#x800C;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x5E93;&#x521D;&#x59CB;&#x5316;&#x3001;&#x5BFC;&#x5165;&#x7B49;&#x529F;&#x80FD;&#x3002;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> mysql:<span class="number">5.7</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> mysql-data-backup.sql /docker-entrypoint-initdb.d/</span></span><br></pre></td></tr></table></figure><h3 id="wei-shi-me-ji-yu-alpine-de-jing-xiang-na-me-xiao-wo-ke-yi-du-huan-cheng-ji-yu-alpine-de-jing-xiang-me"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x57FA;&#x4E8E;-Alpine-&#x7684;&#x955C;&#x50CF;&#x90A3;&#x4E48;&#x5C0F;&#xFF1F;&#x6211;&#x53EF;&#x4EE5;&#x90FD;&#x6362;&#x6210;&#x57FA;&#x4E8E;-Alpine-&#x7684;&#x955C;&#x50CF;&#x4E48;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x57FA;&#x4E8E; Alpine &#x7684;&#x955C;&#x50CF;&#x90A3;&#x4E48;&#x5C0F;&#xFF1F;&#x6211;&#x53EF;&#x4EE5;&#x90FD;&#x6362;&#x6210;&#x57FA;&#x4E8E; Alpine &#x7684;&#x955C;&#x50CF;&#x4E48;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x57FA;&#x4E8E; Alpine &#x7684;&#x955C;&#x50CF;&#x90A3;&#x4E48;&#x5C0F;&#xFF1F;&#x6211;&#x53EF;&#x4EE5;&#x90FD;&#x6362;&#x6210;&#x57FA;&#x4E8E; Alpine &#x7684;&#x955C;&#x50CF;&#x4E48;&#xFF1F; <a href="#wei-shi-me-ji-yu-alpine-de-jing-xiang-na-me-xiao-wo-ke-yi-du-huan-cheng-ji-yu-alpine-de-jing-xiang-me" class="header-anchor">#</a></h3><p><code>Alpine Linux</code> &#x4F53;&#x79EF;&#x5C0F;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x57FA;&#x7840;&#x547D;&#x4EE4;&#x6765;&#x81EA;&#x7CBE;&#x7B80;&#x7684; <code>busybox</code>&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x7B80;&#x5316;&#x5B9E;&#x73B0;&#x7684; <code>musl</code> &#x4F5C;&#x4E3A;&#x5E93;&#x652F;&#x6301;&#xFF0C;&#x800C;&#x5E76;&#x975E;&#x5B8C;&#x6574;&#x7684; <code>glibc</code>&#x3002;<code>musl</code> &#x4F53;&#x79EF;&#x5C0F;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x6709;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x822C;&#x4E0D;&#x7528; <code>Alpine</code> &#x7684;&#x955C;&#x50CF;&#xFF0C;&#x9664;&#x975E;&#x7A7A;&#x95F4;&#x53D7;&#x9650;&#xFF0C;&#x4F53;&#x79EF;&#x5927;&#x5C0F;&#x5F88;&#x5173;&#x952E;&#x65F6;&#x624D;&#x4F1A;&#x4F7F;&#x7528;&#x3002;</p><p>&#x8FC7;&#x53BB;&#x51FA;&#x73B0;&#x8FC7;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x968F;&#x7740; <code>Docker</code> &#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x5BF9; <code>Alpine</code> &#x7684;&#x9700;&#x6C42;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#x4F1A;&#x88AB;&#x53D1;&#x73B0;&#x3001;&#x4FEE;&#x590D;&#xFF0C;&#x6240;&#x4EE5;&#x76F8;&#x4FE1;&#x5728;&#x672A;&#x6765;&#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x73B0;&#x5728;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x8FDB;&#x884C;&#x91CD;&#x590D;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x81EA;&#x5DF1;&#x7684; <code>bug</code>&#x3002;</p><h3 id="ke-yi-kan-dao-jing-xiang-ge-ceng-de-yi-lai-guan-xi-me"><a href="#&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x955C;&#x50CF;&#x5404;&#x5C42;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x4E48;&#xFF1F;" class="headerlink" title="&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x955C;&#x50CF;&#x5404;&#x5C42;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x4E48;&#xFF1F;"></a>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x955C;&#x50CF;&#x5404;&#x5C42;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x4E48;&#xFF1F; <a href="#ke-yi-kan-dao-jing-xiang-ge-ceng-de-yi-lai-guan-xi-me" class="header-anchor">#</a></h3><p>&#x955C;&#x50CF;&#x662F;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x955C;&#x50CF;&#x4E4B;&#x95F4;&#x4E5F;&#x53EF;&#x4EE5;&#x4F9D;&#x8D56;&#xFF0C;&#x56E0;&#x6B64;&#x5229;&#x7528; Docker &#x955C;&#x50CF;&#x5F88;&#x5BB9;&#x6613;&#x5B9E;&#x73B0;&#x91CD;&#x590D;&#x7684;&#x90E8;&#x5206;&#x590D;&#x7528;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6709;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x53EF;&#x89C6;&#x5316;&#x7684;&#x770B;&#x5230;&#x955C;&#x50CF;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x5462;&#xFF1F;</p><p>&#x5F88;&#x65E9;&#x4EE5;&#x524D;&#xFF0C;Docker &#x6709;&#x4E2A; <code>docker images --tree</code> &#x7684;&#x547D;&#x4EE4;&#x7684;&#xFF0C;&#x540E;&#x6765;&#x968F;&#x7740;&#x955C;&#x50CF;&#x5206;&#x5C42;&#x5E73;&#x9762;&#x5316;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x53D6;&#x6D88;&#x4E86;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;Nate Jones &#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x4E8E;&#x53EF;&#x89C6;&#x5316;&#x955C;&#x50CF;&#x5206;&#x5C42;&#x4F9D;&#x8D56;&#xFF0C;&#x53EB;&#x505A; <strong>dockviz</strong>&#xFF1A;<a href="https://github.com/justone/dockviz" target="_blank" rel="noopener">https://github.com/justone/dockviz</a></p><p>&#x5BF9;&#x4E8E; Mac &#x5E73;&#x53F0;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528; <code>brew</code> &#x6765;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install dockviz</span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;&#x5176;&#x5B83;&#x5E73;&#x53F0;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x53BB;<a href="https://github.com/justone/dockviz/releases" target="_blank" rel="noopener">&#x53D1;&#x5E03;&#x9875;&#x9762;</a>&#x4E0B;&#x8F7D;&#x3002;</p><p>&#x5B89;&#x88C5;&#x597D;&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x6267;&#x884C; <code>dockviz images --tree</code> &#x5373;&#x53EF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ dockviz images --tree</span><br><span class="line">&#x251C;&#x2500;&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">&#x2502; &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">&#x2502;   &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">&#x2502;     &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">&#x2502;       &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">&#x2502;         &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">&#x2502;           &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">&#x2502;             &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">&#x2502;               &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">&#x2502;                 &#x2514;&#x2500;0b5dec81616c Virtual Size: 108.3 MB Tags: nginx:latest</span><br><span class="line">&#x2514;&#x2500;&lt;missing&gt; Virtual Size: 100.1 MB</span><br><span class="line">  &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 100.1 MB</span><br><span class="line">    &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 123.9 MB</span><br><span class="line">      &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 131.2 MB</span><br><span class="line">        &#x251C;&#x2500;&lt;missing&gt; Virtual Size: 272.8 MB</span><br><span class="line">        &#x2502; &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;   &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;     &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;       &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;         &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;           &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;             &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;               &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        &#x2502;                 &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 737.9 MB</span><br><span class="line">        &#x2502;                   &#x2514;&#x2500;4551430cfe80 Virtual Size: 738.3 MB Tags: openjdk:latest</span><br><span class="line">        &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 132.4 MB</span><br><span class="line">          &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 132.4 MB</span><br><span class="line">            &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 132.4 MB</span><br><span class="line">...</span><br><span class="line">                            &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 276.0 MB</span><br><span class="line">                                &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 292.4 MB</span><br><span class="line">                                &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 292.4 MB</span><br><span class="line">                                    &#x2514;&#x2500;&lt;missing&gt; Virtual Size: 292.4 MB</span><br><span class="line">                                    &#x2514;&#x2500;72d2be374029 Virtual Size: 292.4 MB Tags: tomcat:latest</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x89C9;&#x5F97;&#x6587;&#x672C;&#x683C;&#x5F0F;&#x592A;&#x7E41;&#x6742;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x751F;&#x6210; <a href="https://en.wikipedia.org/wiki/DOT_(graph_description_language" target="_blank" rel="noopener">DOT &#x56FE;</a>)&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4; <code>dockviz images -d | dot -Tpng -o image_tree.png</code> &#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x4F60;&#x7684;&#x955C;&#x50CF;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7ED8;&#x5236;&#x6210;&#x56FE;&#xFF08;<a href="https://imagebin.ca/v/3ZhFvSPeqAi0" target="_blank" rel="noopener">https://imagebin.ca/v/3ZhFvSPeqAi0</a>&#xFF09;&#x3002;</p><h2 id="ri-zhi-wen-ti-2"><a href="#&#x65E5;&#x5FD7;&#x95EE;&#x9898;-2" class="headerlink" title="&#x65E5;&#x5FD7;&#x95EE;&#x9898; (2)"></a>&#x65E5;&#x5FD7;&#x95EE;&#x9898; <code>(2)</code> <a href="#ri-zhi-wen-ti-2" class="header-anchor">#</a></h2><h3 id="docker-ri-zhi-du-zai-na-li-zen-me-shou-ji"><a href="#Docker-&#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F;" class="headerlink" title="Docker &#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F;"></a>Docker &#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F; <a href="#docker-ri-zhi-du-zai-na-li-zen-me-shou-ji" class="header-anchor">#</a></h3><p>&#x65E5;&#x5FD7;&#x5206;&#x4E24;&#x7C7B;&#xFF0C;&#x4E00;&#x7C7B;&#x662F; <code>Docker &#x5F15;&#x64CE;&#x65E5;&#x5FD7;</code>&#xFF1B;&#x53E6;&#x4E00;&#x7C7B;&#x662F; <code>&#x5BB9;&#x5668;&#x65E5;&#x5FD7;</code>&#x3002;</p><h4 id="docker-yin-qing-ri-zhi"><a href="#Docker-&#x5F15;&#x64CE;&#x65E5;&#x5FD7;" class="headerlink" title="Docker &#x5F15;&#x64CE;&#x65E5;&#x5FD7;"></a>Docker &#x5F15;&#x64CE;&#x65E5;&#x5FD7; <a href="#docker-yin-qing-ri-zhi" class="header-anchor">#</a></h4><p><code>Docker &#x5F15;&#x64CE;&#x65E5;&#x5FD7;</code> &#x4E00;&#x822C;&#x662F;&#x4EA4;&#x7ED9;&#x4E86; <code>Upstart</code>(Ubuntu 14.04) &#x6216;&#x8005; <code>systemd</code> (CentOS 7, Ubuntu 16.04)&#x3002;&#x524D;&#x8005;&#x4E00;&#x822C;&#x4F4D;&#x4E8E; <code>/var/log/upstart/docker.log</code> &#x4E0B;&#xFF0C;&#x540E;&#x8005;&#x4E00;&#x822C;&#x901A;&#x8FC7; <code>jounarlctl -u docker</code> &#x6765;&#x8BFB;&#x53D6;&#x3002;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x7684;&#x4F4D;&#x7F6E;&#x90FD;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;SO&#x4E0A;&#x6709;&#x4EBA;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4EFD;&#x5217;&#x8868;&#xFF0C;&#x6211;&#x4FEE;&#x6B63;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p><table><thead><tr><th>&#x7CFB;&#x7EDF;</th><th>&#x65E5;&#x5FD7;&#x4F4D;&#x7F6E;</th></tr></thead><tbody><tr><td> Ubuntu(14.04)</td><td><code>/var/log/upstart/docker.log</code></td></tr><tr><td> Ubuntu(16.04)</td><td><code>journalctl -u docker.service</code></td></tr><tr><td> CentOS 7/RHEL 7/Fedora</td><td><code>journalctl -u docker.service</code></td></tr><tr><td> CoreOS</td><td><code>journalctl -u docker.service</code></td></tr><tr><td> OpenSuSE</td><td><code>journalctl -u docker.service</code></td></tr><tr><td> OSX</td><td><code>~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/log/d&#x200C;&#x200B;ocker.log</code></td></tr><tr><td> Debian GNU/Linux 7</td><td><code>/var/log/daemon.log</code></td></tr><tr><td> Debian GNU/Linux 8</td><td><code>journalctl -u docker.service</code></td></tr><tr><td> Boot2Docker</td><td><code>/var/log/docker.log</code></td></tr></tbody></table><h4 id="rong-qi-ri-zhi"><a href="#&#x5BB9;&#x5668;&#x65E5;&#x5FD7;" class="headerlink" title="&#x5BB9;&#x5668;&#x65E5;&#x5FD7;"></a>&#x5BB9;&#x5668;&#x65E5;&#x5FD7; <a href="#rong-qi-ri-zhi" class="header-anchor">#</a></h4><p><code>&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;</code> &#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker logs</code> &#x547D;&#x4EE4;&#x6765;&#x8BBF;&#x95EE;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x50CF; <code>tail -f</code> &#x4E00;&#x6837;&#xFF0C;&#x4F7F;&#x7528; <code>docker logs -f</code> &#x6765;&#x5B9E;&#x65F6;&#x67E5;&#x770B;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528; Docker Compose&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker-compose logs &lt;&#x670D;&#x52A1;&#x540D;&gt;</code> &#x6765;&#x67E5;&#x770B;&#x3002;</p><p>&#x5982;&#x679C;&#x6DF1;&#x7A76;&#x5176;&#x65E5;&#x5FD7;&#x4F4D;&#x7F6E;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x9ED8;&#x8BA4;&#x90FD;&#x4F1A;&#x4EE5; <code>json-file</code> &#x7684;&#x683C;&#x5F0F;&#x5B58;&#x50A8;&#x4E8E; <code>/var/lib/docker/containers/&lt;&#x5BB9;&#x5668;id&gt;/&lt;&#x5BB9;&#x5668;id&gt;-json.log</code> &#x4E0B;&#xFF0C;&#x4E0D;&#x8FC7;&#x5E76;&#x4E0D;&#x5EFA;&#x8BAE;&#x53BB;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x5185;&#x5BB9;&#xFF0C;&#x56E0;&#x4E3A; Docker &#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5B8C;&#x5584;&#x5730;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x65B9;&#x5F0F; - <code>Docker &#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x9A71;&#x52A8;</code>&#x3002;</p><p>&#x5173;&#x4E8E;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#xFF0C;<code>Docker</code> &#x5185;&#x7F6E;&#x4E86;&#x5F88;&#x591A;&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7C7B;&#x4F3C;&#x4E8E; <code>fluentd</code>, <code>syslog</code> &#x8FD9;&#x7C7B;&#x670D;&#x52A1;&#x6536;&#x96C6;&#x65E5;&#x5FD7;&#x3002;&#x65E0;&#x8BBA;&#x662F; <code>Docker</code> &#x5F15;&#x64CE;&#xFF0C;&#x8FD8;&#x662F;&#x5BB9;&#x5668;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6253;&#x7B97;&#x7528; <code>fluentd</code> &#x6536;&#x96C6;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">    --<span class="built_in">log</span>-driver=fluentd \</span><br><span class="line">    --<span class="built_in">log</span>-opt fluentd-address=10.2.3.4:24224 \</span><br><span class="line">    --<span class="built_in">log</span>-opt tag=<span class="string">&quot;docker.{{.Name}}&quot;</span> \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D; <code>10.2.3.4:24224</code> &#x662F; <code>fluentd</code> &#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x5B9E;&#x9645;&#x73AF;&#x5883;&#x4E2D;&#x5E94;&#x8BE5;&#x6362;&#x6210;&#x771F;&#x5B9E;&#x7684;&#x5730;&#x5740;&#x3002;</p><p>&#x5177;&#x4F53;&#x4F7F;&#x7528; <code>fluentd</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#x6211;&#x5199;&#x7684;&#x4E00;&#x7EC4; <code>fluentd</code> &#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p><p><a href="https://coding.net/u/twang2218/p/docker-example/git/tree/master/fluentd" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-example/git/tree/master/fluentd</a></p><h3 id="bu-tong-rong-qi-de-ri-zhi-hui-ju-dao-fluentd-hou-ru-he-qu-fen"><a href="#&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6C47;&#x805A;&#x5230;-fluentd-&#x540E;&#x5982;&#x4F55;&#x533A;&#x5206;&#xFF1F;" class="headerlink" title="&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6C47;&#x805A;&#x5230; fluentd &#x540E;&#x5982;&#x4F55;&#x533A;&#x5206;&#xFF1F;"></a>&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6C47;&#x805A;&#x5230; <code>fluentd</code> &#x540E;&#x5982;&#x4F55;&#x533A;&#x5206;&#xFF1F; <a href="#bu-tong-rong-qi-de-ri-zhi-hui-ju-dao-fluentd-hou-ru-he-qu-fen" class="header-anchor">#</a></h3><p>&#x6709;&#x4E24;&#x79CD;&#x6982;&#x5FF5;&#x7684;&#x533A;&#x5206;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x533A;&#x5206;&#x5F00;<code>&#x4E0D;&#x540C;&#x5BB9;&#x5668;</code>&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x533A;&#x5206;&#x5F00;&#x6765;<code>&#x4E0D;&#x540C;&#x670D;&#x52A1;</code>&#x7684;&#x65E5;&#x5FD7;&#x3002;</p><p>&#x533A;&#x5206;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x662F;&#x5F88;&#x76F4;&#x89C2;&#x7684;&#x60F3;&#x6CD5;&#x3002;&#x8FD0;&#x884C;&#x4E86;&#x51E0;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x65E5;&#x5FD7;&#x90FD;&#x9001;&#x5411;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#xFF0C;&#x90A3;&#x4E48;&#x663E;&#x7136;&#x4E0D;&#x5E0C;&#x671B; <code>nginx</code> &#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x548C; <code>MySQL</code> &#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6DF7;&#x6742;&#x5728;&#x4E00;&#x8D77;&#x770B;&#x3002;</p><p>&#x4F46;&#x662F;&#x5728; Swarm &#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x533A;&#x5206;&#x5BB9;&#x5668;&#x5C31;&#x5DF2;&#x7ECF;&#x4E0D;&#x518D;&#x662F;&#x5408;&#x7406;&#x7684;&#x505A;&#x6CD5;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x6709;&#x8BB8;&#x591A;&#x526F;&#x672C;&#xFF0C;&#x800C;&#x53C8;&#x6709;&#x5F88;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x5BB9;&#x5668;&#x533A;&#x5206;&#x53BB;&#x5206;&#x6790;&#xFF0C;&#x5F88;&#x96BE;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x4E0A;&#x67D0;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x670D;&#x52A1;&#x72B6;&#x6001;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x7684;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x5BB9;&#x5668;&#x662F;&#x77ED;&#x751F;&#x5B58;&#x5468;&#x671F;&#x7684;&#xFF0C;&#x5728;&#x7EF4;&#x62A4;&#x671F;&#x95F4;&#x5BB9;&#x5668;&#x751F;&#x5B58;&#x6B7B;&#x4EA1;&#x662F;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5982;&#x679C;&#x662F;&#x50CF;&#x4F20;&#x7EDF;&#x865A;&#x62DF;&#x673A;&#x90A3;&#x6837;&#x5B50;&#x4EE5;&#x5BB9;&#x5668;&#x4E3A;&#x5355;&#x5143;&#x53BB;&#x5206;&#x6790;&#x65E5;&#x5FD7;&#xFF0C;&#x5176;&#x7ED3;&#x679C;&#x5F88;&#x96BE;&#x5177;&#x6709;&#x4EF7;&#x503C;&#x3002;&#x56E0;&#x6B64;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x5019;&#x662F;&#x5BF9;&#x67D0;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x65E5;&#x5FD7;&#x6574;&#x4F53;&#x5206;&#x6790;&#xFF0C;&#x65E0;&#x9700;&#x533A;&#x522B;&#x65E5;&#x5FD7;&#x5177;&#x4F53;&#x6765;&#x81EA;&#x4E8E;&#x54EA;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x5BB9;&#x5668;&#x662F;&#x4EC0;&#x4E48;&#x65F6;&#x95F4;&#x4EA7;&#x751F;&#x4EE5;&#x53CA;&#x662F;&#x5426;&#x6D88;&#x4EA1;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4EE5;&#x670D;&#x52A1;&#x4E3A;&#x5355;&#x5143;&#x53BB;&#x533A;&#x5206;&#x65E5;&#x5FD7;&#x5373;&#x53EF;&#x3002;</p><p>&#x8FD9;&#x4E24;&#x7C7B;&#x7684;&#x533A;&#x5206;&#x65E5;&#x5FD7;&#x7684;&#x529E;&#x6CD5;&#xFF0C;Docker &#x90FD;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4EE5; <code>fluentd</code> &#x4E3A;&#x4F8B;&#x8BF4;&#x660E;&#x3002;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&apos;2&apos;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.11-alpine</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;3000:80&quot;</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">            <span class="attr">section:</span> <span class="string">frontend</span></span><br><span class="line">            <span class="attr">group:</span> <span class="string">alpha</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">web</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">            <span class="attr">base_os:</span> <span class="string">alpine</span></span><br><span class="line">        <span class="attr">logging:</span></span><br><span class="line">            <span class="attr">driver:</span> <span class="string">fluentd</span></span><br><span class="line">            <span class="attr">options:</span></span><br><span class="line">                <span class="attr">fluentd-address:</span> <span class="string">&quot;localhost:24224&quot;</span></span><br><span class="line">                <span class="attr">tag:</span> <span class="string">&quot;frontend.web.nginx.<span class="template-variable">{{.Name}}</span>&quot;</span></span><br><span class="line">                <span class="attr">labels:</span> <span class="string">&quot;section,group,service,image,base_os&quot;</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A; <code>nginx:alpine</code> &#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x540D;&#x4E3A; <code>web</code>&#x3002;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x4F7F;&#x7528; <code>fluentd</code> &#x8FDB;&#x884C;&#x6536;&#x96C6;&#xFF0C;&#x5E76;&#x4E14;&#x9644;&#x4E0A;&#x6807;&#x7B7E; <code>frontend.web.nginx.&lt;&#x5BB9;&#x5668;&#x540D;&gt;</code>&#x3002;&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7EC4; <code>labels</code>&#xFF0C;&#x5E76;&#x4E14;&#x5728; <code>logging</code> &#x7684; <code>options</code> &#x4E2D;&#x7684; <code>labels</code> &#x4E2D;&#x6307;&#x660E;&#x5E0C;&#x671B;&#x54EA;&#x4E9B;&#x6807;&#x7B7E;&#x968F;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x4E2D;&#x5F88;&#x591A;&#x4E00;&#x90E8;&#x5206;&#x90FD;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x6240;&#x6536;&#x96C6;&#x7684;&#x65E5;&#x5FD7;&#x91CC;&#x3002;</p><p>&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B; <code>fluentd</code> &#x6536;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x7684;&#x3002;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">&quot;frontend.web.nginx.service_web_1&quot;</span>: {</span><br><span class="line">    <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;base_os&quot;</span>: <span class="string">&quot;alpine&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;container_id&quot;</span>: <span class="string">&quot;f7212f7108de033045ddc22858569d0ac50921b043b97a2c8bf83b1b1ee50e34&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;section&quot;</span>: <span class="string">&quot;frontend&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;service&quot;</span>: <span class="string">&quot;web&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;log&quot;</span>: <span class="string">&quot;172.20.0.1 - - [09/Dec/2016:15:02:45 +0000] \&quot;GET / HTTP/1.1\&quot; 200 612 \&quot;-\&quot; \&quot;curl/7.49.1\&quot; \&quot;-\&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;group&quot;</span>: <span class="string">&quot;alpha&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;container_name&quot;</span>: <span class="string">&quot;/service_web_1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;stdout&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;remote&quot;</span>: <span class="string">&quot;172.20.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;user&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;size&quot;</span>: <span class="string">&quot;612&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;referer&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;agent&quot;</span>: <span class="string">&quot;curl/7.49.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;forward&quot;</span>: <span class="string">&quot;-&quot;</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x53BB;&#x9664; <code>nginx</code> &#x6B63;&#x5E38;&#x7684;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;&#x9879;&#x76EE;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x66F4;&#x6E05;&#x6670;&#x7684;&#x770B;&#x5230;&#x6709;&#x54EA;&#x4E9B;&#x5143;&#x6570;&#x636E;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x4E86;&#x3002;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">&quot;frontend.web.nginx.service_web_1&quot;</span>: {</span><br><span class="line">    <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;base_os&quot;</span>: <span class="string">&quot;alpine&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;container_id&quot;</span>: <span class="string">&quot;f7212f7108de033045ddc22858569d0ac50921b043b97a2c8bf83b1b1ee50e34&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;section&quot;</span>: <span class="string">&quot;frontend&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;service&quot;</span>: <span class="string">&quot;web&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;group&quot;</span>: <span class="string">&quot;alpha&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;container_name&quot;</span>: <span class="string">&quot;/service_web_1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;stdout&quot;</span>,</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x5728; <code>logging</code> &#x4E0B;&#x6240;&#x6709;&#x6307;&#x5B9A;&#x7684; <code>labels</code> &#x90FD;&#x5728;&#x3002;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x5BF9;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x8BBE;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x901A;&#x8FC7;&#x6807;&#x7B7E;&#x6765;&#x533A;&#x5206;&#x670D;&#x52A1;&#x3002;&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9; <code>web</code> &#x670D;&#x52A1;&#x6307;&#x5B9A;&#x4E86; <code>service=web</code> &#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x670D;&#x52A1;&#x8BBE;&#x5B9A;&#x6807;&#x7B7E;&#x4E3A; <code>service=mysql</code>&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x6C47;&#x603B;&#x540E;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5BF9; <code>service</code> &#x6807;&#x7B7E;&#x5206;&#x7EC4;&#x8FC7;&#x6EE4;&#x5373;&#x53EF;&#xFF0C;&#x5206;&#x79BB;&#x805A;&#x5408;&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x7684;&#x65E5;&#x5FD7;&#x3002;</p><p>&#x6B64;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E0D;&#x6B62;&#x4E00;&#x4E2A;&#x6807;&#x7B7E;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x4E86;&#x591A;&#x7EC4;&#x4E0D;&#x540C;&#x9897;&#x7C92;&#x5EA6;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x5728;&#x540E;&#x671F;&#x5206;&#x7EC4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x7075;&#x6D3B;&#x7684;&#x8FDB;&#x884C;&#x7EC4;&#x5408;&#xFF0C;&#x4EE5;&#x6EE1;&#x8DB3;&#x4E0D;&#x540C;&#x9700;&#x6C42;&#x3002;</p><p>&#x6B64;&#x5916;&#xFF0C;&#x6CE8;&#x610F; <code>frontend.web.nginx.service_web_1</code>&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5229;&#x7528; <code>--log-opt tag=frontend.web.nginx.&lt;&#x5BB9;&#x5668;&#x540D;&gt;</code> &#x8FDB;&#x884C;&#x8BBE;&#x5B9A;&#x7684;&#xFF0C;&#x5176;&#x4E2D; <code>&lt;&#x5BB9;&#x5668;&#x540D;&gt;</code> &#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F; Go &#x6A21;&#x677F;&#x8868;&#x8FBE;&#x5F0F; <em>{{.Name}}</em>&#x3002;Go &#x6A21;&#x677F;&#x5F88;&#x5F3A;&#x5927;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;&#x6807;&#x7B7E;&#x3002;&#x5728; <code>fluentd</code> &#x4E2D;&#xFF0C;<code>&lt;match&gt;</code> &#x9879;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6807;&#x7B7E;&#x6765;&#x8FDB;&#x884C;&#x7B5B;&#x9009;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x552F;&#x4E00;&#x8868;&#x793A;&#x5BB9;&#x5668;&#x7684;&#xFF0C;&#x6709;&#x5BB9;&#x5668; ID <code>container_id</code>&#xFF0C;&#x800C;&#x5BB9;&#x5668;&#x540D; <code>container_name</code> &#x4E5F;&#x4ECE;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x533A;&#x5206;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x3002;&#x56E0;&#x6B64;&#x8FDB;&#x884C;&#x5BB9;&#x5668;&#x533A;&#x5206;&#x65E5;&#x5FD7;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x9879;&#x3002;</p><p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A; <code>source</code>&#xFF0C;&#x8FD9;&#x8868;&#x793A;&#x4E86;&#x65E5;&#x5FD7;&#x662F;&#x4ECE;<code>&#x6807;&#x51C6;&#x8F93;&#x51FA;</code>&#x8FD8;&#x662F;<code>&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;</code>&#x5F97;&#x5230;&#x7684;&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x533A;&#x5206;<code>&#x6B63;&#x5E38;&#x65E5;&#x5FD7;</code>&#x548C;<code>&#x9519;&#x8BEF;&#x65E5;&#x5FD7;</code>&#x3002;</p><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x9664;&#x4E86;&#x5BB9;&#x5668;&#x81EA;&#x8EAB;&#x8F93;&#x51FA;&#x7684;&#x4FE1;&#x606F;&#x5916;&#xFF0C;Docker &#x8FD8;&#x53EF;&#x4EE5;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6DFB;&#x52A0;&#x5F88;&#x591A;&#x5143;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x5E2E;&#x52A9;&#x540E;&#x671F;&#x7684;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#x4E2D;&#x5E94;&#x5BF9;&#x4E0D;&#x540C;&#x9700;&#x6C42;&#x7684;&#x641C;&#x7D22;&#x548C;&#x8FC7;&#x6EE4;&#x3002;</p><p>&#x5728;&#x540E;&#x671F;&#x5904;&#x7406;&#x4E2D;&#xFF0C;<code>fluentd</code> &#x4E2D;&#x53EF;&#x4EE5;&#x5229;&#x7528; <code>&lt;match&gt;</code> &#x6216;&#x8005; <code>&lt;filter&gt;</code> &#x63D2;&#x4EF6;&#x6839;&#x636E; <code>tag</code> &#x6216;&#x8005;&#x5176;&#x5B83;&#x5143;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x522B;&#x5904;&#x7406;&#x3002;&#x800C;&#x65E5;&#x5FD7;&#x5230;&#x4E86; ElasticSearch &#x8FD9;&#x7C7B;&#x7CFB;&#x7EDF;&#x540E;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x66F4;&#x4E30;&#x5BCC;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#x3001;&#x805A;&#x5408;&#x3002;</p><h2 id="shi-yong-wen-ti-11"><a href="#&#x4F7F;&#x7528;&#x95EE;&#x9898;-11" class="headerlink" title="&#x4F7F;&#x7528;&#x95EE;&#x9898; (11)"></a>&#x4F7F;&#x7528;&#x95EE;&#x9898; <code>(11)</code> <a href="#shi-yong-wen-ti-11" class="header-anchor">#</a></h2><h3 id="wei-shi-me-rong-qi-yi-yun-xing-jiu-tui-chu-a"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x5BB9;&#x5668;&#x4E00;&#x8FD0;&#x884C;&#x5C31;&#x9000;&#x51FA;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x5BB9;&#x5668;&#x4E00;&#x8FD0;&#x884C;&#x5C31;&#x9000;&#x51FA;&#x554A;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x5BB9;&#x5668;&#x4E00;&#x8FD0;&#x884C;&#x5C31;&#x9000;&#x51FA;&#x554A;&#xFF1F; <a href="#wei-shi-me-rong-qi-yi-yun-xing-jiu-tui-chu-a" class="header-anchor">#</a></h3><p>&#x8FD9;&#x662F;&#x521D;&#x5B66; Docker &#x5E38;&#x5E38;&#x78B0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6B64;&#x65F6;&#x8FD8;&#x4EE5;&#x865A;&#x62DF;&#x673A;&#x6765;&#x7406;&#x89E3; Docker&#xFF0C;&#x8BA4;&#x4E3A;&#x542F;&#x52A8; Docker &#x5C31;&#x662F;&#x542F;&#x52A8;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x641E;&#x660E;&#x767D;&#x524D;&#x53F0;&#x548C;&#x540E;&#x53F0;&#x7684;&#x533A;&#x522B;&#x3002;</p><p>&#x9996;&#x5148;&#xFF0C;&#x78B0;&#x5230;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x5E94;&#x8BE5;&#x67E5;&#x65E5;&#x5FD7;&#x548C;&#x5BB9;&#x5668;&#x4E3B;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x7801;&#x3002;</p><p>&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;&#x5BB9;&#x5668;ID&gt;</span><br></pre></td></tr></table></figure><p>&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x9000;&#x51FA;&#x7801;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                           COMMAND             CREATED             STATUS                      PORTS                                                                  NAMES</span><br><span class="line">cc2aa3f4745f        ubuntu                          <span class="string">&quot;/bin/bash&quot;</span>         23 hours ago        Exited (0) 22 hours ago                                                                            clever_lewin</span><br><span class="line">25510a2cb171        twang2218/gitlab-ce-zh:8.15.3   <span class="string">&quot;/assets/wrapper&quot;</span>   2 days ago          Exited (127) 2 days ago                                                                            determined_mirzakhani</span><br></pre></td></tr></table></figure><p>&#x5728; <code>STATUS</code> &#x4E00;&#x680F;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x9000;&#x51FA;&#x7801;&#x662F;&#x591A;&#x5C11;&#x3002;</p><ul><li>&#x5982;&#x679C;&#x770B;&#x5230;&#x4E86; <code>Exited (127)</code> &#x90A3;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;&#x5185;&#x5B58;&#x8D85;&#x6807;&#x5BFC;&#x81F4;&#x89E6;&#x53D1; <code>Out Of Memory</code> &#x7136;&#x540E;&#x88AB;&#x5F3A;&#x5236;&#x7EC8;&#x6B62;&#x4E86;&#x3002;</li><li>&#x5982;&#x679C;&#x770B;&#x5230;&#x4E86; <code>Exited (0)</code>&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;&#x5BB9;&#x5668;&#x4E3B;&#x8FDB;&#x7A0B;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#x4E86;&#x3002;</li><li>&#x5982;&#x679C;&#x662F;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x8BE5;&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#x3002;</li></ul><p>&#x521D;&#x5B66; Docker &#x7684;&#x4EBA;&#x5E38;&#x5E38;&#x4F1A;&#x4E0D;&#x7406;&#x89E3;&#x65E2;&#x7136;&#x6B63;&#x5E38;&#x600E;&#x4E48;&#x4F1A;&#x9000;&#x51FA;&#x7684;&#x610F;&#x601D;&#x3002;&#x4E0D;&#x5F97;&#x4E0D;&#x5728;&#x5F3A;&#x8C03;&#x4E00;&#x904D;&#xFF0C;Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x8FDB;&#x7A0B;&#x3002;&#x56E0;&#x6B64;&#x5F53;&#x6267;&#x884C; <code>docker run</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x6240;&#x505A;&#x7684;&#x53EA;&#x662F;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5BB9;&#x5668;&#x81EA;&#x7136;&#x5C31;&#x7EC8;&#x6B62;&#x4E86;&#x3002;</p><p>&#x90A3;&#x4E48;&#x8FDB;&#x7A0B;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x9000;&#x51FA;&#xFF1F;</p><ul><li>&#x5982;&#x679C;&#x662F;&#x6267;&#x884C; <code>service nginx start</code> &#x8FD9;&#x7C7B;&#x542F;&#x52A8;&#x540E;&#x53F0;&#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x90A3;&#x8BF4;&#x660E;&#x8FD8;&#x662F;&#x628A; Docker &#x5F53;&#x505A;&#x865A;&#x62DF;&#x673A;&#x4E86;&#x3002;Docker &#x542F;&#x52A8;&#x7684;&#x662F;&#x8FDB;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x8C13;&#x7684;&#x540E;&#x53F0;&#x670D;&#x52A1;&#x5E94;&#x8BE5;&#x653E;&#x5230;&#x524D;&#x53F0;&#xFF0C;&#x6BD4;&#x5982;&#x5E94;&#x8BE5; <code>nginx -g &apos;daemon off;&apos;</code> &#x8FD9;&#x6837;&#x76F4;&#x63A5;&#x524D;&#x53F0;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x624D;&#x5BF9;&#x3002;</li><li>&#x5982;&#x679C;&#x53D1;&#x73B0; <code>COMMAND</code> &#x4E00;&#x680F;&#x662F; <code>/bin/bash</code>&#xFF0C;&#x90A3;&#x8FD8;&#x662F;&#x8BF4;&#x660E;&#x628A; Docker &#x5F53;&#x865A;&#x62DF;&#x673A;&#x4E86;&#x3002;<code>COMMAND</code> &#x5E94;&#x8BE5;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x800C;&#x4E0D;&#x4EA4;&#x4E92;&#x5F0F;&#x64CD;&#x4F5C;&#x754C;&#x9762;&#xFF0C;&#x5BB9;&#x5668;&#x4E0D;&#x9700;&#x8981;&#x4EA4;&#x4E92;&#x5F0F;&#x64CD;&#x4F5C;&#x754C;&#x9762;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528; <code>/bin/bash</code> &#x5E0C;&#x671B;&#x8D77;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x754C;&#x9762;&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x7ED9;&#x5176;&#x8F93;&#x5165;&#x548C;&#x7EC8;&#x7AEF;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x52A0; <code>-it</code> &#x9009;&#x9879;&#xFF0C;&#x6BD4;&#x5982; <code>docker run -it ubuntu /bin/bash</code></li></ul><h3 id="ru-he-zai-docker-rong-qi-nei-shi-yong-docker-ming-ling-bi-ru-zai-jenkins-rong-qi-zhong"><a href="#&#x5982;&#x4F55;&#x5728;-Docker-&#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528;-docker-&#x547D;&#x4EE4;-&#x6BD4;&#x5982;&#x5728;-Jenkins-&#x5BB9;&#x5668;&#x4E2D;-&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5728; Docker  &#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; docker &#x547D;&#x4EE4;(&#x6BD4;&#x5982;&#x5728; Jenkins &#x5BB9;&#x5668;&#x4E2D;)&#xFF1F;"></a>&#x5982;&#x4F55;&#x5728; Docker  &#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;(&#x6BD4;&#x5982;&#x5728; Jenkins &#x5BB9;&#x5668;&#x4E2D;)&#xFF1F; <a href="#ru-he-zai-docker-rong-qi-nei-shi-yong-docker-ming-ling-bi-ru-zai-jenkins-rong-qi-zhong" class="header-anchor">#</a></h3><p>&#x9996;&#x5148;&#xFF0C;&#x4E0D;&#x8981;&#x5728; Docker &#x5BB9;&#x5668;&#x4E2D;&#x5B89;&#x88C5;&#x3001;&#x8FD0;&#x884C; Docker &#x5F15;&#x64CE;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684; Docker In Docker (DIND)&#xFF0C;&#x53C2;&#x8003;&#x6587;&#x7AE0;&#xFF1A;</p><p><a href="https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/" target="_blank" rel="noopener">https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/</a></p><p>&#x4E3A;&#x4E86;&#x8BA9;&#x5BB9;&#x5668;&#x5185;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>Docker Remote API</code> &#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5BBF;&#x4E3B;&#x7684; Docker Engine&#x3002;&#x53EF;&#x4EE5;&#x662F;&#x539F;&#x751F;&#x7684; Docker CLI &#xFF08;<code>docker</code> &#x547D;&#x4EE4;&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;<a href="https://docs.docker.com/engine/reference/api/remote_api_client_libraries/" target="_blank" rel="noopener">&#x5176;&#x5B83;&#x8BED;&#x8A00;&#x7684;&#x5E93;</a>&#x3002;</p><h4 id="wei-jenkins-tian-jia-docker-ming-ling-xing"><a href="#&#x4E3A;-Jenkins-&#x6DFB;&#x52A0;-Docker-&#x547D;&#x4EE4;&#x884C;" class="headerlink" title="&#x4E3A; Jenkins &#x6DFB;&#x52A0; Docker &#x547D;&#x4EE4;&#x884C;"></a>&#x4E3A; Jenkins &#x6DFB;&#x52A0; Docker &#x547D;&#x4EE4;&#x884C; <a href="#wei-jenkins-tian-jia-docker-ming-ling-xing" class="header-anchor">#</a></h4><p>&#x4E0B;&#x9762;&#x4EE5;&#x5B9A;&#x5236; <code>jenkins</code> &#x955C;&#x50CF;&#x4E3A;&#x4F8B;&#xFF0C;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6DFB;&#x52A0; <code>docker</code> &#x547D;&#x4EE4;&#x884C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8C03;&#x6574;&#x6743;&#x9650;&#x3002;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> jenkins:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4E0B;&#x8F7D;&#x5B89;&#x88C5;Docker CLI</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> curl -O https://get.docker.com/builds/Linux/x86_64/docker-latest.tgz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar zxvf docker-latest.tgz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp docker/docker /usr/<span class="built_in">local</span>/bin/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf docker docker-latest.tgz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5C06; `jenkins` &#x7528;&#x6237;&#x7684;&#x7EC4; ID &#x6539;&#x4E3A;&#x5BBF;&#x4E3B; `docker` &#x7EC4;&#x7684;&#x7EC4;ID&#xFF0C;&#x4ECE;&#x800C;&#x5177;&#x6709;&#x6267;&#x884C; `docker` &#x547D;&#x4EE4;&#x7684;&#x6743;&#x9650;&#x3002;</span></span><br><span class="line"><span class="keyword">ARG</span> DOCKER_GID=<span class="number">999</span></span><br><span class="line"><span class="keyword">USER</span> jenkins:${DOCKER_GID}</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x4E86;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#x7684; <code>docker</code> &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x63D0;&#x53D6;&#x547D;&#x4EE4;&#x884C;&#x5B89;&#x88C5;&#x5230;&#x7CFB;&#x7EDF;&#x76EE;&#x5F55;&#x4E0B;&#x3002;&#x7136;&#x540E;&#x8C03;&#x6574;&#x4E86; <code>jenkins</code> &#x7528;&#x6237;&#x7684;&#x7EC4; ID&#xFF0C;&#x8C03;&#x6574;&#x4E3A;&#x5BBF;&#x4E3B; <code>docker</code> &#x7EC4;ID&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5176;&#x5177;&#x6709;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;&#x7684;&#x6743;&#x9650;&#x3002;</p><p>&#x7EC4; ID &#x4F7F;&#x7528;&#x4E86; <code>DOCKER_GID</code> &#x53C2;&#x6570;&#x6765;&#x5B9A;&#x4E49;&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x8FDB;&#x4E00;&#x6B65;&#x5B9A;&#x5236;&#x3002;&#x6784;&#x5EFA;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--build-arg</code> &#x6765;&#x6539;&#x53D8; <code>DOCKER_GID</code> &#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x8FD0;&#x884C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--user jenkins:1234</code> &#x6765;&#x6539;&#x53D8;&#x8FD0;&#x884C;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x3002;</p><p><em>&#x8FD9;&#x91CC;&#x7684;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>jenkins:alpine</code>&#xFF0C;&#x6362;&#x4E3A;&#x975E; <code>alpine</code> &#x7684;&#x955C;&#x50CF; <code>jenkins:latest</code> &#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</em></p><p>&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF08;&#x5047;&#x8BBE;&#x955C;&#x50CF;&#x540D;&#x4E3A; <code>jenkins-docker</code>&#xFF09;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t jenkins-docker .</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x9700;&#x8981;&#x6784;&#x5EFA;&#x65F6;&#x8C03;&#x6574; <code>docker</code> &#x7EC4; ID&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--build-arg</code> &#x6765;&#x8986;&#x76D6;&#x53C2;&#x6570;&#x9ED8;&#x8BA4;&#x503C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t jenkins-docker --build-arg DOCKER_GID=1234 .</span><br></pre></td></tr></table></figure><p>&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C06;&#x5BBF;&#x4E3B;&#x7684; <code>/var/run/docker.sock</code> &#x6587;&#x4EF6;&#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x540C;&#x6837;&#x4F4D;&#x7F6E;&#xFF0C;&#x4ECE;&#x800C;&#x8BA9;&#x5BB9;&#x5668;&#x5185;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" target="_blank" rel="noopener">unix socket</a> &#x8C03;&#x7528;&#x5BBF;&#x4E3B;&#x7684; Docker &#x5F15;&#x64CE;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x542F;&#x52A8; <code>jenkins</code>&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name jenkins \</span><br><span class="line">    -d \</span><br><span class="line">    -p 8080:8080 \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    jenkins-docker</span><br></pre></td></tr></table></figure><p>&#x5728; <code>jenkins</code> &#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5C31;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker exec</code> &#x6765;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it jenkins sh</span><br><span class="line">/ $ id</span><br><span class="line">uid=1000(jenkins) gid=999(ping) groups=999(ping)</span><br><span class="line">/ $ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      1.12.3</span><br><span class="line"> API version:  1.24</span><br><span class="line"> Go version:   go1.6.3</span><br><span class="line"> Git commit:   6b644ec</span><br><span class="line"> Built:        Wed Oct 26 23:26:11 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      1.13.0-rc2</span><br><span class="line"> API version:  1.25</span><br><span class="line"> Go version:   go1.7.3</span><br><span class="line"> Git commit:   1f9b3ef</span><br><span class="line"> Built:        Wed Nov 23 06:32:39 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line">/ $</span><br></pre></td></tr></table></figure><h3 id="docker-rong-qi-ru-he-sui-xi-tong-yi-tong-qi-dong"><a href="#Docker-&#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F;" class="headerlink" title="Docker &#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F;"></a>Docker &#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F; <a href="#docker-rong-qi-ru-he-sui-xi-tong-yi-tong-qi-dong" class="header-anchor">#</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--restart=always</span><br></pre></td></tr></table></figure><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/run/#restart-policies-restart" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/run/#restart-policies-restart</a></p><h3 id="docker-stats-xian-shi-de-zhi-you-rong-qi-id-zen-me-cai-neng-xian-shi-rong-qi-ming-zi"><a href="#docker-stats-&#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F;" class="headerlink" title="docker stats &#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F;"></a><code>docker stats</code> &#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F; <a href="#docker-stats-xian-shi-de-zhi-you-rong-qi-id-zen-me-cai-neng-xian-shi-rong-qi-ming-zi" class="header-anchor">#</a></h3><p>&#x5BF9;&#x4E8E;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x9ED8;&#x8BA4;&#x7684; <code>docker stats</code> &#x91CC;&#x53EA;&#x663E;&#x793A;&#x5BB9;&#x5668; ID&#xFF0C;&#x540E;&#x6765;&#x5373;&#x4F7F;&#x652F;&#x6301;&#x4E86; <code>--format</code>&#xFF0C;&#x4E3A;&#x4E86;&#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x5C06;&#x5176;&#x53D8;&#x4E3A;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x3002;<code>17.10</code> &#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;<code>docker container stats</code> &#x9ED8;&#x8BA4;&#x5C06;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x79F0;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x672C;&#x5730;&#x7684; <code>~/.docker/config.json</code> &#x6587;&#x4EF6;&#xFF0C;&#x52A0;&#x5165;&#x4E00;&#x884C;&#x914D;&#x7F6E;&#xFF1A;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">&quot;statsFormat&quot;</span>: <span class="string">&quot;table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}\t{{.NetIO}}\t{{.BlockIO}}\t{{.PIDs}}&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x9ED8;&#x8BA4;&#x683C;&#x5F0F;&#x5C31;&#x4F1A;&#x6539;&#x4E3A;&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x7684;&#x683C;&#x5F0F;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--format</code> &#x6765;&#x6307;&#x5B9A;&#x663E;&#x793A;&#x683C;&#x5F0F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats --format <span class="string">&quot;table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}\t{{.NetIO}}\t{{.BlockIO}}\t{{.PIDs}}&quot;</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5EFA;&#x8BAE;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x4E3A;&#x4E00;&#x4E2A; <code>alias</code>&#xFF0C;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x4E0D;&#x652F;&#x6301; <code>--format</code> &#x7684;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats $(docker ps --format=<span class="string">&apos;{{.Names}}&apos;</span>)</span><br></pre></td></tr></table></figure><p>&#x5176;&#x7F3A;&#x70B9;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x52A8;&#x6001;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x4F5C;&#x4E3A;&#x6301;&#x7EED;&#x89C2;&#x5BDF;&#x3002;</p><h3 id="wo-yong-de-shi-a-li-yun-ubuntu-14-04-zhu-ji-nei-he-huan-shi-3-13-zen-me-ban"><a href="#&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91;-Ubuntu-14-04-&#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;3-13&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91; Ubuntu 14.04 &#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;3.13&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91; <code>Ubuntu 14.04</code> &#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;<code>3.13</code>&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#wo-yong-de-shi-a-li-yun-ubuntu-14-04-zhu-ji-nei-he-huan-shi-3-13-zen-me-ban" class="header-anchor">#</a></h3><p>&#x5176;&#x5B9E; <code>Ubuntu 14.04</code> &#x5B98;&#x65B9;&#x7EF4;&#x62A4;&#x7684;&#x5185;&#x6838;&#x5DF2;&#x7ECF;&#x5230; <code>4.4</code> &#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5347;&#x7EA7;&#x5185;&#x6838;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y --install-recommends linux-generic-lts-xenial</span><br></pre></td></tr></table></figure><h3 id="ru-he-dong-tai-xiu-gai-nei-cun-xian-zhi"><a href="#&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F;"></a>&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F; <a href="#ru-he-dong-tai-xiu-gai-nei-cun-xian-zhi" class="header-anchor">#</a></h3><p><code>Docker 1.10</code> &#x4E4B;&#x540E;&#x652F;&#x6301;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#xFF0C;&#x4F7F;&#x7528; <code>docker update</code> &#x547D;&#x4EE4;&#xFF0C;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update -m 300m</span><br></pre></td></tr></table></figure><h3 id="jing-chang-zai-ge-chong-docker-ming-ling-li-kan-dao-label-label-shi-shi-me-gan-shi-me-yong-de"><a href="#&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD;-Docker-&#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230;-label&#xFF0C;label-&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F;" class="headerlink" title="&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD; Docker &#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230; --label&#xFF0C;label &#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F;"></a>&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD; <code>Docker</code> &#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230; <code>--label</code>&#xFF0C;<code>label</code> &#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F; <a href="#jing-chang-zai-ge-chong-docker-ming-ling-li-kan-dao-label-label-shi-shi-me-gan-shi-me-yong-de" class="header-anchor">#</a></h3><p><code>Label</code> &#x662F;<code>&#x952E;&#x503C;&#x5BF9;</code>&#xFF0C;&#x662F; <code>metadata</code>&#xFF0C;&#x662F;&#x8D2F;&#x7A7F;&#x4E8E; <code>Docker</code> &#x5404;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#xFF0C;&#x5305;&#x62EC;&#x5F15;&#x64CE;&#x3001;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x5377;&#x3001;&#x7F51;&#x7EDC;&#x3001;Swarm &#x8282;&#x70B9;&#x3001;&#x670D;&#x52A1;&#x7B49;&#x3002;</p><ul><li>&#x952E; <code>key</code>&#xFF1A;&#x683C;&#x5F0F;&#x8981;&#x6C42;&#x53EA;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5B57;&#x6BCD;&#x548C;&#x6570;&#x5B57;&#xFF0C;&#x4EE5;&#x53CA;<code>.</code>&#xFF0C;<code>-</code>&#x3002;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E; <code>Java</code> &#x90A3;&#x79CD;&#x53CD;&#x5411;&#x57DF;&#x540D;&#x683C;&#x5F0F;&#xFF0C;&#x5982; <code>com.example.mytag</code>&#x3002;</li><li>&#x503C; <code>value</code>&#xFF1A;&#x683C;&#x5F0F;&#x5FC5;&#x987B;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x9664;&#x4E86;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x4E32;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x662F; <code>JSON</code>, <code>XML</code>, <code>CSV</code> &#x6216;&#x8005; <code>YAML</code>&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x3002;</li></ul><p>&#x5F53;&#x8D44;&#x6E90;&#x5F88;&#x5C11;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5BF9;&#x4E00;&#x4E2A;&#x4E2A;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x7BA1;&#x7406;&#x5F88;&#x591A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E48;&#x505A;&#x5C31;&#x53D8;&#x5F97;&#x4E0D;&#x5927;&#x73B0;&#x5B9E;&#x3002;&#x7ECF;&#x5E38;&#x7684;&#x9700;&#x6C42;&#x662F;&#x9488;&#x5BF9;&#x67D0;&#x4E00;&#x7C7B;&#x7684;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x4F7F;&#x7528; <code>label</code> &#x6765;&#x5E2E;&#x52A9;&#x5B9E;&#x73B0;&#x3002;</p><p>&#x5F53;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684; <code>label</code>&#xFF08;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;&#x4E2A; <code>label</code>&#xFF09;&#xFF0C;&#x800C;&#x5F53;&#x521B;&#x5EFA;&#x4E86;&#x5F88;&#x591A;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FC7;&#x6EE4; <code>label</code> &#x7684;&#x952E;&#x3001;&#x503C;&#x6765;&#x5F97;&#x5230;&#x6240;&#x9700;&#x7684;&#x8D44;&#x6E90;&#x5217;&#x8868;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker run</code> &#x8FD0;&#x884C;&#x4E00;&#x5806;&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x901A;&#x8FC7; <code>label</code> &#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x662F;&#x67B6;&#x6784;&#x4E2D;&#x7684;&#x54EA;&#x4E00;&#x90E8;&#x5206;&#x3002;</p><ul><li>&#x524D;&#x7AEF;&#xFF1A;<code>--label type=frontend</code></li><li>&#x4E2D;&#x95F4;&#x4EF6;&#xFF1A;<code>--label type=middleware</code></li><li>&#x5B58;&#x50A8;&#xFF1A;<code>--label type=storage</code></li></ul><p>&#x5728;&#x540E;&#x671F;&#x7EF4;&#x62A4;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FC7;&#x6EE4;&#x663E;&#x793A;&#x60F3;&#x8981;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x53EA;&#x60F3;&#x770B;&#x524D;&#x7AEF;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x60C5;&#x51B5;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps --filter label=<span class="built_in">type</span>=frontend</span><br></pre></td></tr></table></figure><p>&#x800C;&#x4E14;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x548C;&#x5176;&#x5B83;&#x547D;&#x4EE4;&#x914D;&#x5408;&#x64CD;&#x4F5C;&#x8FD9;&#x7EC4;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505C;&#x6B62;&#x6240;&#x6709;&#x524D;&#x7AEF;&#x5BB9;&#x5668;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -f label=<span class="built_in">type</span>=frontend)</span><br></pre></td></tr></table></figure><p>&#x4F7F;&#x7528; <code>label</code> &#x5728;&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x4E2D;&#x4E5F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x540C;&#x7684; Docker &#x4E3B;&#x673A;&#x7684;&#x5F15;&#x64CE; <code>dockerd</code> &#x53C2;&#x6570;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7; <code>label</code> &#x6765;&#x52A0;&#x5165;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#xFF1A;</p><ul><li>&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4E3A; <code>SSD</code>&#xFF1A;<code>--label storage=ssd</code></li><li>&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4E3A; <code>HDD</code>&#xFF1A;<code>--label storage=hdd</code></li></ul><p>&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x5E0C;&#x671B;&#x8DD1;&#x5728; <code>SSD</code> &#x4E0A;&#x4EE5;&#x83B7;&#x5F97;&#x66F4;&#x5927;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x800C;&#x65E5;&#x5FD7;&#x3001;&#x5907;&#x4EFD;&#x670D;&#x52A1;&#x5219;&#x5E0C;&#x671B;&#x8DD1;&#x5728; <code>HDD</code> &#x4E0A;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x5BB9;&#x91CF;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x505A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --name mysql \</span><br><span class="line">    --constraint <span class="string">&apos;engine.labels.storage == ssd&apos;</span> \</span><br><span class="line">    mysql</span><br></pre></td></tr></table></figure><h4 id="tian-jia-label-yi-ji-guo-lu"><a href="#&#x6DFB;&#x52A0;label&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4;" class="headerlink" title="&#x6DFB;&#x52A0;label&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4;"></a>&#x6DFB;&#x52A0;<code>label</code>&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4; <a href="#tian-jia-label-yi-ji-guo-lu" class="header-anchor">#</a></h4><p>&#x6DFB;&#x52A0; <code>label</code> &#x5927;&#x591A;&#x683C;&#x5F0F;&#x90FD;&#x662F;&#x5728;&#x521B;&#x5EFA;&#x3001;&#x4FEE;&#x6539;&#x8D44;&#x6E90;&#x65F6;&#xFF0C;&#x4F7F;&#x7528; <code>--label &lt;key&gt;=&lt;value&gt;</code> &#x53C2;&#x6570;&#xFF08;&#x90E8;&#x5206;&#x547D;&#x4EE4;&#x63D0;&#x4F9B;&#x4E86; <code>-l</code> &#x7F29;&#x5199;&#x5F62;&#x5F0F;&#xFF09;&#x3002;<code>value</code> &#x53EF;&#x4EE5;&#x7701;&#x7565;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A; <code>--label &lt;key&gt;</code>&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x591A;&#x7EC4; <code>label</code>&#xFF0C;&#x53EA;&#x9700;&#x591A;&#x7EC4; <code>--label</code> &#x5373;&#x53EF;&#x3002;</p><p>&#x8FC7;&#x6EE4; <code>label</code> &#x5219;&#x5927;&#x591A;&#x53D1;&#x751F;&#x5728;&#x5217;&#x8868;&#x547D;&#x4EE4;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>--filter label=&lt;key&gt;=&lt;value&gt;</code>&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x4E8E;&#x4E0D;&#x5173;&#x5FC3; <code>value</code> &#x7684;&#x60C5;&#x51B5;&#xFF0C;<code>--filter label=&lt;key&gt;</code>&#xFF08;&#x90E8;&#x5206;&#x547D;&#x4EE4;&#x63D0;&#x4F9B;&#x4E86; <code>-f</code> &#x7684;&#x7F29;&#x5199;&#x5F62;&#x5F0F;&#xFF09;&#x3002;</p><p>&#x4E0B;&#x9762;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x5217;&#x51FA;&#x4E86;&#x652F;&#x6301; <code>label</code> &#x7684;&#x547D;&#x4EE4;&#xFF08;&#x9664;&#x975E;&#x7279;&#x6B8A;&#x58F0;&#x660E;&#xFF0C;&#x201D;&#x6DFB;&#x52A0;&#x201D;&#x547D;&#x4EE4;&#x4F7F;&#x7528; <code>--label</code> &#x9009;&#x9879;&#x6DFB;&#x52A0; <code>label</code>&#xFF1B;&#x201D;&#x8FC7;&#x6EE4;&#x201D;&#x547D;&#x4EE4;&#x4F7F;&#x7528; <code>--filter</code> &#x8FC7;&#x6EE4;<code>label</code>&#xFF09;&#xFF1A;</p><ul><li>Docker &#x5F15;&#x64CE;<ul><li>&#x6DFB;&#x52A0;&#xFF1A;<code>dockerd</code>&#xFF1A; <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/</a></li></ul></li><li>&#x955C;&#x50CF;<ul><li>&#x6DFB;&#x52A0;&#xFF1A;<ul><li><code>docker build</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/build/</a></li><li><code>Dockerfile</code> &#x4E2D;&#x7684; <code>LABEL</code>&#xFF08;&#x4F1A;&#x7EE7;&#x627F;<code>FROM</code>&#x955C;&#x50CF;&#x7684;<code>LABEL</code>&#xFF09;&#xFF1A;<a href="https://docs.docker.com/engine/reference/builder/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/#/label</a></li></ul></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker images</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/images/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/images/#/filtering</a></li></ul></li><li>&#x5BB9;&#x5668;<ul><li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/create/</a><ul><li>&#x9664;&#x4E86; <code>--label</code> &#x5916;&#xFF0C;<code>docker create</code> &#x8FD8;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x9009;&#x9879; <code>--label-file</code> &#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D; <code>label</code></li></ul></li><li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker run</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/run/#/set-metadata-on-container--l---label---label-file" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/run/#/set-metadata-on-container--l---label---label-file</a><ul><li>&#x9664;&#x4E86; <code>--label</code> &#x5916;&#xFF0C;<code>docker run</code> &#x8FD8;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x9009;&#x9879; <code>--label-file</code> &#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D; <code>label</code></li></ul></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker ps</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/ps/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/ps/#/label</a></li></ul></li><li>&#x5377;<ul><li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker volume create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/volume_create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/volume_create/</a></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker volume ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/volume_ls/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/volume_ls/#/filtering</a></li></ul></li><li>&#x7F51;&#x7EDC;<ul><li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker network create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/network_create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/network_create/</a></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker network ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/network_ls/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/network_ls/#/filtering</a></li></ul></li><li>Swarm &#x8282;&#x70B9;<ul><li><code>docker node update</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/node_update/#/add-label-metadata-to-a-node" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/node_update/#/add-label-metadata-to-a-node</a><ul><li>&#x6DFB;&#x52A0;&#xFF1A;<code>--label-add</code></li><li>&#x5220;&#x9664;&#xFF1A;<code>--label-rm</code></li></ul></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker node ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/node_ls/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/node_ls/#/filtering</a></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker node ps</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/node_ps/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/node_ps/#/label</a></li></ul></li><li>&#x670D;&#x52A1;<ul><li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker service create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/set-metadata-on-a-service--l---label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_create/#/set-metadata-on-a-service--l---label</a><ul><li>&#x9664;&#x4E86; <code>--label</code> &#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--container-label</code> &#x6765;&#x6DFB;&#x52A0;&#x5BB9;&#x5668; <code>label</code></li></ul></li><li><code>docker service update</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_update/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_update/</a><ul><li>&#x6DFB;&#x52A0;&#x5BB9;&#x5668; <code>label</code>&#xFF1A;<code>--container-label-add</code></li><li>&#x5220;&#x9664;&#x5BB9;&#x5668; <code>label</code>&#xFF1A;<code>--container-label-rm</code></li><li>&#x6DFB;&#x52A0;&#x670D;&#x52A1; <code>label</code>&#xFF1A;<code>--label-add</code></li><li>&#x5220;&#x9664;&#x670D;&#x52A1; <code>label</code>&#xFF1A;<code>--label-rm</code></li></ul></li><li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker service ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_ls/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_ls/#/label</a></li></ul></li></ul><p>&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x8D44;&#x6E90;&#x5916;&#xFF0C;<code>docker events</code> &#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>label</code> &#x8FC7;&#x6EE4;&#x7ED3;&#x679C;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/events/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/events/</a></p><h4 id="ji-qun-diao-du-yue-shu"><a href="#&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F;" class="headerlink" title="&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F;"></a>&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F; <a href="#ji-qun-diao-du-yue-shu" class="header-anchor">#</a></h4><ul><li>&#x4E00;&#x4EE3; Swarm&#xFF1A;&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6DFB;&#x52A0;&#x7EA6;&#x675F;<ul><li><code>docker run</code>&#xFF1A;<code>-e constraint:storage==sdd</code>&#xFF1A;<a href="https://docs.docker.com/swarm/scheduler/filter/#/how-to-write-filter-expressions" target="_blank" rel="noopener">https://docs.docker.com/swarm/scheduler/filter/#/how-to-write-filter-expressions</a></li><li><code>docker-compose.yml</code>&#xFF1A;&#x4F7F;&#x7528; <code>environment</code> &#x6765;&#x8FDB;&#x884C;&#x7EA6;&#x675F;&#xFF1A;<a href="https://docs.docker.com/compose/swarm/#/manual-scheduling" target="_blank" rel="noopener">https://docs.docker.com/compose/swarm/#/manual-scheduling</a></li></ul></li></ul><p>&#x5982;&#xFF1A;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;constraint:storage==ssd&quot;</span></span><br></pre></td></tr></table></figure><ul><li>&#x4E8C;&#x4EE3; Swarm<ul><li><code>docker service create</code>&#xFF1A;<code>--constraint value</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/specify-service-constraints---constraint" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_create/#/specify-service-constraints---constraint</a></li></ul></li></ul><p>&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>Swarm &#x8282;&#x70B9;</code> &#x7684; <code>label</code> &#x8FDB;&#x884C;&#x7EA6;&#x675F;&#xFF08;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x6B21;&#x7528;&#x7684;&#x4E0D;&#x662F;<code>&#x5F15;&#x64CE;</code>&#x7684;<code>label</code>&#xFF09;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --name web \</span><br><span class="line">    --constraint <span class="string">&apos;node.labels.type == frontend&apos;</span> \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure><h3 id="du-shuo-bu-yao-yong-root-qu-yun-xing-fu-wu-dan-wo-kan-dao-de-dockerfile-du-shi-yong-root-qu-yun-xing-zhe-bu-an-quan-ba"><a href="#&#x90FD;&#x8BF4;&#x4E0D;&#x8981;&#x7528;-root-&#x53BB;&#x8FD0;&#x884C;&#x670D;&#x52A1;&#xFF0C;&#x4F46;&#x6211;&#x770B;&#x5230;&#x7684;-Dockerfile-&#x90FD;&#x662F;&#x7528;-root-&#x53BB;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x5427;&#xFF1F;" class="headerlink" title="&#x90FD;&#x8BF4;&#x4E0D;&#x8981;&#x7528; root &#x53BB;&#x8FD0;&#x884C;&#x670D;&#x52A1;&#xFF0C;&#x4F46;&#x6211;&#x770B;&#x5230;&#x7684; Dockerfile &#x90FD;&#x662F;&#x7528; root &#x53BB;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x5427;&#xFF1F;"></a>&#x90FD;&#x8BF4;&#x4E0D;&#x8981;&#x7528; <code>root</code> &#x53BB;&#x8FD0;&#x884C;&#x670D;&#x52A1;&#xFF0C;&#x4F46;&#x6211;&#x770B;&#x5230;&#x7684; <code>Dockerfile</code> &#x90FD;&#x662F;&#x7528; <code>root</code> &#x53BB;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x5427;&#xFF1F; <a href="#du-shuo-bu-yao-yong-root-qu-yun-xing-fu-wu-dan-wo-kan-dao-de-dockerfile-du-shi-yong-root-qu-yun-xing-zhe-bu-an-quan-ba" class="header-anchor">#</a></h3><p>&#x5E76;&#x975E;&#x6240;&#x6709;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code> &#x90FD;&#x662F;&#x7528; <code>root</code> &#x7528;&#x6237;&#x53BB;&#x6267;&#x884C;&#x7684;&#x3002;&#x6BD4;&#x5982; <code>mysql</code> &#x955C;&#x50CF;&#x7684;&#x6267;&#x884C;&#x8EAB;&#x4EFD;&#x5C31;&#x662F; <code>mysql</code> &#x7528;&#x6237;&#xFF1B;<code>redis</code> &#x955C;&#x50CF;&#x7684;&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x7528;&#x6237;&#x5C31;&#x662F; <code>redis</code>&#xFF1B;<code>mongo</code> &#x955C;&#x50CF;&#x5185;&#x7684;&#x670D;&#x52A1;&#x6267;&#x884C;&#x8EAB;&#x4EFD;&#x662F; <code>mongo</code> &#x7528;&#x6237;&#xFF1B;<code>jenkins</code> &#x955C;&#x50CF;&#x5185;&#x662F; <code>jenkins</code> &#x7528;&#x6237;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7B49;&#x7B49;&#x3002;&#x6240;&#x4EE5;&#x8BF4; &#x201C;&#x90FD;&#x662F;&#x7528; <code>root</code> &#x53BB;&#x8FD0;&#x884C;&#x201D; &#x662F;&#x4E0D;&#x5BA2;&#x89C2;&#x7684;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x5728;<strong>&#x5BB9;&#x5668;&#x5185;</strong>&#x4F7F;&#x7528; <code>root</code> &#x5C31;&#x975E;&#x5E38;&#x5371;&#x9669;&#x3002;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>root</code> &#x548C;&#x5BBF;&#x4E3B;&#x4E0A;&#x7684; <code>root</code> &#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>root</code> &#x867D;&#x7136; <code>uid</code> &#x4E5F;&#x9ED8;&#x8BA4;&#x4E3A; <code>0</code>&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x5904;&#x4E8E;&#x4E00;&#x4E2A;&#x9694;&#x79BB;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x800C;&#x4E14;&#x88AB;&#x53BB;&#x6389;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x7279;&#x6743;&#x3002;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>root</code> &#x662F;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7279;&#x6743;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x5371;&#x9669;&#x7684;&#x64CD;&#x4F5C;&#x57FA;&#x672C;&#x90FD;&#x65E0;&#x6CD5;&#x6267;&#x884C;&#x3002;</p><p>&#x4E0D;&#x8FC7;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6253;&#x7834;&#x8FD9;&#x4E2A;&#x5B89;&#x5168;&#x4FDD;&#x62A4;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x53E6;&#x5916;&#x4E00;&#x56DE;&#x4E8B;&#x4E86;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x6302;&#x8F7D;&#x4E86;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7ED9;&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6253;&#x901A;&#x4E86;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>root</code> &#x64CD;&#x63A7;&#x5BBF;&#x4E3B;&#x7684;&#x4E00;&#x4E2A;&#x901A;&#x9053;&#xFF0C;&#x4F7F;&#x5F97;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>root</code> &#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x6240;&#x6302;&#x8F7D;&#x7684;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x3002;</p><p>&#x56E0;&#x4E3A;&#x5F53;&#x524D;&#x7248;&#x672C;&#x7684; Docker &#x4E2D;&#xFF0C;<strong>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;</strong>&#x5BB9;&#x5668;&#x7684; <code>user namespace</code> &#x5E76;&#x672A;&#x5F00;&#x542F;&#xFF0C;&#x6240;&#x4EE5;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x7528;&#x6237;&#x548C;&#x5BBF;&#x4E3B;&#x7528;&#x6237;&#x5171;&#x4EAB; <code>uid</code> &#x7A7A;&#x95F4;&#x3002;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>uid</code> &#x4E3A; <code>0</code> &#x7684; <code>root</code>&#xFF0C;&#x5C31;&#x88AB;&#x7CFB;&#x7EDF;&#x89C6;&#x4E3A; <code>uid=0</code> &#x7684;&#x5BBF;&#x4E3B; <code>root</code>&#xFF0C;&#x56E0;&#x6B64;&#x78C1;&#x76D8;&#x8BFB;&#x5199;&#x65F6;&#xFF0C;&#x5177;&#x6709;&#x5BBF;&#x4E3B; <code>root</code> &#x540C;&#x7B49;&#x8BFB;&#x5199;&#x6743;&#x9650;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E00;&#x822C;&#x4E0D;&#x63A8;&#x8350;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x3001;&#x7279;&#x522B;&#x662F;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x7CFB;&#x7EDF;&#x76EE;&#x5F55;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x3002;&#x8FD9;&#x4E00;&#x5207;&#x53EA;&#x8981;&#x5B9A;&#x5236;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x4E0D;&#x4F7F;&#x7528; <code>root</code> &#x542F;&#x52A8;&#x670D;&#x52A1;&#x5C31;&#x6CA1;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x4E0A;&#x9762;&#x8BF4;&#x7684;&#x95EE;&#x9898;&#x53EA;&#x662F;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B; <code>user namespace</code> &#x4E0D;&#x4F1A;&#x542F;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;<code>dockerd</code> &#x6709;&#x4E00;&#x4E2A; <code>--userns-remap</code> &#x53C2;&#x6570;&#xFF0C;&#x53EA;&#x8981;&#x914D;&#x7F6E;&#x4E86;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>uid</code> &#x662F;&#x72EC;&#x7ACB;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>uid</code> &#x53D8;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x88AB; <code>remap</code> &#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>uid=0</code> &#x7684; <code>root</code> &#x5C06;&#x5B8C;&#x5168;&#x8DDF; <code>root</code> &#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5173;&#x7CFB;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x4E2A;&#x666E;&#x901A;&#x7528;&#x6237;&#x800C;&#x5DF2;&#x3002;</p><p>&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x8BF7;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;</p><ul><li><code>--userns-remap</code> &#x7684;&#x4ECB;&#x7ECD;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#/daemon-user-namespace-options" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/#/daemon-user-namespace-options</a></li><li>Docker &#x5B89;&#x5168;&#xFF1A;<a href="https://docs.docker.com/engine/security/security/" target="_blank" rel="noopener">https://docs.docker.com/engine/security/security/</a></li></ul><h3 id="wo-zai-rong-qi-li-yun-xing-systemctl-start-xxx-zen-me-bao-cuo-a"><a href="#&#x6211;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;-systemctl-start-xxx-&#x600E;&#x4E48;&#x62A5;&#x9519;&#x554A;&#xFF1F;" class="headerlink" title="&#x6211;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C; systemctl start xxx &#x600E;&#x4E48;&#x62A5;&#x9519;&#x554A;&#xFF1F;"></a>&#x6211;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C; <code>systemctl start xxx</code> &#x600E;&#x4E48;&#x62A5;&#x9519;&#x554A;&#xFF1F; <a href="#wo-zai-rong-qi-li-yun-xing-systemctl-start-xxx-zen-me-bao-cuo-a" class="header-anchor">#</a></h3><p>&#x5982;&#x679C;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; <code>systemctl</code> &#x547D;&#x4EE4;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x53D1;&#x73B0;&#x78B0;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed to get D-Bus connection: Operation not permitted</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x5F88;&#x6B63;&#x5E38;&#xFF0C;&#x56E0;&#x4E3A; <code>systemd</code> &#x662F;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#x7684;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x3001;&#x7EF4;&#x62A4;&#x7684;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#xFF0C;&#x800C;&#x4E14;&#x9700;&#x8981;&#x7279;&#x6743;&#x53BB;&#x6267;&#x884C;&#x3002;&#x4F46;&#x662F;&#x5BB9;&#x5668;&#x4E0D;&#x662F;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#xFF0C;&#x65E2;&#x6CA1;&#x6709;&#x914D;&#x5408;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x7279;&#x6743;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x7136;&#x7528;&#x4E0D;&#x4E86;&#x3002;</p><p>&#x5982;&#x679C;&#x4F60;&#x78B0;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EA;&#x80FD;&#x518D;&#x6B21;&#x63D0;&#x9192;&#x4F60;&#xFF0C;<strong>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;</strong>&#x3002;&#x8BD5;&#x56FE;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x6267;&#x884C; <code>systemctl</code> &#x547D;&#x4EE4;&#x7684;&#xFF0C;&#x5927;&#x591A;&#x90FD;&#x662F;&#x8FD8;&#x6CA1;&#x6709;&#x641E;&#x660E;&#x767D;&#x5BB9;&#x5668;&#x548C;&#x865A;&#x62DF;&#x673A;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x56E0;&#x4E3A;&#x770B;&#x5230;&#x4E86;&#x53EF;&#x4EE5;&#x6709; Shell&#xFF0C;&#x5C31;&#x4EE5;&#x4E3A;&#x8FD9;&#x662F;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x8BD5;&#x56FE;&#x91CD;&#x590D;&#x81EA;&#x5DF1;&#x5728;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x4F53;&#x9A8C;&#x3002;&#x8FD9;&#x662F;&#x7528;&#x6CD5;&#x9519;&#x8BEF;&#xFF0C;<strong>&#x4E0D;&#x8981;&#x628A; Docker &#x5F53;&#x505A;&#x865A;&#x62DF;&#x673A;&#x53BB;&#x7528;&#xFF0C;&#x5BB9;&#x5668;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7528;&#x6CD5;</strong>&#x3002;</p><blockquote><p>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x53D7;&#x9650;&#x8FDB;&#x7A0B;&#x3002;</p></blockquote><p>&#x5BB9;&#x5668;&#x5185;&#x6839;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x540E;&#x53F0;&#x670D;&#x52A1;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x670D;&#x52A1;&#x8C03;&#x5EA6;&#x548C;&#x7EF4;&#x62A4;&#xFF0C;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x9700;&#x8981; <code>systemd</code>&#x3002;&#x5BB9;&#x5668;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x3002;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x5C31;&#x662F;&#x56F4;&#x7ED5;&#x7740;&#x8FD9;&#x4E2A;&#x4E3B;&#x8FDB;&#x7A0B;&#x800C;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6240;&#x8BD5;&#x56FE;&#x542F;&#x52A8;&#x7684;&#x540E;&#x53F0;&#x670D;&#x52A1;&#xFF0C;&#x5E94;&#x8BE5;&#x6539;&#x4E3A;&#x76F4;&#x63A5;&#x5728;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;&#x6839;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x4E5F;&#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>systemctl</code> &#x547D;&#x4EE4;&#x53BB;&#x5728;&#x540E;&#x53F0;&#x52A0;&#x8F7D;&#x3002;&#x65E5;&#x5FD7;&#x4E4B;&#x7C7B;&#x7684;&#x4E5F;&#x662F;&#x76F4;&#x63A5;&#x4ECE; <code>stdout</code>/<code>stderr</code> &#x8F93;&#x51FA;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8D70; <code>journald</code>&#x3002;</p><h3 id="rong-qi-nei-de-shi-jian-he-su-zhu-bu-yi-zhi-zen-me-tong-bu-a"><a href="#&#x5BB9;&#x5668;&#x5185;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x600E;&#x4E48;&#x540C;&#x6B65;&#x554A;&#xFF1F;" class="headerlink" title="&#x5BB9;&#x5668;&#x5185;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x600E;&#x4E48;&#x540C;&#x6B65;&#x554A;&#xFF1F;"></a>&#x5BB9;&#x5668;&#x5185;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x5BBF;&#x4E3B;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x600E;&#x4E48;&#x540C;&#x6B65;&#x554A;&#xFF1F; <a href="#rong-qi-nei-de-shi-jian-he-su-zhu-bu-yi-zhi-zen-me-tong-bu-a" class="header-anchor">#</a></h3><p>&#x95EE;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x4EBA;&#x5F80;&#x5F80;&#x6DF7;&#x6DC6;&#x4E86;<strong>&#x65F6;&#x95F4;</strong>&#x548C;<strong>&#x65F6;&#x533A;</strong>&#x7684;&#x6982;&#x5FF5;&#x3002;</p><p><strong>&#x65F6;&#x95F4;</strong>&#x662F;&#x4ECE; <code>epoch</code> &#x5230;&#x5F53;&#x524D;&#x7684;&#x79D2;&#x6570;&#x6216;&#x8005;&#x6BEB;&#x79D2;&#x6570;&#xFF0C;&#x5168;&#x7403;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x662F;&#x7EDD;&#x5BF9;&#x503C;&#xFF1B;&#x800C;<strong>&#x65F6;&#x533A;</strong>&#x5219;&#x662F;&#x7531;&#x4E8E;&#x5730;&#x7406;&#x4F4D;&#x7F6E;&#x5DEE;&#x5F02;&#x3001;&#x884C;&#x653F;&#x533A;&#x5212;&#x5BFC;&#x81F4;&#x5404;&#x5730;&#x663E;&#x793A;&#x65F6;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#x3002;</p><p>&#x5BF9;&#x4E8E; Docker &#x5BB9;&#x5668;&#x800C;&#x8A00;&#xFF0C;&#x6839;&#x672C;&#x4E0D;&#x5B58;&#x5728;&#x5BBF;&#x4E3B;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x95F4;&#x5DEE;&#x5F02;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5185;&#x6838;&#x3001;&#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#xFF0C;&#x4E8C;&#x8005;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x4EE5;&#x6839;&#x672C;&#x4E0D;&#x5B58;&#x5728;&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;&#x8FD8;&#x662F;&#x90A3;&#x53E5;&#x8BDD; <strong>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;</strong>&#x3002;</p><p>&#x6240;&#x770B;&#x5230;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x5982;&#x679C;&#x7EC6;&#x5FC3;&#x4E00;&#x70B9;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x5B9E;&#x6839;&#x672C;&#x4E0D;&#x662F;<strong>&#x65F6;&#x95F4;</strong>&#x540C;&#x6B65;&#x95EE;&#x9898;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it ubuntu bash</span><br><span class="line">root@08c6ad41f343:/<span class="comment"># date</span></span><br><span class="line">Tue Dec 13 01:36:37 UTC 2016</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x5230; <code>UTC</code> &#x4E86;&#x4E48;&#xFF0C;&#x8FD9;&#x662F;&#x8BF4;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x56FD;&#x9645;&#x6807;&#x51C6; <code>0 &#x65F6;&#x533A;</code> &#x7684;&#x65F6;&#x95F4;&#x663E;&#x793A;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x53EA;&#x662F;&#x663E;&#x793A;&#x6240;&#x7528;&#x7684;&#x65F6;&#x533A;&#x8BBE;&#x7F6E;&#x5DEE;&#x5F02;&#x95EE;&#x9898;&#x3002;&#x800C;&#x4E14;&#x4E4B;&#x524D;&#x5982;&#x679C;&#x7A0D;&#x5FAE;&#x6CE8;&#x610F;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x6240;&#x8C13;&#x65F6;&#x95F4;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6574;&#x6574;&#x5DEE;&#x4E86; <code>8</code> &#x4E2A;&#x5C0F;&#x65F6;&#xFF0C;&#x8FD8;&#x8BB0;&#x5F97;&#x4E2D;&#x5B66;&#x5730;&#x7406;&#x8BFE;&#x4E0A;&#x8BB2;&#x7684;&#x4E2D;&#x56FD;&#x65F6;&#x533A;&#x662F;&#x591A;&#x5C11;&#x4E48;&#xFF1F;&#x662F; <code>+8 &#x65F6;&#x533A;</code>&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x7136;&#x548C; <code>0 &#x65F6;&#x533A;</code> &#x5DEE;&#x4E86; <code>8</code> &#x4E2A;&#x5C0F;&#x65F6;&#x3002;&#x5E94;&#x8BE5;&#x5F88;&#x5FEB;&#x5C31;&#x610F;&#x8BC6;&#x5230;&#x662F;&#x81EA;&#x5DF1;&#x7684;&#x65F6;&#x533A;&#x8BBE;&#x9519;&#x4E86;&#xFF08;&#x6216;&#x8005;&#x5077;&#x61D2;&#x6CA1;&#x8BBE;&#xFF09;&#x5BFC;&#x81F4;&#x3002;</p><p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x8BBE;&#x7F6E;&#x65F6;&#x533A;&#x5373;&#x53EF;&#x3002;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>TZ</code> &#x5C31;&#x591F;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it -e TZ=Asia/Shanghai debian bash</span><br><span class="line">root@8e6d6c588328:/<span class="comment"># date</span></span><br><span class="line">Tue Dec 13 09:41:21 CST 2016</span><br></pre></td></tr></table></figure><p>&#x770B;&#x5230;&#x4E86;&#x4E48;&#xFF1F;&#x65F6;&#x533A;&#x8C03;&#x6574;&#x5230;&#x4E86; <code>CST</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>China Standard Time - &#x4E2D;&#x56FD;&#x6807;&#x51C6;&#x65F6;&#x95F4;</code>&#xFF0C;&#x56E0;&#x6B64;&#x663E;&#x793A;&#x5C31;&#x6B63;&#x5E38;&#x4E86;&#x3002;</p><p>&#x4E0D;&#x8FC7;&#x5E76;&#x975E;&#x6240;&#x6709;&#x7CFB;&#x7EDF;&#x90FD;&#x53EF;&#x4EE5;&#x5982;&#x6B64;&#x65B9;&#x4FBF;&#x7684;&#x8BBE;&#x7F6E;&#x65F6;&#x533A;&#x3002;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>TZ=Asia/Shanghai</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4FEE;&#x6539;&#x65F6;&#x533A;&#x7684;&#x7CFB;&#x7EDF;&#x6709;&#xFF1A;</p><ul><li><code>centos</code> (<code>5</code>, <code>6</code>, <code>7</code>)</li><li><code>debian</code> (<code>7</code>, <code>8</code>, <code>9</code>)</li><li><code>fedora</code> (<code>24</code>, <code>25</code>, <code>26</code>)</li><li><code>ubuntu</code> (<code>14.04</code>)</li></ul><p>&#x800C;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x4E9B;&#x7CFB;&#x7EDF;&#x53EF;&#x80FD;&#x51FA;&#x4E8E;&#x955C;&#x50CF;&#x4F53;&#x79EF;&#x7684;&#x8003;&#x8651;&#xFF0C;&#x53BB;&#x6389;&#x4E86;&#x65F6;&#x533A;&#x7684;&#x8F6F;&#x4EF6;&#x5305; <code>tzdata</code>&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x5148;&#x884C;&#x5B89;&#x88C5;&#x65F6;&#x533A;&#x5305;&#x3002;</p><ul><li><code>ubuntu</code>: (<code>16.04</code>, <code>17.04</code>, <code>17.10</code>) (~15MB)<ul><li><code>Dockerfile</code>:</li></ul></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash">  &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="bash">  &amp;&amp; apt-get install tzdata locales \</span></span><br><span class="line"><span class="bash">  &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br></pre></td></tr></table></figure><ul><li><code>alpine</code> (~1.3MB)<ul><li><code>Dockerfile</code>: <code>RUN apk --no-cache add tzdata</code></li></ul></li><li><code>opensuse</code> (~12MB)<ul><li><code>Dockerfile</code>:</li></ul></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash">    &amp;&amp; zypper --non-interactive refresh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; zypper --non-interactive -qn install --no-recommends timezone \</span></span><br><span class="line"><span class="bash">    &amp;&amp; zypper --non-interactive clean -a</span></span><br></pre></td></tr></table></figure><ul><li><code>clearlinux</code> (~280MB &#x2026;&#x1F602;)<ul><li><code>Dockerfile</code>:</li></ul></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash">    &amp;&amp; swupd bundle-add sysadmin-basic \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/swupd/*</span></span><br></pre></td></tr></table></figure><p>&#x4E0A;&#x9762;&#x5217;&#x8868;&#x9664;&#x4E86;&#x5217;&#x51FA;&#x7CFB;&#x7EDF;&#x5916;&#xFF0C;&#x8FD8;&#x7ED9;&#x51FA;&#x4E86;&#x6BCF;&#x4E2A;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5230; <code>Dockerfile</code> &#x7684;&#x5B89;&#x88C5;&#x5305;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4EE5;&#x53CA;&#x5B89;&#x88C5;&#x540E;&#x955C;&#x50CF;&#x4F53;&#x79EF;&#x589E;&#x52A0;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x5176;&#x4E2D; <code>clearlinux</code> &#x4E0D;&#x80FD;&#x5355;&#x4E2A;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;&#x6240;&#x4EE5;&#x4F53;&#x79EF;&#x589E;&#x52A0;&#x7684;&#x6709;&#x4E9B;&#x5938;&#x5F20;&#xFF0C;&#x56E0;&#x6B64;&#x66F4;&#x597D;&#x5730;&#x529E;&#x6CD5;&#x662F;&#x76F4;&#x63A5; <code>COPY</code> &#x65F6;&#x533A;&#x4FE1;&#x606F;&#x8FDB;&#x955C;&#x50CF;&#x3002;</p><blockquote><p>&#x6CE8;&#x610F;&#xFF1A;<code>ubuntu:16.04</code> &#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5728; 2017&#x5E74;4&#x6708;10 &#x65E5;&#x4EE5;&#x540E;&#xFF0C;&#x5DF2;&#x7ECF;&#x53BB;&#x9664; <code>tzdata</code>&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x6539;&#x53D8;&#x5176;&#x65F6;&#x533A;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x65F6;&#x533A;&#x5B89;&#x88C5;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;<strong>&#x4E0D;&#x662F;</strong>&#x50CF;&#x4EE5;&#x524D;&#x90A3;&#x6837;&#x53EA;&#x9700;&#x914D;&#x7F6E; <code>TZ</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5373;&#x53EF;&#x3002;<br>&#x4E0D;&#x8FC7;&#x5927;&#x90E8;&#x5206;<strong>&#x5B98;&#x65B9;&#x955C;&#x50CF;</strong>&#x662F;&#x57FA;&#x4E8E; <code>debian</code> &#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4EEC;<strong>&#x4E0D;&#x53D7;&#x5F71;&#x54CD;</strong>&#x3002;</p><p>&#x53C2;&#x8003; issue:</p><ul><li><a href="https://bugs.launchpad.net/cloud-images/+bug/1682622" target="_blank" rel="noopener">https://bugs.launchpad.net/cloud-images/+bug/1682622</a></li><li><a href="https://bugs.launchpad.net/cloud-images/+bug/1682305" target="_blank" rel="noopener">https://bugs.launchpad.net/cloud-images/+bug/1682305</a></li><li><a href="https://github.com/docker-library/official-images/issues/2863" target="_blank" rel="noopener">https://github.com/docker-library/official-images/issues/2863</a></li><li><a href="https://github.com/docker-library/official-images/issues/2856" target="_blank" rel="noopener">https://github.com/docker-library/official-images/issues/2856</a></li></ul></blockquote><p>&#x8FD9;&#x4EC5;&#x4EC5;&#x662F;&#x8C03;&#x6574;&#x5BB9;&#x5668;&#x5185;&#x7CFB;&#x7EDF;&#x73AF;&#x5883;&#x7684;&#x65F6;&#x533A;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x7A0B;&#x5E8F;&#x90FD;&#x4F1A;&#x9075;&#x5FAA;&#x8FD9;&#x4E2A;&#x6807;&#x51C6;&#x3002;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x5E94;&#x7528;&#x5E76;&#x4E0D;&#x9075;&#x5B88;&#x8FD9;&#x7C7B;&#x7EA6;&#x5B9A;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x65F6;&#x533A;&#x8BBE;&#x7F6E;&#x3002;</p><p>&#x4E00;&#x822C;&#x5E94;&#x7528;&#x3001;&#x670D;&#x52A1;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#x4E00;&#x822C;&#x90FD;&#x6709;&#x65F6;&#x533A;&#x9009;&#x9879;&#xFF0C;&#x5E94;&#x8BE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x9700;&#x6C42;&#x628A;&#x4E2D;&#x56FD;&#x65F6;&#x533A;&#x914D;&#x4E0A;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;PHP &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#xFF1A;</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Date]</span></span><br><span class="line"><span class="attr">date.timezone</span> = Asia/Shanghai</span><br></pre></td></tr></table></figure><p>&#x518D;&#x6BD4;&#x5982; <code>mysqld</code> &#x4E2D;&#x7684;&#x53C2;&#x6570; <code>--timezone=Asia/Shanghai</code>&#xFF1B;<code>Java</code> &#x7684; <code>-Duser.timezone=Asia/Shanghai</code> <code>JVM</code> &#x53C2;&#x6570;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E0A;&#x5C42;&#x5E94;&#x7528;&#x65F6;&#x533A;&#xFF0C;&#x800C;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x65F6;&#x533A;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x63A8;&#x8350;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x907F;&#x514D;&#x7CFB;&#x7EDF;&#x90E8;&#x7F72;&#x65F6;&#x53D7;&#x7CFB;&#x7EDF;&#x65F6;&#x533A;&#x5F71;&#x54CD;&#xFF0C;&#x8FD9;&#x5728;&#x5168;&#x7403;&#x4E91;&#x670D;&#x52A1;&#x5668;&#x73AF;&#x5883;&#x4E2D;&#x5176;&#x5B9E;&#x5F88;&#x5E38;&#x89C1;&#xFF0C;&#x56E0;&#x6B64;&#x5C3D;&#x91CF;&#x5728;&#x5E94;&#x7528;&#x5C42;&#x8BBE;&#x7F6E;&#x597D;&#x3002;&#x5F88;&#x591A;&#x5E94;&#x7528;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x65F6;&#x533A;&#x8BBE;&#x7F6E;&#xFF0C;&#x5E94;&#x8BE5;&#x53BB;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5E76;&#x4E14;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E0D;&#x8981;&#x603B;&#x7528;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p><p>&#x4E00;&#x4E9B;&#x4EBA;&#x5728;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x5F88;&#x61D2;&#x60F0;&#xFF0C;&#x53EA;&#x8981;&#x9ED8;&#x8BA4;&#x80FD;&#x7528;&#x5373;&#x53EF;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x4E00;&#x4E00;&#x68C0;&#x67E5;&#x6BCF;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x5426;&#x548C;&#x81EA;&#x5DF1;&#x671F;&#x671B;&#x4E00;&#x81F4;&#xFF0C;&#x8FD9;&#x662F;&#x5F88;&#x4E0D;&#x4E13;&#x4E1A;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x6B63;&#x662F;&#x8FD9;&#x79CD;&#x4E0D;&#x4E13;&#x4E1A;&#x624D;&#x5BFC;&#x81F4;&#x4E86;&#x51FA;&#x73B0;&#x4E86;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x505A;&#x4E8B;&#x60C5;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x8BA9;&#x81EA;&#x5DF1;&#x4EE5;&#x4E13;&#x4E1A;&#x7684;&#x89C6;&#x89D2;&#x548C;&#x6001;&#x5EA6;&#x770B;&#x95EE;&#x9898;&#x3002;</p><h3 id="wo-xiang-rang-wo-de-cheng-xu-ping-hua-tui-chu-wei-shi-me-jie-huo-sigterm-xin-hao-bu-guan-yong-a"><a href="#&#x6211;&#x60F3;&#x8BA9;&#x6211;&#x7684;&#x7A0B;&#x5E8F;&#x5E73;&#x6ED1;&#x9000;&#x51FA;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x622A;&#x83B7;-SIGTERM-&#x4FE1;&#x53F7;&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF1F;" class="headerlink" title="&#x6211;&#x60F3;&#x8BA9;&#x6211;&#x7684;&#x7A0B;&#x5E8F;&#x5E73;&#x6ED1;&#x9000;&#x51FA;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x622A;&#x83B7; SIGTERM &#x4FE1;&#x53F7;&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF1F;"></a>&#x6211;&#x60F3;&#x8BA9;&#x6211;&#x7684;&#x7A0B;&#x5E8F;&#x5E73;&#x6ED1;&#x9000;&#x51FA;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x622A;&#x83B7; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF1F; <a href="#wo-xiang-rang-wo-de-cheng-xu-ping-hua-tui-chu-wei-shi-me-jie-huo-sigterm-xin-hao-bu-guan-yong-a" class="header-anchor">#</a></h3><p><code>docker stop</code>, <code>docker service rm</code> &#x5728;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x5148;&#x53D1; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#xFF0C;&#x7B49;&#x5F85;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A; 10 &#x79D2;&#xFF09;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x7A0B;&#x5E8F;&#x6CA1;&#x54CD;&#x5E94;&#xFF0C;&#x5219;&#x5F3A;&#x884C; <code>SIGKILL</code> &#x6740;&#x6389;&#x8FDB;&#x7A0B;&#x3002;</p><p>&#x8FD9;&#x6837;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x5C31;&#x6709;&#x673A;&#x4F1A;&#x5E73;&#x6ED1;&#x9000;&#x51FA;&#xFF0C;&#x5728;&#x63A5;&#x6536;&#x5230; <code>SIGTERM</code> &#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB; Flush &#x7F13;&#x5B58;&#x3001;&#x5B8C;&#x6210;&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#x3001;&#x5173;&#x95ED;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x3001;&#x91CA;&#x653E;&#x6587;&#x4EF6;&#x8D44;&#x6E90;&#x3001;&#x91CA;&#x653E;&#x9501;&#x7B49;&#x7B49;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x9000;&#x51FA;&#x3002;&#x6240;&#x4EE5;&#x8BD5;&#x56FE;&#x622A;&#x83B7; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5BF9;&#x7684;&#x3002;</p><p>&#x4F46;&#x662F;&#xFF0C;&#x53EF;&#x80FD;&#x5728;&#x622A;&#x83B7; <code>SIGTERM</code> &#x65F6;&#x5374;&#x53D1;&#x73B0;&#xFF0C;&#x5374;&#x53D1;&#x73B0;&#x5E94;&#x7528;&#x5E76;&#x6CA1;&#x6709;&#x6536;&#x5230; <code>SIGTERM</code>&#xFF0C;&#x4E8E;&#x662F;&#x76F2;&#x76EE;&#x7684;&#x8BA4;&#x4E3A; Docker &#x4E0D;&#x652F;&#x6301;&#x5E73;&#x6ED1;&#x9000;&#x51FA;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x975E;&#x5982;&#x6B64;&#x3002;</p><p>&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;<strong>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x53D7;&#x9650;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x53EA;&#x5E94;&#x8BE5;&#x8DD1;&#x4E00;&#x4E2A;&#x4E3B;&#x8FDB;&#x7A0B;</strong>&#x7684;&#x8BF4;&#x6CD5;&#x4E48;&#xFF1F;&#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x622A;&#x83B7;&#x5230; <code>SIGTERM</code>&#xFF0C;&#x90A3;&#x5C31;&#x5F88;&#x53EF;&#x80FD;&#x4F60;&#x6CA1;&#x6709;&#x9075;&#x5FAA;&#x8FD9;&#x4E2A;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x56E0;&#x4E3A; <code>SIGTERM</code> &#x53EA;&#x4F1A;&#x53D1;&#x7ED9;&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5BB9;&#x5668;&#x5185; <code>PID</code> &#x4E3A; <code>1</code> &#x7684;&#x8FDB;&#x7A0B;&#x3002;</p><p>&#x81F3;&#x4E8E;&#x8BF4;&#x4E3B;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x90A3;&#x4E9B;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B8C;&#x5168;&#x770B;&#x4E3B;&#x8FDB;&#x7A0B;&#x662F;&#x5426;&#x613F;&#x610F;&#x8F6C;&#x53D1; <code>SIGTERM</code> &#x7ED9;&#x5B50;&#x8FDB;&#x7A0B;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x90A3;&#x4E9B;&#x628A; Docker &#x5F53;&#x505A;&#x865A;&#x62DF;&#x673A;&#x7528;&#x7684;&#xFF0C;&#x4E3B;&#x8FDB;&#x7A0B;&#x8DD1;&#x4E86;&#x4E2A; <code>bash</code>&#xFF0C;&#x7136;&#x540E; exec &#x8FDB;&#x53BB;&#x542F;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x6765;&#x4E2A; <code>&amp;</code> &#x8BA9;&#x7A0B;&#x5E8F;&#x8DD1;&#x540E;&#x53F0;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x5FC5;&#x7136;&#x65E0;&#x6CD5;&#x6536;&#x5230; <code>SIGTERM</code>&#x3002;</p><p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#x662F;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>CMD</code> &#x90A3;&#x884C;&#x7528;&#x7684;&#x662F; <code>shell</code> &#x683C;&#x5F0F;&#x5199;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x800C;&#x4E0D;&#x662F; <code>exec</code> &#x683C;&#x5F0F;&#x3002;&#x8FD8;&#x8BB0;&#x5F97;&#x524D;&#x9762;&#x63D0;&#x5230;&#x8FC7;&#x7684; <code>shell</code> &#x683C;&#x5F0F;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4F1A;&#x52A0;&#x4E00;&#x4E2A; <code>sh -c</code> &#x6765;&#x53BB;&#x6267;&#x884C;&#x4E48;&#xFF1F;&#x56E0;&#x6B64;&#x4F7F;&#x7528; <code>shell</code> &#x683C;&#x5F0F;&#x5199; <code>CMD</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;<code>PID</code> &#x4E3A; <code>1</code> &#x7684;&#x8FDB;&#x7A0B;&#x662F; <code>sh</code>&#xFF0C;&#x800C;&#x5B83;&#x4E0D;&#x8F6C;&#x53D1;&#x4FE1;&#x53F7;&#xFF0C;&#x6240;&#x4EE5;&#x4E3B;&#x7A0B;&#x5E8F;&#x6536;&#x4E0D;&#x5230;&#x3002;</p><p>&#x660E;&#x767D;&#x4E86;&#x9053;&#x7406;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5C31;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6362;&#x6210; <code>exec</code> &#x683C;&#x5F0F;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x4E3B;&#x8FDB;&#x7A0B;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x653E;&#x5728;&#x7B2C;&#x4E00;&#x4F4D;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E4B;&#x524D;&#x63A8;&#x8350; <code>exec</code> &#x683C;&#x5F0F;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x3002;</p><h1 id="docker-compose-xiang-guan-wen-ti-2"><a href="#Docker-Compose-&#x76F8;&#x5173;&#x95EE;&#x9898;-2" class="headerlink" title="Docker Compose &#x76F8;&#x5173;&#x95EE;&#x9898; (2)"></a>Docker Compose &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(2)</code> <a href="#docker-compose-xiang-guan-wen-ti-2" class="header-anchor">#</a></h1><h2 id="ni-na-ge-lnmp-li-zi-zhong-de-docker-compose-yml-zhong-you-hao-duo-networks-du-shi-shi-me-yi-si-a"><a href="#&#x4F60;&#x90A3;&#x4E2A;-LNMP-&#x4F8B;&#x5B50;&#x4E2D;&#x7684;-docker-compose-yml-&#x4E2D;&#x6709;&#x597D;&#x591A;-networks&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F;" class="headerlink" title="&#x4F60;&#x90A3;&#x4E2A; LNMP &#x4F8B;&#x5B50;&#x4E2D;&#x7684; docker-compose.yml &#x4E2D;&#x6709;&#x597D;&#x591A; networks&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F;"></a>&#x4F60;&#x90A3;&#x4E2A; <code>LNMP</code> &#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>docker-compose.yml</code> &#x4E2D;&#x6709;&#x597D;&#x591A; <code>networks</code>&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F; <a href="#ni-na-ge-lnmp-li-zi-zhong-de-docker-compose-yml-zhong-you-hao-duo-networks-du-shi-shi-me-yi-si-a" class="header-anchor">#</a></h2><p>&#x6211;&#x5199;&#x7684; <code>LNMP</code> &#x591A;&#x5BB9;&#x5668;&#x4E92;&#x901A;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p><p>&#x524D;&#x9762; <code>services</code> &#x4E0B;&#x7684;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x4E0B;&#x9762;&#x7684; <code>networks</code>&#xFF0C;&#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x8981;&#x63A5;&#x5230;&#x54EA;&#x4E2A;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;<br>&#x800C;&#x6700;&#x540E;&#x7684;&#x90A3;&#x4E2A;&#x603B;&#x7684;<code>networks</code>&#x4E0B;&#x9762;&#x7684;&#xFF0C;&#x662F;&#x8FD9;&#x51E0;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<code>nginx</code> &#x63A5;&#x5230;&#x4E86;&#x540D;&#x4E3A; <code>frontend</code> &#x7684;&#x524D;&#x7AEF;&#x7F51;&#x7EDC;&#xFF1B;<code>mysql</code> &#x63A5;&#x5230;&#x4E86;&#x540D;&#x4E3A; <code>backend</code> &#x7684;&#x540E;&#x7AEF;&#x7F51;&#x7EDC;&#xFF1B;&#x800C;&#x4F5C;&#x4E3A;&#x4E2D;&#x95F4;&#x7684; <code>php</code> &#x65E2;&#x9700;&#x8981;&#x548C; <code>nginx</code> &#x901A;&#x8BAF;&#xFF0C;&#x53C8;&#x9700;&#x8981;&#x548C; <code>mysql</code> &#x901A;&#x8BAF;&#xFF0C;&#x6240;&#x4EE5;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x4E86; <code>frontend</code> &#x548C; <code>backend</code> &#x7F51;&#x7EDC;&#x3002;&#x7531;&#x4E8E; <code>nginx</code> &#x548C; <code>mysql</code> &#x4E0D;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x7F51;&#x7EDC;&#xFF0C;&#x6240;&#x4EE5;&#x4E8C;&#x8005;&#x65E0;&#x6CD5;&#x901A;&#x8BAF;&#xFF0C;&#x8D77;&#x5230;&#x4E86;&#x9694;&#x79BB;&#x7684;&#x4F5C;&#x7528;&#x3002;</p><p>&#x5173;&#x4E8E; Docker &#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x4ECB;&#x7ECD;&#xFF1A;<br><a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/#/user-defined-networks" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/dockernetworks/#/user-defined-networks</a></p><p>&#x5173;&#x4E8E;&#x5728; Docker Compose &#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5B98;&#x65B9;&#x8FD9;&#x90E8;&#x5206;&#x6587;&#x6863;&#xFF1A;<br><a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener">https://docs.docker.com/compose/networking/</a></p><h2 id="shi-yong-compose-de-shi-hou-peng-dao-an-http-request-took-too-long-to-complete-cuo-wu-zen-me-ban"><a href="#&#x4F7F;&#x7528;-Compose-&#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230;-&#x201C;An-HTTP-request-took-too-long-to-complete&#x2026;-&#x201D;-&#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x4F7F;&#x7528; Compose &#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230; &#x201C;An HTTP request took too long to complete&#x2026;.&#x201D; &#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x4F7F;&#x7528; Compose &#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230; &#x201C;An HTTP request took too long to complete&#x2026;.&#x201D; &#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#shi-yong-compose-de-shi-hou-peng-dao-an-http-request-took-too-long-to-complete-cuo-wu-zen-me-ban" class="header-anchor">#</a></h2><p>Compose &#x7684;&#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x65F6;&#x9650;&#x662F;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x7684;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> COMPOSE_HTTP_TIMEOUT=120</span><br></pre></td></tr></table></figure><p>&#x4E0D;&#x8FC7;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x5E94;&#x8BE5;&#x8D85;&#x65F6;&#xFF0C;&#x8D85;&#x65F6;&#x7684;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;&#x6240;&#x8BBF;&#x95EE;&#x7684; Docker Engine &#x8FC7;&#x4E8E;&#x7E41;&#x5FD9;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x54CD;&#x5E94; Compose &#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5E94;&#x8BE5;&#x68C0;&#x67E5;&#x5177;&#x4F53; Docker Engine &#x51FA;&#x4E86;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x8FD8;&#x5728;&#x7528;&#x7740; <code>CentOS</code> &#x9ED8;&#x8BA4;&#x7684; <code>device mapper</code> &#x7684; <code>loop</code> &#x8BBE;&#x5907;&#xFF0C;&#x7B49;&#x7B49;&#x3002;</p><h1 id="docker-swarm-xiang-guan-wen-ti-8"><a href="#Docker-Swarm-&#x76F8;&#x5173;&#x95EE;&#x9898;-8" class="headerlink" title="Docker Swarm &#x76F8;&#x5173;&#x95EE;&#x9898; (8)"></a>Docker Swarm &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(8)</code> <a href="#docker-swarm-xiang-guan-wen-ti-8" class="header-anchor">#</a></h1><h2 id="wo-de-docker-ban-ben-shi-1-12-qing-wen-wo-pao-de-shi-yi-dai-swarm-huan-shi-er-dai-swarm-a"><a href="#&#x6211;&#x7684;-Docker-&#x7248;&#x672C;&#x662F;-1-12&#xFF0C;&#x8BF7;&#x95EE;&#x6211;&#x8DD1;&#x7684;&#x662F;&#x4E00;&#x4EE3;-Swarm-&#x8FD8;&#x662F;&#x4E8C;&#x4EE3;-Swarm-&#x554A;&#xFF1F;" class="headerlink" title="&#x6211;&#x7684; Docker &#x7248;&#x672C;&#x662F; 1.12&#xFF0C;&#x8BF7;&#x95EE;&#x6211;&#x8DD1;&#x7684;&#x662F;&#x4E00;&#x4EE3; Swarm &#x8FD8;&#x662F;&#x4E8C;&#x4EE3; Swarm &#x554A;&#xFF1F;"></a>&#x6211;&#x7684; Docker &#x7248;&#x672C;&#x662F; 1.12&#xFF0C;&#x8BF7;&#x95EE;&#x6211;&#x8DD1;&#x7684;&#x662F;&#x4E00;&#x4EE3; Swarm &#x8FD8;&#x662F;&#x4E8C;&#x4EE3; Swarm &#x554A;&#xFF1F; <a href="#wo-de-docker-ban-ben-shi-1-12-qing-wen-wo-pao-de-shi-yi-dai-swarm-huan-shi-er-dai-swarm-a" class="header-anchor">#</a></h2><p>&#x2026;&#x2026;&#x81EA;&#x5DF1;&#x8FD0;&#x884C;&#x7684; Swarm &#x600E;&#x4E48;&#x4F1A;&#x8FDE;&#x81EA;&#x5DF1;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x8DD1;&#x7684;&#x662F;&#x5565;&#xFF1F;&#x1F605;</p><p>&#x9996;&#x5148;&#xFF0C;&#x81F3;&#x4E8E;&#x662F;&#x8FD0;&#x884C;&#x7684;&#x4E00;&#x4EE3; Swarm &#x8FD8;&#x662F;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x5355;&#x770B;&#x7248;&#x672C;&#x662F;&#x6CA1;&#x610F;&#x4E49;&#x7684;&#x3002;<strong>Docker 1.12+ &#x7684;&#x7248;&#x672C;&#x540C;&#x65F6;&#x652F;&#x6301;&#x4E00;&#x4EE3; Swarm &#x548C;&#x4E8C;&#x4EE3; Swarm</strong>&#x3002;</p><p>&#x5982;&#x679C;&#x662F;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x5F62;&#x5F0F;&#x8FD0;&#x884C;&#x7684; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>docker run swarm</code> &#x5F62;&#x5F0F;&#x6784;&#x5EFA;&#x7684; Swarm&#xFF0C;&#x8FD9;&#x662F;<strong>&#x4E00;&#x4EE3; Swarm</strong>&#xFF0C;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A; <strong>Docker Swarm</strong>&#x3002;</p><p>&#x5982;&#x679C;&#x662F;&#x4F7F;&#x7528;&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#x5F62;&#x5F0F;&#x6784;&#x5EFA;&#x7684; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x547D;&#x4EE4; <code>docker swarm init</code> &#x5F62;&#x5F0F;&#x6784;&#x5EFA;&#x7684; Swarm&#xFF0C;&#x8FD9;&#x662F;&#x5185;&#x7F6E;&#x7684; Swarm&#xFF0C;&#x662F;<strong>&#x4E8C;&#x4EE3; Swarm</strong>&#xFF0C;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A; <strong>Docker Swarm Mode</strong>&#x3002;</p><h2 id="swarm-huan-jing-zhong-zen-me-zhi-ding-mou-ge-rong-qi-zai-zhi-ding-de-su-zhu-shang-yun-xing-ni"><a href="#Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F;" class="headerlink" title="Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F;"></a>Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F; <a href="#swarm-huan-jing-zhong-zen-me-zhi-ding-mou-ge-rong-qi-zai-zhi-ding-de-su-zhu-shang-yun-xing-ni" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A; Docker Host &#x5EFA;&#x7ACB;&#x65F6;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--label</code> &#x6307;&#x5B9A;&#x5176; Docker &#x5F15;&#x64CE;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dockerd \</span><br><span class="line">    --label com.example.environment=<span class="string">&quot;production&quot;</span> \</span><br><span class="line">    --label com.example.storage=<span class="string">&quot;ssd&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x5E94;&#x8BE5;&#x914D;&#x7F6E;&#x5728; <code>Docker</code> &#x5F15;&#x64CE;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#x4FEE;&#x6539;&#xFF0C;&#x5982; <code>docker.service</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#x2026;&#x2026;</p></blockquote><p>&#x7136;&#x540E;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7EA6;&#x675F;&#x8C03;&#x5EA6;&#x5373;&#x53EF;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Compose &#x6587;&#x4EF6;&#x7684; <code>environment</code> &#x914D;&#x7F6E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker run</code> &#x7684; <code>-e</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x53C2;&#x6570;&#x3002;&#x4E0B;&#x9762;&#x4EE5; Compose &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E3A;&#x4F8B;&#xFF1A;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;constraint:com.example.storage==ssd&quot;</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x8FD9;&#x4E2A; <code>mongodb</code> &#x7684;&#x670D;&#x52A1;&#x5C31;&#x4F1A;&#x8FD0;&#x884C;&#x5728;&#x6807;&#x8BB0;&#x4E3A; <code>com.example.storage=&quot;ssd&quot;</code> &#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x3002;</p><h2 id="wei-shi-me-swarm-ji-qun-de-overlay-network-kua-su-zhu-wu-fa-hu-fang"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-Swarm-&#x96C6;&#x7FA4;&#x7684;-overlay-network-&#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; Swarm &#x96C6;&#x7FA4;&#x7684; overlay network &#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; Swarm &#x96C6;&#x7FA4;&#x7684; overlay network &#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F; <a href="#wei-shi-me-swarm-ji-qun-de-overlay-network-kua-su-zhu-wu-fa-hu-fang" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x68C0;&#x67E5;&#x5EFA;&#x7ACB; Swarm &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x5176;&#x5B83;&#x8282;&#x70B9;&#x6240;&#x5BA3;&#x544A;&#x7684;&#x672C;&#x8282;&#x70B9;&#x7684;&#x5730;&#x5740;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x5355;&#x7F51;&#x5361;&#x3001;&#x5355;IP&#x7684;&#x5BBF;&#x4E3B;&#xFF0C;Swarm &#x4F1A;&#x81EA;&#x52A8;&#x9009;&#x62E9;&#x7F51;&#x5361;&#x5730;&#x5740;&#xFF0C;&#x4F46;&#x662F;&#x591A;&#x7F51;&#x5361;&#x3001;&#x591A;IP&#x7684;&#x5BBF;&#x4E3B;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x5BA3;&#x544A;&#x5730;&#x5740;&#x3002;</p><ul><li>&#x5BF9;&#x4E8E;&#x4E00;&#x4EE3; Swarm &#x800C;&#x8A00;&#xFF0C;&#x68C0;&#x67E5;&#x4E00;&#x4E0B; <code>dockerd</code> &#x7684;&#x914D;&#x7F6E;&#x4E2D;&#xFF0C;<code>--cluster-advertise</code> &#x5730;&#x5740;&#x662F;&#x5426;&#x914D;&#x7F6E;&#x6B63;&#x786E;&#x3002;</li><li>&#x5BF9;&#x4E8E;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x5219;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x521B;&#x5EFA;&#x3001;&#x52A0;&#x5165; Swarm &#x7684;&#x65F6;&#x5019;&#xFF0C;<code>--advertise-addr</code> &#x662F;&#x5426;&#x586B;&#x5199;&#x6B63;&#x786E;&#x3002;</li></ul><p>&#x5BA3;&#x544A;&#x5730;&#x5740;&#x5FC5;&#x987B;&#x662F;&#x5168;&#x96C6;&#x7FA4;&#x53EF;&#x4EE5;&#x4E92;&#x8BBF;&#x7684;&#xFF0C;&#x7531;&#x4E8E;&#x8BE5;&#x5730;&#x5740;&#x7AEF;&#x53E3;&#x662F; <code>Docker Remote API</code> &#x7AEF;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528; <code>curl</code> &#x6765;&#x8FDE;&#x63A5;&#x5176;&#x5B83;&#x8282;&#x70B9;&#xFF0C;&#x4EE5;&#x5224;&#x65AD;&#x4E92;&#x901A;&#x6027;&#x3002;</p><p>&#x7136;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x5BBF;&#x4E3B;&#x95F4;&#x7684;&#x7F51;&#x7EDC;&#x4E92;&#x901A;&#x95EE;&#x9898;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x9632;&#x706B;&#x5899;&#x5F00;&#x542F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x68C0;&#x67E5;&#x4E0B;&#x5217;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x6709;&#x6CA1;&#x6709;&#x653E;&#x5F00;&#xFF1A;</p><ul><li><code>7946/{udp,tcp}</code></li><li><code>4789/{udp,tcp}</code></li><li>{<code>2375</code>,<code>2376</code>,<code>2377</code>,<code>3375</code>,<code>3376</code>}/<code>tcp</code> &#xFF08;&#x5177;&#x4F53;&#x7AEF;&#x53E3;&#x53D6;&#x51B3;&#x4E8E;&#x5B9E;&#x9645; <code>Swarm</code> &#x6216; <code>Engine</code> &#x5B88;&#x62A4;&#x7AEF;&#x53E3;)</li></ul><p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>telnet</code>, <code>curl</code> &#x4E4B;&#x7C7B;&#x7684;&#x5DE5;&#x5177;&#x786E;&#x4FDD;&#x4E0A;&#x8FF0;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x4E92;&#x8BBF;&#x3002;</p><p>&#x5982;&#x679C;&#x8FD8;&#x662F;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x542F;&#x7528;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x7684; Docker &#x5F15;&#x64CE;&#x7684;&#x8C03;&#x8BD5;&#x6A21;&#x5F0F;&#x3002;&#x548C;&#x914D;&#x7F6E; <code>--insecure-registry</code> &#x7684;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#xFF0C;&#x7F16;&#x8F91; Docker &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5728; <code>dockerd</code> &#x540E;&#x6DFB;&#x52A0; <code>-D</code> &#x53C2;&#x6570;&#x3002;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x542F;&#x52A8; Docker &#x5F15;&#x64CE;&#xFF0C;&#x5EFA;&#x7ACB;&#x96C6;&#x7FA4;&#x3001;&#x7F51;&#x7EDC;&#x3001;&#x670D;&#x52A1;&#x3002;&#x5982;&#x679C;&#x95EE;&#x9898;&#x91CD;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x6790; <code>Docker</code> &#x5F15;&#x64CE;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x5177;&#x4F53;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x7684;&#x65B9;&#x6CD5;&#x89C1;&#x524D;&#x9762;&#x7684;&#x95EE;&#x7B54;&#x3002;</p><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728; <code>1.13</code> &#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x8DE8;&#x5BBF;&#x4E3B;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x65E0;&#x6CD5;&#x5728;&#x5BB9;&#x5668;&#x5185; <code>ping</code> &#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684; <code>VIP</code>&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x4EE5; <code>ping tasks.&lt;&#x670D;&#x52A1;&#x540D;&gt;</code>&#xFF0C;&#x6765;&#x8DF3;&#x8FC7; <code>VIP</code> &#x8FDB;&#x884C; <code>ping</code>&#x3002;</p><p>&#x53C2;&#x8003;&#xFF1A;</p><p><a href="https://docs.docker.com/swarm/plan-for-production/" target="_blank" rel="noopener">https://docs.docker.com/swarm/plan-for-production/</a></p><p><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/#/open-ports-between-the-hosts" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/swarm-tutorial/#/open-ports-between-the-hosts</a></p><p><a href="https://docs.docker.com/engine/swarm/networking/" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/networking/</a></p><h2 id="docker-er-dai-swarm-ji-swarm-mode-docker-service-create-bu-ke-yi-shi-yong-v-na-zen-me-shi-yong-juan-volume"><a href="#Docker-&#x4E8C;&#x4EE3;Swarm-&#x65E2;-Swarm-Mode-&#xFF0C;docker-service-create-&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;-v-&#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;-Volume-&#xFF1F;" class="headerlink" title="Docker &#x4E8C;&#x4EE3;Swarm (&#x65E2; Swarm Mode)&#xFF0C;docker service create &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; -v &#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;(Volume)&#xFF1F;"></a>Docker &#x4E8C;&#x4EE3;Swarm (&#x65E2; Swarm Mode)&#xFF0C;<code>docker service create</code> &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-v</code> &#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;(Volume)&#xFF1F; <a href="#docker-er-dai-swarm-ji-swarm-mode-docker-service-create-bu-ke-yi-shi-yong-v-na-zen-me-shi-yong-juan-volume" class="header-anchor">#</a></h2><p>&#x4ECE;&#x4E8C;&#x4EE3; Swarm &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x4F7F;&#x7528; <code>--mount</code> &#x53C2;&#x6570;&#x6765;&#x8FDB;&#x884C;&#x5377;&#x6302;&#x8F7D;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x8BED;&#x4E49;&#x8FDB;&#x884C;&#x66F4;&#x660E;&#x786E;&#x7684;&#x5212;&#x5206;&#x3002;</p><p>&#x6302;&#x8F7D;&#x5206;&#x4E24;&#x79CD;&#xFF1A;</p><ul><li>&#x7ED1;&#x5B9A;&#x6302;&#x8F7D; <code>bind-mount</code>&#xFF1A;&#x8FD9;&#x7C7B;&#x6302;&#x8F7D;&#x5C06;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;/&#x6587;&#x4EF6;&#x7ED1;&#x5B9A;&#x5230;&#x5BB9;&#x5668;&#x7684;&#x67D0;&#x4E2A;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x7C7B;&#x6302;&#x8F7D;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5BBF;&#x4E3B;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x4E0D;&#x540C;uid&#x5BFC;&#x81F4;&#x7684;&#x6743;&#x9650;&#x3001;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5DEE;&#x5F02;&#x95EE;&#x9898;&#x3002;</li><li>&#x6570;&#x636E;&#x5377; <code>data volumes</code>&#xFF1A;&#x8FD9;&#x7C7B;&#x6302;&#x8F7D;&#x662F;&#x4E4B;&#x524D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x3002;&#x5377;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x547D;&#x540D;&#x5377;<code>named volume</code>&#x4EE5;&#x53CA;&#x533F;&#x540D;&#x5377;<code>anonymous volume</code></li></ul><p>&#x6302;&#x8F7D;&#x53C2;&#x6570;&#x7684;&#x683C;&#x5F0F;&#x57FA;&#x672C;&#x4E0A;&#x4E3A; <code>--mount &lt;key1&gt;=&lt;value1&gt;[,&lt;key2&gt;=&lt;value2&gt;,...]</code>&#x3002;</p><p>&#x4E3B;&#x8981;&#x53C2;&#x6570;&#x6709;&#xFF1A;</p><ul><li><code>type</code>: &#x5982;&#x4E4B;&#x524D;&#x6240;&#x8BF4;&#xFF0C;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A; <code>volume</code> &#x548C; <code>bind</code>&#x3002;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A; <code>type</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; <code>volume</code>&#xFF1B;</li><li><code>src</code> &#x6216; <code>source</code>&#xFF1A;&#x6E90;&#xFF1A;<ul><li>&#x5982;&#x679C; <code>type=volume</code>&#xFF0C;<code>src</code> &#x5219;&#x662F;&#x5377;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x662F;&#x53EF;&#x9009;&#x9879;&#x3002;&#x5982;&#x679C;&#x5B58;&#x5728;&#x5C31;&#x662F;&#x547D;&#x540D;&#x5377;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6307;&#x5B9A; <code>src</code> &#x5219;&#x662F;&#x533F;&#x540D;&#x5377;&#xFF1B;</li><li>&#x5982;&#x679C; <code>type=bind</code>&#xFF0C;<code>src</code> &#x662F;&#x5BBF;&#x4E3B;&#x672C;&#x5730;&#x7684;&#x8DEF;&#x5F84;&#xFF1B;</li></ul></li><li><code>dst</code> &#x6216; <code>destination</code> &#x6216; <code>target</code>&#xFF1A;&#x5C06;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x6302;&#x8F7D;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x4F1A;&#x5728;&#x6302;&#x8F7D;&#x524D;&#x81EA;&#x52A8;&#x5EFA;&#x7ACB;&#x8DEF;&#x5F84;&#x3002;</li><li><code>readonly</code> &#x6216; <code>ro</code>&#xFF1A;&#x662F;&#x5426;&#x8BA9;&#x8BE5;&#x6302;&#x8F7D;&#x4E3A;&#x53EA;&#x8BFB;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x8BFB;&#x5199;&#x3002;</li></ul><p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#xFF1A;</p><ul><li><code>volume-driver</code>&#xFF1A;&#x6307;&#x5B9A;&#x5377;&#x9A71;&#x52A8;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <code>local</code>&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x5176;&#x5B83;&#xFF08;&#x5982; <code>flocker</code>, <code>glusterfs</code>, <code>ceph</code>&#xFF09;&#x4E4B;&#x7C7B;&#x7684;&#x9A71;&#x52A8;&#xFF1B;</li><li><code>volume-label</code>&#xFF1A;&#x6307;&#x5B9A;&#x5377;&#x7684;&#x5143;&#x6570;&#x636E;(metadata)&#xFF0C;&#x4ECE;&#x800C;&#x65B9;&#x4FBF;&#x8FC7;&#x6EE4;&#x64CD;&#x4F5C;&#xFF1B;</li><li><code>volume-opt</code>&#xFF1A;&#x4E0D;&#x540C;&#x7684;&#x5377;&#x9A71;&#x52A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x3002;</li></ul><p><code>--mount</code> &#x548C; <code>--volume</code> &#x6709;&#x4E00;&#x4E9B;&#x5DEE;&#x5F02;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p><ul><li><code>--mount</code> &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5377;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x4E8B;&#x5148;&#x4F7F;&#x7528; <code>docker volume create</code> &#x6765;&#x521B;&#x5EFA;&#x5377;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x591A;&#x7EC4;&#x4E0D;&#x540C;&#x9A71;&#x52A8;&#x7684;&#x5377;&#xFF1B;</li><li><code>--mount</code> &#x5982;&#x679C; <code>type=bind</code> &#x7684;&#x8BDD;&#xFF0C;&#x5BBF;&#x4E3B;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#xFF0C;&#x5426;&#x5219;&#x62A5;&#x9519;&#x3002;&#x800C; <code>--volume</code> &#x5219;&#x5728;&#x5BBF;&#x4E3B;&#x4E0D;&#x5B58;&#x5728;&#x8BE5;&#x8DEF;&#x5F84;&#x65F6;&#xFF0C;&#x5728;&#x5BBF;&#x4E3B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x76EE;&#x5F55;&#x6765;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x3002;</li></ul><p>&#x4E3E;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p><p>&#x6302;&#x8F7D;&#x547D;&#x540D;&#x5377;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">  --name my-service \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=my-volume,destination=/path/<span class="keyword">in</span>/container,volume-label=<span class="string">&quot;color=red&quot;</span>,volume-label=<span class="string">&quot;shape=round&quot;</span> \</span><br><span class="line">  nginx:alpine</span><br></pre></td></tr></table></figure><p>&#x6302;&#x8F7D;&#x533F;&#x540D;&#x5377;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">  --name my-service \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  --mount <span class="built_in">type</span>=volume,destination=/path/<span class="keyword">in</span>/container \</span><br><span class="line">  nginx:alpine</span><br></pre></td></tr></table></figure><p>&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line"> --name my-service \</span><br><span class="line"> --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/path/on/host,destination=/path/<span class="keyword">in</span>/container \</span><br><span class="line"> nginx:alpine</span><br></pre></td></tr></table></figure><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/add-bind-mounts-or-volumes" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_create/#/add-bind-mounts-or-volumes</a></p><h2 id="dui-yu-liang-jie-dian-ji-qun-lai-shuo-replicas-2-he-mode-global-shi-bu-shi-yi-ge-yi-si"><a href="#&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;-replicas-2-&#x548C;-mode-global-&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F;" class="headerlink" title="&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;--replicas=2 &#x548C; --mode=global &#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F;"></a>&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;<code>--replicas=2</code> &#x548C; <code>--mode=global</code> &#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F; <a href="#dui-yu-liang-jie-dian-ji-qun-lai-shuo-replicas-2-he-mode-global-shi-bu-shi-yi-ge-yi-si" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x4E8C;&#x8005;&#x8BED;&#x4E49;&#x5C31;&#x4E0D;&#x540C;&#x3002;</p><ul><li><code>--replicas=2</code>&#xFF0C;&#x662F;&#x8981;&#x6C42;&#x8BE5;&#x670D;&#x52A1;&#x6709;2&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x65E0;&#x8BBA;&#x96C6;&#x7FA4;&#x591A;&#x5C11;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4E5F;&#x4E0D;&#x5728;&#x4E4E;&#x8FD9;&#x4E24;&#x4E2A;&#x526F;&#x672C;&#x662F;&#x4E0D;&#x662F;&#x90FD;&#x8DD1;&#x5728;&#x4E00;&#x4E2A;&#x5BBF;&#x4E3B;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF1B;</li><li><code>--mode=global</code>&#xFF0C;&#x662F;&#x8981;&#x6C42;&#x670D;&#x52A1;&#x5728;&#x96C6;&#x7FA4;&#x6BCF;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8DD1;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x3002;</li></ul><p>&#x73B0;&#x8C61;&#x4E0A;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;<code>--replicas=2</code> &#x662F;&#x8981;&#x786E;&#x4FDD;&#x526F;&#x672C;&#x4E3A;2&#x4E2A;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x4F1A;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x5728;&#x8D77;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x526F;&#x672C;&#x6570;&#x4E3A;2&#x3002;&#x800C;&#x5BF9;&#x4E8E; <code>--mode=global</code> &#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x4E0D;&#x4F1A;&#x518D;&#x53E6;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8D77;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x3002;</p><h2 id="yi-dai-swarm-de-shi-hou-ke-yi-yong-docker-run-a-er-dai-zen-me-you-nong-ge-docker-service-create-chu-lai-wei-shi-me-yao-duo-ci-yi-ju"><a href="#&#x4E00;&#x4EE3;-Swarm-&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x7528;-docker-run-&#x554A;&#xFF0C;&#x4E8C;&#x4EE3;&#x600E;&#x4E48;&#x53C8;&#x5F04;&#x4E2A;-docker-service-create-&#x51FA;&#x6765;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x591A;&#x6B64;&#x4E00;&#x4E3E;&#xFF1F;" class="headerlink" title="&#x4E00;&#x4EE3; Swarm &#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x7528; docker run &#x554A;&#xFF0C;&#x4E8C;&#x4EE3;&#x600E;&#x4E48;&#x53C8;&#x5F04;&#x4E2A; docker service create &#x51FA;&#x6765;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x591A;&#x6B64;&#x4E00;&#x4E3E;&#xFF1F;"></a>&#x4E00;&#x4EE3; Swarm &#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x7528; <code>docker run</code> &#x554A;&#xFF0C;&#x4E8C;&#x4EE3;&#x600E;&#x4E48;&#x53C8;&#x5F04;&#x4E2A; <code>docker service create</code> &#x51FA;&#x6765;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x591A;&#x6B64;&#x4E00;&#x4E3E;&#xFF1F; <a href="#yi-dai-swarm-de-shi-hou-ke-yi-yong-docker-run-a-er-dai-zen-me-you-nong-ge-docker-service-create-chu-lai-wei-shi-me-yao-duo-ci-yi-ju" class="header-anchor">#</a></h2><p>&#x56E0;&#x4E3A; <code>docker run</code> &#x548C; <code>docker service create</code> &#x662F;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7406;&#x5FF5;&#x7684;&#x4E1C;&#x897F;&#x3002;</p><p>&#x4E00;&#x4EE3; Swarm &#x4E2D;&#xFF0C;&#x5C06; Swarm &#x96C6;&#x7FA4;&#x89C6;&#x4E3A;&#x4E00;&#x4E2A;&#x5DE8;&#x5927;&#x7684; Docker &#x4E3B;&#x673A;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x548C;&#x5355;&#x673A;&#x6CA1;&#x6709;&#x533A;&#x522B;&#xFF0C;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x56E0;&#x6B64;&#x4F9D;&#x65E7;&#x4F7F;&#x7528;&#x5355;&#x673A;&#x7684; <code>docker run</code> &#x7684;&#x65B9;&#x5F0F;&#x6765;&#x542F;&#x52A8;&#x7279;&#x5B9A;&#x5BB9;&#x5668;&#x3002;</p><p>&#x4E8C;&#x4EE3; Swarm &#x5219;&#x6539;&#x53D8;&#x4E86;&#x8FD9;&#x4E2A;&#x7406;&#x5FF5;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x670D;&#x52A1;&#x6808;(<code>Stack</code>)&#x3001;&#x670D;&#x52A1;(<code>Service</code>)&#x3001;&#x4EFB;&#x52A1;(<code>Task</code>) &#x7684;&#x6982;&#x5FF5;&#x3002;&#x5728;&#x4E8C;&#x4EE3; Swarm &#x4E2D;&#xFF0C;&#x4E00;&#x7EC4;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x90E8;&#x7F72;&#x670D;&#x52A1;&#x6808;&#xFF0C;&#x8FD9;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x4E4B;&#x524D;&#x7684; Docker Compose &#x6240;&#x5B8C;&#x6210;&#x7684;&#x76EE;&#x7684;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x6B21;&#xFF0C;&#x662F;&#x771F;&#x6B63;&#x7684;&#x9488;&#x5BF9;<strong>&#x670D;&#x52A1;</strong>&#x7684;&#x3002;</p><p>&#x4E00;&#x4E2A;<strong>&#x670D;&#x52A1;</strong>&#x5E76;&#x975E;&#x4E00;&#x4E2A;<strong>&#x5BB9;&#x5668;</strong>&#xFF0C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x526F;&#x672C;<strong>&#x4EFB;&#x52A1;</strong>&#xFF0C;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x5728;&#x4E00;&#x4EE3; Swarm &#x548C;&#x5355;&#x673A;&#x73AF;&#x5883;&#x4E2D;&#x662F;&#x6CA1;&#x6709;&#x7684;&#xFF0C;&#x56E0;&#x6B64; Docker Compose &#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x7528;&#x4E86;&#x5404;&#x79CD;&#x529E;&#x6CD5;&#x53BB;&#x6A21;&#x62DF;&#xFF0C;&#x5305;&#x62EC;&#x4F7F;&#x7528; <code>labels</code>&#xFF0C;&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x522B;&#x540D;&#x7B49;&#x7B49;&#xFF0C;&#x4F46;&#x662F;&#x672C;&#x8D28;&#x4E0A;&#xFF0C;&#x4F9D;&#x65E7;&#x662F;&#x4EE5;&#x5BB9;&#x5668;&#x4E3A;&#x5355;&#x4F4D;&#x8FDB;&#x884C;&#x8FD0;&#x884C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x672C;&#x8D28;&#x4E0A;&#x8FD8;&#x662F;&#x4E00;&#x7EC4; <code>docker run</code>&#x3002;</p><p>&#x6B63;&#x662F;&#x7531;&#x4E8E;&#x4E8C;&#x4EE3; Swarm &#x4E2D;&#x7528;&#x6237;&#x64CD;&#x4F5C;&#x7684;&#x5355;&#x5143;&#x662F;&#x670D;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x4F20;&#x7EDF;&#x7684;&#x4EE5;&#x5BB9;&#x5668;&#x4E3A;&#x4E2D;&#x5FC3;&#x7684; <code>docker run</code> &#x5C31;&#x4E0D;&#x518D;&#x9002;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x6709;&#x65B0;&#x7684;&#x4E00;&#x7EC4;&#x9488;&#x5BF9;&#x670D;&#x52A1;&#x7684;&#x547D;&#x4EE4;&#xFF0C;<code>docker service</code>&#x3002;</p><h2 id="docker-service-ps-li-mian-zong-shi-you-yi-dui-shi-bai-huo-zhe-shutdown-de-li-shi-rong-qi-zen-me-shan-a"><a href="#docker-service-ps-&#x91CC;&#x9762;&#x603B;&#x662F;&#x6709;&#x4E00;&#x5806;&#x5931;&#x8D25;&#x6216;&#x8005;shutdown&#x7684;&#x5386;&#x53F2;&#x5BB9;&#x5668;&#xFF0C;&#x600E;&#x4E48;&#x5220;&#x554A;&#xFF1F;" class="headerlink" title="docker service ps &#x91CC;&#x9762;&#x603B;&#x662F;&#x6709;&#x4E00;&#x5806;&#x5931;&#x8D25;&#x6216;&#x8005;shutdown&#x7684;&#x5386;&#x53F2;&#x5BB9;&#x5668;&#xFF0C;&#x600E;&#x4E48;&#x5220;&#x554A;&#xFF1F;"></a><code>docker service ps</code> &#x91CC;&#x9762;&#x603B;&#x662F;&#x6709;&#x4E00;&#x5806;&#x5931;&#x8D25;&#x6216;&#x8005;shutdown&#x7684;&#x5386;&#x53F2;&#x5BB9;&#x5668;&#xFF0C;&#x600E;&#x4E48;&#x5220;&#x554A;&#xFF1F; <a href="#docker-service-ps-li-mian-zong-shi-you-yi-dui-shi-bai-huo-zhe-shutdown-de-li-shi-rong-qi-zen-me-shan-a" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4E8C;&#x4EE3; Swarm &#x540E;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x7EF4;&#x62A4;&#x4E86;&#x51E0;&#x6B21;&#x670D;&#x52A1;&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0; <code>docker service ps</code> &#x4E2D;&#x663E;&#x793A;&#x4E86;&#x5F88;&#x591A;&#x4E4B;&#x524D;&#x5931;&#x8D25;&#x7684;&#x5BB9;&#x5668;&#x8BB0;&#x5F55;&#xFF0C;&#x5F88;&#x662F;&#x70E6;&#x4EBA;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps web                                                                                                       [e641012]</span><br><span class="line">NAME                    IMAGE                NODE  DESIRED STATE  CURRENT STATE                ERROR                             PORTS</span><br><span class="line">web.1.uultetkovwch      nginx:1.11.3-alpine  moby  Running        Running 43 seconds ago</span><br><span class="line">\_ web.1.etb0jpr21mhe  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.1.uhyl9158ldf9  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.1.mwallx77rc3m  nginx:1.11.1-alpine  moby  Shutdown       Shutdown about a minute ago</span><br><span class="line">\_ web.1.zmyvszvv21ak  nginx:1.10-alpine    moby  Shutdown       Shutdown 3 minutes ago</span><br><span class="line">web.2.dp0imr8kbmad      nginx:1.11.3-alpine  moby  Running        Running 43 seconds ago</span><br><span class="line">\_ web.2.0xzwj9o8kfzn  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.2.mk3g1l5js4ph  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.2.v9x98vxma1q3  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.2.vo5mvyux3vok  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">web.3.cc3mrji1dlz2      nginx:1.11.3-alpine  moby  Running        Running 42 seconds ago</span><br><span class="line">\_ web.3.uvubn2pdceaa  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.3.mt7xwl4a0bii  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.3.cdseizjlnzoj  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.3.kwlz5mxbu2t6  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">web.4.zoadbqu3wtzf      nginx:1.11.3-alpine  moby  Running        Running 42 seconds ago</span><br><span class="line">\_ web.4.u6p58nzxlib9  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such container: web.4.u6p5&#x2026;&quot;</span></span><br><span class="line">\_ web.4.kf420b73lwcc  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.4.tzzmc1zuffn7  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">&quot;No such image: nginx:1.11.2-a&#x2026;&quot;</span></span><br><span class="line">\_ web.4.mccsks74u370  nginx:1.11.1-alpine  moby  Shutdown       Shutdown 2 minutes ago</span><br><span class="line">web.5.u0i5cnh0m5jb      nginx:1.11.3-alpine  moby  Running        Running 39 seconds ago</span><br><span class="line">\_ web.5.xzv6o5hoxjay  nginx:1.11.1-alpine  moby  Shutdown       Shutdown 41 seconds ago</span><br><span class="line">\_ web.5.f0ssiwebempk  nginx:1.10-alpine    moby  Shutdown       Shutdown 3 minutes ago</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x90A3;&#x4E9B;&#x5386;&#x53F2;&#x4E0A;&#x8FD0;&#x884C;&#x8FC7;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x5F53;&#x7136;&#x5DF2;&#x7ECF;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#xFF0C;&#x4FDD;&#x7559;&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x6392;&#x969C;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F1A;&#x4FDD;&#x7559;&#x6700;&#x540E; 5 &#x4E2A;&#x5BB9;&#x5668;&#x5386;&#x53F2;&#xFF0C;&#x5176;&#x4F59;&#x7684;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x5728;&#x96C6;&#x7FA4;&#x5EFA;&#x7ACB;&#x65F6;(<code>docker swarm init</code>)&#x6216;&#x8005;&#x66F4;&#x65B0;&#x65F6;(<code>docker swarm update</code>)&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53C2;&#x6570; <code>--task-history-limit</code> &#x6765;&#x8C03;&#x6574;&#x3002;</p><p>&#x4F46;&#x662F;&#x4E0D;&#x8981;&#x56E0;&#x4E3A;&#x53EA;&#x662F;&#x770B;&#x7740;&#x4E71;&#xFF0C;&#x5C31;&#x5C06;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8BBE;&#x7684;&#x5F88;&#x5C11;&#xFF0C;&#x56E0;&#x4E3A;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x7684;&#x5B58;&#x5728;&#x662F;&#x6709;&#x539F;&#x56E0;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x6765;&#x8FDB;&#x884C;&#x6392;&#x969C;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x5728;&#x5C06;&#x6765;&#x7EF4;&#x62A4;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6545;&#x969C;&#x6839;&#x672C;&#x65E0;&#x4ECE;&#x67E5;&#x8D77;&#x3002;</p><p>&#x5982;&#x679C;&#x53EA;&#x662F;&#x89C9;&#x5F97;&#x770B;&#x7740;&#x4E71;&#x800C;&#x4E0D;&#x60F3;&#x663E;&#x793A;&#xFF0C;&#x76F4;&#x63A5;&#x7528; <code>--filter</code> &#x52A0;&#x8FC7;&#x6EE4;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps -f <span class="string">&apos;desired-state=running&apos;</span> web                                                                            [e641012]</span><br><span class="line">NAME                IMAGE                NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS</span><br><span class="line">web.1.uultetkovwch  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.2.dp0imr8kbmad  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.3.cc3mrji1dlz2  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.4.zoadbqu3wtzf  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.5.u0i5cnh0m5jb  nginx:1.11.3-alpine  moby  Running        Running 10 minutes ago</span><br></pre></td></tr></table></figure><h2 id="zen-me-cai-neng-rang-docker-service-create-chuang-jian-de-fu-wu-zheng-chang-tui-chu-shi-bu-chong-qi-a"><a href="#&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9;-docker-service-create-&#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#x65F6;&#x4E0D;&#x91CD;&#x542F;&#x554A;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; docker service create &#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#x65F6;&#x4E0D;&#x91CD;&#x542F;&#x554A;&#xFF1F;"></a>&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; <code>docker service create</code> &#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#x65F6;&#x4E0D;&#x91CD;&#x542F;&#x554A;&#xFF1F; <a href="#zen-me-cai-neng-rang-docker-service-create-chuang-jian-de-fu-wu-zheng-chang-tui-chu-shi-bu-chong-qi-a" class="header-anchor">#</a></h2><p>&#x6709;&#x4E9B;&#x65F6;&#x5019;&#x4F1A;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x6BD4;&#x5982;&#x670D;&#x52A1;&#x662F;&#x7531;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x8FDC;&#x7A0B;&#x63A7;&#x5236;&#x6307;&#x4EE4;&#x5173;&#x95ED;&#x7684;&#xFF0C;&#x8FD9;&#x79CD;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x662F;&#x6B63;&#x5E38;&#x884C;&#x4E3A;&#xFF0C;&#x5E76;&#x975E;&#x9519;&#x8BEF;&#x3002;&#x4F46;&#x662F;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EA;&#x8981;&#x5BB9;&#x5668;&#x9000;&#x51FA;&#xFF0C;&#x5F15;&#x64CE;&#x5C31;&#x89C6;&#x4E3A;&#x5F02;&#x5E38;&#xFF0C;&#x5C31;&#x4F1A;&#x5C1D;&#x8BD5;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x660E;&#x660E;&#x5173;&#x4E86;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x53C8;&#x88AB;&#x542F;&#x52A8;&#x4E86;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--restart-condition=on-failure</code> &#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x53EA;&#x6709;&#x5728;&#x4E3B;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x7801;&#x4E3A; <strong>&#x975E; 0</strong> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624D;&#x4F1A;&#x91CD;&#x542F;&#xFF0C;&#x800C;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#xFF08;<code>exited code = 0</code>) &#x65E0;&#x9700;&#x91CD;&#x542F;&#x3002;</p><h1 id="docker-machine-xiang-guan-wen-ti-5"><a href="#Docker-Machine-&#x76F8;&#x5173;&#x95EE;&#x9898;-5" class="headerlink" title="Docker Machine &#x76F8;&#x5173;&#x95EE;&#x9898; (5)"></a>Docker Machine &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(5)</code> <a href="#docker-machine-xiang-guan-wen-ti-5" class="header-anchor">#</a></h1><h2 id="da-kai-ming-ling-xing-hou-kan-dao-xia-zai-sha-boot2docker-iso-ran-hou-zong-shi-chao-shi-shi-bai-zen-me-ban"><a href="#&#x6253;&#x5F00;&#x547D;&#x4EE4;&#x884C;&#x540E;&#xFF0C;&#x770B;&#x5230;&#x4E0B;&#x8F7D;&#x5565;-boot2docker-iso&#xFF0C;&#x7136;&#x540E;&#x603B;&#x662F;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x6253;&#x5F00;&#x547D;&#x4EE4;&#x884C;&#x540E;&#xFF0C;&#x770B;&#x5230;&#x4E0B;&#x8F7D;&#x5565; boot2docker.iso&#xFF0C;&#x7136;&#x540E;&#x603B;&#x662F;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x6253;&#x5F00;&#x547D;&#x4EE4;&#x884C;&#x540E;&#xFF0C;&#x770B;&#x5230;&#x4E0B;&#x8F7D;&#x5565; <code>boot2docker.iso</code>&#xFF0C;&#x7136;&#x540E;&#x603B;&#x662F;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#da-kai-ming-ling-xing-hou-kan-dao-xia-zai-sha-boot2docker-iso-ran-hou-zong-shi-chao-shi-shi-bai-zen-me-ban" class="header-anchor">#</a></h2><p>&#x88C5;&#x4E86; Docker Toolbox &#x7684; Windows &#x7528;&#x6237;&#xFF0C;&#x6216;&#x8005;&#x7B2C;&#x4E00;&#x6B21;&#x4F7F;&#x7528; <code>docker-machine</code> &#x521B;&#x5EFA;&#x672C;&#x5730; VirtualBox &#x865A;&#x62DF;&#x673A;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x62A5;&#x9519;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(default) Latest release <span class="keyword">for</span> github.com/boot2docker/boot2docker is v17.06.2-ce</span><br><span class="line">(default) Downloading /Users/jessie/.docker/machine/cache/boot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v17.06.2-ce/boot2docker.iso...</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x7ECF;&#x8FC7;&#x6F2B;&#x957F;&#x7684;&#x7B49;&#x5F85;&#x540E;&#xFF0C;&#x8BF4;&#x8D85;&#x65F6;&#x3001;&#x6216;&#x8005;&#x4E0B;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x6700;&#x540E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x5931;&#x8D25;&#x3002;</p><p>&#x8FD9;&#x9996;&#x5148;&#x8FD8;&#x662F;&#x5148;&#x53BB;<em>&#x611F;&#x8C22;</em>&#x4F1F;&#x5927;&#x7684;&#x5899;&#x53CA;&#x5176;&#x4EB2;&#x5C5E;&#xFF0C;&#x6CA1;&#x6709;&#x4ED6;&#x4EEC;&#x7684;&#x4F5C;&#x795F;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x57FA;&#x672C;&#x51FA;&#x73B0;&#x4E0D;&#x4E86;&#x3002;</p><p>&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x6240;&#x8BF4;&#x7684; Docker &#x662F;&#x57FA;&#x4E8E; Linux &#x5185;&#x6838;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5728; Windows &#x73AF;&#x5883;&#x4E2D;&#xFF0C;Docker Toolbox &#x4F1A;&#x4F7F;&#x7528; Docker Machine &#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>default</code> &#x7684; VirtualBox Linux &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6765;&#x8FDB;&#x884C; Docker &#x64CD;&#x4F5C;&#x3002;&#x7531;&#x4E8E;&#x53EA;&#x9700;&#x8981;&#x8FD0;&#x884C; Docker&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A; Linux &#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x7CBE;&#x7B80;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x590D;&#x6742;&#x7684;&#x7CFB;&#x7EDF;&#x529F;&#x80FD;&#x3002;&#x7531;&#x4E8E;&#x5386;&#x53F2;&#x539F;&#x56E0;&#xFF0C;&#x8FD9;&#x4E2A;&#x5FAE;&#x7F29;&#x7248;&#x7684; Linux &#x7CFB;&#x7EDF;&#x662F;&#x88AB;&#x79F0;&#x4E3A; <code>boot2docker</code> &#x7684;&#x7CFB;&#x7EDF;&#x3002;</p><p>&#x800C; Docker Machine &#x5728;&#x5EFA;&#x7ACB;&#x865A;&#x62DF;&#x673A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x4ECE;<a href="https://github.com/boot2docker/boot2docker/releases" target="_blank" rel="noopener">&#x7F51;&#x4E0A;</a>&#x68C0;&#x67E5; Docker &#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4E2D;&#x7684; ISO &#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x6216;&#x8005;&#x4E0D;&#x662F;&#x6700;&#x65B0;&#x7248;&#x672C;&#xFF0C;&#x90A3;&#x5C31;&#x4F1A;&#x53BB;&#x4ECE;&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684; ISO &#x6587;&#x4EF6;&#x3002;&#x800C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5C31;&#x662F;&#x63D0;&#x793A;&#x4E2D;&#x6240;&#x8BF4;&#x7684; <code>boot2docker.iso</code> &#x6587;&#x4EF6;&#x3002;&#x7531;&#x4E8E;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x7ECF;&#x5E38;&#x505A;&#x51FA;&#x5237;&#x51FA;&#x955C;&#x7387;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4ECE; GitHub &#x4E0A;&#x4E0B;&#x8F7D;&#x4E1C;&#x897F;&#x7ECF;&#x5E38;&#x4F1A;&#x88AB;&#x5E72;&#x6270;&#x548C;&#x963B;&#x65AD;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x5565;&#x7ECF;&#x5E38;&#x51FA;&#x73B0;&#x8D85;&#x65F6;&#x3001;&#x6216;&#x8005;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x4E0B;&#x4E0D;&#x884C;&#xFF0C;&#x90A3;&#x5C31;&#x624B;&#x5DE5;&#x7FFB;&#x5899;&#x4E0B;&#x2026;&#x2026;&#x1F639;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x8FD8;&#x6709;&#x53E6;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x8FC5;&#x96F7;&#x4E0B;&#x8F7D;&#x3002;&#x8FC5;&#x96F7;&#x62E5;&#x6709;<em>&#x7EC6;&#x601D;&#x6781;&#x6050;</em>&#x7684;&#x4E0B;&#x8F7D;&#x7F13;&#x5B58;&#xFF0C;&#x57FA;&#x672C;&#x7528;&#x8FC5;&#x96F7;&#x4E0B;&#x8F7D;&#x8FC7;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x8FC5;&#x96F7;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x90FD;&#x4F1A;&#x7F13;&#x5B58;&#x4E00;&#x4EFD;&#x1F628;&#x2026;&#x2026;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7528;&#x8FC5;&#x96F7;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E2A; <code>boot2docker.iso</code> &#x7684;&#x8BDD;&#xFF0C;&#x5F88;&#x5927;&#x7684;&#x51E0;&#x7387;&#x8FC5;&#x96F7;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E00;&#x4EFD;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x5B58;&#x5728;&#xFF0C;&#x8FC5;&#x96F7;&#x4F1A;&#x76F4;&#x63A5;&#x4ECE;&#x5B83;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5E2E;&#x4F60;&#x628A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x4E0B;&#x6765;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x7FFB;&#x5899;&#x4E86;&#x3002;</p><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x62A5;&#x9519;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5F97;&#x77E5;&#xFF0C;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x94FE;&#x63A5;&#x4E3A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/boot2docker/boot2docker/releases/download/v17.06.2-ce/boot2docker.iso</span><br></pre></td></tr></table></figure><p>&#x5C06;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#x6DFB;&#x52A0;&#x5230;&#x4F60;&#x7684;&#x8FC5;&#x96F7;&#x4E0B;&#x8F7D;&#x4EFB;&#x52A1;&#x4E2D;&#x53BB;&#xFF0C;<strong>&#x6CE8;&#x610F;&#xFF1A;&#x6362;&#x6210;&#x4F60;&#x7684;&#x62A5;&#x9519;&#x4E2D;&#x7684;&#x94FE;&#x63A5;&#xFF01;&#xFF01;</strong>&#x3002;</p><p>&#x4E0B;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x786E;&#x4FDD;&#x6587;&#x4EF6;&#x540D;&#x4E3A; <code>boot2docker.iso</code>&#xFF0C;&#x7136;&#x540E;&#x7528; <code>shasum -a 256 boot2docker.iso</code> &#x6821;&#x9A8C;&#x4E00;&#x4E0B;&#x6587;&#x4EF6;&#x7684;&#x5B8C;&#x6574;&#x6027;&#xFF0C;&#x786E;&#x4FDD;&#x548C;<a href="https://github.com/boot2docker/boot2docker/releases" target="_blank" rel="noopener">&#x5B98;&#x7F51;</a><strong>&#x5BF9;&#x5E94;&#x7684;&#x7248;&#x672C;</strong>&#x4E00;&#x6837;&#x540E;&#xFF0C;&#x518D;&#x653E;&#x7F6E;&#x5230;&#x62A5;&#x9519;&#x4E2D;&#x7684;&#x90A3;&#x4E2A;&#x4F4D;&#x7F6E;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/jessie/.docker/machine/cache/boot2docker.iso</span><br></pre></td></tr></table></figure><p><strong>&#x6CE8;&#x610F;&#xFF1A;&#x6362;&#x6210;&#x4F60;&#x7684;&#x62A5;&#x9519;&#x4E2D;&#x7684;&#x90A3;&#x4E2A;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;&#xFF01;&#xFF01;</strong></p><p>&#x624B;&#x5DE5;&#x4E0B;&#x8F7D;&#x597D;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x8FD0;&#x884C; Docker Quickstart Terminal&#xFF0C;&#x6216;&#x8005;&#x91CD;&#x65B0;&#x4F7F;&#x7528; <code>docker-machine</code> &#x521B;&#x5EFA; Virtualbox &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x4E00;&#x5207;&#x5C31;&#x5E94;&#x8BE5;&#x6B63;&#x5E38;&#x4E86;&#x3002;</p><h2 id="zhuang-wan-docker-toolbox-hou-fa-xian-xia-zai-jing-xiang-su-du-tai-man-shi-bu-shi-xu-yao-xiu-gai-shi-me-pei-zhi-wen-jian"><a href="#&#x88C5;&#x5B8C;-Docker-Toolbox-&#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F;" class="headerlink" title="&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F;"></a>&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F; <a href="#zhuang-wan-docker-toolbox-hou-fa-xian-xia-zai-jing-xiang-su-du-tai-man-shi-bu-shi-xu-yao-xiu-gai-shi-me-pei-zhi-wen-jian" class="header-anchor">#</a></h2><p>&#x5B89;&#x88C5; Docker Toolbox &#x65F6;&#xFF0C;&#x5B89;&#x88C5;&#x7A0B;&#x5E8F;&#x4F1A;&#x4F7F;&#x7528; <code>docker-machine</code> &#x4E3A;&#x4F60;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>default</code> &#x7684;&#x865A;&#x62DF;&#x673A;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d virtualbox default</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x6CA1;&#x6709;&#x52A0;&#x4EFB;&#x4F55;&#x53C2;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x62E5;&#x6709;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x7684;&#x56FD;&#x5185;&#x7F51;&#x7EDC;&#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x4E9B;&#x4E0D;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x7B80;&#x5355;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5728;&#x5B89;&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#xFF0C;&#x5220;&#x6389;&#x9ED8;&#x8BA4;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x8BE5;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x521B;&#x5EFA;&#x65F6;&#x52A0;&#x5165;&#x6709;&#x4E2D;&#x56FD;&#x7279;&#x8272;&#x7684;&#x914D;&#x7F6E;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker-machine rm default</span><br><span class="line"></span><br><span class="line">docker-machine create -d virtualbox \</span><br><span class="line">     --engine-registry-mirror https://registry.docker-cn.com \</span><br><span class="line">     --engine-insecure-registry 192.168.99.0/24 \</span><br><span class="line">     --engine-storage-driver overlay2 \</span><br><span class="line">     default</span><br></pre></td></tr></table></figure><blockquote><p>&#x5220;&#x9664; <code>default</code> &#x865A;&#x62DF;&#x673A;&#x7684;&#x65F6;&#x5019;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5176;&#x4E2D;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7B49;&#x5185;&#x5BB9;&#x90FD;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</p></blockquote><h2 id="ru-he-zai-docker-toolbox-zhong-chuang-jian-de-default-xu-ni-ji-zhong-tian-jia-docker-opts-zhi-lei-de-pei-zhi"><a href="#&#x5982;&#x4F55;&#x5728;-Docker-Toolbox-&#x4E2D;&#x521B;&#x5EFA;&#x7684;-default-&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;DOCKER-OPTS&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5728; Docker Toolbox &#x4E2D;&#x521B;&#x5EFA;&#x7684; default &#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;DOCKER_OPTS&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F;"></a>&#x5982;&#x4F55;&#x5728; Docker Toolbox &#x4E2D;&#x521B;&#x5EFA;&#x7684; <code>default</code> &#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;<code>DOCKER_OPTS</code>&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F; <a href="#ru-he-zai-docker-toolbox-zhong-chuang-jian-de-default-xu-ni-ji-zhong-tian-jia-docker-opts-zhi-lei-de-pei-zhi" class="header-anchor">#</a></h2><p>&#x5176;&#x5B9E;&#x5728;&#x6700;&#x521D;&#x521B;&#x5EFA;&#x8BE5;docker host&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528; <code>docker-machine</code> &#x6307;&#x5B9A;&#x5F15;&#x64CE;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8981;&#x7D27;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;rm&#x6389;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x91CD;&#x65B0;&#x5EFA;&#x7ACB;&#x3002;</p><p>&#x5982;&#x679C;&#x4E0D;&#x65B9;&#x4FBF; rm &#x6389;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x53EF;&#x4EE5; <code>docker-machine ssh</code> &#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x4FEE;&#x6539; <code>/var/lib/boot2docker/profile</code> &#x6587;&#x4EF6;&#xFF0C;&#x4FEE;&#x6539;&#x91CC;&#x9762;&#x7684; <code>EXTRA_ARGS</code> &#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002;</p><h2 id="docker-machine-chuang-jian-de-zhu-ji-zen-me-zhi-jie-ssh-jin-qu-gai-liao-root-mi-ma-hao-xiang-ye-mei-yong"><a href="#docker-machine-&#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5;-ssh-&#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86;-root-&#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F;" class="headerlink" title="docker-machine &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5; ssh &#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86; root &#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F;"></a><code>docker-machine</code> &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5; <code>ssh</code> &#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86; <code>root</code> &#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F; <a href="#docker-machine-chuang-jian-de-zhu-ji-zen-me-zhi-jie-ssh-jin-qu-gai-liao-root-mi-ma-hao-xiang-ye-mei-yong" class="header-anchor">#</a></h2><p><code>docker-machine</code> &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x4F1A;&#x9075;&#x5FAA;&#x5B89;&#x5168;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x5141;&#x8BB8; <code>root</code> &#x767B;&#x5F55;&#xFF0C;&#x800C;&#x4E14;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x5141;&#x8BB8;&#x5BC6;&#x7801;&#x767B;&#x5F55;&#xFF0C;&#x53EA;&#x5141;&#x8BB8;<code>&#x5BC6;&#x94A5;</code>&#x767B;&#x5F55;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x5F88;&#x591A;&#x56FD;&#x5185;&#x6587;&#x7AE0;&#x79F0;&#x4E3A;&#x7684;&#x514D;&#x5BC6;&#x767B;&#x5F55;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x975E;&#x514D;&#x5BC6;&#xFF09;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x4F7F;&#x7528;&#x5BC6;&#x94A5; <code>~/.docker/machine/machines/&lt;&#x673A;&#x5668;&#x540D;&gt;/id_rsa</code> &#x767B;&#x5F55;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.docker/machine/machines/default/id_rsa \</span><br><span class="line">    -o UserKnownHostsFile=/dev/null \</span><br><span class="line">    -o StrictHostKeyChecking=no \</span><br><span class="line">    docker@$(docker-machine ip default)</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x662F; <code>default</code> &#x8FD9;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x5176;&#x5B83;&#x7684;&#x673A;&#x5668;&#x6362;&#x6210;&#x522B;&#x7684;&#x5373;&#x53EF;&#x3002;&#x53E6;&#x5916;&#x7684;&#x4E24;&#x4E2A; <code>-o</code> &#x7684;&#x53C2;&#x6570;&#x662F;&#x8BA9;&#x5176;&#x4E0D;&#x8981;&#x6821;&#x9A8C;&#x670D;&#x52A1;&#x5668;&#x5BC6;&#x94A5;&#xFF0C;&#x8FD9;&#x5F53;&#x7136;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x8BD5;&#x9A8C;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x5173;&#x7CFB;&#x3002;</p><h2 id="docker-machine-shi-yong-d-generic-shi-zhi-ding-yong-hu-generic-ssh-user-hou-fa-xian-yao-sudo-mi-ma-jie-guo-bao-cuo-tui-chu-zhe-shi-zen-me-hui-shi"><a href="#docker-machine-&#x4F7F;&#x7528;-d-generic-&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237;-generic-ssh-user-&#x540E;&#x53D1;&#x73B0;&#x8981;-sudo-&#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;" class="headerlink" title="docker-machine &#x4F7F;&#x7528; -d generic &#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237; --generic-ssh-user &#x540E;&#x53D1;&#x73B0;&#x8981; sudo &#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;"></a><code>docker-machine</code> &#x4F7F;&#x7528; <code>-d generic</code> &#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237; <code>--generic-ssh-user</code> &#x540E;&#x53D1;&#x73B0;&#x8981; <code>sudo</code> &#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F; <a href="#docker-machine-shi-yong-d-generic-shi-zhi-ding-yong-hu-generic-ssh-user-hou-fa-xian-yao-sudo-mi-ma-jie-guo-bao-cuo-tui-chu-zhe-shi-zen-me-hui-shi" class="header-anchor">#</a></h2><p>&#x4F60;&#x5E94;&#x8BE5;&#x518D;&#x4ED4;&#x7EC6;&#x770B;&#x770B; <code>generic</code> &#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/machine/drivers/generic/#/sudo-privileges" target="_blank" rel="noopener">https://docs.docker.com/machine/drivers/generic/#/sudo-privileges</a></p><p>&#x91CC;&#x9762;&#x8BF4;&#x7684;&#x5F88;&#x6E05;&#x695A;&#xFF0C;&#x9ED8;&#x8BA4;&#x7528;&#x6237;&#x662F; <code>root</code>&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x901A;&#x8FC7; <code>--generic-ssh-user</code> &#x6307;&#x5B9A;&#x5176;&#x5B83;&#x7528;&#x6237;&#x7684;&#x8BDD;&#xFF0C;&#x8BE5;&#x7528;&#x6237;&#x5FC5;&#x987B;&#x62E5;&#x6709;&#x65E0;&#x5BC6;&#x7801;<code>sudo</code>&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5728; <code>sudoers</code> &#x6587;&#x4EF6;&#x4E2D;&#x5BF9;&#x8BE5;&#x7528;&#x6237;&#x914D;&#x7F6E; <code>NOPASSWD</code>&#x3002;</p><h1 id="docker-registry-xiang-guan-wen-ti-10"><a href="#Docker-Registry-&#x76F8;&#x5173;&#x95EE;&#x9898;-10" class="headerlink" title="Docker Registry &#x76F8;&#x5173;&#x95EE;&#x9898; (10)"></a>Docker Registry &#x76F8;&#x5173;&#x95EE;&#x9898; <code>(10)</code> <a href="#docker-registry-xiang-guan-wen-ti-10" class="header-anchor">#</a></h1><h2 id="wo-docker-push-de-shi-hou-zen-me-bao-authentication-required-cuo-wu"><a href="#&#x6211;-docker-push-&#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5;-authentication-required-&#x9519;&#x8BEF;&#xFF1F;" class="headerlink" title="&#x6211; docker push &#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5; authentication required &#x9519;&#x8BEF;&#xFF1F;"></a>&#x6211; <code>docker push</code> &#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5; <code>authentication required</code> &#x9519;&#x8BEF;&#xFF1F; <a href="#wo-docker-push-de-shi-hou-zen-me-bao-authentication-required-cuo-wu" class="header-anchor">#</a></h2><p>&#x56E0;&#x4E3A;&#x4F60;&#x6CA1;&#x6709;&#x767B;&#x5F55;&#x3002;&#x5982;&#x679C;&#x662F;&#x5411; Docker Hub &#x63A8;&#x9001;&#x955C;&#x50CF;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFF1A; <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><h2 id="wei-shi-me-wo-docker-login-shi-bai-liao-wo-zhu-ce-yong-hu-liao-zai-wang-zhan-deng-lu-ye-mei-wen-ti-ya"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x6211;-docker-login-&#x5931;&#x8D25;&#x4E86;&#xFF1F;&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237;&#x4E86;&#xFF0C;&#x5728;&#x7F51;&#x7AD9;&#x767B;&#x5F55;&#x4E5F;&#x6CA1;&#x95EE;&#x9898;&#x5440;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x6211; docker login &#x5931;&#x8D25;&#x4E86;&#xFF1F;&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237;&#x4E86;&#xFF0C;&#x5728;&#x7F51;&#x7AD9;&#x767B;&#x5F55;&#x4E5F;&#x6CA1;&#x95EE;&#x9898;&#x5440;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x6211; <code>docker login</code> &#x5931;&#x8D25;&#x4E86;&#xFF1F;&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237;&#x4E86;&#xFF0C;&#x5728;&#x7F51;&#x7AD9;&#x767B;&#x5F55;&#x4E5F;&#x6CA1;&#x95EE;&#x9898;&#x5440;&#xFF1F; <a href="#wei-shi-me-wo-docker-login-shi-bai-liao-wo-zhu-ce-yong-hu-liao-zai-wang-zhan-deng-lu-ye-mei-wen-ti-ya" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="string">&apos;t have a Docker ID, </span></span><br><span class="line"><span class="string">head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username: pinkman@heisenb.org</span></span><br><span class="line"><span class="string">Password:</span></span><br><span class="line"><span class="string">Error response from daemon: Get https://registry-1.docker.io/v2/: unauthorized: incorrect username or password</span></span><br></pre></td></tr></table></figure><p>&#x5443;&#xFF0C;&#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x662F;<strong>&#x7528;&#x6237;&#x540D;</strong>&#x7684;&#xFF0C;&#x600E;&#x4E48;&#x5199;&#x4E86;&#x4E2A;<strong>&#x7535;&#x5B50;&#x90AE;&#x4EF6;</strong> <a href="mailto:`pinkman@heisenb.org" target="_blank" rel="noopener">`pinkman@heisenb.org</a><code>&#x5462;&#xFF1F;&#x867D;&#x7136; [Docker Hub &#x7F51;&#x7AD9;](https://hub.docker.com)&#x5141;&#x8BB8;&#x4F60;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x540D;&#x6216;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x767B;&#x5F55;&#xFF0C;&#x4F46;&#x662F;</code>docker login` &#x53EA;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x6362;&#x6210;&#x4F60;&#x7684;&#x7528;&#x6237;&#x540D;&#x767B;&#x5F55;&#x5C31;&#x597D;&#x4E86;&#x3002;</p><h2 id="wo-zhu-ce-yong-hu-pinkman-liao-zen-me-huan-shi-wu-fa-docker-push-mrwhite-xxx-a"><a href="#&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237;-pinkman-&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;-docker-push-mrwhite-xxx-&#x554A;&#xFF1F;" class="headerlink" title="&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237; pinkman &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5; docker push mrwhite/xxx &#x554A;&#xFF1F;"></a>&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237; <code>pinkman</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5; <code>docker push mrwhite/xxx</code> &#x554A;&#xFF1F; <a href="#wo-zhu-ce-yong-hu-pinkman-liao-zen-me-huan-shi-wu-fa-docker-push-mrwhite-xxx-a" class="header-anchor">#</a></h2><p>&#x1F612;&#x2026;&#x2026;&#x56E0;&#x4E3A;&#x4F60; <code>push</code> &#x5230;&#x522B;&#x4EBA;&#xFF08;<strong>mrwhite</strong>&#xFF09;&#x7684; <code>repo</code> &#x4E86;&#xFF0C;&#x4F60;&#x53EA;&#x80FD; <code>push</code> &#x5230; <code>pinkman/xxx</code> &#x4E0B;&#x3002;</p><h2 id="bu-guan-yong-a-wo-zhe-hui-docker-push-pinkman-xxx-liao-zen-me-gao-su-wo-jing-xiang-bu-cun-zai-a"><a href="#&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE;-docker-push-pinkman-xxx-&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x955C;&#x50CF;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE; docker push pinkman/xxx &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x955C;&#x50CF;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;"></a>&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE; <code>docker push pinkman/xxx</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x955C;&#x50CF;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F; <a href="#bu-guan-yong-a-wo-zhe-hui-docker-push-pinkman-xxx-liao-zen-me-gao-su-wo-jing-xiang-bu-cun-zai-a" class="header-anchor">#</a></h2><p>&#x1F613;&#x2026;&#x2026;&#x56E0;&#x4E3A;&#x4F60;&#x6CA1;&#x6709; <code>tag</code> &#x5BF9;&#x5E94;&#x7684;&#x955C;&#x50CF;&#x4E3A; <code>pinkman/xxx</code>&#x3002;</p><p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x90FD;&#x662F;&#x7531;&#x4E8E;&#x4F60;&#x6CA1;&#x6709;&#x53BB;&#x770B;&#x6587;&#x6863;&#xFF0C;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x8FD9;&#x4E48;&#x4E00;&#x6B21;&#x6B21;&#x7684;&#x778E;&#x649E;&#xFF0C;&#x53BB;&#x770B;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;</p><p><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">https://docs.docker.com/get-started/</a></p><h2 id="docker-push-dao-si-you-registry-zong-shi-bu-cheng-gong-zen-me-ban"><a href="#docker-push-&#x5230;&#x79C1;&#x6709;-registry-&#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="docker push &#x5230;&#x79C1;&#x6709; registry &#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a><code>docker push</code> &#x5230;&#x79C1;&#x6709; <code>registry</code> &#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#docker-push-dao-si-you-registry-zong-shi-bu-cheng-gong-zen-me-ban" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x5728;&#x62A5;&#x9519;&#x4E2D;&#x770B;&#x5230;&#x4E86; <code>https</code>&#xFF0C;&#x90A3;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A; <code>registry</code> &#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x8BC1;&#x4E66;&#x3002;</p><p>&#x5F88;&#x591A;&#x4EBA;&#x6700;&#x5F00;&#x59CB;&#x914D;&#x7F6E; <code>registry</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x800C;&#x6CA1;&#x6709;&#x914D;&#x7F6E; <code>TLS</code> &#x8BC1;&#x4E66;&#x3002;</p><p>&#x8FD9;&#x662F;<strong>&#x4E0D;&#x5B89;&#x5168;</strong>&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5728; Docker &#x4E2D;<strong>&#x4E0D;&#x63A8;&#x8350;</strong>&#x4F7F;&#x7528;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x523B;&#x610F;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x4E0D;&#x5B89;&#x5168; <code>registry</code> &#x7684;&#x590D;&#x6742;&#x5EA6;&#x3002;&#x4F7F;&#x7528;&#x8005;&#x5FC5;&#x987B;&#x5728; <code>dockerd</code> &#x914D;&#x7F6E;&#x4E2D;&#xFF0C;&#x660E;&#x786E;&#x58F0;&#x660E;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x4E0D;&#x5B89;&#x5168;&#x7684; <code>registry</code>&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x5728; <a href="http://www.ubuntu.com/download/server" target="_blank" rel="noopener">Ubuntu 16.04</a> &#x4E2D;&#xFF0C;&#x7F16;&#x8F91; <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> &#x4E2D;&#x7684; <code>ExecStart=</code> &#x7684;&#x7ED3;&#x5C3E;&#xFF0C;&#x52A0;&#x5165; <code>--insecure-registry=192.168.99.100:5000</code>&#xFF0C;&#x5C06; <code>192.168.99.100:5000</code> &#x66FF;&#x6362;&#x6210;&#x4F60;&#x7684; <code>registry</code> &#x5730;&#x5740;&#x3002;&#x5982;&#x679C;&#x6709;&#x5F88;&#x591A; <code>registry</code>&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x591A;&#x7EC4;&#x3002;&#x6216;&#x8005;&#x5982;&#x679C;&#x865A;&#x62DF;&#x673A;&#x7684; <code>IP</code> &#x603B;&#x662F;&#x53D8;&#x5316;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>CIDR</code> &#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982; <code>--insecure-registry=192.168.99.0/24</code>&#x3002;</p><p>&#x4E0D;&#x8FC7;&#x6D4B;&#x8BD5;&#x8FC7;&#x540E;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;<a href="https://docs.docker.com/registry/deploying/#/get-a-certificate" target="_blank" rel="noopener">&#x914D;&#x4E0A; TLS &#x8BC1;&#x4E66;</a>&#x3002;&#x73B0;&#x5728; <a href="https://letsencrypt.org/getting-started/" target="_blank" rel="noopener">Let&#x2019;s Encrpyt</a> &#x5DF2;&#x7ECF;&#x652F;&#x6301; <code>DNS</code> &#x8BA4;&#x8BC1;&#x4E86;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x66B4;&#x9732;&#x5185;&#x90E8;&#x7684;&#x673A;&#x5668;&#x4E8E;&#x516C;&#x7F51;&#xFF0C;&#x7528;&#x5176;<a href="https://certbot.eff.org/" target="_blank" rel="noopener">&#x811A;&#x672C;</a>&#x81EA;&#x52A8;&#x53D6;&#x5F97;&#x514D;&#x8D39;&#x8BC1;&#x4E66;&#x662F;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x3002;</p><h2 id="wo-docker-push-liao-hen-duo-jing-xiang-dao-si-you-de-registry-shang-zen-me-cai-neng-cha-kan-shang-mian-du-you-sha-huo-zhe-sou-suo"><a href="#&#x6211;-docker-push-&#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684;-registry-&#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F;" class="headerlink" title="&#x6211; docker push &#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684; registry &#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F;"></a>&#x6211; <code>docker push</code> &#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684; <code>registry</code> &#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F; <a href="#wo-docker-push-liao-hen-duo-jing-xiang-dao-si-you-de-registry-shang-zen-me-cai-neng-cha-kan-shang-mian-du-you-sha-huo-zhe-sou-suo" class="header-anchor">#</a></h2><p>&#x4E24;&#x79CD;&#x529E;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528; Registry V2 API&#x3002;&#x53EF;&#x4EE5;&#x5217;&#x51FA;&#x6240;&#x6709;&#x955C;&#x50CF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://&lt;&#x79C1;&#x6709;registry&#x5730;&#x5740;&gt;/v2/_catalog</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x79C1;&#x6709; Registry &#x5C1A;&#x652F;&#x6301; V1 API&#xFF08;<strong>&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;</strong>&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker search</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search &lt;&#x79C1;&#x6709;registry&#x5730;&#x5740;&gt;/&lt;&#x5173;&#x952E;&#x5B57;&gt;</span><br></pre></td></tr></table></figure><h2 id="docker-search-wei-shi-me-mei-you-ban-fa-zai-si-you-registry-zhong-yong"><a href="#docker-search-&#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5728;&#x79C1;&#x6709;-Registry-&#x4E2D;&#x7528;&#xFF1F;" class="headerlink" title="docker search &#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5728;&#x79C1;&#x6709; Registry &#x4E2D;&#x7528;&#xFF1F;"></a><code>docker search</code> &#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5728;&#x79C1;&#x6709; <code>Registry</code> &#x4E2D;&#x7528;&#xFF1F; <a href="#docker-search-wei-shi-me-mei-you-ban-fa-zai-si-you-registry-zhong-yong" class="header-anchor">#</a></h2><p><code>docker search</code> &#x547D;&#x4EE4;&#x6240;&#x4F7F;&#x7528;&#x7684; <code>API</code> &#x662F; <code>/search</code>&#xFF0C;&#x800C;&#x8FD9;&#x662F;&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;&#x7684; Registry <code>v1</code> &#x7684; API&#xFF0C;&#x76EE;&#x524D;&#x7684; Registry &#x90FD;&#x5DF2;&#x7ECF;&#x662F; <code>v2</code> API&#x4E86;&#xFF0C;&#x65E9;&#x5C31;&#x4E0D;&#x652F;&#x6301; <code>v1</code> API &#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x7136;&#x7528;&#x4E0D;&#x4E86;&#x3002;&#x800C; <code>v2</code> &#x7684; API &#x4E2D;&#x53EA;&#x6709;&#x5217;&#x8868; <code>/_catalogs</code> API&#xFF0C;&#x6CA1;&#x6709;&#x540C;&#x7B49;&#x7684; <code>search</code> API&#x3002;&#x6240;&#x4EE5;&#x4E8B;&#x5B9E;&#x4E0A; <code>docker search</code> &#x547D;&#x4EE4;&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;&#x4E86;&#x3002;</p><p>&#x53E6;&#x5916;&#xFF0C;<code>docker search</code> &#x529F;&#x80FD;&#x592A;&#x8FC7;&#x5C40;&#x9650;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x5B9E;&#x7528;&#x3002;&#x8FDC;&#x4E0D;&#x5982;&#x76F4;&#x63A5;&#x53BB; <a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">Docker Hub &#x7F51;&#x7AD9;</a> &#x641C;&#x7D22;&#x3002;Docker Hub &#x7F51;&#x7AD9;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x641C;&#x7D22;&#x67E5;&#x627E;&#x955C;&#x50CF;&#xFF0C;&#x627E;&#x5230;&#x540E;&#x8FD8;&#x53EF;&#x4EE5;&#x770B;&#x5BF9;&#x5E94;&#x7684;<strong>&#x6807;&#x7B7E;</strong>&#x3001;&#x955C;&#x50CF;<strong>&#x4F7F;&#x7528;&#x6587;&#x6863;</strong>&#x3001;&#x6BCF;&#x4E2A;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code>&#x3001;<strong>&#x5B89;&#x5168;&#x626B;&#x63CF;&#x7ED3;&#x679C;</strong>&#x7B49;&#x7B49;&#x3002;</p><p>&#x5982;&#x679C;&#x53EA;&#x4F7F;&#x7528;&#x5F00;&#x6E90;&#x7684; <code>docker registry</code> &#x81EA;&#x5EFA;&#x4ED3;&#x5E93;&#x7684;&#x8BDD;&#xFF0C;&#x76EE;&#x524D;&#x53EA;&#x80FD;&#x7528; <code>API</code> &#x8BBF;&#x95EE;&#x5176;&#x5185;&#x5BB9;&#x3002;&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;&#x5B98;&#x65B9;&#x8FD8;&#x6709;&#x5546;&#x4E1A;&#x7248;&#x7684; <code>Docker Trusted Registry</code> &#x9879;&#x76EE;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E9B;&#x589E;&#x503C;&#x7684;&#x5185;&#x5BB9;&#x5728;&#x91CC;&#x9762;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E; Docker Hub &#x4F3C;&#x5F97; UI &#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x641C;&#x7D22;&#x8FC7;&#x6EE4;&#x3002;&#x76EE;&#x524D; Docker Trusted Registry &#x5C5E;&#x4E8E; <a href="https://www.docker.com/products/docker-datacenter" target="_blank" rel="noopener">Docker Datacenter</a> &#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p><p>&#x53E6;&#x5916;&#xFF0C;&#x7B2C;&#x4E09;&#x65B9;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x63D0;&#x4F9B;&#x4E86;UI&#x7684;&#x3002;&#x6BD4;&#x5982; <a href="https://github.com/vmware/harbor" target="_blank" rel="noopener">VMWare Harbor</a>&#x3002;VMWare Harbor &#x662F; VMWare &#x4E2D;&#x56FD;&#x57FA;&#x4E8E;&#x5F00;&#x6E90; docker registry &#x8FDB;&#x4E00;&#x6B65;&#x5F00;&#x53D1;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6709;&#x66F4;&#x590D;&#x6742;&#x7684;&#x4E0A;&#x5C42;&#x903B;&#x8F91;&#x3002;&#x5305;&#x62EC;&#x7528;&#x6237;&#x7BA1;&#x7406;&#x3001;&#x955C;&#x50CF;&#x7BA1;&#x7406;&#x3001;Registry&#x96C6;&#x7FA4;&#x4E4B;&#x7C7B;&#x7684;&#x529F;&#x80FD;&#x3002;Harbor &#x662F;&#x5F00;&#x6E90;&#x7684;&#xFF0C;&#x514D;&#x8D39;&#x7684;&#x3002;</p><p>&#x7B2C;&#x4E09;&#x65B9;&#x7684; registry &#x8FD8;&#x6709; Java &#x4E16;&#x754C;&#x91CC;&#x5E38;&#x89C1;&#x7684; Nexus&#xFF0C;&#x5176;<a href="https://github.com/sonatype/docker-nexus3" target="_blank" rel="noopener">&#x7B2C;&#x4E09;&#x4EE3;</a>&#x652F;&#x6301; Docker Registry API&#x3002;</p><h2 id="ru-he-shan-chu-si-you-registry-zhong-de-jing-xiang"><a href="#&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709;-registry-&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709; registry &#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F;"></a>&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709; <code>registry</code> &#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F; <a href="#ru-he-shan-chu-si-you-registry-zhong-de-jing-xiang" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;docker registry &#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x5220;&#x9664;&#x955C;&#x50CF;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x914D;&#x7F6E;<code>config.yml</code>&#x4E2D;&#x542F;&#x7528;&#xFF1A;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">delete:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#xFF0C;&#x4F7F;&#x7528; API <code>GET /v2/&lt;&#x955C;&#x50CF;&#x540D;&gt;/manifests/&lt;tag&gt;</code> &#x6765;&#x53D6;&#x5F97;&#x8981;&#x5220;&#x9664;&#x7684;<code>&#x955C;&#x50CF;:Tag</code>&#x6240;&#x5BF9;&#x5E94;&#x7684; <code>digest</code>&#x3002;</p><p>Registry <code>2.3</code> &#x4EE5;&#x540E;&#xFF0C;&#x5FC5;&#x987B;&#x52A0;&#x5165;&#x5934; <code>Accept: application/vnd.docker.distribution.manifest.v2+json</code>&#xFF0C;&#x5426;&#x5219;&#x53D6;&#x5230;&#x7684; <code>digest</code> &#x662F;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x8BEF;&#x5220;&#x9664;&#x3002;</p><p>&#x6BD4;&#x5982;&#xFF0C;&#x8981;&#x5220;&#x9664; <code>myimage:latest</code> &#x955C;&#x50CF;&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x5F97; <code>digest</code> &#x7684;&#x547D;&#x4EE4;&#x662F;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl --header <span class="string">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span> \</span><br><span class="line">  -I -X HEAD http://192.168.99.100:5000/v2/myimage/manifests/latest \</span><br><span class="line">  | grep Digest</span><br><span class="line">Docker-Content-Digest: sha256:3a07b4e06c73b2e3924008270c7f3c3c6e3f70d4dbb814ad8bff2697123ca33c</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x8C03;&#x7528; API <code>DELETE /v2/&lt;&#x955C;&#x50CF;&#x540D;&gt;/manifests/&lt;digest&gt;</code> &#x6765;&#x5220;&#x9664;&#x955C;&#x50CF;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl  -X DELETE http://192.168.99.100:5000/v2/myimage/manifests/sha256:3a07b4e06c73b2e3924008270c7f3c3c6e3f70d4dbb814ad8bff2697123ca33c</span><br></pre></td></tr></table></figure><p>&#x81F3;&#x6B64;&#xFF0C;&#x955C;&#x50CF;&#x5DF2;&#x4ECE; <code>registry</code> &#x4E2D;&#x6807;&#x8BB0;&#x5220;&#x9664;&#xFF0C;&#x5916;&#x754C;&#x8BBF;&#x95EE; <code>pull</code> &#x4E0D;&#x5230;&#x4E86;&#x3002;&#x4F46;&#x662F; <code>registry</code> &#x7684;&#x672C;&#x5730;&#x7A7A;&#x95F4;&#x5E76;&#x672A;&#x91CA;&#x653E;&#xFF0C;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x5783;&#x573E;&#x6536;&#x96C6;&#x624D;&#x4F1A;&#x91CA;&#x653E;&#x3002;&#x800C;&#x5783;&#x573E;&#x6536;&#x96C6;&#x4E0D;&#x53EF;&#x4EE5;&#x5728;&#x7EBF;&#x8FDB;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x505C;&#x6B62; <code>registry</code>&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5047;&#x8BBE; <code>registry</code> &#x662F;&#x7528; Compose &#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x7528;&#x6765;&#x5783;&#x573E;&#x6536;&#x96C6;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose stop</span><br><span class="line">docker run -it --name gc --rm --volumes-from registry_registry_1 registry:2 garbage-collect /etc/registry/config.yml</span><br><span class="line">docker-compose start</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D; <code>registry_registry_1</code> &#x53EF;&#x4EE5;&#x66FF;&#x6362;&#x4E3A;&#x5B9E;&#x9645;&#x7684; <code>registry</code> &#x7684;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x800C; <code>/etc/registry/config.yml</code> &#x5219;&#x66FF;&#x6362;&#x4E3A;&#x5B9E;&#x9645;&#x7684; <code>registry</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002;</p><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;</p><p><a href="https://docs.docker.com/registry/configuration/#/delete" target="_blank" rel="noopener">https://docs.docker.com/registry/configuration/#/delete</a></p><p><a href="https://docs.docker.com/registry/spec/api/#/deleting-an-image" target="_blank" rel="noopener">https://docs.docker.com/registry/spec/api/#/deleting-an-image</a></p><h2 id="shi-yong-guo-nei-jing-xiang-huan-shi-man-gong-si-nei-hao-duo-docker-zhu-ji-du-xu-yao-qu-chong-fu-xia-zai-jing-xiang-zha-ban"><a href="#&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A;-docker-&#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F;" class="headerlink" title="&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A; docker &#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F;"></a>&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A; docker &#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F; <a href="#shi-yong-guo-nei-jing-xiang-huan-shi-man-gong-si-nei-hao-duo-docker-zhu-ji-du-xu-yao-qu-chong-fu-xia-zai-jing-xiang-zha-ban" class="header-anchor">#</a></h2><p>&#x5728;&#x5C40;&#x57DF;&#x7F51;&#x5185;&#xFF0C;&#x672C;&#x5730;&#x67B6;&#x8BBE;&#x4E2A; Docker Registry mirror&#xFF0C;&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x5373;&#x53EF;&#x3002;</p><p>&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7A7A;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0; Registry &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>config.yml</code>&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">0.1</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">    <span class="attr">fields:</span></span><br><span class="line">        <span class="attr">service:</span> <span class="string">registry</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">    <span class="attr">cache:</span></span><br><span class="line">        <span class="attr">blobdescriptor:</span> <span class="string">inmemory</span></span><br><span class="line">    <span class="attr">filesystem:</span></span><br><span class="line">        <span class="attr">rootdirectory:</span> <span class="string">/var/lib/registry</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="string">:5000</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">X-Content-Type-Options:</span> <span class="string">[nosniff]</span></span><br><span class="line"><span class="attr">health:</span></span><br><span class="line">    <span class="attr">storagedriver:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">threshold:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">proxy:</span></span><br><span class="line">    <span class="attr">remoteurl:</span> <span class="string">https://registry.docker-cn.com</span></span><br></pre></td></tr></table></figure><blockquote><p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>remoteurl</code>&#xFF0C;&#x5176;&#x5730;&#x5740;&#x53EF;&#x4EE5;&#x586B;&#x5199;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x52A0;&#x901F;&#x5668;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F; Docker &#x5B98;&#x65B9;&#x5728;&#x4E2D;&#x56FD;&#x7684;&#x955C;&#x50CF;&#x7AD9;&#x70B9;&#x3002;&#x5982;&#x679C;&#x5728;&#x56FD;&#x5916;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Docker Hub &#x7684;&#x5B98;&#x65B9;&#x5730;&#x5740;&#xFF1A;<code>https://registry-1.docker.io</code>&#x3002;</p></blockquote><p>&#x7136;&#x540E;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E2A; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x65B9;&#x4FBF;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#xFF1A;</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&apos;2&apos;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">mirror:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry:2</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">./config.yml:/etc/docker/registry/config.yml</span></span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x7528; Docker Compose &#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x670D;&#x52A1;&#xFF1A;<code>docker-compose up -d</code></p><p>&#x7136;&#x540E;&#x5728;&#x5C40;&#x57DF;&#x7F51;&#x4E2D;&#x7684;&#x6240;&#x6709; Docker &#x4E3B;&#x673A;&#x4E2D;&#x7684; Docker &#x5F15;&#x64CE;&#x914D;&#x7F6E;&#x4E2D;&#xFF0C;&#x90FD;&#x6DFB;&#x52A0;&#x4E00;&#x6761; <code>--registry-mirror=&lt;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&gt;</code></p><p>&#x9996;&#x5148;&#x7528; <code>docker pull</code> &#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x770B;&#x4E00;&#x4E0B;&#x65F6;&#x95F4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ time docker pull php:7-fpm-alpine</span><br><span class="line">7-fpm-alpine: Pulling from library/php</span><br><span class="line">e110a4a17941: Pull complete</span><br><span class="line">d9f63633faf6: Pull complete</span><br><span class="line">ac309a5bc5d5: Pull complete</span><br><span class="line">4523ec888a62: Pull complete</span><br><span class="line">6a77f79ab9b5: Pull complete</span><br><span class="line">27243562b67c: Pull complete</span><br><span class="line">33e1803456c2: Pull complete</span><br><span class="line">a1219b0a1418: Pull complete</span><br><span class="line">Digest: sha256:f7d6f6844df64f8f615fa50ca28b3f1ad82be0a2dcde0b55205d31c1bb9f4820</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> php:7-fpm-alpine</span><br><span class="line">docker pull php:7-fpm-alpine  0.07s user 0.07s system 0% cpu 2:30.43 total</span><br></pre></td></tr></table></figure><p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x4E86; php:7-fpm-alpine&#xFF0C;&#x7528;&#x65F6; 2 &#x5206; 30&#x79D2;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5220;&#x6389;&#x955C;&#x50CF;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker rmi php:7-fpm-alpine</span><br><span class="line">Untagged: php:7-fpm-alpine</span><br><span class="line">Deleted: sha256:b80ca1f4f99d13e00ac6ef13aca7c1ef6e2fb83ec2fe6a035e8beeeb05afb4b6</span><br><span class="line">Deleted: sha256:69ee0f31988504dc3e3b068476f11d06b43fc34465a1c58d351406b9d2368e7a</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x6D4B;&#x8BD5;&#x65F6;&#x95F4;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ time docker pull php:7-fpm-alpine</span><br><span class="line">7-fpm-alpine: Pulling from library/php</span><br><span class="line">e110a4a17941: Pull complete</span><br><span class="line">d9f63633faf6: Pull complete</span><br><span class="line">ac309a5bc5d5: Pull complete</span><br><span class="line">4523ec888a62: Pull complete</span><br><span class="line">6a77f79ab9b5: Pull complete</span><br><span class="line">27243562b67c: Pull complete</span><br><span class="line">33e1803456c2: Pull complete</span><br><span class="line">a1219b0a1418: Pull complete</span><br><span class="line">Digest: sha256:f7d6f6844df64f8f615fa50ca28b3f1ad82be0a2dcde0b55205d31c1bb9f4820</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> php:7-fpm-alpine</span><br><span class="line">docker pull php:7-fpm-alpine  0.05s user 0.04s system 0% cpu 13.778 total</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x7531;&#x4E8E;&#x8BE5; docker image &#x672C;&#x5730; mirror &#x7F13;&#x5B58;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x7528;&#x65F6;&#x7EA6;14&#x79D2;&#xFF0C;&#x901F;&#x5EA6;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x3002;</p><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;</p><p>&#x670D;&#x52A1;&#x7AEF;&#xFF1A;<a href="https://docs.docker.com/registry/configuration/#/proxy" target="_blank" rel="noopener">https://docs.docker.com/registry/configuration/#/proxy</a></p><p>&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/</a></p><h2 id="zi-ji-jia-de-registry-zen-me-ren-he-yong-hu-du-ke-yi-qu-dao-jing-xiang-zhe-bu-an-quan-a"><a href="#&#x81EA;&#x5DF1;&#x67B6;&#x7684;-registry-&#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F;" class="headerlink" title="&#x81EA;&#x5DF1;&#x67B6;&#x7684; registry &#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F;"></a>&#x81EA;&#x5DF1;&#x67B6;&#x7684; <code>registry</code> &#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F; <a href="#zi-ji-jia-de-registry-zen-me-ren-he-yong-hu-du-ke-yi-qu-dao-jing-xiang-zhe-bu-an-quan-a" class="header-anchor">#</a></h2><p>&#x90A3;&#x662F;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x52A0;&#x8BA4;&#x8BC1;&#xFF0C;&#x4E0D;&#x52A0;&#x8BA4;&#x8BC1;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5141;&#x8BB8;&#x4EFB;&#x4F55;&#x4EBA;&#x8BBF;&#x95EE;&#x7684;&#x3002;</p><p>&#x6DFB;&#x52A0;&#x8BA4;&#x8BC1;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;</p><ul><li>Registry &#x914D;&#x7F6E;&#x4E2D;&#x52A0;&#x5165;&#x8BA4;&#x8BC1;&#xFF1A; <a href="https://docs.docker.com/registry/configuration/#/auth" target="_blank" rel="noopener">https://docs.docker.com/registry/configuration/#/auth</a></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">auth:</span></span><br><span class="line">  <span class="attr">token:</span></span><br><span class="line">    <span class="attr">realm:</span> <span class="string">token-realm</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">token-service</span></span><br><span class="line">    <span class="attr">issuer:</span> <span class="string">registry-token-issuer</span></span><br><span class="line">    <span class="attr">rootcertbundle:</span> <span class="string">/root/certs/bundle</span></span><br><span class="line">  <span class="attr">htpasswd:</span></span><br><span class="line">    <span class="attr">realm:</span> <span class="string">basic-realm</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/path/to/htpasswd</span></span><br></pre></td></tr></table></figure><ul><li>&#x524D;&#x7AEF;&#x67B6;&#x8BBE; nginx &#x8FDB;&#x884C;&#x8BA4;&#x8BC1;&#xFF1A;<a href="https://docs.docker.com/registry/recipes/nginx/" target="_blank" rel="noopener">https://docs.docker.com/registry/recipes/nginx/</a></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /v2/ {</span><br><span class="line">    ...</span><br><span class="line">    auth_basic <span class="string">&quot;Registry realm&quot;</span>;</span><br><span class="line">    auth_basic_user_file /etc/nginx/conf.d/nginx.htpasswd;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h1 id="xi-tong-xiang-guan-wen-ti-7"><a href="#&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x95EE;&#x9898;-7" class="headerlink" title="&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x95EE;&#x9898; (7)"></a>&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x95EE;&#x9898; <code>(7)</code> <a href="#xi-tong-xiang-guan-wen-ti-7" class="header-anchor">#</a></h1><h2 id="centos-rhel-hong-mao-xi-tong-te-you-wen-ti"><a href="#CentOS-RHEL-&#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898;" class="headerlink" title="CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898;"></a>CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898; <a href="#centos-rhel-hong-mao-xi-tong-te-you-wen-ti" class="header-anchor">#</a></h2><h3 id="zai-centos-6-shang-an-zhuang-hou-zen-me-zui-gao-zhi-you-docker-1-7-zhe-ge-ban-ben"><a href="#&#x5728;-CentOS-6-&#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709;-Docker-1-7-&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F;" class="headerlink" title="&#x5728; CentOS 6 &#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709; Docker 1.7 &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F;"></a>&#x5728; CentOS 6 &#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709; Docker 1.7 &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F; <a href="#zai-centos-6-shang-an-zhuang-hou-zen-me-zui-gao-zhi-you-docker-1-7-zhe-ge-ban-ben" class="header-anchor">#</a></h3><p>Docker &#x5DF2;&#x7ECF;&#x4E0D;&#x518D;&#x652F;&#x6301; CentOS 6 &#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x5230;&#x7684;&#x662F;&#x5F88;&#x4E45;&#x4EE5;&#x524D;&#x7684;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x4E4B;&#x540E;&#x518D;&#x4E5F;&#x6CA1;&#x6709;&#x53D1;&#x5E03;&#x8FC7; CentOS 6 &#x7684;&#x7248;&#x672C;&#x3002;</p><p>&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x518D;&#x5728; CentOS 6&#x4E0A;&#x7528; Docker &#x4E86;&#x3002;&#x6362; CentOS 7 &#x6216;&#x8005; Ubuntu &#x5427;&#x3002;</p><h3 id="gua-zai-su-zhu-mu-lu-jie-guo-permission-denied-mei-quan-xian"><a href="#&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C;-Permission-denied&#xFF0C;&#x6CA1;&#x6743;&#x9650;" class="headerlink" title="&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C; Permission denied&#xFF0C;&#x6CA1;&#x6743;&#x9650;"></a>&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C; <code>Permission denied</code>&#xFF0C;&#x6CA1;&#x6743;&#x9650; <a href="#gua-zai-su-zhu-mu-lu-jie-guo-permission-denied-mei-quan-xian" class="header-anchor">#</a></h3><p>&#x539F;&#x56E0;&#x662F; <code>CentOS</code>/<code>RHEL</code>&#x4E2D;&#x7684; <code>SELinux</code> &#x9650;&#x5236;&#x4E86;&#x76EE;&#x5F55;&#x6743;&#x9650;&#x3002;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x89C4;&#x5219;&#x3002;</p><p>&#x4E0B;&#x9762;&#x662F; <code>man docker-run</code> &#x7684;&#x89E3;&#x91CA;&#xFF1A;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">When  using  SELinux,  be  aware that the host has no knowledge of container</span><br><span class="line">SELinux policy. Therefore, in the above example, if SELinux policy  is enforced,</span><br><span class="line">the /var/db directory is not  writable to the container. A &quot;Permission Denied&quot;</span><br><span class="line">message will occur and an avc: message in the host&apos;s syslog.</span><br><span class="line"></span><br><span class="line">To  work  around  this, at time of writing this man page, the following command</span><br><span class="line">needs to be run in order for the  proper  SELinux  policy  type label to be</span><br><span class="line">attached to the host directory:</span><br></pre></td></tr></table></figure><p>&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5BF9;&#x7279;&#x5B9A;&#x76EE;&#x5F55;&#x6DFB;&#x52A0;&#x89C4;&#x5219;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chcon -Rt svirt_sandbox_file_t /var/db</span><br></pre></td></tr></table></figure><p>&#x53C2;&#x8003;&#xFF1A;<a href="http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/" target="_blank" rel="noopener">http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/</a></p><h3 id="docker-de-var-lib-docker-devicemapper-zhan-yong-kong-jian-bu-duan-zeng-chang-zen-me-po"><a href="#Docker&#x7684;-var-lib-docker-devicemapper-&#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;-&#x600E;&#x4E48;&#x7834;&#xFF1F;" class="headerlink" title="Docker&#x7684; /var/lib/docker/devicemapper &#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;, &#x600E;&#x4E48;&#x7834;&#xFF1F;"></a>Docker&#x7684; <code>/var/lib/docker/devicemapper</code> &#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;, &#x600E;&#x4E48;&#x7834;&#xFF1F; <a href="#docker-de-var-lib-docker-devicemapper-zhan-yong-kong-jian-bu-duan-zeng-chang-zen-me-po" class="header-anchor">#</a></h3><p>&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x4E00;&#x822C;&#x662F; CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7684;&#x95EE;&#x9898;&#xFF0C;CentOS &#x8FD9;&#x7C7B;&#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x50CF; <code>Ubuntu</code> &#x90A3;&#x6837;&#x6709;&#x6210;&#x719F;&#x7684; Union FS&#x5B9E;&#x73B0;(&#x5982;<code>aufs</code>)&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x4F7F;&#x7528; <code>devicemapper</code>&#xFF0C;&#x800C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>lvm-loop</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#x7A00;&#x758F;&#x6587;&#x4EF6;&#x6765;&#x5F53;&#x6210;&#x4E00;&#x4E2A;&#x5757;&#x8BBE;&#x5907;&#xFF0C;&#x7ED9;<code>devicemapper</code>&#x7528;&#xFF0C;&#x4F5C;&#x4E3A;Docker&#x955C;&#x50CF;&#x5BB9;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x6027;&#x80FD;&#x5F88;&#x5DEE;&#x4E0D;&#x8BF4;&#xFF0C;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A; bug&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x529E;&#x6CD5;&#x6362; <code>Ubuntu</code>/<code>Debian</code> &#x7CFB;&#x7EDF;&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x8D77;&#x7801;&#x5E94;&#x8BE5;&#x5EFA;&#x7ACB;&#x5757;&#x8BBE;&#x5907;&#xFF08;&#x5206;&#x533A;&#x3001;&#x5377;&#xFF09;&#x7ED9; <code>devicemapper</code> &#x7528;&#x3002;</p><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-direct-lvm-mode-for-production" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-direct-lvm-mode-for-production</a></p><p>&#x4E25;&#x683C;&#x6765;&#x8BF4; CentOS/RHEL 7 &#x4E2D;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E00;&#x4E2A; Union FS &#x5B9E;&#x73B0;&#xFF0C;&#x867D;&#x7136; CentOS/RHEL 7 &#x7684;&#x5185;&#x6838;&#x662F; 3.10&#xFF0C;&#x4E0D;&#x8FC7;&#x7EA2;&#x5E3D;&#x4ECE; Linux 3.18 backport &#x56DE;&#x6765;&#x4E86; <code>overlay</code> fs &#x7684;&#x9A71;&#x52A8;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x7EA2;&#x5E3D;&#x81EA;&#x5DF1;&#x90FD;&#x5728;&#x5B98;&#x65B9;&#x7684;&#x53D1;&#x5E03;&#x58F0;&#x660E;&#x4E2D;&#x8BF4;&#x80FD;&#x4E0D;&#x8981;&#x7528;&#x5C31;&#x4E0D;&#x7528;&#x3002;</p><p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.2_Release_Notes/technology-preview-file_systems.html" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.2_Release_Notes/technology-preview-file_systems.html</a></p><h3 id="centos-7-de-nei-he-tai-lao-liao-3-10-shi-bu-shi-hen-duo-docker-gong-neng-bu-zhi-chi"><a href="#CentOS-7-&#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86;-3-10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A;-Docker-&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;" class="headerlink" title="CentOS 7 &#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86; 3.10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;"></a>CentOS 7 &#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86; 3.10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F; <a href="#centos-7-de-nei-he-tai-lao-liao-3-10-shi-bu-shi-hen-duo-docker-gong-neng-bu-zhi-chi" class="header-anchor">#</a></h3><p>&#x662F;&#x7684;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x65E0;&#x6CD5;&#x652F;&#x6301;&#xFF0C;&#x6BD4;&#x5982; <code>overlay2</code> &#x7684;&#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x5C31;&#x65E0;&#x6CD5;&#x5728; CentOS &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x5E76;&#x975E;&#x6240;&#x6709;&#x9700;&#x8981;&#x9AD8;&#x7248;&#x672C;&#x5185;&#x6838;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x3002;</p><p>&#x6BD4;&#x5982; Overlay FS &#x9700;&#x8981; Linux 3.18&#xFF0C;&#x800C; Overlay network &#x9700;&#x8981; Linux 3.16&#x3002;&#x800C; CentOS 7 &#x5185;&#x6838;&#x4E3A; 3.10&#xFF0C;&#x786E;&#x5B9E;&#x4F4E;&#x4E8E;&#x8FD9;&#x4E9B;&#x7248;&#x672C;&#x9700;&#x6C42;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x7EA2;&#x5E3D;&#x56E2;&#x961F;&#x4F1A;&#x628A;&#x4E00;&#x4E9B;&#x65B0;&#x5185;&#x6838;&#x7684;&#x529F;&#x80FD; backport &#x56DE;&#x8001;&#x7684;&#x5185;&#x6838;&#x3002;&#x6BD4;&#x5982; <code>overlay fs</code>&#x7B49;&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x4F9D;&#x65E7;&#x4F1A;&#x652F;&#x6301;&#x3002;&#x56E0;&#x6B64; CentOS 7 &#x7684; Docker Engine &#x540C;&#x6837;&#x53EF;&#x4EE5;&#x652F;&#x6301; <code>overlay network</code>&#xFF0C;&#x4EE5;&#x53CA; <code>overlay</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#xFF08;&#x4E0D;&#x662F;<code>overlay2</code>&#xFF09;&#x3002;&#x56E0;&#x6B64;&#x5728;&#x65B0;&#x7684; Docker 1.12 &#x4E2D;&#xFF0C;CentOS/RHEL 7 &#x624D;&#x6709;&#x53EF;&#x80FD;&#x652F;&#x6301; Swarm Mode&#x3002;</p><p>&#x5373;&#x4F7F;&#x7EA2;&#x5E3D;&#x4F1A;&#x628A;&#x4E00;&#x4E9B;&#x9AD8;&#x7248;&#x672C;&#x5185;&#x6838;&#x7684;&#x529F;&#x80FD; backport &#x56DE; 3.10 &#x5185;&#x6838;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x4FEE;&#x4FEE;&#x8865;&#x8865;&#x51FA;&#x6765;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x7A33;&#x5B9A;&#x3002;&#x5982;&#x679C;&#x89C2;&#x5BDF; Docker Issue &#x5217;&#x8868;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5927;&#x91CF;&#x7684;&#x7531;&#x4E8E; CentOS &#x8001;&#x5185;&#x6838;&#x5BFC;&#x81F4;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x4F7F;&#x7528;&#x4E86; 1.12 &#x5185;&#x7F6E;&#x7684; Swarm Mode &#x96C6;&#x7FA4;&#x529F;&#x80FD;&#x540E;&#xFF0C;&#x5B58;&#x50A8;&#x3001;&#x7F51;&#x7EDC;&#x51FA;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x5F88;&#x591A;&#x3002;</p><p>&#x6240;&#x4EE5;&#x4F9D;&#x65E7;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x7EF4;&#x62A4;&#x5185;&#x6838;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x7684; Linux &#x53D1;&#x884C;&#x7248;&#xFF0C;&#x5982; Ubuntu&#x3002;</p><h3 id="centos-7-rhel-7-sheng-ji-1-12-hou-wu-fa-qi-dong-zen-me-hui-shi"><a href="#CentOS-7-RHEL-7-&#x5347;&#x7EA7;-1-12-&#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;" class="headerlink" title="CentOS 7/RHEL 7 &#x5347;&#x7EA7; 1.12 &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;"></a>CentOS 7/RHEL 7 &#x5347;&#x7EA7; 1.12 &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F; <a href="#centos-7-rhel-7-sheng-ji-1-12-hou-wu-fa-qi-dong-zen-me-hui-shi" class="header-anchor">#</a></h3><p>&#x4E00;&#x4E9B;&#x4EBA;&#x5728;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#xFF0C;&#x542F;&#x52A8; Docker &#x65F6;&#x53D1;&#x73B0;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x800C;&#x5728;&#x62A5;&#x9519;&#x4E2D;&#x770B;&#x5230;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unit docker.socket failed to load: No such file or directory.</span><br></pre></td></tr></table></figure><p>&#x5176;&#x539F;&#x56E0;&#x662F;&#x7531;&#x4E8E;&#x4ECE; <code>1.12</code> &#x5F00;&#x59CB;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5728; <code>systemd</code> &#x4E2D;&#x5199;&#x4E2A; <code>docker.socket</code> &#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5C31;&#x968F;&#x5347;&#x7EA7;&#x800C;&#x5220;&#x9664;&#x4E86;&#x3002;&#x800C; <code>docker.service</code> &#x7531;&#x4E8E;&#x88AB;&#x4FEE;&#x6539;&#x8FC7;&#xFF08;&#x6216;&#x522B;&#x7684;&#x4EC0;&#x4E48;&#x539F;&#x56E0;&#xFF09;&#xFF0C;&#x5BFC;&#x81F4; <code>yum</code> &#x5347;&#x7EA7;&#x7684;&#x65F6;&#x5019;&#x6CA1;&#x6709;&#x66FF;&#x6362;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;&#x4E8E;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x65E7;&#x7684; <code>docker.service</code> &#x4E2D;&#x914D;&#x7F6E;&#x8981;&#x6C42;&#x6709; <code>docker.socket</code> &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5DF2;&#x7ECF;&#x5728;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5BFC;&#x81F4;&#x542F;&#x52A8;&#x9519;&#x8BEF;&#x3002;</p><p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x5F00; <code>docker.service</code>&#xFF0C;&#x5C06;&#x5176;&#x53C2;&#x7167; <code>1.12</code> &#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x5373;&#x53EF;&#x3002;&#x5BFB;&#x627E;&#x5230; <code>Required=docker.socket</code> &#x90A3;&#x884C;&#xFF0C;&#x5220;&#x6389;&#x3002;&#x7136;&#x540E;&#x5BFB;&#x627E;&#x5230; <code>docker daemon</code>(&#x6216;&#x8005; <code>dockerd</code>) &#x90A3;&#x884C;&#xFF0C;&#x5C06;&#x5176;&#x540E;&#x7684; <code>-H fd://</code> &#x5220;&#x6389;&#x3002;&#x5E76;&#x4E14;&#x8FDB;&#x4E00;&#x6B65;&#x5C06; <code>docker daemon</code> &#x6539;&#x4E3A; <code>dockerd</code>&#xFF0C;&#x56E0;&#x4E3A;&#x4ECE; <code>1.12</code> &#x5F00;&#x59CB;&#x6539;&#x540D;&#x53EB;&#x8FD9;&#x4E2A;&#x4E86;&#x3002;&#x4FDD;&#x5B58;&#x9000;&#x51FA;&#x91CD;&#x542F;&#x670D;&#x52A1;&#x5373;&#x53EF;&#x3002;</p><h2 id="mac-windows-xiang-guan-wen-ti"><a href="#Mac-Windows-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Mac / Windows &#x76F8;&#x5173;&#x95EE;&#x9898;"></a>Mac / Windows &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#mac-windows-xiang-guan-wen-ti" class="header-anchor">#</a></h2><h3 id="wei-shi-me-zai-mac-xia-gua-zai-su-zhu-mu-lu-usr-local-nginx-bu-cheng-gong"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x5728;Mac&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;-usr-local-nginx&#x4E0D;&#x6210;&#x529F;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x5728;Mac&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;/usr/local/nginx&#x4E0D;&#x6210;&#x529F;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x5728;<code>Mac</code>&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;<code>/usr/local/nginx</code>&#x4E0D;&#x6210;&#x529F;&#xFF1F; <a href="#wei-shi-me-zai-mac-xia-gua-zai-su-zhu-mu-lu-usr-local-nginx-bu-cheng-gong" class="header-anchor">#</a></h3><p>&#x867D;&#x7136; Docker &#x56E2;&#x961F;&#x5C3D;&#x91CF;&#x8BA9;&#x4F7F;&#x7528; <a href="https://www.docker.com/products/docker-toolbox" target="_blank" rel="noopener">Docker Toolbox</a>, <a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">Docker for Mac</a> and <a href="https://docs.docker.com/docker-for-windows" target="_blank" rel="noopener">Docker for Windows</a> &#x7684;&#x7528;&#x6237;&#x611F;&#x89C9;&#x64CD;&#x4F5C; Docker &#x5C31;&#x50CF;&#x5728; Linux &#x4E0B;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5728; Mac/Windows &#x4E0A;&#x5E76;&#x975E;&#x662F;&#x76F4;&#x63A5;&#x8FD0;&#x884C; Docker &#x7684;&#x3002;&#x4E2D;&#x95F4;&#x7ECF;&#x8FC7;&#x4E86;&#x4E00;&#x4E2A; Linux &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C; Docker &#x8FD0;&#x884C;&#x5728;&#x90A3;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x91CC;&#x3002;</p><p>&#x56E0;&#x6B64; Mac &#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x76EE;&#x5F55;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x662F; Docker &#x773C;&#x4E2D;&#x7684;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x7528;&#x6237;&#x5C3D;&#x91CF;&#x611F;&#x89C9;&#x4E0D;&#x5230;&#x8FD9;&#x4E2A;&#x5DEE;&#x5F02;&#xFF0C;<code>Boot2Docker</code> &#x6216;&#x8005; <code>Docker for Mac / Windows</code> &#x4E2D;&#xFF0C;&#x5C06;&#x4E00;&#x90E8;&#x5206;&#x7269;&#x7406;&#x4E3B;&#x673A;&#x7684;&#x76EE;&#x5F55;&#x6620;&#x5C04;&#x5230;&#x4E86; Linux &#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x5176;&#x4E0A; Docker &#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x8FD9;&#x4E9B;&#x7269;&#x7406;&#x673A;&#x7684;&#x76EE;&#x5F55;&#x4E86;&#x3002;</p><p>&#x51FA;&#x4E8E;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x628A;&#x7269;&#x7406;&#x673A;&#x7684;&#x6240;&#x6709;&#x76EE;&#x5F55;&#x90FD;&#x6620;&#x5C04;&#x5230; Linux &#x865A;&#x62DF;&#x673A;&#x5185;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x53EA;&#x6709;&#x5F53;&#x524D;&#x7528;&#x6237;&#x76EE;&#x5F55;&#x5728;&#x5185;&#x7684;&#x4E00;&#x4E9B;&#x76EE;&#x5F55;&#x4F1A;&#x88AB;&#x6620;&#x5C04;&#x5230; Linux &#x865A;&#x62DF;&#x673A;&#x5185;&#xFF0C;&#x6BD4;&#x5982; <code>/Users</code>, <code>/Volumes</code> &#x7B49;&#x3002;</p><p>&#x5BF9;&#x4E8E; <code>Docker for Mac</code> &#x7684;&#x7528;&#x6237;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x914D;&#x7F6E;&#x754C;&#x9762; <code>File Sharing</code> &#x4E2D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x7684;&#x6620;&#x5C04;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x51FA;&#x4E8E;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF0C;&#x4E0D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x6620;&#x5C04;&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x7528;&#x6237;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x662F;&#x66F4;&#x597D;&#x5730;&#x505A;&#x6CD5;&#x3002;</p><h3 id="ting-shuo-windows-10-windows-server-2016-nei-zhi-docker-liao-he-docker-guan-wang-xia-zai-de-docker-for-windows-you-shi-me-qu-bie-a"><a href="#&#x542C;&#x8BF4;-Windows-10&#x3001;Windows-Server-2016-&#x5185;&#x7F6E;-Docker-&#x4E86;&#xFF1F;&#x548C;-Docker-&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x7684;-Docker-for-Windows-&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x554A;&#xFF1F;" class="headerlink" title="&#x542C;&#x8BF4; Windows 10&#x3001;Windows Server 2016 &#x5185;&#x7F6E; Docker &#x4E86;&#xFF1F;&#x548C; Docker &#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x7684; Docker for Windows &#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x554A;&#xFF1F;"></a>&#x542C;&#x8BF4; Windows 10&#x3001;Windows Server 2016 &#x5185;&#x7F6E; Docker &#x4E86;&#xFF1F;&#x548C; Docker &#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x7684; Docker for Windows &#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x554A;&#xFF1F; <a href="#ting-shuo-windows-10-windows-server-2016-nei-zhi-docker-liao-he-docker-guan-wang-xia-zai-de-docker-for-windows-you-shi-me-qu-bie-a" class="header-anchor">#</a></h3><p>&#x4E8C;&#x8005;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x3002;</p><p>Windows 10 &#x6216;&#x8005; Windows Server 2016 &#x81EA;&#x5E26;&#x7684; Docker&#xFF0C;&#x88AB;&#x79F0;&#x4E3A; <code>Docker on Windows</code>&#xFF0C;&#x5176;&#x8FD0;&#x884C;&#x4E8E; Windows NT &#x5185;&#x6838;&#x81F3;&#x4E0A;&#xFF0C;&#x4EE5; Docker &#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x5F0F;&#x63D0;&#x4F9B; Windows &#x5BB9;&#x5668;&#x670D;&#x52A1;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; Windows &#x7A0B;&#x5E8F;&#x3002;</p><p>&#x800C; Docker &#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x7684;&#xFF0C;&#x88AB;&#x79F0;&#x4E3A; <code>Docker for Windows</code>&#x3002;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x5E38;&#x8BF4;&#x7684; Docker&#xFF0C;&#x5B83;&#x662F;&#x8FD0;&#x884C;&#x4E8E; Linux &#x5185;&#x6838;&#x4E0A;&#x7684; Docker&#x3002;&#x5728; Windows &#x4E0A;&#x8FD0;&#x884C;&#x65F6;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5728; Hyper-V &#x4E0A;&#x7684;&#x4E00;&#x4E2A; Alpine Linux &#x865A;&#x62DF;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x7684; Docker&#x3002;&#x5B83;&#x53EA;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; Linux &#x7A0B;&#x5E8F;&#x3002;</p><p><code>Docker on Windows</code> &#x6781;&#x4E3A;&#x81C3;&#x80BF;&#xFF0C;&#x6700;&#x5C0F;&#x955C;&#x50CF;&#x4E5F;&#x8FD1; GB&#xFF0C;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x5E76;&#x4E0D;&#x5FEB;&#xFF1B;&#x800C; <code>Docker for Windows</code> &#x5219;&#x662F;&#x6B63;&#x5E38;&#x7684; Docker&#xFF0C;&#x6700;&#x5C0F;&#x955C;&#x50CF;&#x4E5F;&#x5C31;&#x51E0;&#x5341; KB&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x955C;&#x50CF;&#x90FD;&#x5728;&#x51E0;&#x767E;&#x5146;&#x4EE5;&#x5185;&#xFF0C;&#x800C;&#x4E14;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x57FA;&#x672C;&#x662F;&#x6BEB;&#x79D2;&#x7EA7;&#x3002;</p><p>&#x5E0C;&#x671B;&#x5BF9; <code>Docker on Windows</code> &#x6709;&#x6240;&#x4E86;&#x89E3;&#x7684;&#x7AE5;&#x978B;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x4E00;&#x4E2A; DockerCon &#x7684;&#x89C6;&#x9891;&#xFF0C;&#x662F;&#x7531;&#x5FAE;&#x8F6F;&#x8D1F;&#x8D23; Docker &#x9879;&#x76EE;&#x7684;&#x6784;&#x67B6;&#x5E08;&#x8FDB;&#x884C;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x4ECE;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7B2C;&#x4E00;&#x624B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;Windows &#x5230;&#x5E95;&#x6709;&#x591A;&#x60E8;&#x3002;&#x8FD9;&#x4E2A;&#x89C6;&#x9891;&#x6211;&#x505A;&#x4E86;&#x7B14;&#x8BB0;&#xFF0C;&#x53EF;&#x4EE5;&#x5230;&#x8FD9;&#x91CC;&#x770B;&#x4E00;&#x4E0B;&#xFF1A;&lt;/post/docker-2016-08-12-video-windows-server-and-docker.html&gt;</p><h1 id="qi-ta-wen-ti-1"><a href="#&#x5176;&#x5B83;&#x95EE;&#x9898;-1" class="headerlink" title="&#x5176;&#x5B83;&#x95EE;&#x9898; (1)"></a>&#x5176;&#x5B83;&#x95EE;&#x9898; <code>(1)</code> <a href="#qi-ta-wen-ti-1" class="header-anchor">#</a></h1><h2 id="kubernetes-zhe-ci-zha-nian-a-wei-sha-you-ren-guan-ta-jiao-k8s"><a href="#Kubernetes-&#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;&#x4E3A;&#x5565;&#x6709;&#x4EBA;&#x7BA1;&#x5B83;&#x53EB;-k8s-&#xFF1F;" class="headerlink" title="Kubernetes &#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;&#x4E3A;&#x5565;&#x6709;&#x4EBA;&#x7BA1;&#x5B83;&#x53EB; k8s &#xFF1F;"></a><code>Kubernetes</code> &#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;&#x4E3A;&#x5565;&#x6709;&#x4EBA;&#x7BA1;&#x5B83;&#x53EB; <code>k8s</code> &#xFF1F; <a href="#kubernetes-zhe-ci-zha-nian-a-wei-sha-you-ren-guan-ta-jiao-k8s" class="header-anchor">#</a></h2><p>Kubernetes &#x7684;&#x53D1;&#x97F3;&#xFF1A;<code>koo-ber-nay&apos;-tace</code> &#xFF0C;&#xFF08;&#x5982;&#x679C;&#x975E;&#x7528;&#x4E2D;&#x6587;&#x62FC;&#x51D1;&#x7684;&#x8BDD;&#xFF0C;&#x5927;&#x6982;&#x662F;<code>&#x201C;&#x9177;-&#x535A;-&#x5185;-&#x5FD2;&#x4E1D;&#x201D;</code>&#xFF09;&#xFF0C;&#x8FD9;&#x8BCD;&#x6765;&#x81EA;&#x5E0C;&#x814A;<code>&#x8235;&#x624B;</code>&#x8FD9;&#x4E2A;&#x8BCD;&#x3002;<br>&#x4F46;&#x662F;&#x7ECF;&#x5E38;&#x6709;&#x4EBA;&#x5FF5;&#x6210;&#xFF1A;<code>koo-ber-net-ees</code>&#xFF0C;&#xFF08;&#x5982;&#x679C;&#x975E;&#x7528;&#x4E2D;&#x6587;&#x62FC;&#x51D1;&#x7684;&#x8BDD;&#xFF0C;&#x5927;&#x6982;&#x662F;<code>&#x201C;&#x9177;-&#x535A;-&#x8010;-&#x66FF;&#x201D;</code>&#xFF09;&#x3002;&#x4E5F;&#x6709;&#x4EBA;&#x72AF;&#x61D2;&#x7ECF;&#x5E38;&#x662F;&#x5FF5;&#x6210; <code>k8s</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>k-eights</code>&#x3002;</p><p><a href="http://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html" target="_blank" rel="noopener">http://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html</a></p><p>&#x81F3;&#x4E8E;&#x4E3A;&#x5565;&#x53EB; <code>k8s</code>&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x53D1;&#x97F3;&#x63A5;&#x8FD1;&#x4E48;&#xFF1F;&#x2026;&#x2026;&#x597D;&#x5427;&#xFF0C;&#x5B9E;&#x8BDD;&#x8BF4;&#x4E86;&#x5427;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x72AF;&#x61D2;&#xFF0C;&#x6570;&#x6570; <code>k</code> &#x548C; <code>s</code> &#x4E2D;&#x95F4;&#x591A;&#x5C11;&#x4E2A;&#x5B57;&#x6BCD;&#xFF1F;8 &#x4E2A;&#x5427;&#xFF0C;&#x8FD9;&#x4E2A; 8 &#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x7701;&#x7565; 8 &#x4E2A;&#x5B57;&#x6BCD;&#xFF0C;&#x61D2;&#x5F97;&#x6572;&#x4E86;&#x2026;&#x2026; &#x5176;&#x5B9E;&#x8FD9;&#x7C7B;&#x7528;&#x6CD5;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x5982; <code>i18n</code> (<code>internationalization</code>), <code>l11n</code> (<code>localization</code>) &#x7B49;&#x7B49;&#xFF0C;&#x8001;&#x5916;&#x4E5F;&#x61D2;&#x5F97;&#x6253;&#x5B57;&#x554A;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;h1 id=&quot;qian-yan&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="blog" scheme="https://1x481n.github.io/blog.lab99.org/tags/blog/"/>
    
      <category term="faq" scheme="https://1x481n.github.io/blog.lab99.org/tags/faq/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Moby 的 Cool Hack session</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-12-video-moby-cool-hack-session-dockercon.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-12-video-moby-cool-hack-session-dockercon.html</id>
    <published>2016-07-11T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.619Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#nei-rong">&#x5185;&#x5BB9;</a></li><li><a href="#entropy-failure-injection-management-api-for-docker-platforms-by-jeff-nickoloff">Entropy: failure injection management API for Docker platforms by Jeff Nickoloff</a><ul><li><a href="#project-entropy">Project Entropy</a></li></ul></li><li><a href="#serverless-docker-by-ben-firshman">Serverless Docker by Ben Firshman</a><ul><li><a href="#serviceless-docker">Serviceless == Docker</a></li><li><a href="#wo-men-jin-tian-swarm-ji-qun-huan-jing-qi-shi-shi-mian-lin-he-90-nian-dai-cgi-yi-yang-de-wen-ti">&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C; 90&#x5E74;&#x4EE3;<code>CGI</code>&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;</a></li></ul></li><li><a href="#in-the-air-update-of-a-drone-with-docker-and-resin-io">In-the-air update of a drone with Docker and Resin.io</a><ul><li><a href="#drone-shi-yun-xing-yu-resin-io-jia-gou-de">Drone &#x662F;&#x8FD0;&#x884C;&#x4E8E; <code>Resin.io</code> &#x67B6;&#x6784;&#x7684;&#x3002;</a></li><li><a href="#sheng-ji-handover-strategy">&#x5347;&#x7EA7; Handover Strategy</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Moby&#x2019;s Cool Hack Session DockerCon<br>by Mano Marks and Kristie Howard</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/75vm6rRb6K0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=75vm6rRb6K0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=75vm6rRb6K0</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=k03143nuw7k&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/k03143nuw7k.html" target="_blank" rel="noopener">http://v.qq.com/x/page/k03143nuw7k.html</a></p><h1 id="nei-rong"><a href="#&#x5185;&#x5BB9;" class="headerlink" title="&#x5185;&#x5BB9;"></a>&#x5185;&#x5BB9; <a href="#nei-rong" class="header-anchor">#</a></h1><p>&#x6BCF;&#x5E74;DockerCon&#x7ED3;&#x5C3E;&#x90FD;&#x4F1A;&#x9009;&#x51FA;&#x6700;&#x6709;&#x521B;&#x610F;&#x7684;&#x9879;&#x76EE;&#x3002;</p><h1 id="entropy-failure-injection-management-api-for-docker-platforms-by-jeff-nickoloff"><a href="#Entropy-failure-injection-management-API-for-Docker-platforms-by-Jeff-Nickoloff" class="headerlink" title="Entropy: failure injection management API for Docker platforms by Jeff Nickoloff"></a>Entropy: failure injection management API for Docker platforms by Jeff Nickoloff <a href="#entropy-failure-injection-management-api-for-docker-platforms-by-jeff-nickoloff" class="header-anchor">#</a></h1><p>&#x4EE5;&#x524D;&#x5728;AWS&#x5DE5;&#x4F5C;&#xFF0C;&#x540E;&#x6765;&#x7ED9;&#x5F88;&#x591A;&#x516C;&#x53F8;&#x505A;&#x8FC7;&#x54A8;&#x8BE2;&#x3002;&#x5728;AWS&#x7684;&#x65F6;&#x5019;8&#x4E2A;&#x4EBA;&#x7684;&#x56E2;&#x961F;&#x7BA1;&#x7406;300&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p><blockquote><p><strong>If something can fail, it will fail.</strong></p></blockquote><p>&#x5BF9;&#x4E8E;&#x8FD0;&#x7EF4;&#x6765;&#x8BF4;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x7ECF;&#x5E38; <code>fail</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5750;&#x5728;&#x5B9A;&#x65F6;&#x70B8;&#x5F39;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x67D0;&#x5929;<code>3am</code>&#x88AB;&#x53EB;&#x9192;&#x540E;&#x67E5;&#x4E86;&#x5F88;&#x4E45;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x770B;&#x5230;&#x4E00;&#x884C;&#x6CE8;&#x91CA;&#xFF0C;&#x201C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4F30;&#x8BA1;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x2026;&#x2026;&#x201D;</p><p>&#x4ECE;&#x5DE5;&#x7A0B;&#x89D2;&#x5EA6;&#x770B;&#x95EE;&#x9898;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x4ECE;&#x5982;&#x4F55;&#x8BA9;&#x6865;&#x62C6;&#x6389;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x5982;&#x4F55;&#x7EC4;&#x88C5;&#x8FD9;&#x4E2A;&#x6865;&#x7684;&#x89D2;&#x5EA6;&#x3002;</p><h2 id="project-entropy"><a href="#Project-Entropy" class="headerlink" title="Project Entropy"></a>Project Entropy <a href="#project-entropy" class="header-anchor">#</a></h2><p><a href="https://github.com/buildertools/entropy" target="_blank" rel="noopener">https://github.com/buildertools/entropy</a></p><p>Demo&#x4E2D;&#xFF0C;&#x7528;&#x4E00;&#x4E2A;<code>compose</code>&#x6587;&#x4EF6;&#xFF0C;&#x542F;&#x52A8;&#x4E00;&#x4E2A;3&#x8282;&#x70B9;<code>swarm cluster</code>&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;Docker In Docker &#xFF08;image: <code>docker:1.10-dind</code>)&#xFF0C;&#x8FD0;&#x884C;&#x5728; <code>Docker for Mac</code>, <code>1.12-rc2</code>&#x4E0A;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">demo entropy-client create --frequency 10 --probability .50 --failure latency --image allingeek/gremlins --criteria service=PingGoogle</span><br></pre></td></tr></table></figure><p>&#x5229;&#x7528;Docker in Docker&#xFF0C;&#x6765;&#x5F15;&#x5165;&#x5EF6;&#x65F6;&#xFF0C;&#x751A;&#x81F3;&#x5931;&#x8D25;&#x3002;</p><h1 id="serverless-docker-by-ben-firshman"><a href="#Serverless-Docker-by-Ben-Firshman" class="headerlink" title="Serverless Docker by Ben Firshman"></a>Serverless Docker by Ben Firshman <a href="#serverless-docker-by-ben-firshman" class="header-anchor">#</a></h1><h2 id="serviceless-docker"><a href="#Serviceless-Docker" class="headerlink" title="Serviceless == Docker"></a>Serviceless == Docker <a href="#serviceless-docker" class="header-anchor">#</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># &#x5F15;&#x5165;Docker Library</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> dockerrun</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FDE;&#x63A5; Swarm API</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>client = dockerrun.from_env()</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7136;&#x540E;&#x8FD0;&#x884C;&#x6307;&#x5B9A;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x7ED9;&#x5B9A;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>client.run(<span class="string">&quot;bfirsh/leftpad&quot;</span>, [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;5&quot;</span>])</span><br><span class="line"><span class="string">&apos;  foo\n&apos;</span></span><br></pre></td></tr></table></figure><p><code>dockerrun</code> package &#x662F; Ben &#x5199;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x5229;&#x7528; <code>docker-py</code> API&#x7684;&#x5305;&#x3002;&#x53EF;&#x4EE5;&#x7528;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x5F62;&#x5F0F;&#x6267;&#x884C; Docker &#x955C;&#x50CF;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x3002;</p><p>&#x5728; DockerCon &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x662F; <code>&#x1F431;</code> vs <code>&#x1F436;</code> &#x7684;&#x6295;&#x7968; app&#x3002;&#x8FD9;&#x4E2A; app &#x6709;5&#x4E2A;&#x4E00;&#x76F4;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x800C;&#x6784;&#x6210;&#x3002;</p><blockquote><p><code>Voting App</code> &#x2192; <code>Message Queue</code> &#x2192; <code>Worker</code> &#x2192; <code>database</code> &#x2192; <code>Result App</code></p></blockquote><p>&#x5728; Ben &#x7684;&#x6F14;&#x793A;&#x4E2D;&#xFF0C;&#x4ED6;&#x6CA1;&#x6709;&#x6301;&#x7EED;&#x8FD0;&#x884C; <code>Message Queue</code> &#x548C; <code>Worker</code> &#x8FD9;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x7528;<code>dockerrun</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53BB;&#x8BB0;&#x5F55;&#x8BE5;&#x6295;&#x7968;&#x7ED3;&#x679C;&#xFF0C;&#x76F4;&#x63A5;&#x9001;&#x5230;&#x6570;&#x636E;&#x5E93;&#x3002;&#x8FD9;&#x6837;&#x53EA;&#x6709;&#x5728;&#x6709;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x8FD0;&#x884C;&#x8BB0;&#x5F55;&#x6295;&#x7968;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6CA1;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4E0D;&#x53BB;&#x8FD0;&#x884C;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x3002;</p><p>&#x7ED3;&#x6784;&#x5C31;&#x6539;&#x53D8;&#x4E3A;&#xFF1A;</p><blockquote><p><code>Voting App</code> &#x2192; <code>Record Vote Task</code> &#x2192; <code>Database</code> &#x2192; <code>Result App</code></p></blockquote><p>&#x7136;&#x540E;&#x518D;&#x89C2;&#x5BDF;&#x8FD9;&#x4E2A;&#x6784;&#x67B6;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0; <code>Voting App</code> &#x548C; <code>Result App</code> &#x8FD9;&#x662F;&#x4E24;&#x4E2A; <code>HTTP</code> &#x670D;&#x52A1;&#xFF0C;&#x800C;&#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x5C31;&#x662F;&#x5728;&#x90A3;&#x91CC;&#x7B49;&#x7740;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x3002;&#x4F3C;&#x4E4E;&#x8FD9;&#x4E2A;&#x4E5F;&#x53EF;&#x4EE5;&#x6539;&#x53D8; s<code>erviceless</code>&#xFF0C;<code>functional</code> &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x9700;&#x6C42;&#x7684;&#x65F6;&#x5019;&#x624D;&#x8FD0;&#x884C;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5DF2;&#x7ECF;&#x51E0;&#x5341;&#x5E74;&#x524D;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x53EB;&#x505A; <code>CGI</code>(<em>&#x2026;&#x2026;&#x1F613;</em>)&#x3002;</p><p>&#x5BF9;&#x4E8E; <code>Voting App</code> &#x6765;&#x8BF4;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x56E0;&#x4E3A; <code>Python</code> &#x4E2D;&#x5185;&#x7F6E;&#x4E86; <code>CGIHandler()</code> &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x5E94;&#x7528;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x529F;&#x80FD;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x51E0;&#x5341;&#x5E74;&#x4E86;&#x3002;</p><p>&#x800C;&#x5BF9;&#x4E8E; <code>Result App</code> &#x6709;&#x4E9B;&#x9EBB;&#x70E6;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F; <code>Node.js App</code>&#xFF0C;&#x975E;&#x5E38;&#x73B0;&#x4EE3;&#xFF0C;&#x6CA1;&#x6709;&#x8FD9;&#x4E48;&#x53E4;&#x8001;&#x7684;&#x673A;&#x5236;&#x3002;&#x5F88;&#x9057;&#x61BE;&#x554A;&#xFF0C;&#x4E8E;&#x662F; Ben &#x51B3;&#x5B9A;&#x7528;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x652F;&#x6301;&#x4E0B;&#x4E00;&#x4EE3; <code>Serviceless</code> &#x7684;&#x8BED;&#x8A00;&#x91CD;&#x5199;&#x4E86; <code>Result App</code> - <code>Perl</code> (<em>&#x2026;&#x2026;&#x1F613;&#x8FD8;&#x80FD;&#x518D;&#x53E4;&#x8001;&#x4E9B;&#x4E48;&#xFF1F;&#xFF1F;</em>)</p><p>&#x7136;&#x540E;&#x73B0;&#x5728;&#x7ED3;&#x6784;&#x5C31;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x53D8;&#x5316;&#x4E86;&#xFF1A;</p><blockquote><p><code>Entrypoint</code> &#x2192; { <code>handle_vote</code> &#x2192; <code>process vote</code>, <code>handle_result</code> } &#x2192; <code>database</code></p></blockquote><p>&#x8BBF;&#x95EE;&#x670D;&#x52A1; <a href="http://localhost/vote/" target="_blank" rel="noopener">http://localhost/vote/</a> &#x540E;&#x4F1A;&#x770B;&#x5230;&#x5DF2;&#x7ECF;&#x89C1;&#x8FC7;&#x5F88;&#x591A;&#x6B21;&#x7684; <code>vote app</code>&#x3002;&#x800C;&#x4E0B;&#x65B9;&#x7684; <code>Container ID</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x662F;&#x8FD0;&#x884C;&#x7684;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Container &#x7684; ID&#xFF0C;&#x662F;&#x5728;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x4E00;&#x6B21;&#x76F8;&#x540C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p><p>&#x57FA;&#x672C;&#x4E0A;&#xFF0C;&#x9664;&#x4E86;&#x5165;&#x53E3;&#x70B9;&#x548C;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x957F;&#x671F;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;/&#x670D;&#x52A1;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x662F; <code>Serviceless</code>&#x3002;</p><p>&#x8FD9;&#x4E2A;demo&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x8981;&#x63A8;&#x8350;&#x5927;&#x5BB6;&#x90FD;&#x653E;&#x5F03;&#x73B0;&#x4EE3;Web&#x6280;&#x672F;&#xFF0C;&#x800C;&#x56DE;&#x53BB;&#x7528;CGI&#xFF0C;&#x800C;&#x662F;&#x5C55;&#x793A;&#x4E86;&#x51E0;&#x4E2A;&#x6709;&#x610F;&#x601D;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;</p><ul><li>&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x7CFB;&#x5217;function&#x5C01;&#x88C5;&#x4E3A;&#x5BB9;&#x5668;&#xFF08;&#x66F4;&#x7EC6;&#x7C92;&#x5316;&#x7684;&#x5FAE;&#x670D;&#x52A1;&#xFF1F;&#xFF09;</li><li>&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x662F;&#x8FD0;&#x884C;&#x4E8E;swarm&#x4E0A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x6269;&#x5C55;</li><li>&#x4ECE;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x522B;&#x7684;&#x5BB9;&#x5668;</li></ul><h2 id="wo-men-jin-tian-swarm-ji-qun-huan-jing-qi-shi-shi-mian-lin-he-90-nian-dai-cgi-yi-yang-de-wen-ti"><a href="#&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C;-90&#x5E74;&#x4EE3;CGI&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C; 90&#x5E74;&#x4EE3;CGI&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;"></a>&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C; 90&#x5E74;&#x4EE3;<code>CGI</code>&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898; <a href="#wo-men-jin-tian-swarm-ji-qun-huan-jing-qi-shi-shi-mian-lin-he-90-nian-dai-cgi-yi-yang-de-wen-ti" class="header-anchor">#</a></h2><p>Ben &#x5F15;&#x7533;&#x4E86;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x8DA3;&#x7684;&#x76F8;&#x4F3C;&#x6027;&#x3002;</p><p>&#x5728;90&#x5E74;&#x4EE3;&#xFF0C;CGI&#x662F;&#x975E;&#x5E38;&#x5438;&#x5F15;&#x4EBA;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6B64;&#x4E4B;&#x524D;&#x53EA;&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x9759;&#x6001;&#x9875;&#x9762;&#xFF0C;&#x800C;CGI&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x52A8;&#x6001;&#x7684;&#x5185;&#x5BB9;&#xFF1B;&#x800C;&#x4ECA;&#x5929;&#x5728;Swarm&#x8FD9;&#x79CD;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5176;&#x5B9E;&#x9762;&#x4E34;&#x7684;&#x662F;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x6B21;&#x9759;&#x6001;&#x7684;&#x4E0D;&#x662F;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x662F;&#x670D;&#x52A1;/&#x5BB9;&#x5668;/&#x670D;&#x52A1;&#x5668;&#xFF0C;Docker&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;&#x4E9B;&#x9759;&#x6001;&#x7684;&#x4E1C;&#x897F;&#x52A8;&#x6001;&#x5316;&#xFF0C;&#x4E0D;&#x540C;&#x5C42;&#x6B21;&#x7684;&#x5BB9;&#x5668;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x6709;&#x67D0;&#x4E9B;&#x5BB9;&#x5668;&#x6839;&#x636E;&#x9700;&#x6C42;&#x800C;&#x52A8;&#x6001;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#xFF0C;&#x4ECE;&#x524D;&#x7AEF;&#x5230;&#x4E2D;&#x95F4;&#x4EF6;&#x5230;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x4E0B;&#x5B9E;&#x73B0;&#x5168;&#x52A8;&#x6001;&#x73AF;&#x5883;&#x3002;</p><p><a href="https://github.com/bfirsh/serverless-docker#serverlessdocker" target="_blank" rel="noopener">https://github.com/bfirsh/serverless-docker#serverlessdocker</a></p><h1 id="in-the-air-update-of-a-drone-with-docker-and-resin-io"><a href="#In-the-air-update-of-a-drone-with-Docker-and-Resin-io" class="headerlink" title="In-the-air update of a drone with Docker and Resin.io"></a>In-the-air update of a drone with Docker and Resin.io <a href="#in-the-air-update-of-a-drone-with-docker-and-resin-io" class="header-anchor">#</a></h1><ul><li>&#x8DE8;&#x5E73;&#x53F0;&#x6784;&#x5EFA;</li><li>&#x5D4C;&#x5165;&#x5F0F;&#x8BBE;&#x5907;&#x6700;&#x5C0F;&#x7CFB;&#x7EDF;</li><li>&#x5BB9;&#x5668; Deltas</li><li>&#x5D4C;&#x5165;&#x5F0F;&#x5347;&#x7EA7; Strategies</li></ul><h2 id="drone-shi-yun-xing-yu-resin-io-jia-gou-de"><a href="#Drone-&#x662F;&#x8FD0;&#x884C;&#x4E8E;-Resin-io-&#x67B6;&#x6784;&#x7684;&#x3002;" class="headerlink" title="Drone &#x662F;&#x8FD0;&#x884C;&#x4E8E; Resin.io &#x67B6;&#x6784;&#x7684;&#x3002;"></a>Drone &#x662F;&#x8FD0;&#x884C;&#x4E8E; <code>Resin.io</code> &#x67B6;&#x6784;&#x7684;&#x3002; <a href="#drone-shi-yun-xing-yu-resin-io-jia-gou-de" class="header-anchor">#</a></h2><p><code>Resin.io</code> &#x2192; <code>Linux Kernel</code> + <code>yocto</code> + <code>Docker</code> + <code>Resin.io</code> Container + <code>App</code> Container + <code>Extensions</code> Container</p><h2 id="sheng-ji-handover-strategy"><a href="#&#x5347;&#x7EA7;-Handover-Strategy" class="headerlink" title="&#x5347;&#x7EA7; Handover Strategy"></a>&#x5347;&#x7EA7; Handover Strategy <a href="#sheng-ji-handover-strategy" class="header-anchor">#</a></h2><p>&#x73B0;&#x5728; <code>Drone</code> &#x4E0A;&#x8DD1;&#x7684;&#x662F; <code>Version 1</code>&#xFF0C;&#x5C06;&#x8981;&#x5347;&#x7EA7;&#x5230; <code>Version 2</code>&#x3002;&#x7B56;&#x7565;&#x5E76;&#x975E;&#x662F;&#x6740;&#x6389; <code>V1</code> &#x7136;&#x540E;&#x8FD0;&#x884C; <code>V2</code>&#xFF0C;&#x800C;&#x662F; <code>V2</code> &#x5BB9;&#x5668;&#x51C6;&#x5907;&#x597D;&#x540E;&#xFF0C;&#x5148;&#x8FD0;&#x884C;&#xFF0C;&#x8FD0;&#x884C;&#x540E; <code>V1</code> &#x5BB9;&#x5668;&#x5F00;&#x59CB;&#x5411; <code>V2</code> &#x5BB9;&#x5668;&#x4EA4;&#x63A5;&#x8D44;&#x6E90;(<code>rotors</code>, <code>camera</code>, <code>websocket</code>)&#x7B49;&#x3002;&#x4EA4;&#x63A5;&#x7ED3;&#x675F;&#x540E;&#xFF0C;<code>V2</code> &#x5B9E;&#x9645;&#x4E0A;&#x5DF2;&#x7ECF;&#x5728;&#x627F;&#x8F7D;&#x670D;&#x52A1;&#x4E86;&#xFF0C;<code>V1</code>&#x6CA1;&#x7528;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;<code>V1</code>&#x4F1A;&#x5411;&#x4E0A;&#x7EA7;&#x7533;&#x8BF7;&#x8BF4;<code>kill me</code>&#x3002;</p><p>&#x8FD9;&#x6837;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x5E73;&#x6ED1;&#xFF0C;&#x53EA;&#x6709;&#x975E;&#x5E38;&#x5C0F;&#x7684;gap&#x3002;</p><p>&#x73B0;&#x5728;&#x770B;&#x5230;&#x7684;Web&#x754C;&#x9762;&#x662F;Drone&#x8EAB;&#x4E0A;&#x8DD1;&#x7684;&#x4E00;&#x4E2A;Web&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD4;&#x56DE;&#x5B9E;&#x65F6;&#x7684;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x3002;</p><p>&#x73B0;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6709;&#x65B0;&#x7684;&#x529F;&#x80FD;&#x63D0;&#x4EA4;&#x4E86;&#xFF0C;<code>git push resin master</code> &#x540E;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x5E76;&#x4E14;<code>push</code>&#x5230;<code>docker registry</code>&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x89E6;&#x53D1;&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#xFF0C;Drone&#x4F1A;&#x5F00;&#x59CB;&#x4E0B;&#x8F7D;&#x65B0;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#x51C6;&#x5907;&#x8FD0;&#x884C;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x4F1A;&#x5728;Drone control panel&#x4E0A;&#x770B;&#x5230;&#x9640;&#x87BA;&#x4EEA;&#x4F1A;&#x6709;&#x4E9B;&#x6296;&#x52A8;&#xFF0C;&#x8FD9;&#x4E9B;&#x6296;&#x52A8;&#x662F;<code>V1</code>&#x548C;<code>V2</code>&#x5728;&#x4EA4;&#x63A5;sensor&#x63A7;&#x5236;&#x6743;&#x65F6;&#x4EA7;&#x751F;&#x7684;gap&#xFF0C;&#x975E;&#x5E38;&#x5C0F;&#x3002;&#x800C;&#x4E14;&#x5347;&#x7EA7;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x65B0;&#x7684;&#x70ED;&#x6210;&#x50CF;camera&#x5F00;&#x59CB;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Containerd - 构建容器 Supervisor - Michael Crosby</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-containerd-building-a-container-supervisor.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-containerd-building-a-container-supervisor.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.618Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#whoami">&gt; whoami</a></li><li><a href="#man-containerd">&gt; man containerd</a></li><li><a href="#why">&gt; why</a></li><li><a href="#benchmarks">Benchmarks</a></li><li><a href="#events">events</a></li><li><a href="#daemonless">&gt; daemonless</a><ul><li><a href="#container-state">&gt; container state</a></li><li><a href="#daemonless-problems">&gt; daemonless problems</a><ul><li><a href="#containerd-shim">&gt; containerd-shim</a></li><li><a href="#exit-status">&gt; exit status</a></li><li><a href="#stdio">&gt; stdio</a></li><li><a href="#re-parenting">&gt; re-parenting</a></li></ul></li><li><a href="#the-oom-problem">&gt; The OOM problem</a><ul><li><a href="#runtime-workflow">&gt; runtime workflow</a></li></ul></li></ul></li><li><a href="#yan-shi-dai-ma">&#x6F14;&#x793A;&#x4EE3;&#x7801;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Containerd - Building a Container Supervisor<br>by Michael Crosby</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/VWuHWfEB6ro" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=VWuHWfEB6ro" target="_blank" rel="noopener">https://www.youtube.com/watch?v=VWuHWfEB6ro</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=q0314svqva0&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/q0314svqva0.html" target="_blank" rel="noopener">http://v.qq.com/x/page/q0314svqva0.html</a></p><h1 id="whoami"><a href="#gt-whoami" class="headerlink" title="&gt; whoami"></a>&gt; whoami <a href="#whoami" class="header-anchor">#</a></h1><ul><li>&#x81EA; Docker 0.3 &#x5F00;&#x59CB;&#x5C31;&#x662F;&#x4ECB;&#x5165;&#x5F00;&#x53D1;&#xFF0C;0.5&#x5F00;&#x59CB;&#x5C31;&#x662F; maintainer &#xFF08;&#x5C31;&#x662F;&#x4ECE;&#x7ED1;&#x5B9A; localhost &#x53D8;&#x6210;&#x7ED1;&#x5B9A; socket&#xFF0C;&#x55EF;&#xFF0C;&#x7ED3;&#x679C;&#x6240;&#x6709;&#x4EBA;&#x7684;&#x73AF;&#x5883;&#x90FD;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#xFF09;</li><li>dockerui &#x7684;&#x4F5C;&#x8005;</li><li>libcontainer &#x7684;&#x4F5C;&#x8005;</li><li>nsinit &#x7684;&#x4F5C;&#x8005;</li><li>runc &#x7684;&#x4F5C;&#x8005;</li><li>containerd &#x7684;&#x4F5C;&#x8005;</li><li>OCI &#x7684;maintainer</li></ul><h1 id="man-containerd"><a href="#gt-man-containerd" class="headerlink" title="&gt; man containerd"></a>&gt; man containerd <a href="#man-containerd" class="header-anchor">#</a></h1><ul><li><p>&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x5BB9;&#x5668; supervisor</p><ul><li>&#x5F88;&#x591A;&#x4EBA;&#x8BF4;&#x8FD9;&#x662F;&#x5728;&#x53D6;&#x4EE3; systemd&#xFF0C;&#x4E0D;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E13;&#x6CE8;&#x4E8E;&#x5BB9;&#x5668;</li></ul></li><li><p>runC (OCI) multiplexer</p><ul><li>&#x867D;&#x7136;&#x53EB;containerd&#xFF0C;&#x4F46;&#x662F;&#x771F;&#x6B63;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#x662F;runC(OCI)&#x5C42;</li></ul></li><li><p>&#x5BB9;&#x5668;&#x751F;&#x5B58;&#x5468;&#x671F;&#x64CD;&#x4F5C;</p></li></ul><h1 id="why"><a href="#gt-why" class="headerlink" title="&gt; why"></a>&gt; why <a href="#why" class="header-anchor">#</a></h1><ul><li>&#x96C6;&#x6210; runc</li><li>&#x652F;&#x6301;&#x591A;&#x4E2A; runtime</li><li>Execution v2</li><li>&#x5206;&#x79BB;&#x6267;&#x884C;&#x673A;&#x6784;&#x548C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li>daemonless &#x5BB9;&#x5668;</li><li>&#x66F4;&#x5E72;&#x51C0;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;</li></ul><h1 id="benchmarks"><a href="#Benchmarks" class="headerlink" title="Benchmarks"></a>Benchmarks <a href="#benchmarks" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./benchmark -count 100</span><br><span class="line">INFO[0001] 1.149902846 seconds</span><br></pre></td></tr></table></figure><p>&#x6D4B;&#x8BD5;containerd:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo containerd &#x2014;debug` &#x7136;&#x540E;&#x53E6;&#x4E00;&#x8FB9;&#x8FD0;&#x884C; `sudo ./benchmark -count 100</span><br></pre></td></tr></table></figure><h1 id="events"><a href="#events" class="headerlink" title="events"></a>events <a href="#events" class="header-anchor">#</a></h1><ul><li><p>&#x65E0;&#x9501; event loop</p></li><li><p>&#x5E76;&#x53D1;&#x63A7;&#x5236;</p><ul><li>&#x4E00;&#x6B21;&#x5E76;&#x53D1;10&#x4E2A;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x5E76;&#x53D1;100&#x4E2A;&#x66F4;&#x5FEB;&#x3002;</li></ul></li></ul><h1 id="daemonless"><a href="#gt-daemonless" class="headerlink" title="&gt; daemonless"></a>&gt; daemonless <a href="#daemonless" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#x9700;&#x6C42;&#xFF0C;Docker&#x5347;&#x7EA7;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x6B21;&#x5347;&#x7EA7;&#x6240;&#x6709;&#x7684;&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x88AB;kill&#x6389;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x66F4;&#x5E73;&#x6ED1;&#x7684;&#x5347;&#x7EA7;&#x65B9;&#x5F0F;&#xFF0C;&#x5347;&#x7EA7;Docker&#x4E0D;&#x4F1A;&#x8BA9;&#x5BB9;&#x5668;&#x6B7B;&#x6389;&#x3002;</p><h2 id="container-state"><a href="#gt-container-state" class="headerlink" title="&gt; container state"></a>&gt; container state <a href="#container-state" class="header-anchor">#</a></h2><ul><li>&#x6700;&#x7B80;&#x5355;&#x7684;&#x7BA1;&#x7406;&#x72B6;&#x6001;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x8BA9;&#x5BB9;&#x5668;&#x6CA1;&#x6709;&#x72B6;&#x6001;</li><li>&#x5185;&#x5B58;&#x91CC;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x4FDD;&#x5B58;</li><li>/run &#x662F;&#x4F60;&#x7684;&#x597D;&#x670B;&#x53CB;</li></ul><p>&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981; pid &#x548C; path &#x6307;&#x5411;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x5373;&#x53EF;&#x6062;&#x590D;&#x6240;&#x6709;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x7ED3;&#x6784;&#x53BB;&#x4FDD;&#x5B58;&#x8FD9;&#x4E9B;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x3002;</p><h2 id="daemonless-problems"><a href="#gt-daemonless-problems" class="headerlink" title="&gt; daemonless problems"></a>&gt; daemonless problems <a href="#daemonless-problems" class="header-anchor">#</a></h2><ul><li>&#x9000;&#x51FA;&#x4EE3;&#x7801;&#x548C;wait4()</li><li>tty / stdio</li><li>reparenting</li><li>facilitated by a shim</li></ul><h3 id="containerd-shim"><a href="#gt-containerd-shim" class="headerlink" title="&gt; containerd-shim"></a>&gt; containerd-shim <a href="#containerd-shim" class="header-anchor">#</a></h3><blockquote><p><code>containerd</code> &#x2192; <code>&#x591A;&#x4E2A; shim</code> &#x2192; <code>&#x6BCF;&#x4E2A; shim</code> &#x5BF9;&#x5E94; <code>&#x4E00;&#x4E2A; runc</code></p></blockquote><p><code>shim</code> &#x89E3;&#x51B3;&#x4E86; <code>tty</code> / <code>stdio</code> &#x548C; <code>reparenting</code> &#x95EE;&#x9898;</p><h3 id="exit-status"><a href="#gt-exit-status" class="headerlink" title="&gt; exit status"></a>&gt; exit status <a href="#exit-status" class="header-anchor">#</a></h3><ul><li><p>FIFO for blocking + file</p><ul><li>fifo (Pipe with inode) for exit event</li><li>file for exit status</li></ul></li><li><p>O_CLOEXEC</p></li><li><p>RDONLY/WRONLY</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mkfifo(&#x201C;<span class="built_in">exit</span>-fifo&#x201D;, <span class="number">0666</span>) != <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">printf</span>(&#x201C;%s\n&#x201D;, strerror(errno));</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> fd = open(&#x201C;<span class="built_in">exit</span>-fifo&#x201D;, O_WRONLY | O_CLOEXEC, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="stdio"><a href="#gt-stdio" class="headerlink" title="&gt; stdio"></a>&gt; stdio <a href="#stdio" class="header-anchor">#</a></h3><ul><li><p>FIFOs for data</p></li><li><p>fifos have a buffer (default 64k)</p><ul><li>/proc/sys/fs/pipe-max-size</li></ul></li></ul><h3 id="re-parenting"><a href="#gt-re-parenting" class="headerlink" title="&gt; re-parenting"></a>&gt; re-parenting <a href="#re-parenting" class="header-anchor">#</a></h3><blockquote><p><code>shim</code> &#x2192; <code>runc</code> &#x2192; <code>container</code></p></blockquote><p>&#x5F53; <code>runc</code> &#x9000;&#x51FA;&#x540E;&#xFF0C;<code>container</code> &#x53EF;&#x4EE5; <code>reparent</code> &#x5230; <code>shim</code>&#x3002;</p><h4 id="re-parenting-rules"><a href="#gt-re-parenting-rules" class="headerlink" title="&gt; re-parenting rules"></a>&gt; re-parenting rules <a href="#re-parenting-rules" class="header-anchor">#</a></h4><ul><li>&#x4F60;&#x7684; <code>parent</code> &#x662F; <code>fork</code> &#x4F60;&#x7684;&#x8FDB;&#x7A0B;</li><li>&#x5982;&#x679C;&#x4F60;&#x7684; <code>parent</code> die&#xFF0C;&#x4F60;&#x65B0;&#x7684;<code>parent</code>&#x662F; <code>PID 1</code></li></ul><p>&#x5728; 3.4 &#x4E4B;&#x524D;&#xFF0C;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x662F; 3.4 &#x4E4B;&#x540E;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E2A; <code>subreaper</code></p><ul><li><code>prctl</code> - <code>PR_SET_CHILD_SUBREAPER</code></li><li>&#x201C;In effect, a subreaper fulfills the role of init(1) for its descendant processes.&#x201D;</li></ul><p>&#x6240;&#x4EE5;&#x50CF;&#x521A;&#x624D;&#x8BF4;&#x7684;&#x60C5;&#x51B5;&#xFF0C;<code>shim</code> &#x2192; <code>runc</code> &#x2192; <code>container</code>&#xFF0C;&#x5982;&#x679C;<code>runc</code>&#x9000;&#x51FA;&#xFF0C;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#xFF0C;<code>container</code> &#x5C06;&#x4F1A;&#x6210;&#x4E3A; <code>init</code> (<code>pid:1</code>) &#x7684;<code>child</code>&#xFF0C;&#x800C;<code>shim</code>&#x4F7F;&#x7528;&#x4E86;<code>subreaper</code> &#x540E;&#xFF0C;&#x5C06;&#x4F1A;&#x622A;&#x65AD;&#x8FD9;&#x4E2A;&#x6536;&#x517B;&#x8FDB;&#x7A0B;&#x7684;&#x4E0A;&#x6EAF;&#x8FC7;&#x7A0B;&#xFF0C;<code>shim</code> &#x5C06;&#x6210;&#x4E3A; <code>container</code> &#x7684;&#x65B0; <code>parent</code>&#x3002;</p><h2 id="the-oom-problem"><a href="#gt-The-OOM-problem" class="headerlink" title="&gt; The OOM problem"></a>&gt; The OOM problem <a href="#the-oom-problem" class="header-anchor">#</a></h2><p>&#x5982;&#x4F55;&#x5728;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x524D;&#x8FDE;&#x63A5;&#x5230; OOM (<code>Out of Memory</code>) &#x901A;&#x77E5;</p><h3 id="runtime-workflow"><a href="#gt-runtime-workflow" class="headerlink" title="&gt; runtime workflow"></a>&gt; runtime workflow <a href="#runtime-workflow" class="header-anchor">#</a></h3><ul><li><p><code>create</code></p><ul><li>&#x521D;&#x59CB;&#x5316;<code>namespace</code>&#x548C;&#x914D;&#x7F6E;</li></ul></li><li><p><code>start</code></p><ul><li>&#x6267;&#x884C;&#x7528;&#x6237;&#x8FDB;&#x7A0B;</li></ul></li><li><p><code>delete</code></p><ul><li>&#x5220;&#x9664;&#x5BB9;&#x5668;</li></ul></li></ul><p>&#x8FD9;&#x6837;&#x5728; <code>create</code> &#x548C; <code>start</code> &#x4E2D;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;&#x5904;&#x7406;&#x4E8B;&#x52A1;&#x7684;&#x673A;&#x4F1A;&#xFF0C;&#x5305;&#x62EC;&#x5904;&#x7406; <code>OOM</code> &#x7684;&#x60C5;&#x51B5;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runc create <span class="built_in">test</span></span><br><span class="line">runc list</span><br><span class="line">runc start <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h1 id="yan-shi-dai-ma"><a href="#&#x6F14;&#x793A;&#x4EE3;&#x7801;" class="headerlink" title="&#x6F14;&#x793A;&#x4EE3;&#x7801;"></a>&#x6F14;&#x793A;&#x4EE3;&#x7801; <a href="#yan-shi-dai-ma" class="header-anchor">#</a></h1><p><a href="https://github.com/crosbymichael/dockercon-2016" target="_blank" rel="noopener">https://github.com/crosbymichael/dockercon-2016</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 开发环境 - 第二讲 - Borja Burgos</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-2.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-2.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.619Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#docker-cloud-gou-jian-bu-shu-yun-xing">Docker Cloud: &#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C;</a></li><li><a href="#automation">Automation</a></li><li><a href="#collaboration">Collaboration</a></li><li><a href="#demo">Demo</a><ul><li><a href="#staging">Staging</a></li><li><a href="#production">Production</a></li></ul></li><li><a href="#kai-shi-yan-shi">&#x5F00;&#x59CB;&#x6F14;&#x793A;</a><ul><li><a href="#shou-xian-fu-yu-xin-yuan-gong-docker-cloud-quan-xian">&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5; docker cloud &#x6743;&#x9650;</a></li><li><a href="#fernando-jie-shou-xiu-gai-gong-zuo">Fernando &#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C;</a></li><li><a href="#boss-borja-guo-lai-cha-kan-gong-zuo-fa-xian-ce-shi-shi-bai">Boss (Borja) &#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;</a></li><li><a href="#fernando-xiu-gai-dai-ma-yi-man-zu-ce-shi-xu-qiu">Fernando &#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;</a></li><li><a href="#docker-cloud-jin-xing-jing-xiang-gou-jian-bing-zi-dong-bu-shu">Docker Cloud &#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72;</a></li><li><a href="#zai-bu-shu-dao-sheng-chan-huan-jing-qian-jin-xing-an-quan-jian-cha">&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;</a></li></ul></li><li><a href="#wen-da">&#x95EE;&#x7B54;</a><ul><li><a href="#q-wo-xiang-zhi-dao-ni-men-shi-zen-me-jie-jue-mi-yao-mi-ma-lei-de-wen-ti-bi-ru-zai-gang-cai-de-li-zi-zhong-staging-de-fu-wu-bu-shu-xiang-guan-de-mi-ma-bi-ran-he-sheng-chan-huan-jing-bu-tong-er-zhe-xie-ken-ding-bu-hui-fang-dao-dai-ma-zhong-na-me-ni-men-zen-me-jie-jue-zhe-ge-wen-ti-de">Q: &#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging &#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F;</a></li><li><a href="#q-li-zi-zhong-yan-shi-de-ke-yi-tian-jia-zu-zhi-ji-cheng-yuan-zhe-xie-gong-neng-shi-me-shi-hou-ke-yi-ga-gei-da-jia-yong">Q: &#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker for Developers - Part 2<br>by Borja Burgos, Fernando Mayo</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/ZsIb5tkyncA" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=ZsIb5tkyncA" target="_blank" rel="noopener">https://www.youtube.com/watch?v=ZsIb5tkyncA</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=j0314zhu619&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/j0314zhu619.html" target="_blank" rel="noopener">http://v.qq.com/x/page/j0314zhu619.html</a></p><h1 id="docker-cloud-gou-jian-bu-shu-yun-xing"><a href="#Docker-Cloud-&#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C;" class="headerlink" title="Docker Cloud: &#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C;"></a>Docker Cloud: &#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C; <a href="#docker-cloud-gou-jian-bu-shu-yun-xing" class="header-anchor">#</a></h1><ul><li><p>&#x6784;&#x5EFA;</p><ul><li>Docker Builds</li><li>Integration Tests</li><li>Privacy controls</li><li>Parallelism</li><li>Official Images</li></ul></li><li><p>&#x90E8;&#x7F72;</p><ul><li>&#x516C;&#x5171; registry</li><li>&#x79C1;&#x6709; repositories</li><li>&#x5B89;&#x5168;&#x626B;&#x63CF;</li><li>&#x591A;&#x6784;&#x67B6;</li></ul></li><li><p>&#x8FD0;&#x884C;</p><ul><li>&#x6784;&#x67B6; agnostic</li><li>overlay network</li><li>&#x670D;&#x52A1;&#x53D1;&#x73B0;</li><li>&#x4E00;&#x952E;&#x5347;&#x7EA7;</li><li>&#x5BB9;&#x6613;&#x6269;&#x5C55;</li></ul></li></ul><h1 id="automation"><a href="#Automation" class="headerlink" title="Automation"></a>Automation <a href="#automation" class="header-anchor">#</a></h1><p>&#x4F7F;&#x7528; <code>Docker Cloud</code> &#xFF0C;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x4ECE; <code>CI</code> &#x5230; <code>CD</code> &#x7684;&#x5168;&#x7A0B;&#x81EA;&#x52A8;&#x5316;&#x8FC7;&#x7A0B;&#x3002;</p><h1 id="collaboration"><a href="#Collaboration" class="headerlink" title="Collaboration"></a>Collaboration <a href="#collaboration" class="header-anchor">#</a></h1><p>&#x4F7F;&#x7528; <code>Docker Cloud</code> &#x53EF;&#x4EE5;&#x8BA9;&#x56E2;&#x961F;&#x5728;&#x4E91;&#x73AF;&#x5883;&#x534F;&#x4F5C; <code>CI</code>/<code>CD</code></p><h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF0C;&#x4E00;&#x4E2A;&#x516C;&#x53F8;&#x53EB;&#x505A; <code>Cloudvote</code>&#x3002;&#x9700;&#x8981;&#x5BF9;&#x5206;&#x6B65;<code>CI</code>/<code>CD</code>&#x3002;</p><h2 id="staging"><a href="#Staging" class="headerlink" title="Staging"></a>Staging <a href="#staging" class="header-anchor">#</a></h2><blockquote><p><code>&#x81EA;&#x52A8;&#x6784;&#x5EFA;</code> &#x2192; <code>&#x6D4B;&#x8BD5;</code> &#x2192; <code>&#x5B89;&#x5168;&#x626B;&#x63CF;</code> &#x2192; <code>&#x91CD;&#x65B0;&#x90E8;&#x7F72;</code></p></blockquote><p>&#x4EE3;&#x7801;&#x5B58;&#x50A8;&#x4E8E; <code>GitHub</code> &#x7684; <code>staging</code> &#x5206;&#x652F;&#x4E2D;&#xFF0C;{<code>/worker</code>, <code>/result-app</code>, <code>/voting-app</code>}&#xFF0C;&#x4ECE; <code>git push</code> &#x5F00;&#x59CB;&#xFF0C;&#x81EA;&#x52A8;&#x6784;&#x5EFA;&#xFF0C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x4E14;<code>push</code>&#x4E3A; <code>cloudvote</code>/{<code>worker</code>,<code>result-app</code>,<code>voting-app</code>}:<code>staging</code>&#xFF0C;&#x7136;&#x540E;&#x90E8;&#x7F72;&#x5230; D<code>igital Ocean</code> 2&#x8282;&#x70B9;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#x53BB;&#x8FD0;&#x884C;&#x3002;&#x5168;&#x90E8;&#x81EA;&#x52A8;&#x5316;&#x8FD0;&#x884C;&#x3002;</p><h2 id="production"><a href="#Production" class="headerlink" title="Production"></a>Production <a href="#production" class="header-anchor">#</a></h2><blockquote><p><code>&#x81EA;&#x52A8;&#x6784;&#x5EFA;</code> &#x2192; <code>&#x6D4B;&#x8BD5;</code> &#x2192; <code>&#x5B89;&#x5168;&#x626B;&#x63CF;</code></p></blockquote><p>&#x4EE3;&#x7801;&#x5B58;&#x50A8;&#x4E8E; <code>GitHub</code> &#x7684; <code>master</code> &#x5206;&#x652F;&#xFF0C;&#x6784;&#x5EFA;&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#x540E;&#xFF0C;&#x6807;&#x8BB0;&#x4E3A; <code>:latest</code>&#xFF0C;&#x7136;&#x540E;&#x90E8;&#x7F72;&#x5230; <code>AWS</code> &#x7684;5&#x8282;&#x70B9;&#x53BB;&#x8FD0;&#x884C;&#x3002;</p><h1 id="kai-shi-yan-shi"><a href="#&#x5F00;&#x59CB;&#x6F14;&#x793A;" class="headerlink" title="&#x5F00;&#x59CB;&#x6F14;&#x793A;"></a>&#x5F00;&#x59CB;&#x6F14;&#x793A; <a href="#kai-shi-yan-shi" class="header-anchor">#</a></h1><h2 id="shou-xian-fu-yu-xin-yuan-gong-docker-cloud-quan-xian"><a href="#&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5;-docker-cloud-&#x6743;&#x9650;" class="headerlink" title="&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5; docker cloud &#x6743;&#x9650;"></a>&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5; docker cloud &#x6743;&#x9650; <a href="#shou-xian-fu-yu-xin-yuan-gong-docker-cloud-quan-xian" class="header-anchor">#</a></h2><p>&#x8BBF;&#x95EE; <a href="https://cloud.docker.com" target="_blank" rel="noopener">https://cloud.docker.com</a> &#xFF0C;&#x767B;&#x5F55;&#x540E;&#x9009;&#x62E9; <code>cloudvote app</code> &#x2192; <code>Teams</code> &#x2192; <code>&#x6DFB;&#x52A0;&#x7528;&#x6237;</code> &#x3002;&#x8FD9;&#x6837;&#x8BE5;&#x7528;&#x6237;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE; <a href="https://cloud.docker.com" target="_blank" rel="noopener">https://cloud.docker.com</a> &#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x9879;&#x76EE;&#x4E86;&#x3002;</p><h2 id="fernando-jie-shou-xiu-gai-gong-zuo"><a href="#Fernando-&#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C;" class="headerlink" title="Fernando &#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C;"></a>Fernando &#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C; <a href="#fernando-jie-shou-xiu-gai-gong-zuo" class="header-anchor">#</a></h2><p>Fernando &#x5F00;&#x59CB;&#x65B0;&#x7684;&#x5DE5;&#x4F5C;&#x540E;&#xFF0C;&#x5148;&#x53BB; <code>Github</code> &#x770B;&#x4E00;&#x4E0B; <code>issue</code>&#x3002; &#x53D1;&#x73B0;&#x4E86;&#x65B0;&#x7684; <code>issue #2</code>&#xFF0C;&#x8981;&#x6C42;&#x628A; <code>Dog</code> &#x548C; <code>Cats</code> &#x6362;&#x4E3A;<code>&#x1F431;</code>&#x548C;<code>&#x1F436;</code>&#x4E24;&#x4E2A;emoji&#x3002;&#x597D;&#x5427;&#xFF0C;&#x5148; <code>fork</code> &#x8FD9;&#x4E2A; <code>repository</code>&#xFF0C;&#x7136;&#x540E; <code>clone</code> &#x5230;&#x672C;&#x5730;&#x3002;</p><p>&#x5148;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;&#x662F;&#x5426;&#x5982;&#x671F;&#x671B;&#x4E00;&#x822C;&#x5DE5;&#x4F5C;&#xFF0C;&#x7531;&#x4E8E;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x4E86; <code>Docker for Mac</code>&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x8FD0;&#x884C; <code>docker-compose up</code> &#xFF0C;&#x7136;&#x540E;&#x8BBF;&#x95EE; <code>localhost:5000</code> &#x548C; <code>localhost:5001</code> &#x770B;&#x7ED3;&#x679C;&#xFF0C;&#x55EF;&#xFF0C;&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</p><p>&#x7136;&#x540E;&#x5F00;&#x59CB;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x5148;&#x53BB; <a href="http://apps.timwhitlock.info/emoji/tables/unicode" target="_blank" rel="noopener">http://apps.timwhitlock.info/emoji/tables/unicode</a> &#x4E2D;&#x641C;&#x7D22;&#x5230; <code>dog face</code> &#x7684;emoji unicode&#x3002;&#x7136;&#x540E;&#x6253;&#x5F00; <code>instavote-app/result-app/views/index.html</code> &#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684; <code>Dogs</code>  &#x548C; <code>Cats</code> &#xFF0C;&#x6539;&#x53D8;&#x4E3A; Unicode &#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x503C;&#x3002;</p><p>&#x4F5C;&#x4E3A;&#x989D;&#x5916;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;Fernando &#x628A; Dog vote &#x63D0;&#x9AD8;&#x4E86;&#x4E00;&#x500D;&#xFF0C;&#x7136;&#x540E;&#x589E;&#x52A0;&#x4E86; <code>libxml2</code> &#x4F5C;&#x4E3A;&#x66F4;&#x597D;&#x7684;xml&#x652F;&#x6301;&#x3002;</p><p>&#x7136;&#x540E;&#xFF0C;<code>git diff</code> &#x68C0;&#x67E5;&#x53D8;&#x66F4;&#xFF0C;<code>git add .</code> &#x6DFB;&#x52A0;&#x4FEE;&#x6539;&#xFF0C;<code>git checkout -b myfeat</code> <code>&#x5C06;&#x5F53;&#x524D;staging</code> &#x4FEE;&#x6539;&#x7F6E;&#x4E8E; <code>myfeat</code> &#x5206;&#x652F;&#xFF0C;&#x7136;&#x540E; <code>git commit -m &#x201C;Awesome feature&#x201D;</code> &#x6765;&#x63D0;&#x4EA4;&#x4FEE;&#x6539;&#xFF0C;&#x7136;&#x540E; <code>git push origin my feat</code> &#x63D0;&#x4EA4;&#x53D8;&#x66F4;&#x3002;</p><p>&#x56DE;&#x5230; <code>github</code>&#xFF0C;&#x7136;&#x540E;&#x770B;&#x5230;&#x65B0;&#x7684;&#x5206;&#x652F;&#x5DF2;&#x7ECF;&#x4E0A;&#x6765;&#x4E86;&#xFF0C;&#x70B9;&#x51FB; <code>Compare &amp; Pull Request</code>&#xFF0C;&#x6765;&#x63D0;&#x4EA4;<code>PR</code>&#x3002; &#x9009;&#x62E9; <code>target</code> &#x4E3A; <code>staging</code> &#x5206;&#x652F;&#xFF0C;&#x70B9;&#x51FB;&#x63D0;&#x4EA4;&#xFF0C;&#x597D;&#x4E86;&#xFF0C;&#x5B8C;&#x4E8B;&#x513F;&#x4E86;&#x3002;&#x597D;&#x50CF;&#x6709;&#x4E9B;&#x4EC0;&#x4E48;<code>test</code>&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x65E0;&#x6240;&#x8C13;&#x4E86;&#xFF0C;&#x4E0D;&#x7BA1;&#x4E86;&#xFF0C;&#x7136;&#x540E; Fernando &#x901A;&#x77E5;&#x4E86;boss&#xFF0C;&#x5DE5;&#x4F5C;&#x505A;&#x5B8C;&#x4E86;&#x3002;</p><h2 id="boss-borja-guo-lai-cha-kan-gong-zuo-fa-xian-ce-shi-shi-bai"><a href="#Boss-Borja-&#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;" class="headerlink" title="Boss (Borja) &#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;"></a>Boss (Borja) &#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25; <a href="#boss-borja-guo-lai-cha-kan-gong-zuo-fa-xian-ce-shi-shi-bai" class="header-anchor">#</a></h2><p>Borja &#x56DE;&#x6765;&#x8FDB;&#x4E00;&#x6B65;&#x89E3;&#x91CA; <code>test</code> &#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x3002;&#x6253;&#x5F00; <code>docker-compose.test.yml</code>&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x53EB;&#x505A; <code>sut</code> - system under test&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x3002;</p><p>&#x6253;&#x5F00;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;&#xFF0C;<code>test.sh</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x8BD5;&#x56FE;&#x5224;&#x65AD;vote&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;</p><p>&#x89E3;&#x91CA;&#x540E;&#x56DE;&#x5230; <code>github</code> &#x9875;&#x9762;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#x4E86;&#xFF0C;Borja &#x8D28;&#x95EE;&#x4E3A;&#x5565;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x5931;&#x8D25;&#x4E86;&#x5462;&#xFF1F;Fernando&#x8BF4;&#xFF0C;&#x6211;&#x8FD8;&#x52A0;&#x4E86;&#x589E;&#x5F3A;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;&#x7ED9; dog x2 &#x7684;vote&#x3002;boss &#x663E;&#x7136;&#x4E0D;&#x540C;&#x610F;&#x8FD9;&#x79CD;&#x4E0D;&#x516C;&#x5E73;&#x7684;&#x5BF9;&#x5F85;&#xFF0C;&#x8981;&#x6C42;&#x5220;&#x9664;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x3002;</p><h2 id="fernando-xiu-gai-dai-ma-yi-man-zu-ce-shi-xu-qiu"><a href="#Fernando-&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;" class="headerlink" title="Fernando &#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;"></a>Fernando &#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42; <a href="#fernando-xiu-gai-dai-ma-yi-man-zu-ce-shi-xu-qiu" class="header-anchor">#</a></h2><p>&#x4E8E;&#x662F; Fernando &#x56DE;&#x5230;&#x4EE3;&#x7801;&#x7F16;&#x8F91;&#x5668;&#x4E2D;&#xFF0C;&#x5220;&#x6389;&#x8FD9;&#x90E8;&#x5206; code&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0; <code>git diff</code>, <code>git add .</code>, <code>git commit &#x2014;amend</code>, <code>git push &#x2014;force origin my feat</code>&#x3002;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>docker cloud</code> &#x5DF2;&#x7ECF;&#x88AB;&#x901A;&#x77E5;&#x6709;&#x65B0;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x4E8E;&#x662F;&#x5F00;&#x59CB;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x6D4B;&#x8BD5;&#x4E86;&#x3002;</p><h2 id="docker-cloud-jin-xing-jing-xiang-gou-jian-bing-zi-dong-bu-shu"><a href="#Docker-Cloud-&#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72;" class="headerlink" title="Docker Cloud &#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72;"></a>Docker Cloud &#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72; <a href="#docker-cloud-jin-xing-jing-xiang-gou-jian-bing-zi-dong-bu-shu" class="header-anchor">#</a></h2><p><code>Docker cloud</code> &#x53EF;&#x4EE5;&#x5728;&#x516C;&#x6709;&#x4E91;&#x6216;&#x8005;&#x79C1;&#x6709;&#x4E91;&#x4E2D;&#x8FD0;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301; <code>github</code> &#x548C; <code>bitbucket</code>&#x3002;</p><p>&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#x540E;&#xFF0C;&#x70B9;&#x51FB; <code>merge</code> &#x5408;&#x5E76;&#x5230; <code>staging</code> &#x5206;&#x652F;&#x4E2D;&#x3002;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x81EA;&#x52A8;&#x5316;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x89E6;&#x53D1; Docker Cloud &#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;Docker &#x4F1A;&#x81EA;&#x52A8;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x955C;&#x50CF;&#x3002;</p><p>&#x5728; <code>Staging</code> &#x7684; <code>Service Stack</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>Result-app</code> &#x7684; <code>AutoDeploy</code> &#x7684;&#x72B6;&#x6001;&#x662F; <code>ON</code>&#xFF0C;&#x8BF4;&#x660E;&#x6784;&#x5EFA;&#x6210;&#x529F;&#x4F1A;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;</p><p>Docker Cloud &#x8FD8;&#x96C6;&#x6210;&#x5230;&#x4E86; <code>Slack</code> &#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x6784;&#x5EFA;&#x4FE1;&#x606F;&#x7B49;&#x90FD;&#x4F1A;&#x5728; <code>slack</code> &#x91CC;&#x770B;&#x5230;&#x3002;&#x53EF;&#x4EE5;&#x5728; <code>#dockercloud</code> channel &#x4E2D;&#x770B;&#x5230;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#x3001;&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x3001;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x90E8;&#x7F72;&#x7B49;&#x4FE1;&#x606F;&#x3002;</p><p>&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; Docker Cloud &#x4E2D;&#x63D0;&#x4F9B;&#x7684; url &#x8BBF;&#x95EE;&#x5BF9;&#x5E94;&#x5E94;&#x7528;&#x8FDE;&#x63A5;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x7ED3;&#x679C;&#x3002;</p><h2 id="zai-bu-shu-dao-sheng-chan-huan-jing-qian-jin-xing-an-quan-jian-cha"><a href="#&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;" class="headerlink" title="&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;"></a>&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5; <a href="#zai-bu-shu-dao-sheng-chan-huan-jing-qian-jin-xing-an-quan-jian-cha" class="header-anchor">#</a></h2><p>&#x5728; Docker Cloud &#x4E2D;&#x70B9;&#x51FB; <code>repository</code> &#x2192; <code>Result-app</code> &#x2192; <code>Tags</code> &#xFF08;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x754C;&#x9762;&#xFF09;</p><p>&#x770B;&#x5230;&#x65B0;&#x7684; Image &#x88AB;&#x626B;&#x63CF;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x4E86; <code>libxml2</code> &#x5B58;&#x5728;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x8FD9;&#x662F; Fernando &#x6DFB;&#x52A0;&#x7684;&#x65B0;&#x7684;&#x4F9D;&#x8D56;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x670D;&#x52A1;&#x53BB;&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x89E3;&#x51B3;&#x5B89;&#x5168;&#x9690;&#x60A3;&#x95EE;&#x9898;&#x3002;</p><h1 id="wen-da"><a href="#&#x95EE;&#x7B54;" class="headerlink" title="&#x95EE;&#x7B54;"></a>&#x95EE;&#x7B54; <a href="#wen-da" class="header-anchor">#</a></h1><h2 id="q-wo-xiang-zhi-dao-ni-men-shi-zen-me-jie-jue-mi-yao-mi-ma-lei-de-wen-ti-bi-ru-zai-gang-cai-de-li-zi-zhong-staging-de-fu-wu-bu-shu-xiang-guan-de-mi-ma-bi-ran-he-sheng-chan-huan-jing-bu-tong-er-zhe-xie-ken-ding-bu-hui-fang-dao-dai-ma-zhong-na-me-ni-men-zen-me-jie-jue-zhe-ge-wen-ti-de"><a href="#Q-&#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging-&#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F;" class="headerlink" title="Q: &#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging &#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F;"></a>Q: &#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging &#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F; <a href="#q-wo-xiang-zhi-dao-ni-men-shi-zen-me-jie-jue-mi-yao-mi-ma-lei-de-wen-ti-bi-ru-zai-gang-cai-de-li-zi-zhong-staging-de-fu-wu-bu-shu-xiang-guan-de-mi-ma-bi-ran-he-sheng-chan-huan-jing-bu-tong-er-zhe-xie-ken-ding-bu-hui-fang-dao-dai-ma-zhong-na-me-ni-men-zen-me-jie-jue-zhe-ge-wen-ti-de" class="header-anchor">#</a></h2><p>A: &#x6240;&#x6709;&#x7684; secret &#x90FD;&#x5B58;&#x50A8;&#x4E8E; docker cloud&#xFF0C;&#x955C;&#x50CF;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x91CC;&#x9762;&#x4E0D;&#x5305;&#x542B;&#x5BC6;&#x7801;&#x7C7B;&#x4FE1;&#x606F;&#xFF0C;&#x4ED6;&#x4EEC;&#x5E94;&#x8BE5;&#x662F;&#x72EC;&#x7ACB;&#x4E8E;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7684;&#xFF0C;&#x5728;&#x4EFB;&#x4F55;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x90FD;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x3002;</p><h2 id="q-li-zi-zhong-yan-shi-de-ke-yi-tian-jia-zu-zhi-ji-cheng-yuan-zhe-xie-gong-neng-shi-me-shi-hou-ke-yi-ga-gei-da-jia-yong"><a href="#Q-&#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F;" class="headerlink" title="Q: &#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F;"></a>Q: &#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F; <a href="#q-li-zi-zhong-yan-shi-de-ke-yi-tian-jia-zu-zhi-ji-cheng-yuan-zhe-xie-gong-neng-shi-me-shi-hou-ke-yi-ga-gei-da-jia-yong" class="header-anchor">#</a></h2><p>A: &#x73B0;&#x5728;&#x662F;&#x5185;&#x90E8; beta &#x6D4B;&#x8BD5;&#xFF0C;&#x5F88;&#x5FEB;&#x4F1A;&#x5F00;&#x653E;&#x51FA;&#x6765;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 开发环境 - 第一讲 - David Gageot</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-1.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-1.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.618Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#yan-shi">&#x6F14;&#x793A;</a></li><li><a href="#application-bundle">Application Bundle</a></li><li><a href="#wen-da">&#x95EE;&#x7B54;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker for Developer - Part 1<br>by David Gageot</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/SK0sqfVn7ls" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=SK0sqfVn7ls" target="_blank" rel="noopener">https://www.youtube.com/watch?v=SK0sqfVn7ls</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=l03143jinsh&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/l03143jinsh.html" target="_blank" rel="noopener">http://v.qq.com/x/page/l03143jinsh.html</a></p><h1 id="yan-shi"><a href="#&#x6F14;&#x793A;" class="headerlink" title="&#x6F14;&#x793A;"></a>&#x6F14;&#x793A; <a href="#yan-shi" class="header-anchor">#</a></h1><p><code>docker-compose up -d</code> &#x540E;&#xFF0C;&#x6240;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x4F1A;&#x51FA;&#x73B0;&#x5728; <code>localhost</code> &#x4E0A;&#xFF0C;&#x8FD9;&#x662F;&#x5728; Linux &#x4E16;&#x754C;&#x5F88;&#x6B63;&#x5E38;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x56E0;&#x4E3A;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x3002;&#x800C;&#x5728;&#x8FC7;&#x53BB;&#x7684; Docker Toolbox &#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x4F7F;&#x7528; boot2docker &#x8FD9;&#x4E2A;virtualbox &#x865A;&#x62DF;&#x673A;&#x7684;IP - <code>192.168.99.100</code> &#x6765;&#x8BBF;&#x95EE;&#xFF0C;&#x73B0;&#x5728;&#x7ECF;&#x8FC7;&#x5F88;&#x590D;&#x6742;&#x7684;&#x5E95;&#x5C42;&#x5904;&#x7406; (VPNkit)&#xFF0C;&#x4E00;&#x5207;&#x90FD;&#x53D8;&#x5F97;&#x50CF; Linux &#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x672C;&#x673A;&#x5730;&#x5740;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p><p>&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x4EE5;&#x524D;&#x867D;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4E2D;&#x95F4;&#x9694;&#x4E86;&#x4E00;&#x5C42; Virtualbox &#xFF0C;&#x5F88;&#x591A;&#x529F;&#x80FD;&#xFF0C;&#x5982; fs notification &#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982; Live Reload&#x3002;&#x73B0;&#x5728;&#x901A;&#x8FC7; <code>OSXfs</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x73B0;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x5F00;&#x542F; Live Relaod &#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x82F9;&#x679C;&#x4E0A;&#xFF0C;&#x7528;&#x4E60;&#x60EF;&#x7684;&#x7F16;&#x8F91;&#x5668;&#x7F16;&#x8F91;&#x4EE3;&#x7801;&#xFF0C;&#x6BD4;&#x5982;CSS&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x5B58;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x53D8;&#x5316;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><p>&#x73B0;&#x5728;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x505A;&#x7684;&#x662F;&#x52A8;&#x6001;&#x8C03;&#x8BD5;&#x3002;&#x4E4B;&#x524D;<code>Keynote</code>&#x4E2D;&#x6F14;&#x793A;&#x4E86;&#x7528; <code>Visual Studio Code</code> &#x8C03;&#x8BD5; <code>Docker</code> &#x5185;&#x8FD0;&#x884C;&#x7684; <code>Node.js</code> &#x5E94;&#x7528;&#x3002;&#x8FD9;&#x6B21; David &#x6F14;&#x793A;&#x4E86;&#x8C03;&#x8BD5; Java &#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x4E14;&#x6F14;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x5177;&#x4F53;&#x8BBE;&#x7F6E;&#x3002;</p><p>Java &#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x8C03;&#x8BD5;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x5141;&#x8BB8;IDE&#x6765;&#x8FDE;&#x63A5;&#x8FD0;&#x884C;&#x7684;&#x5E94;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528; 5005 &#x7AEF;&#x53E3;&#x3002;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x662F;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#x7684;&#xFF1F;&#x6253;&#x5F00; IDE (<code>IntelliJ</code>) <code>Run/Debug Configuration</code>&#xFF0C;&#x70B9;&#x5DE6;&#x4E0A;&#x89D2;&#x2795;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x8C03;&#x8BD5;&#x914D;&#x7F6E; - <code>Remote</code>&#xFF0C;&#x7136;&#x540E;&#x81EA;&#x52A8;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x4F1A;&#x663E;&#x793A;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x91CC;&#x9ED8;&#x8BA4;&#x7684;&#x662F; <code>localhost</code> <code>5005</code>&#x3002;</p><p>&#x56E0;&#x6B64;&#x9996;&#x5148;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5728; <code>words-java</code> &#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x5F00;&#x542F;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x3002;&#x7136;&#x540E;<code>stop</code>, <code>rm -f</code>, <code>up -d</code> &#x91CD;&#x542F;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;&#x5728; <code>IntelliJ</code> &#x4E2D;&#x70B9;&#x51FB; <code>Debug</code> &#x6309;&#x94AE;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x8FDE;&#x63A5;&#x4E0A;&#x4E86;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;Java&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x5237;&#x65B0;&#x9875;&#x9762;&#xFF0C;&#x89E6;&#x53D1;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x53D1;&#x73B0;IDE&#x6210;&#x529F;&#x7684;&#x505C;&#x6B62;&#x5728;&#x4E86;&#x65AD;&#x70B9;&#x5904;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose scale words-java=20</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;David &#x4F7F;&#x7528;&#x4E86; Go &#x8BF7;&#x6C42;Docker &#x5185;&#x7F6E;DNS&#x89E3;&#x6790; <code>words-java</code>&#xFF0C;&#x7136;&#x540E;&#x5185;&#x7F6E;DNS&#x8FD4;&#x56DE;&#x4E86;<code>50</code>&#x4E2A;&#x5BF9;&#x5E94;&#x7684;IP&#x5730;&#x5740;&#x3002;<code>Go</code> &#x5185;&#x90E8;&#x8FDB;&#x884C;&#x968F;&#x673A;&#x9009;&#x62E9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#xFF0C;&#x4EE5;&#x6B64;&#x8FBE;&#x5230;&#x4E86;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x76EE;&#x7684;&#x3002;</p><h1 id="application-bundle"><a href="#Application-Bundle" class="headerlink" title="Application Bundle"></a>Application Bundle <a href="#application-bundle" class="header-anchor">#</a></h1><p><code>Docker Compose</code> with <code>Docker 1.12</code> &#x652F;&#x6301; <code>Docker Application Bundle</code> &#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;<code>docker-compose</code>&#x6240;&#x63CF;&#x8FF0;&#x7684;app&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;<code>.dab</code>&#x6587;&#x4EF6;&#xFF0C;&#x65B9;&#x4FBF;&#x5206;&#x53D1;&#x90E8;&#x7F72;&#x3002;</p><p>&#x6253;&#x5305; <code>DAB</code> &#x6587;&#x4EF6;&#x6709;&#x4E00;&#x4E9B;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x4E9B;&#x9700;&#x6C42;&#x548C; <code>Docker Compose</code> + <code>Swarm</code> &#x57FA;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x4E0D;&#x7136;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7B49;&#x3002;</p><p>&#x6267;&#x884C; <code>docker-compose bundle</code> &#x540E;&#xFF0C;Docker Compose &#x4F1A;&#x6267;&#x884C; <code>build</code> &#x6307;&#x4EE4;&#xFF0C;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x6587;&#x4EF6;&#x7684; <code>image</code> &#x90E8;&#x5206;&#xFF0C;&#x5C06;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF; <code>push</code> &#x5230; Docker Hub &#x4E0A;&#x3002;&#x7136;&#x540E;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x540D;(&#x9ED8;&#x8BA4;&#x4E3A;&#x76EE;&#x5F55;&#x540D;) &#x7684; <code>xxxx.dab</code> &#x6587;&#x4EF6;&#x3002;</p><p>&#x6240;&#x751F;&#x6210;&#x7684; .dab &#x6587;&#x4EF6;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x4E00;&#x4E2A; JSON &#x6587;&#x4EF6;&#xFF0C;&#x91CC;&#x9762;&#x50CF; <code>docker-compose.yml</code> &#x4E00;&#x6837;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#x7684;<code>Image</code>&#xFF0C;&#x53CA;&#x5176; <code>SHA256</code> &#x7684;&#x6821;&#x9A8C;&#x7801;&#x3002;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x90E8;&#x7F72;&#x8FD9;&#x4E2A;<code>.dab</code>&#x6587;&#x4EF6;&#x3002;&#x548C; <code>docker-compose.yml</code> &#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;<code>DAB</code> &#x8981;&#x6C42;&#x8FD0;&#x884C;&#x5728; <code>Docker Swarm Mode</code> &#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x6F14;&#x793A;&#x7684;&#x65F6;&#x5019;&#xFF0C;David &#x4F7F;&#x7528; <code>docker swarm init</code> &#x5F00;&#x542F;&#x4E86;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x7684;&#x5355;&#x8282;&#x70B9; Swarm&#x3002;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x90E8;&#x7F72;&#x4E4B;&#x524D;&#x6253;&#x5305; <code>xxxx.dab</code> &#x6587;&#x4EF6;&#xFF0C;<code>docker deploy xxxx</code>&#xFF0C;&#x7136;&#x540E;docker &#x4F1A;&#x5728; <code>swarm</code> &#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x7F51;&#x7EDC;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x5404;&#x79CD;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x542F;&#x52A8;&#x3002;</p><p>&#x7136;&#x540E; David &#x505A;&#x4E86;&#x4E2A;&#x5F88;&#x5927;&#x80C6;&#x7684;&#x4E3E;&#x52A8;&#xFF0C;&#x91CD;&#x542F;&#x4E86;&#x81EA;&#x5DF1;&#x7684; Mac &#x7B14;&#x8BB0;&#x672C;&#x3002;&#x6765;&#x7ED9;&#x5927;&#x5BB6;&#x73B0;&#x573A;&#x6F14;&#x793A;&#x91CD;&#x542F;&#x540E;&#xFF0C;&#x6240;&#x6709;&#x90E8;&#x7F72;&#x7684; Docker service &#x4F1A;&#x5904;&#x4E8E;&#x81EA;&#x52A8;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p><h1 id="wen-da"><a href="#&#x95EE;&#x7B54;" class="headerlink" title="&#x95EE;&#x7B54;"></a>&#x95EE;&#x7B54; <a href="#wen-da" class="header-anchor">#</a></h1><p><strong>Q: &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49; Bundle &#x6587;&#x4EF6;&#x4E48;&#xFF1F;&#x8FD8;&#x662F;&#x5FC5;&#x987B;&#x7ECF;&#x8FC7; Compose &#x4E00;&#x6B21;&#x8F6C;&#x624B;&#xFF1F;</strong></p><p>A: &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5199; .dab &#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x53EA;&#x662F;&#x4E2A; JSON &#x6587;&#x4EF6;&#x3002;&#x4F46;&#x662F;&#x663E;&#x7136;&#x4F7F;&#x7528; docker-compose.yml &#x4F1A;&#x66F4;&#x7B80;&#x5355;&#x3002;</p><p><strong>Q: &#x6F14;&#x793A;&#x4EE3;&#x7801;&#x4F1A;&#x653E;&#x5728; github &#x4E0A;&#x4E48;&#xFF1F;</strong></p><p>A: &#x662F;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x90FD;&#x5DF2;&#x7ECF;&#x5728; github &#x4E0A;&#x4E86;&#x3002;</p><p><a href="https://github.com/dgageot/dockercon16" target="_blank" rel="noopener">https://github.com/dgageot/dockercon16</a></p><p><strong>Q: Docker for Mac &#x662F;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;Linux VM &#x4E0A;&#xFF1F;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x5728; Mac &#x4E0A;&#xFF1F;</strong></p><p>A: &#x662F;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7CBE;&#x7B80;&#x7684; Linux VM &#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;VM&#x662F;&#x8FD0;&#x884C;&#x5728; OSX &#x5185;&#x7F6E;&#x7684; <code>Hypervisor</code> &#x6846;&#x67B6;&#x4E0A;&#x7684;(<code>Hyperkit</code>)&#x3002;</p><p><strong>Q: &#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5982;&#x679C;Java&#x4EE3;&#x7801;&#x4FEE;&#x6539;&#x4E86;&#xFF0C;&#x4F60;&#x600E;&#x4E48;&#x786E;&#x4FDD;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4EE3;&#x7801;&#x8DDF;&#x7740;&#x6539;&#x53D8;&#xFF1F;&#x518D;&#x6B21;&#x6784;&#x5EFA;&#xFF1F;</strong></p><p>A: <code>Java</code> &#x8981;&#x6BD4; <code>Node.js</code> &#x590D;&#x6742;&#x4E00;&#x4E9B;&#xFF0C;&#x5728;<code>Node.js</code>&#x4E2D;&#xFF0C;&#x53EA;&#x8981;&#x4FEE;&#x6539;&#x4E86;<code>JS</code>&#x4EE3;&#x7801;&#xFF0C;&#x4FDD;&#x5B58;&#x5373;&#x53EF;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x5C31;&#x53EF;&#x4EE5;&#x611F;&#x77E5;&#x53D8;&#x5316;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;&#x800C;Java&#x8981;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x4EE5;&#x53CA;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>stop</code>, <code>rm -f</code>, <code>up -d</code> &#x7684;&#x65B9;&#x5F0F;&#x786E;&#x4FDD;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4EE3;&#x7801;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x5E76;&#x8FD0;&#x884C;&#x3002;</p><p><strong>Q: &#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A; microservice &#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;3&#x4E2A;&#xFF0C;&#x800C;&#x662F;20&#x591A;&#x4E2A;&#xFF0C;&#x6BCF;&#x4E2A;&#x90FD;&#x6765;&#x81EA;&#x4E8E;&#x4E0D;&#x540C;&#x7684; repository&#xFF0C;&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x7EC4;&#x7EC7;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#xFF1F;&#x662F;&#x628A; docker-compose.yml &#x653E;&#x5230;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; repository &#x4E48;&#xFF1F;</strong></p><p>A: &#x5BF9;&#x4E8E;&#x5C0F;&#x7684;&#x9879;&#x76EE;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x9876;&#x5C42;&#x76EE;&#x5F55;&#x653E;&#x7F6E; docker-compose.yml &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x6BCF;&#x4E2A; micro service &#x653E;&#x7F6E;&#x4E8E;&#x5404;&#x81EA;&#x7684;&#x5B50;&#x76EE;&#x5F55;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x5F88;&#x590D;&#x6742;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; git sub-module &#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E4B;&#x524D;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x591F;&#x4E86;&#x3002;</p><p><strong>Q: &#x4E4B;&#x524D;&#x7684; DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x662F;&#x8C01;&#x8D1F;&#x8D23;&#x89E3;&#x6790;&#x7684;&#x8FD9;&#x4E2A;DNS&#x5730;&#x5740;&#xFF1F;&#x56E0;&#x4E3A;&#x5728;&#x542F;&#x7528; Swarm &#x4E4B;&#x524D;&#xFF0C;&#x4F3C;&#x4E4E;&#x5C31;&#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4E86;&#x3002;</strong></p><p>A: DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x662F;&#x5185;&#x7F6E;&#x7684;&#x7F51;&#x7EDC;&#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x9700;&#x8981; Swarm &#x7684;&#x4ECB;&#x5165;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5BF9;&#x65B9;&#x7684;&#x670D;&#x52A1;&#x540D;&#x5373;&#x53EF;&#x3002;</p><p><strong>Q: &#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#xFF0C;&#x6211;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x4F7F;&#x7528; Docker Compose&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5FC5;&#x8981;&#x4F7F;&#x7528; Application Bundle&#xFF1F;&#x5B83;&#x4EEC;&#x4E8C;&#x8005;&#x7684;&#x533A;&#x522B;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</strong></p><p>A: &#x5982;&#x679C;&#x6211;&#x4EEC;&#x89C2;&#x5BDF; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5728;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x5B9A;&#x4E49;&#x4E2D;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x6307;&#x5B9A;&#x90A3;&#x4E2A;&#x955C;&#x50CF;&#x7248;&#x672C;&#xFF0C;&#x6240;&#x4EE5;compose&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;&#x5B9A;&#x4E49;&#x4E86;&#x6784;&#x6210;&#x5E94;&#x7528;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x9650;&#x5B9A;&#x670D;&#x52A1;&#x7684;&#x955C;&#x50CF;&#x7248;&#x672C;&#x3002;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x505A;&#x6CD5;&#x662F; <code>tag</code> &#x6BCF;&#x4E00;&#x4E2A; <code>image</code>&#xFF0C;&#x7136;&#x540E;&#x6539;&#x53D8; <code>docker-compose</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;&#x800C;&#x73B0;&#x5728;&#x5219;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x884C;<code>bundle</code>&#xFF0C;&#x5C31;&#x4F1A;&#x628A;&#x5F53;&#x524D;&#x7279;&#x5B9A;&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;&#x6253;&#x5305;&#x3002;</p><p><strong>Q: &#x4F1A;&#x628A;&#x955C;&#x50CF;&#x4E00;&#x540C;&#x6253;&#x5305;&#x4E48;&#xFF1F;&#x8FD8;&#x662F;&#x8BF4;&#x5FC5;&#x987B; <code>push</code> &#x5230; docker hub&#xFF1F;</strong></p><p>&#x76EE;&#x524D;&#x53EA;&#x6253;&#x5305;&#x7684;&#x662F;&#x955C;&#x50CF;&#x4FE1;&#x606F;&#xFF0C;&#x662F;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x5305;&#x542B;&#x955C;&#x50CF;tarball&#xFF0C;&#x5C06;&#x6765;&#x6709;&#x53EF;&#x80FD;&#x8FD9;&#x4E48;&#x505A;&#x3002;</p><p><strong>Q: &#x5F53; deploy &#x4E00;&#x4E2A; bundle &#x540E;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x662F;&#x5B58;&#x54EA;&#x4E86;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48; docker engine&#x4F1A;&#x91CD;&#x542F;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#xFF1F;</strong></p><p>A: &#x8FD9;&#x5C5E;&#x4E8E; <code>Swarm Mode</code> &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5F53; <code>docker deploy</code> &#x4E00;&#x4E2A; <code>bundle</code> &#x540E;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x544A;&#x8BC9; <code>docker engine</code> &#x5EFA;&#x7ACB;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5F53;&#x7CFB;&#x7EDF;&#x91CD;&#x542F;&#x540E;&#xFF0C;<code>docker engine</code> &#x4F1A;&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x7684;&#x670D;&#x52A1;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x671F;&#x671B;&#x7684;&#x670D;&#x52A1;&#x72B6;&#x6001;&#x3002;&#x53D1;&#x73B0;&#x786E;&#x5B9E;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x5EFA;&#x7ACB;&#x670D;&#x52A1;&#x6216;&#x8005;&#x542F;&#x52A8;&#x3002;</p><p><strong>Q: <code>docker bundle</code> &#x53EF;&#x4E0D;&#x53EF;&#x4EE5; <code>push</code> &#x5230; private registry&#xFF1F;</strong></p><p>A: &#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x867D;&#x7136;&#x89C9;&#x5F97;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x6E05;&#x695A;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x8BE5;&#x95EE;&#x4E00;&#x4E0B; Docker Engine &#x7684;team&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：runC - 一个可以运行 Docker 容器的小引擎 - Phil Estes</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-runc-the-little-engine-that-could-run-docker-containers.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-11-video-runc-the-little-engine-that-could-run-docker-containers.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.619Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#shi-me-shi-oci">&#x4EC0;&#x4E48;&#x662F; OCI&#xFF1F;</a></li><li><a href="#shi-me-shi-runc">&#x4EC0;&#x4E48;&#x662F; <code>runC</code>&#xFF1F;</a><ul><li><a href="#introduction-to-runc">Introduction to <code>runc</code></a></li><li><a href="#runc-an-open-innovation-platform">runC: An open innovation platform</a></li></ul></li><li><a href="#demo">Demo</a><ul><li><a href="#some-tools">Some tools</a></li><li><a href="#ocitools">ocitools</a></li><li><a href="#chuang-jian-ji-ben-de-alpine-rong-qi">&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;<code>alpine</code>&#x5BB9;&#x5668;</a></li><li><a href="#geng-jia-fu-za-de-rong-qi-nginx">&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668; <code>nginx</code></a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - runC - The little engine that could (run Docker containers)<br>by Phil Estes from IBM Cloud (@estesp)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/ZAhzoz2zJj8" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=ZAhzoz2zJj8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=ZAhzoz2zJj8</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=d0314aalgwo&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/d0314aalgwo.html" target="_blank" rel="noopener">http://v.qq.com/x/page/d0314aalgwo.html</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><ul><li>&#x5DF2;&#x7ECF;&#x53C2;&#x4E0E;&#x5F00;&#x53D1;Docker&#x9879;&#x76EE;2&#x5E74;&#x4E86;&#xFF0C;&#x662F;Docker engine maintainer</li><li>&#x662F; Docker Captains &#x6210;&#x5458;</li><li>&#x5DF2;&#x7ECF;&#x53C2;&#x4E0E; Linux/OSS 10+ &#x5E74;&#x7684;&#x7ECF;&#x9A8C;</li><li>&#x5B9E;&#x73B0; Docker engine &#x7684;User namespace</li><li>&#x5E2E;&#x52A9;&#x8BBE;&#x8BA1; <code>v2.2</code> image spec &#x591A;&#x5E73;&#x53F0;&#x652F;&#x6301;</li><li>&#x5B9E;&#x73B0;&#x7B2C;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x591A;&#x5E73;&#x53F0;image &#xFF08;v2.3 registry &amp; Docker Hub)</li></ul><h1 id="shi-me-shi-oci"><a href="#&#x4EC0;&#x4E48;&#x662F;-OCI&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; OCI&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; OCI&#xFF1F; <a href="#shi-me-shi-oci" class="header-anchor">#</a></h1><p><code>OCI</code> &#x2192; <code>Open Container Initiative</code></p><ul><li><p>OCI &#x662F;&#x4E00;&#x4E2A; Linux foundation &#x534F;&#x4F5C;&#x9879;&#x76EE;</p></li><li><p>&#x4E0D;&#x53D7;&#x4EFB;&#x4F55;&#x5382;&#x5546;&#x6240;&#x63A7;&#x5236;</p></li><li><p>&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x6807;&#x51C6;</p><ul><li>&#x5305;&#x62EC;&#x5BB9;&#x5668; <code>runtime specification</code></li><li>&#x53C2;&#x8003;&#x8FD0;&#x884C;&#x65F6;</li><li><code>image format specificaiton</code></li></ul></li><li><p>&#x5BA3;&#x5E03;&#x4E8E; 2015/06/20</p></li><li><p>&#x7B7E;&#x7F72;&#x4E8E; 2015/12/08</p></li><li><p>&#x5F53;&#x524D;&#x5927;&#x7EA6;&#x6709;46&#x4E2A;&#x516C;&#x53F8;</p></li><li><p>&#x4ECA;&#x5E74;6&#x6708; <code>runtime specification</code> &#x5C06;&#x4F1A;&#x5230; <code>1.0.0-rc1</code>, <code>image format specification</code> &#x5C06;&#x4F1A;&#x5230; 0.3.0</p></li></ul><p><a href="https://github.com/opencontainers/" target="_blank" rel="noopener">https://github.com/opencontainers/</a></p><h1 id="shi-me-shi-runc"><a href="#&#x4EC0;&#x4E48;&#x662F;-runC&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; runC&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; <code>runC</code>&#xFF1F; <a href="#shi-me-shi-runc" class="header-anchor">#</a></h1><h2 id="introduction-to-runc"><a href="#Introduction-to-runc" class="headerlink" title="Introduction to runc"></a>Introduction to <code>runc</code> <a href="#introduction-to-runc" class="header-anchor">#</a></h2><p>runc &#x662F;&#x4E00;&#x4E2A; libcontainer &#x7684;wrapper<br>Libcontainer &#x5219;&#x662F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x63A5;&#x53E3;</p><p>runc &#x9700;&#x8981;&#x4E24;&#x90E8;&#x5206;&#x4FE1;&#x606F;&#xFF1A;</p><ul><li>&#x4E00;&#x4E2A; OCI &#x914D;&#x7F6E;(JSON)</li><li>&#x4E00;&#x4E2A; root &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li></ul><p>&#x6240;&#x4EE5;&#xFF0C;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it &#x2014;<span class="built_in">read</span>-only -v /host:/hostpath alpine sh</span><br></pre></td></tr></table></figure><p>&#x547D;&#x4EE4;&#x5C06;&#x4F1A;&#x88AB;&#x7FFB;&#x8BD1;&#x4E3A; <code>config.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">&quot;ociVersion&quot;</span>: <span class="string">&quot;0.6.0-dev&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;platform&quot;</span>: {</span><br><span class="line">        <span class="attr">&quot;os&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;arch&quot;</span>: <span class="string">&quot;amd64&quot;</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">&quot;process&quot;</span>: {</span><br><span class="line">        <span class="attr">&quot;terminal&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;sh&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;env&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/bin&quot;</span>,</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="runc-an-open-innovation-platform"><a href="#runC-An-open-innovation-platform" class="headerlink" title="runC: An open innovation platform"></a>runC: An open innovation platform <a href="#runc-an-open-innovation-platform" class="header-anchor">#</a></h2><ul><li><p>&#x5B9E;&#x73B0;&#x5E95;&#x5C42;&#x5BB9;&#x5668;&#x7279;&#x6027;</p><ul><li>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x7684;&#x7279;&#x6027;&#x5E94;&#x8BE5;&#x5B9A;&#x4E49;&#x4E8E; <code>OCI runtime specification</code></li><li>&#x65B0;&#x7684;&#x529F;&#x80FD; (<code>PID cgroup controls</code>, <code>checkpoint</code>/<code>restore</code>, <code>seccomp</code>) &#x5E94;&#x8BE5;&#x5728;<code>runC</code>&#x4E2D;&#x5B9E;&#x73B0;</li></ul></li><li><p>OCI &#x517C;&#x5BB9;/&#x53EF;&#x63D2;&#x63A5;&#x7684;&#x6267;&#x884C;&#x5F15;&#x64CE;</p><ul><li>&#x901A;&#x8FC7; OCI spec &#x517C;&#x5BB9;&#x7684;&#x4EE3;&#x7801;&#x4E3A;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;OS&#x73AF;&#x5883;</li><li>&#x6BD4;&#x5982;&#xFF1A;<code>runz</code> (Solaris zones), <code>runv</code>(hypervisor-based), <code>Intel Clear Containers</code></li></ul></li><li><p>&#x8FED;&#x4EE3;&#x5F0F;&#x7684;&#x5BB9;&#x5668;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;/&#x8C03;&#x8BD5;</p><ul><li>&#x7B80;&#x5355;&#x7684; &#x201C;Docker-like&#x201D; &#x53D8;&#x79CD;&#xFF0C;&#x66F4;&#x5C11;&#x7684; friction &#x548C;&#x5FEB;&#x901F;&#x53D8;&#x5316;</li><li>&#x964D;&#x4F4E;&#x4F9D;&#x8D56;&#x95E8;&#x69DB;&#xFF1A;&#x5355;&#x4E00;&#x7684;binary + &#x7269;&#x7406; r<code>ootfs bundle</code> + <code>JSON config</code></li></ul></li></ul><p>&#x524D;&#x5341;&#x8D21;&#x732E; <code>opencontainers/runc</code> &#x7684;&#x516C;&#x53F8;&#xFF1A;</p><p>Docker, OpenVZ, Huawei, Redhat, Google, IBM, SuSE, Pivotal, Fujitsu, Microsoft</p><h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><h2 id="some-tools"><a href="#Some-tools" class="headerlink" title="Some tools"></a>Some tools <a href="#some-tools" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/runc           https://github.com/opencontainers/runc</span><br><span class="line">/usr/bin/ocitools       https://github.com/opencontainers/ocitools</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/riddlers https://github.com/jfrazelle/riddler</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/netns    https://github.com/jfrazelle/netns</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/uidmapshift  http://bazzar.launchpad.net/~serge-hallyn/+junk/nsexec/view/head:/uidmapshift.c</span><br></pre></td></tr></table></figure><blockquote><p><code>jfrazelle</code> - Jessica Frazelle - Queen of Container</p></blockquote><h2 id="ocitools"><a href="#ocitools" class="headerlink" title="ocitools"></a>ocitools <a href="#ocitools" class="header-anchor">#</a></h2><p><code>ocitools generate</code> &#x4F1A;&#x7ACB;&#x523B;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; JSON &#x6587;&#x4EF6;&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x57FA;&#x672C;&#x80FD;&#x529B;&#x7684; JSON &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p><p><code>ocitools generate --help</code> &#x4F1A;&#x663E;&#x793A;&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x6709;&#x4E9B;&#x50CF; <code>docker run</code> &#x7684;&#x547D;&#x4EE4;&#x3002;</p><h2 id="chuang-jian-ji-ben-de-alpine-rong-qi"><a href="#&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;alpine&#x5BB9;&#x5668;" class="headerlink" title="&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;alpine&#x5BB9;&#x5668;"></a>&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;<code>alpine</code>&#x5BB9;&#x5668; <a href="#chuang-jian-ji-ben-de-alpine-rong-qi" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; docker container</span></span><br><span class="line">$ docker run --name alpine alpine date</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FD0;&#x884C; riddler&#xFF0C;&#x4F1A;&#x5C06;&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x4FDD;&#x5B58;&#x4E3A; config.json</span></span><br><span class="line">$ mkdir alpine</span><br><span class="line">$ riddler -idlen 65535 -idroot 100000</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FD0;&#x884C; runc</span></span><br><span class="line">$ runc start alpine</span><br></pre></td></tr></table></figure><p>&#x4EC0;&#x4E48;&#x7ED3;&#x679C;&#x90FD;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#xFF0C;&#x547D;&#x4EE4;&#x4E0D;&#x5DE5;&#x4F5C;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E24;&#x90E8;&#x5206;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x63D0;&#x4F9B;&#x4E86; <code>config.json</code>&#xFF0C;&#x8FD8;&#x7F3A; <code>rootfs</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x63D0;&#x53D6; alpine &#x5BB9;&#x5668;&#x7684;rootfs&#x5230;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x4EE5;&#x53CA;&#x66F4;&#x6362;uid</span></span><br><span class="line">$ exportrootfs -u 10000 -r 65536 alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x91CC;&#x9762;&#x662F;&#x6807;&#x51C6;alpine&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;</span></span><br><span class="line">$ ls -l rootfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7136;&#x540E;&#x518D;&#x6B21;&#x5C1D;&#x8BD5;&#x8FD0;&#x884C; runc</span></span><br><span class="line">$ runc start alpine</span><br><span class="line">could not synchronise with container process: device or resource busy</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x7531;&#x4E8E; Ubuntu 14.04 &#x5185;&#x6838;&#x5347;&#x7EA7;&#x540E;&#x548C; Docker <code>user namespace</code> &#x51B2;&#x7A81;&#x7684;&#x4E00;&#x4E2A;<code>bug</code>&#xFF0C;&#x5DF2;&#x7ECF;&#x4FEE;&#x590D;&#x4E86;&#xFF0C;&#x5C06;&#x5728;&#x5728; <code>4.4.0-25</code> &#x53D1;&#x5E03;&#x540E;&#x89E3;&#x51B3;(&#x73B0;&#x5728;&#x662F;<code>4.4.0-28</code>)&#x3002;</p><p>&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>runc</code> &#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x5C31;&#x6CA1;&#x6551;&#x4E86;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x662F; <code>mqueue</code> &#x5BFC;&#x81F4;&#x7684;&#xFF0C;&#x800C;&#x5728; <code>config.json</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x4F7F;&#x7528; <code>mqueue</code> &#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A; <code>/dev/mqueue</code> &#x90E8;&#x5206;&#x5220;&#x9664;&#x3002;&#x7136;&#x540E;&#x518D;&#x6B21;&#x5C1D;&#x8BD5;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ runc start alpine</span><br><span class="line">Tue Jun 21 20:51:54 UTC 2016</span><br></pre></td></tr></table></figure><p>&#x800C;&#x4E14;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4FEE;&#x6539; <code>config.json</code> &#x6765;&#x8FDB;&#x884C;&#x522B;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6BD4;&#x5982;&#x628A;&#x5176;&#x4E2D;&#x7684; <code>Terminal</code> &#x6539;&#x4E3A; <code>true</code>&#xFF0C;&#x628A;<code>args</code>&#x4E2D;&#x7684;<code>/bin/date</code>&#x6539;&#x4E3A;<code>sh</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ runc start alpine</span><br><span class="line">/ <span class="comment"># ls -l</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x663E;&#x793A;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x6709;&#x4FE1;&#x606F;&#x662F; <code>root</code>&#xFF0C;&#x800C;&#x5728;&#x5916;&#x754C; <code>uid</code> &#x5219;&#x662F; <code>100000</code>&#x3002;</p><p>&#x6B64;&#x65F6;&#x7684;&#x7F51;&#x7EDC;&#x90E8;&#x5206;&#x8FD8;&#x662F;&#x4E0D;&#x5DE5;&#x4F5C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; <code>runc</code> &#x4E0D;&#x8D1F;&#x8D23;&#x7F51;&#x7EDC;&#x90E8;&#x5206;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig</span><br><span class="line">lo  ...</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; <code>riddler</code> &#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;<br>&#x4F7F;&#x7528; <code>hook</code>&#xFF0C;&#x5728; <code>prestart</code> &#x7684;&#x65F6;&#x5019;&#x6267;&#x884C; <code>netns</code><br>&#x5F53;&#x7136;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x53BB;&#x6389; <code>mqueue</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">riddler -idlen 65535 -idroot 100000 -hook prestart:netns alpine</span><br></pre></td></tr></table></figure><p>&#x6B64;&#x65F6;&#x518D;&#x8FD0;&#x884C; runc&#xFF0C;&#x5C31;&#x6709;&#x4E86;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5916;&#x90E8;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ runc start alpine</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0 ...</span><br><span class="line">lo ...</span><br></pre></td></tr></table></figure><p><code>runc</code>, <code>docker</code> &#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x9650;&#x5236;&#x4E86;&#x5F88;&#x591A; <code>syscall</code>&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x5728;&#x4E8E;&#x90A3;&#x4E9B;&#x7BA1;&#x7406;&#x6027;&#x8D28;&#x7684;<br>&#x6BD4;&#x5982; <code>get_hostname</code> &#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x662F; <code>set_hostname</code> &#x5C31;&#x4E0D;&#x53EF;&#x4EE5;&#x3002;</p><p>&#x5982;&#x679C;&#x67E5;&#x770B; <code>config.json</code> &#x4F1A;&#x770B;&#x5230;&#xFF0C;&#x914D;&#x7F6E; <code>Hostname</code> &#x6240;&#x9700;&#x7684; <code>SYS_ADMIN</code> &#x6743;&#x9650;&#x5E76;&#x4E0D;&#x5728;&#x5217;&#x8868;&#x4E2D;&#x3002;<br>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86; <code>CAP_SYS_ADMIN</code> &#x5230; <code>capabilities</code> &#x4E2D;&#xFF0C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4FEE;&#x6539; <code>hostname</code> &#x4E86;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># hostname</span></span><br><span class="line">alpine</span><br><span class="line">/ <span class="comment"># hostname foo</span></span><br><span class="line">/ <span class="comment"># hostname</span></span><br><span class="line">foo</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x5229;&#x7528; <code>seccomp</code> &#x7CBE;&#x8C03;&#x8FD9;&#x90E8;&#x5206;&#x6743;&#x9650;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06; <code>config.json</code> &#x4E2D;&#x7684; <code>sethostname</code> &#x7684;&#x6743;&#x9650;&#x4ECE; <code>SCMP_ACT_ALLOW</code> &#x6539;&#x4E3A; <code>SCMP_ACT_KILL</code>&#xFF0C;&#x7136;&#x5F53;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x6267;&#x884C; <code>hostname</code> &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x65F6;&#x5C31;&#x4F1A;&#x62A5;&#x9519;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># hostname</span></span><br><span class="line">alpine</span><br><span class="line">/ <span class="comment"># hostname foo</span></span><br><span class="line">Bad system call</span><br></pre></td></tr></table></figure><h2 id="geng-jia-fu-za-de-rong-qi-nginx"><a href="#&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668;-nginx" class="headerlink" title="&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668; nginx"></a>&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668; <code>nginx</code> <a href="#geng-jia-fu-za-de-rong-qi-nginx" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528; <code>runc</code> &#x5728;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x8FD0;&#x884C;&#x4E86; <code>nginx</code>&#xFF0C;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x8FD0;&#x884C;&#x4E86;<code>lynx</code>&#x6765;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x3002;</p><p>&#x8FD0;&#x884C; <code>ps aux | grep nginx</code> &#x4F1A;&#x53D1;&#x73B0; <code>nginx</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4EE5;<code>root</code>&#x8EAB;&#x4EFD;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6700;&#x521D;&#x5BFC;&#x51FA;&#x7684;&#x65F6;&#x5019;&#x5FD8;&#x8BB0;&#x4E86;&#x8BBE;&#x7F6E; <code>uid</code>&#x3002;&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x505A;&#x4E00;&#x4E2A;<code>nginx</code>&#x5BB9;&#x5668;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx nginx</span><br><span class="line">riddler -idlen 65536 -idroot 200000 -hook prestart:netns nginx</span><br><span class="line">exportrootfs -u 200000 -r 65536 nginx</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6B21;&#x518D; <code>ps aux | grep nginx</code> &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x4EE5; <code>200000</code> id &#x8FD0;&#x884C;&#x7684; nginx &#x5BB9;&#x5668;&#x4E86;&#x3002;</p><p>&#x7531;&#x4E8E;&#x77E5;&#x9053;&#x4E86; <code>rootfs</code> &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5230;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x66FF;&#x6362;&#x6587;&#x4EF6;&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237; <code>namespace</code> &#x7684; <code>nginx pid</code> &#x662F; <code>24252</code>&#xFF0C;&#x53EF;&#x4EE5; <code>ls -l /proc/24252/ns</code> &#x770B;&#x5230; <code>namespace</code> &#x7684;&#x4FE1;&#x606F;&#x3002;</p><p>&#x73B0;&#x5728;&#x5982;&#x679C;&#x60F3;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x5171;&#x4EAB;&#x7684; <code>alpine</code>&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x987B;<code>user namespace</code>&#x4E00;&#x81F4;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir alpine2</span><br><span class="line"><span class="built_in">cd</span> alpine2</span><br><span class="line">riddler -idlen 65536 -idroot 200000 alpine</span><br><span class="line">exportrootfs -u 200000 -r 65536 alpine</span><br></pre></td></tr></table></figure><p>&#x5728; <code>config.json</code> &#x4E2D;&#x627E;&#x5230; <code>&quot;type&quot;: &quot;network&quot;</code>&#xFF0C;&#x6DFB;&#x52A0;&#x4E00;&#x884C;<code>path</code>&#xFF0C;&#x65E2;&#xFF1A;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;network&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/proc/24252/ns/net&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x540C;&#x6837;&#x4FEE;&#x6539; <code>user namespace</code>&#xFF1A;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/proc/24252/ns/user&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A; <code>alpine2</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ runc start alpine2</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0    ...</span><br><span class="line">        inet addr: 172.19.0.11 ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>alpine2</code> &#x8FD0;&#x884C;&#x5728;&#x4E86;&#x521A;&#x624D; <code>nginx</code> &#x7684;&#x7F51;&#x7EDC;&#x91CC;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：用 Fluentd 和 Datadog 监视 Docker 的最佳实践 - John Hammink</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-08-video-best-practices-for-docker-monitoring-with-fluentd-and-datadog.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-08-video-best-practices-for-docker-monitoring-with-fluentd-and-datadog.html</id>
    <published>2016-07-07T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.618Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#fluentd-unified-logging-layer">Fluentd: Unified Logging Layer</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#shi-me-shi-fluentd">&#x4EC0;&#x4E48;&#x662F; Fluentd&#xFF1F;</a></li><li><a href="#extensible">Extensible</a><ul><li><a href="#core">Core</a></li><li><a href="#plugins">Plugins</a></li></ul></li><li><a href="#nei-bu-jia-gou">&#x5185;&#x90E8;&#x67B6;&#x6784;</a></li><li><a href="#use-cases">Use Cases</a><ul><li><a href="#jian-dan-de-zhuan-fa">&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1;</a></li><li><a href="#lue-fu-za-yi-xie-de-li-zi">&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50;</a></li><li><a href="#lambda-jia-gou">Lambda &#x67B6;&#x6784;</a></li><li><a href="#fluentd-docker-de-li-zi">Fluentd + Docker &#x7684;&#x4F8B;&#x5B50;</a></li></ul></li><li><a href="#docker-toolbox">Docker Toolbox</a><ul><li><a href="#docker-toolbox-nei-rong">Docker Toolbox &#x5185;&#x5BB9;</a></li></ul></li><li><a href="#future-of-boot2docker">Future of Boot2Docker</a></li><li><a href="#monitoring-docker-at-scale-datadog">Monitoring Docker at Scale (Datadog)</a><ul><li><a href="#steps-to-working-with-docker">Steps to working with Docker</a></li><li><a href="#docker-machine">docker-machine</a></li></ul></li><li><a href="#monitoring-at-scale">Monitoring at Scale</a><ul><li><a href="#operational-complexity">Operational Complexity</a></li><li><a href="#xu-yao-qu-ce-liang-de-dong-xi">&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Best Practices for Docker monitoring with Fluentd and Datadog<br>by John Hammink<br>(2015/08/11)</p><div class="owl-media owl-video owl-vimeo"><iframe src="//player.vimeo.com/video/137998663" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://vimeo.com/137998663" target="_blank" rel="noopener">https://vimeo.com/137998663</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=d0314vikb0b&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/d0314vikb0b.html" target="_blank" rel="noopener">http://v.qq.com/x/page/d0314vikb0b.html</a></p><h1 id="fluentd-unified-logging-layer"><a href="#Fluentd-Unified-Logging-Layer" class="headerlink" title="Fluentd: Unified Logging Layer"></a>Fluentd: Unified Logging Layer <a href="#fluentd-unified-logging-layer" class="header-anchor">#</a></h1><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x6062;&#x590D;&#x8F6F;&#x4EF6;&#x548C;QA&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x540E;&#x6765;&#x7531;&#x4E8E;&#x5BF9;&#x5206;&#x5F62;&#x7684;&#x75F4;&#x8FF7;&#x6210;&#x4E86;Digital Artist&#x3002;&#x800C;&#x73B0;&#x5728;&#x5219;&#x662F;&#x559C;&#x6B22;&#x4F7F;&#x7528;GPU&#x5BF9;&#x5927;&#x89C4;&#x6A21;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x89C6;&#x89C9;&#x5316;&#x6E32;&#x67D3;&#x3002;</p><p>github: <code>jammink2</code></p><h1 id="shi-me-shi-fluentd"><a href="#&#x4EC0;&#x4E48;&#x662F;-Fluentd&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Fluentd&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; Fluentd&#xFF1F; <a href="#shi-me-shi-fluentd" class="header-anchor">#</a></h1><p>&#x4E00;&#x4E2A; <strong>&#x53EF;&#x6269;&#x5C55;&#x7684;</strong> &#xFF0C; <strong>&#x53EF;&#x9760;&#x7684;</strong> &#xFF0C; <strong>&#x6570;&#x636E;&#x6536;&#x96C6;</strong> &#x5DE5;&#x5177;</p><ul><li>&#x53EF;&#x6269;&#x5C55;&#xFF1A;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x6838;&#x5FC3; + &#x5F88;&#x5F3A;&#x5927;&#x7684;&#x63D2;&#x4EF6;</li><li>&#x53EF;&#x9760;&#x7684;&#xFF1A;Buffering, HA (failover), load balancing</li><li>&#x6570;&#x636E;&#x6536;&#x96C6;&#x5DE5;&#x5177;&#xFF1A;&#x50CF; <code>syslogd</code></li></ul><p>&#x7EDF;&#x4E00;&#x7684;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x6536;&#x96C6;&#x5DE5;&#x5177;&#xFF0C;&#x57FA;&#x4E8E; <code>Ruby</code> &#x5199;&#x7684;&#xFF0C;&#x6709;&#x4E00;&#x90E8;&#x5206;<code>C</code>&#x7684;&#x4EE3;&#x7801;&#x3002;&#x6570;&#x636E;&#x6D41;&#x4F7F;&#x7528;&#x7EDF;&#x4E00;&#x7684;<code>JSON</code>&#x683C;&#x5F0F;&#x3002;</p><h1 id="extensible"><a href="#Extensible" class="headerlink" title="Extensible"></a>Extensible <a href="#extensible" class="header-anchor">#</a></h1><h2 id="core"><a href="#Core" class="headerlink" title="Core"></a>Core <a href="#core" class="header-anchor">#</a></h2><ul><li>Divide and Conqure</li><li>&#x7F13;&#x5B58;&#x3001;&#x91CD;&#x8BD5;</li><li>&#x9519;&#x8BEF;&#x5904;&#x7406;</li><li>&#x6D88;&#x606F;&#x8DEF;&#x7531;</li><li>&#x5E76;&#x884C;</li></ul><h2 id="plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins <a href="#plugins" class="header-anchor">#</a></h2><ul><li>&#x8BFB;</li><li>&#x89E3;&#x6790;</li><li>Buffer</li><li>&#x5199;&#x6570;&#x636E;</li><li>&#x683C;&#x5F0F;&#x5316;&#x6570;&#x636E;</li></ul><h1 id="nei-bu-jia-gou"><a href="#&#x5185;&#x90E8;&#x67B6;&#x6784;" class="headerlink" title="&#x5185;&#x90E8;&#x67B6;&#x6784;"></a>&#x5185;&#x90E8;&#x67B6;&#x6784; <a href="#nei-bu-jia-gou" class="header-anchor">#</a></h1><ol><li>Input</li><li>Parser</li><li>Filter</li><li>Buffer</li><li>Format</li><li>Output</li></ol><p>&#x7B80;&#x5316;&#x7ED3;&#x6784;&#xFF1A; &#x8F93;&#x5165; &#x2192; Buffer &#x2192; &#x8F93;&#x51FA;</p><p>Fluentd &#x5C06; M x N &#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x964D;&#x4E3A; M + N&#x3002;</p><h1 id="use-cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases <a href="#use-cases" class="header-anchor">#</a></h1><h2 id="jian-dan-de-zhuan-fa"><a href="#&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1;" class="headerlink" title="&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1;"></a>&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1; <a href="#jian-dan-de-zhuan-fa" class="header-anchor">#</a></h2><p>{<code>Web</code>, <code>Mobile</code>} &#x2192; <code>Fluentd</code> &#x2192; <code>MongoDB</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># log from a file</span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    @type tail</span><br><span class="line">    path /var/log/httpd.log</span><br><span class="line">    format apache2</span><br><span class="line">    tag backend.apache</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># log from client libraries</span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    @type forward</span><br><span class="line">    port 24224</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># store logs to ES and HDFS</span><br><span class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">backend.</span>*&gt;</span></span><br><span class="line">    @type mongo</span><br><span class="line">    database fluent</span><br><span class="line">    collection test</span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="lue-fu-za-yi-xie-de-li-zi"><a href="#&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50;"></a>&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50; <a href="#lue-fu-za-yi-xie-de-li-zi" class="header-anchor">#</a></h2><p>{<code>mobile</code>, <code>web</code>} &#x2192; <code>&#x7B2C;&#x4E00;&#x7EA7; fluentd</code> &#x2192; <code>&#x7B2C;&#x4E8C;&#x7EA7; fluentd</code> &#x2192; <code>ElasicSearch</code></p><h2 id="lambda-jia-gou"><a href="#Lambda-&#x67B6;&#x6784;" class="headerlink" title="Lambda &#x67B6;&#x6784;"></a>Lambda &#x67B6;&#x6784; <a href="#lambda-jia-gou" class="header-anchor">#</a></h2><p>{<code>mobile</code>, <code>web</code>} &#x2192; <code>Fluentd</code> &#x2192; {<code>ElasticSearch</code>, <code>Hadoop</code>}</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># logs from a file</span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    @type tail</span><br><span class="line">    path /var/log/httpd.log</span><br><span class="line">    format apache2</span><br><span class="line">    tag web.access</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># logs from client library</span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    @type forward</span><br><span class="line">    port 24224</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># store logs to ES and HDFS</span><br><span class="line"><span class="tag">&lt;<span class="name">match</span> *<span class="attr">.</span>*&gt;</span></span><br><span class="line">    @type copy</span><br><span class="line">    <span class="tag">&lt;<span class="name">store</span>&gt;</span></span><br><span class="line">        @type elasticsearch</span><br><span class="line">        logstash_format true</span><br><span class="line">    <span class="tag">&lt;/<span class="name">store</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">store</span>&gt;</span></span><br><span class="line">        @type webhdfs</span><br><span class="line">        host namenode</span><br><span class="line">        port 50070</span><br><span class="line">        path /path/on/hdfs</span><br><span class="line">    <span class="tag">&lt;/<span class="name">store</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="fluentd-docker-de-li-zi"><a href="#Fluentd-Docker-&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="Fluentd + Docker &#x7684;&#x4F8B;&#x5B50;"></a>Fluentd + Docker &#x7684;&#x4F8B;&#x5B50; <a href="#fluentd-docker-de-li-zi" class="header-anchor">#</a></h2><p>&#x73AF;&#x5883;&#x662F;<code>3</code>&#x4E2A;Docker&#x5BB9;&#x5668;{<code>Rails</code>, <code>PostgreSQL</code>, <code>RabbitMQ</code>}&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x65E5;&#x5FD7;&#x901A;&#x8FC7;<code>Fluentd</code>&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#x8F93;&#x51FA;&#x7ED9; <code>Fluentd</code> &#xFF0C;<code>Fluentd</code> &#x8FDB;&#x800C;&#x53D1;&#x9001;&#x7ED9; <code>S3</code>, <code>MongoDB</code>, <code>ElasticSearch</code>, <code>Treasure Data</code>&#x7B49;&#x7B49;&#x3002;</p><p>&#x4E0B;&#x9762;&#x662F;&#x63A5;&#x6536;&#x65E5;&#x5FD7;&#x7684; <code>fluentd</code> &#x7684;&#x914D;&#x7F6E;</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    @forward</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">td.</span>*<span class="attr">.</span>*&gt;</span></span><br><span class="line">    @type tdlog</span><br><span class="line">    apikey xxxxx</span><br><span class="line">    auto_create_table</span><br><span class="line">    buffer_type file</span><br><span class="line">    buffer_path /var/log/td-agent/buffer/td</span><br><span class="line">    flush_interval 5s</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">secondary</span>&gt;</span></span><br><span class="line">        @type file</span><br><span class="line">        path /var/log/td-agent/failed_records</span><br><span class="line">    <span class="tag">&lt;/<span class="name">secondary</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">td.</span>*<span class="attr">.</span>*&gt;</span></span><br><span class="line">    @type stdout</span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it \</span><br><span class="line">    --name <span class="built_in">test</span> \</span><br><span class="line">    --<span class="built_in">log</span>-driver=fluentd \</span><br><span class="line">    --<span class="built_in">log</span>-opt fluentd-tag=td.docker.{{.Name}} \</span><br><span class="line">    ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x53BB;<code>Treasure Data</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6570;&#x636E;</p><h1 id="docker-toolbox"><a href="#Docker-Toolbox" class="headerlink" title="Docker Toolbox"></a>Docker Toolbox <a href="#docker-toolbox" class="header-anchor">#</a></h1><p>by Michael Chiang</p><h2 id="docker-toolbox-nei-rong"><a href="#Docker-Toolbox-&#x5185;&#x5BB9;" class="headerlink" title="Docker Toolbox &#x5185;&#x5BB9;"></a>Docker Toolbox &#x5185;&#x5BB9; <a href="#docker-toolbox-nei-rong" class="header-anchor">#</a></h2><ul><li>Docker client</li><li>Machine</li><li>Compose</li><li>Kitematic</li><li>Virtualbox</li></ul><h1 id="future-of-boot2docker"><a href="#Future-of-Boot2Docker" class="headerlink" title="Future of Boot2Docker"></a>Future of Boot2Docker <a href="#future-of-boot2docker" class="header-anchor">#</a></h1><p><code>Boot2Docker CLI</code> &#x5E9F;&#x5F03;&#x4E86;&#xFF0C;&#x88AB; <code>Docker Machine</code> &#x66FF;&#x4EE3;&#x4E86;<br>&#x4E0B;&#x4E00;&#x4EE3;&#x7684;&#x7248;&#x672C;&#x5C06;&#x4F1A;&#x4EE3;&#x66FF;&#x5F53;&#x524D;&#x7684; <code>TinyCore Linux</code> &#x7248;&#x672C;</p><h1 id="monitoring-docker-at-scale-datadog"><a href="#Monitoring-Docker-at-Scale-Datadog" class="headerlink" title="Monitoring Docker at Scale (Datadog)"></a>Monitoring Docker at Scale (Datadog) <a href="#monitoring-docker-at-scale-datadog" class="header-anchor">#</a></h1><p>by Matt Williams</p><h2 id="steps-to-working-with-docker"><a href="#Steps-to-working-with-Docker" class="headerlink" title="Steps to working with Docker"></a>Steps to working with Docker <a href="#steps-to-working-with-docker" class="header-anchor">#</a></h2><ul><li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Docker Host (<code>docker-machine</code>)</li><li>&#x4ECE;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x521B;&#x5EFA; Docker &#x5BB9;&#x5668;</li><li>&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x534F;&#x4F5C; <code>Docker Compose</code></li></ul><h2 id="docker-machine"><a href="#docker-machine" class="headerlink" title="docker-machine"></a>docker-machine <a href="#docker-machine" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x521B;&#x5EFA; <code>Docker Host</code>&#xFF0C;{<code>Mac</code>, <code>Windows</code>}:(boot2docker), <code>Google</code>, <code>AWS</code>, <code>Digital Ocean</code> &#x2026;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d vmwarefusion fusiondkr</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span> $(docker-machine env fusiondkr)</span><br></pre></td></tr></table></figure><p>&#x7528;<code>vmware</code>, <code>virtualbox</code>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#xFF0C;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x4E91;&#x670D;&#x52A1;&#x5219;&#x9700;&#x8981;&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x3002;</p><p>&#x6BD4;&#x5982;Openstack</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d openstack \</span><br><span class="line">    --openstack-flavor-name standard.large \</span><br><span class="line">    --openstack-image-id &#x201C;xxxxxxx&#x201D; \</span><br><span class="line">    --openstack-floatingip-pool &#x201C;Ext-Net&#x201D; \</span><br><span class="line">    --openstack-ssh-user ubuntu \</span><br><span class="line">    hpdocker</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span> $(docker-machine env hpdocker)</span><br></pre></td></tr></table></figure><p>&#x518D;&#x6BD4;&#x5982; AWS&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d amazonec2 \</span><br><span class="line">    --amazonec2-access-key <span class="variable">$AWS_ACCESS_KEY_ID</span> \</span><br><span class="line">    --amazonec2-secret-key <span class="variable">$AWS_SECRET_ACCESS_KEY</span> \</span><br><span class="line">    --amazonec2-ami <span class="variable">$ami</span> \</span><br><span class="line">    --amazonec2-instance-type <span class="variable">$instance_size</span> \</span><br><span class="line">    --amazonec2-vpc-id <span class="variable">$vpc_id</span> \</span><br><span class="line">    --amazonec2-security-group <span class="variable">$security_group</span> \</span><br><span class="line">    --amazonec2-region <span class="variable">$aws_region</span> \</span><br><span class="line">    &lt;machine name&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>docker build</code> &#x2192; <code>docker run</code></p></blockquote><p>&#x524D;&#x7AEF;&#x4E00;&#x4E2A; load balancer&#xFF0C;&#x7528;&#x7684;&#x662F;<code>nginx</code> + <code>consul-template</code><br>&#x540E;&#x7AEF;&#x662F;&#x5404;&#x79CD;&#x5E94;&#x7528;&#x3002;<code>Dockerfile</code>&#x592A;&#x591A;&#x65E0;&#x754F;&#x7684;&#x5C42;&#xFF0C;&#x800C;&#x4E14;&#x4F7F;&#x7528;&#x4E86; <code>Supervisord</code>&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x628A;&#x5BB9;&#x5668;&#x5F53;&#x505A;&#x865A;&#x62DF;&#x673A;&#x4E86;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose scale web=20</span><br></pre></td></tr></table></figure><p>download demo:  <a href="http://dtdg.co/dkron" target="_blank" rel="noopener">http://dtdg.co/dkron</a></p><p>&#x76D1;&#x6D4B; docker &#x72B6;&#x6001;</p><p>&#x4E24;&#x79CD;&#x547D;&#x4EE4;&#x5F62;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x662F;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x4F1A;&#x53EA;&#x663E;&#x793A;&#x5BB9;&#x5668;ID&#xFF0C;&#x4E00;&#x4E32;&#x6570;&#xFF0C;&#x4F30;&#x8BA1;&#x4E00;&#x822C;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x5565;</p><p>&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x5C3E;&#x5760;&#x5BB9;&#x5668;&#x540D;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker stats \</span><br><span class="line">    nginxredisdocker_datadog_1 \</span><br><span class="line">    nginxredisdocker_loadbalancer_1 \</span><br><span class="line">    nginxredisdocker_registrator_1 \</span><br><span class="line">    nginxredisdocker_consol_1 \</span><br><span class="line">    nginxredisdocker_web_1</span><br></pre></td></tr></table></figure><p>&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x67E5;&#x770B;&#x72B6;&#x6001;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7; <code>REST API</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http --stream -f --verify=no \</span><br><span class="line">    --cert=<span class="variable">$DOCKER_CERT_PATH</span>/cert.pem \</span><br><span class="line">    --cert-key=<span class="variable">$DOCKER_CERT_PATH</span>/key.pem \</span><br><span class="line">    https://172.16.88.129:2376/containers/xxxxxxx/stats</span><br><span class="line"></span><br><span class="line">docker-machine ls</span><br><span class="line">docker-machine ip</span><br><span class="line"></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><h1 id="monitoring-at-scale"><a href="#Monitoring-at-Scale" class="headerlink" title="Monitoring at Scale"></a>Monitoring at Scale <a href="#monitoring-at-scale" class="header-anchor">#</a></h1><h2 id="operational-complexity"><a href="#Operational-Complexity" class="headerlink" title="Operational Complexity"></a>Operational Complexity <a href="#operational-complexity" class="header-anchor">#</a></h2><ul><li>&#x5E73;&#x5747;&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x7684;&#x5BB9;&#x5668;&#x6570;&#x91CF;&#xFF1A;N ( <code>2014&#x5E74;10&#x6708;</code>&#x65F6;&#xFF0C;N&#x662F;<code>5</code>&#xFF0C;&#x4ECA;&#x5E74;<code>2016</code>&#xFF0C;&#x7EDF;&#x8BA1;&#x540C;&#x6837;&#x662F;<code>5</code>&#xFF09;</li><li>N * &#x4E3B;&#x673A;&#x6570;&#x91CF; = &#x591A;&#x5C11;&#x4E2A;&#x201C;&#x4E3B;&#x673A;&#x201D;&#x6765;&#x7BA1;&#x7406;</li><li>provision, configuration, orchestration, monitoring.</li></ul><h2 id="xu-yao-qu-ce-liang-de-dong-xi"><a href="#&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F;" class="headerlink" title="&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F;"></a>&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F; <a href="#xu-yao-qu-ce-liang-de-dong-xi" class="header-anchor">#</a></h2><ul><li><p>&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x4E3B;&#x673A;</p><ul><li><code>10</code>&#x4E2A;&#x5DE6;&#x53F3;&#x7684;&#x4E1C;&#x897F;</li></ul></li><li><p>&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</p><ul><li>&#x5927;&#x7EA6;<code>100</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;</li></ul></li><li><p><code>N</code>&#x4E2A;&#x5BB9;&#x5668;</p><ul><li><code>100</code> * <code>N</code> &#x4E2A;&#x6D4B;&#x91CF;&#x70B9;</li></ul></li><li><p><code>110</code> + <code>100</code> * <code>N</code> &#x4E2A;&#x6D4B;&#x91CF;&#x70B9;/&#x865A;&#x62DF;&#x673A;</p></li></ul><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4EE5;&#x524D;&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x9700;&#x8981;<code>160</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x5F97;&#x9700;&#x8981;<code>610</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;</p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;<code>100</code>&#x4E2A;&#x4E3B;&#x673A;&#xFF0C;&#x5C31;&#x5F97;&#x9700;&#x8981;<code>61K</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;&#x3002;</p><p>&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x66F4;&#x77ED;</p><p>&#x865A;&#x62DF;&#x673A;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x53EF;&#x80FD;&#x662F;&#x5C0F;&#x65F6;&#x3001;&#x5929;&#x3001;&#x6708;&#x4E3A;&#x5355;&#x4F4D;&#xFF0C;&#x800C;&#x5BB9;&#x5668;&#x5219;&#x662F;&#x5206;&#x949F;&#x3001;&#x5C0F;&#x65F6;&#xFF0C;&#x5929;&#x4E3A;&#x5355;&#x4F4D;&#x3002;</p><p>&#x7528; <code>Tag</code> &#x53BB;&#x76D1;&#x6D4B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7528;&#x4E3B;&#x673A;IP&#x4E4B;&#x7C7B;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x6B7B;&#x53D8;&#x5316;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="fluentd" scheme="https://1x481n.github.io/blog.lab99.org/tags/fluentd/"/>
    
      <category term="vimeo" scheme="https://1x481n.github.io/blog.lab99.org/tags/vimeo/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：在容器内思考 - 一个持续部署的故事 - Maxfield Stewart</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-07-video-thinking-inside-the-container.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-07-video-thinking-inside-the-container.html</id>
    <published>2016-07-06T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.618Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#league-legends">League Legends</a></li><li><a href="#a-containerized-build-farm">A Containerized Build Farm</a></li><li><a href="#story-time">Story Time</a><ul><li><a href="#wo-men-dao-di-xiang-yao-shi-me">&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F;</a></li></ul></li><li><a href="#jenkins-primer">Jenkins Primer</a></li><li><a href="#docker-container-as-jenkins-slave">Docker Container as Jenkins Slave</a></li><li><a href="#rong-qi-fei-chang-yong-zhong">&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;</a></li><li><a href="#provisioning-and-plugins">Provisioning and Plugins</a></li><li><a href="#we-created-a-monster">We Created a Monster</a></li><li><a href="#we-need-to-ispect-our-containers">We Need to Ispect Our Containers</a></li><li><a href="#but-it-needs-to-scale">But it needs to Scale</a></li><li><a href="#putting-it-all-together">Putting It All Together</a><ul><li><a href="#grovvy-xie-de-jenkins-gou-jian-job">Grovvy &#x5199;&#x7684; Jenkins &#x6784;&#x5EFA; Job</a></li></ul></li><li><a href="#dockerception">Dockerception</a></li><li><a href="#how-do-you-actually-build-it">How do you actually build it</a></li><li><a href="#ting-qi-lai-hen-jian-dan">&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;</a></li><li><a href="#lesson-1-docker-isn-t-simple">Lesson 1 - Docker Isn&#x2019;t &#x201C;Simple&#x201D;</a></li><li><a href="#lesson-2-rong-qi-xu-ni-ji">Lesson 2 - &#x5BB9;&#x5668; != &#x865A;&#x62DF;&#x673A;</a></li><li><a href="#lesson-3-garbage-collection">Lesson 3 - Garbage Collection</a></li><li><a href="#lesson-4-maintenance-failure">Lesson 4 - Maintenance/Failure</a></li><li><a href="#lesson-5-dao-di-zen-me-sheng-ji">Lesson 5 - &#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F;</a></li><li><a href="#lesson-7-credentials-security">Lesson 7 - Credentials &amp; Security</a></li><li><a href="#wo-men-cheng-gong-liao-ma">&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Thinking Inside the Container - A Continuous Delivery Story<br>by Maxfield Stewart, Riot Games</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/YViFZBoKqjg" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=YViFZBoKqjg" target="_blank" rel="noopener">https://www.youtube.com/watch?v=YViFZBoKqjg</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=h03148603la&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/h03148603la.html" target="_blank" rel="noopener">http://v.qq.com/x/page/h03148603la.html</a></p><h1 id="league-legends"><a href="#League-Legends" class="headerlink" title="League Legends"></a>League Legends <a href="#league-legends" class="header-anchor">#</a></h1><ul><li>67 millions player/ month, 27 m/daily, 7.5 m at peak.</li><li>1.25 Milions Build / Year</li><li>10 - 14 k containers / week</li><li>120 build jobs / hour</li></ul><h1 id="a-containerized-build-farm"><a href="#A-Containerized-Build-Farm" class="headerlink" title="A Containerized Build Farm"></a>A Containerized Build Farm <a href="#a-containerized-build-farm" class="header-anchor">#</a></h1><p><code>Jenkins</code> &#x2192; (<code>Docker API</code>) &#x2192; <code>Swarm</code> &#x2192; (<code>Docker API</code>) &#x2192; <code>Build Hosts</code> &#x2192; (<code>Docker API</code>) &#x2192; <code>DryDock</code></p><p><code>Jenkins</code> &#x8FD8;&#x4F1A;&#x76F4;&#x63A5;&#x901A;&#x8FC7;SSH&#x8FDE;&#x63A5;<code>Build Host</code></p><p>&#x6BCF;&#x4E00;&#x4E2A;Build Host&#x90FD;&#x662F; <code>CentOS 7.2</code>/<code>Docker 1.10.3</code> + <code>cAdvisor</code> + <code>Docker-GC</code> + <code>Container Metrics</code>, 4 core/32GB RAM/120GB LVS</p><h1 id="story-time"><a href="#Story-Time" class="headerlink" title="Story Time"></a>Story Time <a href="#story-time" class="header-anchor">#</a></h1><p>&#x4E24;&#x5E74;&#x524D;&#xFF0C;2013&#xFF0C;&#x5728;&#x4E00;&#x4E2A; Jenkins &#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x8FD0;&#x884C;3500+ unique build jobs &#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#x5C31;&#x662F;&#x6BCF;&#x5C0F;&#x65F6; 650+ &#x4E2A;build&#x3002;90+ Build slave</p><p><code>Engineers</code> &#x2192; <code>Ticket(s)</code> &#x2192; <code>Build Team</code></p><p>&#x5B9E;&#x9645;&#x4E0A;&#x57FA;&#x672C;&#x90FD;&#x88AB;<code>Ticket</code>&#x57CB;&#x4E86;&#x2026;&#x2026;</p><h2 id="wo-men-dao-di-xiang-yao-shi-me"><a href="#&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F;"></a>&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F; <a href="#wo-men-dao-di-xiang-yao-shi-me" class="header-anchor">#</a></h2><ul><li>&#x56E2;&#x961F;&#x5FC5;&#x987B;&#x6709;&#x5FEB;&#x901F;&#x884C;&#x52A8;&#x7684;&#x80FD;&#x529B;</li><li>&#x4EA7;&#x54C1;&#x5FC5;&#x987B;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6280;&#x672F;&#x6808;</li><li>&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x50CF;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#xFF0C;&#x5E0C;&#x671B;&#x9700;&#x6C42;&#x65B9;&#x53EF;&#x4EE5;&#x7528;code&#x5B9A;&#x4E49;&#x73AF;&#x5883;</li></ul><p>&#x66FE;&#x7ECF;&#x8003;&#x8651;&#x8FC7;&#x5F88;&#x591A;&#x79CD;&#x65B9;&#x6848;&#xFF1A; <code>Packer</code>, <code>Vagrant</code>, <code>Openstack</code>, <code>AWS EC2</code>, <code>Azure</code>, <code>vmware</code></p><p>2014&#x5E74;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7A81;&#x7136;<code>docker</code>&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x7531;&#x4E8E;&#x56E2;&#x961F;&#x592A;&#x8FC7;&#x7E41;&#x5FD9;&#xFF0C;&#x6CA1;&#x6709;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;&#x76F4;&#x5230;&#x6709;&#x4E00;&#x5929;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;<code>ticket</code>&#x51FA;&#x73B0;&#x8BF4;&#xFF0C;&#x4F60;&#x4EEC;&#x80FD;&#x591F;&#x5728;build&#x73AF;&#x5883;&#x4E2D;&#x90E8;&#x7F72;<code>Docker</code>&#x4E48;&#xFF1F;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x5C31;&#x592A;&#x8D5E;&#x4E86;&#x3002;</p><p>&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#xFF0C;&#x4F1A;&#x89C9;&#x5F97;WTF&#xFF0C;&#x53C8;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E1C;&#x897F;&#x60F3;&#x90E8;&#x7F72;&#x4E86;&#xFF1F;&#x4F46;&#x662F;turns out, it&#x2019;s great&#x3002;</p><h1 id="jenkins-primer"><a href="#Jenkins-Primer" class="headerlink" title="Jenkins Primer"></a>Jenkins Primer <a href="#jenkins-primer" class="header-anchor">#</a></h1><p><code>Jenkins</code> &#x662F;&#x4E3B;&#x4ECE;&#x7ED3;&#x6784;&#xFF0C;&#x5728; Jenkins &#x773C;&#x4E2D;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x4ECE;&#x6784;&#x5EFA;&#x4E3B;&#x673A;&#x662F;&#x5404;&#x79CD;<code>label</code>&#x800C;&#x5DF2;&#xFF0C;&#x6BD4;&#x5982; <code>Win32</code> + <code>Java</code> + <code>TeamA</code>,&#x6216;&#x8005; <code>CentOS7</code> + <code>Java</code> + <code>TeamB</code> &#x2026;</p><p>&#x800C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;&#x5199;&#x6784;&#x5EFA;&#x9700;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x9700;&#x8981;<code>label</code>&#x4E0A;&#x81EA;&#x5DF1;&#x6240;&#x9700;&#x7684;&#x73AF;&#x5883;&#xFF1A;<code>Win32</code> + <code>Java</code> + <code>TeamA</code>&#x4E4B;&#x7C7B;&#x7684;&#x5373;&#x53EF;&#xFF0C;<code>Jenkins</code>&#x4F1A;&#x6839;&#x636E;&#x8FD9;&#x4E9B;<code>Label</code>&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x8C03;&#x5EA6;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;</p><h1 id="docker-container-as-jenkins-slave"><a href="#Docker-Container-as-Jenkins-Slave" class="headerlink" title="Docker Container as Jenkins Slave"></a>Docker Container as Jenkins Slave <a href="#docker-container-as-jenkins-slave" class="header-anchor">#</a></h1><p>&#x73B0;&#x5728; <code>Jenkins</code> &#x4E0A;&#x4F30;&#x8BA1;&#x6709;&#x5F88;&#x591A; <code>Docker</code> &#x7684;&#x63D2;&#x4EF6;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5728;1-2&#x5E74;&#x524D;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x9700;&#x8981;&#x627E;&#x51FA;&#x4E00;&#x79CD;&#x529E;&#x6CD5;&#x8BA9; <code>Jenkins</code> &#x4EE5;&#x4E3A;&#x5BB9;&#x5668;&#x5C31;&#x662F; <code>Build Slave</code>&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x53EF;&#x4EE5;&#x8BA9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B; Dockerfile &#x7684;&#x9014;&#x5F84;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#x3002;</p><p>&#x540E;&#x6765;&#x901A;&#x8FC7;google&#x5728;Docker Hub&#x4E0A;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x4E2A;Dockerfile&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#x6A21;&#x62DF; Jenkins Build Slave&#x3002;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5305;&#x62EC;&#x4E86; <code>ssh</code>, <code>jdk</code>, <code>git</code>, <code>jenkins</code>&#x7684;&#x5BB9;&#x5668;</p><h1 id="rong-qi-fei-chang-yong-zhong"><a href="#&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;" class="headerlink" title="&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;"></a>&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF; <a href="#rong-qi-fei-chang-yong-zhong" class="header-anchor">#</a></h1><p>&#x7531;&#x4E8E;&#x4ED6;&#x4EEC;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x80A5;&#x955C;&#x50CF;&#xFF0C;&#x524D;&#x9762;&#x51E0;&#x5C42;&#x8FD8;&#x597D;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x6784;&#x5EFA;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6240;&#x9700;&#x7684;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x3002;</p><h1 id="provisioning-and-plugins"><a href="#Provisioning-and-Plugins" class="headerlink" title="Provisioning and Plugins"></a>Provisioning and Plugins <a href="#provisioning-and-plugins" class="header-anchor">#</a></h1><ul><li>Docker Plugin: &lt;&#x4E2D;&#x9009;&gt;</li><li>Mesos Plugin:</li><li>Kubernetes Plugin:</li></ul><p>Jenkins Docker Plugin UI&#x975E;&#x5E38;&#x57FA;&#x672C;&#xFF0C;URL, Docker Image, &#x5BB9;&#x5668;&#x9009;&#x9879;&#x7B49;&#x7B49;&#x3002;</p><p>&#x7136;&#x540E;&#x8BBE;&#x6CD5;&#x7528;<code>Groovy</code>&#x505A;&#x4E86;&#x4E2A;&#x7ED3;&#x5408;&#x4E8C;&#x8005;API&#x7684;&#x811A;&#x672C;&#x3002;&#x73B0;&#x5728;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;<code>Dockerfile</code>&#xFF0C;&#x7136;&#x540E;Jenkins&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#x6784;&#x5EFA;&#x3002;</p><h1 id="we-created-a-monster"><a href="#We-Created-a-Monster" class="headerlink" title="We Created a Monster"></a>We Created a Monster <a href="#we-created-a-monster" class="header-anchor">#</a></h1><p><code>Garbage In-Gabage out</code> Paradigm</p><p>&#x4E0D;&#x662F;&#x6240;&#x6709;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x90FD;&#x7406;&#x89E3;&#x8FD9;&#x79CD;&#x6784;&#x67B6;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x7684;&#x65F6;&#x5019;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B;&#x7684;<code>Dockerfile</code>&#xFF0C;&#x6216;&#x8BB8;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x5728; <code>Jenkins</code> &#x6784;&#x5EFA; <code>Slave</code> &#x4E0A;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x7136;&#x540E; <code>Jenkins</code> &#x4F1A;&#x975E;&#x5E38;&#x5C3D;&#x804C;&#x7684;&#x53BB;&#x52AA;&#x529B;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x5F88;&#x591A;&#x7684;&#x5BB9;&#x5668;&#x53BB;&#x6EE1;&#x8DB3;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#xFF0C;&#x6700;&#x540E;&#x9762;&#x5BF9;&#x7684;&#x662F;&#x5DE8;&#x5927;&#x7684;<code>docker rmi</code>&#x7684;job&#x3002;</p><h1 id="we-need-to-ispect-our-containers"><a href="#We-Need-to-Ispect-Our-Containers" class="headerlink" title="We Need to Ispect Our Containers"></a>We Need to Ispect Our Containers <a href="#we-need-to-ispect-our-containers" class="header-anchor">#</a></h1><p>&#x201C;Infrastructure as Code&#x201D; Managing Servers in the Cloud</p><p>&#x6700;&#x5F00;&#x59CB;&#x662F;&#x624B;&#x52A8;&#x68C0;&#x67E5;<code>Docker Image</code>&#xFF0C;&#x5F88;&#x5FEB;&#x5C31;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x4E8E;&#x662F;&#x521B;&#x5EFA;&#x4E86;&#x4E2A;&#x811A;&#x672C; <code>./harbormaster</code> &#xFF0C;&#x4F7F;&#x7528;<code>Go</code>&#x5199;&#x7684;&#xFF0C;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;<code>Image</code>&#x662F;&#x4E0D;&#x662F;&#x6EE1;&#x8DB3;&#x5404;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x6BD4;&#x5982;<code>ssh</code>&#x554A;&#x4E4B;&#x7C7B;&#x7684;&#x3002;</p><h1 id="but-it-needs-to-scale"><a href="#But-it-needs-to-Scale" class="headerlink" title="But it needs to Scale"></a>But it needs to Scale <a href="#but-it-needs-to-scale" class="header-anchor">#</a></h1><p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x6700;&#x5F00;&#x59CB;&#x4F1A;&#x53EA;&#x5728;&#x4E00;&#x4E2A;<code>Docker Host</code>&#x4E0A;&#x8DD1;&#xFF0C;&#x56E0;&#x4E3A;<code>Docker Plugins</code>&#x53EA;&#x652F;&#x6301;&#x4E00;&#x4E2A;<code>Docker API</code>&#x3002;&#x5F53;&#x65F6;&#x5C31;&#x5728;&#x60F3;&#xFF0C;&#x8981;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;<code>Docker API</code> &#x7136;&#x540E;&#x5B83;&#x7406;&#x89E3;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x53BB;&#x63A7;&#x5236;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x5668;&#x591A;&#x597D;&#x3002;&#x6070;&#x597D;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;<code>Docker Swarm 0.1</code>&#x53D1;&#x5E03;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x7ACB;&#x5373;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x5C1D;&#x8BD5;&#xFF0C;&#x4ED6;&#x4EEC;&#x7B2C;&#x4E00;&#x6B21;&#x8BD5;&#x7528;&#x7684;&#x65F6;&#x95F4;&#x4F30;&#x8BA1;&#x662F;<code>Swarm 0.2</code>&#x3002;</p><h1 id="putting-it-all-together"><a href="#Putting-It-All-Together" class="headerlink" title="Putting It All Together"></a>Putting It All Together <a href="#putting-it-all-together" class="header-anchor">#</a></h1><p>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7528; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x6254;&#x7ED9; <code>Registry</code>&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x77E5; <code>Harbor Master</code> &#xFF0C;&#x7136;&#x540E; <code>Harbor Master</code> &#x5F00;&#x59CB;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;&#xFF0C;&#x4F1A;&#x901A;&#x77E5; <code>Swarm Master</code> &#x4E0B;&#x8FBE;&#x4EFB;&#x52A1;&#xFF0C;<code>Swarm Master</code> &#x4F1A;&#x8C03;&#x5EA6;&#x4EFB;&#x52A1;&#x5230;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#x4ECE; <code>Registry</code> &#x4E0B;&#x8F7D;&#x4EFB;&#x52A1;&#x3002;</p><p>&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7F8E;&#x597D;&#xFF0C;&#x4ED6;&#x4EEC;&#x8BA9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C1D;&#x8BD5;&#xFF0C;&#x53EF;&#x662F;&#x73B0;&#x5B9E;&#x5F88;&#x6B8B;&#x9177;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF;&#x5927;&#x7EA6;<code>3GB</code>&#x5DE6;&#x53F3;&#xFF0C;&#x7528;&#x4E86;&#x5F88;&#x4E45;<code>push</code>&#x5230;&#x4E86;<code>registry</code>&#x540E;&#xFF0C;&#x6D4B;&#x8BD5;&#x5E76;&#x6CA1;&#x6709;&#x5F00;&#x59CB;&#x3002;&#x539F;&#x56E0;&#x662F;&#xFF0C;<code>Swarm</code> &#x4E2D;&#x7684; <code>Docker Host</code> &#x540C;&#x6837;&#x9700;&#x8981;&#x5F88;&#x4E45;&#x53BB;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E2A;<code>3GB</code>&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x4E0B;&#x8F7D;&#x540E;&#x624D;&#x53EF;&#x80FD;&#x6D4B;&#x8BD5;&#x3002;&#x6240;&#x4EE5;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x62B1;&#x6028;&#x8BF4;&#x4F60;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x4E0D;&#x597D;&#x7528;&#xFF0C;&#x63D0;&#x4EA4;&#x4E86;&#x4EFB;&#x52A1;&#x8BB8;&#x4E45;&#x90FD;&#x6CA1;&#x6709;&#x5F00;&#x59CB;&#x6D4B;&#x8BD5;&#x3002;</p><h2 id="grovvy-xie-de-jenkins-gou-jian-job"><a href="#Grovvy-&#x5199;&#x7684;-Jenkins-&#x6784;&#x5EFA;-Job" class="headerlink" title="Grovvy &#x5199;&#x7684; Jenkins &#x6784;&#x5EFA; Job"></a>Grovvy &#x5199;&#x7684; Jenkins &#x6784;&#x5EFA; Job <a href="#grovvy-xie-de-jenkins-gou-jian-job" class="header-anchor">#</a></h2><p>&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node (<span class="string">&apos;Awesome-Build-Label&apos;</span>) {</span><br><span class="line">    git <span class="string">branch:</span> <span class="string">&quot;master&quot;</span>, <span class="string">url:</span> <span class="string">&quot;git@github.com:maxfields2000/awesome.git&quot;</span></span><br><span class="line">    sh <span class="string">&quot;./buildme.sh&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h1 id="dockerception"><a href="#Dockerception" class="headerlink" title="Dockerception"></a>Dockerception <a href="#dockerception" class="header-anchor">#</a></h1><p>&#x5F88;&#x5FEB;&#x5C31;&#x51FA;&#x65B0;&#x7684;&#x9EBB;&#x70E6;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;Docker&#x5F88;&#x597D;&#x7528;&#xFF0C;&#x4E8E;&#x662F;&#x5927;&#x5BB6;&#x5F00;&#x59CB;&#x90FD;&#x7528;Docker&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x5FEB;&#x6709;&#x4EBA;&#x9700;&#x8981;Docker in Docker&#x3002;&#x56E0;&#x4E3A;&#x5F88;&#x591A;&#x4EBA;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x7528;Jenkins&#x6D4B;&#x8BD5;&#x6784;&#x5EFA;Docker &#x955C;&#x50CF;&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;</p><p>&#x6700;&#x7EC8;&#xFF0C;&#x4ED6;&#x4EEC;&#x72EC;&#x7ACB;&#x51FA;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x79F0;&#x4E3A;<code>DRYDOCK</code>&#xFF0C;&#x7136;&#x540E;&#x6240;&#x6709;&#x90A3;&#x4E9B;&#x9700;&#x8981;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x90FD;&#x6307;&#x5411;&#x8FD9;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;DIND&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x4F1A;&#x628A;Build Slave&#x96C6;&#x7FA4;&#x641E;&#x5D29;&#x4E86;&#x3002;&#x771F;&#x51FA;&#x4E86;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x76F4;&#x63A5;&#x628A;&#x8FD9;&#x4E2A;&#x673A;&#x5668;&#x7684;&#x6E05;&#x7A7A;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x5373;&#x53EF;&#x3002;</p><h1 id="how-do-you-actually-build-it"><a href="#How-do-you-actually-build-it" class="headerlink" title="How do you actually build it"></a>How do you actually build it <a href="#how-do-you-actually-build-it" class="header-anchor">#</a></h1><p><a href="http://engineering.riotgames.com" target="_blank" rel="noopener">http://engineering.riotgames.com</a><br><a href="https://github.com/maxfields2000/dockerjenkins_tutorial" target="_blank" rel="noopener">https://github.com/maxfields2000/dockerjenkins_tutorial</a></p><h1 id="ting-qi-lai-hen-jian-dan"><a href="#&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;" class="headerlink" title="&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;"></a>&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355; <a href="#ting-qi-lai-hen-jian-dan" class="header-anchor">#</a></h1><p>&#x4E3E;&#x4E86;&#x4E24;&#x6B65;&#x753B;&#x732B;&#x5934;&#x9E70;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;&#x7B2C;&#x4E00;&#x6B65;&#x82B1;&#x4E24;&#x4E2A;&#x5706;&#xFF1B;&#x7B2C;&#x4E8C;&#x6B65;&#x753B;&#x5269;&#x4E0B;&#x7684;&#x90E8;&#x5206;&#x2026;&#x2026;</p><p>&#x4E24;&#x5E74;&#x524D;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x4F7F;&#x7528;<code>Docker</code>&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x624D;&#x6765;&#x8FD9;&#x91CC;&#x7ED9;&#x5927;&#x5BB6;&#x6F14;&#x8BB2;&#xFF0C;&#x663E;&#x7136;&#x4E2D;&#x95F4;&#x53D1;&#x751F;&#x4E86;&#x5199;&#x4EC0;&#x4E48;&#x4E8B;&#x60C5;&#xFF0C;&#x4E0D;&#x7136;&#x6211;&#x4EEC;&#x53BB;&#x5E74;&#x5C31;&#x6765;&#x4E86;&#x3002;</p><h1 id="lesson-1-docker-isn-t-simple"><a href="#Lesson-1-Docker-Isn&#x2019;t-&#x201C;Simple&#x201D;" class="headerlink" title="Lesson 1 - Docker Isn&#x2019;t &#x201C;Simple&#x201D;"></a>Lesson 1 - Docker Isn&#x2019;t &#x201C;Simple&#x201D; <a href="#lesson-1-docker-isn-t-simple" class="header-anchor">#</a></h1><ul><li>Dockerfile &#x7684;&#x64B0;&#x5199;&#x9700;&#x8981;&#x6709;&#x826F;&#x597D;&#x7684;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x77E5;&#x8BC6;&#x80CC;&#x666F;</li></ul><p>&#x597D;&#x591A;&#x4EBA;&#x7684;&#x95EE;&#x9898;&#x5B9E;&#x9645;&#x4E0A;&#x662F; <code>Dockerfile</code> &#x7684;&#x4E66;&#x5199;&#x95EE;&#x9898;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x8F6C;&#x5316;&#x4E3A;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E1C;&#x897F;&#x4E0D;&#x53EF;&#x80FD;&#x5728; Docker &#x91CC;&#x6784;&#x5EFA;&#x3002;&#x5176;&#x5B9E; Docker &#x7528;&#x6237;&#x90FD;&#x77E5;&#x9053;&#x4E8B;&#x5B9E;&#x5E76;&#x975E;&#x5982;&#x6B64;&#x3002;&#x4ED6;&#x4EEC;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;Teaching&#x3002;</p><ul><li>&#x7528;&#x6765;&#x6784;&#x5EFA; Docker Images &#x7684; Docker Images &#x662F; Dockerception</li><li>Docker &#x201C;Voodoo and Black Magic&#x201D; &#x95EE;&#x9898;</li></ul><h1 id="lesson-2-rong-qi-xu-ni-ji"><a href="#Lesson-2-&#x5BB9;&#x5668;-&#x865A;&#x62DF;&#x673A;" class="headerlink" title="Lesson 2 - &#x5BB9;&#x5668; != &#x865A;&#x62DF;&#x673A;"></a>Lesson 2 - &#x5BB9;&#x5668; != &#x865A;&#x62DF;&#x673A; <a href="#lesson-2-rong-qi-xu-ni-ji" class="header-anchor">#</a></h1><p>&#x867D;&#x7136;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x50CF;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6BD4;&#x5982;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x91CC;&#x9762; <code>apt-get install</code>&#xFF0C;&#x4F46;&#x662F;Docker&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x3002;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#x5728;&#x91CC;&#x9762;&#x505A;&#x7684;&#x3002;</p><ul><li>&#x65E0;&#x6CD5;&#x6302;&#x8F7D;&#x8FDC;&#x7A0B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li><li>&#x5BB9;&#x5668;&#x4E0D;&#x4FDD;&#x5B58;&#x72B6;&#x6001;</li><li>&#x5BF9;&#x4E8E;&#x6784;&#x5EFA;&#x65F6;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x89C4;&#x77E9;</li></ul><h1 id="lesson-3-garbage-collection"><a href="#Lesson-3-Garbage-Collection" class="headerlink" title="Lesson 3 - Garbage Collection"></a>Lesson 3 - Garbage Collection <a href="#lesson-3-garbage-collection" class="header-anchor">#</a></h1><p>docker build &#x2192; docker run &#x2192; docker pull &#x2192; volume</p><p>github: <code>spotify/docker-gc</code></p><h1 id="lesson-4-maintenance-failure"><a href="#Lesson-4-Maintenance-Failure" class="headerlink" title="Lesson 4 - Maintenance/Failure"></a>Lesson 4 - Maintenance/Failure <a href="#lesson-4-maintenance-failure" class="header-anchor">#</a></h1><ul><li>Pull hosts on/offline</li></ul><p>Docker &#x7ECF;&#x5E38;&#x5347;&#x7EA7;&#xFF0C;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x90FD;&#x60F3;&#x4F7F;&#x7528;&#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x5C31;&#x5FC5;&#x987B;&#x6D89;&#x53CA;&#x4E00;&#x4E2A;&#x5982;&#x4F55;&#x5347;&#x7EA7;&#x7EF4;&#x62A4;&#x3001;&#x4E0A;&#x7EBF;&#x4E0B;&#x7EBF;&#x670D;&#x52A1;&#x7684;&#x6D41;&#x7A0B;&#x3002;</p><ul><li>Update All Images</li><li>Rolling Restarts</li></ul><p>Docker &#x548C;&#x5176;&#x5B83;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#xFF0C;&#x4F1A; Crash&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#x53BB;&#x53D1;&#x73B0;&#x7EF4;&#x62A4;&#x8FD9;&#x4E9B;&#x6545;&#x969C;&#x3002;</p><h1 id="lesson-5-dao-di-zen-me-sheng-ji"><a href="#Lesson-5-&#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F;" class="headerlink" title="Lesson 5 - &#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F;"></a>Lesson 5 - &#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F; <a href="#lesson-5-dao-di-zen-me-sheng-ji" class="header-anchor">#</a></h1><p>&#x5347;&#x7EA7;&#x4E00;&#x5B9A;&#x8981;&#x6709;&#x8BA1;&#x5212;&#xFF0C;&#x5347;&#x7EA7;&#x9700;&#x8981;&#x8003;&#x8651;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#xFF0C;&#x6BD4;&#x5982;&#x5982;&#x679C;Swarm&#x5347;&#x7EA7;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x6709;&#x7684;&#x4F7F;&#x7528;Docker API&#x7684;&#x63D2;&#x4EF6;&#x662F;&#x5426;&#x8FD8;&#x4F1A;&#x7EE7;&#x7EED;&#x652F;&#x6301;&#xFF1F;&#x4E00;&#x822C;&#x60AC;&#x3002;</p><h1 id="lesson-7-credentials-security"><a href="#Lesson-7-Credentials-amp-Security" class="headerlink" title="Lesson 7 - Credentials &amp; Security"></a>Lesson 7 - Credentials &amp; Security <a href="#lesson-7-credentials-security" class="header-anchor">#</a></h1><ul><li>&#x4EC0;&#x4E48;&#x5E94;&#x8BE5;&#x653E;&#x5230; <code>Base Image</code> &#x91CC;&#xFF1F;</li><li>&#x628A;<code>SSH key</code>&#x6254;&#x5230;registry&#x91CC;&#xFF1F;</li><li>&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x7684;password&#xFF1F;</li><li>&#x6240;&#x6709;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF1F;</li></ul><p>&#x73B0;&#x6709;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5728; Jenkins Master &#x4E0A;&#x5B58;&#x50A8;&#x6240;&#x6709; Credentials&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5B83;&#x4EE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x5F62;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x6D4B;&#x8BD5;&#x90E8;&#x7F72;&#x73AF;&#x8282;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x786E;&#x4FDD; Jenkins Master &#x5B89;&#x5168;&#x5373;&#x53EF;&#x3002;&#x76EE;&#x524D;&#x8FD8;&#x6709;&#x522B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4ED6;&#x4EEC;&#x6682;&#x65F6;&#x91C7;&#x7528;&#x7684;&#x662F;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x3002;</p><h1 id="wo-men-cheng-gong-liao-ma"><a href="#&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F;"></a>&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F; <a href="#wo-men-cheng-gong-liao-ma" class="header-anchor">#</a></h1><ul><li>Over 1200 New Build Jobs Created</li><li>30% &#x7684;&#x73AF;&#x5883;&#x662F;&#x5BB9;&#x5668;</li><li>&#x6784;&#x5EFA;&#x73AF;&#x5883;&#x53D8;&#x5316;&#x3001;&#x521B;&#x5EFA;&#x3001;&#x4FEE;&#x590D;&#x7684;Ticket&#x6D88;&#x5931;&#x4E86;</li><li>&#x6211;&#x4EEC;&#x4E0D;&#x53EA;&#x518D;&#x662F; Build Team &#x4E86;</li></ul><p>&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x6240;&#x6709;&#x7684;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x90FD;&#x81EA;&#x52A8;&#x5316;&#x4E86;&#xFF0C;&#x800C;&#x6784;&#x5EFA;&#x73AF;&#x5883;&#x90FD; Docker &#x5316;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x4ED6;&#x4EEC;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x4ED6;&#x4EEC;&#x90FD;&#x88AB;&#x5F00;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x90FD;&#x6210;&#x4E3A;&#x4E86;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x90FD;&#x6210;&#x4E86; Docker &#x4E13;&#x5BB6;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker for Mac and Windows - 深入指南 - Justin Cormack</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-06-video-docker-for-mac-and-windows-the-insider-guide.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-06-video-docker-for-mac-and-windows-the-insider-guide.html</id>
    <published>2016-07-05T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.618Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li><li><a href="#make-it-native">Make it native</a></li><li><a href="#let-s-go-inside">Let&#x2019;s Go Inside</a></li><li><a href="#hyperkit">Hyperkit</a></li><li><a href="#datakit">DataKit</a></li><li><a href="#plumbing">Plumbing</a></li><li><a href="#moby">Moby</a><ul><li><a href="#wu-zhuang-tai">&#x65E0;&#x72B6;&#x6001;</a></li><li><a href="#mei-you-yong-hu-ke-yi-xiu-gai-de-bu-fen">&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;</a></li><li><a href="#nei-he">&#x5185;&#x6838;</a></li><li><a href="#userspace">Userspace</a></li></ul></li><li><a href="#vpnkit">VPNKit</a></li><li><a href="#osxfs">OSXfs</a></li><li><a href="#windows-file-sharing">Windows file sharing</a></li><li><a href="#yong-hu-jie-mian">&#x7528;&#x6237;&#x754C;&#x9762;</a></li><li><a href="#design">Design</a></li><li><a href="#wei-shi-me-xxx-bu-neng-yong-a">&#x4E3A;&#x4EC0;&#x4E48; XXX &#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F;</a><ul><li><a href="#net-host-de-wang-luo-bu-neng-yong"><code>--net=host</code>&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528;</a></li><li><a href="#wo-wu-fa-lian-jie-dao-rong-qi-duan-kou">&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;</a></li><li><a href="#zhu-ji-he-rong-qi-jian-de-unix-socket-bu-neng-yong">&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684; Unix socket &#x4E0D;&#x80FD;&#x7528;</a></li><li><a href="#sheng-yin-he-shi-pin">&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891;</a></li></ul></li><li><a href="#roadmap">Roadmap</a><ul><li><a href="#stability-first-features-second">Stability first, features second</a></li></ul></li><li><a href="#team">Team</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker for Mac and Windows - The Insider&#x2019;s Guide<br>by Justin Cormack, Docker (Cambridge)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/7da-B3rY9V4" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=7da-B3rY9V4" target="_blank" rel="noopener">https://www.youtube.com/watch?v=7da-B3rY9V4</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=d0314fbp2mx&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/d0314fbp2mx.html" target="_blank" rel="noopener">http://v.qq.com/x/page/d0314fbp2mx.html</a></p><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x4ED6;&#x5199;&#x7684;&#x4E66;&#xFF1A;<code>Docker in Production - Lessons from the Trenches</code>&#xFF0C;&#x5DF2;&#x7ECF;&#x6709;&#x4E2D;&#x6587;&#x7248;&#x4E86;&#xFF1A;<code>Docker &#x751F;&#x4EA7;&#x73AF;&#x5883; - &#x5B9E;&#x8DF5;&#x6307;&#x5357;</code></p><h1 id="make-it-native"><a href="#Make-it-native" class="headerlink" title="Make it native"></a>Make it native <a href="#make-it-native" class="header-anchor">#</a></h1><p>&#x5C31;&#x50CF; <code>Linux</code> &#x73AF;&#x5883;&#x4E00;&#x6837;&#xFF0C;&#x88C5;&#x4E0A;&#x4E86;&#x5C31;&#x5728;&#x90A3;&#xFF0C;&#x60F3;&#x7528;&#x968F;&#x65F6;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x4E0D;&#x9700;&#x8981; <code>Virtualbox</code>&#xFF08;&#x6CA1;&#x4EBA;&#x559C;&#x6B22;vbox&#xFF09;&#xFF0C;&#x4E0D;&#x50CF; <code>Toolbox</code> &#x90A3;&#x6837; intrusive&#x3002;&#x6700;&#x5173;&#x952E;&#x7684;&#xFF0C;&#x8BA9;&#x6587;&#x4EF6; <code>notification</code> &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF08;vbox&#x5171;&#x4EAB;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x4E0D;&#x884C;&#xFF09;</p><p>&#x5927;&#x7EA6;&#x82B1;&#x4E86;6&#x4E2A;&#x6708;&#x53BB;&#x5F00;&#x53D1;&#x3002;&#x6709;3&#x4E07;&#x4EBA;&#x5728;&#x7B2C;&#x4E00;&#x5929;&#x5C31;&#x6CE8;&#x518C;&#x8981;&#x6D4B;&#x8BD5;&#xFF0C;&#x800C;&#x5230;<code>DockerCon</code>&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x6709;7&#x4E07;&#x4EBA;&#x4E86;&#x3002;</p><h1 id="let-s-go-inside"><a href="#Let&#x2019;s-Go-Inside" class="headerlink" title="Let&#x2019;s Go Inside"></a>Let&#x2019;s Go Inside <a href="#let-s-go-inside" class="header-anchor">#</a></h1><p>Justin &#x663E;&#x793A;&#x4E86;&#x4E00;&#x4E2A; <code>ps</code> &#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x662F;&#x6240;&#x6709; <code>Docker for Mac</code> &#x7684;&#x76F8;&#x5173;&#x8FDB;&#x7A0B;&#x5217;&#x8868;&#xFF0C;&#x57FA;&#x672C;&#x53CD;&#x6620;&#x4E86;&#x5176;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;</p><h1 id="hyperkit"><a href="#Hyperkit" class="headerlink" title="Hyperkit"></a>Hyperkit <a href="#hyperkit" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5D4C;&#x5165;&#x5F0F; hypervisor toolkit&#x3002;</p><ul><li>&#x53EA;&#x5728; Mac &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;Windows &#x5219;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Hyper-V</code>&#x3002;</li><li>&#x57FA;&#x4E8E; <code>xhyve</code>&#xFF0C;&#x8FD9;&#x662F;&#x4ECE; <code>FreeBSD</code> &#x7684; <code>bhyve</code> &#x79FB;&#x690D;&#x8FC7;&#x6765;&#x7684;&#x3002;</li><li>&#x4E00;&#x4E2A; <code>hypervisor</code> &#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x6838;&#x7684;&#x5355;&#x8FDB;&#x7A0B;&#x3002;</li></ul><p>&#x51E0;&#x5E74;&#x524D; <code>OSX</code> &#x5F15;&#x5165;&#x4E86;&#x865A;&#x62DF;&#x5316;&#x6846;&#x67B6;&#xFF0C;&#x5355;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x53EF;&#x4EE5;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x4F46;&#x662F;&#x6587;&#x6863;&#x8D85;&#x70C2;&#x3002;&#x6CA1;&#x4EBA;&#x7528;&#x5B83;&#xFF0C;&#x76F4;&#x5230; <code>xhyve</code> &#x9879;&#x76EE;&#x542F;&#x52A8;&#xFF0C;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x5927;&#x7EA6;&#x91CD;&#x5199;&#x4E86; <code>bhyve</code> &#x4E00;&#x534A;&#x7684;&#x4EE3;&#x7801;&#x3002;</p><p>&#x6700;&#x521D;&#x7684; <code>Docker for Mac</code> &#x7684;&#x65E5;&#x5B50;&#x5C31;&#x662F;&#x4F7F;&#x7528; <code>xhype</code> + <code>Linux</code>&#xFF0C;&#x7136;&#x540E;&#x4E0D;&#x65AD;&#x6253;&#x8865;&#x4E01;&#x5F00;&#x59CB;&#x7684;&#x3002;</p><p>&#x7531;&#x4E8E; OS X &#x4E0D;&#x652F;&#x6301; Sparse &#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728; <code>Hyperkit</code> &#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>qcow2</code> &#x6587;&#x4EF6;&#x4F5C;&#x4E3A; <code>sparse block device</code>&#x3002;&#x4ECA;&#x5E74;&#x7684;<code>WWDC</code>&#x4E0A;&#xFF0C;&#x82F9;&#x679C;&#x8BF4;&#x5C06;&#x652F;&#x6301; <code>Sparse</code> &#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;&#x3002;</p><p>virtio device: <code>network</code>, <code>block</code>, <code>9p</code>, <code>socket</code>, <code>rng</code></p><p>&#x5185;&#x5B58;&#x3001;CPU&#x6838;&#x5FC3;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x3002;</p><h1 id="datakit"><a href="#DataKit" class="headerlink" title="DataKit"></a>DataKit <a href="#datakit" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x662F; <code>git for data structures</code>&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; <code>Git database</code>&#x3002;</p><p>&#x5728; <code>Docker for Mac/Windows</code> &#x4E2D;&#x7684;&#x5E94;&#x7528;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x4F5C;&#x4E3A;&#x914D;&#x7F6E;&#x7684;&#x5B58;&#x50A8;&#x800C;&#x5DF2;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x672C;&#x8EAB;&#x7684;&#x529F;&#x80FD;&#x5F88;&#x5F3A;&#x5927;&#xFF0C;&#x53EF;&#x4EE5;&#x50CF; <code>git</code> &#x90A3;&#x6837;&#x7684;&#x6811;&#x578B;&#x7ED3;&#x6784;&#xFF0C;&#x4EE5;&#x53CA;&#x5206;&#x652F;<code>fork</code>, <code>merge</code>&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x5BF9;&#x4E8E;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x800C;&#x8A00;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x3002;<code>9p</code></p><p>Docker&#x7684;&#x914D;&#x7F6E;&#x5C31;&#x5B58;&#x50A8;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x4E2A; git repository&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Containers/com.docker.docker/Data/database</span><br></pre></td></tr></table></figure><p>&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x8FD9;&#x91CC;&#x4FEE;&#x6539;&#xFF0C;&#x6BD4;&#x5982;CPU&#x6838;&#xFF0C;Docker <code>storage driver</code>&#x7B49;&#x7B49;&#x3002;<code>commit</code> &#x540E;&#xFF0C;<code>Docker for Mac</code>&#x5C06;&#x4F1A;&#x91CD;&#x542F;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x5C06;&#x6765;&#x4F1A;&#x5728; GUI &#x4E2D;&#x7684; Advanced &#x91CC;&#x9762;&#x6DFB;&#x52A0;&#x8FDB;&#x53BB;&#x3002;</p><p>&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x5728;VM&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;<code>/Database/branch/master/ro/com.docker.driver.amd64-linux/</code></p><p>Justin &#x5728;&#x6267;&#x884C;&#x8FD9;&#x4E2A;VM&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4ED6;&#x6267;&#x884C;&#x4E86;&#x4E00;&#x4E2A; Docker &#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh</span><br></pre></td></tr></table></figure><h1 id="plumbing"><a href="#Plumbing" class="headerlink" title="Plumbing"></a>Plumbing <a href="#plumbing" class="header-anchor">#</a></h1><p>&#x6700;&#x540E;&#x5728;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x4E2D;&#x95F4;&#x9009;&#x62E9;&#x4E86; <code>VSock</code> &#x548C; <code>HVSock</code>&#x3002;&#x7528;&#x4ED6;&#x4EEC;&#x6765;&#x8FDB;&#x884C; <code>VM</code> &#x95F4;&#x7684;&#x901A;&#x8BAF;&#xFF0C;&#x5C31;&#x50CF; <code>Unix sockets</code> &#x4E00;&#x6837;&#x3002;</p><p><code>VSock</code> &#x6700;&#x521D;&#x662F;&#x7531; <code>VMWare</code> &#x5F00;&#x53D1;&#xFF0C;&#x800C; <code>HVSock</code> &#x662F;&#x5FAE;&#x8F6F;&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x8BBE;&#x8BA1;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E0D;&#x540C;&#x3002;</p><p>&#x8FD9;&#x4E9B;&#x65B0;&#x7684; socket &#x6CA1;&#x6709;&#x5F88;&#x597D;&#x5730;&#x652F;&#x6301;&#xFF0C;&#x6CA1;&#x6709; <code>Go</code> &#x7684;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x591F;&#x901A;&#x8FC7; <code>C</code> &#x7ED1;&#x5B9A;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p><p>&#x901A;&#x8BAF;&#x7531;&#x4E8E;&#x4E0D;&#x662F;&#x8D70;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x7F51;&#x7EDC;&#x6709;&#x6545;&#x969C;&#xFF0C;&#x901A;&#x8BAF;&#x4E5F;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;&#x9664;&#x4E86;VM&#x95F4;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x5BBF;&#x4E3B;&#x548C;VM&#x7684;&#x901A;&#x8BAF;&#x3002;&#xFF08;&#x63D0;&#x5230;&#x4E86;VM&#x95F4;&#xFF0C;&#x662F;&#x5426;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x50CF; Toolbox &#x90A3;&#x6837;&#x6709;&#x591A;&#x5BBF;&#x4E3B;&#xFF1F;&#xFF09;</p><h1 id="moby"><a href="#Moby" class="headerlink" title="Moby"></a>Moby <a href="#moby" class="header-anchor">#</a></h1><p><code>Moby Dock</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;Docker&#x90A3;&#x53EA;&#x9CB8;&#x9C7C;&#x5409;&#x7965;&#x7269;&#x7684;&#x540D;&#x5B57;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x627F;&#x8F7D; Docker &#x4E3B;&#x673A;&#x7684; Linux &#x9879;&#x76EE;&#x7684;code name&#x3002;</p><p><a href="https://youtu.be/9xciauwbsuo" target="_blank" rel="noopener">https://youtu.be/9xciauwbsuo</a></p><h2 id="wu-zhuang-tai"><a href="#&#x65E0;&#x72B6;&#x6001;" class="headerlink" title="&#x65E0;&#x72B6;&#x6001;"></a>&#x65E0;&#x72B6;&#x6001; <a href="#wu-zhuang-tai" class="header-anchor">#</a></h2><p><code>Moby</code> &#x662F;&#x57FA;&#x4E8E; <code>Alpine Linux</code>&#xFF0C;<code>Alpine Linux</code> &#x5DF2;&#x7ECF;&#x6709;8&#x5E74;&#x5386;&#x53F2;&#x4E86;&#x3002;&#x662F;&#x5B89;&#x5168;&#x7684;&#x8F7B;&#x91CF;&#x7EA7;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x57FA;&#x4E8E; <code>musl libc</code>  &#x4EE5;&#x53CA; <code>busybox</code>&#x3002;</p><p>Alpine &#x7684;&#x8BBE;&#x8BA1;&#x610F;&#x56FE;&#x662F;<strong>&#x65E0;&#x72B6;&#x6001;</strong> &#x7684;&#xFF0C;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x5728; <code>ramdisk</code> &#x4E4B;&#x7C7B;&#x7684;&#x5730;&#x65B9;&#x8FD0;&#x884C;&#xFF0C;&#x6839;&#x672C;&#x4E0D;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#xFF0C;&#x91CD;&#x542F;&#x4E4B;&#x540E;&#x4E00;&#x5207;&#x6062;&#x590D;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x6070;&#x597D;&#x662F;&#x548C;Docker&#x5BB9;&#x5668;&#x7684;&#x77ED;&#x751F;&#x5B58;&#x5468;&#x671F;&#x7684;&#x7406;&#x5FF5;&#x4E00;&#x81F4;&#x3002;</p><p><code>/var</code> &#x76EE;&#x5F55;&#x662F;&#x53EF;&#x4EE5;&#x4FDD;&#x7559;&#x7684;&#xFF0C;Docker &#x8D1F;&#x8D23;&#x8FD9;&#x4E2A;&#x4E86;&#x3002;</p><p><code>/Database</code> &#x73B0;&#x5728;&#x6302;&#x8F7D;&#x4E0A;&#x4E86; <code>Datakit</code> &#x7684;&#x6570;&#x636E;&#x5E93;&#x3002;</p><p>&#x50CF; <code>Phoenix</code> &#x4E00;&#x6837;&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x65B0;&#x7684; <code>image</code>&#xFF0C;&#x6CA1;&#x6709;&#x5347;&#x7EA7;&#x66F4;&#x65B0;&#x3002;</p><p>&#x975E;&#x5E38;&#x7CBE;&#x7B80;&#xFF0C;&#x53EA;&#x8FD0;&#x884C; Docker &#x548C;&#x6240;&#x9700;&#x7684;&#x4E1C;&#x897F;&#x3002;</p><h2 id="mei-you-yong-hu-ke-yi-xiu-gai-de-bu-fen"><a href="#&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;" class="headerlink" title="&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;"></a>&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206; <a href="#mei-you-yong-hu-ke-yi-xiu-gai-de-bu-fen" class="header-anchor">#</a></h2><ul><li>Just works&#xFF0C;&#x786E;&#x4FDD; Docker &#x8FD0;&#x884C;&#x3002;</li><li>&#x6240;&#x6709;&#x914D;&#x7F6E;&#x90FD;&#x5728; <code>Datakit</code> &#x7684;<code>database</code>&#x91CC;&#x3002;</li><li>&#x5982;&#x679C;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x5BBF;&#x4E3B;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7; <code>--privileged</code> &#x7684;&#x5BB9;&#x5668;&#x6765;&#x8FDB;&#x884C;&#xFF0C;&#x800C;&#x4E14;&#x901A;&#x8FC7; <code>--restart=always</code> &#x6765;&#x4FDD;&#x6301;&#x6301;&#x4E45;&#x5316;&#x3002;</li><li>&#x6BD4;&#x5982;&#x5B89;&#x88C5; <code>sysdig</code> &#x5185;&#x6838;&#x6A21;&#x5757;</li><li>root shell: <code>docker run -it &#x2014;privileged &#x2014;pid=host debian nsenter -t 1 -m -u -n -i sh</code></li><li>&#x53EF;&#x4EE5; <code>apk update</code> &#x6216;&#x8005; <code>apk install gdb</code>&#x4E4B;&#x7C7B;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4F46;&#x662F;&#x91CD;&#x542F;&#x5C31;&#x90FD;&#x6CA1;&#x4E86;&#x3002;</li></ul><h2 id="nei-he"><a href="#&#x5185;&#x6838;" class="headerlink" title="&#x5185;&#x6838;"></a>&#x5185;&#x6838; <a href="#nei-he" class="header-anchor">#</a></h2><ul><li>&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>stable 4.4.x</code> &#x7CFB;&#x5217;&#x7684;&#x5185;&#x6838;&#xFF0C;&#x5916;&#x52A0; <code>aufs</code>, <code>vsock</code>, <code>hvsock</code> &#x8865;&#x4E01;&#x3002;</li><li>&#x6CA1;&#x6709;&#x6A21;&#x5757;&#xFF0C;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x5185;&#x7F6E;&#x4E86;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x5FEB;&#x901F;&#x542F;&#x52A8;&#xFF0C;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x6A21;&#x5757;</li><li>&#x73B0;&#x5728;&#x652F;&#x6301; <code>aufs</code> &#x548C; <code>overlay</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <code>aufs</code> &#x65B0;&#x7684; <code>1.12</code> &#x53D1;&#x5E03;&#x5E26;&#x6765;&#x4E86;&#x65B0;&#x7684; <code>overlay2</code> &#x7684;&#x652F;&#x6301;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x4E4B;&#x524D; <code>overlay</code> &#x7684;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x80FD;&#x4E0D;&#x5C31;&#x8FD9;&#x91CC;&#x5207;&#x6362;&#x5230;&#x9ED8;&#x8BA4; <code>overlay2</code>&#x3002;</li><li>&#x652F;&#x6301; <code>NFS</code>, <code>SMB</code>, <code>CRIU</code> &#x4E4B;&#x7C7B;&#x7684;</li><li>&#x652F;&#x6301; <code>binfmt_misc</code> &#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>QEMU</code> &#x8FD0;&#x884C; <code>ARM</code>&#x3001;<code>PowerPC</code>, <code>MIPS</code> &#x6216;&#x8005;&#x5176;&#x4ED6;&#x6784;&#x67B6;&#x7684;&#x53EF;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#xFF08;&#x8D85;&#x8D5E;&#xFF09;&#x3002;</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it justincormack/armdemo uname -a</span><br><span class="line">Linux a764b3418f3d 4.4.14-moby <span class="comment">#1 SMP Tue Jul 5 02:07:16 UTC 2016 armv7l Linux</span></span><br><span class="line">$ docker run -it justincormack/armdemo file /bin/busybox</span><br><span class="line">/bin/busybox: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-armhf.so.1, stripped</span><br></pre></td></tr></table></figure><ul><li>&#x914D;&#x7F6E;&#x5728; <code>/proc/config.gz</code> &#x91CC;&#xFF0C;&#x8865;&#x4E01;&#x5728; <code>/etc/kernel-patches</code> &#x91CC;&#x3002;</li></ul><h2 id="userspace"><a href="#Userspace" class="headerlink" title="Userspace"></a>Userspace <a href="#userspace" class="header-anchor">#</a></h2><ul><li><code>Alpine 3.4</code></li><li><code>&#x9759;&#x6001;&#x7F16;&#x8BD1;</code>&#x7684; Docker &#x5E76;&#x4E14;&#x5E26; <code>seccomp</code> &#x652F;&#x6301;&#xFF08;&#x6682;&#x4E0D;&#x652F;&#x6301; <code>AppArmor</code>&#xFF0C;&#x53EF;&#x80FD;&#x5C06;&#x665A;&#x4E9B;&#x65F6;&#x5019;&#x4F1A;&#x652F;&#x6301;&#xFF09;&#x3002;</li><li>&#x8FD8;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E9B;&#x5982;&#x65F6;&#x95F4;&#x540C;&#x6B65;&#x4E4B;&#x7C7B;&#x7684;&#x529F;&#x80FD;&#xFF0C;<code>Kubernetes</code> &#x9700;&#x8981;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x7684;&#x652F;&#x6301;</li></ul><h1 id="vpnkit"><a href="#VPNKit" class="headerlink" title="VPNKit"></a>VPNKit <a href="#vpnkit" class="header-anchor">#</a></h1><p>&#x73B0;&#x5728;&#x662F;&#x5728; Mac &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x76EE;&#x524D;&#x6B63;&#x5728; Windows &#x4E0A;&#x6D4B;&#x8BD5;&#xFF08;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#xFF09;&#x3002;</p><p>&#x5C06;&#x6240;&#x6709; Linux VM &#x4E2D;&#x7684;&#x4EE5;&#x592A;&#x7F51; traffic &#x90FD;&#x5728; OS X &#x4E0A;&#x91CD;&#x6784;&#x6210;<strong>&#x5E94;&#x7528;</strong>&#x7EA7;&#x7684;traffic&#xFF0C;&#x6240;&#x4EE5;&#x5728; OS X &#x4E0A;&#x770B;&#x5230;&#x7684;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7A0B;&#x5E8F;&#x5728;&#x6253;&#x5F00;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5EFA;&#x7ACB;&#x4E00;&#x4E9B;&#x5947;&#x602A;&#x7684;network interface&#x4E86;&#x3002;</p><p>&#x8FD9;&#x6837;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x7684;&#x5904;&#x7406; VPN, &#x9632;&#x706B;&#x5899;&#x7B49;&#x8FD9;&#x4E9B;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x73AF;&#x5883;&#xFF0C;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x73AF;&#x5883;&#x4E2D;&#x5BB9;&#x5668;&#x65E0;&#x6CD5;&#x4E0A;&#x7F51;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>VPNKit &#x4F7F;&#x7528;&#x4E86; <code>Mirage Unikernel</code> &#x4E2D;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x3002;<br><code>Mirage</code> &#x662F;&#x5E95;&#x5C42;&#x7684;&#x7CFB;&#x7EDF;&#x5E93;&#xFF0C;&#x4F7F;&#x7528; <code>OCaml</code> &#x5199;&#x7684; (<code>functional programming language</code>)<br>&#x5F88;&#x5BB9;&#x6613;&#x79FB;&#x690D;&#x5230;&#x522B;&#x7684;&#x5730;&#x65B9;&#x4F7F;&#x7528;&#x3002;</p><h1 id="osxfs"><a href="#OSXfs" class="headerlink" title="OSXfs"></a>OSXfs <a href="#osxfs" class="header-anchor">#</a></h1><ul><li>&#x73B0;&#x5728;&#x662F;&#x5728; Mac &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x76EE;&#x524D;&#x5728; Windows&#x4E0A;&#x8FD8;&#x662F;&#x901A;&#x8FC7;SMB&#x7ED1;&#x5B9A;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF08;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x5728;Windows&#x4E0A;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x540D;&#x5B57;&#x6050;&#x6015;&#x5F97;&#x6362;&#xFF09;&#x3002;</li><li>&#x5728; Linux &#x90E8;&#x5206;&#x7528;&#x7684;&#x662F; <code>FUSE</code> &#x6765;&#x627F;&#x63A5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;&#x5904;&#x7406;</li><li>&#x5C06;&#x6240;&#x6709;&#x901A;&#x8BAF;&#x8F6C;&#x79FB;&#x5230; <code>VSock</code> &#xFF0C;&#x5E76;&#x4E14;&#x8F6C;&#x6362;&#x6210; OSX &#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</li><li>&#x76D1;&#x542C; OSX &#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x901A;&#x77E5;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B83;&#x53D8;&#x6210; Linux &#x7684;&#x4E8B;&#x4EF6;&#x8F6C;&#x53D1;&#x8FC7;&#x53BB;&#x3002;</li></ul><p>&#x56E0;&#x6B64; <code>inotify</code> &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528;&#x4E86;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;OSX&#x6CA1;&#x6709;&#x8BFB;&#x6587;&#x4EF6;&#x4E8B;&#x4EF6;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4ECE;&#x6784;&#x67B6;&#x4E0A;&#xFF0C;<code>OSXfs</code> &#x548C; <code>VPNKit</code> &#x975E;&#x5E38;&#x63A5;&#x8FD1;&#xFF0C;&#x4E8C;&#x8005;&#x90FD;&#x662F;&#x628A;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x4E4B;&#x95F4;&#x7684;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x3002;</p><p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x4EE5;&#x5F53;&#x524D;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x7ED1;&#x5B9A;&#x5377;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x60C5;&#x76F4;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x3002;&#x800C;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x4E0D;&#x5E0C;&#x671B;&#x5B83;&#x4EE5;root&#x6267;&#x884C;&#x3002;&#x800C;&#x5728; Linux &#x548C;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x80AF;&#x5B9A;&#x4E0D;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x67D0;&#x4E2A;&#x5EFA;&#x7ACB;&#x7684;&#x6587;&#x4EF6;&#x4F7F;&#x7528;&#x7684;&#x662F; Mac &#x4E0A;&#x7684; UID&#x3002;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x6709;&#x8F6C;&#x6362;&#xFF0C;&#x4F1A;&#x663E;&#x793A;&#x8BE5;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x7528;&#x6237;&#x7684;ID&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x5047;&#x7684;&#x3002;</p><h1 id="windows-file-sharing"><a href="#Windows-file-sharing" class="headerlink" title="Windows file sharing"></a>Windows file sharing <a href="#windows-file-sharing" class="header-anchor">#</a></h1><p>&#x5F53;&#x524D; Linux &#x5230; Windows &#x4E4B;&#x95F4;&#x7684;&#x6587;&#x4EF6;&#x5171;&#x4EAB;&#x4F7F;&#x7528;&#x7684;&#x662F; SMB<br>&#x867D;&#x7136;&#x534F;&#x8BAE;&#x4E0A;&#x8BB2; SMB &#x652F;&#x6301; <code>FS Notifications</code>&#xFF0C;&#x4F46;&#x662F; Linux &#x5B9E;&#x73B0;&#x4E0A;&#x6CA1;&#x4EBA;&#x613F;&#x610F;&#x53BB;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x652F;&#x6301;&#x3002;<br>&#x6211;&#x4EEC;&#x5C06;&#x6765;&#x4F1A;&#x8BBE;&#x6CD5;&#x79FB;&#x690D; <code>OSXfs</code> &#x5230; Windows &#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x50CF; Mac &#x4E00;&#x6837;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x9700;&#x8981;&#x65F6;&#x95F4;&#xFF0C;Windows &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x548C; Linux &#x7684;&#x5DEE;&#x5F02;&#x5C31;&#x66F4;&#x5927;&#x4E86;&#x3002;</p><h1 id="yong-hu-jie-mian"><a href="#&#x7528;&#x6237;&#x754C;&#x9762;" class="headerlink" title="&#x7528;&#x6237;&#x754C;&#x9762;"></a>&#x7528;&#x6237;&#x754C;&#x9762; <a href="#yong-hu-jie-mian" class="header-anchor">#</a></h1><ul><li>&#x73B0;&#x5728;&#x5F88;&#x7CBE;&#x7B80;&#xFF0C;&#x5C06;&#x6765;&#x4F1A;&#x6709;&#x66F4;&#x591A;&#x7684;&#x529F;&#x80FD;&#x52A0;&#x8FDB;&#x6765;&#x3002;</li><li>&#x662F;<code>Native</code>&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;OSX&#x4E0A;&#x7528;&#x7684;&#x662F;<code>Swift</code>&#xFF1B;&#x5728;Windows&#x4E0A;&#x7528;&#x7684;&#x662F;<code>C#</code>&#x3002;</li><li>&#x901A;&#x8FC7; <code>Datakit</code> &#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</li><li>&#x8BA1;&#x5212;&#x4F1A;&#x628A; <code>Kinematic</code> &#x6216;&#x8005;&#x5176;&#x5B83;&#x7684;&#x754C;&#x9762;&#x96C6;&#x6210;&#x8FDB;&#x6765;&#x3002;</li></ul><h1 id="design"><a href="#Design" class="headerlink" title="Design"></a>Design <a href="#design" class="header-anchor">#</a></h1><p>&#x4E00;&#x7FA4;&#x53E4;&#x602A;&#x7684;&#x9CB8;&#x9C7C;&#xFF0C;&#x6709; Lauro? &#x8BBE;&#x8BA1;</p><h1 id="wei-shi-me-xxx-bu-neng-yong-a"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-XXX-&#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; XXX &#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; XXX &#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F; <a href="#wei-shi-me-xxx-bu-neng-yong-a" class="header-anchor">#</a></h1><h2 id="net-host-de-wang-luo-bu-neng-yong"><a href="#net-host&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528;" class="headerlink" title="--net=host&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528;"></a><code>--net=host</code>&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528; <a href="#net-host-de-wang-luo-bu-neng-yong" class="header-anchor">#</a></h2><p>&#x539F;&#x56E0;&#x662F;&#x76EE;&#x524D;&#x4F7F;&#x7528;&#x4E86; <code>VPNKit</code> &#x540E;&#xFF0C;&#x5F53;&#x5BB9;&#x5668;&#x901A;&#x8FC7; <code>--publish</code> &#x516C;&#x5F00;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x901A;&#x8BAF;&#x662F;&#x901A;&#x8FC7; <code>/port</code> <code>9p</code> &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4F20;&#x9012;&#x7ED9; Mac &#x7684;&#xFF0C;&#x7136;&#x540E; Mac &#x90E8;&#x5206;&#x4F1A;&#x5F00;&#x59CB;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x76D1;&#x542C;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#x3002;</p><p>&#x8FD9;&#x6837;&#x5728; Mac &#x4E0A;&#x5F53;&#x4F60;&#x8FDE;&#x63A5; <code>localhost:nnn</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5C06;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x8F6C;&#x53D1;&#x7ED9; Linux&#xFF0C;&#x5E76;&#x8FDB;&#x800C;&#x8F6C;&#x53D1;&#x7ED9;&#x5BB9;&#x5668;&#x3002;&#x540C;&#x6837;&#xFF0C;&#x5728;Docker Swarm&#x4E0B;&#x4E5F;&#x662F;&#x8FD9;&#x4E48;&#x7528;&#x7684;&#x3002;&#xFF08;<em>&#x5C06;&#x6765;&#x5FC5;&#x7136;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x5BBF;&#x4E3B;</em>&#xFF09;</p><p>&#x4F46;&#x662F;&#x5F53;&#x4F7F;&#x7528; <code>--net=host</code> &#x540E;&#xFF0C;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x5C06;&#x4E0D;&#x4F1A;&#x901A;&#x77E5; Docker&#xFF0C;&#x6240;&#x4EE5; Docker &#x6CA1;&#x6709;&#x8F7B;&#x6613;&#x7684;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5C06;&#x6765;&#x4F1A;&#x60F3;&#x529E;&#x6CD5;&#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p><h2 id="wo-wu-fa-lian-jie-dao-rong-qi-duan-kou"><a href="#&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;" class="headerlink" title="&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;"></a>&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3; <a href="#wo-wu-fa-lian-jie-dao-rong-qi-duan-kou" class="header-anchor">#</a></h2><p>&#x4E0D;&#x50CF;&#x4EE5;&#x524D; <code>Docker Toolbox</code> &#x6216;&#x8005; Linux &#x4E0A;&#x90A3;&#x6837;&#xFF0C;Mac &#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x8DEF;&#x7531;&#x901A;&#x8DEF;&#xFF08;<code>bridge</code>)&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;IP&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x3002;</p><p>&#x5982;&#x679C;&#x9700;&#x8981;&#x8C03;&#x8BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53E6;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982; <code>docker run --net=container:name</code></p><p>&#x5176;&#x5B9E;&#x5E94;&#x8BE5;&#x4E60;&#x60EF;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x6BD5;&#x7ADF;&#x5728;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#xFF08;<code>overlay network</code>&#xFF09;&#x8C03;&#x8BD5;&#x4E2D;&#xFF0C;&#x53EA;&#x80FD;&#x8FD9;&#x6837;&#x8C03;&#x8BD5;&#xFF0C;&#x5BBF;&#x4E3B;&#x662F;&#x65E0;&#x6CD5;&#x548C;&#x53E6;&#x4E00;&#x53F0;&#x5BBF;&#x4E3B;&#x7684;&#x5BB9;&#x5668;&#x76F4;&#x63A5;&#x901A;&#x8BAF;&#x7684;&#x3002;</p><p>&#x66FE;&#x7ECF;&#x6709;&#x4E00;&#x5EA6;&#x80FD;&#x7528;&#x6765;&#x7740;&#xFF0C;&#x540E;&#x6765;&#x4E0D;&#x80FD;&#x4E86;&#xFF0C;&#x6BD5;&#x7ADF;&#x5BBF;&#x4E3B;&#x4E0D;&#x518D;&#x6709;<code>bridge</code>&#x63A5;&#x53E3;&#x4E86;&#x3002;&#x5C06;&#x6765;&#x662F;&#x4E0D;&#x662F;&#x8FD8;&#x4F1A;&#x652F;&#x6301;&#x2026;&#x2026;&#x5F88;&#x96BE;&#x8BF4;&#x3002;</p><h2 id="zhu-ji-he-rong-qi-jian-de-unix-socket-bu-neng-yong"><a href="#&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684;-Unix-socket-&#x4E0D;&#x80FD;&#x7528;" class="headerlink" title="&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684; Unix socket &#x4E0D;&#x80FD;&#x7528;"></a>&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684; Unix socket &#x4E0D;&#x80FD;&#x7528; <a href="#zhu-ji-he-rong-qi-jian-de-unix-socket-bu-neng-yong" class="header-anchor">#</a></h2><p>&#x5176;&#x5B9E;&#x8FD9;&#x4E0D;&#x602A;&#x6211;&#x4EEC;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x5C3D;&#x91CF;&#x8BA9;&#x5927;&#x5BB6;&#x611F;&#x89C9;&#x5BB9;&#x5668;&#x662F;&#x76F4;&#x63A5;&#x5728; Mac &#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x4F46;&#x662F; Mac &#x548C; &#x5BB9;&#x5668;&#x4E0D;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#xFF0C;&#x4E2D;&#x95F4;&#x8FD8;&#x6709;&#x4E2A; Linux &#x5462;&#x2026;&#x2026;</p><p>&#x4E0D;&#x8FC7;&#x5C06;&#x6765;&#x786E;&#x5B9E;&#x6253;&#x7B97;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x901A;&#x8FC7; <code>OSXfs</code> &#x548C; <code>VSock</code> &#x900F;&#x660E;&#x4EE3;&#x7406;&#x3002;&#x5F53;&#x524D;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x90E8;&#x5206;&#x5728;&#x8FD9;&#x4E48;&#x7528;&#x4E86;&#xFF0C;&#x5728; Docker socket &#x4E0A;&#x3002;</p><p>&#x76EE;&#x524D;&#xFF0C;&#x7528; TCP &#x5C31;&#x597D;&#x4E86;&#x3002;</p><h2 id="sheng-yin-he-shi-pin"><a href="#&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891;" class="headerlink" title="&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891;"></a>&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891; <a href="#sheng-yin-he-shi-pin" class="header-anchor">#</a></h2><p><code>X Win</code>, <code>RDP</code>, <code>VNC</code>, <code>HTTP GUI</code> &#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x8BBE;&#x6CD5;&#x8BA9;&#x5B83;&#x4EEC;&#x80FD;&#x5DE5;&#x4F5C;&#xFF0C;<code>Audio</code> &#x4F30;&#x8BA1;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x3002;<br>&#x76EE;&#x524D;&#x4E0D;&#x662F;&#x5F88;&#x591A;&#x4EBA;&#x9700;&#x8981;&#x8FD9;&#x4E9B;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x613F;&#x610F;&#x53EF;&#x4EE5;&#x5E2E;&#x5FD9;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;</p><h1 id="roadmap"><a href="#Roadmap" class="headerlink" title="Roadmap"></a>Roadmap <a href="#roadmap" class="header-anchor">#</a></h1><h2 id="stability-first-features-second"><a href="#Stability-first-features-second" class="headerlink" title="Stability first, features second"></a>Stability first, features second <a href="#stability-first-features-second" class="header-anchor">#</a></h2><p>&#x76EE;&#x524D;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x800C;&#x4E0D;&#x662F;<code>feature</code>&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x7528;&#x6237;&#x9A71;&#x52A8; feature &#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5C3D;&#x60C5;&#x6765;&#x66FF;&#x81EA;&#x5DF1;&#x7684;&#x60F3;&#x6CD5;&#x3002;</p><h1 id="team"><a href="#Team" class="headerlink" title="Team"></a>Team <a href="#team" class="header-anchor">#</a></h1><p>&#x56E2;&#x961F;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x5728; DockerCon &#x73B0;&#x573A;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x6709;&#x5F88;&#x591A; Docker &#x7684;&#x5458;&#x5DE5;&#x8D21;&#x732E;&#x4E86;&#x4EE3;&#x7801;&#x3002;&#x5E76;&#x4E14;&#x5305;&#x542B;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF08;&#x7279;&#x522B;&#x662F; <code>bhyve</code>, <code>xhyve</code>, <code>Mirage</code>, <code>Alpine Linux</code>&#xFF09;</p><p>&#x5E7B;&#x706F;&#x7247;&#x5728;&#xFF1A;<code>docker run -d -P justincormack/dockercon2016</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 安全探究</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-05-video-docker-security-deep-dive.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-05-video-docker-security-deep-dive.html</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.617Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker Security Deep Dive</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/tL4IYSKu7ZU" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=tL4IYSKu7ZU" target="_blank" rel="noopener">https://www.youtube.com/watch?v=tL4IYSKu7ZU</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=m0314drzxnd&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/m0314drzxnd.html" target="_blank" rel="noopener">http://v.qq.com/x/page/m0314drzxnd.html</a></p><p>Docker 1.12 &#x4E2D;&#x96C6;&#x6210;&#x7684; Swarm mode &#x96C6;&#x6210;&#x4E86;CA&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x52A8;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x8BC1;&#x4E66;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x662F;&#x5B89;&#x5168;&#x7684;&#x3002;</p><p>Docker &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; Docker bench security &#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x81EA;&#x52A8;&#x6839;&#x636E; CIS Docker Benchmark &#x6765;&#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;&#x5206;&#x6790;&#x3002;</p><p><a href="https://github.com/docker/docker-bench-security" target="_blank" rel="noopener">https://github.com/docker/docker-bench-security</a></p><p>&#x53D7;&#x8FD9;&#x4E2A;&#x89C6;&#x9891;&#x7684;&#x542F;&#x53D1;&#xFF0C;Linux &#x7684;&#x5B89;&#x5168;&#x5BA1;&#x67E5;&#x5DE5;&#x5177;&#xFF1A; <a href="https://cisofy.com/lynis/" target="_blank" rel="noopener">https://cisofy.com/lynis/</a>  &#x7528;&#x4E8E;&#x4E3B;&#x673A;&#x5BA1;&#x67E5;&#x4E5F;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：对于 OpenStack 日志管理而言 Fluentd 和 Logstash 对比 - Masaki Matsushita</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-05-video-fluentd-vs-logstash-for-openstack-log-management.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-05-video-fluentd-vs-logstash-for-openstack-log-management.html</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.617Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#fluentd">Fluentd</a></li><li><a href="#logstash">Logstash</a></li><li><a href="#chu-li-fen-liu-ji-ju-he-ri-zhi">&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7;</a></li><li><a href="#cha-jian">&#x63D2;&#x4EF6;</a></li><li><a href="#chuan-shu-xie-yi">&#x4F20;&#x8F93;&#x534F;&#x8BAE;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Fluentd vs. Logstash for OpenStack Log Management<br>by Masaki Matsushita from NTT<br>(2015/10/28)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/1ye0-sityBw" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=1ye0-sityBw" target="_blank" rel="noopener">https://www.youtube.com/watch?v=1ye0-sityBw</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0314dpog04&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/b0314dpog04.html" target="_blank" rel="noopener">http://v.qq.com/x/page/b0314dpog04.html</a></p><h1 id="fluentd"><a href="#Fluentd" class="headerlink" title="Fluentd"></a>Fluentd <a href="#fluentd" class="header-anchor">#</a></h1><ul><li>Written in CRuby</li><li>Used in Kubernetes</li><li>by Treasure Data</li></ul><h1 id="logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash <a href="#logstash" class="header-anchor">#</a></h1><ul><li>Written in JRuby</li><li>by elastic.co</li></ul><h1 id="chu-li-fen-liu-ji-ju-he-ri-zhi"><a href="#&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7;" class="headerlink" title="&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7;"></a>&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7; <a href="#chu-li-fen-liu-ji-ju-he-ri-zhi" class="header-anchor">#</a></h1><p>Fluentd&#x5728;<code>&lt;source&gt;</code>&#x4E2D;&#x4F1A;&#x6253;&#x4E0A;<code>tag</code>&#xFF0C;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x901A;&#x8FC7;<code>&lt;match &gt;</code>&#x5176;&#x4E2D;&#x7684;<code>tag</code>&#x6765;&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x6267;&#x884C;&#x3002;</p><p>Logstash &#x4E2D;&#x6CA1;&#x6709; <code>tag</code>&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x6709;&#x5728;&#x8F93;&#x51FA;&#x7684;&#x65F6;&#x5019;&#x901A;&#x8FC7;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x53BB;&#x51B3;&#x5B9A;&#x5E94;&#x8BE5;&#x9001;&#x7ED9;&#x8C01;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;Logstash &#x66F4;&#x9002;&#x5408;&#x9ED8;&#x8BA4;&#x805A;&#x5408;&#x7684;&#x6D41;&#xFF0C;&#x800C; Fluentd &#x66F4;&#x9002;&#x5408;&#x7075;&#x6D3B;&#x7684;&#x6D41;&#x3002;</p><h1 id="cha-jian"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6; <a href="#cha-jian" class="header-anchor">#</a></h1><ul><li>Fluentd: 300+</li><li>Logstash: 200+</li></ul><p>Logstash&#x7684;&#x5927;&#x591A;&#x6D41;&#x884C;&#x63D2;&#x4EF6;&#x7531; Logstash &#x9879;&#x76EE;&#x7EF4;&#x62A4;&#xFF0C;&#x96C6;&#x6210;&#x4E8E; logstash &#x4E2D;&#x3002;<br>&#x800C; Fluentd &#x53EA;&#x5305;&#x542B;&#x6700;&#x57FA;&#x672C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x63D2;&#x4EF6;&#x7531;&#x4E2A;&#x4EBA;&#x7EF4;&#x62A4;&#x3002;</p><h1 id="chuan-shu-xie-yi"><a href="#&#x4F20;&#x8F93;&#x534F;&#x8BAE;" class="headerlink" title="&#x4F20;&#x8F93;&#x534F;&#x8BAE;"></a>&#x4F20;&#x8F93;&#x534F;&#x8BAE; <a href="#chuan-shu-xie-yi" class="header-anchor">#</a></h1><p>Fluentd &#x4F7F;&#x7528; <code>forward</code> protocol&#xFF0C;&#x53EF;&#x4EE5;<code>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</code>(&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;<code>weight</code>)&#xFF0C;&#x6216;&#x8005;<code>active-standby</code><br>Logstash &#x4F7F;&#x7528; <code>Lumberjack</code> protocol&#xFF0C;&#x53EA;&#x53EF;&#x4EE5; <code>active-standby</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="fluentd" scheme="https://1x481n.github.io/blog.lab99.org/tags/fluentd/"/>
    
      <category term="logstash" scheme="https://1x481n.github.io/blog.lab99.org/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 1.12 新功能 - Mike Goelzer</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-05-video-what-is-new-in-docker-1-12.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-05-video-what-is-new-in-docker-1-12.html</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.617Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#swarm-mode">Swarm Mode</a></li><li><a href="#services">Services</a></li><li><a href="#node-failure">Node Failure</a></li><li><a href="#scaling">Scaling</a></li><li><a href="#global-services">Global Services</a></li><li><a href="#constraints">Constraints</a></li><li><a href="#services-tasks-containers"><code>Services</code> &#x2192; <code>Tasks</code> &#x2192; <code>Containers</code></a></li><li><a href="#stack-shi-service-de-ji-he"><code>Stack</code> &#x662F; <code>Service</code> &#x7684;&#x96C6;&#x5408;</a></li><li><a href="#distributed-application-bundle-dab-sheng-ming-liao-yi-ge-stack">Distributed Application Bundle (.dab) &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A; Stack</a></li><li><a href="#swarm-mode-is-optional">Swarm mode is optional</a></li><li><a href="#routing-mesh">Routing Mesh</a></li><li><a href="#security-by-default">Security by default</a></li><li><a href="#container-health-check-in-dockerfile">Container Health Check in <code>Dockerfile</code></a></li><li><a href="#new-plugin-subcommands">New Plugin Subcommands</a></li><li><a href="#orchestration-deep-dive-andrea-luzzardi">Orchestration Deep Dive - Andrea Luzzardi</a><ul><li><a href="#swarm-topology">Swarm Topology</a></li><li><a href="#docker-swarm-communication-internals">Docker Swarm Communication Internals</a></li><li><a href="#quorum-layer">Quorum Layer</a></li></ul></li><li><a href="#node-breakdown">Node Breakdown</a><ul><li><a href="#nei-zhi-fu-zai-jun-heng">&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><li><a href="#ingress-fu-zai-jun-heng">Ingress &#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - What&#x2019;s New in Docker 1.12<br>by Mike Goelzer, Andrea Luzzardi from Docker</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/FgXJKw37po8" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=FgXJKw37po8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=FgXJKw37po8</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0314l51xc7&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/b0314l51xc7.html" target="_blank" rel="noopener">http://v.qq.com/x/page/b0314l51xc7.html</a></p><h1 id="swarm-mode"><a href="#Swarm-Mode" class="headerlink" title="Swarm Mode"></a>Swarm Mode <a href="#swarm-mode" class="header-anchor">#</a></h1><p>&#x5728;Keynote &#x6F14;&#x8BB2;&#x65F6;&#xFF0C;&#x662F;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x6765;&#x505A;&#x7684;&#x6F14;&#x793A;&#x3002;</p><p>&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E2A;&#x7B2C;&#x4E00;&#x53F0;<code>swarm</code>&#x4E3B;&#x673A;&#x5C31;&#x81EA;&#x52A8;&#x53D8;&#x4E3A; <code>manager</code>&#x3002;</p><p>&#x5728;&#x7B2C;&#x4E8C;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x6267;&#x884C;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join &lt;ip of manager&gt;:2377</span><br></pre></td></tr></table></figure><p>&#x7B2C;&#x4E8C;&#x53F0;&#x4E3B;&#x673A;&#x5C31;&#x4F5C;&#x4E3A;&#x666E;&#x901A;&#x8282;&#x70B9;&#x52A0;&#x5165;&#x8FDB;&#x4E86;&#x8FD9;&#x4E2A; swarm&#x3002;</p><p>&#x7136;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#xFF0C;&#x52A0;&#x5165;&#x8FD9;&#x4E2A;swarm&#x3002;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x4E24;&#x6761;&#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x3002;</p><h1 id="services"><a href="#Services" class="headerlink" title="Services"></a>Services <a href="#services" class="header-anchor">#</a></h1><p>&#x521B;&#x5EFA;&#x670D;&#x52A1;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --replicas 3 \</span><br><span class="line">    --name frontend \</span><br><span class="line">    --network mynet \</span><br><span class="line">    --publish 80:80/tcp \</span><br><span class="line">    frontend_image:latest</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F; 1.12 &#x5F00;&#x59CB;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5728; swarm &#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x58F0;&#x660E;&#x670D;&#x52A1;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E; swarm &#x5F15;&#x64CE;&#x4F1A;&#x8D1F;&#x8D23;&#x7EF4;&#x62A4;&#x8C03;&#x5EA6;&#x6765;&#x4FDD;&#x6301;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;</p><p>&#x521B;&#x5EFA;&#x7B2C;&#x4E8C;&#x4E2A;&#x670D;&#x52A1;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x901A;&#x8BAF;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x8BE5;&#x670D;&#x52A1;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x4E2D;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --name redis \</span><br><span class="line">    --network mynet \</span><br><span class="line">    redis:latest</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&lt;&#x670D;&#x52A1;&#x540D;&gt;&#x6765;&#x4E92;&#x76F8;&#x901A;&#x8BAF;&#xFF0C;&#x901A;&#x8FC7;&#x7684;&#x662F;&#x5185;&#x7F6E;&#x7684;DNS&#x8FDB;&#x884C;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p><h1 id="node-failure"><a href="#Node-Failure" class="headerlink" title="Node Failure"></a>Node Failure <a href="#node-failure" class="header-anchor">#</a></h1><p>Docker Swarm Mode &#x6CA1;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;</p><p>&#x5F53;swarm&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#x540E;&#xFF0C;&#x5176;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x5C31;&#x90FD;&#x6302;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x670D;&#x52A1;&#x7684;&#x5B9E;&#x9645;&#x72B6;&#x6001;&#x5C31;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x5F53;&#x521D;&#x8BBE;&#x5B9A;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6240;&#x6307;&#x5B9A;&#x7684;&#x72B6;&#x6001;&#xFF08;&#x6BD4;&#x5982;<code>--replicas=3</code>&#xFF09;&#x4E0D;&#x518D;&#x6EE1;&#x8DB3;&#xFF0C;&#x8FD9;&#x65F6; swarm engine &#x5C31;&#x4F1A;&#x4ECB;&#x5165;&#x8FDB;&#x6765;&#xFF0C;&#x8BD5;&#x56FE;&#x5728;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x4E0A;&#x542F;&#x52A8;&#x5BF9;&#x5E94;&#x5BB9;&#x5668;&#x6765;&#x6062;&#x590D;&#x670D;&#x52A1;&#x3002;</p><h1 id="scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling <a href="#scaling" class="header-anchor">#</a></h1><p>&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x548C; <code>docker-compose scale</code> &#x7684;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service scale frontend=6</span><br></pre></td></tr></table></figure><h1 id="global-services"><a href="#Global-Services" class="headerlink" title="Global Services"></a>Global Services <a href="#global-services" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F; DockerCon16 &#x7684; keynote &#x4E2D;&#x6CA1;&#x6709;&#x6DB5;&#x76D6;&#x7684;&#x90E8;&#x5206;&#x3002;</p><p><code>Global Service</code> &#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5E0C;&#x671B;&#x5728; <code>Swarm</code> &#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x3002;</p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7EDF;&#x8BA1;&#x4E4B;&#x7C7B;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5728;&#x6BCF;&#x4E00;&#x4E2A; Swarm &#x4E3B;&#x673A;&#x4E0A;&#x90FD;&#x8FD0;&#x884C;&#x3002;&#x521B;&#x5EFA; Global Service &#x7684;&#x65B9;&#x5F0F;&#x548C;&#x524D;&#x9762;&#x7684;&#x505A;&#x6CD5;&#x57FA;&#x672C;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x589E;&#x52A0; <code>--mode=global</code> &#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --mode=global \</span><br><span class="line">    --name prometheus \</span><br><span class="line">    prom/prometheus</span><br></pre></td></tr></table></figure><h1 id="constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints <a href="#constraints" class="header-anchor">#</a></h1><p>&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x67D0;&#x4E9B;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;&#x7279;&#x5B9A;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;&#x7684;&#x670D;&#x52A1;&#x5668;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8DD1;&#x5728;SSD&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x800C;&#x524D;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x8DD1;&#x5728;&#x6709;&#x516C;&#x7F51;IP&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8DD1;&#x5728;&#x5185;&#x5B58;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x8FD9;&#x4E9B;&#x9700;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;docker daemon&#x7684;<code>label</code>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker daemon &#x2014;label=com.mycompany.storage=&#x201C;ssd&#x201D;</span><br></pre></td></tr></table></figure><p>&#x5728;&#x5EFA;&#x7ACB;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--constraint</code> &#x53C2;&#x6570;&#x6765;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;&#x7684;<code>label</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --replicas 3 \</span><br><span class="line">    --name frontend \</span><br><span class="line">    --network mynet \</span><br><span class="line">    --publish 80:80/tcp \</span><br><span class="line">    --constraint com.mycompany.storage=&#x201C;ssd&#x201D; \</span><br><span class="line">    frontend_image:latest</span><br></pre></td></tr></table></figure><h1 id="services-tasks-containers"><a href="#Services-&#x2192;-Tasks-&#x2192;-Containers" class="headerlink" title="Services &#x2192; Tasks &#x2192; Containers"></a><code>Services</code> &#x2192; <code>Tasks</code> &#x2192; <code>Containers</code> <a href="#services-tasks-containers" class="header-anchor">#</a></h1><p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>redis</code> &#x670D;&#x52A1;&#xFF1B;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x9700;&#x8981;3&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x8FD9;&#x5C31;&#x6709;3&#x4E2A;<code>Tasks</code>&#xFF1B;&#x800C;&#x6BCF;&#x4E2A;<code>Task</code>&#x5219;&#x53BB;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x4E09;&#x7EA7;&#x7684;&#x6982;&#x5FF5;&#x3002;</p><p>&#x6700;&#x521D;&#x7684;&#x7406;&#x89E3;&#x53EF;&#x80FD;&#x4F1A;&#x8BA4;&#x4E3A;&#x670D;&#x52A1;&#x662F;&#x4E00;&#x7FA4;&#x5BB9;&#x5668;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x4E0D;&#x592A;&#x7406;&#x89E3;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6709;&#x4E2D;&#x95F4;&#x7684;Task&#x8FD9;&#x4E00;&#x5C42;&#x3002;&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x6765;&#x7684;&#x6269;&#x5C55;&#x800C;&#x8003;&#x8651;&#x7684;&#xFF0C;&#x76EE;&#x524D;Task&#x53EA;&#x5305;&#x542B;&#x6709;&#x5BB9;&#x5668;&#x3002;&#x4F46;&#x662F;&#x5C06;&#x6765; <code>Task</code> &#x6216;&#x8BB8;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;<code>&#x5BB9;&#x5668;</code>&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x80FD;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;<code>Unikernel</code>&#xFF0C;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;<code>VM</code>&#x7B49;&#x7B49;&#x3002;</p><h1 id="stack-shi-service-de-ji-he"><a href="#Stack-&#x662F;-Service-&#x7684;&#x96C6;&#x5408;" class="headerlink" title="Stack &#x662F; Service &#x7684;&#x96C6;&#x5408;"></a><code>Stack</code> &#x662F; <code>Service</code> &#x7684;&#x96C6;&#x5408; <a href="#stack-shi-service-de-ji-he" class="header-anchor">#</a></h1><p>&#x4E00;&#x4E2A; <code>Stack</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A; <code>App</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x7531;&#x4E00;&#x7FA4;<code>&#x670D;&#x52A1;</code>&#x7EC4;&#x6210;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x6709;&#x4E2A; Web app&#xFF0C;&#x5FC5;&#x7136;&#x5305;&#x62EC;&#x524D;&#x7AEF; Web &#x670D;&#x52A1;&#x3001;&#x4E2D;&#x95F4;&#x4EF6;&#x670D;&#x52A1;&#x3001;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#xFF0C;&#x53EF;&#x80FD;&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x7684;&#x5982; <code>Redis</code> &#x4E4B;&#x7C7B;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x662F; <code>Stack</code>&#x3002;</p><h1 id="distributed-application-bundle-dab-sheng-ming-liao-yi-ge-stack"><a href="#Distributed-Application-Bundle-dab-&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;-Stack" class="headerlink" title="Distributed Application Bundle (.dab) &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A; Stack"></a>Distributed Application Bundle (.dab) &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A; Stack <a href="#distributed-application-bundle-dab-sheng-ming-liao-yi-ge-stack" class="header-anchor">#</a></h1><p>&#x73B0;&#x5728;&#x5904;&#x4E8E;&#x6BD4;&#x8F83;&#x524D;&#x6CBF;&#x7684;&#x8BD5;&#x9A8C;&#x9636;&#x6BB5;&#xFF0C;&#x9700;&#x8981;&#x793E;&#x533A;&#x7684;&#x5173;&#x6CE8;&#x548C;&#x53CD;&#x9988;&#x3002;&#x76EE;&#x524D;&#x5DF2;&#x7ECF;&#x96C6;&#x6210;&#x8FDB; <code>Docker 1.12</code> &#x4EE5;&#x53CA; <code>docker-compose</code>&#x4E2D;&#x3002;</p><h1 id="swarm-mode-is-optional"><a href="#Swarm-mode-is-optional" class="headerlink" title="Swarm mode is optional"></a>Swarm mode is optional <a href="#swarm-mode-is-optional" class="header-anchor">#</a></h1><p>&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7528;&#x6216;&#x8005;&#x4E0D;&#x7528;&#xFF0C;<code>Docker 1.12</code> &#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;&#x8FC7;&#x53BB;&#x7684;&#x7528;&#x6CD5;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x53E6;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#x3002;</p><h1 id="routing-mesh"><a href="#Routing-Mesh" class="headerlink" title="Routing Mesh"></a>Routing Mesh <a href="#routing-mesh" class="header-anchor">#</a></h1><p>&#x8FD8;&#x662F;&#x4E4B;&#x524D;&#x7684;3&#x4E2A;&#x526F;&#x672C;&#x7684;&#x524D;&#x7AEF;&#x670D;&#x52A1;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x670D;&#x52A1;&#x8BBE;&#x5B9A;&#x7684;&#x662F;&#x76D1;&#x542C; <code>80</code> &#x7AEF;&#x53E3;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x58F0;&#x660E;&#x4F1A;&#x8BA9; <code>swarm</code> &#x4E2D;&#x6240;&#x6709;&#x7684;&#x8282;&#x70B9;&#xFF08;&#x5305;&#x62EC; <code>manager</code>&#xFF09;&#x90FD;&#x76D1;&#x542C;<code>80</code>&#x7AEF;&#x53E3;&#xFF08;<code>swarm-wide ingress port</code>&#xFF09;&#x3002;&#x800C;3&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x5047;&#x8BBE;<code>worker 1</code>&#x4E0A;&#x8DD1;&#x4E86;&#x4E00;&#x4E2A;&#xFF0C;<code>worker 2</code>&#x4E0A;&#x8DD1;&#x4E86;2&#x4E2A;&#xFF08;&#x90FD;&#x5B88;&#x62A4;80&#x7AEF;&#x53E3;&#x4E0D;&#x51B2;&#x7A81;&#x4E48;&#xFF1F;&#x4EE5;&#x524D;&#x7AEF;&#x53E3;&#x5C5E;&#x4E8E;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x6837;&#x58F0;&#x660E;&#x7684;&#x670D;&#x52A1;&#x5FC5;&#x7136;&#x4E0D;&#x4F1A;&#x5728;&#x4E00;&#x4E2A;<code>worker</code>&#x4E0A;&#xFF09;</p><p>&#x5047;&#x8BBE;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x4E86;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x670D;&#x52A1;&#x7136;&#x540E;&#x8F6C;&#x5230;&#x4E86; <code>worker 2</code> &#x7684;80&#x7AEF;&#x53E3;&#x4E0A;&#xFF0C;&#x6070;&#x597D; <code>worker 2</code> &#x4E0A;&#x6709;&#x4E24;&#x4E2A; <code>frontend</code> &#x5BB9;&#x5668;&#x3002; &#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x8BBF;&#x95EE;&#x80AF;&#x5B9A;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F1A;&#x7531;<code>worker 2</code> &#x4E0A;&#x7684;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8D1F;&#x8D23;&#x5904;&#x7406;&#x3002;</p><p>&#x90A3;&#x4E48;&#x5982;&#x679C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5C06;&#x7528;&#x6237;&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x79FB;&#x5230;&#x4E86; <code>worker 3</code> &#x5462;&#xFF1F;<code>worker 3</code> &#x4E0A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55; <code>frontend</code> &#x5BB9;&#x5668;&#x5728;&#x8FD0;&#x884C;&#x3002;&#x8FC7;&#x53BB;&#x8FD9;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x800C;&#x73B0;&#x5728;&#x6709;&#x4E86; <code>routing mesh</code> &#x540E;&#xFF0C; <code>worker 3</code> &#x4F1A;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;&#x62E5;&#x6709; <code>frontend</code> &#x7684;&#x5BB9;&#x5668;&#x7684; <code>worker 2</code> &#x8EAB;&#x4E0A;&#xFF0C;&#x4E8E;&#x662F;&#x8BF7;&#x6C42;&#x5F97;&#x5230;&#x4E86;&#x5904;&#x7406;&#x3002;</p><p>&#x662F;&#x7684;&#xFF0C;&#x8FD9;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x8DF3;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5185;&#x6838;&#x6280;&#x672F;(<code>IPVS</code>, <code>kernel space package routing</code>)&#xFF0C;&#x6548;&#x7387;&#x662F;&#x975E;&#x5E38;&#x9AD8;&#x7684;&#x3002;</p><p>&#x8FD9;&#x6837;&#x7684;&#x505A;&#x6CD5;&#x4F1A;&#x6709;&#x4E00;&#x79CD;&#x6982;&#x5FF5;&#xFF0C;&#x8BA9;&#x6574;&#x4E2A;&#x7684; Swarm &#x96C6;&#x7FA4;&#x8868;&#x73B0;&#x7684;&#x50CF;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4E00;&#x6837;&#x662F;&#x4E2A;&#x6574;&#x4F53;&#x3002;</p><h1 id="security-by-default"><a href="#Security-by-default" class="headerlink" title="Security by default"></a>Security by default <a href="#security-by-default" class="header-anchor">#</a></h1><p>Cryptographic Node Identity</p><p>&#x6CA1;&#x6709; insecure mode&#xFF0C;&#x5728; 1.12 &#x7684; Swarm mode &#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6CA1;&#x6709;&#x5173;&#x95ED;&#x5B89;&#x5168;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x662F;&#x6709;&#x610F;&#x5982;&#x6B64;&#x3002;Docker&#x7684;&#x7406;&#x5FF5;&#x662F;&#x5B89;&#x5168;&#x4E0D;&#x5E94;&#x8BE5;&#x662F;&#x7D2F;&#x8D58;&#xFF0C;&#x5E94;&#x8BE5;&#x7B80;&#x5355;&#x6613;&#x7528;&#xFF0C;&#x6CA1;&#x6709;&#x5173;&#x95ED;&#x7684;&#x5FC5;&#x8981;&#x6027;&#x3002;</p><ul><li>TLS &#x662F;&#x4E92;&#x76F8;&#x8BA4;&#x8BC1;</li><li>TLS &#x52A0;&#x5BC6;</li><li>Certificate rotation</li></ul><h1 id="container-health-check-in-dockerfile"><a href="#Container-Health-Check-in-Dockerfile" class="headerlink" title="Container Health Check in Dockerfile"></a>Container Health Check in <code>Dockerfile</code> <a href="#container-health-check-in-dockerfile" class="header-anchor">#</a></h1><p>&#x53EF;&#x4EE5;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x6307;&#x5B9A;&#x5982;&#x4F55;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x751F;&#x6210;&#x7684;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x63D0;&#x4F9B; Web &#x670D;&#x52A1;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5176; <code>HEALTHCHECK</code> &#x547D;&#x4EE4;&#x53EF;&#x80FD;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEALTHCHECK &#x2014;interval=5m &#x2014;timeout=3s &#x2014;retries 3 CMD curl -f http://xxx || <span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x662F;&#x8BF4;&#x6BCF;&#x8FC7;5&#x5206;&#x949F;&#x770B;&#x4E00;&#x4E0B;&#x662F;&#x4E0D;&#x662F;&#x80FD;&#x591F;&#x901A;&#x8FC7;80&#x7AEF;&#x53E3;&#x53D6;&#x5F97; index &#x9875;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x8FDE;&#x7EED;3&#x6B21;&#x90FD;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x8BE5;&#x670D;&#x52A1;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5C06;&#x5065;&#x5EB7;&#x72B6;&#x6001;&#x8BBE;&#x4E3A;<code>broken</code>&#xFF0C;&#x7136;&#x540E;&#x7531; <code>swarm</code> &#x4E4B;&#x7C7B;&#x7684;&#x4E0A;&#x5C42;&#x7F16;&#x6392;&#x5DE5;&#x5177;&#x8D1F;&#x8D23;&#x5220;&#x9664;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3001;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x7B49;&#x8C03;&#x5EA6;&#x5DE5;&#x4F5C;&#x3002;</p><h1 id="new-plugin-subcommands"><a href="#New-Plugin-Subcommands" class="headerlink" title="New Plugin Subcommands"></a>New Plugin Subcommands <a href="#new-plugin-subcommands" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker plugin install mylovelyuser/no-remove</span><br><span class="line">docker plugin <span class="built_in">enable</span> no-remove</span><br><span class="line">docker plugin <span class="built_in">disable</span> no-remove</span><br></pre></td></tr></table></figure><p>Docker engine &#x5C06;&#x4F1A;&#x53BB; Docker Hub &#x53D6;&#x5F97;&#x5BF9;&#x5E94;&#x7684; plugin&#x3002;</p><p>&#x800C;&#x4E14; Plugin &#x6709;&#x4E00;&#x4E2A; manifest &#x6765;&#x6307;&#x5B9A;&#x5176;&#x6240;&#x9700;&#x7684;&#x6743;&#x9650;&#x3002;</p><p>&#x7528;&#x6237;&#x5B89;&#x88C5;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x4F1A;&#x63D0;&#x793A;&#x7528;&#x6237;&#x662F;&#x5426;&#x8D4B;&#x4E88;&#x8BE5; plugin &#x5BF9;&#x5E94;&#x6743;&#x9650;&#x3002;</p><h1 id="orchestration-deep-dive-andrea-luzzardi"><a href="#Orchestration-Deep-Dive-Andrea-Luzzardi" class="headerlink" title="Orchestration Deep Dive - Andrea Luzzardi"></a>Orchestration Deep Dive - Andrea Luzzardi <a href="#orchestration-deep-dive-andrea-luzzardi" class="header-anchor">#</a></h1><h2 id="swarm-topology"><a href="#Swarm-Topology" class="headerlink" title="Swarm Topology"></a>Swarm Topology <a href="#swarm-topology" class="header-anchor">#</a></h2><p>&#x5728;Swarm&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x5BF9;&#x5F85;&#x7684;&#x3002;&#x8282;&#x70B9;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x89D2;&#x8272;&#xFF0C;<code>Manager</code> &#x548C; <code>Worker</code>&#x3002;&#x89D2;&#x8272;&#x52A8;&#x6001;&#x7684;&#xFF0C;&#x4E8C;&#x8005;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x8F6C;&#x6362;(<code>promote</code>/<code>demote</code>)&#x3002;</p><h2 id="docker-swarm-communication-internals"><a href="#Docker-Swarm-Communication-Internals" class="headerlink" title="Docker Swarm Communication Internals"></a>Docker Swarm Communication Internals <a href="#docker-swarm-communication-internals" class="header-anchor">#</a></h2><p><code>Manager</code> &#x548C; <code>Worker</code> &#x5C5E;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;<code>Manager</code> &#x5C5E;&#x4E8E;&#x4E00;&#x4E2A; <code>Raft consensus</code> &#x7EC4;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x901A;&#x8BAF;&#x7684;&#x7F51;&#x7EDC;&#x6E20;&#x9053;&#xFF1B;&#x800C; <code>Worker</code> &#x540C;&#x5C5E;&#x4E8E; <code>Gossip</code> &#x7F51;&#x7EDC;&#xFF0C;&#x4E8C;&#x8005;&#x4E4B;&#x95F4;&#x7528;<code>gRPC</code>&#x901A;&#x8BAF;&#x3002;</p><h2 id="quorum-layer"><a href="#Quorum-Layer" class="headerlink" title="Quorum Layer"></a>Quorum Layer <a href="#quorum-layer" class="header-anchor">#</a></h2><p>&#x5185;&#x7F6E;&#x4E86; <code>Datastore</code>&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x9700;&#x8981;&#x5916;&#x7F6E; <code>key-value store</code> (<code>etcd</code>, <code>consul</code>, <code>zookeeper</code>,&#x2026;)</p><h1 id="node-breakdown"><a href="#Node-Breakdown" class="headerlink" title="Node Breakdown"></a>Node Breakdown <a href="#node-breakdown" class="header-anchor">#</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">API</span><br><span class="line">Orchestrator: Check the difference of state</span><br><span class="line">Allocator</span><br><span class="line">Scheduler</span><br><span class="line">Dispatcher</span><br><span class="line">    &#x2B06;&#xFE0F;</span><br><span class="line">Worker</span><br><span class="line">Executor</span><br></pre></td></tr></table></figure><h2 id="nei-zhi-fu-zai-jun-heng"><a href="#&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#nei-zhi-fu-zai-jun-heng" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x90FD;&#x6709;&#x4E00;&#x4E2A; <code>Virtual IP</code>&#xFF0C;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5C06;<code>&lt;&#x670D;&#x52A1;&#x540D;&gt;</code>&#x89E3;&#x6790;&#x4E3A; <code>Virtual IP</code>&#xFF0C;&#x800C; <code>IPVS</code> &#x5C06;&#x4F1A;&#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5230;&#x5BB9;&#x5668; <code>IP</code>&#x3002;</p><h2 id="ingress-fu-zai-jun-heng"><a href="#Ingress-&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="Ingress &#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>Ingress &#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#ingress-fu-zai-jun-heng" class="header-anchor">#</a></h2><p><code>ELB</code>, <code>HAProxy</code>, <code>Nginx</code>&#x62E5;&#x6709;<code>&#x516C;&#x5171;IP</code>&#xFF0C;&#x5E76;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x4E3B;&#x673A;&#x5185;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6307;&#x5411;&#x670D;&#x52A1;&#x7684;<code>Virtual IP</code>&#xFF0C;<code>IPVS</code> &#x5219;&#x5728;&#x8DE8;&#x5BBF;&#x4E3B;&#x7684; <code>Ingress Network</code> &#x4E0A;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5230;&#x5176;&#x5B83;&#x63D0;&#x4F9B;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x5BB9;&#x5668;&#x4E0A;&#x3002;</p><p>&#x6240;&#x6709;&#x8282;&#x70B9;&#x901A;&#x8BAF;&#x9ED8;&#x8BA4;&#x5B89;&#x5168;&#x5168;&#x90E8;&#x52A0;&#x5BC6;&#xFF0C;<code>manager</code>&#x5185;&#x7F6E;CA&#xFF0C;<code>certificate rotation</code>&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Fluentd 和 Docker 架构 2015 - Kiyoto Tamura</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-04-video-fluentd-and-docker-infrastructure-2015.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-07-04-video-fluentd-and-docker-infrastructure-2015.html</id>
    <published>2016-07-03T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.617Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Fluentd and Docker Infrastructure 2015<br>by Kiyoto Tamura, Treasure Data (VP)<br>(2015/08/03)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/udUr0pB_x-U" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=udUr0pB_x-U" target="_blank" rel="noopener">https://www.youtube.com/watch?v=udUr0pB_x-U</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=y0314bwhvwk&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/y0314bwhvwk.html" target="_blank" rel="noopener">http://v.qq.com/x/page/y0314bwhvwk.html</a></p><p>&#x5728;Docker demo&#x4E2D;&#xFF0C;Kiyoto &#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x5B89;&#x88C5;&#x597D; Docker &#x548C; <code>td agents</code> &#x7684;&#x8BA1;&#x7B97;&#x673A;&#x3002;&#x5148;&#x7ED9;&#x5927;&#x5BB6;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E0B; <code>td-agent</code>&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F4D;&#x4E8E; <code>/etc/td-agent/td-agent.conf</code>&#xFF1A;</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    type forward</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">td.</span>*<span class="attr">.</span>*&gt;</span></span><br><span class="line">    type tdlog</span><br><span class="line">    apikey &#x2026;.</span><br><span class="line">    auto_create_table</span><br><span class="line">    buffer_type file</span><br><span class="line">    buffer_path /var/log/&#x2026;.</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">secondary</span>&gt;</span></span><br><span class="line">        type file</span><br><span class="line">        path /var/log/&#x2026;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">secondary</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br></pre></td></tr></table></figure><p>&#x91CD;&#x542F; <code>td-agent</code> &#x670D;&#x52A1;&#x540E;&#xFF0C;&#x5F00;&#x59CB;&#x8FD0;&#x884C; docker&#xFF0C;&#x5E76;&#x6307;&#x5B9A;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5230; <code>fluentd</code>&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name <span class="built_in">test</span> \</span><br><span class="line">    --<span class="built_in">log</span>-driver=fluentd \</span><br><span class="line">    --<span class="built_in">log</span>-opt fluentd-tag=td.docker.{{.Name}} \</span><br><span class="line">    ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#xFF1A;&#x53C2;&#x8003; fluentd logging driver &#x6587;&#x6863;&#xFF0C;&#x53EF;&#x80FD;&#x73B0;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x4E86;&#xFF0C;&#x5BB9;&#x5668;&#x540D;&#x4F1A;&#x81EA;&#x52A8;&#x4F5C;&#x4E3A;tag&#x8F93;&#x51FA;&#x3002;</p><p><a href="https://docs.docker.com/engine/admin/logging/fluentd/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/logging/fluentd/</a></p><p>fluentd&#x4F1A;&#x81EA;&#x52A8;&#x52A0;&#x4E0A; <code>container_id</code>, <code>container_name</code> &#x4EE5;&#x53CA; <code>source</code>&#x3002;</p><p>&#x5982;&#x679C;&#x50CF;&#x793A;&#x4F8B;&#x4E2D;&#x90A3;&#x6837;&#x4E0D;&#x6307;&#x5B9A; <code>fluentd-address</code> &#x53C2;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F1A;&#x8FDE;&#x63A5; <code>localhost:24224</code></p><p><code>--log-driver</code> &#x53EF;&#x4EE5;&#x52A0;&#x8F7D; <code>docker daemon</code> &#x540E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x52A0;&#x5728; <code>docker run</code> &#x540E;&#x4F7F;&#x7528;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55; docker daemon&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#x3002;</p><p>&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;Kiyoto &#x4F7F;&#x7528;&#x7684;&#x662F;&#x672C;&#x673A;&#x7684;<code>td-agents</code>&#xFF0C;&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x5B89;&#x88C5; fluentd&#xFF0C;&#x6216;&#x8005;&#x66F4;&#x597D;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5728;&#x672C;&#x673A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; fluentd &#x7684; docker &#x5BB9;&#x5668;&#x6765;&#x8DD1;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p><p><a href="https://hub.docker.com/r/fluent/fluentd/" target="_blank" rel="noopener">https://hub.docker.com/r/fluent/fluentd/</a></p><p>&#x6F14;&#x793A;&#x4E2D;&#x4E3A;&#x4E86;&#x6E05;&#x7A7A;&#x7F13;&#x5B58;&#xFF0C;&#x7528;kill&#x53D1;&#x9001;<code>--USR1</code>&#x4FE1;&#x53F7;&#x7ED9;<code>td-agent</code>&#x3002;&#x7136;&#x540E;&#x6253;&#x5F00;&#x4E86; <a href="https://console.treasuredata.com" target="_blank" rel="noopener">https://console.treasuredata.com</a> &#x4F7F;&#x7528;Web UI&#x6765;&#x770B;&#x65E5;&#x5FD7;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="fluentd" scheme="https://1x481n.github.io/blog.lab99.org/tags/fluentd/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：介绍 Raft 算法 (CoreOS Fest 2015) - Diego Ongaro</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-23-video-an-introduction-of-raft.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-23-video-an-introduction-of-raft.html</id>
    <published>2016-06-22T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.616Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#raft-consensus-algorithm-etcd-based-on-it">Raft Consensus Algorithm (etcd based on it)</a></li><li><a href="#mu-de">&#x76EE;&#x7684;</a></li><li><a href="#shi-me-shi-consensus">&#x4EC0;&#x4E48;&#x662F; Consensus</a></li><li><a href="#paxos-protocol">PAXOS Protocol</a></li><li><a href="#raft-overview">RAFT overview</a><ul><li><a href="#leader-election">Leader election</a></li><li><a href="#ri-zhi-fu-zhi">&#x65E5;&#x5FD7;&#x590D;&#x5236;</a></li></ul></li><li><a href="#raft-visualization">RAFT Visualization</a></li><li><a href="#zong-jie">&#x603B;&#x7ED3;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>An Introduction to Raft (CoreOS Fest 2015)<br>by Diego Ongaro, Stanford University (2015/05/27)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/6bBggO6KN_k" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=6bBggO6KN_k" target="_blank" rel="noopener">https://www.youtube.com/watch?v=6bBggO6KN_k</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=f0314bj1m5j&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/f0314bj1m5j.html" target="_blank" rel="noopener">http://v.qq.com/x/page/f0314bj1m5j.html</a></p><h1 id="raft-consensus-algorithm-etcd-based-on-it"><a href="#Raft-Consensus-Algorithm-etcd-based-on-it" class="headerlink" title="Raft Consensus Algorithm (etcd based on it)"></a>Raft Consensus Algorithm (etcd based on it) <a href="#raft-consensus-algorithm-etcd-based-on-it" class="header-anchor">#</a></h1><h1 id="mu-de"><a href="#&#x76EE;&#x7684;" class="headerlink" title="&#x76EE;&#x7684;"></a>&#x76EE;&#x7684; <a href="#mu-de" class="header-anchor">#</a></h1><p>&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x7684;&#x952E;&#x503C;Store&#xFF08;state machine&#xFF09;<br>&#x7B80;&#x5355;&#x5730;&#x529E;&#x6CD5;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x653E;&#x5230;&#x7F51;&#x7EDC;&#x4E0A;&#xFF0C;&#x597D;&#x5904;&#x662F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x7F3A;&#x70B9;&#x662F;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF1B;<br>&#x4F7F;&#x7528;Raft&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5E94;&#x5BF9;&#x6545;&#x969C;</p><h1 id="shi-me-shi-consensus"><a href="#&#x4EC0;&#x4E48;&#x662F;-Consensus" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Consensus"></a>&#x4EC0;&#x4E48;&#x662F; Consensus <a href="#shi-me-shi-consensus" class="header-anchor">#</a></h1><p>Agreement on shared state<br>&#x81EA;&#x52A8;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x6545;&#x969C;&#x4E2D;&#x6062;&#x590D;&#xFF1A;&#x5C0F;&#x89C4;&#x6A21;&#x6545;&#x969C;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x8BDD;&#x5931;&#x53BB;&#x53EF;&#x7528;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x4F9D;&#x65E7;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x3002;</p><p>Replicated State Machines</p><p>Replicated log &#x9001;&#x7ED9; replicated state machine&#xFF0C;&#x8FD9;&#x6837;&#x6240;&#x6709;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x4F1A;&#x4EE5;&#x540C;&#x6837;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x3002;<br>Consensus &#x6A21;&#x5757;&#x786E;&#x4FDD;&#x6B63;&#x786E;&#x7684; log &#x590D;&#x5236;<br>System makes progress as long as any majority of servers up</p><h1 id="paxos-protocol"><a href="#PAXOS-Protocol" class="headerlink" title="PAXOS Protocol"></a>PAXOS Protocol <a href="#paxos-protocol" class="header-anchor">#</a></h1><p>by Leslie Lamppost, 1989</p><p>&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#x3002;</p><p>RAFT &#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x5305;&#x62EC;&#x8981;&#x6613;&#x4E8E;&#x7406;&#x89E3;</p><h1 id="raft-overview"><a href="#RAFT-overview" class="headerlink" title="RAFT overview"></a>RAFT overview <a href="#raft-overview" class="header-anchor">#</a></h1><h2 id="leader-election"><a href="#Leader-election" class="headerlink" title="Leader election"></a>Leader election <a href="#leader-election" class="header-anchor">#</a></h2><ul><li>&#x4ECE;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x9009;&#x51FA;&#x4E00;&#x4E2A;&#x4F5C;&#x4E3A; cluster leader</li><li>&#x76D1;&#x6D4B;&#x5B95;&#x673A;&#x5E76;&#x91CD;&#x65B0;&#x9009;&#x62E9;&#x65B0;&#x7684;leader</li></ul><h2 id="ri-zhi-fu-zhi"><a href="#&#x65E5;&#x5FD7;&#x590D;&#x5236;" class="headerlink" title="&#x65E5;&#x5FD7;&#x590D;&#x5236;"></a>&#x65E5;&#x5FD7;&#x590D;&#x5236; <a href="#ri-zhi-fu-zhi" class="header-anchor">#</a></h2><ul><li>leader&#x4ECE;client&#x63A5;&#x53D7;&#x547D;&#x4EE4;&#xFF0C;&#x5E76;&#x9644;&#x7740;&#x5230; log&#x4E0A;</li><li>leader &#x590D;&#x5236;&#x8FD9;&#x4E2A;log&#x5230;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x5668;&#x4E0A;</li></ul><p>##&#x5B89;&#x5168;</p><p>&#x53EA;&#x6709;&#x62E5;&#x6709;&#x6700;&#x65B0; log &#x7684;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x6210;&#x4E3A; leader</p><h1 id="raft-visualization"><a href="#RAFT-Visualization" class="headerlink" title="RAFT Visualization"></a>RAFT Visualization <a href="#raft-visualization" class="header-anchor">#</a></h1><p>&#x6709;5&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x671F;&#x671B;&#x5728;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x5185;&#x4F1A;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5FC3;&#x8DF3;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x9009;&#x4E3E;&#x65B0;&#x7684; leader&#x3002;</p><p><code>S3</code>&#x8D85;&#x65F6;&#x540E;&#xFF0C;&#x5B83;&#x81EA;&#x5DF1;&#x5347;&#x4E3A;<code>Term 3</code>&#xFF0C;&#x5E76;&#x4E14;&#x53D1;&#x51FA;<code>message&#xFF08;Request Vote RPC&#xFF09;</code>&#xFF1B;&#x800C;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x5668;&#x5C1A;&#x5904;&#x4E8E;&#x539F;&#x5148;&#x7684; <code>Term 2</code>&#x3002;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x6536;&#x5230; <code>T3</code> &#x7684;message&#x540E;&#xFF0C;&#x90FD;&#x4F1A;&#x66F4;&#x65B0;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x8FDB;&#x5165;<code>T3</code>&#xFF0C;&#x800C;&#x5347;&#x7EA7;&#x5230;<code>T3</code>&#x540E;&#xFF0C;&#x4ED6;&#x4EEC;&#x5C06;&#x4F1A;&#x62D2;&#x7EDD;&#x63A5;&#x53D7;T2&#x7684;&#x6D88;&#x606F;&#x3002;</p><p><code>Request Vote message</code>&#xFF0C;&#x73B0;&#x5728;&#x662F;<code>&#x5148;&#x5230;&#x5148;&#x5F97;</code>&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5148;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5148;&#x6210;&#x4E3A;Leader&#x3002;</p><p>&#x5982;&#x679C; <code>S1</code> &#x548C; <code>S5</code> &#x540C;&#x65F6;Time out&#xFF0C;&#x4ED6;&#x4EEC;&#x540C;&#x65F6;&#x53D1;&#x8D77;<code>request vote RPC</code>&#x3002;&#x5982;&#x679C;<code>s3</code>&#xFF0C;<code>s4</code> &#x5404;&#x9009;&#x62E9;&#x4E86;&#x4E00;&#x4E2A;leader&#xFF0C;&#x5219;<code>S1</code>&#x548C;<code>S5</code>&#x90FD;&#x65E0;&#x6CD5;&#x5F97;&#x5230;&#x5927;&#x591A;&#x6570;&#x9009;&#x7968;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x90FD;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x6210;&#x4E3A;leader&#x3002;</p><p>&#x8FD9;&#x65F6; <code>RAFT</code> &#x7684;&#x7B56;&#x7565;&#x662F;&#x5E72;&#x8106;&#x7B49;&#x5F85;&#x597D;&#x4E86;&#xFF0C;&#x8FDB;&#x5165;&#x7684;<code>Term 5</code>&#xFF0C;&#x770B;&#x4E4B;&#x540E;&#x8C01;&#x7B2C;&#x4E00;&#x4E2A;timeout&#xFF0C;&#x56E0;&#x4E3A;&#x4E0B;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;timeout&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x5927;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E0A;&#x9762;&#x540C;&#x65F6;&#x8D85;&#x65F6;&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x8D85;&#x65F6;&#x672C;&#x8EAB;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF09;&#x3002;&#x8FD9;&#x65F6;&#x67B6;&#x8BBE;<code>S3</code>&#x9996;&#x5148;&#x8D85;&#x65F6;&#xFF0C;&#x5F00;&#x59CB;&#x53D1;&#x8D77; <code>request vote RPC</code>&#xFF0C;&#x90A3;&#x4E48;s3&#x5C31;&#x6210;&#x4E3A;&#x4E86;<code>Term 5</code>&#x7684;leader&#x3002;</p><p>&#x53EA;&#x6709;&#x5728;&#x591A;&#x6570;&#x670D;&#x52A1;&#x5DE5;&#x4F5C;&#x65F6;&#xFF0C;&#x624D;&#x4F1A;&#x63A5;&#x53D7;&#x65B0;&#x7684;&#x65E5;&#x5FD7;&#x8BF7;&#x6C42;&#x3002;</p><p>&#x5982;&#x679C;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x73B0;&#x65E5;&#x5FD7;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6216;&#x8005;&#x6B65;&#x8C03;&#x4E0D;&#x5BF9;&#xFF0C;&#x4F1A;&#x548C;&#x65B0;&#x7684;leader&#x8FDB;&#x884C;&#x4EA4;&#x6D41;&#xFF0C;&#x4E00;&#x6B65;&#x6B65;&#x540E;&#x9000;&#xFF0C;&#x9000;&#x5230;&#x4E4B;&#x524D;&#x53EF;&#x4EE5;&#x8FBE;&#x6210;&#x4E00;&#x76F4;&#x7684;index&#xFF0C;&#x7136;&#x540E;&#x518D;&#x524D;&#x8FDB;&#x5230;&#x5F53;&#x524D;index.</p><p>&#x5982;&#x679C;&#x4E4B;&#x524D;&#x5B95;&#x673A;&#x7684;leader&#x62E5;&#x6709;&#x66F4;&#x65B0;&#x7684;index&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6765;&#x7684;&#x53CA;&#x53D1;&#x7ED9;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x73B0;&#x5728;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x5668;&#x5DF2;&#x7ECF;&#x79FB;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;term&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x65E7;leader&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x5B83;&#x7684;index&#x4F1A;&#x88AB;&#x65B0;term&#x7684;index&#x6240;&#x8986;&#x76D6;&#x3002;</p><p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7684;index&#x6BD4;&#x6240;&#x6709;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x65E7;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;<code>request vote RPC</code>&#xFF0C;&#x6240;&#x6709;&#x7684;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x4E0D;&#x4F1A;&#x540C;&#x610F;&#xFF0C;&#x53EA;&#x6709;&#x62E5;&#x6709;&#x6700;&#x65B0;&#x7684;index&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x6210;&#x4E3A; leader&#x3002;</p><h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><ul><li>Consensus &#x6CE8;&#x91CD;&#x4E8E;&#x63A8;&#x5E7F;&#x800C;&#x4E0D;&#x662F;&#x590D;&#x6742;</li></ul><p>&#x8981;&#x5BB9;&#x6613;&#x5728;&#x5B66;&#x6821;&#x6559;&#xFF0C;&#x800C;&#x4E14;&#x5BB9;&#x6613;&#x66F4;&#x597D;&#x7684;&#x6784;&#x5EFA;&#x5B9E;&#x9645;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0;<br>&#x5B9E;&#x9645;&#x7CFB;&#x7EDF;&#x4E2D;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x90E8;&#x5206;&#xFF1A;</p><ul><li>&#x96C6;&#x7FA4;&#x6210;&#x5458;&#x7BA1;&#x7406;</li><li>&#x65E5;&#x5FD7;&#x538B;&#x7F29;</li><li>&#x5BA2;&#x6237;&#x7AEF;&#x4EA4;&#x4E92;</li><li>evaluation</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="coreos" scheme="https://1x481n.github.io/blog.lab99.org/tags/coreos/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：为 Docker Swarm 设计的 DNS 服务发现 - Ahmet Alp Balkan</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-23-video-dns-service-discovery-for-docker-swarm-clusters.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-23-video-dns-service-discovery-for-docker-swarm-clusters.html</id>
    <published>2016-06-22T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.616Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#service-discovery">Service Discovery</a></li><li><a href="#tong-chang-fang-fa">&#x901A;&#x5E38;&#x65B9;&#x6CD5;</a></li><li><a href="#dns">DNS</a></li><li><a href="#mesos-dns">Mesos-DNS</a></li><li><a href="#skydns">SkyDNS</a></li><li><a href="#wagl">wagl</a></li><li><a href="#bu-shu-wagl">&#x90E8;&#x7F72; wagl</a></li><li><a href="#demo">demo</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DNS Service Discovery for Docker Swarm Clusters<br>by Ahmet Alp Balkan, Microsoft<br>(2015/12/7)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/WXESsPqC8to" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=WXESsPqC8to" target="_blank" rel="noopener">https://www.youtube.com/watch?v=WXESsPqC8to</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b03149ny29m&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/b03149ny29m.html" target="_blank" rel="noopener">http://v.qq.com/x/page/b03149ny29m.html</a></p><h1 id="service-discovery"><a href="#Service-Discovery" class="headerlink" title="Service Discovery"></a>Service Discovery <a href="#service-discovery" class="header-anchor">#</a></h1><p>&#x5E2E;&#x52A9;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x627E;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;</p><p>&#x4E0D;&#x8FC7;&#x56E0;&#x4E3A;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#xFF0C;&#x5BFC;&#x81F4;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x7FA4;&#x5730;&#x5740;</p><p>&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x5730;&#x5740;&#x53EF;&#x80FD;&#x6709;&#x7684;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x6BD4;&#x5982;&#x5BF9;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x6302;&#x4E86;</p><h1 id="tong-chang-fang-fa"><a href="#&#x901A;&#x5E38;&#x65B9;&#x6CD5;" class="headerlink" title="&#x901A;&#x5E38;&#x65B9;&#x6CD5;"></a>&#x901A;&#x5E38;&#x65B9;&#x6CD5; <a href="#tong-chang-fang-fa" class="header-anchor">#</a></h1><p><code>Overlay Networks</code><br>&#x670D;&#x52A1;&#x53D1;&#x73B0; &#x2192; <code>/etc/hosts</code>&#xFF0C;&#x4F46;&#x8FD9;&#x4E0D;&#x662F;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x4E2A;&#x8BB2;&#x5EA7;&#x662F;&#x53BB;&#x5E74;&#x7684;&#xFF0C;&#x8BB2;&#x7684;&#x662F;&#x5728;Docker 1.10&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x63D0;&#x51FA;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x800C;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x5185;&#x7F6E; DNS&#x4E86;</em>&#xFF09;</p><p>&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF1A;<code>HAProxy</code>, <code>Nginx</code>&#x3002;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3001;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x3001;Connection draining&#x3002;&#x4F46;&#x662F;&#x6240;&#x6709;&#x7684;traffic&#x90FD;&#x4F1A;&#x7ECF;&#x8FC7;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF0C;&#x8FD9;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF0C;&#x800C;&#x4E14;&#x4F1A;&#x589E;&#x52A0;&#x5EF6;&#x65F6;&#x3002;</p><p><code>Interlock</code>&#xFF0C;&#x901A;&#x8FC7;<code>Docker Events API</code>&#x6765;&#x76D1;&#x542C;&#x5BB9;&#x5668;&#x7684;&#x5EFA;&#x7ACB;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x65B0; <code>HAProxy</code>&#x3002;<br><code>Registrator</code>&#xFF0C;&#x4E5F;&#x4E00;&#x6837;&#x901A;&#x8FC7;<code>Events API</code>&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x5B58;&#x5230; <code>consul</code>&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528;<code>consul-template</code> &#x6765;&#x66F4;&#x65B0; <code>nginx</code>&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x3002;</p><p><code>kube-proxy</code> &#x5904;&#x7406; <code>kubenetes</code> &#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x505A;&#x7684;&#x662F;&#x6BD4;&#x8F83;&#x6B63;&#x786E;&#x7684;&#x3002;</p><h1 id="dns"><a href="#DNS" class="headerlink" title="DNS"></a>DNS <a href="#dns" class="header-anchor">#</a></h1><p>DNS&#x8BDE;&#x751F;&#x5C31;&#x662F;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x540D;&#x5B57;/&#x670D;&#x52A1;&#x5230;IP&#x7684;&#x89E3;&#x6790;</p><p><code>DNS A/AAAA</code>&#x8BB0;&#x5F55;&#x6CA1;&#x6709;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;&#x3002;<br><code>SRV</code>&#x8BB0;&#x5F55;&#xFF0C;&#x5982;&#x679C;&#x7ED9;&#x5B9A; <code>hostname</code>&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;<code>&lt;ip, port, weight&gt;</code></p><p>&#x95EE;&#x9898;&#x662F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x7528;<code>SRV</code>&#x3002;</p><p>&#x4F7F;&#x7528;DNS&#x7684;&#x8BDD;&#xFF0C;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x90E8;&#x5206;&#xFF1B;<br>&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x5206;&#x914D;&#x4E86;&#xFF08;<code>SRV</code>&#x7684;&#x95EE;&#x9898;&#xFF09;&#xFF1B;<br>&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x52A0;&#x8F7D;&#x65F6;&#x95F4;(<code>DNS TTL</code>)&#xFF1B;<br>&#x95EE;&#x9898;&#x662F;&#x6709;&#x4E9B;&#x4E1C;&#x897F;(&#x5982;<code>Java</code>)&#x4E0D;&#x9075;&#x5B88;<code>TTL</code>;<br>&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x5806;&#x6808;&#xFF1B;<br>&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#xFF1B;<br>&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;shuffling ip&#x6765;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p><h1 id="mesos-dns"><a href="#Mesos-DNS" class="headerlink" title="Mesos-DNS"></a>Mesos-DNS <a href="#mesos-dns" class="header-anchor">#</a></h1><p>&#x4E3A; Mesos &#x8BBE;&#x8BA1;&#x7684;&#xFF0C;&#x90E8;&#x7F72;&#x4E00;&#x6B21;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FD8;&#x6389;&#x4ED6;&#x4E86;&#x3002;&#x8BBE;&#x8BA1;&#x975E;&#x5E38;&#x597D;&#x3002;</p><h1 id="skydns"><a href="#SkyDNS" class="headerlink" title="SkyDNS"></a>SkyDNS <a href="#skydns" class="header-anchor">#</a></h1><p>&#x975E;&#x5E38;&#x50CF; Mesos &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;kubenetes &#x9ED8;&#x8BA4;&#x7684; DNS</p><h1 id="wagl"><a href="#wagl" class="headerlink" title="wagl"></a>wagl <a href="#wagl" class="header-anchor">#</a></h1><p>&#x53D7; Mesos-DNS &#x542F;&#x53D1;&#xFF0C;&#x4F46;&#x662F;&#x4E3A; <code>Swarm</code> &#x8BBE;&#x8BA1;&#x3002;&#x800C;&#x4E14;&#x8FD8;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x3002;</p><p>&#x5EFA;&#x8BAE; <code>wagl</code> &#x5B89;&#x88C5;&#x5728;&#x6240;&#x6709;&#x7684;<code>master</code>&#x8EAB;&#x4E0A;&#x3002;</p><p>&#x5728; docker engine &#x4E2D;&#x52A0;&#x5165; <code>--dns master01 --dns master02 &#x2026;</code></p><h1 id="bu-shu-wagl"><a href="#&#x90E8;&#x7F72;-wagl" class="headerlink" title="&#x90E8;&#x7F72; wagl"></a>&#x90E8;&#x7F72; wagl <a href="#bu-shu-wagl" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --restart=always --name=dns \</span><br><span class="line">    -p 53:53/udp \</span><br><span class="line">    --link=swarm-master:swarm \</span><br><span class="line">    ahmet/wagl \</span><br><span class="line">    wagl --swarm tcp://swarm:2375</span><br></pre></td></tr></table></figure><h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x5728;&#x4E09;&#x4E2A;<code>master</code>&#x4E0A;&#x8FD0;&#x884C;&#x4E86;<code>wagl</code></p><p>&#x7136;&#x540E;&#x5728;<code>swarm</code>&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</p><p>&#x8FD0;&#x884C;&#x4E86;3&#x4E2A; <code>nginx</code> &#x5BB9;&#x5668;&#x4F5C;&#x4E3A; <code>API</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 -l dns.service=api nginx</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6765;&#x8BD5;&#x56FE;&#x901A;&#x8BAF;api</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it &#x2014;dns master01 busybox</span><br><span class="line"></span><br><span class="line">dig _api._tcp.swarm</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;IP&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x53CA;SRV&#x8BB0;&#x5F55;&#x4E2D;&#x7684;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;</p><p>&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;api</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -iv http://api.swarm/</span><br></pre></td></tr></table></figure><p>&#x901A;&#x8FC7;<code>-v</code>&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x6B21;&#x94FE;&#x63A5;&#x7684;&#x662F; <code>192.168.0.5</code>&#xFF0C;&#x5982;&#x679C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x53EF;&#x80FD;&#x7ED3;&#x679C;&#x4F1A;&#x662F;&#x53E6;&#x4E00;&#x4E2A;ip&#xFF0C;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684;DNS TTL&#x662F;0&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x7ACB;&#x523B;&#x8FC7;&#x671F;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：生产环境中使用 Docker 必需有一个很好地私有 Registry</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-22-video-running-docker-in-production.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-22-video-running-docker-in-production.html</id>
    <published>2016-06-21T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.616Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#gong-gong-registry">&#x516C;&#x5171;registry</a></li><li><a href="#qi-ye-xu-yao-yi-ge-private-registry-repository">&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A; Private Registry/Repository</a></li><li><a href="#yi-ge-jian-zhuang-de-private-registry-shi-bi-yao-de">&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684; private registry &#x662F;&#x5FC5;&#x8981;&#x7684;</a></li><li><a href="#nexus-3-docker-private-registry">Nexus 3 Docker Private Registry</a></li><li><a href="#xiang-guan-xin-xi">&#x76F8;&#x5173;&#x4FE1;&#x606F;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Running Docker in Production? A Premium Private Registry is a must!<br>by Sonatype, 2015/11/3</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/qlsGHSFJ2ss" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=qlsGHSFJ2ss" target="_blank" rel="noopener">https://www.youtube.com/watch?v=qlsGHSFJ2ss</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=c0314lz1iu6&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/c0314lz1iu6.html" target="_blank" rel="noopener">http://v.qq.com/x/page/c0314lz1iu6.html</a></p><h1 id="gong-gong-registry"><a href="#&#x516C;&#x5171;registry" class="headerlink" title="&#x516C;&#x5171;registry"></a>&#x516C;&#x5171;registry <a href="#gong-gong-registry" class="header-anchor">#</a></h1><p>&#x6CA1;&#x6709;&#x7BA1;&#x7406;&#xFF0C;&#x4E0D;&#x4FE1;&#x4EFB;image</p><p>&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x5E76;&#x4E0D;&#x65B0;&#x9C9C;&#xFF0C;&#x5F00;&#x53D1;&#x5C31;&#x662F;&#x751F;&#x4EA7;&#xFF0C;Docker Image &#x662F;&#x4F9B;&#x5E94;&#x94FE;&#x7684;&#x4E00;&#x4E2A;&#x73AF;&#x8282;&#x800C;&#x5DF2;&#x3002;</p><h1 id="qi-ye-xu-yao-yi-ge-private-registry-repository"><a href="#&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A;-Private-Registry-Repository" class="headerlink" title="&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A; Private Registry/Repository"></a>&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A; Private Registry/Repository <a href="#qi-ye-xu-yao-yi-ge-private-registry-repository" class="header-anchor">#</a></h1><p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker registry</code>&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x7528;&#x6237;&#x754C;&#x9762;&#x3002;<br>&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x4F60;&#x7684;&#x4F9B;&#x5E94;&#x94FE;&#x73AF;&#x5883;&#x8BBE;&#x8BA1;&#x7684;</p><h1 id="yi-ge-jian-zhuang-de-private-registry-shi-bi-yao-de"><a href="#&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684;-private-registry-&#x662F;&#x5FC5;&#x8981;&#x7684;" class="headerlink" title="&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684; private registry &#x662F;&#x5FC5;&#x8981;&#x7684;"></a>&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684; private registry &#x662F;&#x5FC5;&#x8981;&#x7684; <a href="#yi-ge-jian-zhuang-de-private-registry-shi-bi-yao-de" class="header-anchor">#</a></h1><ul><li>&#x53EF;&#x4EE5;&#x672C;&#x5730;&#x5E76;&#x4E14;&#x5171;&#x4EAB;</li><li>&#x5FC5;&#x987B;&#x4E00;&#x81F4;&#x6027;</li><li>&#x7BA1;&#x7406;&#x6027;&#xFF1A;&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5141;&#x8BB8;&#x4FDD;&#x5B58;&#x79C1;&#x6709;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x907F;&#x514D;&#x91CD;&#x590D;</li><li>&#x96C6;&#x6210;&#x80FD;&#x529B;&#xFF1A;&#x76EE;&#x5F55;&#x670D;&#x52A1;&#x3001;&#x7F16;&#x6392;&#x3001;&#x53D1;&#x5E03;&#x81EA;&#x52A8;&#x5316;&#x3001;&#x5176;&#x5B83;registries</li></ul><h1 id="nexus-3-docker-private-registry"><a href="#Nexus-3-Docker-Private-Registry" class="headerlink" title="Nexus 3 Docker Private Registry"></a>Nexus 3 Docker Private Registry <a href="#nexus-3-docker-private-registry" class="header-anchor">#</a></h1><ul><li>Docker push/pull</li><li>browse, search</li><li>proxy of docker hub</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search 192.168.1.4:18075/redis</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x641C;&#x7D22; Registry &#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x5728; Nexus &#x8BBE;&#x7F6E; Docker Hub proxy&#xFF0C;&#x8FD9;&#x6837;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x641C;&#x7D22; docker hub</p><h1 id="xiang-guan-xin-xi"><a href="#&#x76F8;&#x5173;&#x4FE1;&#x606F;" class="headerlink" title="&#x76F8;&#x5173;&#x4FE1;&#x606F;"></a>&#x76F8;&#x5173;&#x4FE1;&#x606F; <a href="#xiang-guan-xin-xi" class="header-anchor">#</a></h1><p><a href="http://www.sonatype.com/download-oss-sonatype" target="_blank" rel="noopener">http://www.sonatype.com/download-oss-sonatype</a><br><a href="http://bitly.com/nexusanddocker" target="_blank" rel="noopener">http://bitly.com/nexusanddocker</a><br><a href="https://hub.docker.com/r/sonatype/nexus/" target="_blank" rel="noopener">https://hub.docker.com/r/sonatype/nexus/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="Sonatype" scheme="https://1x481n.github.io/blog.lab99.org/tags/Sonatype/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线交流会 28 - Docker Swarm 可以用于生产环境了 - Alexandre Beslic</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-22-video-docker-online-meetup-28-production-ready-docker-swarm.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-22-video-docker-online-meetup-28-production-ready-docker-swarm.html</id>
    <published>2016-06-21T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.616Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#duo-docker-engines-swarm">&#x591A; Docker Engines == Swarm</a></li><li><a href="#timeline">Timeline</a></li><li><a href="#swarm-in-general">Swarm in General</a></li><li><a href="#xin-ban-ben-te-dian">&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9;</a></li><li><a href="#duo-zhu-ji-wang-luo">&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;</a></li><li><a href="#docker-network"><code>docker network</code></a></li><li><a href="#demo">Demo</a><ul><li><a href="#docker-run"><code>docker run</code></a></li><li><a href="#docker-compose"><code>docker-compose</code></a></li><li><a href="#juan-guan-li">&#x5377;&#x7BA1;&#x7406;</a></li></ul></li><li><a href="#swarm-machine-compose"><code>swarm</code> + <code>machine</code> + <code>compose</code></a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup #28 - Production Ready Docker Swarm<br>  by Alexandre Beslic (2015/11/11)</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/3I6hWb24_qE" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=3I6hWb24_qE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=3I6hWb24_qE</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=y0314wpg13e&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/y0314wpg13e.html" target="_blank" rel="noopener">http://v.qq.com/x/page/y0314wpg13e.html</a></p><h1 id="duo-docker-engines-swarm"><a href="#&#x591A;-Docker-Engines-Swarm" class="headerlink" title="&#x591A; Docker Engines == Swarm"></a>&#x591A; Docker Engines == Swarm <a href="#duo-docker-engines-swarm" class="header-anchor">#</a></h1><p>CLI &#x2192; Swarm (Managers) &#x2192; Agents (Docker Nodes)<br>Managers &#x2192; machine discovery (etcd, consul, zookeeper)</p><h1 id="timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline <a href="#timeline" class="header-anchor">#</a></h1><ul><li>2014&#x5E74;10&#x6708;  Proof of Concept</li><li>2015&#x5E74;1&#x6708;   First RC</li><li>2015&#x5E74;2&#x6708;   swarm beta</li><li>2015&#x5E74;4&#x6708;   0.2.0</li><li>2015&#x5E74;10&#x6708;  1.0.0 release (stable)</li></ul><h1 id="swarm-in-general"><a href="#Swarm-in-General" class="headerlink" title="Swarm in General"></a>Swarm in General <a href="#swarm-in-general" class="header-anchor">#</a></h1><p>&#x5C06;&#x4E00;&#x7FA4;Docker Engins&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x6C60;</p><p>&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684;Docker REST API<br>&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#xFF08;CPU&#x3001;&#x5185;&#x5B58;&#x3001;&#x7F51;&#x7EDC;&#xFF09;<br>Service Discovery (<code>etcd</code>, <code>consul</code>, <code>zookeeper</code>)<br>TLS<br>multi-tenancy</p><h1 id="xin-ban-ben-te-dian"><a href="#&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9;" class="headerlink" title="&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9;"></a>&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9; <a href="#xin-ban-ben-te-dian" class="header-anchor">#</a></h1><p>&#x6539;&#x8FDB;&#x8C03;&#x5EA6;&#x5668;&#x3001;&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x3001;&#x5377;&#x7BA1;&#x7406;&#x3001;&#x66F4;&#x597D;&#x7684;Compose&#x96C6;&#x6210;</p><p>1.1 &#x2192; container rebalancing, global scheduling</p><h1 id="duo-zhu-ji-wang-luo"><a href="#&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;" class="headerlink" title="&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;"></a>&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC; <a href="#duo-zhu-ji-wang-luo" class="header-anchor">#</a></h1><p>DockerCon SF 2015 June &#x53D1;&#x5E03;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x7A33;&#x5B9A;&#x4E86;</p><p>&#x5141;&#x8BB8;&#x4F7F;&#x7528; <code>vxlan</code> &#x521B;&#x5EFA; <code>overlay</code> &#x7F51;&#x7EDC;</p><p>&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5230;&#x540C;&#x4E00;&#x4E2A;<code>overlay network</code>&#x7684;&#x4E3B;&#x673A;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BF9;&#x65B9;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x65B9;&#x540D;&#x5B57;&#x5B9A;&#x4F4D;&#x5230;&#x5BF9;&#x65B9;&#x3002;</p><h1 id="docker-network"><a href="#docker-network" class="headerlink" title="docker network"></a><code>docker network</code> <a href="#docker-network" class="header-anchor">#</a></h1><p>{<code>rm</code>, <code>create</code>, <code>connect</code>, <code>disconnect</code>, <code>inspect</code>, <code>ls</code>}</p><h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x5728; GCE, Azure, EC2, 3&#x4E2A; Digital Ocean &#x603B;&#x5171;6&#x4E2A;&#x4E3B;&#x673A;</p><h2 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a><code>docker run</code> <a href="#docker-run" class="header-anchor">#</a></h2><p>&#x5148;&#x521B;&#x5EFA;<code>overlay</code>&#x7F51;&#x7EDC;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d overlay overlay_test</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5728;Swarm&#x4E0A;&#x8FD0;&#x884C;&#x4E09;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x90FD;&#x4F7F;&#x7528;overlay_test&#x7F51;&#x7EDC;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=app1 --net=overlay_test busybox</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5728;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x540D;&#x5B57;<code>ping</code>&#x540C;&#x5BF9;&#x65B9;&#x3002;</p><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a><code>docker-compose</code> <a href="#docker-compose" class="header-anchor">#</a></h2><p><em>&#x8BE5;&#x7248;&#x672C;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>--x-networking</code> &#x6765;&#x542F;&#x7528;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4E4B;&#x540E;&#x4E0D;&#x9700;&#x8981;&#x4E86;</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --x-networking up -d</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;demo&#x7684;python worker&#x4E2D;&#x6240;&#x5199;&#x7684;<code>redis</code>&#x4E3B;&#x673A;&#x540D;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x751F;&#x6210;&#x7684;&#x5BB9;&#x5668;&#x540D;&#xFF0C;<code>jobdoer_redis_1</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>&lt;&#x9879;&#x76EE;&#x540D;&gt;_&lt;&#x670D;&#x52A1;&#x540D;&gt;_&#x5E8F;&#x53F7;</code>&#x3002;</p><p>&#x90A3;&#x4E48;&#x8FD9;&#x53EA;&#x662F;&#x94FE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x8981;&#x662F;redis&#x662F;&#x4E2A;&#x96C6;&#x7FA4;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x4F7F;&#x7528;<code>redis</code>&#x670D;&#x52A1;&#x540D;&#x5373;&#x53EF;&#x3002;</p><h2 id="juan-guan-li"><a href="#&#x5377;&#x7BA1;&#x7406;" class="headerlink" title="&#x5377;&#x7BA1;&#x7406;"></a>&#x5377;&#x7BA1;&#x7406; <a href="#juan-guan-li" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume {create, ls, inspect, rm}</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x6BD4;&#x5982;&#x4F7F;&#x7528;<code>Ceph</code>&#x96C6;&#x7FA4;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>Ceph</code>&#x4E0A;&#x7684;<code>volume</code>&#xFF0C;&#x7136;&#x540E;&#x5728;Docker&#x4E0A;&#x6302;&#x8F7D;&#x8FD9;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;<code>volume</code>&#x3002;</p><h1 id="swarm-machine-compose"><a href="#swarm-machine-compose" class="headerlink" title="swarm + machine + compose"></a><code>swarm</code> + <code>machine</code> + <code>compose</code> <a href="#swarm-machine-compose" class="header-anchor">#</a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="https://1x481n.github.io/blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：如何成功在生产环境中运行 Docker - John Fiedler</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-21-video-how-to-be-successful-running-docker-in-production.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-21-video-how-to-be-successful-running-docker-in-production.html</id>
    <published>2016-06-20T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.615Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#ding-yi-sheng-chan-huan-jing">&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883;</a></li><li><a href="#ding-yi-cheng-gong">&#x5B9A;&#x4E49;&#x6210;&#x529F;</a></li><li><a href="#fang-ru-rong-qi-de-dong-xi">&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A;</a></li><li><a href="#docker-hua-de-chang-jing">docker&#x5316;&#x7684;&#x573A;&#x666F;</a><ul><li><a href="#chuang-jian">&#x521B;&#x5EFA;</a></li><li><a href="#bu-shu">&#x90E8;&#x7F72;</a></li><li><a href="#yun-xing">&#x8FD0;&#x884C;</a></li><li><a href="#yun-wei">&#x8FD0;&#x7EF4;</a></li></ul></li><li><a href="#jing-yan">&#x7ECF;&#x9A8C;</a><ul><li><a href="#di-yi-ge-wen-ti">&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;</a></li><li><a href="#nei-he-ban-ben-hen-chong-yao">&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981;</a></li><li><a href="#zhao-ge-hao-de-registry">&#x627E;&#x4E2A;&#x597D;&#x7684;registry</a></li><li><a href="#zai-aws-bu-shu">&#x5728;AWS&#x90E8;&#x7F72;</a></li><li><a href="#mei-ge-zhu-ji-you-yue-shao-de-rong-qi-yue-hao">&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D;</a></li><li><a href="#ci-cd-with-docker">CI/CD with Docker</a></li><li><a href="#beanstalk-architecture">Beanstalk architecture</a></li><li><a href="#yi-nian-qian">&#x4E00;&#x5E74;&#x524D;</a></li></ul></li><li><a href="#zong-jie">&#x603B;&#x7ED3;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>How to be successful running Docker in Production<br>by John Fiedler<br>Senior Director of Engineering @ SalesforeceIQ</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/j6Ge4wP1yH0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=j6Ge4wP1yH0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=j6Ge4wP1yH0</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=f0314wy9h49&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/x/page/f0314wy9h49.html" target="_blank" rel="noopener">http://v.qq.com/x/page/f0314wy9h49.html</a></p><h1 id="ding-yi-sheng-chan-huan-jing"><a href="#&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883;" class="headerlink" title="&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883;"></a>&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883; <a href="#ding-yi-sheng-chan-huan-jing" class="header-anchor">#</a></h1><ul><li>Production != test dev</li><li>&#x8981;&#x8003;&#x8651;&#x9694;&#x79BB;&#x3001;&#x5B89;&#x5168;&#x3001;&#x6027;&#x80FD;&#x3001;&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x7B49;&#x7B49;</li><li>&#x8981;&#x6269;&#x5C55;&#x3001;&#x6A21;&#x677F;&#x3001;&#x81EA;&#x52A8;&#x5316;</li></ul><h1 id="ding-yi-cheng-gong"><a href="#&#x5B9A;&#x4E49;&#x6210;&#x529F;" class="headerlink" title="&#x5B9A;&#x4E49;&#x6210;&#x529F;"></a>&#x5B9A;&#x4E49;&#x6210;&#x529F; <a href="#ding-yi-cheng-gong" class="header-anchor">#</a></h1><ul><li><blockquote><p>99% uptime&#xFF1F;</p></blockquote></li><li>&#x5FEB;&#x901F;&#x4EE3;&#x7801;&#x90E8;&#x7F72;</li><li>0 &#x5B89;&#x5168;&#x4E8B;&#x4EF6;&#xFF1F;</li></ul><p>100% &#x7684;web infrastructure &#x4F7F;&#x7528;docker</p><h1 id="fang-ru-rong-qi-de-dong-xi"><a href="#&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A;" class="headerlink" title="&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A;"></a>&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A; <a href="#fang-ru-rong-qi-de-dong-xi" class="header-anchor">#</a></h1><ul><li><p>&#x8D8A;&#x591A;&#x4F9D;&#x8D56;&#x3001;&#x8D8A;&#x591A;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x5C31;&#x8D8A;&#x9002;&#x5408;</p><ul><li>&#x6BD4;&#x5982;Web&#x670D;&#x52A1;&#xFF0C;&#x5185;&#x5BB9;&#x7ED3;&#x6784;&#x4F1A;&#x7ECF;&#x5E38;&#x53D8;&#x5316;&#xFF0C;&#x800C;&#x4E14;&#x4F9D;&#x8D56;&#x975E;&#x5E38;&#x591A;&#xFF1B;</li><li>&#x800C;&#x6570;&#x636E;&#x5E93;&#x5219;&#x4E00;&#x65E6;&#x90E8;&#x7F72;&#x51E0;&#x5E74;&#x4E0D;&#x53D8;&#x52A8;&#xFF0C;&#x800C;&#x4E14;&#x4F9D;&#x8D56;&#x5F88;&#x5C11;&#xFF1B;</li></ul></li><li><p>&#x8D8A;&#x662F;&#x65E0;&#x72B6;&#x6001;(<code>stateless</code>)&#x3001;&#x8D8A;&#x77ED;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;</p></li></ul><h1 id="docker-hua-de-chang-jing"><a href="#docker&#x5316;&#x7684;&#x573A;&#x666F;" class="headerlink" title="docker&#x5316;&#x7684;&#x573A;&#x666F;"></a>docker&#x5316;&#x7684;&#x573A;&#x666F; <a href="#docker-hua-de-chang-jing" class="header-anchor">#</a></h1><h2 id="chuang-jian"><a href="#&#x521B;&#x5EFA;" class="headerlink" title="&#x521B;&#x5EFA;"></a>&#x521B;&#x5EFA; <a href="#chuang-jian" class="header-anchor">#</a></h2><ul><li>Dev/Ops&#x662F;&#x5B8C;&#x5168;Docker&#x5316;&#x7684;&#xFF1B;</li></ul><h2 id="bu-shu"><a href="#&#x90E8;&#x7F72;" class="headerlink" title="&#x90E8;&#x7F72;"></a>&#x90E8;&#x7F72; <a href="#bu-shu" class="header-anchor">#</a></h2><ul><li>CI/CD&#x662F;&#x90E8;&#x5206;Docker&#x5316;&#x7684;&#xFF1B;</li></ul><h2 id="yun-xing"><a href="#&#x8FD0;&#x884C;" class="headerlink" title="&#x8FD0;&#x884C;"></a>&#x8FD0;&#x884C; <a href="#yun-xing" class="header-anchor">#</a></h2><ul><li>Web&#x3001;&#x4E2D;&#x95F4;&#x4EF6;&#x3001;&#x4EFB;&#x52A1;&#x3001;&#x811A;&#x672C;&#x662F;&#x5B8C;&#x5168;Docker&#x5316;&#x7684;</li><li>&#x6279;&#x5904;&#x7406;&#x548C;&#x6D41;&#x5904;&#x7406;&#x662F;&#x90E8;&#x5206;Docker&#x5316;&#x7684;&#xFF1B;</li><li>&#x56FA;&#x5B9A;&#x5B58;&#x50A8;&#x5219;&#x4E0D;&#x662F;Docker&#x5316;&#x7684;&#x3002;</li></ul><h2 id="yun-wei"><a href="#&#x8FD0;&#x7EF4;" class="headerlink" title="&#x8FD0;&#x7EF4;"></a>&#x8FD0;&#x7EF4; <a href="#yun-wei" class="header-anchor">#</a></h2><ul><li>&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x3001;&#x5B89;&#x5168;&#x662F;&#x90E8;&#x5206;docker&#x5316;&#x7684;&#x3002;</li></ul><p>&#x66FE;&#x7ECF;&#x5C1D;&#x8BD5;&#x8FC7; Docker in Docker&#xFF0C;&#x4F46;&#x662F;&#x53D1;&#x73B0;&#x5F88;&#x60F3;&#x6269;&#x5C55;&#x80FD;&#x529B;&#x592A;&#x5DEE;&#x3002;</p><p>&#x73B0;&#x5728;70%&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5728;docker&#x91CC;&#x3002;</p><h1 id="jing-yan"><a href="#&#x7ECF;&#x9A8C;" class="headerlink" title="&#x7ECF;&#x9A8C;"></a>&#x7ECF;&#x9A8C; <a href="#jing-yan" class="header-anchor">#</a></h1><p>Docker &#x73B0;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7A33;&#x5B9A;&#x3002;&#x4F46;&#x662F;&#x5468;&#x8FB9;&#x7684;&#x5DE5;&#x5177;&#x4E0D;&#x4E00;&#x5B9A;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x53EF;&#x7528;&#xFF0C;&#x8981;&#x8C28;&#x614E;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x914D;&#x5408;docker&#x4F7F;&#x7528;<code>chef</code>, <code>ansible</code>, <code>saltstack</code>&#x7B49;&#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x4E00;&#x6837;&#x7528;&#xFF0C;&#x800C;&#x4E14;&#x914D;&#x5408;&#x7528;&#x8D77;&#x6765;&#x5F88;&#x597D;&#x3002;</p><p>&#x73B0;&#x5728;&#x5728; AWS AMI &#x4E0A;&#x7528;<code>Chef</code>&#x6765;&#x8BBE;&#x7F6E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;web server&#xFF0C;&#x7528;<code>cron</code>&#x63A7;&#x5236;&#x811A;&#x672C;&#x6765;&#x7F16;&#x6392;&#x5BB9;&#x5668;&#x3002;</p><h2 id="di-yi-ge-wen-ti"><a href="#&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;" class="headerlink" title="&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;"></a>&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898; <a href="#di-yi-ge-wen-ti" class="header-anchor">#</a></h2><p>&#x4F60;&#x4E00;&#x5B9A;&#x4F1A;&#x78B0;&#x5230; disk/file system&#x95EE;&#x9898;</p><ul><li>&#x6700;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x7684; <code>aufs</code>&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5FEB;&#x5C31;&#x78B0;&#x5230;&#x4E86;42&#x5C42;&#x9650;&#x5236;</li><li>&#x7136;&#x540E;&#x6362;&#x5230;&#x4E86; <code>device mapper</code>&#xFF0C;&#x7ED3;&#x679C;&#x975E;&#x5E38;&#x60B2;&#x60E8;&#xFF0C;&#x56F4;&#x7ED5;&#x7740;<code>CentOS</code>&#x78B0;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF1B;</li><li>&#x6362;&#x5230;ubuntu&#x597D;&#x4E00;&#x4E9B;&#xFF0C;&#x6362;&#x56DE; <code>aufs</code>&#xFF0C;&#x89E3;&#x9664;&#x4E86;42&#x5C42;&#x9650;&#x5236;&#xFF0C;&#x4F46;&#x8FD8;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x5206;&#x5C42;&#x3001;&#x7ED1;&#x5B9A;&#xFF1B;</li><li>&#x5347;&#x7EA7;&#x5230; <code>Docker 1.7</code> &#x540E;&#xFF0C;&#x6216;&#x8BB8;&#x4F1A;&#x6362;&#x56DE; CentOS &#x548C; Device mapper&#xFF0C;&#x56E0;&#x4E3A; dynamic binaries&#x3002;</li></ul><p>&#x63A8;&#x8350;&#x7406;&#x89E3;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x7684;&#x53EF;&#x89C6;&#x5316;&#x94FE;&#x63A5;&#xFF1A;<br><a href="http://merrigrove.blogspot.com/2015/10/visualizing-docker-containers-and-images.html?m=1" target="_blank" rel="noopener">http://merrigrove.blogspot.com/2015/10/visualizing-docker-containers-and-images.html?m=1</a></p><h2 id="nei-he-ban-ben-hen-chong-yao"><a href="#&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981;" class="headerlink" title="&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981;"></a>&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981; <a href="#nei-he-ban-ben-hen-chong-yao" class="header-anchor">#</a></h2><h2 id="zhao-ge-hao-de-registry"><a href="#&#x627E;&#x4E2A;&#x597D;&#x7684;registry" class="headerlink" title="&#x627E;&#x4E2A;&#x597D;&#x7684;registry"></a>&#x627E;&#x4E2A;&#x597D;&#x7684;registry <a href="#zhao-ge-hao-de-registry" class="header-anchor">#</a></h2><p>&#x6BD4;&#x5982;</p><ul><li><a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a></li><li><a href="https://quay.io" target="_blank" rel="noopener">https://quay.io</a></li><li>Docker Trusted Registry</li></ul><p>&#x6700;&#x5F00;&#x59CB;&#x5C1D;&#x8BD5;&#x4E86;<code>registry</code>&#xFF0C;&#x5F88;&#x591A;bug&#xFF0C;&#x5F88;&#x591A;fail pull/push<br>&#x7136;&#x540E;&#x5C1D;&#x8BD5;&#x4E86; <code>quay.io</code>&#xFF0C;happy&#x4F46;&#x662F;&#x5F88;&#x6162;(&#x6709;&#x4E9B;image&#x5F97;700&#x591A;MB)&#xFF0C;&#x800C;&#x4E14;&#x82B1;&#x94B1;&#x554A;&#x2026;&#x2026;<br>&#x540E;&#x6765;&#x53C8;&#x56DE;&#x5230;&#x4E86; <code>docker registry 0.9</code>&#xFF0C;&#x76EE;&#x524D;&#x7A33;&#x5B9A;&#x591A;&#x4E86;&#x3002;<br>&#x6A2A;&#x5411;&#x6269;&#x5C55;&#xFF0C;&#x975E;&#x5E38;&#x597D;&#xFF1B;<br>&#x76EE;&#x524D;&#x5728;&#x5347;&#x7EA7;&#x5230; <code>registry 2.1</code></p><h2 id="zai-aws-bu-shu"><a href="#&#x5728;AWS&#x90E8;&#x7F72;" class="headerlink" title="&#x5728;AWS&#x90E8;&#x7F72;"></a>&#x5728;AWS&#x90E8;&#x7F72; <a href="#zai-aws-bu-shu" class="header-anchor">#</a></h2><p>&#x7528;&#x7684;&#x662F;<code>Beanstalk</code>&#xFF0C; <code>ELB</code>&#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#xFF0C;&#x4F7F;&#x7528;<code>Elasticcache(redis)</code>&#x505A;cache&#xFF0C;&#x7528;<code>S3</code>&#x505A;&#x5B58;&#x50A8;&#x3002;</p><h2 id="mei-ge-zhu-ji-you-yue-shao-de-rong-qi-yue-hao"><a href="#&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D;" class="headerlink" title="&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D;"></a>&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D; <a href="#mei-ge-zhu-ji-you-yue-shao-de-rong-qi-yue-hao" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x7684;CPU, DISK IO&#xFF0C;&#x7F51;&#x7EDC;IO&#xFF0C;&#x5185;&#x5B58;&#x51FA;&#x73B0;&#x4E86;&#x4F7F;&#x7528;&#x5CF0;&#x503C;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x88AB;&#x5E72;&#x6270;&#x3002;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</p><h2 id="ci-cd-with-docker"><a href="#CI-CD-with-Docker" class="headerlink" title="CI/CD with Docker"></a>CI/CD with Docker <a href="#ci-cd-with-docker" class="header-anchor">#</a></h2><p>huge ROI with docker</p><p>GitHub.com &#x2192; Teamcity &#x2192; agents &#x2192; Registry &#x2192; Server</p><p>&#x4ECE;&#x524D; agents &#x662F;&#x5728;docker&#x91CC;&#x7684;&#xFF0C;docker in docker&#xFF0C;&#x73B0;&#x5728;&#x662F;&#x4F7F;&#x7528;<code>chef</code>&#x548C;<code>packer</code>&#x3002;</p><p>&#x63A8;&#x8350;&#x6587;&#x7AE0;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x8981;&#x4F7F;&#x7528;Docker in docker&#xFF1A;<br><a href="https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/" target="_blank" rel="noopener">https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/</a></p><h2 id="beanstalk-architecture"><a href="#Beanstalk-architecture" class="headerlink" title="Beanstalk architecture"></a>Beanstalk architecture <a href="#beanstalk-architecture" class="header-anchor">#</a></h2><h2 id="yi-nian-qian"><a href="#&#x4E00;&#x5E74;&#x524D;" class="headerlink" title="&#x4E00;&#x5E74;&#x524D;"></a>&#x4E00;&#x5E74;&#x524D; <a href="#yi-nian-qian" class="header-anchor">#</a></h2><p>CoreOS&#x521A;&#x63A8;&#x51FA;&#xFF0C;&#x89C9;&#x5F97;&#x8D85;&#x9177;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x4E86;&#xFF0C;&#x7ED3;&#x679C;&#x5931;&#x8D25;&#x7684;&#x5F88;&#x60E8;</p><h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><p>&#x521A;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x4F60;&#x719F;&#x6089;&#x7684;&#x5DE5;&#x5177;<br>&#x4F60;&#x9700;&#x8981;&#x8003;&#x8651;&#x6A2A;&#x5411;&#x6269;&#x5C55;<br>&#x5B89;&#x5168;&#x4E0D;&#x96BE;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x5B9A;&#x8981;&#x8003;&#x8651;<br>&#x8BB8;&#x591A;&#x8F6F;&#x4EF6;&#x4F9B;&#x5E94;&#x5546;&#x8FDB;&#x5165;&#x5230;&#x4E86;&#x5BB9;&#x5668;&#x9886;&#x57DF;<br>&#x5411; PaaS &#x7684;&#x65B9;&#x5411;&#x6784;&#x5EFA;<br>&#x8981;&#x77E5;&#x9053;&#x4F60;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker Registry - Stephen Day</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-20-video-docker-registry-by-stephen-day.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-20-video-docker-registry-by-stephen-day.html</id>
    <published>2016-06-19T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.615Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-me-shi-docker">&#x4EC0;&#x4E48;&#x662F;Docker</a></li><li><a href="#li-shi">&#x5386;&#x53F2;</a></li><li><a href="#api-v1-de-wen-ti">API v1 &#x7684;&#x95EE;&#x9898;</a></li><li><a href="#api-v2-mu-biao">API v2 &#x76EE;&#x6807;</a><ul><li><a href="#v2-content-addressable">V2: Content Addressable</a></li><li><a href="#v2-manifests">V2: Manifests</a></li><li><a href="#content-addressable">Content-addressable</a></li><li><a href="#merkle-tree">Merkle Tree</a></li></ul></li><li><a href="#he-v1-api-bu-tong-de-di-fang">&#x548C;v1 API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;</a></li><li><a href="#docker-registry-2-0-gou-cheng">Docker Registry 2.0 &#x6784;&#x6210;</a></li><li><a href="#docker-registry-2-1">Docker Registry 2.1</a></li><li><a href="#docker-distribution">Docker Distribution</a></li></ul><!-- tocstop --><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/RnO9JnEO8tY" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=RnO9JnEO8tY" target="_blank" rel="noopener">https://www.youtube.com/watch?v=RnO9JnEO8tY</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0314thmzhe&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/page/b/h/e/b0314thmzhe.html" target="_blank" rel="noopener">http://v.qq.com/page/b/h/e/b0314thmzhe.html</a></p><h1 id="shi-me-shi-docker"><a href="#&#x4EC0;&#x4E48;&#x662F;Docker" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;Docker"></a>&#x4EC0;&#x4E48;&#x662F;Docker <a href="#shi-me-shi-docker" class="header-anchor">#</a></h1><p>Container &#x662F; docker &#x7684;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x7531; image &#x521B;&#x5EFA;<br>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x6709;&#x591A;&#x4E2A;&#x5C42;&#x7EC4;&#x6210;&#xFF0C;&#x6BCF;&#x5C42;&#x53EA;&#x662F;&#x4E2A;tar&#x6587;&#x4EF6;&#x3002;&#x5C42;&#x53EF;&#x4EE5;&#x7531;&#x4E0D;&#x540C;&#x7684;image&#x5171;&#x4EAB;&#x3002;</p><p>&#x628A;&#x591A;&#x4E2A;&#x5C42;&#x653E;&#x5230;&#x4E00;&#x8D77;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x63CF;&#x8FF0;&#x5982;&#x4F55;&#x7EC4;&#x7EC7;&#x8FD9;&#x4E9B;&#x5C42;&#xFF0C;&#x5C31;&#x6210;&#x4E86;&#x955C;&#x50CF;&#x3002;</p><h1 id="li-shi"><a href="#&#x5386;&#x53F2;" class="headerlink" title="&#x5386;&#x53F2;"></a>&#x5386;&#x53F2; <a href="#li-shi" class="header-anchor">#</a></h1><p>Docker Registry API v1<br>&#x9762;&#x5411;&#x5C42;&#x7684;<br>&#x5C42;id&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;<br>&#x4E00;&#x4E2A;JSON&#x8D1F;&#x8D23;&#x4E00;&#x4E2A;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x6307;&#x5411;&#x7236;&#x5C42;<br>&#x547D;&#x540D;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x9760;tag</p><h1 id="api-v1-de-wen-ti"><a href="#API-v1-&#x7684;&#x95EE;&#x9898;" class="headerlink" title="API v1 &#x7684;&#x95EE;&#x9898;"></a>API v1 &#x7684;&#x95EE;&#x9898; <a href="#api-v1-de-wen-ti" class="header-anchor">#</a></h1><ul><li>Abstraction &#x2192; &#x66B4;&#x9732;image&#x53D1;&#x5E03;&#x673A;&#x5236;&#xFF0C;&#x66B4;&#x9732;&#x5185;&#x90E8;&#x591A;&#x5C42;</li><li>Security &#x2192; Image ID &#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x79D8;&#x5BC6;&#xFF0C;&#x6CA1;&#x6709;&#x5BA1;&#x8BA1;&#x3001;&#x9A8C;&#x8BC1;&#xFF0C;&#x800C;&#x4E14;&#x8C01;&#x5206;&#x914D; layer id&#xFF1F;</li><li>Performance &#x2192; &#x6027;&#x80FD;&#x5F88;&#x6162;&#xFF0C;&#x53D6;&#x5F53;&#x524D;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x53D6;&#x7236;&#x5C42;&#xFF0C;&#x4E00;&#x6B65;&#x6B65;&#x5411;&#x4E0A;&#xFF0C;&#x65E0;&#x6CD5;&#x5E76;&#x884C;&#x3002;</li><li>&#x7528;Python&#x5B9E;&#x73B0; &#x2192; &#x4E0D;&#x6613;&#x4E8E;&#x90E8;&#x7F72;</li></ul><h1 id="api-v2-mu-biao"><a href="#API-v2-&#x76EE;&#x6807;" class="headerlink" title="API v2 &#x76EE;&#x6807;"></a>API v2 &#x76EE;&#x6807; <a href="#api-v2-mu-biao" class="header-anchor">#</a></h1><ul><li>&#x7B80;&#x5355;&#xFF1A;&#x6613;&#x4E8E;&#x90E8;&#x7F72;&#xFF0C;&#x9002;&#x4E8E;&#x9759;&#x6001;&#x4E3B;&#x673A;</li><li>&#x5B89;&#x5168;&#xFF1A;Image &#x53EF;&#x4EE5;&#x88AB;&#x9A8C;&#x8BC1;</li><li>&#x5206;&#x5E03;&#x5F0F;&#xFF1A;&#x5206;&#x79BB;&#x547D;&#x540D;&#x548C;&#x5185;&#x5BB9;&#x5730;&#x5740;</li><li>&#x6027;&#x80FD;&#xFF1A;&#x907F;&#x514D;&#x5355;&#x7EBF;&#x7A0B;&#x5904;&#x7406;</li><li>&#x5B9E;&#x73B0;&#xFF1A;&#x91C7;&#x7528; Go &#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x66F4;&#x591A;&#x7684;Docker Engine&#x7684;&#x4EE3;&#x7801;</li></ul><h2 id="v2-content-addressable"><a href="#V2-Content-Addressable" class="headerlink" title="V2: Content Addressable"></a>V2: Content Addressable <a href="#v2-content-addressable" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528;SHA256&#xFF0C;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x8BE5;&#x5C42;&#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#x4E0B;&#x8F7D;&#xFF0C;&#x800C;&#x4E14;&#x786E;&#x4FDD;&#x5185;&#x5BB9;&#x4E00;&#x81F4;</p><h2 id="v2-manifests"><a href="#V2-Manifests" class="headerlink" title="V2: Manifests"></a>V2: Manifests <a href="#v2-manifests" class="header-anchor">#</a></h2><p>&#x63CF;&#x8FF0;&#x4E00;&#x4E2A;image&#x7684;&#x5404;&#x4E2A;&#x5C42;&#x7EC4;&#x4EF6;&#xFF0C;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#x5305;&#x542B;&#x6240;&#x6709;&#x4E1C;&#x897F;</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>: &lt;name&gt;,</span><br><span class="line">   <span class="attr">&quot;tag&quot;</span>: &lt;tag&gt;,</span><br><span class="line">   &quot;fsLayers&quot;: [{&#x2026;}],</span><br><span class="line">    &#x2026;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="content-addressable"><a href="#Content-addressable" class="headerlink" title="Content-addressable"></a>Content-addressable <a href="#content-addressable" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu@sha256:xxxxxxxx</span><br></pre></td></tr></table></figure><h2 id="merkle-tree"><a href="#Merkle-Tree" class="headerlink" title="Merkle Tree"></a>Merkle Tree <a href="#merkle-tree" class="header-anchor">#</a></h2><p>&#x5229;&#x7528; Merkle Tree &#x6765;&#x7B7E;&#x540D;&#x5404;&#x4E2A;&#x5C42;&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x5404;&#x5C42;&#x5B8C;&#x6574;&#x6027;&#x3002;&#xFF08;&#x5F53;&#x5E74;&#x5728;&#x5927;&#x5B66;&#x7684;Advanced Computer Security&#x4E2D;&#x505A;&#x7684;presentation&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#xFF09;</p><p>&#x73B0;&#x5728;&#x6240;&#x6709;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x5C5E;&#x4E8E; named repository &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;image id&#x4E0D;&#x518D;&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x79D8;&#x5BC6;&#xFF1B;</p><p>&#x7B80;&#x5316;&#x8BA4;&#x8BC1;&#x6A21;&#x578B;&#xFF0C;&#x64CD;&#x4F5C;&#x7B80;&#x5316;&#x4E3A;push, pull&#xFF1B;</p><p>&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x63D0;&#x4F9B;&#x5185;&#x5BB9;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;repository&#x6765;&#x8BC1;&#x660E;&#x5185;&#x5BB9;&#x662F;&#x53EF;&#x7528;&#x7684;&#xFF0C;&#x4ECE;&#x800C;&#x8BC1;&#x660E;&#x81EA;&#x5DF1;&#x786E;&#x5B9E;&#x62E5;&#x6709;&#x5176;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x63D0;&#x4F9B;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;repository&#x800C;&#x53D6;&#x5F97;&#x4E0D;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;layer&#x3002;</p><p>v2&#x653E;&#x5F00;&#x4E86;&#x4E24;&#x90E8;&#x5206;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x9650;&#x5236;&#x4E8E; <code>&lt;user&gt;/&lt;image&gt;</code> &#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x591A;&#x5C42;&#x3002;</p><p>push/pull &#x5C06;&#x53EF;&#x4EE5;&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#xFF0C;&#x5C1A;&#x672A;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x5B9A;&#x4E49;&#x5728;api&#x4E86;&#x3002;</p><h1 id="he-v1-api-bu-tong-de-di-fang"><a href="#&#x548C;v1-API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;" class="headerlink" title="&#x548C;v1 API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;"></a>&#x548C;v1 API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9; <a href="#he-v1-api-bu-tong-de-di-fang" class="header-anchor">#</a></h1><p>&#x591A;&#x6B65;&#x4E0A;&#x4F20;&#xFF1B;</p><p>&#x6CA1;&#x6709;Search API&#x3001;&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x7684;Tag API&#x3002;&#x8FD8;&#x5728;&#x601D;&#x8003;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x3002;</p><h1 id="docker-registry-2-0-gou-cheng"><a href="#Docker-Registry-2-0-&#x6784;&#x6210;" class="headerlink" title="Docker Registry 2.0 &#x6784;&#x6210;"></a>Docker Registry 2.0 &#x6784;&#x6210; <a href="#docker-registry-2-0-gou-cheng" class="header-anchor">#</a></h1><p>&#x4E0D;&#x5728;&#x4F7F;&#x7528; monolithic &#x6784;&#x67B6;</p><p>&#x53EF;&#x6269;&#x5C55;&#x7684;&#xFF0C;&#x8BA4;&#x8BC1;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#x3001;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#xFF0C;</p><p>&#x4F1A;&#x5728; Docker 1.6 &#x5F00;&#x59CB;&#x5B8C;&#x5168;&#x652F;&#x6301;&#xFF1B;</p><p>&#x5927;&#x591A;&#x6570;&#x6982;&#x5FF5;&#x90FD;&#x5DF2;&#x7ECF;&#x5728; 1.3&#x3001;1.4 &#x4E2D;&#x9A8C;&#x8BC1;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x66F4;&#x5FEB;&#x7684; pull &#x7684;&#x901F;&#x5EA6;&#x3002;</p><p>&#x73B0;&#x5728;&#x5728; Hub &#x4E0A;&#x8FD0;&#x884C;&#xFF0C;S3 &#x5B58;&#x50A8;&#x540E;&#x7AEF;&#x3002;</p><p>&#x5BF9;&#x6BD4; v1</p><p>&#x5C11;&#x4E86; 80% &#x7684;Request<br>&#x5C11;&#x4E86; 60% &#x7684;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;</p><p>V1 vs V2 &#x9519;&#x8BEF;&#xFF0C;V2&#x9519;&#x8BEF;&#x5C11;&#x4E86;&#x5F88;&#x591A;&#x3002;</p><h1 id="docker-registry-2-1"><a href="#Docker-Registry-2-1" class="headerlink" title="Docker Registry 2.1"></a>Docker Registry 2.1 <a href="#docker-registry-2-1" class="header-anchor">#</a></h1><p>&#x6587;&#x6863;&#x3001;Pull through caching&#x3001;&#x8F6F;&#x5220;&#x9664;&#x3001;&#x57FA;&#x672C;&#x8BA4;&#x8BC1;&#x3001;Catalog API&#x3001;Storage Driver&#xFF0C;2015&#x5E74;7&#x6708;&#x4E2D;&#x65EC;&#x53D1;&#x5E03;&#x3002;</p><h1 id="docker-distribution"><a href="#Docker-Distribution" class="headerlink" title="Docker Distribution"></a>Docker Distribution <a href="#docker-distribution" class="header-anchor">#</a></h1><p>&#x76EE;&#x7684;&#xFF1A;</p><ul><li>&#x6539;&#x8FDB;image&#x5206;&#x53D1;</li><li>&#x6784;&#x5EFA;&#x5B89;&#x5168;&#x7A33;&#x56FA;&#x7684;&#x57FA;&#x7840;</li></ul><p>&#x5173;&#x6CE8;&#x7684;&#x7126;&#x70B9;&#xFF1A;</p><ul><li>&#x5B89;&#x5168;&#x3001;&#x53EF;&#x9760;&#x3001;&#x6027;&#x80FD;</li></ul><p>&#x91CA;&#x653E;&#x65B0;&#x7684;&#x5206;&#x53D1;&#x6A21;&#x578B;</p><ul><li>&#x96C6;&#x6210;&#x4FE1;&#x4EFB;&#x7CFB;&#x7EDF;(notary)</li><li>&#x70B9;&#x5BF9;&#x70B9;&#x5927;&#x89C4;&#x6A21;&#x5206;&#x53D1;</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-me-shi-docker&quot;&gt;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;Docke
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-sf" scheme="https://1x481n.github.io/blog.lab99.org/tags/dockercon15-sf/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线交流会 13 - 介绍 Machine, Swarm, Compose</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-21-video-docker-online-meetup-13-introducing-machine-swarm-compose.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-21-video-docker-online-meetup-13-introducing-machine-swarm-compose.html</id>
    <published>2016-06-19T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.615Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#docker-machine">Docker Machine</a></li><li><a href="#docker-compose">Docker Compose</a></li><li><a href="#docker-swarm">Docker Swarm</a></li><li><a href="#yan-shi">&#x6F14;&#x793A;</a></li></ul><!-- tocstop --><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/H-fwxUeFZdQ" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=H-fwxUeFZdQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=H-fwxUeFZdQ</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=l03144vdr1m&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/page/l/1/m/l03144vdr1m.html" target="_blank" rel="noopener">http://v.qq.com/page/l/1/m/l03144vdr1m.html</a></p><h1 id="docker-machine"><a href="#Docker-Machine" class="headerlink" title="Docker Machine"></a>Docker Machine <a href="#docker-machine" class="header-anchor">#</a></h1><ul><li><code>docker-machine create -d virtualbox dev</code> &#x2192; &#x521B;&#x5EFA; virtualbox &#x865A;&#x62DF;&#x673A;&#x7684; docker host &#xFF0C;&#x547D;&#x540D;&#x4E3A; <code>dev</code></li><li><code>docker-machine ls</code> &#x2192; &#x5217;&#x51FA;&#x6240;&#x6709; docker-machine &#x5EFA;&#x7ACB;&#x7684;&#x4E3B;&#x673A;</li><li><code>eval $(docker-machine env dev)</code> &#x2192; &#x5F53;&#x524D;&#x73AF;&#x5883;&#x6362;&#x5230;&#x6307;&#x5B9A;&#x7684; docker host</li><li><code>docker ps</code> &#x2192; &#x8FD9;&#x6837;&#x5217;&#x51FA;&#x7684;&#x662F; <code>dev</code> &#x8FD9;&#x4E2A;&#x4E3B;&#x673A;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x8FD0;&#x884C;&#x5BB9;&#x5668;</li><li><code>docker-machine ssh dev</code> &#x2192; &#x8FDB;&#x5165;&#x8FD9;&#x4E2A; docker host&#x3002;</li></ul><h1 id="docker-compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose <a href="#docker-compose" class="header-anchor">#</a></h1><p>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x90FD;&#x5199;&#x5165; <code>docker-compose.yml</code></p><ul><li><code>docker-compose up -d</code> &#x2192; &#x6784;&#x5EFA;&#x3001;&#x542F;&#x52A8;&#x8FD9;&#x7EC4;&#x5BB9;&#x5668;</li><li><code>docker-compose ps</code> &#x2192; &#x5217;&#x51FA;&#x9879;&#x76EE;&#x5185;&#x7684;&#x5BB9;&#x5668;</li><li><code>docker-compose kill</code> &#x2192; &#x5220;&#x6389;&#x5BB9;&#x5668;</li><li><code>docker-compose run web python test.py</code> &#x2192; &#x6307;&#x5B9A;&#x8FD0;&#x884C;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x7684;&#x4E0D;&#x540C;&#x547D;&#x4EE4;&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x662F;&#x6D4B;&#x8BD5;&#x3002;</li></ul><h1 id="docker-swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm <a href="#docker-swarm" class="header-anchor">#</a></h1><p>docker swarm &#x662F; Docker host &#x96C6;&#x7FA4;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x7FA4;hosts&#x53D8;&#x6210;&#x4E00;&#x4E2A;docker host&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x90E8;&#x7F72;&#x3002;</p><h1 id="yan-shi"><a href="#&#x6F14;&#x793A;" class="headerlink" title="&#x6F14;&#x793A;"></a>&#x6F14;&#x793A; <a href="#yan-shi" class="header-anchor">#</a></h1><p><code>docker run swarm create</code><br>&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;swarm id</p><p>&#x521B;&#x5EFA; swarm-master</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d digitalocean \</span><br><span class="line">    --swarm --swarm-master \</span><br><span class="line">    --swarm-discovery=token://xxxxx \</span><br><span class="line">    swarm-master</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;swarm&#x8282;&#x70B9;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d digitalocean \</span><br><span class="line">    --swarm \</span><br><span class="line">    --swarm-discovery=token://xxxxx \</span><br><span class="line">    swarm-01</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x628A;&#x73AF;&#x5883;&#x6362;&#x5230; swarm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> $(docker-machine env &#x2014;swarm swarm-master)</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837; <code>docker info</code>, <code>docker ps</code>, <code>docker run</code> &#x4E4B;&#x7C7B;&#x7684;&#x5C31;&#x662F;&#x76F4;&#x63A5;&#x5728;docker swarm&#x96C6;&#x7FA4;&#x4E0A;&#x8FD0;&#x884C;&#x4E86;&#x3002;</p><p>&#x800C;&#x4E14;&#x7531;&#x4E8E; <code>docker-compose</code> &#x4F7F;&#x7528;&#x7684;&#x662F;docker&#x6807;&#x51C6;API&#xFF0C;&#x6240;&#x4EE5;<code>docker-compose</code>&#x4F1A;&#x76F4;&#x63A5;&#x5728;swarm&#x4E0A;&#x6267;&#x884C;</p><p>&#x800C;&#x4E14;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker-compose scale worker=5</code> &#x6765;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#docker-machine&quot;&gt;Docker Machine&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a h
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="https://1x481n.github.io/blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：使用 Node.js 和 Docker 构建微服务 - 第1讲 - Raziel Tabib</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-1.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-1.html</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.615Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#bu-zou">&#x6B65;&#x9AA4;</a></li><li><a href="#chuang-jian-ji-chu-jing-xiang">&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;</a></li><li><a href="#chuang-jian-express-js-wei-fu-wu">&#x521B;&#x5EFA; Express.js &#x5FAE;&#x670D;&#x52A1;</a></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Building a Microservice using Node.js and Docker #1<br>by Raziel Tabib<br>2015-07-15</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/PJ95WY2DqXo" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=PJ95WY2DqXo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=PJ95WY2DqXo</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=x031573jtih&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/page/o/8/j/x031573jtih.html" target="_blank" rel="noopener">http://v.qq.com/page/o/8/j/x031573jtih.html</a></p><h1 id="bu-zou"><a href="#&#x6B65;&#x9AA4;" class="headerlink" title="&#x6B65;&#x9AA4;"></a>&#x6B65;&#x9AA4; <a href="#bu-zou" class="header-anchor">#</a></h1><ol><li>&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;&#xFF1A; Ubuntu + Node.js</li><li>&#x521B;&#x5EFA;&#x5FAE;&#x670D;&#x52A1;&#x955C;&#x50CF;&#xFF1A; Base Image + Service</li></ol><p>(<strong>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x5E74;&#x591A;&#x524D;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x5236;&#x4F5C;&#x529E;&#x6CD5;&#xFF0C;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x73B0;&#x5728;&#x90FD;&#x7528; Dockerfile&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x6A21;&#x4EFF;</strong>)</p><h1 id="chuang-jian-ji-chu-jing-xiang"><a href="#&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;" class="headerlink" title="&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;"></a>&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF; <a href="#chuang-jian-ji-chu-jing-xiang" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x5565;&#x672C;&#x5730;&#x955C;&#x50CF;</span></span><br><span class="line">$ docker images</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5230; Docker Hub &#x4E0A;&#x641C;&#x7D22; Ubuntu image</span></span><br><span class="line">$ docker search ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x5F88;&#x591A;&#xFF0C;&#x9650;&#x5B9A;&#x4E00;&#x4E0B;&#x53EA;&#x8981; 1000 &#x661F;&#x4EE5;&#x4E0A;&#x7684;</span></span><br><span class="line">$ docker search -s 1000 ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x627E;&#x5230;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;</span></span><br><span class="line">$ docker run -it ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x6CA1;&#x5565;&#x95EE;&#x9898;&#xFF0C;&#x8BD5;&#x8BD5;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;ubuntu &#x6301;&#x7EED;15&#x79D2;</span></span><br><span class="line">$ docker run -d --name=my-container ubuntu sleep 15</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Ubuntu &#x7684;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#xFF0C;&#x8FDB;&#x53BB;&#x5B89;&#x88C5;&#x597D; node.js &#x7136;&#x540E;commit</span></span><br><span class="line">$ docker commit -a razielt 22d ubuntu-node:1.0</span><br></pre></td></tr></table></figure><h1 id="chuang-jian-express-js-wei-fu-wu"><a href="#&#x521B;&#x5EFA;-Express-js-&#x5FAE;&#x670D;&#x52A1;" class="headerlink" title="&#x521B;&#x5EFA; Express.js &#x5FAE;&#x670D;&#x52A1;"></a>&#x521B;&#x5EFA; Express.js &#x5FAE;&#x670D;&#x52A1; <a href="#chuang-jian-express-js-wei-fu-wu" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5B89;&#x88C5; express &#x751F;&#x6210;&#x5668;</span></span><br><span class="line">$ npm i -g express-generator</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x751F;&#x6210; express.js &#x5E94;&#x7528;&#x6A21;&#x677F;</span></span><br><span class="line">$ express my_microservice</span><br></pre></td></tr></table></figure><p>&#x7F16;&#x8F91; <code>routes/api.js</code> &#x6765;&#x5EFA;&#x7ACB;&#x6700;&#x7B80;&#x5355;&#x7684; API</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x5377;&#x7ED1;&#x5B9A;&#x6765;&#x96C6;&#x6210;&#x8FD9;&#x4E2A; express &#x5E94;&#x7528;</span></span><br><span class="line">$ docker run -it -v $(<span class="built_in">pwd</span>):/host -p 9000:3000 ubuntu-node:0.1 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7136;&#x540E;&#x5C06;&#x5F53;&#x524D;&#x4EE3;&#x7801;&#x590D;&#x5236;&#x5230;&#x5BF9;&#x5E94;&#x76EE;&#x5F55;&#xFF0C;commit &#x4E00;&#x4E2A;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;</span></span><br><span class="line">$ docker commit -a razielt b4e node-microservice:0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FD0;&#x884C;&#x8BE5;&#x955C;&#x50CF;</span></span><br><span class="line">$ docker run -d -w /microservice -p 9000:3000 node-microservice:0.1 npm start</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7136;&#x540E;&#x9644;&#x7740;&#x5230;&#x8FD9;&#x4E2A;docker&#x8FDB;&#x7A0B;&#x4E0A;&#x89C2;&#x770B;&#x8F93;&#x51FA;</span></span><br><span class="line">$ docker attach 3d61</span><br></pre></td></tr></table></figure><p>&#x955C;&#x50CF;&#x5236;&#x4F5C;&#x597D;&#x540E;&#x53EF;&#x4EE5;&#x63A8;&#x9001;&#x5230; Docker Hub &#x4E0A;&#x3002;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x767B;&#x5F55; Docker Hub</span></span><br><span class="line">$ docker login</span><br><span class="line">$ docker tag node-microservice:0.1 node-microservice:latest</span><br><span class="line">$ docker tag node-microservice razielt/node_microservice</span><br><span class="line">$ docker push</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x955C;&#x50CF;&#x5C31;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x90E8;&#x7F72;&#x4E86;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="node.js" scheme="https://1x481n.github.io/blog.lab99.org/tags/node-js/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：使用 Node.js 和 Docker 构建微服务 - 第2讲 - Raziel Tabib</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-2.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-2.html</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.615Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#gou-jian-dockerfile">&#x6784;&#x5EFA; <code>Dockerfile</code></a><ul><li><a href="#mo-ren-ming-wei-dockerfile">&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A; <code>Dockerfile</code></a></li><li><a href="#gou-jian">&#x6784;&#x5EFA;</a></li><li><a href="#gou-jian-huan-cun-ji-zhi">&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236;</a></li><li><a href="#dockerfile-ying-dang-jin-ru-ban-ben-kong-zhi-de-repo-li">Dockerfile &#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684; repo &#x91CC;</a></li><li><a href="#huan-cun-ji-zhi-dui-npm-install-de-ying-xiang">&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9; <code>npm install</code> &#x7684;&#x5F71;&#x54CD;</a></li><li><a href="#chuang-jian-digital-ocean-de-docker-zhu-ji">&#x521B;&#x5EFA; Digital Ocean &#x7684; Docker &#x4E3B;&#x673A;</a></li><li><a href="#jiang-jing-xiang-fang-dao-zhu-ji-shang">&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A;</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Building a Microservice using Node.js and Docker #2<br>by Raziel Tabib<br>2015-08-15</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/lss2rZ3Ppuk" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=lss2rZ3Ppuk" target="_blank" rel="noopener">https://www.youtube.com/watch?v=lss2rZ3Ppuk</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0315jimm4y&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/page/o/8/j/b0315jimm4y.html" target="_blank" rel="noopener">http://v.qq.com/page/o/8/j/b0315jimm4y.html</a></p><ul><li><code>Dockerfile</code></li><li><code>Images</code></li><li><code>Container</code></li><li><code>Daemon</code></li><li><code>Client</code></li><li><code>Hub</code></li></ul><h1 id="gou-jian-dockerfile"><a href="#&#x6784;&#x5EFA;-Dockerfile" class="headerlink" title="&#x6784;&#x5EFA; Dockerfile"></a>&#x6784;&#x5EFA; <code>Dockerfile</code> <a href="#gou-jian-dockerfile" class="header-anchor">#</a></h1><h2 id="mo-ren-ming-wei-dockerfile"><a href="#&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A;-Dockerfile" class="headerlink" title="&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A; Dockerfile"></a>&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A; <code>Dockerfile</code> <a href="#mo-ren-ming-wei-dockerfile" class="header-anchor">#</a></h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:latest</span><br><span class="line"><span class="keyword">MAINTAINER</span> &#x59D3;&#x540D; &lt;&#x90AE;&#x4EF6;&#x5730;&#x5740;&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ...</span></span><br></pre></td></tr></table></figure><h2 id="gou-jian"><a href="#&#x6784;&#x5EFA;" class="headerlink" title="&#x6784;&#x5EFA;"></a>&#x6784;&#x5EFA; <a href="#gou-jian" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t nodejs:0.1 .</span><br></pre></td></tr></table></figure><p>&#x6CE8;&#x610F;&#x6700;&#x540E;&#x7684; <code>.</code>&#xFF0C;&#x8FD9;&#x662F;&#x4E0A;&#x4E0B;&#x6587;(context)&#x7684;&#x610F;&#x601D;&#xFF0C;&#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x7684;&#x662F;&#x6784;&#x5EFA;&#x6240;&#x9700;&#x7684;&#x6700;&#x5C0F;&#x5185;&#x5BB9;&#x3002;</p><h2 id="gou-jian-huan-cun-ji-zhi"><a href="#&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236;" class="headerlink" title="&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236;"></a>&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236; <a href="#gou-jian-huan-cun-ji-zhi" class="header-anchor">#</a></h2><ul><li>&#x5982;&#x679C;&#x5B58;&#x5728;&#x8BE5;&#x5C42;&#xFF0C;&#x5219;&#x7528;&#x7F13;&#x5B58;&#xFF0C;&#x6CA1;&#x6709;&#x5C31; rebuild</li><li>&#x5982;&#x679C;&#x67D0;&#x4E00;&#x5C42;&#x9700;&#x8981; rebuild&#xFF0C;&#x5176;&#x540E;&#x7684;&#x6240;&#x6709;&#x5C42;&#x90FD;&#x9700;&#x8981; rebuild</li><li><code>COPY</code>/<code>ADD</code> &#x4F1A;&#x68C0;&#x67E5;&#x5BF9;&#x5E94;&#x6587;&#x4EF6;&#x7684;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x6539;&#x53D8;&#xFF0C;&#x6821;&#x9A8C;&#x503C;&#x5373;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x6539;&#x53D8;&#x5C31;&#x4F1A; rebuild</li><li>&#x5176;&#x5B83;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x770B;&#x547D;&#x4EE4;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x800C;&#x4E0D;&#x53BB;&#x67E5;&#x770B;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x53D8;&#x5316;&#x3002;&#xFF08;<strong>&#x8FD9;&#x70B9;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x6BD4;&#x5982; apt-get update&#xFF0C;&#x5176;&#x5B9E;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x56E0;&#x4E3A;&#x5176;&#x547D;&#x4EE4;&#x6CA1;&#x53D8;&#x5316;&#xFF0C;&#x5C31;&#x4E0D;&#x518D; rebuild &#x4E86;</strong>&#xFF09;</li></ul><h2 id="dockerfile-ying-dang-jin-ru-ban-ben-kong-zhi-de-repo-li"><a href="#Dockerfile-&#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684;-repo-&#x91CC;" class="headerlink" title="Dockerfile &#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684; repo &#x91CC;"></a>Dockerfile &#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684; repo &#x91CC; <a href="#dockerfile-ying-dang-jin-ru-ban-ben-kong-zhi-de-repo-li" class="header-anchor">#</a></h2><p>&#x8FD9;&#x6837;&#x955C;&#x50CF;&#x5BF9;&#x5E94;&#x7684;Dockerfile&#x4E5F;&#x4F1A;&#x5728;&#x7248;&#x672C;&#x63A7;&#x5236;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x67E5;&#x770B;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x53D8;&#x52A8;&#x60C5;&#x51B5;&#xFF0C;&#x4EE5;&#x53CA;&#x4FEE;&#x6B63;&#x539F;&#x56E0;&#x3002;</p><h2 id="huan-cun-ji-zhi-dui-npm-install-de-ying-xiang"><a href="#&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9;-npm-install-&#x7684;&#x5F71;&#x54CD;" class="headerlink" title="&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9; npm install &#x7684;&#x5F71;&#x54CD;"></a>&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9; <code>npm install</code> &#x7684;&#x5F71;&#x54CD; <a href="#huan-cun-ji-zhi-dui-npm-install-de-ying-xiang" class="header-anchor">#</a></h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> . /src/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x50CF;&#x8FD9;&#x6837;&#xFF0C;&#x5C06; <code>COPY</code> &#x7F6E;&#x4E8E; <code>RUN</code> &#x4E4B;&#x524D;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#xFF0C;&#x6BCF;&#x4E00;&#x6B21;&#x4EE3;&#x7801;&#x7684;&#x53D8;&#x52A8;&#xFF0C;&#x90FD;&#x4F1A;&#x89E6;&#x53D1; <code>npm install</code> &#x8FD9;&#x4E00;&#x5C42;&#x7684; rebuild&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x3002;&#x56E0;&#x6B64;&#x6548;&#x7387;&#x5F88;&#x5DEE;&#x3002;</p><p>&#x6240;&#x4EE5;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> ./package.json /src/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /src/</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6837;&#x5206;&#x4E3A;3&#x5C42;&#xFF0C;&#x53EA;&#x6709; <code>package.json</code> &#x53D8;&#x5316;&#xFF0C;&#x624D;&#x4F1A;&#x89E6;&#x53D1; <code>npm install</code>&#xFF0C;&#x800C; <code>/src</code> &#x4E2D;&#x7684;&#x5176;&#x5B83;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x5219;&#x53EA;&#x4F1A;&#x89E6;&#x53D1;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x3002;</p><h2 id="chuang-jian-digital-ocean-de-docker-zhu-ji"><a href="#&#x521B;&#x5EFA;-Digital-Ocean-&#x7684;-Docker-&#x4E3B;&#x673A;" class="headerlink" title="&#x521B;&#x5EFA; Digital Ocean &#x7684; Docker &#x4E3B;&#x673A;"></a>&#x521B;&#x5EFA; Digital Ocean &#x7684; Docker &#x4E3B;&#x673A; <a href="#chuang-jian-digital-ocean-de-docker-zhu-ji" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528; <code>docker-machine</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d digitalocean server</span><br></pre></td></tr></table></figure><h2 id="jiang-jing-xiang-fang-dao-zhu-ji-shang"><a href="#&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A;" class="headerlink" title="&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A;"></a>&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A; <a href="#jiang-jing-xiang-fang-dao-zhu-ji-shang" class="header-anchor">#</a></h2><p><strong>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>save</code>/<code>load</code>&#xFF0C;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x5E94;&#x8BE5;&#x662F; <code>push</code> &#x5230; registry &#x4E0A;&#x3002;</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5148;&#x4FDD;&#x5B58;&#x955C;&#x50CF;</span></span><br><span class="line">$ docker save -o &#x6587;&#x4EF6;&#x540D; &#x955C;&#x50CF;&#x540D;:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528; Digital Ocean &#x7684; Docker &#x73AF;&#x5883;</span></span><br><span class="line">$ <span class="built_in">eval</span> $(docker-mahine env server)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x52A0;&#x8F7D;&#x8BE5;&#x955C;&#x50CF;</span></span><br><span class="line">$ docker load -i &#x955C;&#x50CF;&#x6587;&#x4EF6;&#x540D;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="node.js" scheme="https://1x481n.github.io/blog.lab99.org/tags/node-js/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线交流会 39 - Docker 安全 - Nathan McCauley</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-19-video-docker-online-meetup-39-docker-security.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-19-video-docker-online-meetup-39-docker-security.html</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.615Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li><li><a href="#an-quan-sao-miao">&#x5B89;&#x5168;&#x626B;&#x63CF;</a></li><li><a href="#an-quan-ping-tai-nei-rong-fang-wen-kong-zhi">&#x5B89;&#x5168;&#x5E73;&#x53F0; + &#x5185;&#x5BB9; + &#x8BBF;&#x95EE;&#x63A7;&#x5236;</a><ul><li><a href="#docker-bench">Docker Bench</a></li><li><a href="#docker-security">Docker Security</a></li><li><a href="#secure-content">Secure Content</a></li></ul></li></ul><!-- tocstop --><h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup - 39 - Docker Security<br>by Nathan McCauley, Director Security<br>2016-05-26</p><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/Zotjwkg9gq8" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=Zotjwkg9gq8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=Zotjwkg9gq8</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=p03145sky9y&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/page/o/8/j/p03145sky9y.html" target="_blank" rel="noopener">http://v.qq.com/page/o/8/j/p03145sky9y.html</a></p><h1 id="an-quan-sao-miao"><a href="#&#x5B89;&#x5168;&#x626B;&#x63CF;" class="headerlink" title="&#x5B89;&#x5168;&#x626B;&#x63CF;"></a>&#x5B89;&#x5168;&#x626B;&#x63CF; <a href="#an-quan-sao-miao" class="header-anchor">#</a></h1><p>&#x8FC7;&#x53BB; 6 &#x4E2A;&#x6708;&#x4E2D;&#xFF0C;&#x6709; 400M &#x4E2A;pull</p><h1 id="an-quan-ping-tai-nei-rong-fang-wen-kong-zhi"><a href="#&#x5B89;&#x5168;&#x5E73;&#x53F0;-&#x5185;&#x5BB9;-&#x8BBF;&#x95EE;&#x63A7;&#x5236;" class="headerlink" title="&#x5B89;&#x5168;&#x5E73;&#x53F0; + &#x5185;&#x5BB9; + &#x8BBF;&#x95EE;&#x63A7;&#x5236;"></a>&#x5B89;&#x5168;&#x5E73;&#x53F0; + &#x5185;&#x5BB9; + &#x8BBF;&#x95EE;&#x63A7;&#x5236; <a href="#an-quan-ping-tai-nei-rong-fang-wen-kong-zhi" class="header-anchor">#</a></h1><p>&#x9ED8;&#x8BA4;&#x5B89;&#x5168;</p><ol><li>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x8981;&#x4FDD;&#x8BC1;&#x5B89;&#x5168;</li><li>&#x7EC6;&#x7C92;&#x5EA6;&#x63A7;&#x5236;</li></ol><h2 id="docker-bench"><a href="#Docker-Bench" class="headerlink" title="Docker Bench"></a>Docker Bench <a href="#docker-bench" class="header-anchor">#</a></h2><p>&#x786E;&#x4FDD;&#x5B89;&#x5168;&#x7684;&#x4E3B;&#x673A;&#x914D;&#x7F6E;</p><h2 id="docker-security"><a href="#Docker-Security" class="headerlink" title="Docker Security"></a>Docker Security <a href="#docker-security" class="header-anchor">#</a></h2><p>&#x68C0;&#x67E5;&#x6D89;&#x53CA; CVE &#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5B89;&#x5168;&#x6027;</p><h2 id="secure-content"><a href="#Secure-Content" class="headerlink" title="Secure Content"></a>Secure Content <a href="#secure-content" class="header-anchor">#</a></h2><p>&#x5185;&#x5BB9;&#x7B7E;&#x540D; + &#x5B89;&#x5168;&#x626B;&#x63CF;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="https://1x481n.github.io/blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 特性及其相关工具 - Tom Verelst</title>
    <link href="https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-17-video-docker-features-and-tools-by-tom-verelst.html"/>
    <id>https://1x481n.github.io/blog.lab99.org/post/docker-2016-06-17-video-docker-features-and-tools-by-tom-verelst.html</id>
    <published>2016-06-16T16:00:00.000Z</published>
    <updated>2020-10-26T19:10:47.614Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/blog.lab99.org/style/owl.css"><!-- toc --><ul><li><a href="#ji-ben-jie-shao">&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><li><a href="#dockerfile-docker-build-images-run"><code>Dockerfile</code>, <code>docker build</code>, <code>images</code>, <code>run</code></a></li><li><a href="#docker-li-shi">Docker &#x5386;&#x53F2;</a><ul><li><a href="#2007-nian-linux-fa-bu-nei-he-2-6-24">2007&#x5E74; Linux &#x53D1;&#x5E03;&#x5185;&#x6838; <code>2.6.24</code></a></li><li><a href="#2013-nian-2-yue-linux-fa-bu-liao-nei-he-3-8">2013&#x5E74;2&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.8</code></a></li><li><a href="#2014-nian-8-yue-linux-fa-bu-liao-nei-he-3-16">2014&#x5E74;8&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.16</code></a></li><li><a href="#2014-nian-12-yue-linux-fa-bu-liao-nei-he-3-18">2014&#x5E74;12&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.18</code></a></li><li><a href="#2015-nian-4-yue-linux-fa-bu-liao-nei-he-4-0">2015&#x5E74;4&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.0</code></a></li><li><a href="#2016-nian-linux-fa-bu-liao-nei-he-4-5">2016&#x5E74; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.5</code></a></li></ul></li><li><a href="#shi-yong-docker-de-hao-chu">&#x4F7F;&#x7528; Docker &#x7684;&#x597D;&#x5904;</a><ul><li><a href="#chi-xu-ji-cheng-continuous-integration">&#x6301;&#x7EED;&#x96C6;&#x6210;(Continuous Integration)</a></li><li><a href="#bian-pai-orchestration-gong-ju">&#x7F16;&#x6392;(Orchestration)&#x5DE5;&#x5177;</a><ul><li><a href="#compose">Compose</a></li><li><a href="#machine">Machine</a></li><li><a href="#swarm">Swarm</a></li><li><a href="#networking">Networking</a></li></ul></li><li><a href="#qi-ta-gong-ju">&#x5176;&#x5B83;&#x5DE5;&#x5177;</a><ul><li><a href="#docker-cloud-cloud-docker-com">Docker Cloud (cloud.docker.com)</a></li><li><a href="#kubernetes">Kubernetes</a></li><li><a href="#coreos">CoreOS</a></li><li><a href="#lattice">Lattice</a></li><li><a href="#flocker">Flocker</a></li></ul></li></ul></li><li><a href="#docker-security">Docker Security</a><ul><li><a href="#container-security">Container Security</a></li><li><a href="#node-security">Node Security</a></li></ul></li></ul><!-- tocstop --><div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/heBI7oQvHZU" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p><a href="https://www.youtube.com/watch?v=heBI7oQvHZU" target="_blank" rel="noopener">https://www.youtube.com/watch?v=heBI7oQvHZU</a></p><div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=o03134mlm8j&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div><p><a href="http://v.qq.com/page/o/8/j/o03134mlm8j.html" target="_blank" rel="noopener">http://v.qq.com/page/o/8/j/o03134mlm8j.html</a></p><h1 id="ji-ben-jie-shao"><a href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"></a>&#x57FA;&#x672C;&#x4ECB;&#x7ECD; <a href="#ji-ben-jie-shao" class="header-anchor">#</a></h1><p>Docker &#x5F88;&#x50CF;(<strong>&#x4F46;&#x4E0D;&#x662F;</strong>)&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x7684;shell, namespace, network interface&#xFF0C;&#x53EF;&#x4EE5;&#x4EE5;root&#x8FD0;&#x884C;&#x4E1C;&#x897F;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x670D;&#x52A1;&#x548C;&#x8F6F;&#x4EF6;&#x5305;</p><p>&#x865A;&#x62DF;&#x673A;&#x6709;&#x865A;&#x62DF;&#x786C;&#x4EF6;&#x5C42;&#x548C;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x5176;&#x4E0A;&#x7684;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#x3002;&#x800C;&#x5BB9;&#x5668;&#x5219;&#x662F;&#x76F4;&#x63A5;&#x5C06;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x4E8E;&#x73B0;&#x6709;&#x5185;&#x6838;&#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x542F;&#x52A8;Docker&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x542F;&#x52A8;&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x3002;</p><p>Docker&#x7EC4;&#x6210;&#x90E8;&#x5206;&#xFF0C;&#x7B80;&#x5355;&#x6765;&#x770B;&#xFF0C;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x89D2;&#x8272;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x3001;docker &#x4E3B;&#x673A;&#x3001;docker registry&#x3002;<br>&#x5BA2;&#x6237;&#x7AEF;&#x8FD0;&#x884C; <code>docker run</code>, <code>build</code>, <code>pull</code>&#x7B49;&#x547D;&#x4EE4;&#xFF1B;<br><code>docker host</code> &#x5219;&#x6709;&#x4E00;&#x4E2A;<code>docker daemon</code> &#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x7EF4;&#x62A4;&#x7740;&#x672C;&#x5730;&#x7684;container&#x548C;image&#xFF1B;<br><code>docker registry</code>&#x5219;&#x662F;&#x96C6;&#x4E2D;&#x7BA1;&#x7406;&#x6240;&#x6709;image&#x7684;&#x5730;&#x65B9;&#xFF0C;docker host&#x5C06;&#x4ECE;docker registry&#x53D6;&#x5F97;image&#x3002;</p><p>Docker &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5206;&#x5C42;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x57FA;&#x4E8E;Union FS&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5728;Ubuntu&#x4E0A;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>aufs</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x81EA;&#x7136;&#x7684;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x6982;&#x5FF5;&#x3002;&#x800C;&#x5728;CentOS/RHEL&#x4E0A;&#x5219;&#x53EA;&#x80FD;&#x4F7F;&#x7528;DeviceMapper&#x53BB;&#x6A21;&#x62DF;&#xFF0C;&#x6027;&#x80FD;&#x548C;&#x7A33;&#x5B9A;&#x6027;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;&#x5728; Linux 3.18 &#x4EE5;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Overlay FS&#xFF0C;&#x8FD9;&#x4E5F;&#x662F; Union FS &#x7684;&#x5B9E;&#x73B0;&#x3002;</p><p>Docker &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5206;&#x5C42;&#xFF0C;&#x6700;&#x5E95;&#x5C42;&#x662F; bootfs(kernel)&#xFF0C;&#x7136;&#x540E;&#x662F;&#x955C;&#x50CF;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x5C42;&#xFF0C;&#x6700;&#x540E;&#x662F;&#x8FD0;&#x884C;&#x671F;&#x7684;&#x5BB9;&#x5668;&#x7684;&#x5C42;&#x3002;&#x5BB9;&#x5668;&#x7684;&#x5B58;&#x50A8;&#x5C42;&#x5728;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x5373;&#x88AB;&#x5E9F;&#x5F03;&#x3002;</p><p>&#x4E25;&#x683C;&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x540E;&#x5C31;&#x88AB;&#x9500;&#x6BC1;&#x3002;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x5176;&#x5B58;&#x50A8;&#x5C42;&#x4F9D;&#x7136;&#x9644;&#x5C5E;&#x4E8E;&#x505C;&#x6B62;&#x6389;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x5982;&#x679C;&#x5229;&#x7528; docker start &#x5C06;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x5185;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x53D8;&#x52A8;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#x3002;&#x800C;&#x8FD9;&#x79CD;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x88AB;&#x5E9F;&#x5F03;&#x7684;&#x6982;&#x5FF5;&#x5219;&#x662F;&#x6307;&#x53E6;&#x4E00;&#x4E2A;&#x5C42;&#x9762;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p><p><strong>&#x5BB9;&#x5668;&#x5E94;&#x5F53;&#x88AB;&#x89C6;&#x4E3A; immutable &#x7684;</strong>&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x53D8;&#x52A8;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x88AB;&#x629B;&#x5F03;&#xFF0C;&#x4E0D;&#x5E0C;&#x671B;&#x4E22;&#x5931;&#x7684;&#x53D8;&#x5316;&#x90E8;&#x5206;&#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x4E8E;&#x6302;&#x8F7D;&#x7684;&#x6570;&#x636E;&#x5377;&#x4E2D;&#x3002;</p><p>&#x6240;&#x4EE5;docker&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x662F; <code>docker run</code>, <code>stop</code>, <code>rm</code>, &#x518D;&#x6B21;<code>run</code>&#x3002;&#x6BCF;&#x4E00;&#x6B21;<code>run</code>&#x90FD;&#x662F;&#x4ECE;image&#x5EFA;&#x7ACB;&#x7684;&#x65B0;&#x9C9C;&#x7684;container&#xFF0C;&#x6240;&#x4EE5;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x6C38;&#x8FDC;&#x662F;image&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x4E0A;&#x4E00;&#x6B21;container&#x4E2D;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x6240;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x7406;&#x89E3;&#xFF0C;container&#x4E2D;&#x7684;&#x53D8;&#x52A8;&#x88AB;&#x5E9F;&#x5F03;&#x4E86;&#x3002;</p><p>Docker 1.10 &#x53D1;&#x5E03;&#x66F4;&#x65B0;&#x4E86;Layer&#x7684;ID&#x95EE;&#x9898;&#xFF0C;&#x66FE;&#x7ECF;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x968F;&#x673A;UUID&#xFF0C;&#x4F46;&#x662F;&#x53D1;&#x751F;&#x8FC7;&#x51B2;&#x7A81;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x96BE;&#x5224;&#x65AD;&#x76F8;&#x540C;UUID&#x7684;layer&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E2A;&#x3002;&#x6240;&#x4EE5;&#x4ECE;1.10&#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5176;&#x5347;&#x7EA7;&#x4E3A;&#x5BC6;&#x7801;&#x5B66; Hash &#x503C;&#xFF0C;SHA256&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x5176;&#x5185;&#x5BB9;&#x7EDF;&#x4E00;&#xFF0C;&#x800C;&#x4E14;Image&#x5C06;&#x4F1A;&#x66F4;&#x5C0F;&#x3002;&#x5728; 1.10 &#x4EE5;&#x524D;&#xFF0C;Image &#x548C; Layer &#x57FA;&#x672C;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F; 1.10 &#x4E4B;&#x540E;&#xFF0C;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x4E86; SHA256&#xFF0C;Image &#x548C; Layer &#x53EF;&#x4EE5;&#x5206;&#x5F00;&#x590D;&#x7528;&#x91CD;&#x590D;&#x7684;Layer&#xFF0C;&#x8FD9;&#x6837;Image&#x53EF;&#x4EE5;&#x66F4;&#x5C0F;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#x679C;&#x4ECE; 1.10 &#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x8FC7;&#x6765;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x5347;&#x7EA7;&#x6240;&#x6709; images&#x3002;</p><p>Docker &#x5BB9;&#x5668;&#x6587;&#x4EF6;&#x5C42;&#x4F1A;&#x5728;&#x505C;&#x6B62;&#x540E;&#x88AB;&#x5E9F;&#x5F03;&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x4E8E;&#x6302;&#x8F7D;&#x7684;&#x5377;&#x4E2D;&#x3002;&#x800C;&#x6302;&#x8F7D;&#x5377;&#x53EF;&#x4EE5;&#x662F;&#x6570;&#x636E;&#x5377;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x672C;&#x5730;&#x6587;&#x4EF6;&#xFF0C;&#x6CE8;&#x610F;&#x662F;&#x201C;&#x672C;&#x5730;&#x201D;&#xFF0C;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;NFS, SMB&#x4E4B;&#x7C7B;&#x7684;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x6302;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;Docker&#x4F1A;&#x8BA4;&#x4E3A;&#x5176;&#x4E0D;&#x5B89;&#x5168;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x7C7B;&#x4F3C;&#x7684;&#x4E91;&#x5B58;&#x50A8;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;volume&#x7684;driver&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;AWS S3&#x4E4B;&#x7C7B;&#x7684;&#x5B58;&#x50A8;&#x3002;</p><p>docker run &#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49; EXPOSE &#x67D0;&#x4E9B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x7AEF;&#x53E3;&#x662F;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x5916;&#x90E8;&#x8BBF;&#x95EE;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x8FD9;&#x4E9B;&#x7AEF;&#x53E3;&#x66B4;&#x9732;&#x4E8E;&#x5916;&#x90E8;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x7528; -p &#x6216; &#x2013;publish&#xFF0C;&#x5C06;&#x8BE5;&#x7AEF;&#x53E3;&#x53D1;&#x5E03;&#x4E8E;&#x5BBF;&#x4E3B;&#xFF0C;&#x53EF;&#x4EE5;&#x6620;&#x5C04;&#x4E0D;&#x540C;&#x7AEF;&#x53E3;&#x3002;</p><h1 id="dockerfile-docker-build-images-run"><a href="#Dockerfile-docker-build-images-run" class="headerlink" title="Dockerfile, docker build, images, run"></a><code>Dockerfile</code>, <code>docker build</code>, <code>images</code>, <code>run</code> <a href="#dockerfile-docker-build-images-run" class="header-anchor">#</a></h1><p><code>Dockerfile</code> &#x662F;&#x5206;&#x6B65;&#x9AA4;&#x7684;&#xFF0C;&#x800C;&#x6BCF;&#x4E00;&#x6B65;&#x90FD;&#x4F1A;&#x88AB;&#x7F13;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x975E;&#x5E38;&#x5FEB;&#x3002;</p><p><code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x4E0D;&#x540C;&#xFF0C;&#x4E00;&#x822C; <code>ENTRYPOINT</code> &#x662F;&#x8981;&#x8FD0;&#x884C;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x800C; <code>CMD</code> &#x5219;&#x662F;&#x53C2;&#x6570;&#xFF0C;<code>docker run</code> &#x540E;&#x9762;&#x6240;&#x8DDF;&#x968F;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x662F; <code>CMD</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53C2;&#x6570;&#x3002;&#x6709;&#x4E9B;&#x955C;&#x50CF;&#x628A; <code>ENTRYPOINT</code> &#x8BBE;&#x4E3A;&#x4E86; <code>sh -c</code>&#xFF0C;&#x8FD9;&#x6837; <code>CMD</code> &#x53EF;&#x4EE5;&#x8DDF; bash &#x547D;&#x4EE4;&#x548C;&#x811A;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E9B;&#x4EBA;&#x8BEF;&#x4EE5;&#x4E3A; <code>CMD</code> &#x5C31;&#x662F;&#x547D;&#x4EE4;&#x3002;&#x5176;&#x5B9E;&#x5B83;&#x4EEC;&#x53EA;&#x662F;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x9001;&#x7ED9;&#x4E86; <code>ENTRYPOINT</code> &#x4E2D;&#x6307;&#x5B9A;&#x7684; <code>sh -c</code>&#x3002;</p><p>&#x57FA;&#x672C;&#x547D;&#x4EE4;&#xFF1A;<code>build</code>, <code>run</code>, <code>stop</code>, <code>start</code>, <code>ps</code>, <code>ps -a</code>, <code>images</code>, <code>rmi</code><br>&#x5C06;&#x955C;&#x50CF;<code>push</code>&#x5230;registry&#xFF0C;<code>docker login</code>, <code>docker push</code></p><h1 id="docker-li-shi"><a href="#Docker-&#x5386;&#x53F2;" class="headerlink" title="Docker &#x5386;&#x53F2;"></a>Docker &#x5386;&#x53F2; <a href="#docker-li-shi" class="header-anchor">#</a></h1><p>Docker &#x7684;&#x5386;&#x53F2;&#x662F;&#x548C; Linux &#x5185;&#x6838;&#x53D1;&#x5E03;&#x5386;&#x53F2;&#x7D27;&#x5BC6;&#x76F8;&#x5173;&#x7684;&#x3002;</p><h2 id="2007-nian-linux-fa-bu-nei-he-2-6-24"><a href="#2007&#x5E74;-Linux-&#x53D1;&#x5E03;&#x5185;&#x6838;-2-6-24" class="headerlink" title="2007&#x5E74; Linux &#x53D1;&#x5E03;&#x5185;&#x6838; 2.6.24"></a>2007&#x5E74; Linux &#x53D1;&#x5E03;&#x5185;&#x6838; <code>2.6.24</code> <a href="#2007-nian-linux-fa-bu-nei-he-2-6-24" class="header-anchor">#</a></h2><p>&#x6709;&#x4E2A;&#x7279;&#x6027;&#x88AB;&#x6DFB;&#x52A0;&#x8FDB;&#x6765;&#xFF0C;Control Groups(<code>cgroups</code>)&#x3002;&#x968F;&#x540E;&#xFF0C;&#x4F7F;&#x7528; <code>cgroups</code> &#x7684; Linux Containers (<code>lxc</code>) &#x53D1;&#x5E03;&#x3002;<code>cgroups</code> &#x662F;&#x4ECA;&#x5929; Docker &#x7684;&#x57FA;&#x7840;&#x3002;</p><p><code>cgroups</code> &#xFF0C;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#xFF0C;&#x8BBE;&#x7F6E;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x4F1A;&#x8BA1;&#xFF0C;&#x63A7;&#x5236;&#x3002;</p><p>&#x8DDD;&#x6F14;&#x8BB2;&#x8005;&#x8BF4;&#xFF0C;Linux &#x4E2D;&#x7684; <code>nice</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x4F7F;&#x7528; <code>cgroups</code> &#x4E2D;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#x3002;<br><a href="https://en.wikipedia.org/wiki/Nice_(Unix)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Nice_(Unix)</a><br>&#x4E0D;&#x8FC7;&#x5E94;&#x8BE5;&#x4E0D;&#x662F;&#x3002;</p><p>&#x63A7;&#x5236;&#x7684;&#x90E8;&#x5206;&#x5305;&#x62EC;<code>freeze</code>&#x548C;<code>restart</code>&#x3002;</p><p>(<em>&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5BB9;&#x6F14;&#x8BB2;&#x8005;&#x8BB2;&#x7684;&#x6709;&#x4E9B;&#x9519;&#x8BEF;&#xFF0C;&#x6211;&#x67E5;&#x8BE2;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x8FDB;&#x884C;&#x4FEE;&#x6B63;&#x3002;</em>&#xFF09;</p><h2 id="2013-nian-2-yue-linux-fa-bu-liao-nei-he-3-8"><a href="#2013&#x5E74;2&#x6708;-Linux-&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-3-8" class="headerlink" title="2013&#x5E74;2&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 3.8"></a>2013&#x5E74;2&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.8</code> <a href="#2013-nian-2-yue-linux-fa-bu-liao-nei-he-3-8" class="header-anchor">#</a></h2><p><a href="http://kernelnewbies.org/Linux_3.8#head-fc2604c967c200a26f336942caee2440a2a4099c" target="_blank" rel="noopener">http://kernelnewbies.org/Linux_3.8#head-fc2604c967c200a26f336942caee2440a2a4099c</a></p><p>&#x8FD9;&#x6B21;&#x5B8C;&#x6574;&#x7684;&#x5B9E;&#x73B0;&#x4E86; namespace &#x7684;&#x9694;&#x79BB;&#xFF0C;&#x5305;&#x62EC;&#x4E86; pid, network, hostname, mount pic, user &#x7684;namespace&#x3002;</p><p>&#x6B63;&#x662F;&#x8FD9;&#x6B21;&#x53D1;&#x5E03;&#x6784;&#x6210;&#x4E86;Docker&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x540C;&#x5E74;3&#x6708;&#x4EFD; Docker &#x9879;&#x76EE;&#x6B63;&#x5F0F;&#x6210;&#x4E3A;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x3002;&#x6700;&#x5F00;&#x59CB;&#x57FA;&#x4E8E; <code>lxc</code>&#xFF0C;&#x73B0;&#x5728;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x4E86; <code>libcontainer</code>&#xFF0C;&#x7EDF;&#x4E00;&#x63A5;&#x53E3;&#xFF0C;&#x4E0B;&#x9762;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x79CD;&#x5BB9;&#x5668;&#x7EC4;&#x5408;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>runC</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x6362;&#x3002;</p><h2 id="2014-nian-8-yue-linux-fa-bu-liao-nei-he-3-16"><a href="#2014&#x5E74;8&#x6708;-Linux-&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-3-16" class="headerlink" title="2014&#x5E74;8&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 3.16"></a>2014&#x5E74;8&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.16</code> <a href="#2014-nian-8-yue-linux-fa-bu-liao-nei-he-3-16" class="header-anchor">#</a></h2><p>&#x5BF9; <code>cgroups</code> &#x8FDB;&#x884C;&#x4E86;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x3002; <a href="http://lwn.net/Articles/601840/" target="_blank" rel="noopener">http://lwn.net/Articles/601840/</a></p><p>Docker Networking &#x4E2D;&#x7684; <code>overlay network</code> &#x6240;&#x4F9D;&#x8D56;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x6B21;&#x5185;&#x6838;&#x7684;&#x6539;&#x8FDB;&#x3002;</p><h2 id="2014-nian-12-yue-linux-fa-bu-liao-nei-he-3-18"><a href="#2014&#x5E74;12&#x6708;-Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-3-18" class="headerlink" title="2014&#x5E74;12&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 3.18"></a>2014&#x5E74;12&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.18</code> <a href="#2014-nian-12-yue-linux-fa-bu-liao-nei-he-3-18" class="header-anchor">#</a></h2><p>&#x7ECF;&#x8FC7;&#x591A;&#x5E74;&#x7684;&#x52AA;&#x529B;&#xFF0C;&#x8FD9;&#x6B21;&#x7EC8;&#x4E8E;&#x7B2C;&#x4E00;&#x6B21;&#x5728;&#x5185;&#x6838;&#x4E2D;&#x52A0;&#x5165;&#x4E86; Union FS&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x6B21;&#x662F; <code>Overlay fs</code>&#x3002;&#xFF08;Ubuntu&#x4E2D;&#x7684;<code>aufs</code>&#x4E89;&#x53D6;&#x4E86;&#x597D;&#x591A;&#x5E74;&#xFF0C;&#x6700;&#x540E;&#x4F5C;&#x8005;&#x61D2;&#x5F97;&#x4E89;&#x53D6;&#x4E86;&#xFF0C;&#x653E;&#x5F03;&#x4E86;&#xFF09;&#x3002;&#x8FD9;&#x6837;&#x5BF9;&#x4E8E;&#x7EA2;&#x5E3D;&#x7CFB;&#x5C06;&#x6765;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E5F;&#x5C31;&#x7EC8;&#x4E8E;&#x6709;&#x53EF;&#x80FD;&#x6709;Union FS&#x53EF;&#x7528;&#x4E86;&#x3002;&#x4EE5;&#x524D;&#x53EA;&#x80FD;&#x51D1;&#x5408;&#x7528; Device Mapper&#xFF0C;&#x800C;&#x4E14;&#x672C;&#x5730;loop&#x8FD8;&#x662F;&#x4E0D;&#x9002;&#x5408;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x4F7F;&#x7528; <code>overlay</code> &#x5B58;&#x50A8;&#x5C42;&#xFF0C;&#x9700;&#x8981;&#x5185;&#x6838;&#x5728; <code>3.18</code> &#x4EE5;&#x4E0A;&#x3002;</p><h2 id="2015-nian-4-yue-linux-fa-bu-liao-nei-he-4-0"><a href="#2015&#x5E74;4&#x6708;-Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-4-0" class="headerlink" title="2015&#x5E74;4&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 4.0"></a>2015&#x5E74;4&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.0</code> <a href="#2015-nian-4-yue-linux-fa-bu-liao-nei-he-4-0" class="header-anchor">#</a></h2><p>docker 1.12 &#x4E2D;&#x7684; <code>overlay2</code> &#x5B58;&#x50A8;&#x5C42;&#x5C31;&#x4F9D;&#x8D56;&#x7684;&#x662F;&#x8FD9;&#x6B21;&#x7684;&#x5185;&#x6838;&#x5BF9; <code>overlay</code> &#x9A71;&#x52A8;&#x7684;&#x6539;&#x8FDB;&#x3002;</p><h2 id="2016-nian-linux-fa-bu-liao-nei-he-4-5"><a href="#2016&#x5E74;-Linux-&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-4-5" class="headerlink" title="2016&#x5E74; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 4.5"></a>2016&#x5E74; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.5</code> <a href="#2016-nian-linux-fa-bu-liao-nei-he-4-5" class="header-anchor">#</a></h2><p>&#x66F4;&#x52A0;&#x5F7B;&#x5E95;&#x7684;&#x6539;&#x9020;&#x4E86; <code>cgroups</code>&#xFF0C;&#x79F0;&#x4E3A; <code>cgroups2</code>&#xFF0C;&#x5E76;&#x4E14;&#x8BA4;&#x53EF;&#x5176;&#x5DF2;&#x7ECF;&#x7A33;&#x5B9A;&#x3002;<br><a href="http://kernelnewbies.org/Linux_4.5#head-621383bcd8bc104aed825c9ebc08a0b986690f8a" target="_blank" rel="noopener">http://kernelnewbies.org/Linux_4.5#head-621383bcd8bc104aed825c9ebc08a0b986690f8a</a></p><h1 id="shi-yong-docker-de-hao-chu"><a href="#&#x4F7F;&#x7528;-Docker-&#x7684;&#x597D;&#x5904;" class="headerlink" title="&#x4F7F;&#x7528; Docker &#x7684;&#x597D;&#x5904;"></a>&#x4F7F;&#x7528; Docker &#x7684;&#x597D;&#x5904; <a href="#shi-yong-docker-de-hao-chu" class="header-anchor">#</a></h1><p>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x6269;&#x5C55;&#xFF0C;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x6253;&#x5305;&#x5728;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x91CC;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x90E8;&#x7F72;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x9002;&#x5408;&#x6269;&#x5C55;&#x3002;</p><p>Docker &#x5BB9;&#x5668;&#x662F; <code>immutable</code> &#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x89C6;&#x4E3A;&#x4E50;&#x9AD8;&#x79EF;&#x6728;&#xFF0C;&#x5982;&#x679C;&#x54EA;&#x4E2A;&#x574F;&#x4E86;&#xFF0C;&#x6254;&#x4E86;&#x6362;&#x4E2A;&#x65B0;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x65E7;&#x7684;&#x4E0A;&#x9762;&#x4FEE;&#x4FEE;&#x8865;&#x8865;&#x3002;</p><p>DevOps&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;(Dev)&#x53EA;&#x9700;&#x8981;&#x8003;&#x8651;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4E1C;&#x897F;&#x5373;&#x53EF;&#xFF0C;&#x800C;&#x8FD0;&#x8425;&#x4EBA;&#x5458;(Ops)&#x5219;&#x53EA;&#x9700;&#x8D1F;&#x8D23;&#x5BB9;&#x5668;&#x5916;&#x90E8;&#x5373;&#x53EF;&#x3002;</p><h2 id="chi-xu-ji-cheng-continuous-integration"><a href="#&#x6301;&#x7EED;&#x96C6;&#x6210;-Continuous-Integration" class="headerlink" title="&#x6301;&#x7EED;&#x96C6;&#x6210;(Continuous Integration)"></a>&#x6301;&#x7EED;&#x96C6;&#x6210;(Continuous Integration) <a href="#chi-xu-ji-cheng-continuous-integration" class="header-anchor">#</a></h2><p>&#x786E;&#x4FDD;&#x6240;&#x6709;&#x73AF;&#x5883;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#xFF0C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x201C;&#x6211;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x6CA1;&#x95EE;&#x9898;&#x554A;&#x201D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#x8FD0;&#x884C;&#x3001;&#x6D4B;&#x8BD5;&#x90FD;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x3002;</p><h2 id="bian-pai-orchestration-gong-ju"><a href="#&#x7F16;&#x6392;-Orchestration-&#x5DE5;&#x5177;" class="headerlink" title="&#x7F16;&#x6392;(Orchestration)&#x5DE5;&#x5177;"></a>&#x7F16;&#x6392;(Orchestration)&#x5DE5;&#x5177; <a href="#bian-pai-orchestration-gong-ju" class="header-anchor">#</a></h2><p>Compose, Machine, Swarm, Networking</p><h3 id="compose"><a href="#Compose" class="headerlink" title="Compose"></a>Compose <a href="#compose" class="header-anchor">#</a></h3><p>&#x5B9A;&#x4E49;&#x8FD0;&#x884C;&#x591A;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF0C;&#x5355;&#x673A;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x591A;&#x4E3B;&#x673A;&#x8FD8;&#x5728;&#x8BD5;&#x9A8C;&#x4E2D;&#x3002;</p><p>&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x4ED6;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x3002;<code>docker-compose.yml</code> &#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x76EE;&#x5F55;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x76EE;&#x5F55;&#x4E0B;&#x5B58;&#x5728; <code>Dockerfile</code>&#x3002;&#x8FD9;&#x79CD;&#x611F;&#x89C9;&#x66F4;&#x5E72;&#x51C0;&#x3002;&#xFF08;&#x6216;&#x8BB8;&#x5728;LNMP&#x793A;&#x4F8B;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x4E0D;&#x5E94;&#x8BE5;&#x628A;<code>conf</code>&#x90FD;&#x5B58;&#x5728;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x800C;&#x662F;&#x5E94;&#x8BE5;&#x5206;&#x5E94;&#x7528;&#x5EFA;&#x7ACB;&#x76EE;&#x5F55;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#x653E;&#x5728;&#x5404;&#x81EA;&#x76EE;&#x5F55;&#x4E0B;&#x3002;&#xFF09;</p><p>&#x53E6;&#x5916;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x4EC5;&#x6709;&#x51E0;&#x53F0;&#x7684;&#x5E94;&#x7528;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x4ED6;&#x4F9D;&#x7136;&#x5B9A;&#x4E49;&#x4E86;&#x524D;&#x7AEF;&#x7F51;&#x7EDC;&#x548C;&#x540E;&#x7AEF;&#x7F51;&#x7EDC;&#xFF0C;&#x8BA9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#x72EC;&#x7ACB;&#x3002;</p><p>&#x5728;&#x542F;&#x52A8;&#x793A;&#x4F8B;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;Tom Vereist &#x63D0;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5199;&#x7684;&#x4E0D;&#x597D;&#x7684;&#x4E00;&#x70B9;&#xFF0C;&#x5728; worker &#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x5B83;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x4F7F;&#x7528; maven &#x5BF9;&#x9879;&#x76EE;&#x8FDB;&#x884C;&#x4E86;&#x6784;&#x5EFA;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;maven&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x7F16;&#x8BD1;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x7684;&#x5B89;&#x88C5;&#x3001;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x88C5;&#x7B49;&#x7B49;&#xFF0C;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5927;&#x7684;&#x955C;&#x50CF;&#x3002;&#x5EFA;&#x8BAE;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x6784;&#x5EFA;&#xFF0C;&#x628A;&#x6784;&#x5EFA;&#x540E;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#x62FF;&#x5230;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x5B89;&#x88C5;&#x4F7F;&#x7528;&#x5373;&#x53EF;&#xFF0C;&#x907F;&#x514D;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x5B58;&#x5728;&#x4E8E;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p><h3 id="machine"><a href="#Machine" class="headerlink" title="Machine"></a>Machine <a href="#machine" class="header-anchor">#</a></h3><p>&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x3001;&#x7BA1;&#x7406; docker host&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x79CD;&#x4E91;&#x5E73;&#x53F0;&#xFF0C;&#x63D0;&#x4F9B;&#x7EDF;&#x4E00;&#x7684;&#x8BBF;&#x95EE;&#x63A5;&#x53E3;&#x3002;</p><h3 id="swarm"><a href="#Swarm" class="headerlink" title="Swarm"></a>Swarm <a href="#swarm" class="header-anchor">#</a></h3><p>docker &#x96C6;&#x7FA4;&#x5DE5;&#x5177;&#xFF0C;&#x591A;&#x5BBF;&#x4E3B;&#x7BA1;&#x7406;&#x8FD0;&#x884C;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x5B9A;&#x4E49; docker host &#x7684; label&#x3002;&#x901A;&#x8FC7; docker daemon &#x7684; <code>--label</code> &#x8BBE;&#x7F6E;&#xFF1B;&#x901A;&#x8FC7; <code>docker-machine --engine-label</code>, <code>--label</code> &#x8BBE;&#x7F6E;&#xFF1B;&#x5C06; docker host &#x8BBE;&#x7F6E;&#x4E0A;&#x6807;&#x7B7E;&#x3002;&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EA6;&#x675F;&#x6807;&#x7B7E;&#xFF0C;&#x6765;&#x51B3;&#x5B9A;&#x8BE5;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x4E8E;&#x90A3;&#x4E9B; docker host &#x4E0A;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x5305;&#x62EC;&#x4E24;&#x5927;&#x7C7B;&#xFF0C;&#x8282;&#x70B9;(Node)&#x6216;&#x5BB9;&#x5668;(Container)&#x3002;&#x8282;&#x70B9;&#x53EF;&#x80FD;&#x662F;&#x7EA6;&#x675F;&#x3001;&#x5065;&#x5EB7;&#x7A0B;&#x5EA6;&#x7B49;&#xFF1B;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x662F;&#x7AEF;&#x53E3;&#x3001;&#x4F9D;&#x8D56;&#x7B49;&#x3002;</p><h3 id="networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking <a href="#networking" class="header-anchor">#</a></h3><p>&#x521B;&#x5EFA; <code>Overlay network</code>&#x3002;&#x66FF;&#x4EE3; <code>link</code> (bridge)&#xFF0C;<code>link</code>&#x5728;&#x4E00;&#x4E9B;&#x52A8;&#x6001;&#x73AF;&#x5883;&#x4E0B;&#x4F7F;&#x7528;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;&#x6BD4;&#x5982;&#x4E00;&#x7FA4;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#xFF0C;<code>link</code>&#x7684;&#x67D0;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x65B0;&#x7684;ip&#xFF0C;&#x800C;&#x8FD8;&#x5728;&#x8FD0;&#x884C;&#x7684;docker&#x4F7F;&#x7528;&#x7684;&#x8FD8;&#x662F;&#x65E7;&#x7684;ip&#x53BB;&#x8054;&#x7CFB;&#x8BE5;&#x8282;&#x70B9;&#xFF0C;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x3002;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x591F;&#x628A;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;down&#x6389;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;</p><p>&#x5C1D;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x4E24;&#x4E2A;&#x6CA1;&#x6709;<code>link</code>&#x5173;&#x7CFB;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;IP&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x3002;&#x6240;&#x4EE5; <code>link</code> &#x662F;&#x5EFA;&#x7ACB;&#x4E00;&#x79CD;&#x8BC6;&#x522B;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B89;&#x5168;&#x4E0A;&#x7684;&#x5EFA;&#x7ACB;&#x901A;&#x9053;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#x6587;&#x6863;&#xFF0C;&#x63D0;&#x5230;&#x4E86; <code>--icc=false</code> &#x7684;&#x53C2;&#x6570;&#x6765;&#x521B;&#x5EFA;&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x3002;<br><a href="https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks</a></p><p><code>link</code> (bridge)&#x4F7F;&#x7528;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x7ED9;&#x5BBF;&#x4E3B;&#x5176;link&#x7684;&#x4E3B;&#x673A;&#x4F4D;&#x7F6E;&#xFF0C;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x548C;<code>/etc/hosts</code>&#x6587;&#x4EF6;&#x3002;<br><a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#communication-across-links" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#communication-across-links</a></p><p>&#x800C;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; docker network &#x521B;&#x5EFA; <code>overlay network</code>&#xFF0C;&#x4F7F;&#x7528;<code>link</code>&#x94FE;&#x63A5;&#x4E3B;&#x673A;&#xFF0C;&#x5219;&#x4F1A;<strong>&#x6709;&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x7684;DNS&#x8FDB;&#x884C;&#x540D;&#x5B57;&#x7684;&#x52A8;&#x6001;&#x7EF4;&#x62A4;</strong>&#xFF0C;&#x4E0D;&#x518D;&#x4F7F;&#x7528; <code>/etc/hosts</code>&#x3002;</p><p>&#x5728;Tom &#x6F14;&#x793A; docker swarm &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x53D1;&#x73B0;&#x4ED6;&#x548C;&#x6211;&#x4E00;&#x6837;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A; bash &#x811A;&#x672C;&#x6765;&#x542F;&#x52A8;&#x5EFA;&#x7ACB; docker host&#x3002;&#x6211;&#x89C9;&#x5F97;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x505A;&#x4E2A;&#x5DE5;&#x5177;&#x4F7F;&#x7528; yaml &#x63CF;&#x8FF0;&#x6587;&#x4EF6;&#x6765;&#x5EFA;&#x7ACB; docker-machine&#xFF0C;&#x5C31;&#x50CF; docker-compose&#x505A;&#x7684;&#x90A3;&#x6837;&#x3002;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x6709;&#x592A;&#x591A;&#x7684;&#x91CD;&#x590D;&#x4FE1;&#x606F;&#x4E86;&#x3002;</p><p>&#x811A;&#x672C;&#x6700;&#x540E;&#x662F;&#x4F7F;&#x7528; docker network &#x521B;&#x5EFA; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;Tom &#x63D0;&#x5230;&#x4E00;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A;  <code>--subnet</code> &#xFF0C;&#x5426;&#x5219;&#x5C06;&#x65E0;&#x6CD5;&#x8FDE;&#x901A;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x8DE8;&#x4E3B;&#x673A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6709;&#x7684;&#x7248;&#x672C;&#x6709;bug&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x4E0D;&#x4E00;&#x5B9A;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x6BB5;IP&#x5730;&#x5740;&#x3002;&#x4E0D;&#x8FC7;&#x73B0;&#x5728;&#x8FD9;&#x4E2A;bug&#x5DF2;&#x7ECF;&#x4FEE;&#x590D;&#x4E86;&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x8DE8;&#x4E3B;&#x673A;&#x6CA1;&#x95EE;&#x9898;&#x3002;</p><p>&#x6F14;&#x793A; swarm &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x78B0;&#x5230;&#x4E86;&#x548C;&#x6211;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5728;&#x5355;&#x673A;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5728; docker compose &#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>build</code> &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3002;&#x4F46;&#x662F;&#x5728; swarm &#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x5BFC;&#x81F4;&#x6240;&#x6709;&#x7684; service &#x4F1A;&#x6254;&#x5230;&#x540C;&#x4E00;&#x4E2A; docker host &#x4E2D;&#x53BB;&#xFF0C;&#x800C;&#x5982;&#x679C;&#x6253;&#x7B97;&#x4F7F;&#x7528;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#xFF08;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;swarm &#x7684;&#x521D;&#x8877;&#xFF09;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x4F7F;&#x7528; registry &#x4E2D;&#x7684; image&#x3002;&#x8FD9;&#x6837;&#x5BBF;&#x4E3B;&#x53EF;&#x4EE5;&#x4E3B;&#x52A8;&#x53BB; registry &#x4E0B;&#x8F7D; image&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; docker hub &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x81EA;&#x5DF1;&#x67B6;&#x8BBE; registry&#x3002;</p><p>&#x5E76;&#x4E14;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>link</code> &#x4E86;&#xFF0C;&#x800C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>&#x81EA;&#x5B9A;&#x4E49;network</code>&#x3002;Tom &#x8BF4;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x4E00;&#x4E2A; <code>link</code> &#x7684;bug&#xFF0C;&#x73B0;&#x5728;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x8BD5;&#x9A8C;&#x3002;</p><p>&#x901A;&#x8FC7; <code>environment:&quot;constraint:type==frontend&quot;</code> &#x7684;&#x5F62;&#x5F0F;&#x6765;&#x6307;&#x5B9A;&#x7EA6;&#x675F;&#x3002;</p><p>Tom &#x4E0D;&#x63A8;&#x8350;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528; compose + swarm&#xFF0C;&#x56E0;&#x4E3A;&#x78B0;&#x5230;&#x4E86;&#x592A;&#x591A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4ED6;&#x751A;&#x81F3;&#x81EA;&#x5DF1;&#x8FD8;&#x62A5;&#x544A;&#x4E86;&#x4E00;&#x4E2A;bug #2866&#x3002;</p><h2 id="qi-ta-gong-ju"><a href="#&#x5176;&#x5B83;&#x5DE5;&#x5177;" class="headerlink" title="&#x5176;&#x5B83;&#x5DE5;&#x5177;"></a>&#x5176;&#x5B83;&#x5DE5;&#x5177; <a href="#qi-ta-gong-ju" class="header-anchor">#</a></h2><h3 id="docker-cloud-cloud-docker-com"><a href="#Docker-Cloud-cloud-docker-com" class="headerlink" title="Docker Cloud (cloud.docker.com)"></a>Docker Cloud (cloud.docker.com) <a href="#docker-cloud-cloud-docker-com" class="header-anchor">#</a></h3><p>&#x521B;&#x5EFA; node clusters&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;AWS, Digital Ocean, Azure&#xFF0C;Softlayer&#x7B49;&#x51E0;&#x5927;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x3002;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;docker hub&#x4E0A;&#x7684;&#x955C;&#x50CF;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;&#x5EFA;&#x7ACB; Stack &#x9700;&#x8981;&#x811A;&#x672C;&#xFF0C;&#x5F88;&#x50CF;compose&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x5E94;&#x8BE5;&#x652F;&#x6301;compose&#x811A;&#x672C;&#x66F4;&#x5408;&#x9002;&#xFF0C;&#x5EFA;&#x7ACB;service&#x3002;</p><p>Docker Cloud &#x9002;&#x5408;&#x5C0F;&#x89C4;&#x6A21;&#x4E91;&#x7684;&#x90E8;&#x7F72;&#x3002;</p><h3 id="kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes <a href="#kubernetes" class="header-anchor">#</a></h3><p>&#x7531; Google &#x5F00;&#x53D1;&#xFF0C;&#x7528; Go &#x8BED;&#x8A00;&#x5199;&#x7684;&#x3002;Google &#x6BCF;&#x5468;&#x7528;&#x8FD9;&#x4E2A;&#x8FD0;&#x884C;2&#x767E;&#x4E07;&#x4E2A;containers&#x3002;</p><p>&#x4E00;&#x4E2A; kubernetes &#x96C6;&#x7FA4;&#x7531; master &#x548C; minions &#x7EC4;&#x6210;&#x3002;master &#x542B;&#x6709; etcd&#x3001;scheduler&#xFF1B;&#x800C;&#x6BCF;&#x4E2A; minon &#x542B;&#x6709; kubelet&#xFF0C;proxy &#x548C;&#x4E00;&#x7FA4; pod&#x3002;</p><h3 id="coreos"><a href="#CoreOS" class="headerlink" title="CoreOS"></a>CoreOS <a href="#coreos" class="header-anchor">#</a></h3><p>&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5; docker&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E86; linux container&#x3002;&#x5B83;&#x4E5F;&#x4F7F;&#x7528; etcd&#xFF0C;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x6BCF;&#x4E00;&#x4E2A; host&#x90FD;&#x8FD0;&#x884C;etcd&#xFF0C;&#x8FD9;&#x6837;&#x907F;&#x514D;&#x4E86;&#x5355;&#x70B9;&#x6545;&#x969C;&#x3002;<code>fleetd</code>&#xFF0C;&#x5F88;&#x50CF;&#x662F;&#x7F51;&#x7EDC;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#x4E0B;&#x7684; <code>systemd</code>&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x5F00;&#x542F;&#x505C;&#x6B62;&#x5206;&#x5E03;&#x5728;&#x5BBF;&#x4E3B;&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x3002;</p><h3 id="lattice"><a href="#Lattice" class="headerlink" title="Lattice"></a>Lattice <a href="#lattice" class="header-anchor">#</a></h3><h3 id="flocker"><a href="#Flocker" class="headerlink" title="Flocker"></a>Flocker <a href="#flocker" class="header-anchor">#</a></h3><h1 id="docker-security"><a href="#Docker-Security" class="headerlink" title="Docker Security"></a>Docker Security <a href="#docker-security" class="header-anchor">#</a></h1><h2 id="container-security"><a href="#Container-Security" class="headerlink" title="Container Security"></a>Container Security <a href="#container-security" class="header-anchor">#</a></h2><p>container &#x672C;&#x8EAB;&#x5F88;&#x5B89;&#x5168;&#xFF0C;&#x7531;&#x4E8E; isolation&#xFF0C;&#x53EA;&#x4F7F;&#x7528;&#x5FC5;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x3002;<br>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--security-opt sec comp:xxx.json</code>&#xFF0C;&#x6765;&#x6307;&#x5B9A;&#x5B89;&#x5168;&#x7B56;&#x7565;&#x3002;<br>Unikernel&#xFF0C;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#x5B9A;&#x5236;&#x7684;&#x5185;&#x6838;&#xFF0C;&#x53EA;&#x9009;&#x62E9;&#x6240;&#x5FC5;&#x987B;&#x7684;&#x7EC4;&#x4EF6;&#x4F7F;&#x7528;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x629B;&#x5F03;&#xFF0C;&#x4FE1;&#x4EFB;&#x57DF;&#x66F4;&#x5C0F;&#x3002;</p><h2 id="node-security"><a href="#Node-Security" class="headerlink" title="Node Security"></a>Node Security <a href="#node-security" class="header-anchor">#</a></h2><p>&#x73B0;&#x5728; docker daemon &#x5FC5;&#x987B;&#x4EE5; root &#x8FD0;&#x884C;&#x3002;&#x73B0;&#x5728;&#x7684;&#x6388;&#x6743;&#x673A;&#x5236;&#x662F; all or nothing&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x7BA1;&#x7406;&#x6240;&#x6709; docker&#xFF0C;&#x6216;&#x8005;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x3002;&#x8FD9;&#x70B9;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/blog.lab99.org/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#ji-ben-jie-shao&quot;&gt;&amp;#x57FA;&amp;#x672C;&amp;#x4ECB;&amp;#x7ECD
      
    
    </summary>
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="https://1x481n.github.io/blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="https://1x481n.github.io/blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="https://1x481n.github.io/blog.lab99.org/tags/notes/"/>
    
  </entry>
  
</feed>
